{
  "version": 3,
  "sources": ["../scripts/path.ux/scripts/path-controller/util/mobile-detect.cjs", "../scripts/path.ux/scripts/platforms/electron/electron_api.js", "../scripts/path.ux/scripts/path-controller/util/util.js", "../scripts/path.ux/scripts/path-controller/util/polyfill.js", "../scripts/path.ux/scripts/path-controller/util/nstructjs_es6.js", "../scripts/path.ux/scripts/path-controller/util/struct.js", "../scripts/path.ux/scripts/path-controller/extern/lz-string/lz-string.js", "../scripts/path.ux/scripts/path-controller/config/config.js", "../scripts/path.ux/scripts/config/const.js", "../scripts/path.ux/scripts/path-controller/util/vectormath.js", "../scripts/path.ux/scripts/path-controller/util/simple_events.js", "../scripts/path.ux/scripts/core/ui_consts.js", "../scripts/path.ux/scripts/screen/area_wrangler.js", "../scripts/path.ux/scripts/path-controller/util/math.js", "../scripts/path.ux/scripts/core/ui_theme.js", "../scripts/path.ux/scripts/path-controller/util/events.js", "../scripts/path.ux/scripts/path-controller/curve/curve1d_base.js", "../scripts/path.ux/scripts/path-controller/toolsys/toolprop_abstract.js", "../scripts/path.ux/scripts/path-controller/units/units.js", "../scripts/path.ux/scripts/path-controller/toolsys/toolprop.js", "../scripts/path.ux/scripts/path-controller/controller/controller_base.js", "../scripts/path.ux/scripts/path-controller/controller/context.js", "../scripts/path.ux/scripts/path-controller/toolsys/toolsys.js", "../scripts/path.ux/scripts/path-controller/curve/curve1d_bspline.js", "../scripts/path.ux/scripts/path-controller/curve/curve1d.js", "../scripts/path.ux/scripts/core/anim.js", "../scripts/path.ux/scripts/path-controller/util/parseutil.js", "../scripts/path.ux/scripts/path-controller/toolsys/toolpath.js", "../scripts/path.ux/scripts/path-controller/controller/controller_abstract.js", "../scripts/path.ux/scripts/path-controller/controller/controller_ops.js", "../scripts/path.ux/scripts/path-controller/curve/curve1d_basic.js", "../scripts/path.ux/scripts/path-controller/curve/ease.js", "../scripts/path.ux/scripts/path-controller/curve/curve1d_anim.js", "../scripts/path.ux/scripts/path-controller/curve/curve1d_toolprop.js", "../scripts/path.ux/scripts/path-controller/controller/controller.js", "../scripts/path.ux/scripts/path-controller/util/colorutils.js", "../scripts/path.ux/scripts/core/theme.js", "../scripts/path.ux/scripts/icon_enum.js", "../scripts/path.ux/scripts/core/aspect.js", "../scripts/path.ux/scripts/path-controller/dag/eventdag.js", "../scripts/path.ux/scripts/core/ui_base.js", "../scripts/path.ux/scripts/widgets/ui_button.js", "../scripts/path.ux/scripts/path-controller/controller.js", "../scripts/path.ux/scripts/path-controller/util/solver.js", "../scripts/path.ux/scripts/path-controller/util/graphpack.js", "../scripts/path.ux/scripts/widgets/ui_menu.js"],
  "sourcesContent": ["// THIS FILE IS GENERATED - DO NOT EDIT!\r\n/*!mobile-detect v1.4.4 2019-09-21*/\r\n/*global module:false, define:false*/\r\n/*jshint latedef:false*/\r\n/*!@license Copyright 2013, Heinrich Goebl, License: MIT, see https://github.com/hgoebl/mobile-detect.js*/\r\n(function (define, undefined) {\r\ndefine(function () {\r\n    'use strict';\r\n\r\n    var impl = {};\r\n\r\n    impl.mobileDetectRules = {\r\n    \"phones\": {\r\n        \"iPhone\": \"\\\\biPhone\\\\b|\\\\biPod\\\\b\",\r\n        \"BlackBerry\": \"BlackBerry|\\\\bBB10\\\\b|rim[0-9]+|\\\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\\\b-[0-9]+\",\r\n        \"HTC\": \"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\\\bEVO\\\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel\",\r\n        \"Nexus\": \"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6\",\r\n        \"Dell\": \"Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\\\b001DL\\\\b|\\\\b101DL\\\\b|\\\\bGS01\\\\b\",\r\n        \"Motorola\": \"Motorola|DROIDX|DROID BIONIC|\\\\bDroid\\\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\\\bMoto E\\\\b|XT1068|XT1092|XT1052\",\r\n        \"Samsung\": \"\\\\bSamsung\\\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F\",\r\n        \"LG\": \"\\\\bLG\\\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710\",\r\n        \"Sony\": \"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533\",\r\n        \"Asus\": \"Asus.*Galaxy|PadFone.*Mobile\",\r\n        \"NokiaLumia\": \"Lumia [0-9]{3,4}\",\r\n        \"Micromax\": \"Micromax.*\\\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\\\b\",\r\n        \"Palm\": \"PalmSource|Palm\",\r\n        \"Vertu\": \"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature\",\r\n        \"Pantech\": \"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790\",\r\n        \"Fly\": \"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250\",\r\n        \"Wiko\": \"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM\",\r\n        \"iMobile\": \"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)\",\r\n        \"SimValley\": \"\\\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\\\b\",\r\n        \"Wolfgang\": \"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q\",\r\n        \"Alcatel\": \"Alcatel\",\r\n        \"Nintendo\": \"Nintendo (3DS|Switch)\",\r\n        \"Amoi\": \"Amoi\",\r\n        \"INQ\": \"INQ\",\r\n        \"OnePlus\": \"ONEPLUS\",\r\n        \"GenericPhone\": \"Tapatalk|PDA;|SAGEM|\\\\bmmp\\\\b|pocket|\\\\bpsp\\\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\\\bwap\\\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser\"\r\n    },\r\n    \"tablets\": {\r\n        \"iPad\": \"iPad|iPad.*Mobile\",\r\n        \"NexusTablet\": \"Android.*Nexus[\\\\s]+(7|9|10)\",\r\n        \"GoogleTablet\": \"Android.*Pixel C\",\r\n        \"SamsungTablet\": \"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V\",\r\n        \"Kindle\": \"Kindle|Silk.*Accelerated|Android.*\\\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\\\b|Android.*Silk\\/[0-9.]+ like Chrome\\/[0-9.]+ (?!Mobile)\",\r\n        \"SurfaceTablet\": \"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)\",\r\n        \"HPTablet\": \"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10\",\r\n        \"AsusTablet\": \"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\\\bK00F\\\\b|\\\\bK00C\\\\b|\\\\bK00E\\\\b|\\\\bK00L\\\\b|TX201LA|ME176C|ME102A|\\\\bM80TA\\\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\\\bME70C\\\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\\\bP027\\\\b|\\\\bP024\\\\b|\\\\bP00C\\\\b\",\r\n        \"BlackBerryTablet\": \"PlayBook|RIM Tablet\",\r\n        \"HTCtablet\": \"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410\",\r\n        \"MotorolaTablet\": \"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617\",\r\n        \"NookTablet\": \"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2\",\r\n        \"AcerTablet\": \"Android.*; \\\\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\\\b|W3-810|\\\\bA3-A10\\\\b|\\\\bA3-A11\\\\b|\\\\bA3-A20\\\\b|\\\\bA3-A30\",\r\n        \"ToshibaTablet\": \"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO\",\r\n        \"LGTablet\": \"\\\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\\\b\",\r\n        \"FujitsuTablet\": \"Android.*\\\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\\\b\",\r\n        \"PrestigioTablet\": \"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002\",\r\n        \"LenovoTablet\": \"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X\",\r\n        \"DellTablet\": \"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7\",\r\n        \"YarvikTablet\": \"Android.*\\\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\\\b\",\r\n        \"MedionTablet\": \"Android.*\\\\bOYO\\\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB\",\r\n        \"ArnovaTablet\": \"97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2\",\r\n        \"IntensoTablet\": \"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004\",\r\n        \"IRUTablet\": \"M702pro\",\r\n        \"MegafonTablet\": \"MegaFon V9|\\\\bZTE V9\\\\b|Android.*\\\\bMT7A\\\\b\",\r\n        \"EbodaTablet\": \"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)\",\r\n        \"AllViewTablet\": \"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)\",\r\n        \"ArchosTablet\": \"\\\\b(101G9|80G9|A101IT)\\\\b|Qilive 97R|Archos5|\\\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\\\b\",\r\n        \"AinolTablet\": \"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark\",\r\n        \"NokiaLumiaTablet\": \"Lumia 2520\",\r\n        \"SonyTablet\": \"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712\",\r\n        \"PhilipsTablet\": \"\\\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\\\b\",\r\n        \"CubeTablet\": \"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT\",\r\n        \"CobyTablet\": \"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010\",\r\n        \"MIDTablet\": \"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10\",\r\n        \"MSITablet\": \"MSI \\\\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\\\b\",\r\n        \"SMiTTablet\": \"Android.*(\\\\bMID\\\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)\",\r\n        \"RockChipTablet\": \"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A\",\r\n        \"FlyTablet\": \"IQ310|Fly Vision\",\r\n        \"bqTablet\": \"Android.*(bq)?.*\\\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\\\b|Maxwell.*Lite|Maxwell.*Plus\",\r\n        \"HuaweiTablet\": \"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19\",\r\n        \"NecTablet\": \"\\\\bN-06D|\\\\bN-08D\",\r\n        \"PantechTablet\": \"Pantech.*P4100\",\r\n        \"BronchoTablet\": \"Broncho.*(N701|N708|N802|a710)\",\r\n        \"VersusTablet\": \"TOUCHPAD.*[78910]|\\\\bTOUCHTAB\\\\b\",\r\n        \"ZyncTablet\": \"z1000|Z99 2G|z930|z990|z909|Z919|z900\",\r\n        \"PositivoTablet\": \"TB07STA|TB10STA|TB07FTA|TB10FTA\",\r\n        \"NabiTablet\": \"Android.*\\\\bNabi\",\r\n        \"KoboTablet\": \"Kobo Touch|\\\\bK080\\\\b|\\\\bVox\\\\b Build|\\\\bArc\\\\b Build\",\r\n        \"DanewTablet\": \"DSlide.*\\\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\\\b\",\r\n        \"TexetTablet\": \"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE\",\r\n        \"PlaystationTablet\": \"Playstation.*(Portable|Vita)\",\r\n        \"TrekstorTablet\": \"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab\",\r\n        \"PyleAudioTablet\": \"\\\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\\\b\",\r\n        \"AdvanTablet\": \"Android.* \\\\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\\\b \",\r\n        \"DanyTechTablet\": \"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1\",\r\n        \"GalapadTablet\": \"Android.*\\\\bG1\\\\b(?!\\\\))\",\r\n        \"MicromaxTablet\": \"Funbook|Micromax.*\\\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\\\b\",\r\n        \"KarbonnTablet\": \"Android.*\\\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\\\b\",\r\n        \"AllFineTablet\": \"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide\",\r\n        \"PROSCANTablet\": \"\\\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\\\b\",\r\n        \"YONESTablet\": \"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026\",\r\n        \"ChangJiaTablet\": \"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503\",\r\n        \"GUTablet\": \"TX-A1301|TX-M9002|Q702|kf026\",\r\n        \"PointOfViewTablet\": \"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10\",\r\n        \"OvermaxTablet\": \"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027\",\r\n        \"HCLTablet\": \"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync\",\r\n        \"DPSTablet\": \"DPS Dream 9|DPS Dual 7\",\r\n        \"VistureTablet\": \"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10\",\r\n        \"CrestaTablet\": \"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989\",\r\n        \"MediatekTablet\": \"\\\\bMT8125|MT8389|MT8135|MT8377\\\\b\",\r\n        \"ConcordeTablet\": \"Concorde([ ]+)?Tab|ConCorde ReadMan\",\r\n        \"GoCleverTablet\": \"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042\",\r\n        \"ModecomTablet\": \"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003\",\r\n        \"VoninoTablet\": \"\\\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\\\bQ8\\\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\\\b\",\r\n        \"ECSTablet\": \"V07OT2|TM105A|S10OT1|TR10CS1\",\r\n        \"StorexTablet\": \"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab\",\r\n        \"VodafoneTablet\": \"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400\",\r\n        \"EssentielBTablet\": \"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2\",\r\n        \"RossMoorTablet\": \"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711\",\r\n        \"iMobileTablet\": \"i-mobile i-note\",\r\n        \"TolinoTablet\": \"tolino tab [0-9.]+|tolino shine\",\r\n        \"AudioSonicTablet\": \"\\\\bC-22Q|T7-QC|T-17B|T-17P\\\\b\",\r\n        \"AMPETablet\": \"Android.* A78 \",\r\n        \"SkkTablet\": \"Android.* (SKYPAD|PHOENIX|CYCLOPS)\",\r\n        \"TecnoTablet\": \"TECNO P9|TECNO DP8D\",\r\n        \"JXDTablet\": \"Android.* \\\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\\\b\",\r\n        \"iJoyTablet\": \"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)\",\r\n        \"FX2Tablet\": \"FX2 PAD7|FX2 PAD10\",\r\n        \"XoroTablet\": \"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151\",\r\n        \"ViewsonicTablet\": \"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a\",\r\n        \"VerizonTablet\": \"QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1\",\r\n        \"OdysTablet\": \"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\\\bXELIO\\\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10\",\r\n        \"CaptivaTablet\": \"CAPTIVA PAD\",\r\n        \"IconbitTablet\": \"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S\",\r\n        \"TeclastTablet\": \"T98 4G|\\\\bP80\\\\b|\\\\bX90HD\\\\b|X98 Air|X98 Air 3G|\\\\bX89\\\\b|P80 3G|\\\\bX80h\\\\b|P98 Air|\\\\bX89HD\\\\b|P98 3G|\\\\bP90HD\\\\b|P89 3G|X98 3G|\\\\bP70h\\\\b|P79HD 3G|G18d 3G|\\\\bP79HD\\\\b|\\\\bP89s\\\\b|\\\\bA88\\\\b|\\\\bP10HD\\\\b|\\\\bP19HD\\\\b|G18 3G|\\\\bP78HD\\\\b|\\\\bA78\\\\b|\\\\bP75\\\\b|G17s 3G|G17h 3G|\\\\bP85t\\\\b|\\\\bP90\\\\b|\\\\bP11\\\\b|\\\\bP98t\\\\b|\\\\bP98HD\\\\b|\\\\bG18d\\\\b|\\\\bP85s\\\\b|\\\\bP11HD\\\\b|\\\\bP88s\\\\b|\\\\bA80HD\\\\b|\\\\bA80se\\\\b|\\\\bA10h\\\\b|\\\\bP89\\\\b|\\\\bP78s\\\\b|\\\\bG18\\\\b|\\\\bP85\\\\b|\\\\bA70h\\\\b|\\\\bA70\\\\b|\\\\bG17\\\\b|\\\\bP18\\\\b|\\\\bA80s\\\\b|\\\\bA11s\\\\b|\\\\bP88HD\\\\b|\\\\bA80h\\\\b|\\\\bP76s\\\\b|\\\\bP76h\\\\b|\\\\bP98\\\\b|\\\\bA10HD\\\\b|\\\\bP78\\\\b|\\\\bP88\\\\b|\\\\bA11\\\\b|\\\\bA10t\\\\b|\\\\bP76a\\\\b|\\\\bP76t\\\\b|\\\\bP76e\\\\b|\\\\bP85HD\\\\b|\\\\bP85a\\\\b|\\\\bP86\\\\b|\\\\bP75HD\\\\b|\\\\bP76v\\\\b|\\\\bA12\\\\b|\\\\bP75a\\\\b|\\\\bA15\\\\b|\\\\bP76Ti\\\\b|\\\\bP81HD\\\\b|\\\\bA10\\\\b|\\\\bT760VE\\\\b|\\\\bT720HD\\\\b|\\\\bP76\\\\b|\\\\bP73\\\\b|\\\\bP71\\\\b|\\\\bP72\\\\b|\\\\bT720SE\\\\b|\\\\bC520Ti\\\\b|\\\\bT760\\\\b|\\\\bT720VE\\\\b|T720-3GE|T720-WiFi\",\r\n        \"OndaTablet\": \"\\\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\\\b[\\\\s]+|V10 \\\\b4G\\\\b\",\r\n        \"JaytechTablet\": \"TPC-PA762\",\r\n        \"BlaupunktTablet\": \"Endeavour 800NG|Endeavour 1010\",\r\n        \"DigmaTablet\": \"\\\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\\\b\",\r\n        \"EvolioTablet\": \"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\\\bEvotab\\\\b|\\\\bNeura\\\\b\",\r\n        \"LavaTablet\": \"QPAD E704|\\\\bIvoryS\\\\b|E-TAB IVORY|\\\\bE-TAB\\\\b\",\r\n        \"AocTablet\": \"MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712\",\r\n        \"MpmanTablet\": \"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\\\bMPG7\\\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010\",\r\n        \"CelkonTablet\": \"CT695|CT888|CT[\\\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\\\bCT-1\\\\b\",\r\n        \"WolderTablet\": \"miTab \\\\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\\\b\",\r\n        \"MediacomTablet\": \"M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA\",\r\n        \"MiTablet\": \"\\\\bMI PAD\\\\b|\\\\bHM NOTE 1W\\\\b\",\r\n        \"NibiruTablet\": \"Nibiru M1|Nibiru Jupiter One\",\r\n        \"NexoTablet\": \"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI\",\r\n        \"LeaderTablet\": \"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100\",\r\n        \"UbislateTablet\": \"UbiSlate[\\\\s]?7C\",\r\n        \"PocketBookTablet\": \"Pocketbook\",\r\n        \"KocasoTablet\": \"\\\\b(TB-1207)\\\\b\",\r\n        \"HisenseTablet\": \"\\\\b(F5281|E2371)\\\\b\",\r\n        \"Hudl\": \"Hudl HT7S3|Hudl 2\",\r\n        \"TelstraTablet\": \"T-Hub2\",\r\n        \"GenericTablet\": \"Android.*\\\\b97D\\\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\\\bA7EB\\\\b|CatNova8|A1_07|CT704|CT1002|\\\\bM721\\\\b|rk30sdk|\\\\bEVOTAB\\\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\\\bM6pro\\\\b|CT1020W|arc 10HD|\\\\bTP750\\\\b|\\\\bQTAQZ3\\\\b|WVT101|TM1088|KT107\"\r\n    },\r\n    \"oss\": {\r\n        \"AndroidOS\": \"Android\",\r\n        \"BlackBerryOS\": \"blackberry|\\\\bBB10\\\\b|rim tablet os\",\r\n        \"PalmOS\": \"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino\",\r\n        \"SymbianOS\": \"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\\\bS60\\\\b\",\r\n        \"WindowsMobileOS\": \"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;\",\r\n        \"WindowsPhoneOS\": \"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;\",\r\n        \"iOS\": \"\\\\biPhone.*Mobile|\\\\biPod|\\\\biPad|AppleCoreMedia\",\r\n        \"iPadOS\": \"CPU OS 13\",\r\n        \"MeeGoOS\": \"MeeGo\",\r\n        \"MaemoOS\": \"Maemo\",\r\n        \"JavaOS\": \"J2ME\\/|\\\\bMIDP\\\\b|\\\\bCLDC\\\\b\",\r\n        \"webOS\": \"webOS|hpwOS\",\r\n        \"badaOS\": \"\\\\bBada\\\\b\",\r\n        \"BREWOS\": \"BREW\"\r\n    },\r\n    \"uas\": {\r\n        \"Chrome\": \"\\\\bCrMo\\\\b|CriOS|Android.*Chrome\\/[.0-9]* (Mobile)?\",\r\n        \"Dolfin\": \"\\\\bDolfin\\\\b\",\r\n        \"Opera\": \"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\\/[0-9.]+$|Coast\\/[0-9.]+\",\r\n        \"Skyfire\": \"Skyfire\",\r\n        \"Edge\": \"Mobile Safari\\/[.0-9]* Edge\",\r\n        \"IE\": \"IEMobile|MSIEMobile\",\r\n        \"Firefox\": \"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS\",\r\n        \"Bolt\": \"bolt\",\r\n        \"TeaShark\": \"teashark\",\r\n        \"Blazer\": \"Blazer\",\r\n        \"Safari\": \"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari\",\r\n        \"WeChat\": \"\\\\bMicroMessenger\\\\b\",\r\n        \"UCBrowser\": \"UC.*Browser|UCWEB\",\r\n        \"baiduboxapp\": \"baiduboxapp\",\r\n        \"baidubrowser\": \"baidubrowser\",\r\n        \"DiigoBrowser\": \"DiigoBrowser\",\r\n        \"Mercury\": \"\\\\bMercury\\\\b\",\r\n        \"ObigoBrowser\": \"Obigo\",\r\n        \"NetFront\": \"NF-Browser\",\r\n        \"GenericBrowser\": \"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger\",\r\n        \"PaleMoon\": \"Android.*PaleMoon|Mobile.*PaleMoon\"\r\n    },\r\n    \"props\": {\r\n        \"Mobile\": \"Mobile\\/[VER]\",\r\n        \"Build\": \"Build\\/[VER]\",\r\n        \"Version\": \"Version\\/[VER]\",\r\n        \"VendorID\": \"VendorID\\/[VER]\",\r\n        \"iPad\": \"iPad.*CPU[a-z ]+[VER]\",\r\n        \"iPhone\": \"iPhone.*CPU[a-z ]+[VER]\",\r\n        \"iPod\": \"iPod.*CPU[a-z ]+[VER]\",\r\n        \"Kindle\": \"Kindle\\/[VER]\",\r\n        \"Chrome\": [\r\n            \"Chrome\\/[VER]\",\r\n            \"CriOS\\/[VER]\",\r\n            \"CrMo\\/[VER]\"\r\n        ],\r\n        \"Coast\": [\r\n            \"Coast\\/[VER]\"\r\n        ],\r\n        \"Dolfin\": \"Dolfin\\/[VER]\",\r\n        \"Firefox\": [\r\n            \"Firefox\\/[VER]\",\r\n            \"FxiOS\\/[VER]\"\r\n        ],\r\n        \"Fennec\": \"Fennec\\/[VER]\",\r\n        \"Edge\": \"Edge\\/[VER]\",\r\n        \"IE\": [\r\n            \"IEMobile\\/[VER];\",\r\n            \"IEMobile [VER]\",\r\n            \"MSIE [VER];\",\r\n            \"Trident\\/[0-9.]+;.*rv:[VER]\"\r\n        ],\r\n        \"NetFront\": \"NetFront\\/[VER]\",\r\n        \"NokiaBrowser\": \"NokiaBrowser\\/[VER]\",\r\n        \"Opera\": [\r\n            \" OPR\\/[VER]\",\r\n            \"Opera Mini\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"Opera Mini\": \"Opera Mini\\/[VER]\",\r\n        \"Opera Mobi\": \"Version\\/[VER]\",\r\n        \"UCBrowser\": [\r\n            \"UCWEB[VER]\",\r\n            \"UC.*Browser\\/[VER]\"\r\n        ],\r\n        \"MQQBrowser\": \"MQQBrowser\\/[VER]\",\r\n        \"MicroMessenger\": \"MicroMessenger\\/[VER]\",\r\n        \"baiduboxapp\": \"baiduboxapp\\/[VER]\",\r\n        \"baidubrowser\": \"baidubrowser\\/[VER]\",\r\n        \"SamsungBrowser\": \"SamsungBrowser\\/[VER]\",\r\n        \"Iron\": \"Iron\\/[VER]\",\r\n        \"Safari\": [\r\n            \"Version\\/[VER]\",\r\n            \"Safari\\/[VER]\"\r\n        ],\r\n        \"Skyfire\": \"Skyfire\\/[VER]\",\r\n        \"Tizen\": \"Tizen\\/[VER]\",\r\n        \"Webkit\": \"webkit[ \\/][VER]\",\r\n        \"PaleMoon\": \"PaleMoon\\/[VER]\",\r\n        \"Gecko\": \"Gecko\\/[VER]\",\r\n        \"Trident\": \"Trident\\/[VER]\",\r\n        \"Presto\": \"Presto\\/[VER]\",\r\n        \"Goanna\": \"Goanna\\/[VER]\",\r\n        \"iOS\": \" \\\\bi?OS\\\\b [VER][ ;]{1}\",\r\n        \"Android\": \"Android [VER]\",\r\n        \"BlackBerry\": [\r\n            \"BlackBerry[\\\\w]+\\/[VER]\",\r\n            \"BlackBerry.*Version\\/[VER]\",\r\n            \"Version\\/[VER]\"\r\n        ],\r\n        \"BREW\": \"BREW [VER]\",\r\n        \"Java\": \"Java\\/[VER]\",\r\n        \"Windows Phone OS\": [\r\n            \"Windows Phone OS [VER]\",\r\n            \"Windows Phone [VER]\"\r\n        ],\r\n        \"Windows Phone\": \"Windows Phone [VER]\",\r\n        \"Windows CE\": \"Windows CE\\/[VER]\",\r\n        \"Windows NT\": \"Windows NT [VER]\",\r\n        \"Symbian\": [\r\n            \"SymbianOS\\/[VER]\",\r\n            \"Symbian\\/[VER]\"\r\n        ],\r\n        \"webOS\": [\r\n            \"webOS\\/[VER]\",\r\n            \"hpwOS\\/[VER];\"\r\n        ]\r\n    },\r\n    \"utils\": {\r\n        \"Bot\": \"Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp\",\r\n        \"MobileBot\": \"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\\/M1A1-R2D2\",\r\n        \"DesktopMode\": \"WPDesktop\",\r\n        \"TV\": \"SonyDTV|HbbTV\",\r\n        \"WebKit\": \"(webkit)[ \\/]([\\\\w.]+)\",\r\n        \"Console\": \"\\\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\\\b\",\r\n        \"Watch\": \"SM-V700\"\r\n    }\r\n};\r\n\r\n    // following patterns come from http://detectmobilebrowsers.com/\r\n    impl.detectMobileBrowsers = {\r\n        fullPattern: /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,\r\n        shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i,\r\n        tabletPattern: /android|ipad|playbook|silk/i\r\n    };\r\n\r\n    var hasOwnProp = Object.prototype.hasOwnProperty,\r\n        isArray;\r\n\r\n    impl.FALLBACK_PHONE = 'UnknownPhone';\r\n    impl.FALLBACK_TABLET = 'UnknownTablet';\r\n    impl.FALLBACK_MOBILE = 'UnknownMobile';\r\n\r\n    isArray = ('isArray' in Array) ?\r\n        Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };\r\n\r\n    function equalIC(a, b) {\r\n        return a != null && b != null && a.toLowerCase() === b.toLowerCase();\r\n    }\r\n\r\n    function containsIC(array, value) {\r\n        var valueLC, i, len = array.length;\r\n        if (!len || !value) {\r\n            return false;\r\n        }\r\n        valueLC = value.toLowerCase();\r\n        for (i = 0; i < len; ++i) {\r\n            if (valueLC === array[i].toLowerCase()) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function convertPropsToRegExp(object) {\r\n        for (var key in object) {\r\n            if (hasOwnProp.call(object, key)) {\r\n                object[key] = new RegExp(object[key], 'i');\r\n            }\r\n        }\r\n    }\r\n\r\n    function prepareUserAgent(userAgent) {\r\n        return (userAgent || '').substr(0, 500); // mitigate vulnerable to ReDoS\r\n    }\r\n\r\n    (function init() {\r\n        var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;\r\n        for (key in mobileDetectRules.props) {\r\n            if (hasOwnProp.call(mobileDetectRules.props, key)) {\r\n                values = mobileDetectRules.props[key];\r\n                if (!isArray(values)) {\r\n                    values = [values];\r\n                }\r\n                len = values.length;\r\n                for (i = 0; i < len; ++i) {\r\n                    value = values[i];\r\n                    verPos = value.indexOf('[VER]');\r\n                    if (verPos >= 0) {\r\n                        value = value.substring(0, verPos) + '([\\\\w._\\\\+]+)' + value.substring(verPos + 5);\r\n                    }\r\n                    values[i] = new RegExp(value, 'i');\r\n                }\r\n                mobileDetectRules.props[key] = values;\r\n            }\r\n        }\r\n        convertPropsToRegExp(mobileDetectRules.oss);\r\n        convertPropsToRegExp(mobileDetectRules.phones);\r\n        convertPropsToRegExp(mobileDetectRules.tablets);\r\n        convertPropsToRegExp(mobileDetectRules.uas);\r\n        convertPropsToRegExp(mobileDetectRules.utils);\r\n\r\n        // copy some patterns to oss0 which are tested first (see issue#15)\r\n        mobileDetectRules.oss0 = {\r\n            WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,\r\n            WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS\r\n        };\r\n    }());\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and find the first matched key.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {String|null} the matched key if found, otherwise <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatch = function(rules, userAgent) {\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    return key;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Test userAgent string against a set of rules and return an array of matched keys.\r\n     * @param {Object} rules (key is String, value is RegExp)\r\n     * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').\r\n     * @returns {Array} an array of matched keys, may be empty when there is no match, but not <tt>null</tt>\r\n     * @private\r\n     */\r\n    impl.findMatches = function(rules, userAgent) {\r\n        var result = [];\r\n        for (var key in rules) {\r\n            if (hasOwnProp.call(rules, key)) {\r\n                if (rules[key].test(userAgent)) {\r\n                    result.push(key);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {String} version or <tt>null</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersionStr = function (propertyName, userAgent) {\r\n        var props = impl.mobileDetectRules.props, patterns, i, len, match;\r\n        if (hasOwnProp.call(props, propertyName)) {\r\n            patterns = props[propertyName];\r\n            len = patterns.length;\r\n            for (i = 0; i < len; ++i) {\r\n                match = patterns[i].exec(userAgent);\r\n                if (match !== null) {\r\n                    return match[1];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Check the version of the given property in the User-Agent.\r\n     * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n     *\r\n     * @param {String} propertyName\r\n     * @param {String} userAgent\r\n     * @return {Number} version or <tt>NaN</tt> if version not found\r\n     * @private\r\n     */\r\n    impl.getVersion = function (propertyName, userAgent) {\r\n        var version = impl.getVersionStr(propertyName, userAgent);\r\n        return version ? impl.prepareVersionNo(version) : NaN;\r\n    };\r\n\r\n    /**\r\n     * Prepare the version number.\r\n     *\r\n     * @param {String} version\r\n     * @return {Number} the version number as a floating number\r\n     * @private\r\n     */\r\n    impl.prepareVersionNo = function (version) {\r\n        var numbers;\r\n\r\n        numbers = version.split(/[a-z._ \\/\\-]/i);\r\n        if (numbers.length === 1) {\r\n            version = numbers[0];\r\n        }\r\n        if (numbers.length > 1) {\r\n            version = numbers[0] + '.';\r\n            numbers.shift();\r\n            version += numbers.join('');\r\n        }\r\n        return Number(version);\r\n    };\r\n\r\n    impl.isMobileFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||\r\n            impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0,4));\r\n    };\r\n\r\n    impl.isTabletFallback = function (userAgent) {\r\n        return impl.detectMobileBrowsers.tabletPattern.test(userAgent);\r\n    };\r\n\r\n    impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {\r\n        if (cache.mobile !== undefined) {\r\n            return;\r\n        }\r\n        var phone, tablet, phoneSized;\r\n\r\n        // first check for stronger tablet rules, then phone (see issue#5)\r\n        tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);\r\n        if (tablet) {\r\n            cache.mobile = cache.tablet = tablet;\r\n            cache.phone = null;\r\n            return; // unambiguously identified as tablet\r\n        }\r\n\r\n        phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);\r\n        if (phone) {\r\n            cache.mobile = cache.phone = phone;\r\n            cache.tablet = null;\r\n            return; // unambiguously identified as phone\r\n        }\r\n\r\n        // our rules haven't found a match -> try more general fallback rules\r\n        if (impl.isMobileFallback(userAgent)) {\r\n            phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);\r\n            if (phoneSized === undefined) {\r\n                cache.mobile = impl.FALLBACK_MOBILE;\r\n                cache.tablet = cache.phone = null;\r\n            } else if (phoneSized) {\r\n                cache.mobile = cache.phone = impl.FALLBACK_PHONE;\r\n                cache.tablet = null;\r\n            } else {\r\n                cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n                cache.phone = null;\r\n            }\r\n        } else if (impl.isTabletFallback(userAgent)) {\r\n            cache.mobile = cache.tablet = impl.FALLBACK_TABLET;\r\n            cache.phone = null;\r\n        } else {\r\n            // not mobile at all!\r\n            cache.mobile = cache.tablet = cache.phone = null;\r\n        }\r\n    };\r\n\r\n    // t is a reference to a MobileDetect instance\r\n    impl.mobileGrade = function (t) {\r\n        // impl note:\r\n        // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.\r\n        // When changes are made in Mobile_Detect.php, copy this method and replace:\r\n        //     $this-> / t.\r\n        //     self::MOBILE_GRADE_(.) / '$1'\r\n        //     , self::VERSION_TYPE_FLOAT / (nothing)\r\n        //     isIOS() / os('iOS')\r\n        //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE\r\n        var $isMobile = t.mobile() !== null;\r\n\r\n        if (\r\n            // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)\r\n            t.os('iOS') && t.version('iPad')>=4.3 ||\r\n            t.os('iOS') && t.version('iPhone')>=3.1 ||\r\n            t.os('iOS') && t.version('iPod')>=3.1 ||\r\n\r\n            // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)\r\n            // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM\r\n            // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices\r\n            // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7\r\n            ( t.version('Android')>2.1 && t.is('Webkit') ) ||\r\n\r\n            // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800\r\n            t.version('Windows Phone OS')>=7.0 ||\r\n\r\n            // Blackberry 7 - Tested on BlackBerry Torch 9810\r\n            // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670\r\n            t.is('BlackBerry') && t.version('BlackBerry')>=6.0 ||\r\n            // Blackberry Playbook (1.0-2.0) - Tested on PlayBook\r\n            t.match('Playbook.*Tablet') ||\r\n\r\n            // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)\r\n            ( t.version('webOS')>=1.4 && t.match('Palm|Pre|Pixi') ) ||\r\n            // Palm WebOS 3.0  - Tested on HP TouchPad\r\n            t.match('hp.*TouchPad') ||\r\n\r\n            // Firefox Mobile (12 Beta) - Tested on Android 2.3 device\r\n            ( t.is('Firefox') && t.version('Firefox')>=12 ) ||\r\n\r\n            // Chrome for Android - Tested on Android 4.0, 4.1 device\r\n            ( t.is('Chrome') && t.is('AndroidOS') && t.version('Android')>=4.0 ) ||\r\n\r\n            // Skyfire 4.1 - Tested on Android 2.3 device\r\n            ( t.is('Skyfire') && t.version('Skyfire')>=4.1 && t.is('AndroidOS') && t.version('Android')>=2.3 ) ||\r\n\r\n            // Opera Mobile 11.5-12: Tested on Android 2.3\r\n            ( t.is('Opera') && t.version('Opera Mobi')>11 && t.is('AndroidOS') ) ||\r\n\r\n            // Meego 1.2 - Tested on Nokia 950 and N9\r\n            t.is('MeeGoOS') ||\r\n\r\n            // Tizen (pre-release) - Tested on early hardware\r\n            t.is('Tizen') ||\r\n\r\n            // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser\r\n            // @todo: more tests here!\r\n            t.is('Dolfin') && t.version('Bada')>=2.0 ||\r\n\r\n            // UC Browser - Tested on Android 2.3 device\r\n            ( (t.is('UC Browser') || t.is('Dolfin')) && t.version('Android')>=2.3 ) ||\r\n\r\n            // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each\r\n            ( t.match('Kindle Fire') ||\r\n                t.is('Kindle') && t.version('Kindle')>=3.0 ) ||\r\n\r\n            // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet\r\n            t.is('AndroidOS') && t.is('NookTablet') ||\r\n\r\n            // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Chrome')>=11 && !$isMobile ||\r\n\r\n            // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Safari')>=5.0 && !$isMobile ||\r\n\r\n            // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7\r\n            t.version('Firefox')>=4.0 && !$isMobile ||\r\n\r\n            // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7\r\n            t.version('MSIE')>=7.0 && !$isMobile ||\r\n\r\n            // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7\r\n            // @reference: http://my.opera.com/community/openweb/idopera/\r\n            t.version('Opera')>=10 && !$isMobile\r\n\r\n            ){\r\n            return 'A';\r\n        }\r\n\r\n        if (\r\n            t.os('iOS') && t.version('iPad')<4.3 ||\r\n            t.os('iOS') && t.version('iPhone')<3.1 ||\r\n            t.os('iOS') && t.version('iPod')<3.1 ||\r\n\r\n            // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770\r\n            t.is('Blackberry') && t.version('BlackBerry')>=5 && t.version('BlackBerry')<6 ||\r\n\r\n            //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3\r\n            ( t.version('Opera Mini')>=5.0 && t.version('Opera Mini')<=6.5 &&\r\n                (t.version('Android')>=2.3 || t.is('iOS')) ) ||\r\n\r\n            // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)\r\n            t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||\r\n\r\n            // @todo: report this (tested on Nokia N71)\r\n            t.version('Opera Mobi')>=11 && t.is('SymbianOS')\r\n            ){\r\n            return 'B';\r\n        }\r\n\r\n        if (\r\n        // Blackberry 4.x - Tested on the Curve 8330\r\n            t.version('BlackBerry')<5.0 ||\r\n            // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)\r\n            t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile')<=5.2\r\n\r\n            ){\r\n            return 'C';\r\n        }\r\n\r\n        //All older smartphone platforms and featurephones - Any device that doesn't support media queries\r\n        //will receive the basic, C grade experience.\r\n        return 'C';\r\n    };\r\n\r\n    impl.detectOS = function (ua) {\r\n        return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||\r\n            impl.findMatch(impl.mobileDetectRules.oss, ua);\r\n    };\r\n\r\n    impl.getDeviceSmallerSide = function () {\r\n        return window.screen.width < window.screen.height ?\r\n            window.screen.width :\r\n            window.screen.height;\r\n    };\r\n\r\n    /**\r\n     * Constructor for MobileDetect object.\r\n     * <br>\r\n     * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>\r\n     * <div style=\"background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px\">\r\n     *     <strong>Find information how to download and install:</strong>\r\n     *     <a href=\"https://github.com/hgoebl/mobile-detect.js/\">github.com/hgoebl/mobile-detect.js/</a>\r\n     * </div>\r\n     *\r\n     * @example <pre>\r\n     *     var md = new MobileDetect(window.navigator.userAgent);\r\n     *     if (md.mobile()) {\r\n     *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';\r\n     *     }\r\n     * </pre>\r\n     *\r\n     * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']\r\n     * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum\r\n     *        width of smallest device side (in logical \"CSS\" pixels) until a device detected as mobile will be handled\r\n     *        as phone.\r\n     *        This is only used in cases where the device cannot be classified as phone or tablet.<br>\r\n     *        See <a href=\"http://developer.android.com/guide/practices/screens_support.html\">Declaring Tablet Layouts\r\n     *        for Android</a>.<br>\r\n     *        If you provide a value < 0, then this \"fuzzy\" check is disabled.\r\n     * @constructor\r\n     * @global\r\n     */\r\n    function MobileDetect(userAgent, maxPhoneWidth) {\r\n        this.ua = prepareUserAgent(userAgent);\r\n        this._cache = {};\r\n        //600dp is typical 7\" tablet minimum width\r\n        this.maxPhoneWidth = maxPhoneWidth || 600;\r\n    }\r\n\r\n    MobileDetect.prototype = {\r\n        constructor: MobileDetect,\r\n\r\n        /**\r\n         * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.\r\n         * <br>\r\n         * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or\r\n         * <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key for the phone family or tablet family, e.g. \"Nexus\".\r\n         * @function MobileDetect#mobile\r\n         */\r\n        mobile: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.mobile;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected phone type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,\r\n         * NokiaLumia, Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley,\r\n         * Wolfgang, Alcatel, Nintendo, Amoi, INQ, OnePlus, GenericPhone</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the phone family or producer, e.g. \"iPhone\"\r\n         * @function MobileDetect#phone\r\n         */\r\n        phone: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.phone;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected tablet type/family string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned tablet (family or producer) is one of following keys:<br>\r\n         * <br><tt>iPad, NexusTablet, GoogleTablet, SamsungTablet, Kindle, SurfaceTablet,\r\n         * HPTablet, AsusTablet, BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet,\r\n         * AcerTablet, ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet,\r\n         * LenovoTablet, DellTablet, YarvikTablet, MedionTablet, ArnovaTablet,\r\n         * IntensoTablet, IRUTablet, MegafonTablet, EbodaTablet, AllViewTablet,\r\n         * ArchosTablet, AinolTablet, NokiaLumiaTablet, SonyTablet, PhilipsTablet,\r\n         * CubeTablet, CobyTablet, MIDTablet, MSITablet, SMiTTablet, RockChipTablet,\r\n         * FlyTablet, bqTablet, HuaweiTablet, NecTablet, PantechTablet, BronchoTablet,\r\n         * VersusTablet, ZyncTablet, PositivoTablet, NabiTablet, KoboTablet, DanewTablet,\r\n         * TexetTablet, PlaystationTablet, TrekstorTablet, PyleAudioTablet, AdvanTablet,\r\n         * DanyTechTablet, GalapadTablet, MicromaxTablet, KarbonnTablet, AllFineTablet,\r\n         * PROSCANTablet, YONESTablet, ChangJiaTablet, GUTablet, PointOfViewTablet,\r\n         * OvermaxTablet, HCLTablet, DPSTablet, VistureTablet, CrestaTablet,\r\n         * MediatekTablet, ConcordeTablet, GoCleverTablet, ModecomTablet, VoninoTablet,\r\n         * ECSTablet, StorexTablet, VodafoneTablet, EssentielBTablet, RossMoorTablet,\r\n         * iMobileTablet, TolinoTablet, AudioSonicTablet, AMPETablet, SkkTablet,\r\n         * TecnoTablet, JXDTablet, iJoyTablet, FX2Tablet, XoroTablet, ViewsonicTablet,\r\n         * VerizonTablet, OdysTablet, CaptivaTablet, IconbitTablet, TeclastTablet,\r\n         * OndaTablet, JaytechTablet, BlaupunktTablet, DigmaTablet, EvolioTablet,\r\n         * LavaTablet, AocTablet, MpmanTablet, CelkonTablet, WolderTablet, MediacomTablet,\r\n         * MiTablet, NibiruTablet, NexoTablet, LeaderTablet, UbislateTablet,\r\n         * PocketBookTablet, KocasoTablet, HisenseTablet, Hudl, TelstraTablet,\r\n         * GenericTablet</tt><br>\r\n         * <br>\r\n         * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against\r\n         * the patterns of <a href=\"http://detectmobilebrowsers.com/\">detectmobilebrowsers.com</a>. If this test\r\n         * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>\r\n         * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>\r\n         * <br>\r\n         * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>\r\n         * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}\r\n         * will return <code>UnknownMobile</code>.<br>\r\n         * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:\r\n         * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.\r\n         * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.\r\n         * <br>\r\n         * In most cases you will use the return value just as a boolean.\r\n         *\r\n         * @returns {String} the key of the tablet family or producer, e.g. \"SamsungTablet\"\r\n         * @function MobileDetect#tablet\r\n         */\r\n        tablet: function () {\r\n            impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);\r\n            return this._cache.tablet;\r\n        },\r\n\r\n        /**\r\n         * Returns the (first) detected user-agent string or <tt>null</tt>.\r\n         * <br>\r\n         * The returned user-agent is one of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {String} the key for the detected user-agent or <tt>null</tt>\r\n         * @function MobileDetect#userAgent\r\n         */\r\n        userAgent: function () {\r\n            if (this._cache.userAgent === undefined) {\r\n                this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgent;\r\n        },\r\n\r\n        /**\r\n         * Returns all detected user-agent strings.\r\n         * <br>\r\n         * The array is empty or contains one or more of following keys:<br>\r\n         * <br><tt>Chrome, Dolfin, Opera, Skyfire, Edge, IE, Firefox, Bolt, TeaShark, Blazer,\r\n         * Safari, WeChat, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Mercury,\r\n         * ObigoBrowser, NetFront, GenericBrowser, PaleMoon</tt><br>\r\n         * <br>\r\n         * In most cases calling {@link MobileDetect#userAgent} will be sufficient. But there are rare\r\n         * cases where a mobile device pretends to be more than one particular browser. You can get the\r\n         * list of all matches with {@link MobileDetect#userAgents} or check for a particular value by\r\n         * providing one of the defined keys as first argument to {@link MobileDetect#is}.\r\n         *\r\n         * @returns {Array} the array of detected user-agent keys or <tt>[]</tt>\r\n         * @function MobileDetect#userAgents\r\n         */\r\n        userAgents: function () {\r\n            if (this._cache.userAgents === undefined) {\r\n                this._cache.userAgents = impl.findMatches(impl.mobileDetectRules.uas, this.ua);\r\n            }\r\n            return this._cache.userAgents;\r\n        },\r\n\r\n        /**\r\n         * Returns the detected operating system string or <tt>null</tt>.\r\n         * <br>\r\n         * The operating system is one of following keys:<br>\r\n         * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,\r\n         * iOS, iPadOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>\r\n         *\r\n         * @returns {String} the key for the detected operating system.\r\n         * @function MobileDetect#os\r\n         */\r\n        os: function () {\r\n            if (this._cache.os === undefined) {\r\n                this._cache.os = impl.detectOS(this.ua);\r\n            }\r\n            return this._cache.os;\r\n        },\r\n\r\n        /**\r\n         * Get the version (as Number) of the given property in the User-Agent.\r\n         * <br>\r\n         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.\r\n         *          Be careful when comparing this value with '==' operator!\r\n         * @function MobileDetect#version\r\n         */\r\n        version: function (key) {\r\n            return impl.getVersion(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Get the version (as String) of the given property in the User-Agent.\r\n         * <br>\r\n         *\r\n         * @param {String} key a key defining a thing which has a version.<br>\r\n         *        You can use one of following keys:<br>\r\n         * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,\r\n         * Dolfin, Firefox, Fennec, Edge, IE, NetFront, NokiaBrowser, Opera, Opera Mini,\r\n         * Opera Mobi, UCBrowser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser,\r\n         * SamsungBrowser, Iron, Safari, Skyfire, Tizen, Webkit, PaleMoon, Gecko, Trident,\r\n         * Presto, Goanna, iOS, Android, BlackBerry, BREW, Java, Windows Phone OS, Windows\r\n         * Phone, Windows CE, Windows NT, Symbian, webOS</tt><br>\r\n         *\r\n         * @returns {String} the \"raw\" version as String or <tt>null</tt> if User-Agent doesn't contain this version.\r\n         *\r\n         * @function MobileDetect#versionStr\r\n         */\r\n        versionStr: function (key) {\r\n            return impl.getVersionStr(key, this.ua);\r\n        },\r\n\r\n        /**\r\n         * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.\r\n         *\r\n         * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or\r\n         *        tablet family.<br>\r\n         *        For a complete list of possible values, see {@link MobileDetect#userAgent},\r\n         *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>\r\n         *        Additionally you have following keys:<br>\r\n         * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>\r\n         *\r\n         * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,\r\n         *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>\r\n         * @function MobileDetect#is\r\n         */\r\n        is: function (key) {\r\n            return containsIC(this.userAgents(), key) ||\r\n                   equalIC(key, this.os()) ||\r\n                   equalIC(key, this.phone()) ||\r\n                   equalIC(key, this.tablet()) ||\r\n                   containsIC(impl.findMatches(impl.mobileDetectRules.utils, this.ua), key);\r\n        },\r\n\r\n        /**\r\n         * Do a quick test against navigator::userAgent.\r\n         *\r\n         * @param {String|RegExp} pattern the pattern, either as String or RegExp\r\n         *                        (a string will be converted to a case-insensitive RegExp).\r\n         * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>\r\n         * @function MobileDetect#match\r\n         */\r\n        match: function (pattern) {\r\n            if (!(pattern instanceof RegExp)) {\r\n                pattern = new RegExp(pattern, 'i');\r\n            }\r\n            return pattern.test(this.ua);\r\n        },\r\n\r\n        /**\r\n         * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.\r\n         * <br>\r\n         * Obviously this method makes sense in browser environments only (not for Node.js)!\r\n         * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>\r\n         *        The argument is optional and if not present or falsy, the value of the constructor is taken.\r\n         * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>\r\n         *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>\r\n         *          Will always return <code>undefined</code> server-side.\r\n         */\r\n        isPhoneSized: function (maxPhoneWidth) {\r\n            return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);\r\n        },\r\n\r\n        /**\r\n         * Returns the mobile grade ('A', 'B', 'C').\r\n         *\r\n         * @returns {String} one of the mobile grades ('A', 'B', 'C').\r\n         * @function MobileDetect#mobileGrade\r\n         */\r\n        mobileGrade: function () {\r\n            if (this._cache.grade === undefined) {\r\n                this._cache.grade = impl.mobileGrade(this);\r\n            }\r\n            return this._cache.grade;\r\n        }\r\n    };\r\n\r\n    // environment-dependent\r\n    if (typeof window !== 'undefined' && window.screen) {\r\n        MobileDetect.isPhoneSized = function (maxPhoneWidth) {\r\n            return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;\r\n        };\r\n    } else {\r\n        MobileDetect.isPhoneSized = function () {};\r\n    }\r\n\r\n    // should not be replaced by a completely new object - just overwrite existing methods\r\n    MobileDetect._impl = impl;\r\n    \r\n    MobileDetect.version = '1.4.4 2019-09-21';\r\n\r\n    return MobileDetect;\r\n}); // end of call of define()\r\n})((function (undefined) {\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        return function (factory) { module.exports = factory(); };\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        return define;\r\n    } else if (typeof window !== 'undefined') {\r\n        return function (factory) { window.MobileDetect = factory(); };\r\n    } else {\r\n        // please file a bug if you get this error!\r\n        throw new Error('unknown environment');\r\n    }\r\n})());", "\"use strict\";\r\n\r\nlet _nativeTheme;\r\n\r\nfunction getNativeTheme() {\r\n  if (_nativeTheme) {\r\n    return _nativeTheme;\r\n  }\r\n\r\n  let remote = getElectron().remote;\r\n  if (!remote) { /* Newer electron version with no remote, client must provide it */\r\n    ipcRenderer.invoke(\"nativeTheme\");\r\n  } else {\r\n    _nativeTheme = remote.nativeTheme;\r\n  }\r\n\r\n  return _nativeTheme;\r\n}\r\n\r\nfunction getElectronVersion() {\r\n  let key = navigator.userAgent;\r\n  let i = key.search(\"Electron\");\r\n  key = key.slice(i + 9, key.length);\r\n\r\n  i = key.search(/[ \\t]/);\r\n  if (i >= 0) {\r\n    key = key.slice(0, i);\r\n  }\r\n\r\n  key = key.trim();\r\n  key = key.split(\".\").map(f => parseInt(f));\r\n\r\n  return key;\r\n}\r\n\r\n/*\r\n* wrap require to keep angular from auto-importing\r\n* this api in browsers\r\n* */\r\nfunction getElectron() {\r\n  return require('electron');\r\n}\r\n\r\nfunction myRequire(mod) {\r\n  return globalThis.require(mod);\r\n}\r\n\r\nimport {Menu, DropBox} from '../../widgets/ui_menu.js';\r\nimport {getIconManager} from \"../../core/ui_base.js\";\r\nimport cconst from \"../../config/const.js\";\r\nimport * as util from '../../util/util.js';\r\n\r\nimport {FileDialogArgs, FilePath} from '../platform_base.js';\r\n\r\nfunction getFilename(path) {\r\n  let filename = path.replace(/\\\\/g, \"/\");\r\n  let i = filename.length - 1;\r\n  while (i >= 0 && filename[i] !== \"/\") {\r\n    i--;\r\n  }\r\n\r\n  if (filename[i] === \"/\") {\r\n    i++;\r\n  }\r\n\r\n  if (i > 0) {\r\n    filename = filename.slice(i, filename.length).trim();\r\n  }\r\n\r\n  return filename;\r\n}\r\n\r\nlet _menu_init = false;\r\nlet _init = false;\r\n\r\nimport {mimeMap} from '../platform_base.js';\r\n\r\nlet electron_menu_idgen = 1;\r\nlet ipcRenderer;\r\n\r\nexport class ElectronMenu extends Array {\r\n  constructor(args = {}) {\r\n    super();\r\n\r\n    this._ipcId = electron_menu_idgen++;\r\n\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n  }\r\n\r\n  insert(i, item) {\r\n    this.length++;\r\n\r\n    let j = this.length - 1;\r\n    while (j > i) {\r\n      this[j] = this[j - 1];\r\n      j--;\r\n    }\r\n    this[i] = item;\r\n\r\n    return this;\r\n  }\r\n\r\n  static setApplicationMenu(menu) {\r\n    initElectronIpc();\r\n\r\n    ipcRenderer.invoke(\"set-menu-bar\", menu);\r\n  }\r\n\r\n  closePopup() {\r\n    ipcRenderer.invoke(\"close-menu\", this._ipcId);\r\n  }\r\n\r\n  append(item) {\r\n    this.push(item);\r\n  }\r\n\r\n  popup(args) {\r\n    let {x, y, callback} = args;\r\n\r\n    callback = wrapRemoteCallback(\"popup_menu_click\", callback);\r\n\r\n    const {ipcRenderer} = require('electron')\r\n    ipcRenderer.invoke(\"popup-menu\", this, x, y, callback);\r\n  }\r\n}\r\n\r\nlet callbacks = {};\r\nlet keybase = 1;\r\n\r\nexport function wrapRemoteCallback(key, callback) {\r\n  key = \"remote_\" + key + (keybase++);\r\n  callbacks[key] = callback;\r\n\r\n  return key;\r\n}\r\n\r\nlet ipcInit = false;\r\n\r\nfunction initElectronIpc() {\r\n  if (ipcInit) {\r\n    return;\r\n  }\r\n\r\n  ipcInit = true;\r\n  ipcRenderer = require('electron').ipcRenderer;\r\n\r\n  ipcRenderer.on('invoke-menu-callback', (event, key, args) => {\r\n    //console.error(\"Electron menu callback\", key, args);\r\n    callbacks[key].apply(undefined, args);\r\n  });\r\n\r\n  ipcRenderer.on(\"nativeTheme\", (event, module) => {\r\n    _nativeTheme = Object.assign({}, module);\r\n    _nativeTheme._themeSource = _nativeTheme.themeSource;\r\n\r\n    Object.defineProperty(_nativeTheme, \"themeSource\", {\r\n      get() {\r\n        return this._themeSource;\r\n      },\r\n      set(v) {\r\n        ipcRenderer.invoke(\"nativeTheme.setThemeSource\", v);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n\r\nexport class ElectronMenuItem {\r\n  constructor(args) {\r\n    for (let k in args) {\r\n      this[k] = args[k];\r\n    }\r\n\r\n    if (this.click) {\r\n      this.click = wrapRemoteCallback(\"menu_click\", this.click);\r\n    }\r\n  }\r\n}\r\n\r\nfunction patchDropBox() {\r\n  initElectronIpc();\r\n\r\n  if (cconst.noElectronMenus) {\r\n    return;\r\n  }\r\n\r\n  //haveElectron = false;\r\n  //return;\r\n  DropBox.prototype._onpress = function _onpress(e) {\r\n    if (this._menu !== undefined) {\r\n      this._menu.close();\r\n      this._menu = undefined;\r\n      this._pressed = false;\r\n      this._redraw();\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    let emenu = buildElectronMenu(this._menu);\r\n\r\n    this._menu.close = () => {\r\n      emenu.closePopup(); //getCurrentWindow);\r\n    };\r\n\r\n    //console.log(\"menu dropbox click\", this._menu);\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getClientRects();\r\n\r\n    x = rects[0].x;\r\n    y = rects[0].y + Math.ceil(rects[0].height);\r\n\r\n    x = ~~x;\r\n    y = ~~y;\r\n\r\n    emenu.popup({\r\n      x       : x,\r\n      y       : y,\r\n      callback: () => {\r\n\r\n        if (this._menu) {\r\n          this._menu.onclose();\r\n        }\r\n      }\r\n    })\r\n  };\r\n}\r\n\r\nlet on_tick = () => {\r\n  let nativeTheme = getNativeTheme();\r\n\r\n  if (nativeTheme) {\r\n    let mode = nativeTheme.shouldUseDarkColors ? \"dark\" : \"light\";\r\n\r\n    if (mode !== cconst.colorSchemeType) {\r\n      nativeTheme.themeSource = cconst.colorSchemeType;\r\n    }\r\n  }\r\n}\r\n\r\nexport function checkInit() {\r\n  if (window.haveElectron && !_init) {\r\n    _init = true;\r\n\r\n\r\n    patchDropBox();\r\n    setInterval(on_tick, 350);\r\n  }\r\n}\r\n\r\nexport let iconcache = {};\r\n\r\nfunction makeIconKey(icon, iconsheet, invertColors) {\r\n  return \"\" + icon + \":\" + iconsheet + \":\" + invertColors;\r\n}\r\n\r\nexport function getNativeIcon(icon, iconsheet = 0, invertColors = false, size = 16) {\r\n  //let key = makeIconKey(icon, iconsheet, invertColors);\r\n  //if (key in iconcache) {\r\n  //  return iconcache[key];\r\n  //}\r\n\r\n  let icongen;\r\n\r\n  try {\r\n    icongen = myRequire(\"./icogen.js\");\r\n  } catch (error) {\r\n    icongen = myRequire(\"./icogen.cjs\");\r\n  }\r\n\r\n\r\n  window.icongen = icongen;\r\n  let nativeImage = getElectron().nativeImage;\r\n\r\n  let manager = getIconManager();\r\n  let sheet = manager.findSheet(iconsheet);\r\n  let images = [];\r\n\r\n  let sizes = icongen.GetRequiredICOImageSizes();\r\n\r\n  //for (let size of sizes) {\r\n  if (1) {\r\n    let iconsheet = manager.findClosestSheet(size);\r\n    let tilesize = manager.getTileSize(iconsheet);\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = canvas.height = size;\r\n\r\n    if (invertColors) {\r\n      g.filter = \"invert(100%)\";\r\n    }\r\n\r\n    let scale = size/tilesize;\r\n    g.scale(scale, scale);\r\n\r\n    manager.canvasDraw({getDPI: () => 1.0}, canvas, g, icon, 0, 0, iconsheet);\r\n\r\n    let header = \"data:image/png;base64,\";\r\n    let data = canvas.toDataURL();\r\n\r\n    data = data.slice(header.length, data.length);\r\n    data = Buffer.from(data, \"base64\");\r\n\r\n    myRequire(\"fs\").writeFileSync(\"./myicon2.png\", data);\r\n\r\n    images.push(data);\r\n  }\r\n  //}\r\n\r\n  //let ico = icongen.GenerateICO(images);\r\n  //icon = nativeImage.createFromBuffer(ico);\r\n  //icon = nativeImage.createFromBitmap(ico);\r\n  //myRequire(\"fs\").writeFileSync(\"myicon2.ico\", ico);\r\n  return \"myicon2.png\"\r\n  return icon;\r\n  return undefined\r\n\r\n  window._icon = icon;\r\n  return icon;\r\n}\r\n\r\nlet map = {\r\n  CTRL   : \"Control\",\r\n  ALT    : \"Alt\",\r\n  SHIFT  : \"Shift\",\r\n  COMMAND: \"Command\"\r\n};\r\n\r\nexport function buildElectronHotkey(hk) {\r\n  hk = hk.trim().replace(/[ \\t-]+/g, \"+\");\r\n  for (let k in map) {\r\n    hk = hk.replace(k, map[k]);\r\n  }\r\n\r\n  return hk;\r\n}\r\n\r\nexport function buildElectronMenu(menu) {\r\n  let electron = getElectron().remote;\r\n\r\n  initElectronIpc();\r\n\r\n  //let ElectronMenu = electron.Menu;\r\n  //let ElectronMenuItem = electron.MenuItem;\r\n\r\n  let emenu = new ElectronMenu();\r\n\r\n  let buildItem = (item) => {\r\n    if (item._isMenu) {\r\n      let menu2 = item._menu;\r\n\r\n      return new ElectronMenuItem({\r\n        submenu: buildElectronMenu(item._menu),\r\n        label  : menu2.getAttribute(\"title\")\r\n      });\r\n    }\r\n\r\n\r\n    let hotkey = item.hotkey;\r\n    let icon = item.icon;\r\n    let label = \"\" + item.label;\r\n\r\n    if (hotkey && typeof hotkey !== \"string\") {\r\n      hotkey = buildElectronHotkey(hotkey);\r\n    } else {\r\n      hotkey = \"\" + hotkey;\r\n    }\r\n\r\n    if (icon < 0) {\r\n      icon = undefined;\r\n    }\r\n\r\n    let args = {\r\n      id                 : \"\" + item._id,\r\n      label              : label,\r\n      accelerator        : hotkey,\r\n      icon               : icon ? getNativeIcon(icon) : undefined,\r\n      click              : function () {\r\n        menu.onselect(item._id);\r\n      },\r\n      registerAccelerator: false\r\n    };\r\n\r\n    return new ElectronMenuItem(args);\r\n  }\r\n\r\n  for (let item of menu.items) {\r\n    //buildItem(item);\r\n    emenu.append(buildItem(item));\r\n\r\n  }\r\n\r\n  return emenu;\r\n}\r\n\r\nexport function initMenuBar(menuEditor, override = false) {\r\n  checkInit();\r\n\r\n  if (!window.haveElectron) {\r\n    return;\r\n  }\r\n\r\n  if (_menu_init && !override) {\r\n    return;\r\n  }\r\n\r\n  _menu_init = true;\r\n\r\n  //let win = electron.getCurrentWindow();\r\n\r\n  let menu = new ElectronMenu();\r\n\r\n  let _roles = new Set([\"undo\", \"redo\", \"cut\", \"copy\", \"paste\", \"delete\", \"about\",\r\n                        \"quit\", \"open\", \"save\", \"load\", \"paste\", \"cut\", \"zoom\"]);\r\n  let roles = {};\r\n  for (let k of _roles) {\r\n    roles[k] = k;\r\n  }\r\n\r\n  roles = Object.assign(roles, {\r\n    \"select all\": \"selectAll\",\r\n    \"file\"      : \"fileMenu\",\r\n    \"edit\"      : \"editMenu\",\r\n    \"view\"      : \"viewMenu\",\r\n    \"app\"       : \"appMenu\",\r\n    \"help\"      : \"help\",\r\n    \"zoom in\"   : \"zoomIn\",\r\n    \"zoom out\"  : \"zoomOut\"\r\n  });\r\n\r\n  /*\r\n  let item = new MenuItem({\r\n    label : \"Label\",\r\n    tooltip : \"Tooltip\",\r\n    icon : getNativeIcon(0),\r\n    accelerator : \"Control+Z\",\r\n    checked : true,\r\n    id : 0,\r\n    role : undefined,\r\n    click : (arg) => {\r\n      console.log(\"menu click!\", arg)\r\n    },\r\n    submenu : undefined,\r\n    role :  undo, redo, cut, copy, paste, pasteAndMatchStyle, delete, selectAll, reload,\r\n            forceReload, toggleDevTools, resetZoom, zoomIn, zoomOut, togglefullscreen, window,\r\n             minimize, close, help, about, services, hide, hideOthers, unhide, quit, startSpeaking,\r\n             stopSpeaking, close, minimize, zoom, front, appMenu, fileMenu, editMenu, viewMenu, recentDocuments,\r\n              toggleTabBar, selectNextTab, selectPreviousTab, mergeAllWindows, clearRecentDocuments, moveTabToNewWindow\r\n               or windowMenu - Define the action of the menu item, when specified the click property will be ignored.\r\n                See roles.\r\n\r\n  });//*/\r\n\r\n\r\n  let header = menuEditor.header;\r\n  for (let dbox of header.traverse(DropBox)) {\r\n    dbox._build_menu();\r\n    dbox.update();\r\n\r\n    dbox._build_menu();\r\n    let menu2 = dbox._menu;\r\n    menu2.ctx = dbox.ctx;\r\n    menu2._init();\r\n    menu2.update();\r\n\r\n    let title = dbox._genLabel();\r\n    let args = {\r\n      label  : title,\r\n      tooltip: dbox.description,\r\n      submenu: buildElectronMenu(menu2)\r\n    };\r\n\r\n    menu.insert(0, new ElectronMenuItem(args));\r\n  }\r\n\r\n\r\n  ElectronMenu.setApplicationMenu(menu);\r\n  //win.setMenu(menu);\r\n}\r\n\r\nimport {PlatformAPI, isMimeText} from '../platform_base.js';\r\n\r\nexport class platform extends PlatformAPI {\r\n  static showOpenDialog(title, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    initElectronIpc();\r\n\r\n    return new Promise((accept, reject) => {\r\n      ipcRenderer.invoke('show-open-dialog', eargs, wrapRemoteCallback(\"open-dialog\", (ret) => {\r\n        if (ret.canceled || ret.cancelled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          accept(ret.filePaths.map(f => new FilePath(f, getFilename(f))));\r\n        }\r\n      }), wrapRemoteCallback(\"show-open-dialog\", (error) => {\r\n        reject(error);\r\n      }));\r\n    });\r\n  }\r\n\r\n  static _sanitizeFilters(filters) {\r\n    let filters2 = [];\r\n\r\n    for (let filter of filters) {\r\n      if (Array.isArray(filter)) {\r\n        let ext = filter[0];\r\n\r\n        filter = {extensions: filter};\r\n\r\n        ext = ext.replace(/\\./g, \"\").trim().toLowerCase();\r\n        if (ext in mimeMap) {\r\n          filter.mime = mimeMap[ext];\r\n        }\r\n\r\n        filter.name = ext;\r\n      }\r\n\r\n      console.log(filter.extensions);\r\n      filter.extensions = filter.extensions.map(f => f.startsWith(\".\") ? f.slice(1, f.length) : f);\r\n\r\n      filters2.push(filter);\r\n    }\r\n\r\n    return filters2;\r\n  }\r\n\r\n  static showSaveDialog(title, filedata_cb, args = new FileDialogArgs()) {\r\n    console.log(args.filters);\r\n\r\n    let eargs = {\r\n      defaultPath: args.defaultPath,\r\n      filters    : this._sanitizeFilters(args.filters ?? []),\r\n      properties : [\r\n        \"openFile\", \"showHiddenFiles\", \"createDirectory\"\r\n      ]\r\n    }\r\n\r\n    if (args.multi) {\r\n      eargs.properties.push(\"multiSelections\");\r\n    }\r\n\r\n    if (!args.addToRecentList) {\r\n      eargs.properties.push(\"dontAddToRecent\");\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      initElectronIpc();\r\n\r\n      let onthen = (ret) => {\r\n        if (ret.canceled) {\r\n          reject(\"cancel\");\r\n        } else {\r\n          let path = ret.filePath;\r\n          let filedata = filedata_cb();\r\n\r\n          if (filedata instanceof ArrayBuffer) {\r\n            filedata = new Uint8Array(filedata);\r\n          }\r\n\r\n          require('fs').writeFileSync(path, filedata);\r\n          console.log(\"saved file\", filedata);\r\n\r\n          accept(new FilePath(path, getFilename(path)));\r\n        }\r\n      }\r\n\r\n      let oncatch = (error) => {\r\n        reject(error);\r\n      }\r\n\r\n      ipcRenderer.invoke('show-save-dialog', eargs, wrapRemoteCallback('dialog', onthen), wrapRemoteCallback('dialog', oncatch));\r\n\r\n    });\r\n  }\r\n\r\n  static readFile(path, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      if (isMimeText(mime)) {\r\n        accept(fs.readFileSync(path.data, \"utf8\"));\r\n      } else {\r\n        accept(fs.readFileSync(path.data).buffer);\r\n      }\r\n    });\r\n  }\r\n\r\n  static writeFile(data, handle, mime) {\r\n    return new Promise((accept, reject) => {\r\n      let fs = require('fs');\r\n\r\n      fs.writeFileSync(handle.data, data);\r\n      accept(handle);\r\n    });\r\n  }\r\n}\r\n", "import './polyfill.js';\r\nimport './struct.js';\r\nimport './mobile-detect.cjs';\r\nimport nstructjs from './struct.js';\r\n\r\nlet f64tmp = new Float64Array(1);\r\nlet u16tmp = new Uint16Array(f64tmp.buffer);\r\n\r\nexport function isDenormal(f) {\r\n  f64tmp[0] = f;\r\n\r\n  let a = u16tmp[0], b = u16tmp[1], c = u16tmp[2], d = u16tmp[3];\r\n\r\n  //zero? check both positive and negative zero\r\n  if (a === 0 && b === 0 && c === 0 && (d === 0 || d === 32768)) {\r\n    return false;\r\n  }\r\n\r\n  let test = d & ~(1<<15);\r\n  test = test>>4;\r\n\r\n  //window.console.log(u16tmp[0], u16tmp[1], u16tmp[2], u16tmp[3], \"|\", test);\r\n\r\n  return test === 0;\r\n}\r\n\r\nglobalThis._isDenormal = isDenormal;\r\n\r\n\r\nlet colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"teal\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"gray\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n}\r\n\r\nexport let termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nexport function termColor(s, c, d = 0) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c]\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\"\r\n    return s2 + s + '\\u001b[39m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[39m';\r\n};\r\n\r\nexport function termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/\r\n  let re2 = /\\u001b\\[39m/;\r\n\r\n  let endtag = '\\u001b[39m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini + minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nglobalThis.termColor = termColor;\r\n\r\nexport class MovingAvg extends Array {\r\n  constructor(size = 64) {\r\n    super();\r\n\r\n    this.length = size;\r\n    this.cur = 0;\r\n    this.used = 0;\r\n    this.sum = 0;\r\n  }\r\n\r\n  reset() {\r\n    this.cur = this.used = this.sum = 0.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  add(val) {\r\n    if (this.used < this.length) {\r\n      this[this.cur] = val;\r\n      this.used++;\r\n    } else {\r\n      this.sum -= this[this.cur];\r\n      this[this.cur] = val;\r\n    }\r\n\r\n    this.sum += val;\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return this.sample();\r\n  }\r\n\r\n  sample() {\r\n    return this.used ? this.sum/this.used : 0.0;\r\n  }\r\n}\r\n\r\nexport let timers = {};\r\n\r\nexport function pollTimer(id, interval) {\r\n  if (!(id in timers)) {\r\n    timers[id] = time_ms();\r\n  }\r\n\r\n  if (time_ms() - timers[id] >= interval) {\r\n    timers[id] = time_ms();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nlet mdetect = undefined;\r\nlet mret = undefined;\r\n\r\nexport function isMobile() {\r\n  if (!window.MobileDetect) {\r\n    return;\r\n  }\r\n\r\n  if (mret === undefined) {\r\n    mdetect = new MobileDetect(navigator.userAgent);\r\n    let ret = mdetect.mobile();\r\n\r\n    if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase();\r\n    }\r\n\r\n    mret = ret;\r\n  }\r\n\r\n  return mret;\r\n}\r\n\r\nexport class SmartConsoleContext {\r\n  constructor(name, console) {\r\n    this.name = name;\r\n\r\n    let c = [random(), random(), random()];\r\n    let sum = Math.sqrt(c[0]*c[0] + c[1]*c[1] + c[2]*c[2]);\r\n    sum = 255/sum;\r\n\r\n    let r = ~~(c[0]*sum);\r\n    let g = ~~(c[1]*sum);\r\n    let b = ~~(c[2]*sum);\r\n\r\n    this.color = `rgb(${r},${g},${b})`;\r\n    this.__console = console;\r\n\r\n    //minimum time between prints of same message\r\n    this.timeInterval = 375;\r\n\r\n    //minimum time in general\r\n    this.timeIntervalAll = 245;\r\n\r\n    this._last = 0;\r\n    this.last = 0;\r\n    this.last2 = 0;\r\n    this._data = {};\r\n    this._data_length = 0;\r\n    this.maxCache = 256;\r\n  }\r\n\r\n\r\n  hash(args) {\r\n    let sum = 0;\r\n    let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n    let i = 0;\r\n\r\n    function dohash(h) {\r\n      h = (h*mul + off + i*mul*0.25) & mul;\r\n\r\n      i++;\r\n      sum = sum ^ h;\r\n    }\r\n\r\n    let visit = new WeakSet();\r\n\r\n    let recurse = (n) => {\r\n      if (typeof n === \"string\") {\r\n        dohash(strhash(n));\r\n      } else if (typeof n === \"undefined\" || n === null) {\r\n        dohash(0);\r\n      } else if (typeof n === \"object\") {\r\n        if (visit.has(n)) {\r\n          return;\r\n        }\r\n\r\n        visit.add(n);\r\n\r\n        let keys = getAllKeys(n);\r\n\r\n        for (let k of keys) {\r\n          let v;\r\n\r\n          if (typeof k !== \"string\") {\r\n            continue;\r\n          }\r\n\r\n          try {\r\n            v = n[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          recurse(v);\r\n        }\r\n      } else if (typeof n === \"function\") {\r\n        dohash(strhash(\"\" + n.name));\r\n      }\r\n    };\r\n\r\n    //let str = \"\";\r\n\r\n    for (let i = 0; i < args.length; i++) {\r\n      recurse(args[i]);\r\n      //str += args[i] + \" \";\r\n    }\r\n\r\n    //window.console.log(\"HASH\", sum, str);\r\n    return sum;\r\n  }\r\n\r\n  clearCache() {\r\n    this._data_length = 0;\r\n    this._data = {};\r\n    return this;\r\n  }\r\n\r\n  _getData(args) {\r\n    let key = this.hash(args);\r\n\r\n    if (!(key in this._data)) {\r\n      if (this._data_length > this.maxCache) {\r\n        this.clearCache();\r\n      }\r\n\r\n      this._data[key] = {\r\n        time : 0,\r\n        count: 0\r\n      };\r\n\r\n      this._data_length++;\r\n    }\r\n\r\n    return this._data[key];\r\n  }\r\n\r\n  _check(args) {\r\n    if (this.timeIntervalAll > 0 && time_ms() - this.last2 < this.timeIntervalAll) {\r\n      return false;\r\n    }\r\n\r\n    this.last2 = time_ms();\r\n\r\n    return true;\r\n    /*\r\n    this.last2 = time_ms();\r\n\r\n    let d = this._getData(args);\r\n    let last = this.last;\r\n\r\n    this.last = d;\r\n\r\n    if (d !== last) {\r\n      d.count = 0;\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    if (time_ms() - d.time > this.timeInterval) {\r\n      d.time = time_ms();\r\n      return true;\r\n    }\r\n\r\n    return false;*/\r\n  }\r\n\r\n  log() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\", \"color:\" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  warn() {\r\n    if (this._check(arguments)) {\r\n      window.console.log(\"%c\" + this.name, \"color : \" + this.color, ...arguments);\r\n    }\r\n  }\r\n\r\n  trace() {\r\n    if (this._check(arguments)) {\r\n      window.console.trace(...arguments);\r\n    }\r\n  }\r\n\r\n  error() {\r\n    if (this._check(arguments)) {\r\n      window.console.error(...arguments);\r\n    }\r\n  }\r\n}\r\n\r\nexport class SmartConsole {\r\n  constructor() {\r\n    this.contexts = {};\r\n  }\r\n\r\n  context(name) {\r\n    if (!(name in this.contexts)) {\r\n      this.contexts[name] = new SmartConsoleContext(name, this);\r\n    }\r\n\r\n    return this.contexts[name];\r\n  }\r\n\r\n  log() {\r\n    let c = this.context(\"default\");\r\n    return c.log(...arguments);\r\n  }\r\n\r\n  warn() {\r\n    let c = this.context(\"default\");\r\n    return c.warn(...arguments);\r\n  }\r\n\r\n  trace() {\r\n    let c = this.context(\"default\");\r\n    return c.trace(...arguments);\r\n  }\r\n\r\n  error() {\r\n    let c = this.context(\"default\");\r\n    return c.error(...arguments);\r\n  }\r\n}\r\n\r\nexport const console = new SmartConsole();\r\n\r\nglobalThis.tm = 0.0;\r\n\r\nlet EmptySlot = {};\r\n\r\nexport function getClassParent(cls) {\r\n  let p = cls.prototype;\r\n\r\n  if (p) p = p.__proto__;\r\n  if (p) p = p.constructor\r\n  ;\r\n  return p;\r\n}\r\n\r\n//make global for debugging purposes in console\r\n//window._getClassParent = getClassParent;\r\n\r\nexport function list(iterable) {\r\n  let ret = [];\r\n\r\n  for (let item of iterable) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\n/** Count items in list; if searchItem is not undefined then a count\r\n *  of the number of times searchItem occurs will be returned.*/\r\nexport function count(iterable, searchItem = undefined) {\r\n  let count = 0;\r\n\r\n  if (searchItem !== undefined) {\r\n    for (let item of iterable) {\r\n      if (item === searchItem) {\r\n        count++;\r\n      }\r\n    }\r\n  } else {\r\n    for (let item of iterable) {\r\n      count++;\r\n    }\r\n  }\r\n\r\n  return count;\r\n}\r\n\r\n/*\r\n* returns all object keys, including\r\n* inherited ones\r\n* */\r\nexport function getAllKeys(obj) {\r\n  let keys = new Set();\r\n\r\n  if (typeof obj !== \"object\" && typeof obj !== \"function\") {\r\n    throw new Error(\"must pass an object ot getAllKeys; object was: \" + obj);\r\n  }\r\n\r\n  let p;\r\n\r\n  while (p && p !== Object) {\r\n    for (let k in Object.getOwnPropertyDescriptors(obj)) {\r\n      if (k === \"__proto__\")\r\n        continue;\r\n\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k of Object.getOwnPropertySymbols(obj)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    p = p.__proto__;\r\n  }\r\n\r\n  let cls = obj.constructor;\r\n  if (!cls)\r\n    return keys;\r\n\r\n  while (cls) {\r\n    let proto = cls.prototype;\r\n    if (!proto) {\r\n      cls = getClassParent(cls);\r\n      continue;\r\n    }\r\n\r\n    for (let k in proto) {\r\n      keys.add(k);\r\n    }\r\n\r\n    for (let k in Object.getOwnPropertyDescriptors(proto)) {\r\n      keys.add(k);\r\n    }\r\n\r\n    cls = getClassParent(cls);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\n//globalThis._getAllKeys = getAllKeys;\r\n\r\nexport function btoa(buf) {\r\n  if (buf instanceof ArrayBuffer) {\r\n    buf = new Uint8Array(buf);\r\n  }\r\n\r\n  if (typeof buf === \"string\" || buf instanceof String) {\r\n    return window.btoa(buf);\r\n  }\r\n\r\n  let ret = \"\";\r\n  for (let i = 0; i < buf.length; i++) {\r\n    ret += String.fromCharCode(buf[i]);\r\n  }\r\n\r\n  return btoa(ret);\r\n};\r\n\r\nexport function formatNumberUI(val, isInt = false, decimals = 5) {\r\n  if (val === undefined || val === null) {\r\n    val = \"0\";\r\n  } else if (isNaN(val)) {\r\n    val = \"NaN\";\r\n  } else if (val === -Infinity) {\r\n    val = \"-\" + String.fromCharCode(0x221E);\r\n  } else if (val === Infinity) {\r\n    val = \"+\" + String.fromCharCode(0x221E);\r\n  } else if (!isInt) {\r\n    val = val.toFixed(decimals);\r\n  } else {\r\n    val = \"\" + Math.floor(val);\r\n  }\r\n\r\n  return val;\r\n}\r\n\r\n//window.formatNumberUI = formatNumberUI;\r\n\r\nexport function atob(buf) {\r\n  let data = window.atob(buf);\r\n  let ret = [];\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    ret.push(data.charCodeAt(i));\r\n  }\r\n\r\n  return new Uint8Array(ret);\r\n}\r\n\r\nexport function time_ms() {\r\n  if (window.performance)\r\n    return window.performance.now();\r\n  else\r\n    return new Date().getMilliseconds();\r\n}\r\n\r\nexport function color2css(c) {\r\n  let ret = c.length === 3 ? \"rgb(\" : \"rgba(\";\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    if (i > 0)\r\n      ret += \",\";\r\n\r\n    ret += ~~(c[i]*255);\r\n  }\r\n\r\n  if (c.length === 4)\r\n    ret += \",\" + c[3];\r\n  ret += \")\";\r\n\r\n  return ret;\r\n}\r\n\r\nexport function merge(obja, objb) {\r\n  return Object.assign({}, obja, objb);\r\n  /*\r\n  let ret = {};\r\n\r\n  for (let k in obja) {\r\n    ret[k] = obja[k];\r\n  }\r\n\r\n  for (let k in objb) {\r\n    ret[k] = objb[k];\r\n  }\r\n\r\n  return ret;\r\n  //*/\r\n};\r\n\r\nconst debug_cacherings = false;\r\n\r\nif (debug_cacherings) {\r\n  window._cacherings = [];\r\n\r\n  window._clear_all_cacherings = function (kill_all = false) {\r\n    function copy(obj) {\r\n      if (typeof obj.copy === \"function\") {\r\n        return obj.copy();\r\n      } else if (obj.constructor === Object) {\r\n        let ret = {};\r\n\r\n        for (let k of Reflect.ownKeys(obj)) {\r\n          let v;\r\n\r\n          try {\r\n            v = obj[k];\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n\r\n          if (typeof v !== \"object\") {\r\n            ret[k] = v;\r\n          } else {\r\n            ret[k] = copy(v);\r\n          }\r\n        }\r\n\r\n        return ret;\r\n      } else {\r\n        return new obj.constructor();\r\n      }\r\n    }\r\n\r\n    for (let ch of window._cacherings) {\r\n      let obj = ch[0];\r\n      let len = ch.length;\r\n\r\n      ch.length = 0;\r\n      ch.cur = 0;\r\n\r\n      if (kill_all) {\r\n        continue;\r\n      }\r\n\r\n      for (let i = 0; i < len; i++) {\r\n        ch.push(copy(obj));\r\n      }\r\n    }\r\n  }\r\n\r\n  window._nonvector_cacherings = function () {\r\n    for (let ch of window._cacherings) {\r\n      if (ch.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      let name = ch[0].constructor.name;\r\n      let ok = !name.startsWith(\"Vector\") && !name.startsWith(\"Quat\");\r\n      ok = ok && !name.startsWith(\"TriEditor\");\r\n      ok = ok && !name.startsWith(\"QuadEditor\");\r\n      ok = ok && !name.startsWith(\"PointEditor\");\r\n      ok = ok && !name.startsWith(\"LineEditor\");\r\n\r\n      if (ok) {\r\n        console.log(name, ch);\r\n      }\r\n    }\r\n  }\r\n\r\n  window._stale_cacherings = function () {\r\n    let ret = _cacherings.concat([]);\r\n\r\n    ret.sort((a, b) => a.gen - b.gen);\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class cachering extends Array {\r\n  constructor(func, size, isprivate = false) {\r\n    super()\r\n\r\n    this.private = isprivate;\r\n    this.cur = 0;\r\n\r\n    if (!isprivate && debug_cacherings) {\r\n      this.gen = 0;\r\n      window._cacherings.push(this);\r\n    }\r\n\r\n    for (let i = 0; i < size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size, isprivate = false) {\r\n    let func = function () {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size, isprivate);\r\n  }\r\n\r\n  next() {\r\n    if (debug_cacherings) {\r\n      this.gen++;\r\n    }\r\n\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class SetIter {\r\n  constructor(set) {\r\n    this.set = set;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n\r\n    while (this.i < this.set.items.length && this.set.items[this.i] === EmptySlot) {\r\n      this.i++;\r\n    }\r\n\r\n    if (this.i >= this.set.items.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      return ret;\r\n    }\r\n\r\n\r\n    ret.value = this.set.items[this.i++];\r\n    return ret;\r\n  }\r\n}\r\n\r\n/**\r\n Set\r\n\r\n Stores objects in a set; each object is converted to a value via\r\n a [Symbol.keystr] method, and if that value already exists in the set\r\n then the object is not added.\r\n\r\n\r\n * */\r\nexport class set {\r\n  constructor(input) {\r\n    this.items = [];\r\n    this.keys = {};\r\n    this.freelist = [];\r\n\r\n    this.length = 0;\r\n\r\n    if (typeof input === \"string\") {\r\n      input = new String(input);\r\n    }\r\n\r\n    if (input !== undefined) {\r\n      if (Symbol.iterator in input) {\r\n        for (let item of input) {\r\n          this.add(item);\r\n        }\r\n      } else if (\"forEach\" in input) {\r\n        input.forEach(function (item) {\r\n          this.add(item);\r\n        }, this);\r\n      } else if (input instanceof Array) {\r\n        for (let i = 0; i < input.length; i++) {\r\n          this.add(input[i]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get size() {\r\n    return this.length;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new SetIter(this);\r\n  }\r\n\r\n  equals(setb) {\r\n    for (let item of this) {\r\n      if (!setb.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let item of setb) {\r\n      if (!this.has(item)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    this.items.length = 0;\r\n    this.keys = {};\r\n    this.freelist.length = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  filter(f, thisvar) {\r\n    let i = 0;\r\n    let ret = new set();\r\n\r\n    for (let item of this) {\r\n      if (f.call(thisvar, item, i++, this)) {\r\n        ret.add(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n\r\n  }\r\n\r\n  map(f, thisvar) {\r\n    let ret = new set();\r\n\r\n    let i = 0;\r\n\r\n    for (let item of this) {\r\n      ret.add(f.call(thisvar, item, i++, this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  reduce(f, initial) {\r\n    if (initial === undefined) {\r\n      for (let item of this) {\r\n        initial = item;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n    for (let item of this) {\r\n      initial = f(initial, item, i++, this);\r\n    }\r\n\r\n    return initial;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new set();\r\n    for (let item of this) {\r\n      ret.add(item);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(item) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (key in this.keys) return;\r\n\r\n    if (this.freelist.length > 0) {\r\n      let i = this.freelist.pop();\r\n\r\n      this.keys[key] = i;\r\n      this.items[i] = item;\r\n    } else {\r\n      let i = this.items.length;\r\n\r\n      this.keys[key] = i;\r\n      this.items.push(item);\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  delete(item, ignore_existence = true) {\r\n    this.remove(item, ignore_existence);\r\n  }\r\n\r\n  remove(item, ignore_existence) {\r\n    let key = item[Symbol.keystr]();\r\n\r\n    if (!(key in this.keys)) {\r\n      if (!ignore_existence) {\r\n        console.warn(\"Warning, item\", item, \"is not in set\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    let i = this.keys[key];\r\n    this.freelist.push(i);\r\n    this.items[i] = EmptySlot;\r\n\r\n    delete this.keys[key];\r\n\r\n    this.length--;\r\n  }\r\n\r\n  has(item) {\r\n    return item[Symbol.keystr]() in this.keys;\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let i = 0; i < this.items.length; i++) {\r\n      let item = this.items[i];\r\n\r\n      if (item === EmptySlot)\r\n        continue;\r\n\r\n      thisvar !== undefined ? func.call(thisvar, item) : func(item);\r\n    }\r\n  }\r\n}\r\n\r\nexport class HashIter {\r\n  constructor(hash) {\r\n    this.hash = hash;\r\n    this.i = 0;\r\n    this.ret = {done: false, value: undefined};\r\n  }\r\n\r\n  next() {\r\n    let items = this.hash._items;\r\n\r\n    if (this.i >= items.length) {\r\n      this.ret.done = true;\r\n      this.ret.value = undefined;\r\n\r\n      return this.ret;\r\n    }\r\n\r\n    do {\r\n      this.i += 2;\r\n    } while (this.i < items.length && items[i] === _hash_null);\r\n\r\n    return this.ret;\r\n  }\r\n}\r\n\r\nlet _hash_null = {};\r\n\r\nexport class hashtable {\r\n  constructor() {\r\n    this._items = [];\r\n    this._keys = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return new HashIter(this);\r\n  }\r\n\r\n  set(key, val) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    let i;\r\n    if (!(key2 in this._keys)) {\r\n      i = this._items.length;\r\n\r\n      try {\r\n        this._items.push(0);\r\n        this._items.push(0);\r\n      } catch (error) {\r\n        console.log(\":::\", this._items.length, key, key2, val)\r\n        throw error;\r\n      }\r\n\r\n      this._keys[key2] = i;\r\n      this.length++;\r\n    } else {\r\n      i = this._keys[key2];\r\n    }\r\n\r\n    this._items[i] = key;\r\n    this._items[i + 1] = val;\r\n  }\r\n\r\n  remove(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, key not in hashtable:\", key, key2);\r\n      return;\r\n    }\r\n\r\n    let i = this._keys[key2];\r\n\r\n    this._items[i] = _hash_null;\r\n    this._items[i + 1] = _hash_null;\r\n\r\n    delete this._keys[key2];\r\n    this.length--;\r\n  }\r\n\r\n  has(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    return key2 in this._keys;\r\n  }\r\n\r\n  get(key) {\r\n    let key2 = key[Symbol.keystr]();\r\n\r\n    if (!(key2 in this._keys)) {\r\n      console.warn(\"Warning, item not in hash\", key, key2);\r\n      return undefined;\r\n    }\r\n\r\n    return this._items[this._keys[key2] + 1];\r\n  }\r\n\r\n  add(key, val) {\r\n    return this.set(key, val);\r\n  }\r\n\r\n  keys() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let key = this._items[i];\r\n\r\n      if (key !== _hash_null) {\r\n        ret.push(key);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  values() {\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < this._items.length; i += 2) {\r\n      let item = this._items[i + 1];\r\n\r\n      if (item !== _hash_null) {\r\n        ret.push(item);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  forEach(cb, thisvar) {\r\n    if (thisvar === undefined)\r\n      thisvar = self;\r\n\r\n    for (let k in this._keys) {\r\n      let i = this._keys[k];\r\n\r\n      cb.call(thisvar, k, this._items[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet IDGenInternalIDGen = 0;\r\n\r\nexport class IDGen {\r\n  constructor() {\r\n    this.__cur = 1;\r\n\r\n    this._debug = false;\r\n    this._internalID = IDGenInternalIDGen++;\r\n  }\r\n\r\n  /*\r\n  get _cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    if (this._debug && pollTimer(\"_idgen_debug\", 450)) {\r\n      window.console.warn(\"_cur access\", v);\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  // */\r\n\r\n  get cur() {\r\n    return this.__cur;\r\n  }\r\n\r\n  set cur(v) {\r\n    if (isNaN(v) || !isFinite(v)) {\r\n      throw new Error(\"NaN error in util.IDGen\");\r\n    }\r\n\r\n    this.__cur = v;\r\n  }\r\n\r\n  get _cur() {\r\n    return this.cur;\r\n  }\r\n\r\n  set _cur(v) {\r\n    window.console.warn(\"Deprecated use of IDGen._cur\");\r\n    this.cur = v;\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new IDGen();\r\n\r\n    ret.cur = obj.cur === undefined ? obj._cur : obj.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  next() {\r\n    return this.cur++;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new IDGen();\r\n    ret.cur = this.cur;\r\n\r\n    return ret;\r\n  }\r\n\r\n  max_cur(id) {\r\n    this.cur = Math.max(this.cur, id + 1);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      cur: this.cur\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nIDGen.STRUCT = `\r\nIDGen {\r\n  cur : int;\r\n}\r\n`;\r\nnstructjs.register(IDGen);\r\n\r\n\r\nfunction get_callstack(err) {\r\n  return (\"\" + err.stack).split(\"\\n\");\r\n}\r\n\r\nexport function print_stack(err) {\r\n  if (!err) {\r\n    window.console.trace();\r\n  } else {\r\n    window.console.log(err.stack);\r\n  }\r\n}\r\n\r\n\r\nglobalThis.get_callstack = get_callstack;\r\nglobalThis.print_stack = print_stack;\r\n\r\nexport function fetch_file(path) {\r\n  let url = location.origin + \"/\" + path\r\n\r\n  let req = new XMLHttpRequest(\r\n  );\r\n\r\n  return new Promise(function (accept, reject) {\r\n    req.open(\"GET\", url)\r\n    req.onreadystatechange = function (e) {\r\n      if (req.status === 200 && req.readyState === 4) {\r\n        accept(req.response);\r\n      } else if (req.status >= 400) {\r\n        reject(req.status, req.statusText);\r\n      }\r\n    }\r\n    req.send();\r\n  });\r\n}\r\n\r\n//from:https://en.wikipedia.org/wiki/Mersenne_Twister\r\nfunction _int32(x) {\r\n  // Get the 31 least significant bits.\r\n  return ~~(((1<<30) - 1) & (~~x))\r\n}\r\n\r\nexport class MersenneRandom {\r\n  constructor(seed) {\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt = new Uint32Array(624);\r\n\r\n    this.seed(seed);\r\n  }\r\n\r\n  random() {\r\n    return this.extract_number()/(1<<30);\r\n  }\r\n\r\n  /** normal-ish distribution */\r\n  nrandom(n = 3) {\r\n    let ret = 0.0;\r\n\r\n    for (let i = 0; i < n; i++) {\r\n      ret += this.random();\r\n    }\r\n\r\n    return ret/n;\r\n  }\r\n\r\n  seed(seed) {\r\n    seed = ~~(seed*8192);\r\n\r\n    // Initialize the index to 0\r\n    this.index = 624;\r\n    this.mt.fill(0, 0, this.mt.length);\r\n\r\n    this.mt[0] = seed;  // Initialize the initial state to the seed\r\n\r\n    for (let i = 1; i < 624; i++) {\r\n      this.mt[i] = _int32(\r\n        1812433253*(this.mt[i - 1] ^ this.mt[i - 1]>>30) + i);\r\n    }\r\n  }\r\n\r\n  extract_number() {\r\n    if (this.index >= 624)\r\n      this.twist();\r\n\r\n    let y = this.mt[this.index];\r\n\r\n    // Right shift by 11 bits\r\n    y = y ^ y>>11;\r\n    // Shift y left by 7 and take the bitwise and of 2636928640\r\n    y = y ^ y<<7 & 2636928640;\r\n    // Shift y left by 15 and take the bitwise and of y and 4022730752\r\n    y = y ^ y<<15 & 4022730752;\r\n    // Right shift by 18 bits\r\n    y = y ^ y>>18;\r\n\r\n    this.index = this.index + 1;\r\n\r\n    return _int32(y);\r\n  }\r\n\r\n  twist() {\r\n    for (let i = 0; i < 624; i++) {\r\n      // Get the most significant bit and add it to the less significant\r\n      // bits of the next number\r\n      let y = _int32((this.mt[i] & 0x80000000) +\r\n        (this.mt[(i + 1)%624] & 0x7fffffff));\r\n      this.mt[i] = this.mt[(i + 397)%624] ^ y>>1;\r\n\r\n      if (y%2 !== 0)\r\n        this.mt[i] = this.mt[i] ^ 0x9908b0df;\r\n    }\r\n\r\n    this.index = 0;\r\n  }\r\n}\r\n\r\nlet _mt = new MersenneRandom(0);\r\n\r\nexport function random() {\r\n  return _mt.extract_number()/(1<<30);\r\n}\r\n\r\nexport function seed(n) {\r\n//  console.trace(\"seed called\");\r\n  _mt.seed(n);\r\n}\r\n\r\nlet smallstr_hashes = {};\r\n\r\n\r\nconst MAXINT = Math.pow(2, 31) - 1;\r\n\r\nexport function strhash(str) {\r\n  if (str.length <= 64) {\r\n    let hash = smallstr_hashes[str];\r\n\r\n    if (hash !== undefined) {\r\n      return hash;\r\n    }\r\n  }\r\n\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < str.length; i++) {\r\n    let ch = str.charCodeAt(i);\r\n\r\n    hash = hash < 0 ? -hash : hash;\r\n\r\n    hash ^= (ch*1103515245 + 12345) & MAXINT;\r\n  }\r\n\r\n  if (str.length <= 64) {\r\n    smallstr_hashes[str] = hash;\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\nlet hashsizes = [\r\n  /*2, 5, 11, 19, 37, 67, 127, */223, 383, 653, 1117, 1901, 3251,\r\n                                 5527, 9397, 15991, 27191, 46229, 78593, 133631, 227177, 38619,\r\n                                 656587, 1116209, 1897561, 3225883, 5484019, 9322861, 15848867,\r\n                                 26943089, 45803279, 77865577, 132371489, 225031553\r\n];\r\n\r\nlet FTAKEN = 0, FKEY = 1, FVAL = 2, FTOT = 3;\r\n\r\nexport class FastHash extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cursize = 0;\r\n    this.size = hashsizes[this.cursize];\r\n    this.used = 0;\r\n\r\n    this.length = this.size*FTOT;\r\n    this.fill(0, 0, this.length);\r\n  }\r\n\r\n  resize(size) {\r\n    let table = this.slice(0, this.length);\r\n\r\n    this.length = size*FTOT;\r\n    this.size = size;\r\n    this.fill(0, 0, this.length);\r\n\r\n    for (let i = 0; i < table.length; i += FTOT) {\r\n      if (!table[i + FTAKEN]) continue;\r\n\r\n      let key = table[i + FKEY], val = table[i + FVAL];\r\n      this.set(key, val);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  get(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return this[h*FTOT + FVAL];\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  has(key) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        return true;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  set(key, val) {\r\n    let hash = typeof key === \"string\" ? strhash(key) : key;\r\n    hash = typeof hash === \"object\" ? hash.valueOf() : hash;\r\n\r\n    if (this.used > this.size/3) {\r\n      this.resize(hashsizes[this.cursize++]);\r\n    }\r\n\r\n    let probe = 0;\r\n\r\n    let h = (hash + probe)%this.size;\r\n\r\n    let _i = 0;\r\n    while (_i++ < 50000 && this[h*FTOT + FTAKEN]) {\r\n      if (this[h*FTOT + FKEY] === key) {\r\n        this[h*FTOT + FVAL] = val;\r\n        return;\r\n      }\r\n\r\n      probe = (probe + 1)*2;\r\n      h = (hash + probe)%this.size;\r\n    }\r\n\r\n    this[h*FTOT + FTAKEN] = 1;\r\n    this[h*FTOT + FKEY] = key;\r\n    this[h*FTOT + FVAL] = val;\r\n\r\n    this.used++;\r\n  }\r\n}\r\n\r\nexport function test_fasthash() {\r\n  let h = new FastHash();\r\n  console.log(\"bleh hash:\", strhash(\"bleh\"));\r\n\r\n  h.set(\"bleh\", 1);\r\n  h.set(\"bleh\", 2);\r\n  h.set(\"bleh\", 3);\r\n\r\n  console.log(h);\r\n\r\n  return h;\r\n};\r\n\r\nexport class ImageReader {\r\n  load_image() {\r\n    let input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n\r\n    let doaccept;\r\n\r\n    let promise = new Promise((accept, reject) => {\r\n      doaccept = accept;\r\n    });\r\n\r\n    input.addEventListener(\"change\", function (e) {\r\n      let files = this.files;\r\n      console.log(\"got file\", e, files)\r\n\r\n      if (files.length === 0) return;\r\n\r\n      let reader = new FileReader();\r\n      let this2 = this;\r\n\r\n      reader.onload = (e) => {\r\n        let data = e.target.result;\r\n        let image = new Image();\r\n\r\n        image.src = data;\r\n        image.onload = (e) => {\r\n          console.log(\"got image\", image.width, image.height);\r\n\r\n          let canvas = document.createElement(\"canvas\");\r\n          let g = canvas.getContext(\"2d\");\r\n\r\n          canvas.width = image.width;\r\n          canvas.height = image.height;\r\n\r\n          g.drawImage(image, 0, 0);\r\n          let idata = g.getImageData(0, 0, image.width, image.height);\r\n\r\n          doaccept(idata);\r\n        }\r\n      };\r\n\r\n      reader.readAsDataURL(files[0]);\r\n    });\r\n\r\n    input.click();\r\n    return promise;\r\n  }\r\n\r\n  example() {\r\n    this.load_image().then((idata) => {\r\n      console.log(idata);\r\n    });\r\n  }\r\n};\r\n\r\nlet digestcache;\r\n\r\n/** NOT CRYPTOGRAPHIC */\r\nexport class HashDigest {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n  }\r\n\r\n  static cachedDigest() {\r\n    return digestcache.next().reset();\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.hash = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  get() {\r\n    return this.hash;\r\n  }\r\n\r\n  add(v) {\r\n    if (typeof v === \"string\") {\r\n      v = strhash(v);\r\n    }\r\n\r\n    if (typeof v === \"object\" && Array.isArray(v)) {\r\n      for (let i = 0; i < v.length; i++) {\r\n        this.add(v[i]);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    if (v >= -5 && v <= 5) {\r\n      v *= 32;\r\n    }\r\n\r\n    //try to deal with subdecimal floating point error\r\n\r\n    let f = Math.fract(v)*(1024*512);\r\n    f = (~~f)/(1024*512);\r\n    v = Math.floor(v) + f;\r\n\r\n    //glibc linear congruel generator\r\n    this.i = ((this.i + (~~v))*1103515245 + 12345) & ((1<<29) - 1);\r\n    //according to wikipedia only the top 16 bits are random\r\n    //this.i = this.i>>16;\r\n\r\n    let v2 = (v*1024*1024) & ((1<<29) - 1)\r\n    v = v | v2;\r\n\r\n    v = ~~v;\r\n\r\n    this.hash ^= v ^ this.i;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nwindow._test_hash2 = () => {\r\n  let h = new HashDigest();\r\n\r\n  let tests = [\r\n    [0, 0, 0, 0],\r\n    [0, 0, 0],\r\n    [0, 0],\r\n    [0],\r\n    [1],\r\n    [2],\r\n    [3],\r\n    [strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\")],\r\n    [strhash(\"yay\"), strhash(\"yay\"), strhash(\"yay\")]\r\n  ]\r\n\r\n  for (let test of tests) {\r\n    let h = new HashDigest();\r\n    for (let f of test) {\r\n      h.add(f);\r\n    }\r\n\r\n    window.console.log(h.get());\r\n  }\r\n  for (let i = 0; i < 50; i++) {\r\n    h.add(0);\r\n    //window.console.log(h.i/((1<<30)-1), h.hash);\r\n  }\r\n}\r\n\r\ndigestcache = cachering.fromConstructor(HashDigest, 512);\r\n\r\n//globalThis._HashDigest = HashDigest;\r\n\r\nexport function hashjoin(hash, val) {\r\n  let sum = 0;\r\n  let mul = (1<<19) - 1, off = (1<<27) - 1;\r\n  let i = 0;\r\n\r\n  h = (h*mul + off + i*mul*0.25) & mul;\r\n}\r\n\r\nlet NullItem = {};\r\n\r\nexport class MapIter {\r\n  constructor(ownermap) {\r\n    this.ret = {done: true, value: undefined};\r\n    this.value = new Array(2);\r\n    this.i = 0;\r\n    this.map = ownermap;\r\n    this.done = true;\r\n  }\r\n\r\n  finish() {\r\n    if (!this.done) {\r\n      this.done = true;\r\n      this.map.itercur--;\r\n    }\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret;\r\n    let i = this.i;\r\n    let map = this.map, list = map._list;\r\n    //window.console.log(this)\r\n\r\n    while (i < list.length && list[i] === NullItem) {\r\n      i += 2;\r\n    }\r\n\r\n    //window.console.log(\"  --\", i, list[i], list[i+1]);\r\n\r\n    if (i >= list.length) {\r\n      ret.done = true;\r\n      ret.value = undefined;\r\n\r\n      this.finish();\r\n      return ret;\r\n    }\r\n\r\n    this.i = i + 2;\r\n\r\n    ret.value = this.value;\r\n    ret.value[0] = list[i];\r\n    ret.value[1] = list[i + 1];\r\n    ret.done = false;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return() {\r\n    this.finish();\r\n\r\n    return this.ret;\r\n  }\r\n\r\n  reset() {\r\n    this.i = 0;\r\n    this.value[0] = undefined;\r\n    this.value[1] = undefined;\r\n    this.done = false;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class map {\r\n  constructor() {\r\n    this._items = {};\r\n    this._list = [];\r\n\r\n    this.size = 0;\r\n\r\n    this.iterstack = new Array(8);\r\n    this.itercur = 0;\r\n    for (let i = 0; i < this.iterstack.length; i++) {\r\n      this.iterstack[i] = new MapIter(this);\r\n    }\r\n\r\n    this.freelist = [];\r\n  }\r\n\r\n  has(key) {\r\n    return key[Symbol.keystr]() in this._items;\r\n  }\r\n\r\n  set(key, v) {\r\n    let k = key[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n\r\n    if (i === undefined) {\r\n      if (this.freelist.length > 0) {\r\n        i = this.freelist.pop();\r\n      } else {\r\n        i = this._list.length;\r\n        this._list.length += 2;\r\n      }\r\n\r\n      this.size++;\r\n    }\r\n\r\n    this._list[i] = key;\r\n    this._list[i + 1] = v;\r\n\r\n    this._items[k] = i;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield key;\r\n      }\r\n    })()\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let [key, val] of this2) {\r\n        yield val;\r\n      }\r\n    })()\r\n  }\r\n\r\n  get(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    let i = this._items[k];\r\n    if (i !== undefined) {\r\n      return this._list[i + 1];\r\n    }\r\n  }\r\n\r\n  delete(k) {\r\n    k = k[Symbol.keystr]();\r\n\r\n    if (!(k in this._items)) {\r\n      return false;\r\n    }\r\n\r\n    let i = this._items[k];\r\n\r\n    this.freelist.push(i);\r\n\r\n    this._list[i] = NullItem;\r\n    this._list[i + 1] = NullItem;\r\n\r\n    delete this._items[k];\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let ret = this.iterstack[this.itercur].reset();\r\n    this.itercur++;\r\n\r\n    if (this.itercur === this.iterstack.length) {\r\n      this.iterstack.push(new MapIter(this));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n}\r\n\r\nglobalThis._test_map = function () {\r\n  let m = new map();\r\n\r\n  m.set(\"1\", 2);\r\n  m.set(11, 3);\r\n  m.set(\"5\", 4);\r\n  m.set(\"3\", 5);\r\n  m.set(\"3\", 6);\r\n  m.delete(\"3\");\r\n\r\n  for (let [key, item] of m) {\r\n    for (let [key2, item2] of m) {\r\n      window.console.log(key, item, key2, item2);\r\n    }\r\n    break;\r\n  }\r\n\r\n  console.log(\"itercur\", m.itercur);\r\n\r\n  return m;\r\n}\r\n\r\nfunction validateId(id) {\r\n  let bad = typeof id !== \"number\";\r\n  bad = bad || id !== ~~id;\r\n  bad = bad || isNaN(id);\r\n\r\n  if (bad) {\r\n    throw new Error(\"bad number \" + id);\r\n  }\r\n\r\n  return bad;\r\n}\r\n\r\nlet UndefinedTag = {};\r\n\r\nexport class IDMap extends Array {\r\n  constructor() {\r\n    super();\r\n\r\n    this._keys = new Set();\r\n    this.size = 0;\r\n  }\r\n\r\n  has(id) {\r\n    validateId(id);\r\n\r\n    if (id < 0 || id >= this.length) {\r\n      return false;\r\n    }\r\n\r\n    return this[id] !== undefined;\r\n  }\r\n\r\n  set(id, val) {\r\n    validateId(id);\r\n\r\n    if (id < 0) {\r\n      console.warn(\"got -1 id in IDMap\");\r\n      return;\r\n    }\r\n\r\n    if (id >= this.length) {\r\n      this.length = id + 1;\r\n    }\r\n\r\n    if (val === undefined) {\r\n      val = UndefinedTag;\r\n    }\r\n\r\n    let ret = false;\r\n\r\n    if (this[id] === undefined) {\r\n      this.size++;\r\n      this._keys.add(id);\r\n      ret = true;\r\n    }\r\n\r\n    this[id] = val;\r\n    return ret;\r\n  }\r\n\r\n  /* we allow -1, which always returns undefined*/\r\n  get(id) {\r\n    validateId(id);\r\n\r\n    if (id === -1) {\r\n      return undefined;\r\n    } else if (id < 0) {\r\n      console.warn(\"id was negative\");\r\n      return undefined;\r\n    }\r\n\r\n    let ret = id < this.length ? this[id] : undefined;\r\n    ret = ret === UndefinedTag ? undefined : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  delete(id) {\r\n    if (!this.has(id)) {\r\n      return false;\r\n    }\r\n\r\n    this._keys.remove(id);\r\n    this[id] = undefined;\r\n    this.size--;\r\n\r\n    return true;\r\n  }\r\n\r\n  keys() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield id;\r\n      }\r\n    })();\r\n  }\r\n\r\n  values() {\r\n    let this2 = this;\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        yield this2[id];\r\n      }\r\n    })();\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let this2 = this;\r\n    let iteritem = [0, 0];\r\n\r\n    return (function* () {\r\n      for (let id of this2._keys) {\r\n        iteritem[0] = id;\r\n        iteritem[1] = this2[id];\r\n\r\n        if (iteritem[1] === UndefinedTag) {\r\n          iteritem[1] = undefined;\r\n        }\r\n\r\n        yield iteritem;\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nglobalThis._test_idmap = function () {\r\n  let map = new IDMap();\r\n\r\n  for (let i = 0; i < 5; i++) {\r\n    let id = ~~(Math.random()*55);\r\n\r\n    map.set(id, \"yay\" + i);\r\n  }\r\n\r\n  for (let [key, val] of map) {\r\n    window.console.log(key, val, map.has(key), map.get(key));\r\n  }\r\n\r\n  return map;\r\n}\r\n\r\nlet HW = 0, HELEM = 1, HTOT = 2;\r\n\r\nfunction heaplog() {\r\n  //window.console.log(...arguments);\r\n}\r\n\r\nexport class MinHeapQueue {\r\n  constructor(iter, iterw = iter) {\r\n    this.heap = [];\r\n    this.freelist = [];\r\n    this.length = 0;\r\n    this.end = 0;\r\n\r\n    if (iter) {\r\n      let witer = iterw[Symbol.iterator]();\r\n\r\n      for (let item of iter) {\r\n        let w = witer.next().value;\r\n        this.push(item, w);\r\n      }\r\n    }\r\n  }\r\n\r\n  push(e, w) {\r\n    if (typeof w !== \"number\") {\r\n      throw new Error(\"w must be a number\");\r\n    }\r\n\r\n    if (isNaN(w)) {\r\n      throw new Error(\"NaN\");\r\n    }\r\n\r\n    this.length++;\r\n    let depth = Math.ceil(Math.log(this.length)/Math.log(2.0));\r\n    let tot = Math.pow(2, depth) + 1;\r\n\r\n    heaplog(depth, tot);\r\n\r\n    if (this.heap.length < tot*HTOT) {\r\n      let start = this.heap.length/HTOT;\r\n\r\n      for (let i = start; i < tot; i++) {\r\n        this.freelist.push(i*HTOT);\r\n      }\r\n    }\r\n\r\n    let heap = this.heap;\r\n    heap.length = tot*HTOT;\r\n\r\n    let n = this.freelist.pop();\r\n\r\n    heaplog(\"freelist\", this.freelist);\r\n    this.end = Math.max(this.end, n);\r\n\r\n    heap[n] = w;\r\n    heap[n + 1] = e;\r\n\r\n    while (n > 0) {\r\n      n /= HTOT;\r\n\r\n      let p = (n - 1)>>1;\r\n      n *= HTOT;\r\n      p *= HTOT;\r\n\r\n      if (heap[p] === undefined || heap[p] > w) {\r\n        if (n === this.end) {\r\n          this.end = p;\r\n        }\r\n\r\n        heap[n] = heap[p];\r\n        heap[n + 1] = heap[p + 1];\r\n\r\n        heap[p] = w;\r\n        heap[p + 1] = e;\r\n\r\n        n = p;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n      //throw new Error(\"heap is empty\");\r\n    }\r\n\r\n    let heap = this.heap;\r\n\r\n    if (this.end === 0) {\r\n      let ret = heap[1];\r\n      this.freelist.push(0);\r\n      heap[0] = undefined;\r\n\r\n      this.length = 0;\r\n\r\n      return ret;\r\n    }\r\n\r\n    let ret = heap[1];\r\n\r\n    let end = this.end;\r\n\r\n    function swap(n1, n2) {\r\n      let t = heap[n1];\r\n      heap[n1] = heap[n2];\r\n      heap[n2] = t;\r\n\r\n      t = heap[n1 + 1];\r\n      heap[n1 + 1] = heap[n2 + 1];\r\n      heap[n2 + 1] = t;\r\n    }\r\n\r\n    heaplog(\"end\", end);\r\n    heaplog(heap.concat([]));\r\n\r\n    heap[0] = heap[end];\r\n    heap[1] = heap[end + 1];\r\n    heap[end] = undefined;\r\n    heap[end + 1] = undefined;\r\n\r\n    let n = 0;\r\n    while (n < heap.length) {\r\n      n /= HTOT;\r\n\r\n      let n1 = n*2 + 1;\r\n      let n2 = n*2 + 2;\r\n\r\n      n1 = ~~(n1*HTOT);\r\n      n2 = ~~(n2*HTOT);\r\n      n = ~~(n*HTOT);\r\n\r\n      heaplog(\"  \", heap[n], heap[n1], heap[n2]);\r\n\r\n      if (heap[n1] !== undefined && heap[n2] !== undefined) {\r\n        if (heap[n1] > heap[n2]) {\r\n          let t = n1;\r\n          n1 = n2;\r\n          n2 = t;\r\n        }\r\n\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n1] !== undefined) {\r\n        if (heap[n] > heap[n1]) {\r\n          swap(n, n1);\r\n          n = n1;\r\n        } else {\r\n          break;\r\n        }\r\n      } else if (heap[n2] !== undefined) {\r\n        if (heap[n] > heap[n2]) {\r\n          swap(n, n2);\r\n          n = n2;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    this.freelist.push(this.end);\r\n\r\n    heap[this.end] = undefined;\r\n    heap[this.end + 1] = undefined;\r\n\r\n    while (this.end > 0 && heap[this.end] === undefined) {\r\n      this.end -= HTOT;\r\n    }\r\n\r\n    this.length--;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis.testHeapQueue = function (list1 = [1, 8, -3, 11, 33]) {\r\n  let h = new MinHeapQueue(list1);\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  let list = [];\r\n  let len = h.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    list.push(h.pop());\r\n  }\r\n\r\n  window.console.log(h.heap.concat([]));\r\n\r\n  return list;\r\n}\r\n\r\nexport class Queue {\r\n  constructor(n = 32) {\r\n    n = Math.max(n, 8);\r\n\r\n    this.initialSize = n;\r\n\r\n    this.queue = new Array(n);\r\n    this.a = 0;\r\n    this.b = 0;\r\n    this.length = 0;\r\n  }\r\n\r\n  enqueue(item) {\r\n    let qlen = this.queue.length;\r\n\r\n    let b = this.b;\r\n\r\n    this.queue[b] = item;\r\n    this.b = (this.b + 1)%qlen;\r\n\r\n    if (this.length >= qlen || this.a === this.b) {\r\n      let newsize = qlen<<1;\r\n      let queue = new Array(newsize);\r\n\r\n      for (let i = 0; i < qlen; i++) {\r\n        let i2 = (i + this.a)%qlen;\r\n\r\n        queue[i] = this.queue[i2];\r\n      }\r\n\r\n      this.a = 0;\r\n      this.b = qlen;\r\n      this.queue = queue;\r\n    }\r\n\r\n    this.length++;\r\n  }\r\n\r\n  clear(clearData = true) {\r\n    this.queue.length = this.initialSize;\r\n\r\n    if (clearData) {\r\n      for (let i = 0; i < this.queue.length; i++) {\r\n        this.queue[i] = undefined;\r\n      }\r\n    }\r\n\r\n    this.a = this.b = 0;\r\n    this.length = 0;\r\n\r\n    return this;\r\n  }\r\n\r\n  dequeue() {\r\n    if (this.length === 0) {\r\n      return undefined;\r\n    }\r\n    this.length--;\r\n\r\n    let ret = this.queue[this.a];\r\n\r\n    this.queue[this.a] = undefined;\r\n\r\n    this.a = (this.a + 1)%this.queue.length;\r\n    return ret;\r\n  }\r\n}\r\n\r\nglobalThis._testQueue = function (steps = 15, samples = 15) {\r\n  let queue = new Queue(3);\r\n\r\n  for (let i = 0; i < steps; i++) {\r\n    let list = [];\r\n\r\n    for (let j = 0; j < samples; j++) {\r\n      let item = {f: Math.random()};\r\n      list.push(item);\r\n\r\n      queue.enqueue(item);\r\n    }\r\n\r\n    let j = 0;\r\n\r\n    while (queue.length > 0) {\r\n      let item = queue.dequeue();\r\n\r\n      if (item !== list[j]) {\r\n        console.log(item, list);\r\n        throw new Error(\"got wrong item\", item);\r\n      }\r\n\r\n      j++;\r\n\r\n      if (j > 10000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class ArrayPool {\r\n  constructor() {\r\n    this.pools = new Map();\r\n    this.map = new Array(1024);\r\n  }\r\n\r\n  get(n, clear = false) {\r\n    let pool;\r\n\r\n    if (n < 1024) {\r\n      pool = this.map[n];\r\n    } else {\r\n      pool = this.pools.get(n);\r\n    }\r\n\r\n    if (!pool) {\r\n      let tot;\r\n\r\n      if (n > 512) {\r\n        tot = 32;\r\n      } else if (n > 256) {\r\n        tot = 64;\r\n      } else if (n > 128) {\r\n        tot = 256;\r\n      } else if (n > 64) {\r\n        tot = 512;\r\n      } else {\r\n        tot = 1024;\r\n      }\r\n\r\n      pool = new cachering(() => new Array(n), tot);\r\n      if (n < 1024) {\r\n        this.map[n] = pool;\r\n      }\r\n      this.pools.set(n, pool);\r\n\r\n      return this.get(n, clear);\r\n    }\r\n\r\n    let ret = pool.next();\r\n    if (ret.length !== n) {\r\n      console.warn(\"Array length was set\", n, ret);\r\n      ret.length = n;\r\n    }\r\n\r\n    if (clear) {\r\n      for (let i = 0; i < n; i++) {\r\n        ret[i] = undefined;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\n/** jsFiddle-friendly */\r\nexport class DivLogger {\r\n  constructor(elemId, maxLines = 16) {\r\n    this.elemId = elemId;\r\n    this.elem = undefined;\r\n    this.lines = new Array();\r\n    this.maxLines = maxLines;\r\n  }\r\n\r\n  push(line) {\r\n    if (this.lines.length > this.maxLines) {\r\n      this.lines.shift();\r\n      this.lines.push(line);\r\n    } else {\r\n      this.lines.push(line);\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    let buf = this.lines.join(`<br>`);\r\n    buf = buf.replace(/[ \\t]/g, \"&nbsp;\");\r\n\r\n    if (!this.elem) {\r\n      this.elem = document.getElementById(this.elemId);\r\n    }\r\n\r\n    this.elem.innerHTML = buf;\r\n  }\r\n\r\n  toString(obj, depth = 0) {\r\n    let s = '';\r\n\r\n    let tab = '';\r\n    for (let i = 0; i < depth; i++) {\r\n      tab += '$TAB';\r\n    }\r\n\r\n    if (typeof obj === \"symbol\") {\r\n      return `[${obj.description}]`;\r\n    }\r\n\r\n    const DEPTH_LIMIT = 1;\r\n    const CHAR_LIMIT = 100;\r\n\r\n    if (typeof obj === \"object\" && Array.isArray(obj)) {\r\n      s = \"[$NL\";\r\n      for (let i = 0; i < obj.length; i++) {\r\n        let v = obj[i];\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth + 1);\r\n        }\r\n\r\n        s += tab + \"$TAB\";\r\n        s += v + (i !== obj.length - 1 ? \",\" : \"\") + \"$NL\";\r\n      }\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i = 0; i < keys.length; i++) {\r\n        let k = keys[i];\r\n        let n;\r\n\r\n        let k2 = this.toString(k);\r\n\r\n        if (typeof k !== \"symbol\" && !isNaN(n = parseInt(k))) {\r\n          if (n >= 0 && n < obj.length) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = \"(error)\";\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length - 1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += \"$TAB]$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"object\") {\r\n      s = '{$NL';\r\n\r\n      let keys = Reflect.ownKeys(obj);\r\n      for (let i = 0; i < keys.length; i++) {\r\n        let k = keys[i];\r\n        let k2 = this.toString(k);\r\n\r\n        let v;\r\n        try {\r\n          v = obj[k];\r\n        } catch (error) {\r\n          v = '(error)';\r\n        }\r\n\r\n        if (depth >= DEPTH_LIMIT) {\r\n          v = typeof v;\r\n        } else {\r\n          v = this.toString(v, depth + 1);\r\n        }\r\n\r\n        s += tab + `$TAB${k2} : ${v}`;\r\n\r\n        if (i < keys.length - 1) {\r\n          s += \",\";\r\n        }\r\n\r\n        if (!s.endsWith(\"$NL\") && !s.endsWith(\"\\n\")) {\r\n          s += \"$NL\";\r\n        }\r\n      }\r\n      s += tab + \"}$NL\";\r\n\r\n      if (s.length < CHAR_LIMIT) {\r\n        s = s.replace(/\\$NL/g, \"\");\r\n        s = s.replace(/(\\$TAB)+/g, \" \");\r\n      } else {\r\n        s = s.replace(/\\$NL/g, \"\\n\");\r\n        s = s.replace(/\\$TAB/g, \"  \");\r\n      }\r\n    } else if (typeof obj === \"undefined\") {\r\n      s = 'undefined';\r\n    } else if (typeof obj === \"function\") {\r\n      s = 'function ' + obj.name;\r\n    } else {\r\n      s = \"\" + obj;\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nexport const PendingTimeoutPromises = new Set();\r\n\r\nexport class TimeoutPromise {\r\n  constructor(callback, timeout = 3000, silent = false) {\r\n    if (!callback) {\r\n      return;\r\n    }\r\n\r\n    this.silent = silent;\r\n    this.timeout = timeout;\r\n\r\n    let accept2 = this._accept2.bind(this);\r\n    let reject2 = this._reject2.bind(this);\r\n\r\n    this.time = time_ms();\r\n\r\n    this.rejected = false;\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      callback(accept2, reject2);\r\n    });\r\n\r\n    PendingTimeoutPromises.add(this);\r\n  }\r\n\r\n  _accept2(val) {\r\n    if (this.bad) {\r\n      if (!this.silent) {\r\n        this._reject(new Error(\"Timeout\"));\r\n      }\r\n    } else {\r\n      return this._accept(val);\r\n    }\r\n  }\r\n\r\n  static wrapPromise(promise, timeout = 3000, callback) {\r\n    let p = new TimeoutPromise();\r\n\r\n    p._promise = promise;\r\n\r\n    p._accept = callback;\r\n    p._reject = function (error) {\r\n      throw error;\r\n    }\r\n\r\n    p.then(val => {\r\n      p._accept2(val);\r\n    }).catch(error => {\r\n      p._reject2(error);\r\n    });\r\n\r\n    return p;\r\n  }\r\n\r\n  _reject2(error) {\r\n    this._reject(error);\r\n  }\r\n\r\n  then(callback) {\r\n    let cb = (val) => {\r\n      let ret = callback(val);\r\n\r\n      if (ret instanceof Promise) {\r\n        ret = TimeoutPromise.wrapPromise(ret, this.timeout, callback);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    this._promise.then(cb);\r\n    return this;\r\n  }\r\n\r\n  catch(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  finally(callback) {\r\n    this._promise.catch(callback);\r\n    return this;\r\n  }\r\n\r\n  get bad() {\r\n    return time_ms() - this.time > this.timeout;\r\n  }\r\n}\r\n\r\nwindow.setInterval(() => {\r\n  let bad = [];\r\n\r\n  for (let promise of PendingTimeoutPromises) {\r\n    if (promise.bad) {\r\n      bad.push(promise);\r\n    }\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    PendingTimeoutPromises.delete(promise);\r\n  }\r\n\r\n  for (let promise of bad) {\r\n    try {\r\n      promise._reject(new Error(\"Timeout\"));\r\n    } catch (error) {\r\n      print_stack(error);\r\n    }\r\n  }\r\n}, 250);\r\n\r\nimport lzstring from '../extern/lz-string/lz-string.js';\r\n\r\nexport function compress(data) {\r\n  return lzstring.compressToUint8Array(data);\r\n}\r\n\r\nexport function decompress(data) {\r\n  if (data instanceof DataView) {\r\n    data = data.buffer;\r\n  }\r\n\r\n  if (data instanceof ArrayBuffer) {\r\n    data = new Uint8Array(data);\r\n  }\r\n\r\n  return lzstring.decompressFromUint8Array(data);\r\n}\r\n\r\n/* Returns 'undefined' as type type.  Breaks the typescript\r\n   type system, is meant only for object pool systems.\r\n */\r\nexport function undefinedForGC() {\r\n  return undefined;\r\n}\r\n", "if (typeof window === \"undefined\" && typeof global !== \"undefined\") {\r\n  global.window = global;\r\n}\r\n\r\n(function () {\r\n  let visitgen = 0;\r\n\r\n  window.destroyAllCSS = function () {\r\n    visitgen++;\r\n\r\n    let visit = (n) => {\r\n      if (n.__visit === visitgen) {\r\n        return;\r\n      }\r\n\r\n      n.__visit = visitgen;\r\n      if (n.tagName === \"STYLE\") {\r\n        n.textContents = '';\r\n      }\r\n\r\n      if (n.style) {\r\n        for (let k in n.style) {\r\n          try {\r\n            n.style[k] = \"\";\r\n          } catch (error) {\r\n\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!n.childNodes) {\r\n        return;\r\n      }\r\n\r\n      for (let c of n.childNodes) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    visit(document.head);\r\n    visit(document.body);\r\n\r\n    for (let sheet of document.styleSheets) {\r\n      for (let i = 0; i < sheet.rules.length; i++) {\r\n        sheet.removeRule(sheet.rules[0]);\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\nwindow.eventDebugModule = (function () {\r\n  \"use strict\";\r\n\r\n  return {\r\n    start() {\r\n      window.debugEventLists = {}\r\n      window.debugEventList = [];\r\n\r\n      this._addEventListener = EventTarget.prototype.addEventListener;\r\n      this._removeEventListener = EventTarget.prototype.removeEventListener;\r\n      this._dispatchEvent = EventTarget.prototype.dispatchEvent;\r\n\r\n      EventTarget.prototype.addEventListener = this.onadd;\r\n      EventTarget.prototype.removeEventListener = this.onrem;\r\n      EventTarget.prototype.dispatchEvent = this.ondispatch;\r\n    },\r\n\r\n    add(type, data) {\r\n      if (!(type in debugEventLists)) {\r\n        debugEventLists[type] = [];\r\n      }\r\n\r\n      debugEventLists[type].push(data);\r\n    },\r\n\r\n    ondispatch() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Dispatch\", {\r\n        event    : a[0],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n      return eventDebugModule._dispatchEvent.apply(this, arguments);\r\n    },\r\n\r\n    onadd() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Add\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._addEventListener.apply(this, arguments);\r\n    },\r\n\r\n    pruneConnected() {\r\n      for (let k in debugEventLists) {\r\n        let list = debugEventLists[k];\r\n\r\n        for (let i = 0; i < list.length; i++) {\r\n          let e = list[i];\r\n\r\n          if (!e.thisvar || !(e.thisvar instanceof Node)) {\r\n            continue;\r\n          }\r\n\r\n          if (!e.thisvar.isConnected) {\r\n            list[i] = list[list.length - 1];\r\n            list[list.length - 1] = undefined;\r\n            list.length--;\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n\r\n    onrem() {\r\n      let a = arguments;\r\n\r\n      eventDebugModule.add(\"Rem\", {\r\n        type     : a[0],\r\n        cb       : a[1],\r\n        args     : a[2],\r\n        thisvar  : a[4],\r\n        line     : a[5],\r\n        filename : a[6].replace(/\\\\/g, \"/\"),\r\n        filepath : location.origin + a[6].replace(/\\\\/g, \"/\") + \":\" + a[5],\r\n        ownerpath: a[7]\r\n      });\r\n\r\n\r\n      return eventDebugModule._removeEventListener.apply(this, arguments);\r\n    }\r\n  }\r\n})();\r\n\r\nif (typeof _debug_event_listeners !== \"undefined\" && _debug_event_listeners) {\r\n  eventDebugModule.start();\r\n}\r\n\r\n/*\r\nif (navigator.userAgent.toLowerCase().search(\"chrome\") >= 0) {\r\n  console.warn(\"Patching Google Chrome scrollbar bug\");\r\n\r\n  let cb = (e) => {\r\n    if (e.touches.length == 1) {\r\n      let e2 = Object.create(e);\r\n      e2.pageX = e.touches[0].pageX;\r\n      e2.pageY = e.touches[0].pageY;\r\n      e2.x = e2.screenX = e2.pageX;\r\n      e2.y = e2.screenY = e2.pageY;\r\n      e2.button = 0;\r\n      e2.buttons = 1;\r\n\r\n      let type;\r\n      if (e.type === \"touchstart\")\r\n        type = \"mousedown\";\r\n      else \r\n        type = \"mousemove\";\r\n\r\n      console.log(e2);\r\n        //console.log(e.target);\r\n      e2 = new MouseEvent(type, e);\r\n      e.target.dispatchEvent(e2);\r\n    }\r\n  };\r\n\r\n  window.addEventListener(\"touchstart\", (e) => cb(e));\r\n  window.addEventListener(\"touchmove\", (e) => cb(e));\r\n\r\n  document.addEventListener(\"touchstart\", (e) => cb(e));\r\n  document.addEventListener(\"touchmove\", (e) => cb(e));\r\n}\r\n//*/\r\n\r\nif (window._disable_all_listeners) {\r\n  console.warn(\"Disabling all event listeners\");\r\n  EventTarget.prototype.addEventListener = () => {\r\n  };\r\n  EventSource.prototype.addEventListener = () => {\r\n  };\r\n}\r\n\r\nif (typeof visualViewport === \"undefined\") {\r\n  (function () {\r\n    class MyVisualViewport {\r\n      get width() {\r\n        return window.innerWidth;\r\n      }\r\n\r\n      get height() {\r\n        return window.innerHeight;\r\n      }\r\n\r\n      get offsetLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get offsetTop() {\r\n        return 0;\r\n      }\r\n\r\n      get pageLeft() {\r\n        return 0;\r\n      }\r\n\r\n      get pageTop() {\r\n        return 0;\r\n      }\r\n\r\n      get scale() {\r\n        return 1.0;\r\n      }\r\n    }\r\n\r\n    window.visualViewport = new MyVisualViewport();\r\n  })();\r\n}\r\n\r\nif (Array.prototype.set === undefined) {\r\n  /**\r\n   * A version of TypedArray.prototype.set for Array\r\n   * Unliked typed array version the array will be\r\n   * resized if the source array range extends past\r\n   * the array length.\r\n   *\r\n   * array.set(array) array.set(array, src_offset) array.set(array, src_offset, count)\r\n   * array.set(array, src_offset, dest_offset, count\r\n   * @param array\r\n   */\r\n  Array.prototype.set = function set(array) {\r\n    if (arguments.length === 0) {\r\n      //WASM somehow manages to call this\r\n      return;\r\n    }\r\n\r\n    let src, dst, count;\r\n\r\n    if (arguments.length === 0) {\r\n      src = 0;\r\n      dst = 0;\r\n      count = array.length;\r\n    } else if (arguments.length === 1) {\r\n      count = array.length;\r\n      src = arguments[1];\r\n      dst = 0;\r\n    } else if (arguments.length === 2) {\r\n      src = arguments[1];\r\n      count = arguments[2];\r\n    } else if (arguments.length === 3) {\r\n      src = arguments[1];\r\n      dst = arguments[2];\r\n      count = arguments[3];\r\n    }\r\n\r\n    src = src === undefined ? 0 : src;\r\n    dst = dst === undefined ? 0 : dst;\r\n    count = count === undefined ? array.length : count;\r\n\r\n    if (count < 0) {\r\n      throw new RangeError(\"Count must be >= zero\");\r\n    }\r\n\r\n    let len = Math.min(src + count, array.length) - src;\r\n\r\n    if (dst + len > this.length) {\r\n      this.length = dst + len;\r\n    }\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      this[dst + i] = array[src + i];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"set\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n\r\n  if (Float64Array.prototype.set === undefined) {\r\n    Float64Array.prototype.set = Array.prototype.set;\r\n    Float32Array.prototype.set = Array.prototype.set;\r\n    Uint8Array.prototype.set = Array.prototype.set;\r\n    Uint8ClampedArray.prototype.set = Array.prototype.set;\r\n    Int32Array.prototype.set = Array.prototype.set;\r\n    Int16Array.prototype.set = Array.prototype.set;\r\n    Int8Array.prototype.set = Array.prototype.set;\r\n  }\r\n}\r\n\r\nif (Array.prototype.reject === undefined) {\r\n  Array.prototype.reject = function reject(func) {\r\n    return this.filter((item) => !func(item));\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"reject\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (window.Symbol == undefined) { //eek!\r\n  window.Symbol = {\r\n    iterator: \"$__iterator__$\",\r\n    keystr  : \"$__keystr__$\"\r\n  }\r\n} else if (Symbol.keystr === undefined) {\r\n  Symbol.keystr = Symbol(\"keystr\");\r\n}\r\n\r\n/* use util.list\r\nwindow.list = function list(iter) {\r\n  var ret = [];\r\n\r\n  if (typeof iter == \"string\") {\r\n    iter = new String();\r\n  }\r\n\r\n  if (Symbol.iterator in iter) {\r\n    for (var item of iter) {\r\n      ret.push(item);\r\n    }\r\n  } else {\r\n    iter.forEach(function (item) {\r\n      ret.push(item);\r\n    }, this);\r\n  }\r\n\r\n  return ret;\r\n};*/\r\n\r\n//XXX surely browser vendors have fixed this by now. . .\r\n/*Override array iterator to not allocate too much*/\r\n\r\n/*\r\nfunction ArrayIter(array) {\r\n  this.array = array;\r\n  this.i = 0;\r\n  this.ret = {done : false, value : undefined};\r\n}\r\n\r\nArrayIter.prototype[Symbol.iterator] = function() {\r\n  return this;\r\n}\r\n\r\nArrayIter.prototype.next = function() {\r\n  var ret = this.ret;\r\n  \r\n  if (this.i >= this.array.length) {\r\n    ret.done = true;\r\n    ret.value = undefined;\r\n    return ret;\r\n  }\r\n  \r\n  ret.value = this.array[this.i++];\r\n  return ret;\r\n};//*/\r\n\r\n\r\n//Array.prototype[Symbol.iterator] = function() {\r\n//  return new ArrayIter(this);\r\n//}\r\n\r\nif (Math.fract === undefined) {\r\n  Math.fract = function fract(f) {\r\n    return f - Math.floor(f);\r\n  };\r\n}\r\n\r\nif (Math.tent === undefined) {\r\n  Math.tent = function tent(f) {\r\n    return 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n  };\r\n}\r\n\r\nif (Math.sign === undefined) {\r\n  Math.sign = function sign(f) {\r\n    return (f > 0.0)*2.0 - 1.0;\r\n  };\r\n}\r\n\r\nif (Array.prototype.pop_i === undefined) {\r\n  Array.prototype.pop_i = function (idx) {\r\n    if (idx < 0 || idx >= this.length) {\r\n      throw new Error(\"Index out of range\");\r\n    }\r\n\r\n    while (idx < this.length) {\r\n      this[idx] = this[idx + 1];\r\n      idx++;\r\n    }\r\n\r\n    this.length -= 1;\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"pop_i\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (Array.prototype.remove === undefined) {\r\n  Array.prototype.remove = function (item, suppress_error) {\r\n    var i = this.indexOf(item);\r\n\r\n    if (i < 0) {\r\n      if (suppress_error)\r\n        console.trace(\"Warning: item not in array\", item);\r\n      else\r\n        throw new Error(\"Error: item not in array \" + item);\r\n\r\n      return;\r\n    }\r\n\r\n    this.pop_i(i);\r\n  }\r\n\r\n  Object.defineProperty(Array.prototype, \"remove\", {\r\n    enumerable  : false,\r\n    configurable: true,\r\n  });\r\n}\r\n\r\nif (String.prototype.contains === undefined) {\r\n  String.prototype.contains = function (substr) {\r\n    return String.search(substr) >= 0;\r\n  }\r\n}\r\n\r\nString.prototype[Symbol.keystr] = function () {\r\n  return this;\r\n};\r\n\r\nNumber.prototype[Symbol.keystr] = Boolean.prototype[Symbol.keystr] = function () {\r\n  return \"\" + this;\r\n};\r\n\r\nArray.prototype[Symbol.keystr] = function () {\r\n  let key = \"\";\r\n  for (let item of this) {\r\n    key += item[Symbol.keystr]() + \":\";\r\n  }\r\n\r\n  return key;\r\n};\r\n", "let colormap = {\r\n  \"black\"   : 30,\r\n  \"red\"     : 31,\r\n  \"green\"   : 32,\r\n  \"yellow\"  : 33,\r\n  \"blue\"    : 34,\r\n  \"magenta\" : 35,\r\n  \"cyan\"    : 36,\r\n  \"white\"   : 37,\r\n  \"reset\"   : 0,\r\n  \"grey\"    : 2,\r\n  \"orange\"  : 202,\r\n  \"pink\"    : 198,\r\n  \"brown\"   : 314,\r\n  \"lightred\": 91,\r\n  \"peach\"   : 210\r\n};\r\n\r\nfunction tab(n, chr = ' ') {\r\n  let t = '';\r\n\r\n  for (let i = 0; i < n; i++) {\r\n    t += chr;\r\n  }\r\n\r\n  return t;\r\n}\r\n\r\nlet termColorMap = {};\r\nfor (let k in colormap) {\r\n  termColorMap[k] = colormap[k];\r\n  termColorMap[colormap[k]] = k;\r\n}\r\n\r\nfunction termColor(s, c) {\r\n  if (typeof s === \"symbol\") {\r\n    s = s.toString();\r\n  } else {\r\n    s = \"\" + s;\r\n  }\r\n\r\n  if (c in colormap)\r\n    c = colormap[c];\r\n\r\n  if (c > 107) {\r\n    let s2 = '\\u001b[38;5;' + c + \"m\";\r\n    return s2 + s + '\\u001b[0m'\r\n  }\r\n\r\n  return '\\u001b[' + c + 'm' + s + '\\u001b[0m'\r\n};\r\n\r\nfunction termPrint() {\r\n  //let console = window.console;\r\n\r\n  let s = '';\r\n  for (let i = 0; i < arguments.length; i++) {\r\n    if (i > 0) {\r\n      s += ' ';\r\n    }\r\n    s += arguments[i];\r\n  }\r\n\r\n  let re1a = /\\u001b\\[[1-9][0-9]?m/;\r\n  let re1b = /\\u001b\\[[1-9][0-9];[0-9][0-9]?;[0-9]+m/;\r\n  let re2 = /\\u001b\\[0m/;\r\n\r\n  let endtag = '\\u001b[0m';\r\n\r\n  function tok(s, type) {\r\n    return {\r\n      type : type,\r\n      value: s\r\n    }\r\n  }\r\n\r\n  let tokdef = [\r\n    [re1a, \"start\"],\r\n    [re1b, \"start\"],\r\n    [re2, \"end\"]\r\n  ];\r\n\r\n  let s2 = s;\r\n\r\n  let i = 0;\r\n  let tokens = [];\r\n\r\n  while (s2.length > 0) {\r\n    let ok = false;\r\n\r\n    let mintk = undefined, mini = undefined;\r\n    let minslice = undefined, mintype = undefined;\r\n\r\n    for (let tk of tokdef) {\r\n      let i = s2.search(tk[0]);\r\n\r\n      if (i >= 0 && (mini === undefined || i < mini)) {\r\n        minslice = s2.slice(i, s2.length).match(tk[0])[0];\r\n        mini = i;\r\n        mintype = tk[1];\r\n        mintk = tk;\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      break;\r\n    }\r\n\r\n    if (mini > 0) {\r\n      let chunk = s2.slice(0, mini);\r\n      tokens.push(tok(chunk, \"chunk\"));\r\n    }\r\n\r\n    s2 = s2.slice(mini+minslice.length, s2.length);\r\n    let t = tok(minslice, mintype);\r\n\r\n    tokens.push(t);\r\n  }\r\n\r\n  if (s2.length > 0) {\r\n    tokens.push(tok(s2, \"chunk\"));\r\n  }\r\n\r\n  let stack = [];\r\n  let cur;\r\n\r\n  let out = '';\r\n\r\n  for (let t of tokens) {\r\n    if (t.type === \"chunk\") {\r\n      out += t.value;\r\n    } else if (t.type === \"start\") {\r\n      stack.push(cur);\r\n      cur = t.value;\r\n\r\n      out += t.value;\r\n    } else if (t.type === \"end\") {\r\n      cur = stack.pop();\r\n      if (cur) {\r\n        out += cur;\r\n      } else {\r\n        out += endtag;\r\n      }\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nvar util = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  tab: tab,\r\n  termColorMap: termColorMap,\r\n  termColor: termColor,\r\n  termPrint: termPrint,\r\n  list: list\r\n});\r\n\r\n\"use strict\";\r\n\r\nfunction print_lines(ld, lineno, col, printColors, token) {\r\n  let buf = '';\r\n  let lines = ld.split(\"\\n\");\r\n  let istart = Math.max(lineno - 5, 0);\r\n  let iend = Math.min(lineno + 3, lines.length);\r\n\r\n  let color = printColors ? (c) => c : termColor;\r\n\r\n  for (let i = istart; i < iend; i++) {\r\n    let l = \"\" + (i + 1);\r\n    while (l.length < 3) {\r\n      l = \" \" + l;\r\n    }\r\n\r\n    l += `: ${lines[i]}\\n`;\r\n\r\n    if (i === lineno && token && token.value.length === 1) {\r\n      l = l.slice(0, col + 5) + color(l[col + 5], \"yellow\") + l.slice(col + 6, l.length);\r\n    }\r\n    buf += l;\r\n    if (i === lineno) {\r\n      let colstr = '     ';\r\n      for (let i = 0; i < col; i++) {\r\n        colstr += ' ';\r\n      }\r\n      colstr += color(\"^\", \"red\");\r\n\r\n      buf += colstr + \"\\n\";\r\n    }\r\n  }\r\n\r\n  buf = \"------------------\\n\" + buf + \"\\n==================\\n\";\r\n  return buf;\r\n}\r\n\r\nclass token {\r\n  constructor(type, val, lexpos, lineno, lexer, parser, col) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lineno = lineno;\r\n    this.col = col;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\";\r\n    else\r\n      return \"token(type=\" + this.type + \")\";\r\n  }\r\n}\r\n\r\nclass tokdef {\r\n  constructor(name, regexpr, func, example) {\r\n    this.name = name;\r\n    this.re = regexpr;\r\n    this.func = func;\r\n    this.example = example;\r\n\r\n    if (example === undefined && regexpr) {\r\n      let s = \"\" + regexpr;\r\n      if (s.startsWith(\"/\") && s.endsWith(\"/\")) {\r\n        s = s.slice(1, s.length - 1);\r\n      }\r\n\r\n      if (s.startsWith(\"\\\\\")) {\r\n        s = s.slice(1, s.length);\r\n      }\r\n      s = s.trim();\r\n\r\n      if (s.length === 1) {\r\n        this.example = s;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass PUTIL_ParseError extends Error {\r\n  constructor(msg) {\r\n    super();\r\n  }\r\n}\r\n\r\nclass lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.colmap = undefined;\r\n    this.lineno = 0;\r\n    this.printTokens = false;\r\n    this.linestart = 0;\r\n    this.errfunc = errfunc;\r\n    this.linemap = undefined;\r\n    this.tokints = {};\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n  }\r\n\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata]);\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    let linemap = this.linemap = new Array(str.length);\r\n    let lineno = 0;\r\n    let col = 0;\r\n    let colmap = this.colmap = new Array(str.length);\r\n\r\n    for (let i = 0; i < str.length; i++, col++) {\r\n      let c = str[i];\r\n\r\n      linemap[i] = lineno;\r\n      colmap[i] = col;\r\n\r\n      if (c === \"\\n\") {\r\n        lineno++;\r\n        col = 0;\r\n      }\r\n    }\r\n\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    let safepos = Math.min(this.lexpos, this.lexdata.length - 1);\r\n    let line = this.linemap[safepos];\r\n    let col = this.colmap[safepos];\r\n\r\n    let s = print_lines(this.lexdata, line, col, true);\r\n\r\n    this.logger(\"  \" + s);\r\n    this.logger(\"Syntax error near line \" + (this.lineno + 1));\r\n\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n\r\n    throw new PUTIL_ParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n    if (tok === undefined)\r\n      return undefined;\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    if (this.peeked_tokens.length > 0) {\r\n      return this.peeked_tokens[0];\r\n    }\r\n\r\n    return this.peek();\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  //ignore_peek is optional, false\r\n  next(ignore_peek) {\r\n    if (!ignore_peek && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n      this.peeked_tokens.shift();\r\n\r\n      if (!ignore_peek && this.printTokens) {\r\n        this.logger(\"\" + tok);\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n    let results = [];\r\n\r\n    for (var i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n      if (t.re === undefined)\r\n        continue;\r\n      let res = t.re.exec(lexdata);\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (var i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n    let col = this.colmap[Math.min(this.lexpos, this.lexdata.length - 1)];\r\n\r\n    if (this.lexpos < this.lexdata.length) {\r\n      this.lineno = this.linemap[this.lexpos];\r\n    }\r\n\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, this.lineno, this, undefined, col);\r\n    this.lexpos += tok.value.length;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok);\r\n      if (tok === undefined) {\r\n        return this.next();\r\n      }\r\n    }\r\n\r\n    if (!ignore_peek && this.printTokens) {\r\n      this.logger(\"\" + tok);\r\n    }\r\n    return tok;\r\n  }\r\n}\r\n\r\nclass parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n\r\n    this.logger = function () {\r\n      console.log(...arguments);\r\n    };\r\n  }\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(token, msg) {\r\n    let estr;\r\n\r\n    if (msg === undefined)\r\n      msg = \"\";\r\n    if (token === undefined)\r\n      estr = \"Parse error at end of input: \" + msg;\r\n    else\r\n      estr = `Parse error at line ${token.lineno + 1}:${token.col + 1}: ${msg}`;\r\n\r\n    let buf = \"\";\r\n    let ld = this.lexer.lexdata;\r\n    let lineno = token ? token.lineno : this.lexer.linemap[this.lexer.linemap.length - 1];\r\n    let col = token ? token.col : 0;\r\n\r\n    ld = ld.replace(/\\r/g, '');\r\n\r\n    this.logger(print_lines(ld, lineno, col, true, token));\r\n    this.logger(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(token)) {\r\n      return;\r\n    }\r\n    throw new PUTIL_ParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    let tok = this.lexer.peeknext();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peeknext();\r\n    if (tok === undefined)\r\n      return false;\r\n    if (tok.type === type) {\r\n      this.next();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined) {\r\n      msg = type;\r\n\r\n      for (let tk of this.lexer.tokdef) {\r\n        if (tk.name === type && tk.example) {\r\n          msg = tk.example;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (tok === undefined || tok.type !== type) {\r\n      this.error(tok, \"Expected \" + msg);\r\n    }\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\"]);\r\n  let reserved_tokens = new Set([\"int\", \"float\", \"double\", \"vec2\", \"vec3\", \"vec4\", \"mat4\", \"string\", \"static_string\",\r\n                                 \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n    if (reserved_tokens.has(t.value)) {\r\n      t.type = t.value.toUpperCase();\r\n    }\r\n    return t;\r\n  }), tk(\"OPEN\", /\\{/), tk(\"CLOSE\", /}/), tk(\"COLON\", /:/), tk(\"JSCRIPT\", /\\|/, function (t) {\r\n    let js = \"\";\r\n    let lexer = t.lexer;\r\n    while (lexer.lexpos < lexer.lexdata.length) {\r\n      let c = lexer.lexdata[lexer.lexpos];\r\n      if (c === \"\\n\")\r\n        break;\r\n      js += c;\r\n      lexer.lexpos++;\r\n    }\r\n    if (js.endsWith(\";\")) {\r\n      js = js.slice(0, js.length - 1);\r\n      lexer.lexpos--;\r\n    }\r\n    t.value = js;\r\n    return t;\r\n  }), tk(\"LPARAM\", /\\(/), tk(\"RPARAM\", /\\)/), tk(\"COMMA\", /,/), tk(\"NUM\", /[0-9]/), tk(\"SEMI\", /;/),\r\n                tk(\"NEWLINE\", /\\n/, function (t) {\r\n                  t.lexer.lineno += 1;\r\n                }), tk(\"SPACE\", / |\\t/, function (t) {\r\n    })];\r\n\r\n  for (let rt of reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  let a = `\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops :, array(Loop);\r\n  }\r\n  `;\r\n\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc);\r\n  console.log(\"Testing lexical scanner...\");\r\n  lex.input(a);\r\n  let token;\r\n  while (token = lex.next()) {\r\n    console.log(token.toString());\r\n  }\r\n  let parse = new parser(lex);\r\n  parse.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n    p.expect(\"RPARAM\");\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek();\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n    console.log(\"-----\", p.peek().type);\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next();\r\n    }\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n    p.expect(\"SEMI\");\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {};\r\n    st.name = p.expect(\"ID\", \"struct name\");\r\n    st.fields = [];\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parse);\r\n  console.log(JSON.stringify(ret));\r\n}\r\n\r\n//test_parser();\r\n\r\nvar struct_parseutil = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  token: token,\r\n  tokdef: tokdef,\r\n  PUTIL_ParseError: PUTIL_ParseError,\r\n  lexer: lexer,\r\n  parser: parser\r\n});\r\n\r\n\"use strict\";\r\n\r\nclass NStruct {\r\n  constructor(name) {\r\n    this.fields = [];\r\n    this.id = -1;\r\n    this.name = name;\r\n  }\r\n}\r\n\r\n//the discontinuous id's are to make sure\r\n//the version I originally wrote (which had a few application-specific types)\r\n//and this one do not become totally incompatible.\r\nconst StructEnum = {\r\n  INT          : 0,\r\n  FLOAT        : 1,\r\n  DOUBLE       : 2,\r\n  STRING       : 7,\r\n  STATIC_STRING: 8, //fixed-length string\r\n  STRUCT       : 9,\r\n  TSTRUCT      : 10,\r\n  ARRAY        : 11,\r\n  ITER         : 12,\r\n  SHORT        : 13,\r\n  BYTE         : 14,\r\n  BOOL         : 15,\r\n  ITERKEYS     : 16,\r\n  UINT         : 17,\r\n  USHORT       : 18,\r\n  STATIC_ARRAY : 19,\r\n  SIGNED_BYTE  : 20\r\n};\r\n\r\nconst ArrayTypes = new Set([\r\n  StructEnum.STATIC_ARRAY, StructEnum.ARRAY, StructEnum.ITERKEYS, StructEnum.ITER\r\n]);\r\n\r\nconst ValueTypes = new Set([\r\n  StructEnum.INT,\r\n  StructEnum.FLOAT,\r\n  StructEnum.DOUBLE,\r\n  StructEnum.STRING,\r\n  StructEnum.STATIC_STRING,\r\n  StructEnum.SHORT,\r\n  StructEnum.BYTE,\r\n  StructEnum.BOOL,\r\n  StructEnum.UINT,\r\n  StructEnum.USHORT,\r\n  StructEnum.SIGNED_BYTE\r\n\r\n]);\r\n\r\nlet StructTypes = {\r\n  \"int\"          : StructEnum.INT,\r\n  \"uint\"         : StructEnum.UINT,\r\n  \"ushort\"       : StructEnum.USHORT,\r\n  \"float\"        : StructEnum.FLOAT,\r\n  \"double\"       : StructEnum.DOUBLE,\r\n  \"string\"       : StructEnum.STRING,\r\n  \"static_string\": StructEnum.STATIC_STRING,\r\n  \"struct\"       : StructEnum.STRUCT,\r\n  \"abstract\"     : StructEnum.TSTRUCT,\r\n  \"array\"        : StructEnum.ARRAY,\r\n  \"iter\"         : StructEnum.ITER,\r\n  \"short\"        : StructEnum.SHORT,\r\n  \"byte\"         : StructEnum.BYTE,\r\n  \"bool\"         : StructEnum.BOOL,\r\n  \"iterkeys\"     : StructEnum.ITERKEYS,\r\n  \"sbyte\"        : StructEnum.SIGNED_BYTE\r\n};\r\n\r\nlet StructTypeMap = {};\r\n\r\nfor (let k in StructTypes) {\r\n  StructTypeMap[StructTypes[k]] = k;\r\n}\r\n\r\nfunction gen_tabstr$2(t) {\r\n  let s = \"\";\r\n  for (let i = 0; i < t; i++) {\r\n    s += \"  \";\r\n  }\r\n  return s;\r\n}\r\n\r\nfunction stripComments(buf) {\r\n  let s = '';\r\n\r\n  const MAIN = 0, COMMENT = 1, STR = 2;\r\n\r\n  let p, n;\r\n  let strs = new Set([\"'\", '\"', \"`\"]);\r\n  let mode = MAIN;\r\n  let strlit;\r\n  let escape = false;\r\n\r\n  for (let i = 0; i < buf.length; i++) {\r\n    let p = i > 0 ? buf[i - 1] : undefined;\r\n    let c = buf[i];\r\n    let n = i < buf.length - 1 ? buf[i + 1] : undefined;\r\n\r\n    switch (mode) {\r\n      case MAIN:\r\n        if (c === \"/\" && n === \"/\") {\r\n          mode = COMMENT;\r\n          continue;\r\n        }\r\n\r\n        if (strs.has(c)) {\r\n          strlit = c;\r\n          mode = STR;\r\n        }\r\n\r\n        s += c;\r\n\r\n        break;\r\n      case COMMENT:\r\n        if (n === \"\\n\") {\r\n          mode = MAIN;\r\n        }\r\n        break;\r\n      case STR:\r\n        if (c === strlit && !escape) {\r\n          mode = MAIN;\r\n        }\r\n\r\n        s += c;\r\n        break;\r\n    }\r\n\r\n    if (c === \"\\\\\") {\r\n      escape ^= true;\r\n    } else {\r\n      escape = false;\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction StructParser() {\r\n  let basic_types = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"short\", \"byte\", \"sbyte\", \"bool\", \"uint\", \"ushort\"\r\n  ]);\r\n\r\n  let reserved_tokens = new Set([\r\n    \"int\", \"float\", \"double\", \"string\", \"static_string\", \"array\",\r\n    \"iter\", \"abstract\", \"short\", \"byte\", \"sbyte\", \"bool\", \"iterkeys\", \"uint\", \"ushort\",\r\n    \"static_array\"\r\n  ]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z0-9_\\.$]*/, function (t) {\r\n\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n      return t;\r\n    }, \"identifier\"),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"EQUALS\", /=/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"STRLIT\", /\\\"[^\"]*\\\"/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"STRLIT\", /\\'[^']*\\'/, t => {\r\n      t.value = t.value.slice(1, t.value.length - 1);\r\n      return t;\r\n    }),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"SOPEN\", /\\[/),\r\n    tk(\"SCLOSE\", /\\]/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\";\r\n      let lexer = t.lexer;\r\n      let p;\r\n\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        if (c === \"/\" && p === \"/\") {\r\n          js = js.slice(0, js.length - 1);\r\n          lexer.lexpos--;\r\n\r\n          break;\r\n        }\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n        p = c;\r\n      }\r\n\r\n      while (js.trim().endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n      t.value = js.trim();\r\n      return t;\r\n    }),\r\n    tk(\"COMMENT\", /\\/\\/.*[\\n\\r]/),\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]+/, undefined, \"number\"),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }, \"newline\"),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n    }, \"whitespace\")\r\n  ];\r\n\r\n  reserved_tokens.forEach(function (rt) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  });\r\n\r\n  function errfunc(lexer) {\r\n    return true;\r\n  }\r\n\r\n  class Lexer extends lexer {\r\n    input(str) {\r\n      //str = stripComments(str);\r\n      return super.input(str);\r\n    }\r\n  }\r\n\r\n  let lex = new Lexer(tokens, errfunc);\r\n  let parser$1 = new parser(lex);\r\n\r\n  function p_Static_String(p) {\r\n    p.expect(\"STATIC_STRING\");\r\n    p.expect(\"SOPEN\");\r\n    let num = p.expect(\"NUM\");\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_STRING, data: {maxlength: num}}\r\n  }\r\n\r\n  function p_DataRef(p) {\r\n    p.expect(\"DATAREF\");\r\n    p.expect(\"LPARAM\");\r\n    let tname = p.expect(\"ID\");\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.DATAREF, data: tname}\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n    let arraytype = p_Type(p);\r\n\r\n    let itername = \"\";\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ARRAY, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Iter(p) {\r\n    p.expect(\"ITER\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITER, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_StaticArray(p) {\r\n    p.expect(\"STATIC_ARRAY\");\r\n    p.expect(\"SOPEN\");\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    p.expect(\"COMMA\");\r\n    let size = p.expect(\"NUM\");\r\n\r\n    if (size < 0 || Math.abs(size - Math.floor(size)) > 0.000001) {\r\n      console.log(Math.abs(size - Math.floor(size)));\r\n      p.error(\"Expected an integer\");\r\n    }\r\n\r\n    size = Math.floor(size);\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = p_Type(p).data;\r\n    }\r\n\r\n    p.expect(\"SCLOSE\");\r\n    return {type: StructEnum.STATIC_ARRAY, data: {type: arraytype, size: size, iname: itername}}\r\n  }\r\n\r\n  function p_IterKeys(p) {\r\n    p.expect(\"ITERKEYS\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype.data.replace(/\"/g, \"\");\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n    return {type: StructEnum.ITERKEYS, data: {type: arraytype, iname: itername}}\r\n  }\r\n\r\n  function p_Abstract(p) {\r\n    p.expect(\"ABSTRACT\");\r\n    p.expect(\"LPARAM\");\r\n    let type = p.expect(\"ID\");\r\n\r\n    let jsonKeyword = \"_structName\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      jsonKeyword = p.expect(\"STRLIT\");\r\n    }\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      data: type,\r\n      jsonKeyword\r\n    }\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peeknext();\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: StructEnum.STRUCT, data: tok.value}\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: StructTypes[tok.type.toLowerCase()]}\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else if (tok.type === \"ITER\") {\r\n      return p_Iter(p);\r\n    } else if (tok.type === \"ITERKEYS\") {\r\n      return p_IterKeys(p);\r\n    } else if (tok.type === \"STATIC_ARRAY\") {\r\n      return p_StaticArray(p);\r\n    } else if (tok.type === \"STATIC_STRING\") {\r\n      return p_Static_String(p);\r\n    } else if (tok.type === \"ABSTRACT\") {\r\n      return p_Abstract(p);\r\n    } else if (tok.type === \"DATAREF\") {\r\n      return p_DataRef(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type);\r\n    }\r\n  }\r\n\r\n  function p_ID_or_num(p) {\r\n    let t = p.peeknext();\r\n\r\n    if (t.type === \"NUM\") {\r\n      p.next();\r\n      return t.value;\r\n    } else {\r\n      return p.expect(\"ID\", \"struct field name\");\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {};\r\n\r\n    field.name = p_ID_or_num(p);\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let check = 0;\r\n\r\n    let tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      check = 1;\r\n\r\n      p.next();\r\n      tok = p.peeknext();\r\n    }\r\n\r\n    if (tok && tok.type === \"JSCRIPT\") {\r\n      check = 1;\r\n      field.set = tok.value;\r\n\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    tok = p.peeknext();\r\n\r\n    if (tok && tok.type === \"COMMENT\") {\r\n      field.comment = tok.value;\r\n      p.next();\r\n    } else {\r\n      field.comment = \"\";\r\n    }\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let name = p.expect(\"ID\", \"struct name\");\r\n\r\n    let st = new NStruct(name);\r\n\r\n    let tok = p.peeknext();\r\n    let id = -1;\r\n\r\n    if (tok.type === \"ID\" && tok.value === \"id\") {\r\n      p.next();\r\n      p.expect(\"EQUALS\");\r\n      st.id = p.expect(\"NUM\");\r\n    }\r\n\r\n    p.expect(\"OPEN\");\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  parser$1.start = p_Struct;\r\n  return parser$1;\r\n}\r\n\r\nconst struct_parse = StructParser();\r\n\r\nvar struct_parser = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  NStruct: NStruct,\r\n  StructEnum: StructEnum,\r\n  ArrayTypes: ArrayTypes,\r\n  ValueTypes: ValueTypes,\r\n  StructTypes: StructTypes,\r\n  StructTypeMap: StructTypeMap,\r\n  stripComments: stripComments,\r\n  struct_parse: struct_parse\r\n});\r\n\r\n/** dead file */\r\n\r\nvar struct_typesystem = /*#__PURE__*/Object.freeze({\r\n  __proto__: null\r\n});\r\n\r\n\"use strict\";\r\n\r\nvar STRUCT_ENDIAN = true; //little endian\r\n\r\nfunction setBinaryEndian(mode) {\r\n  STRUCT_ENDIAN = !!mode;\r\n}\r\n\r\nlet temp_dataview = new DataView(new ArrayBuffer(16));\r\nlet uint8_view = new Uint8Array(temp_dataview.buffer);\r\n\r\nclass unpack_context {\r\n  constructor() {\r\n    this.i = 0;\r\n  }\r\n}\r\n\r\nfunction pack_byte(array, val) {\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_sbyte(array, val) {\r\n  if (val < 0) {\r\n    val = 256 + val;\r\n  }\r\n\r\n  array.push(val);\r\n}\r\n\r\nfunction pack_bytes(array, bytes) {\r\n  for (let i = 0; i < bytes.length; i++) {\r\n    array.push(bytes[i]);\r\n  }\r\n}\r\n\r\nfunction pack_int(array, val) {\r\n  temp_dataview.setInt32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_uint(array, val) {\r\n  temp_dataview.setUint32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_ushort(array, val) {\r\n  temp_dataview.setUint16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction pack_float(array, val) {\r\n  temp_dataview.setFloat32(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n}\r\n\r\nfunction pack_double(array, val) {\r\n  temp_dataview.setFloat64(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n  array.push(uint8_view[2]);\r\n  array.push(uint8_view[3]);\r\n  array.push(uint8_view[4]);\r\n  array.push(uint8_view[5]);\r\n  array.push(uint8_view[6]);\r\n  array.push(uint8_view[7]);\r\n}\r\n\r\nfunction pack_short(array, val) {\r\n  temp_dataview.setInt16(0, val, STRUCT_ENDIAN);\r\n\r\n  array.push(uint8_view[0]);\r\n  array.push(uint8_view[1]);\r\n}\r\n\r\nfunction encode_utf8(arr, str) {\r\n  for (let i = 0; i < str.length; i++) {\r\n    let c = str.charCodeAt(i);\r\n\r\n    while (c !== 0) {\r\n      let uc = c & 127;\r\n      c = c >> 7;\r\n\r\n      if (c !== 0)\r\n        uc |= 128;\r\n\r\n      arr.push(uc);\r\n    }\r\n  }\r\n}\r\n\r\nfunction decode_utf8(arr) {\r\n  let str = \"\";\r\n  let i = 0;\r\n\r\n  while (i < arr.length) {\r\n    let c = arr[i];\r\n    let sum = c & 127;\r\n    let j = 0;\r\n    let lasti = i;\r\n\r\n    while (i < arr.length && (c & 128)) {\r\n      j += 7;\r\n      i++;\r\n      c = arr[i];\r\n\r\n      c = (c & 127) << j;\r\n      sum |= c;\r\n    }\r\n\r\n    if (sum === 0) break;\r\n\r\n    str += String.fromCharCode(sum);\r\n    i++;\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction test_utf8() {\r\n  let s = \"a\" + String.fromCharCode(8800) + \"b\";\r\n  let arr = [];\r\n\r\n  encode_utf8(arr, s);\r\n  let s2 = decode_utf8(arr);\r\n\r\n  if (s !== s2) {\r\n    throw new Error(\"UTF-8 encoding/decoding test failed\");\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction truncate_utf8(arr, maxlen) {\r\n  let len = Math.min(arr.length, maxlen);\r\n\r\n  let last_codepoint = 0;\r\n  let last2 = 0;\r\n\r\n  let incode = false;\r\n  let i = 0;\r\n  let code = 0;\r\n  while (i < len) {\r\n    incode = arr[i] & 128;\r\n\r\n    if (!incode) {\r\n      last2 = last_codepoint + 1;\r\n      last_codepoint = i + 1;\r\n    }\r\n\r\n    i++;\r\n  }\r\n\r\n  if (last_codepoint < maxlen)\r\n    arr.length = last_codepoint;\r\n  else\r\n    arr.length = last2;\r\n\r\n  return arr;\r\n}\r\n\r\nlet _static_sbuf_ss = new Array(2048);\r\n\r\nfunction pack_static_string(data, str, length) {\r\n  if (length === undefined)\r\n    throw new Error(\"'length' paremter is not optional for pack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_sbuf_ss : new Array();\r\n  arr.length = 0;\r\n\r\n  encode_utf8(arr, str);\r\n  truncate_utf8(arr, length);\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    if (i >= arr.length) {\r\n      data.push(0);\r\n    } else {\r\n      data.push(arr[i]);\r\n    }\r\n  }\r\n}\r\n\r\nlet _static_sbuf = new Array(32);\r\n\r\n/*strings are packed as 32-bit unicode codepoints*/\r\nfunction pack_string(data, str) {\r\n  _static_sbuf.length = 0;\r\n  encode_utf8(_static_sbuf, str);\r\n\r\n  pack_int(data, _static_sbuf.length);\r\n\r\n  for (let i = 0; i < _static_sbuf.length; i++) {\r\n    data.push(_static_sbuf[i]);\r\n  }\r\n}\r\n\r\nfunction unpack_bytes(dview, uctx, len) {\r\n  let ret = new DataView(dview.buffer.slice(uctx.i, uctx.i + len));\r\n  uctx.i += len;\r\n\r\n  return ret;\r\n}\r\n\r\nfunction unpack_byte(dview, uctx) {\r\n  return dview.getUint8(uctx.i++);\r\n}\r\n\r\nfunction unpack_sbyte(dview, uctx) {\r\n  return dview.getInt8(uctx.i++);\r\n}\r\n\r\nfunction unpack_int(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getInt32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_uint(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getUint32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_ushort(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getUint16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_float(dview, uctx) {\r\n  uctx.i += 4;\r\n  return dview.getFloat32(uctx.i - 4, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_double(dview, uctx) {\r\n  uctx.i += 8;\r\n  return dview.getFloat64(uctx.i - 8, STRUCT_ENDIAN);\r\n}\r\n\r\nfunction unpack_short(dview, uctx) {\r\n  uctx.i += 2;\r\n  return dview.getInt16(uctx.i - 2, STRUCT_ENDIAN);\r\n}\r\n\r\nlet _static_arr_us = new Array(32);\r\n\r\nfunction unpack_string(data, uctx) {\r\n  let slen = unpack_int(data, uctx);\r\n\r\n  if (!slen) {\r\n    return \"\";\r\n  }\r\n\r\n  let str = \"\";\r\n  let arr = slen < 2048 ? _static_arr_us : new Array(slen);\r\n\r\n  arr.length = slen;\r\n  for (let i = 0; i < slen; i++) {\r\n    arr[i] = unpack_byte(data, uctx);\r\n  }\r\n\r\n  return decode_utf8(arr);\r\n}\r\n\r\nlet _static_arr_uss = new Array(2048);\r\n\r\nfunction unpack_static_string(data, uctx, length) {\r\n  let str = \"\";\r\n\r\n  if (length === undefined)\r\n    throw new Error(\"'length' cannot be undefined in unpack_static_string()\");\r\n\r\n  let arr = length < 2048 ? _static_arr_uss : new Array(length);\r\n  arr.length = 0;\r\n\r\n  let done = false;\r\n  for (let i = 0; i < length; i++) {\r\n    let c = unpack_byte(data, uctx);\r\n\r\n    if (c === 0) {\r\n      done = true;\r\n    }\r\n\r\n    if (!done && c !== 0) {\r\n      arr.push(c);\r\n      //arr.length++;\r\n    }\r\n  }\r\n\r\n  truncate_utf8(arr, length);\r\n  return decode_utf8(arr);\r\n}\r\n\r\nvar struct_binpack = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  get STRUCT_ENDIAN () { return STRUCT_ENDIAN; },\r\n  setBinaryEndian: setBinaryEndian,\r\n  temp_dataview: temp_dataview,\r\n  uint8_view: uint8_view,\r\n  unpack_context: unpack_context,\r\n  pack_byte: pack_byte,\r\n  pack_sbyte: pack_sbyte,\r\n  pack_bytes: pack_bytes,\r\n  pack_int: pack_int,\r\n  pack_uint: pack_uint,\r\n  pack_ushort: pack_ushort,\r\n  pack_float: pack_float,\r\n  pack_double: pack_double,\r\n  pack_short: pack_short,\r\n  encode_utf8: encode_utf8,\r\n  decode_utf8: decode_utf8,\r\n  test_utf8: test_utf8,\r\n  pack_static_string: pack_static_string,\r\n  pack_string: pack_string,\r\n  unpack_bytes: unpack_bytes,\r\n  unpack_byte: unpack_byte,\r\n  unpack_sbyte: unpack_sbyte,\r\n  unpack_int: unpack_int,\r\n  unpack_uint: unpack_uint,\r\n  unpack_ushort: unpack_ushort,\r\n  unpack_float: unpack_float,\r\n  unpack_double: unpack_double,\r\n  unpack_short: unpack_short,\r\n  unpack_string: unpack_string,\r\n  unpack_static_string: unpack_static_string\r\n});\r\n\r\nlet warninglvl$1 = 2;\r\nlet debug = 0;\r\n\r\nlet _static_envcode_null$1 = \"\";\r\nlet packer_debug$1, packer_debug_start$1, packer_debug_end$1;\r\nlet packdebug_tablevel = 0;\r\n\r\nfunction _get_pack_debug() {\r\n  return {\r\n    packer_debug: packer_debug$1, packer_debug_start: packer_debug_start$1, packer_debug_end: packer_debug_end$1,\r\n    debug, warninglvl: warninglvl$1\r\n  }\r\n}\r\n\r\nclass cachering extends Array {\r\n  constructor(cb, tot) {\r\n    super();\r\n    this.length = tot;\r\n    this.cur = 0;\r\n\r\n    for (let i = 0; i < tot; i++) {\r\n      this[i] = cb();\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, tot) {\r\n    return new cachering(() => new cls(), tot);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n\r\n    this.cur = (this.cur + 1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction gen_tabstr$1(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction setWarningMode2(t) {\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl$1 = t;\r\n}\r\n\r\nfunction setDebugMode2(t) {\r\n  debug = t;\r\n\r\n  if (debug) {\r\n    packer_debug$1 = function () {\r\n      let tab = gen_tabstr$1(packdebug_tablevel);\r\n\r\n      if (arguments.length > 0) {\r\n        console.warn(tab, ...arguments);\r\n      } else {\r\n        console.warn(\"Warning: undefined msg\");\r\n      }\r\n    };\r\n    packer_debug_start$1 = function (funcname) {\r\n      packer_debug$1(\"Start \" + funcname);\r\n      packdebug_tablevel++;\r\n    };\r\n\r\n    packer_debug_end$1 = function (funcname) {\r\n      packdebug_tablevel--;\r\n\r\n      if (funcname) {\r\n        packer_debug$1(\"Leave \" + funcname);\r\n      }\r\n    };\r\n  } else {\r\n    packer_debug$1 = function () {\r\n    };\r\n    packer_debug_start$1 = function () {\r\n    };\r\n    packer_debug_end$1 = function () {\r\n    };\r\n  }\r\n}\r\n\r\nsetDebugMode2(debug);\r\n\r\nconst StructFieldTypes = [];\r\nconst StructFieldTypeMap = {};\r\n\r\nfunction packNull(manager, data, field, type) {\r\n  StructFieldTypeMap[type.type].packNull(manager, data, field, type);\r\n}\r\n\r\nfunction toJSON(manager, val, obj, field, type) {\r\n  return StructFieldTypeMap[type.type].toJSON(manager, val, obj, field, type);\r\n}\r\n\r\nfunction fromJSON(manager, val, obj, field, type, instance) {\r\n  return StructFieldTypeMap[type.type].fromJSON(manager, val, obj, field, type, instance);\r\n}\r\n\r\nfunction formatJSON$1(manager, val, obj, field, type, instance, tlvl = 0) {\r\n  return StructFieldTypeMap[type.type].formatJSON(manager, val, obj, field, type, instance, tlvl);\r\n}\r\n\r\nfunction validateJSON$1(manager, val, obj, field, type, instance, _abstractKey) {\r\n  return StructFieldTypeMap[type.type].validateJSON(manager, val, obj, field, type, instance, _abstractKey);\r\n}\r\n\r\n\r\nfunction unpack_field(manager, data, type, uctx) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start$1(\"R \" + name);\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[type.type].unpack(manager, data, type, uctx);\r\n\r\n  if (debug) {\r\n    packer_debug_end$1();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet fakeFields = new cachering(() => {\r\n  return {type: undefined, get: undefined, set: undefined}\r\n}, 256);\r\n\r\nfunction fmt_type(type) {\r\n  return StructFieldTypeMap[type.type].format(type);\r\n}\r\n\r\nfunction do_pack(manager, data, val, obj, field, type) {\r\n  let name;\r\n\r\n  if (debug) {\r\n    name = StructFieldTypeMap[type.type].define().name;\r\n    packer_debug_start$1(\"W \" + name);\r\n  }\r\n\r\n  let typeid = type;\r\n  if (typeof typeid !== \"number\") {\r\n    typeid = typeid.type;\r\n  }\r\n\r\n  let ret = StructFieldTypeMap[typeid].pack(manager, data, val, obj, field, type);\r\n\r\n  if (debug) {\r\n    packer_debug_end$1();\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _ws_env$1 = [[undefined, undefined]];\r\n\r\nclass StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, 0, 0, field, type);\r\n  }\r\n\r\n  static format(type) {\r\n    return this.define().name;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return val;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    return val;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return JSON.stringify(val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   return false to override default\r\n   helper js for packing\r\n   */\r\n  static useHelperJS(field) {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   Define field class info.\r\n\r\n   Example:\r\n   <pre>\r\n   static define() {return {\r\n    type : StructEnum.INT,\r\n    name : \"int\"\r\n  }}\r\n   </pre>\r\n   */\r\n  static define() {\r\n    return {\r\n      type: -1,\r\n      name: \"(error)\"\r\n    }\r\n  }\r\n\r\n  /**\r\n   Register field packer/unpacker class.  Will throw an error if define() method is bad.\r\n   */\r\n  static register(cls) {\r\n    if (StructFieldTypes.indexOf(cls) >= 0) {\r\n      throw new Error(\"class already registered\");\r\n    }\r\n\r\n    if (cls.define === StructFieldType.define) {\r\n      throw new Error(\"you forgot to make a define() static method\");\r\n    }\r\n\r\n    if (cls.define().type === undefined) {\r\n      throw new Error(\"cls.define().type was undefined!\");\r\n    }\r\n\r\n    if (cls.define().type in StructFieldTypeMap) {\r\n      throw new Error(\"type \" + cls.define().type + \" is used by another StructFieldType subclass\");\r\n    }\r\n\r\n    StructFieldTypes.push(cls);\r\n    StructFieldTypeMap[cls.define().type] = cls;\r\n  }\r\n}\r\n\r\nclass StructIntField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_int(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_int(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.INT,\r\n      name: \"int\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIntField);\r\n\r\nclass StructFloatField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_float(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_float(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a float: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.FLOAT,\r\n      name: \"float\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructFloatField);\r\n\r\nclass StructDoubleField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_double(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_double(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\") {\r\n      return \"Not a double: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.DOUBLE,\r\n      name: \"double\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructDoubleField);\r\n\r\nclass StructStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_string(data, val);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_string(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRING,\r\n      name: \"string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStringField);\r\n\r\nclass StructStaticStringField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    val = !val ? \"\" : val;\r\n\r\n    pack_static_string(data, val, type.data.maxlength);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"string\") {\r\n      return \"Not a string: \" + val;\r\n    }\r\n\r\n\r\n    if (val.length > type.data.maxlength) {\r\n      return \"String is too big; limit is \" + type.data.maxlength + \"; string:\" + val;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static format(type) {\r\n    return `static_string[${type.data.maxlength}]`;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    this.pack(manager, data, \"\", 0, field, type);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_static_string(data, uctx, type.data.maxlength);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_STRING,\r\n      name: \"static_string\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticStringField);\r\n\r\nclass StructStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug$1(\"struct\", stt.name);\r\n\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    if (!val) {\r\n      return \"Expected \" + stt.name + \" object\";\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, _abstractKey);\r\n  }\r\n\r\n  static format(type) {\r\n    return type.data;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n    return manager.writeJSON(val, stt);\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n\r\n    packer_debug$1(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    packer_debug$1(\"struct\", type);\r\n\r\n    for (let field2 of stt.fields) {\r\n      let type2 = field2.type;\r\n\r\n      packNull(manager, data, field2, type2);\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let cls2 = manager.get_struct_cls(type.data);\r\n    packer_debug$1(\"struct\", cls2 ? cls2.name : \"(error)\");\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STRUCT,\r\n      name: \"struct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStructField);\r\n\r\nclass StructTStructField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    let cls = manager.get_struct_cls(type.data);\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    //make sure inheritance is correct\r\n    if (val.constructor.structName !== type.data && (val instanceof cls)) {\r\n      //if (DEBUG.Struct) {\r\n      //    console.log(val.constructor.structName+\" inherits from \"+cls.structName);\r\n      //}\r\n      stt = manager.get_struct(val.constructor.structName);\r\n    } else if (val.constructor.structName === type.data) {\r\n      stt = manager.get_struct(type.data);\r\n    } else {\r\n      console.trace();\r\n      throw new Error(\"Bad struct \" + val.constructor.structName + \" passed to write_struct\");\r\n    }\r\n\r\n    packer_debug$1(\"int \" + stt.id);\r\n\r\n    pack_int(data, stt.id);\r\n    manager.write_struct(data, val, stt);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    let key = type.jsonKeyword;\r\n\r\n    if (typeof val !== \"object\") {\r\n      return typeof val + \" is not an object\";\r\n    }\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n    let cls = manager.get_struct_cls(stt.name);\r\n    let parentcls = manager.get_struct_cls(type.data);\r\n\r\n    let ok = false;\r\n\r\n    do {\r\n      if (cls === parentcls) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      cls = cls.prototype.__proto__.constructor;\r\n    } while (cls && cls !== Object);\r\n\r\n    if (!ok) {\r\n      return stt.name + \" is not a child class off \" + type.data;\r\n    }\r\n\r\n    return manager.validateJSONIntern(val, stt, type.jsonKeyword);\r\n  }\r\n\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.readJSON(val, stt, instance);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    let key = type.jsonKeyword;\r\n\r\n    let stt = manager.get_struct(val[key]);\r\n\r\n    return manager.formatJSON_intern(val, stt, field, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    const keywords = manager.constructor.keywords;\r\n\r\n    let stt = manager.get_struct(val.constructor.structName);\r\n    let ret = manager.writeJSON(val, stt);\r\n\r\n    ret[type.jsonKeyword] = \"\" + stt.name;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let stt = manager.get_struct(type.data);\r\n\r\n    pack_int(data, stt.id);\r\n    packNull(manager, data, field, {type: StructEnum.STRUCT, data: type.data});\r\n  }\r\n\r\n  static format(type) {\r\n    return \"abstract(\" + type.data + \")\";\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug$1(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug$1(\"struct name: \" + cls2.name);\r\n\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx, dest);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let id = unpack_int(data, uctx);\r\n\r\n    packer_debug$1(\"-int \" + id);\r\n    if (!(id in manager.struct_ids)) {\r\n      packer_debug$1(\"tstruct id: \" + id);\r\n      console.trace();\r\n      console.log(id);\r\n      console.log(manager.struct_ids);\r\n      throw new Error(\"Unknown struct type \" + id + \".\");\r\n    }\r\n\r\n    let cls2 = manager.get_struct_id(id);\r\n\r\n    packer_debug$1(\"struct name: \" + cls2.name);\r\n    cls2 = manager.struct_cls[cls2.name];\r\n\r\n    return manager.read_object(data, cls2, uctx);\r\n    //packer_debug(\"ret\", ret);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.TSTRUCT,\r\n      name: \"tstruct\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructTStructField);\r\n\r\n/** out is just a [string], an array of dimen 1 whose sole entry is the output string. */\r\nfunction formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array = val) {\r\n  if (array === undefined || array === null || typeof array !== \"object\" || !array[Symbol.iterator]) {\r\n    console.log(obj);\r\n    console.log(array);\r\n    throw new Error(`Expected an array for ${field.name}`);\r\n  }\r\n\r\n  if (ValueTypes.has(type2.type)) {\r\n    return JSON.stringify(array);\r\n  }\r\n\r\n  let s = '[';\r\n  if (manager.formatCtx.addComments && field.comment.trim()) {\r\n    s += \" \" + field.comment.trim();\r\n  }\r\n\r\n  s += \"\\n\";\r\n\r\n  for (let i = 0; i < array.length; i++) {\r\n    let item = array[i];\r\n\r\n    s += tab(tlvl + 1) + formatJSON$1(manager, item, val, field, type2, instance, tlvl + 1) + \",\\n\";\r\n  }\r\n\r\n  s += tab(tlvl) + \"]\";\r\n\r\n  return s;\r\n}\r\n\r\nclass StructArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (val === undefined) {\r\n      console.trace();\r\n      console.log(\"Undefined array fed to struct struct packer!\");\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n      packer_debug$1(\"int 0\");\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    packer_debug$1(\"int \" + val.length);\r\n    pack_int(data, val.length);\r\n\r\n    let d = type.data;\r\n\r\n    let itername = d.iname;\r\n    let type2 = d.type;\r\n\r\n    let env = _ws_env$1;\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n    }\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"array(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance, _abstractKey) {\r\n    if (!val) {\r\n      return \"not an array: \" + val;\r\n    }\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let ret = validateJSON$1(manager, val[i], val, field, type.data.type, undefined, _abstractKey);\r\n\r\n      if (typeof ret === \"string\" || !ret) {\r\n        return ret;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    let ret = instance || [];\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = fromJSON(manager, val[i], val, field, type.data.type, undefined);\r\n\r\n      if (val2 === undefined) {\r\n        console.log(val2);\r\n        console.error(\"eeek\");\r\n        process.exit();\r\n      }\r\n\r\n      ret.push(val2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    //export function formatArrayJson(manager, val, obj, field, type, type2, instance, tlvl, array=val) {\r\n\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let i = 0; i < val.length; i++) {\r\n      let val2 = val[i];\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, dest) {\r\n    let len = unpack_int(data, uctx);\r\n    dest.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      dest.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ARRAY,\r\n      name: \"array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructArrayField);\r\n\r\nclass StructIterField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    function forEach(cb, thisvar) {\r\n      if (val && val[Symbol.iterator]) {\r\n        for (let item of val) {\r\n          cb.call(thisvar, item);\r\n        }\r\n      } else if (val && val.forEach) {\r\n        val.forEach(function (item) {\r\n          cb.call(thisvar, item);\r\n        });\r\n      } else {\r\n        console.trace();\r\n        console.log(\"Undefined iterable list fed to struct struct packer!\", val);\r\n        console.log(\"Field: \", field);\r\n        console.log(\"Type: \", type);\r\n        console.log(\"\");\r\n      }\r\n    }\r\n\r\n    /* save space for length */\r\n    let starti = data.length;\r\n    data.length += 4;\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env$1;\r\n\r\n    let i = 0;\r\n    forEach(function (val2) {\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      //XXX not sure I really need this fakeField stub here. . .\r\n      let fakeField = fakeFields.next();\r\n      fakeField.type = type2;\r\n      do_pack(manager, data, val2, obj, fakeField, type2);\r\n\r\n      i++;\r\n    }, this);\r\n\r\n    /* write length */\r\n    temp_dataview.setInt32(0, i, STRUCT_ENDIAN);\r\n\r\n    data[starti++] = uint8_view[0];\r\n    data[starti++] = uint8_view[1];\r\n    data[starti++] = uint8_view[2];\r\n    data[starti++] = uint8_view[3];\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let val2 of val) {\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iter(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iter(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITER,\r\n      name: \"iter\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterField);\r\n\r\nclass StructShortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_short(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_short(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SHORT,\r\n      name: \"short\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructShortField);\r\n\r\nclass StructByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_byte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BYTE,\r\n      name: \"byte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructByteField);\r\n\r\nclass StructSignedByteField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_sbyte(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_sbyte(data, uctx);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.SIGNED_BYTE,\r\n      name: \"sbyte\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructSignedByteField);\r\n\r\nclass StructBoolField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_byte(data, !!val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return !!unpack_byte(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (val === 0 || val === 1 || val === true || val === false || val === \"true\" || val === \"false\") {\r\n      return true;\r\n    }\r\n\r\n    return \"\" + val + \" is not a bool\";\r\n  }\r\n\r\n  static fromJSON(manager, val, obj, field, type, instance) {\r\n    if (val === \"false\") {\r\n      val = false;\r\n    }\r\n\r\n    return !!val;\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return !!val;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.BOOL,\r\n      name: \"bool\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructBoolField);\r\n\r\nclass StructIterKeysField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    //this was originally implemented to use ES6 iterators.\r\n    if ((typeof val !== \"object\" && typeof val !== \"function\") || val === null) {\r\n      console.warn(\"Bad object fed to iterkeys in struct packer!\", val);\r\n      console.log(\"Field: \", field);\r\n      console.log(\"Type: \", type);\r\n      console.log(\"\");\r\n\r\n      pack_int(data, 0);\r\n      return;\r\n    }\r\n\r\n    let len = 0.0;\r\n    for (let k in val) {\r\n      len++;\r\n    }\r\n\r\n    packer_debug$1(\"int \" + len);\r\n    pack_int(data, len);\r\n\r\n    let d = type.data, itername = d.iname, type2 = d.type;\r\n    let env = _ws_env$1;\r\n\r\n    let i = 0;\r\n    for (let val2 in val) {\r\n      if (i >= len) {\r\n        if (warninglvl$1 > 0) {\r\n          console.warn(\"Warning: object keys magically replaced during iteration\", val, i);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (itername && itername.trim().length > 0 && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      } else {\r\n        val2 = val[val2]; //fetch value\r\n      }\r\n\r\n      let f2 = {type: type2, get: undefined, set: undefined};\r\n      do_pack(manager, data, val2, obj, f2, type2);\r\n\r\n      i++;\r\n    }\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    val = val || [];\r\n    let json = [];\r\n\r\n    let itername = type.data.iname;\r\n\r\n    for (let k in val) {\r\n      let val2 = val[k];\r\n      let env = _ws_env$1;\r\n\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n\r\n        //console.log(\"VAL2\", val2, toJSON(manager, val2, val, field, type.data.type));\r\n      }\r\n\r\n      json.push(toJSON(manager, val2, val, field, type.data.type));\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    pack_int(data, 0);\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static format(type) {\r\n    if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n      return \"iterkeys(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n    } else {\r\n      return \"iterkeys(\" + fmt_type(type.data.type) + \")\";\r\n    }\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, arr) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    arr.length = 0;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      arr.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    let len = unpack_int(data, uctx);\r\n    packer_debug$1(\"-int \" + len);\r\n\r\n    let arr = new Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n      arr[i] = unpack_field(manager, data, type.data.type, uctx);\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.ITERKEYS,\r\n      name: \"iterkeys\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructIterKeysField);\r\n\r\nclass StructUintField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_uint(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_uint(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.UINT,\r\n      name: \"uint\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUintField);\r\n\r\n\r\nclass StructUshortField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    pack_ushort(data, val);\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    return unpack_ushort(data, uctx);\r\n  }\r\n\r\n  static validateJSON(manager, val, obj, field, type, instance) {\r\n    if (typeof val !== \"number\" || val !== Math.floor(val)) {\r\n      return \"\" + val + \" is not an integer\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.USHORT,\r\n      name: \"ushort\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructUshortField);\r\n\r\n//let writeEmpty = writeEmpty = function writeEmpty(stt) {\r\n//}\r\n\r\nclass StructStaticArrayField extends StructFieldType {\r\n  static pack(manager, data, val, obj, field, type) {\r\n    if (type.data.size === undefined) {\r\n      throw new Error(\"type.data.size was undefined\");\r\n    }\r\n\r\n    let itername = type.data.iname;\r\n\r\n    if (val === undefined || !val.length) {\r\n      this.packNull(manager, data, field, type);\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      let i2 = Math.min(i, Math.min(val.length - 1, type.data.size));\r\n      let val2 = val[i2];\r\n\r\n      //*\r\n      if (itername !== \"\" && itername !== undefined && field.get) {\r\n        let env = _ws_env$1;\r\n        env[0][0] = itername;\r\n        env[0][1] = val2;\r\n        val2 = manager._env_call(field.get, obj, env);\r\n      }\r\n\r\n      do_pack(manager, data, val2, val, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static useHelperJS(field) {\r\n    return !field.type.data.iname;\r\n  }\r\n\r\n  static validateJSON() {\r\n    return StructArrayField.validateJSON(...arguments);\r\n  }\r\n\r\n  static fromJSON() {\r\n    return StructArrayField.fromJSON(...arguments);\r\n  }\r\n\r\n  static formatJSON(manager, val, obj, field, type, instance, tlvl) {\r\n    return formatArrayJson(manager, val, obj, field, type, type.data.type, instance, tlvl, list(val));\r\n  }\r\n\r\n  static packNull(manager, data, field, type) {\r\n    let size = type.data.size;\r\n    for (let i = 0; i < size; i++) {\r\n      packNull(manager, data, field, type.data.type);\r\n    }\r\n  }\r\n\r\n  static toJSON(manager, val, obj, field, type) {\r\n    return StructArrayField.toJSON(...arguments);\r\n  }\r\n\r\n  static format(type) {\r\n    let type2 = StructFieldTypeMap[type.data.type.type].format(type.data.type);\r\n\r\n    let ret = `static_array[${type2}, ${type.data.size}`;\r\n\r\n    if (type.data.iname) {\r\n      ret += `, ${type.data.iname}`;\r\n    }\r\n    ret += `]`;\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpackInto(manager, data, type, uctx, ret) {\r\n    packer_debug$1(\"-size: \" + type.data.size);\r\n\r\n    ret.length = 0;\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static unpack(manager, data, type, uctx) {\r\n    packer_debug$1(\"-size: \" + type.data.size);\r\n\r\n    let ret = [];\r\n\r\n    for (let i = 0; i < type.data.size; i++) {\r\n      ret.push(unpack_field(manager, data, type.data.type, uctx));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      type: StructEnum.STATIC_ARRAY,\r\n      name: \"static_array\"\r\n    }\r\n  }\r\n}\r\n\r\nStructFieldType.register(StructStaticArrayField);\r\n\r\nvar _sintern2 = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  _get_pack_debug: _get_pack_debug,\r\n  setWarningMode2: setWarningMode2,\r\n  setDebugMode2: setDebugMode2,\r\n  StructFieldTypes: StructFieldTypes,\r\n  StructFieldTypeMap: StructFieldTypeMap,\r\n  packNull: packNull,\r\n  toJSON: toJSON,\r\n  fromJSON: fromJSON,\r\n  formatJSON: formatJSON$1,\r\n  validateJSON: validateJSON$1,\r\n  do_pack: do_pack,\r\n  StructFieldType: StructFieldType,\r\n  formatArrayJson: formatArrayJson\r\n});\r\n\r\nvar structEval = eval;\r\n\r\nfunction setStructEval(val) {\r\n  structEval = val;\r\n}\r\n\r\nvar _struct_eval = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  get structEval () { return structEval; },\r\n  setStructEval: setStructEval\r\n});\r\n\r\nconst TokSymbol = Symbol(\"token-info\");\r\n\r\nfunction buildJSONParser() {\r\n  let tk = (name, re, func, example) => new tokdef(name, re, func, example);\r\n\r\n  let parse;\r\n\r\n  let nint = \"[+-]?[0-9]+\";\r\n  let nhex = \"[+-]?0x[0-9a-fA-F]+\";\r\n  let nfloat1 = \"[+-]?[0-9]+\\\\.[0-9]*\";\r\n  let nfloat2 = \"[+-]?[0-9]*\\\\.[0-9]+\";\r\n  let nfloat3 = \"[+-]?[0-9]+\\\\.[0-9]+\";\r\n  let nfloatexp = \"[+-]?[0-9]+\\\\.[0-9]+[eE][+-]?[0-9]+\";\r\n\r\n  let nfloat = `(${nfloat1})|(${nfloat2})|(${nfloatexp})`;\r\n  let num = `(${nint})|(${nfloat})|(${nhex})`;\r\n  let numre = new RegExp(num);\r\n\r\n  let numreTest = new RegExp(`(${num})$`);\r\n\r\n  //nfloat3 has to be its own regexp, the parser\r\n  //always chooses the token handler that parses the most input,\r\n  //and we don't want the partial 0. and .0 handles to split\r\n  //e.g. 3.5 into 3 and 0.5\r\n  nfloat3 = new RegExp(nfloat3);\r\n  nfloatexp = new RegExp(nfloatexp);\r\n\r\n  let tests = [\"1.234234\", \".23432\", \"-234.\", \"1e-17\", \"-0x23423ff\", \"+23423\", \"-4.263256414560601e-14\"];\r\n  for (let test of tests) {\r\n    if (!numreTest.test(test)) {\r\n      console.error(\"Error! Number regexp failed:\", test);\r\n    }\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"BOOL\", /true|false/),\r\n    tk(\"WS\", /[ \\r\\t\\n]/, t => undefined), //drop token\r\n    tk(\"STRLIT\", /[\"']/, t => {\r\n      let lex = t.lexer;\r\n      let char = t.value;\r\n      let i = lex.lexpos;\r\n      let lexdata = lex.lexdata;\r\n\r\n      let escape = 0;\r\n      t.value = \"\";\r\n      let prev;\r\n\r\n      while (i < lexdata.length) {\r\n        let c = lexdata[i];\r\n\r\n        t.value += c;\r\n\r\n        if (c === \"\\\\\") {\r\n          escape ^= true;\r\n        } else if (!escape && c === char) {\r\n          break;\r\n        } else {\r\n          escape = false;\r\n        }\r\n\r\n        i++;\r\n      }\r\n\r\n      lex.lexpos = i + 1;\r\n\r\n      if (t.value.length > 0) {\r\n        t.value = t.value.slice(0, t.value.length - 1);\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"LSBRACKET\", /\\[/),\r\n    tk(\"RSBRACKET\", /]/),\r\n    tk(\"LBRACE\", /{/),\r\n    tk(\"RBRACE\", /}/),\r\n    tk(\"NULL\", /null/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"NUM\", numre, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloat3, t => (t.value = parseFloat(t.value), t)),\r\n    tk(\"NUM\", nfloatexp, t => (t.value = parseFloat(t.value), t)),\r\n  ];\r\n\r\n  function tokinfo(t) {\r\n    return {\r\n      lexpos: t.lexpos,\r\n      lineno: t.lineno,\r\n      col   : t.col,\r\n      fields: {},\r\n    };\r\n  }\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"LSBRACKET\");\r\n    let t = p.peeknext();\r\n    let first = true;\r\n\r\n    let ret = [];\r\n\r\n    ret[TokSymbol] = tokinfo(t);\r\n\r\n    while (t && t.type !== \"RSBRACKET\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      ret[TokSymbol].fields[ret.length] = tokinfo(t);\r\n      ret.push(p_Start(p));\r\n\r\n      first = false;\r\n      t = p.peeknext();\r\n    }\r\n    p.expect(\"RSBRACKET\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  function p_Object(p) {\r\n    p.expect(\"LBRACE\");\r\n\r\n    let obj = {};\r\n\r\n    let first = true;\r\n    let t = p.peeknext();\r\n\r\n    obj[TokSymbol] = tokinfo(t);\r\n    while (t && t.type !== \"RBRACE\") {\r\n      if (!first) {\r\n        p.expect(\"COMMA\");\r\n      }\r\n\r\n      let key = p.expect(\"STRLIT\");\r\n      p.expect(\"COLON\");\r\n\r\n      let val = p_Start(p, true);\r\n\r\n      obj[key] = val;\r\n      first = false;\r\n\r\n      t = p.peeknext();\r\n      obj[TokSymbol].fields[key] = tokinfo(t);\r\n    }\r\n\r\n    p.expect(\"RBRACE\");\r\n\r\n    return obj;\r\n  }\r\n\r\n  function p_Start(p, throwError = true) {\r\n    let t = p.peeknext();\r\n    if (t.type === \"LSBRACKET\") {\r\n      return p_Array(p);\r\n    } else if (t.type === \"LBRACE\") {\r\n      return p_Object(p);\r\n    } else if (t.type === \"STRLIT\" || t.type === \"NUM\" || t.type === \"NULL\" || t.type === \"BOOL\") {\r\n      return p.next().value;\r\n    } else {\r\n      p.error(t, \"Unknown token\");\r\n    }\r\n  }\r\n\r\n  function p_Error(token, msg) {\r\n    throw new PUTIL_ParseError(\"Parse Error\");\r\n  }\r\n\r\n  let lex = new lexer(tokens);\r\n  lex.linestart = 0;\r\n  parse = new parser(lex, p_Error);\r\n  parse.start = p_Start;\r\n  //lex.printTokens = true;\r\n\r\n  return parse;\r\n}\r\n\r\nvar jsonParser = buildJSONParser();\r\n\r\n/*\r\nbuildJSONParser().parse(`\r\n{\r\n                \"alteredX\": -110.95731659202336,\r\n                \"alteredY\": -359.9154922611667,\r\n                \"alteredZ\": -4.263256414560601e-14\r\n}\r\n`.trim()) //*/\r\n\r\nfunction printContext(buf, tokinfo, printColors=true) {\r\n  let lines = buf.split(\"\\n\");\r\n\r\n  if (!tokinfo) {\r\n    return '';\r\n  }\r\n\r\n  let lineno = tokinfo.lineno;\r\n  let col = tokinfo.col;\r\n\r\n  let istart = Math.max(lineno-50, 0);\r\n  let iend = Math.min(lineno+2, lines.length-1);\r\n\r\n  let s = '';\r\n\r\n  if (printColors) {\r\n    s += termColor(\"  /* pretty-printed json */\\n\", \"blue\");\r\n  } else {\r\n    s += \"/* pretty-printed json */\\n\";\r\n  }\r\n\r\n  for (let i=istart; i<iend; i++) {\r\n    let l = lines[i];\r\n\r\n    let idx = \"\" + i;\r\n    while (idx.length < 3) {\r\n      idx = \" \" + idx;\r\n    }\r\n\r\n    if (i === lineno && printColors) {\r\n      s += termColor(`${idx}: ${l}\\n`, \"yellow\");\r\n    } else {\r\n      s += `${idx}: ${l}\\n`;\r\n    }\r\n\r\n    if (i === lineno) {\r\n      let l2 = '';\r\n      for (let j=0; j<col+5; j++) {\r\n        l2 += \" \";\r\n      }\r\n\r\n      s += l2 + \"^\\n\";\r\n    }\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nvar nGlobal;\r\n\r\nif (typeof globalThis !== \"undefined\") {\r\n  nGlobal = globalThis;\r\n} else if (typeof window !== \"undefined\") {\r\n  nGlobal = window;\r\n} else if (typeof global !== \"undefined\") {\r\n  nGlobal = global;\r\n} else if (typeof globals !== \"undefined\") {\r\n  nGlobal = globals;\r\n} else if (typeof self !== \"undefined\") {\r\n  nGlobal = self;\r\n}\r\n\r\nconst DEBUG = {};\r\n\r\nfunction updateDEBUG() {\r\n  for (let k in Object.keys(DEBUG)) {\r\n    delete DEBUG[k];\r\n  }\r\n\r\n  if (typeof nGlobal.DEBUG === \"object\") {\r\n    for (let k in nGlobal.DEBUG) {\r\n      DEBUG[k] = nGlobal.DEBUG[k];\r\n    }\r\n  }\r\n}\r\n\r\n\"use strict\";\r\n\r\n//needed to avoid a rollup bug in configurable mode\r\nvar sintern2 = _sintern2;\r\nvar struct_eval = _struct_eval;\r\n\r\nlet warninglvl = 2;\r\n\r\nvar truncateDollarSign$1 = true;\r\nvar manager;\r\n\r\nclass JSONError extends Error {};\r\n\r\nfunction printCodeLines(code) {\r\n  let lines = code.split(String.fromCharCode(10));\r\n  let buf = '';\r\n\r\n  for (let i = 0; i < lines.length; i++) {\r\n    let line = \"\" + (i + 1) + \":\";\r\n\r\n    while (line.length < 3) {\r\n      line += \" \";\r\n    }\r\n\r\n    line += \" \" + lines[i];\r\n    buf += line + String.fromCharCode(10);\r\n  }\r\n\r\n  return buf;\r\n}\r\n\r\nfunction printEvalError(code) {\r\n  console.log(\"== CODE ==\");\r\n  console.log(printCodeLines(code));\r\n\r\n  /* Node suppresses the real error line number in error.stack for some reason.\r\n   * Get it by retriggering the error for real.\r\n   */\r\n  eval(code);\r\n}\r\n\r\nfunction setTruncateDollarSign(v) {\r\n  truncateDollarSign$1 = !!v;\r\n}\r\n\r\nfunction _truncateDollarSign(s) {\r\n  let i = s.search(\"$\");\r\n\r\n  if (i > 0) {\r\n    return s.slice(0, i).trim();\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nfunction unmangle(name) {\r\n  if (truncateDollarSign$1) {\r\n    return _truncateDollarSign(name);\r\n  } else {\r\n    return name;\r\n  }\r\n}\r\n\r\nlet _static_envcode_null = \"\";\r\n\r\n//truncate webpack-mangled names\r\n\r\nfunction gen_tabstr(tot) {\r\n  let ret = \"\";\r\n\r\n  for (let i = 0; i < tot; i++) {\r\n    ret += \" \";\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet packer_debug, packer_debug_start, packer_debug_end;\r\n\r\nfunction update_debug_data() {\r\n  let ret = _get_pack_debug();\r\n\r\n  packer_debug = ret.packer_debug;\r\n  packer_debug_start = ret.packer_debug_start;\r\n  packer_debug_end = ret.packer_debug_end;\r\n  warninglvl = ret.warninglvl;\r\n}\r\n\r\nupdate_debug_data();\r\n\r\nfunction setWarningMode(t) {\r\n  sintern2.setWarningMode2(t);\r\n\r\n  if (typeof t !== \"number\" || isNaN(t)) {\r\n    throw new Error(\"Expected a single number (>= 0) argument to setWarningMode\");\r\n  }\r\n\r\n  warninglvl = t;\r\n}\r\n\r\nfunction setDebugMode(t) {\r\n  sintern2.setDebugMode2(t);\r\n  update_debug_data();\r\n}\r\n\r\nlet _ws_env = [[undefined, undefined]];\r\n\r\nfunction define_empty_class(scls, name) {\r\n  let cls = function () {\r\n  };\r\n\r\n  cls.prototype = Object.create(Object.prototype);\r\n  cls.constructor = cls.prototype.constructor = cls;\r\n\r\n  let keywords = scls.keywords;\r\n\r\n  cls.STRUCT = name + \" {\\n  }\\n\";\r\n  cls.structName = name;\r\n\r\n  cls.prototype.loadSTRUCT = function (reader) {\r\n    reader(this);\r\n  };\r\n\r\n  cls.newSTRUCT = function () {\r\n    return new this();\r\n  };\r\n\r\n  return cls;\r\n}\r\n\r\nlet haveCodeGen;\r\n\r\n//$KEYWORD_CONFIG_START\r\n\r\nclass STRUCT {\r\n  constructor() {\r\n    this.idgen = 0;\r\n    this.allowOverriding = true;\r\n\r\n    this.structs = {};\r\n    this.struct_cls = {};\r\n    this.struct_ids = {};\r\n\r\n    this.compiled_code = {};\r\n    this.null_natives = {};\r\n\r\n    this.define_null_native(\"Object\", Object);\r\n\r\n    this.jsonUseColors = true;\r\n    this.jsonBuf = '';\r\n    this.formatCtx = {};\r\n  }\r\n\r\n  static inherit(child, parent, structName = child.name) {\r\n    const keywords = this.keywords;\r\n\r\n    if (!parent.STRUCT) {\r\n      return structName + \"{\\n\";\r\n    }\r\n\r\n    let stt = struct_parse.parse(parent.STRUCT);\r\n    let code = structName + \"{\\n\";\r\n    code += STRUCT.fmt_struct(stt, true, false, true);\r\n    return code;\r\n  }\r\n\r\n  /** invoke loadSTRUCT methods on parent objects.  note that\r\n   reader() is only called once.  it is called however.*/\r\n  static Super(obj, reader) {\r\n    if (warninglvl > 0) {\r\n      console.warn(\"deprecated\");\r\n    }\r\n\r\n    reader(obj);\r\n\r\n    function reader2(obj) {\r\n    }\r\n\r\n    let cls = obj.constructor;\r\n    let bad = cls === undefined || cls.prototype === undefined || cls.prototype.__proto__ === undefined;\r\n\r\n    if (bad) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n    bad = bad || parent === undefined;\r\n\r\n    if (!bad && parent.prototype.loadSTRUCT && parent.prototype.loadSTRUCT !== obj.loadSTRUCT) { //parent.prototype.hasOwnProperty(\"loadSTRUCT\")) {\r\n      parent.prototype.loadSTRUCT.call(obj, reader2);\r\n    }\r\n  }\r\n\r\n  /** deprecated.  used with old fromSTRUCT interface. */\r\n  static chain_fromSTRUCT(cls, reader) {\r\n    if (warninglvl > 0) {\r\n      console.warn(\"Using deprecated (and evil) chain_fromSTRUCT method, eek!\");\r\n    }\r\n\r\n    let proto = cls.prototype;\r\n    let parent = cls.prototype.prototype.constructor;\r\n\r\n    let obj = parent.fromSTRUCT(reader);\r\n    let obj2 = new cls();\r\n\r\n    let keys = Object.keys(obj).concat(Object.getOwnPropertySymbols(obj));\r\n    //let keys=Object.keys(proto);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n      let k = keys[i];\r\n\r\n      try {\r\n        obj2[k] = obj[k];\r\n      } catch (error) {\r\n        if (warninglvl > 0) {\r\n          console.warn(\"  failed to set property\", k);\r\n        }\r\n      }\r\n      //let k=keys[i];\r\n      //if (k==\"__proto__\")\r\n      // continue;\r\n      //obj[k] = proto[k];\r\n    }\r\n\r\n    /*\r\n    if (proto.toString !== Object.prototype.toString)\r\n      obj2.toString = proto.toString;\r\n    //*/\r\n\r\n    return obj2;\r\n  }\r\n\r\n  //defined_classes is an array of class constructors\r\n  //with STRUCT scripts, *OR* another STRUCT instance\r\n  //\r\n\r\n  static formatStruct(stt, internal_only, no_helper_js) {\r\n    return this.fmt_struct(stt, internal_only, no_helper_js);\r\n  }\r\n\r\n  static fmt_struct(stt, internal_only, no_helper_js, addComments) {\r\n    if (internal_only === undefined)\r\n      internal_only = false;\r\n    if (no_helper_js === undefined)\r\n      no_helper_js = false;\r\n\r\n    let s = \"\";\r\n    if (!internal_only) {\r\n      s += stt.name;\r\n      if (stt.id !== -1)\r\n        s += \" id=\" + stt.id;\r\n      s += \" {\\n\";\r\n    }\r\n    let tab = \"  \";\r\n\r\n    function fmt_type(type) {\r\n      return StructFieldTypeMap[type.type].format(type);\r\n\r\n      if (type.type === StructEnum.ARRAY || type.type === StructEnum.ITER || type.type === StructEnum.ITERKEYS) {\r\n        if (type.data.iname !== \"\" && type.data.iname !== undefined) {\r\n          return \"array(\" + type.data.iname + \", \" + fmt_type(type.data.type) + \")\";\r\n        } else {\r\n          return \"array(\" + fmt_type(type.data.type) + \")\";\r\n        }\r\n      } else if (type.type === StructEnum.STATIC_STRING) {\r\n        return \"static_string[\" + type.data.maxlength + \"]\";\r\n      } else if (type.type === StructEnum.STRUCT) {\r\n        return type.data;\r\n      } else if (type.type === StructEnum.TSTRUCT) {\r\n        return \"abstract(\" + type.data + \")\";\r\n      } else {\r\n        return StructTypeMap[type.type];\r\n      }\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      s += tab + f.name + \" : \" + fmt_type(f.type);\r\n      if (!no_helper_js && f.get !== undefined) {\r\n        s += \" | \" + f.get.trim();\r\n      }\r\n      s += \";\";\r\n\r\n      if (addComments && f.comment.trim()) {\r\n        s += f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n    if (!internal_only)\r\n      s += \"}\";\r\n    return s;\r\n  }\r\n\r\n  static setClassKeyword(keyword, nameKeyword = undefined) {\r\n    if (!nameKeyword) {\r\n      nameKeyword = keyword.toLowerCase() + \"Name\";\r\n    }\r\n\r\n    this.keywords = {\r\n      script: keyword,\r\n      name  : nameKeyword,\r\n      load  : \"load\" + keyword,\r\n      new   : \"new\" + keyword,\r\n      after : \"after\" + keyword,\r\n      from  : \"from\" + keyword\r\n    };\r\n  }\r\n\r\n  define_null_native(name, cls) {\r\n    const keywords = this.constructor.keywords;\r\n    let obj = define_empty_class(this.constructor, name);\r\n\r\n    let stt = struct_parse.parse(obj.STRUCT);\r\n\r\n    stt.id = this.idgen++;\r\n\r\n    this.structs[name] = stt;\r\n    this.struct_cls[name] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n\r\n    this.null_natives[name] = 1;\r\n  }\r\n\r\n  validateStructs(onerror) {\r\n    function getType(type) {\r\n      switch (type.type) {\r\n        case StructEnum.ITERKEYS:\r\n        case StructEnum.ITER:\r\n        case StructEnum.STATIC_ARRAY:\r\n        case StructEnum.ARRAY:\r\n          return getType(type.data.type);\r\n        case StructEnum.TSTRUCT:\r\n          return type;\r\n        case StructEnum.STRUCT:\r\n        default:\r\n          return type;\r\n      }\r\n    }\r\n\r\n    function formatType(type) {\r\n      let ret = {};\r\n\r\n      ret.type = type.type;\r\n\r\n      if (typeof ret.type === \"number\") {\r\n        for (let k in StructEnum) {\r\n          if (StructEnum[k] === ret.type) {\r\n            ret.type = k;\r\n            break;\r\n          }\r\n        }\r\n      } else if (typeof ret.type === \"object\") {\r\n        ret.type = formatType(ret.type);\r\n      }\r\n\r\n      if (typeof type.data === \"object\") {\r\n        ret.data = formatType(type.data);\r\n      } else {\r\n        ret.data = type.data;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function throwError(stt, field, msg) {\r\n      let buf = STRUCT.formatStruct(stt);\r\n\r\n      console.error(buf + \"\\n\\n\" + msg);\r\n\r\n      if (onerror) {\r\n        onerror(msg, stt, field);\r\n      } else {\r\n        throw new Error(msg);\r\n      }\r\n    }\r\n\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      for (let field of stt.fields) {\r\n        if (field.name === \"this\") {\r\n          let type = field.type.type;\r\n\r\n          if (ValueTypes.has(type)) {\r\n            throwError(stt, field, \"'this' cannot be used with value types\");\r\n          }\r\n        }\r\n\r\n        let type = getType(field.type);\r\n\r\n        if (type.type !== StructEnum.STRUCT && type.type !== StructEnum.TSTRUCT) {\r\n          continue;\r\n        }\r\n\r\n        if (!(type.data in this.structs)) {\r\n          let msg = stt.name + \":\" + field.name + \": Unknown struct \" + type.data + \".\";\r\n          throwError(stt, field, msg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  forEach(func, thisvar) {\r\n    for (let k in this.structs) {\r\n      let stt = this.structs[k];\r\n\r\n      if (thisvar !== undefined)\r\n        func.call(thisvar, stt);\r\n      else\r\n        func(stt);\r\n    }\r\n  }\r\n\r\n  //defaults to structjs.manager\r\n  parse_structs(buf, defined_classes) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = manager;\r\n    }\r\n\r\n    if (defined_classes instanceof STRUCT) {\r\n      let struct2 = defined_classes;\r\n      defined_classes = [];\r\n\r\n      for (let k in struct2.struct_cls) {\r\n        defined_classes.push(struct2.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    if (defined_classes === undefined) {\r\n      defined_classes = [];\r\n\r\n      for (let k in manager.struct_cls) {\r\n        defined_classes.push(manager.struct_cls[k]);\r\n      }\r\n    }\r\n\r\n    let clsmap = {};\r\n\r\n    for (let i = 0; i < defined_classes.length; i++) {\r\n      let cls = defined_classes[i];\r\n\r\n      if (!cls.structName && cls.STRUCT) {\r\n        let stt = struct_parse.parse(cls.STRUCT.trim());\r\n        cls.structName = stt.name;\r\n      } else if (!cls.structName && cls.name !== \"Object\") {\r\n        if (warninglvl > 0)\r\n          console.log(\"Warning, bad class in registered class list\", unmangle(cls.name), cls);\r\n        continue;\r\n      }\r\n\r\n      clsmap[cls.structName] = defined_classes[i];\r\n    }\r\n\r\n    struct_parse.input(buf);\r\n\r\n    while (!struct_parse.at_end()) {\r\n      let stt = struct_parse.parse(undefined, false);\r\n\r\n      if (!(stt.name in clsmap)) {\r\n        if (!(stt.name in this.null_natives))\r\n          if (warninglvl > 0)\r\n            console.log(\"WARNING: struct \" + stt.name + \" is missing from class list.\");\r\n\r\n        let dummy = define_empty_class(this.constructor, stt.name);\r\n\r\n        dummy.STRUCT = STRUCT.fmt_struct(stt);\r\n        dummy.structName = stt.name;\r\n\r\n        dummy.prototype.structName = dummy.name;\r\n\r\n        this.struct_cls[dummy.structName] = dummy;\r\n        this.structs[dummy.structName] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      } else {\r\n        this.struct_cls[stt.name] = clsmap[stt.name];\r\n        this.structs[stt.name] = stt;\r\n\r\n        if (stt.id !== -1)\r\n          this.struct_ids[stt.id] = stt;\r\n      }\r\n\r\n      let tok = struct_parse.peek();\r\n      while (tok && (tok.value === \"\\n\" || tok.value === \"\\r\" || tok.value === \"\\t\" || tok.value === \" \")) {\r\n        tok = struct_parse.peek();\r\n      }\r\n    }\r\n  }\r\n\r\n  /** adds all structs referenced by cls inside of srcSTRUCT\r\n   *  to this */\r\n  registerGraph(srcSTRUCT, cls) {\r\n    if (!cls.structName) {\r\n      console.warn(\"class was not in srcSTRUCT\");\r\n      return this.register(cls);\r\n    }\r\n\r\n    let recStruct;\r\n\r\n    let recArray = (t) => {\r\n      switch (t.type) {\r\n        case StructEnum.ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITERKEYS:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STATIC_ARRAY:\r\n          return recArray(t.data.type);\r\n        case StructEnum.ITER:\r\n          return recArray(t.data.type);\r\n        case StructEnum.STRUCT:\r\n        case StructEnum.TSTRUCT: {\r\n          let st = srcSTRUCT.structs[t.data];\r\n          let cls = srcSTRUCT.struct_cls[st.name];\r\n\r\n          return recStruct(st, cls);\r\n        }\r\n      }\r\n    };\r\n\r\n    recStruct = (st, cls) => {\r\n      if (!(cls.structName in this.structs)) {\r\n        this.add_class(cls, cls.structName);\r\n      }\r\n\r\n      for (let f of st.fields) {\r\n        if (f.type.type === StructEnum.STRUCT || f.type.type === StructEnum.TSTRUCT) {\r\n          let st2 = srcSTRUCT.structs[f.type.data];\r\n          let cls2 = srcSTRUCT.struct_cls[st2.name];\r\n\r\n          recStruct(st2, cls2);\r\n        } else if (f.type.type === StructEnum.ARRAY) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITER) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.ITERKEYS) {\r\n          recArray(f.type);\r\n        } else if (f.type.type === StructEnum.STATIC_ARRAY) {\r\n          recArray(f.type);\r\n        }\r\n      }\r\n    };\r\n\r\n    let st = srcSTRUCT.structs[cls.structName];\r\n    recStruct(st, cls);\r\n  }\r\n\r\n  mergeScripts(child, parent) {\r\n    let stc = struct_parse.parse(child.trim());\r\n    let stp = struct_parse.parse(parent.trim());\r\n\r\n    let fieldset = new Set();\r\n\r\n    for (let f of stc.fields) {\r\n      fieldset.add(f.name);\r\n    }\r\n\r\n    let fields = [];\r\n    for (let f of stp.fields) {\r\n      if (!fieldset.has(f.name)) {\r\n        fields.push(f);\r\n      }\r\n    }\r\n\r\n    stc.fields = fields.concat(stc.fields);\r\n    return STRUCT.fmt_struct(stc, false, false);\r\n  }\r\n\r\n  inlineRegister(cls, structScript) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let p = cls.__proto__;\r\n    while (p && p !== Object) {\r\n      if (p.hasOwnProperty(keywords.script)) {\r\n        structScript = this.mergeScripts(structScript, p.STRUCT);\r\n        break\r\n      }\r\n      p = p.__proto__;\r\n    }\r\n\r\n    cls.STRUCT = structScript;\r\n    this.register(cls);\r\n    return structScript;\r\n  }\r\n\r\n  register(cls, structName) {\r\n    return this.add_class(cls, structName);\r\n  }\r\n\r\n  unregister(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls || !cls.structName || !(cls.structName in this.struct_cls)) {\r\n      console.warn(\"Class not registered with nstructjs\", cls);\r\n      return;\r\n    }\r\n\r\n\r\n    let st = this.structs[cls.structName];\r\n\r\n    delete this.structs[cls.structName];\r\n    delete this.struct_cls[cls.structName];\r\n    delete this.struct_ids[st.id];\r\n  }\r\n\r\n  add_class(cls, structName) {\r\n    //do not register Object\r\n    if (cls === Object) {\r\n      return;\r\n    }\r\n\r\n    const keywords = this.constructor.keywords;\r\n    if (cls.STRUCT) {\r\n      let bad = false;\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        p = p.__proto__;\r\n\r\n        if (p && p.STRUCT && p.STRUCT === cls.STRUCT) {\r\n          bad = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (bad) {\r\n        if (warninglvl > 0) {\r\n          console.warn(\"Generating \" + keywords.script + \" script for derived class \" + unmangle(cls.name));\r\n        }\r\n\r\n        if (!structName) {\r\n          structName = unmangle(cls.name);\r\n        }\r\n\r\n        cls.STRUCT = STRUCT.inherit(cls, p) + \"\\n}\";\r\n      }\r\n    }\r\n\r\n    if (!cls.STRUCT) {\r\n      throw new Error(\"class \" + unmangle(cls.name) + \" has no \" + keywords.script + \" script\");\r\n    }\r\n\r\n    let stt = struct_parse.parse(cls.STRUCT);\r\n\r\n    stt.name = unmangle(stt.name);\r\n\r\n    cls.structName = stt.name;\r\n\r\n    //create default newSTRUCT\r\n    if (cls.newSTRUCT === undefined) {\r\n      cls.newSTRUCT = function () {\r\n        return new this();\r\n      };\r\n    }\r\n\r\n    if (structName !== undefined) {\r\n      stt.name = cls.structName = structName;\r\n    } else if (cls.structName === undefined) {\r\n      cls.structName = stt.name;\r\n    } else {\r\n      stt.name = cls.structName;\r\n    }\r\n\r\n    if (cls.structName in this.structs) {\r\n      if (warninglvl > 0) {\r\n        console.warn(\"Struct \" + unmangle(cls.structName) + \" is already registered\", cls);\r\n      }\r\n\r\n      if (!this.allowOverriding) {\r\n        throw new Error(\"Struct \" + unmangle(cls.structName) + \" is already registered\");\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (stt.id === -1)\r\n      stt.id = this.idgen++;\r\n\r\n    this.structs[cls.structName] = stt;\r\n    this.struct_cls[cls.structName] = cls;\r\n    this.struct_ids[stt.id] = stt;\r\n  }\r\n\r\n  isRegistered(cls) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    if (!cls.hasOwnProperty(\"structName\")) {\r\n      return false;\r\n    }\r\n\r\n    return cls === this.struct_cls[cls.structName];\r\n  }\r\n\r\n  get_struct_id(id) {\r\n    return this.struct_ids[id];\r\n  }\r\n\r\n  get_struct(name) {\r\n    if (!(name in this.structs)) {\r\n      console.warn(\"Unknown struct\", name);\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.structs[name];\r\n  }\r\n\r\n  get_struct_cls(name) {\r\n    if (!(name in this.struct_cls)) {\r\n      console.trace();\r\n      throw new Error(\"Unknown struct \" + name);\r\n    }\r\n    return this.struct_cls[name];\r\n  }\r\n\r\n  _env_call(code, obj, env) {\r\n    let envcode = _static_envcode_null;\r\n    if (env !== undefined) {\r\n      envcode = \"\";\r\n      for (let i = 0; i < env.length; i++) {\r\n        envcode = \"let \" + env[i][0] + \" = env[\" + i.toString() + \"][1];\\n\" + envcode;\r\n      }\r\n    }\r\n    let fullcode = \"\";\r\n    if (envcode !== _static_envcode_null)\r\n      fullcode = envcode + code;\r\n    else\r\n      fullcode = code;\r\n    let func;\r\n\r\n    //fullcode = fullcode.replace(/\\bthis\\b/, \"obj\");\r\n\r\n    if (!(fullcode in this.compiled_code)) {\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      try {\r\n        func = struct_eval.structEval(code2);\r\n      } catch (err) {\r\n        console.warn(err.stack);\r\n\r\n        console.warn(code2);\r\n        console.warn(\" \");\r\n        throw err;\r\n      }\r\n      this.compiled_code[fullcode] = func;\r\n    } else {\r\n      func = this.compiled_code[fullcode];\r\n    }\r\n    try {\r\n      return func.call(obj, obj, env);\r\n    } catch (err) {\r\n      console.warn(err.stack);\r\n\r\n      let code2 = \"func = function(obj, env) { \" + envcode + \"return \" + code + \"}\";\r\n      console.warn(code2);\r\n      console.warn(\" \");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  write_struct(data, obj, stt) {\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let t1 = f.type;\r\n      let t2 = t1.type;\r\n\r\n      if (use_helper_js(f)) {\r\n        let val;\r\n        let type = t2;\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      } else {\r\n        let val = f.name === \"this\" ? obj : obj[f.name];\r\n        sintern2.do_pack(this, data, val, obj, f, t1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   @param data : array to write data into,\r\n   @param obj  : structable object\r\n   */\r\n  write_object(data, obj) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor.structName;\r\n    let stt = this.get_struct(cls);\r\n\r\n    if (data === undefined) {\r\n      data = [];\r\n    }\r\n\r\n    this.write_struct(data, obj, stt);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   Read an object from binary data\r\n\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   @return {cls_or_struct_id} Instance of cls_or_struct_id\r\n   */\r\n  readObject(data, cls_or_struct_id, uctx) {\r\n    if (data instanceof Uint8Array || data instanceof Uint8ClampedArray) {\r\n      data = new DataView(data.buffer);\r\n    } else if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    return this.read_object(data, cls_or_struct_id, uctx);\r\n  }\r\n\r\n  /**\r\n   @param data array to write data into,\r\n   @param obj structable object\r\n   */\r\n  writeObject(data, obj) {\r\n    return this.write_object(data, obj);\r\n  }\r\n\r\n  writeJSON(obj, stt = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls = obj.constructor;\r\n    stt = stt || this.get_struct(cls.structName);\r\n\r\n    function use_helper_js(field) {\r\n      let type = field.type.type;\r\n      let cls = StructFieldTypeMap[type];\r\n      return cls.useHelperJS(field);\r\n    }\r\n\r\n    let toJSON = sintern2.toJSON;\r\n\r\n    let fields = stt.fields;\r\n    let thestruct = this;\r\n    let json = {};\r\n\r\n    for (let i = 0; i < fields.length; i++) {\r\n      let f = fields[i];\r\n      let val;\r\n      let t1 = f.type;\r\n\r\n      let json2;\r\n\r\n      if (use_helper_js(f)) {\r\n        if (f.get !== undefined) {\r\n          val = thestruct._env_call(f.get, obj);\r\n        } else {\r\n          val = f.name === \"this\" ? obj : obj[f.name];\r\n        }\r\n\r\n        if (DEBUG.tinyeval) {\r\n          console.log(\"\\n\\n\\n\", f.get, \"Helper JS Ret\", val, \"\\n\\n\\n\");\r\n        }\r\n\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      } else {\r\n        val = f.name === \"this\" ? obj : obj[f.name];\r\n        json2 = toJSON(this, val, obj, f, t1);\r\n      }\r\n\r\n      if (f.name !== 'this') {\r\n        json[f.name] = json2;\r\n      } else { //f.name was 'this'?\r\n        let isArray = Array.isArray(json2);\r\n        isArray = isArray || f.type.type === StructTypes.ARRAY;\r\n        isArray = isArray || f.type.type === StructTypes.STATIC_ARRAY;\r\n\r\n        if (isArray) {\r\n          json.length = json2.length;\r\n\r\n          for (let i = 0; i < json2.length; i++) {\r\n            json[i] = json2[i];\r\n          }\r\n        } else {\r\n          Object.assign(json, json2);\r\n        }\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  /**\r\n   @param data : DataView or Uint8Array instance\r\n   @param cls_or_struct_id : Structable class\r\n   @param uctx : internal parameter\r\n   */\r\n  read_object(data, cls_or_struct_id, uctx, objInstance) {\r\n    const keywords = this.constructor.keywords;\r\n    let cls, stt;\r\n\r\n    if (data instanceof Array) {\r\n      data = new DataView(new Uint8Array(data).buffer);\r\n    }\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (uctx === undefined) {\r\n      uctx = new unpack_context();\r\n\r\n      packer_debug(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    }\r\n    let thestruct = this;\r\n\r\n    let this2 = this;\r\n\r\n    function unpack_field(type) {\r\n      return StructFieldTypeMap[type.type].unpack(this2, data, type, uctx);\r\n    }\r\n\r\n    function unpack_into(type, dest) {\r\n      return StructFieldTypeMap[type.type].unpackInto(this2, data, type, uctx, dest);\r\n    }\r\n\r\n    let was_run = false;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          if (f.name === 'this') {\r\n            //load data into obj directly\r\n            unpack_into(f.type, obj);\r\n          } else {\r\n            obj[f.name] = unpack_field(f.type);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n\r\n      if (!was_run) {\r\n        console.warn(\"\" + cls.structName + \".prototype.loadSTRUCT() did not execute its loader callback!\");\r\n        load(obj);\r\n      }\r\n\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl > 1) {\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      }\r\n\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  validateJSON(json, cls_or_struct_id, useInternalParser = true, useColors = true, consoleLogger = function () {\r\n    console.log(...arguments);\r\n  }, _abstractKey                                        = \"_structName\") {\r\n    if (cls_or_struct_id === undefined) {\r\n      throw new Error(this.constructor.name + \".prototype.validateJSON: Expected at least two arguments\");\r\n    }\r\n\r\n    try {\r\n      json = JSON.stringify(json, undefined, 2);\r\n\r\n      this.jsonBuf = json;\r\n      this.jsonUseColors = useColors;\r\n      this.jsonLogger = consoleLogger;\r\n\r\n      //add token annotations\r\n      jsonParser.logger = this.jsonLogger;\r\n\r\n      if (useInternalParser) {\r\n        json = jsonParser.parse(json);\r\n      } else {\r\n        json = JSON.parse(json);\r\n      }\r\n\r\n      this.validateJSONIntern(json, cls_or_struct_id, _abstractKey);\r\n\r\n    } catch (error) {\r\n      if (!(error instanceof JSONError)) {\r\n        console.error(error.stack);\r\n      }\r\n\r\n      this.jsonLogger(error.message);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  validateJSONIntern(json, cls_or_struct_id, _abstractKey = \"_structName\") {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    if (stt === undefined) {\r\n      throw new Error(\"unknown class \" + cls);\r\n    }\r\n\r\n    let fields = stt.fields;\r\n    let flen = fields.length;\r\n\r\n    let keys = new Set();\r\n    keys.add(_abstractKey);\r\n\r\n    let keyTestJson = json;\r\n\r\n    for (let i = 0; i < flen; i++) {\r\n      let f = fields[i];\r\n\r\n      let val;\r\n\r\n      let tokinfo;\r\n\r\n      if (f.name === 'this') {\r\n        val = json;\r\n        keyTestJson = {\r\n          \"this\": json\r\n        };\r\n\r\n        keys.add(\"this\");\r\n        tokinfo = json[TokSymbol];\r\n      } else {\r\n        val = json[f.name];\r\n        keys.add(f.name);\r\n\r\n        tokinfo = json[TokSymbol] ? json[TokSymbol].fields[f.name] : undefined;\r\n        if (!tokinfo) {\r\n          let f2 = fields[Math.max(i - 1, 0)];\r\n          tokinfo = TokSymbol[TokSymbol] ? json[TokSymbol].fields[f2.name] : undefined;\r\n        }\r\n\r\n        if (!tokinfo) {\r\n          tokinfo = json[TokSymbol];\r\n        }\r\n      }\r\n\r\n      if (val === undefined) {\r\n        //console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n        //continue;\r\n      }\r\n\r\n      let instance = f.name === 'this' ? val : json;\r\n\r\n      let ret = sintern2.validateJSON(this, val, json, f, f.type, instance, _abstractKey);\r\n\r\n      if (!ret || typeof ret === \"string\") {\r\n        let msg = typeof ret === \"string\" ? \": \" + ret : \"\";\r\n\r\n        if (tokinfo) {\r\n          this.jsonLogger(printContext(this.jsonBuf, tokinfo, this.jsonUseColors));\r\n        }\r\n\r\n        //console.error(cls.STRUCT);\r\n\r\n        if (val === undefined) {\r\n          throw new JSONError(stt.name + \": Missing json field \" + f.name + msg);\r\n        } else {\r\n          throw new JSONError(stt.name + \": Invalid json field \" + f.name + msg);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    for (let k in keyTestJson) {\r\n      if (typeof json[k] === \"symbol\") {\r\n        //ignore symbols\r\n        continue;\r\n      }\r\n\r\n      if (!keys.has(k)) {\r\n        this.jsonLogger(cls.STRUCT);\r\n        throw new JSONError(stt.name + \": Unknown json field \" + k);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  readJSON(json, cls_or_struct_id, objInstance = undefined) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let cls, stt;\r\n\r\n    if (typeof cls_or_struct_id === \"number\") {\r\n      cls = this.struct_cls[this.struct_ids[cls_or_struct_id].name];\r\n    } else if (cls_or_struct_id instanceof NStruct) {\r\n      cls = this.get_struct_cls(cls_or_struct_id.name);\r\n    } else {\r\n      cls = cls_or_struct_id;\r\n    }\r\n\r\n    if (cls === undefined) {\r\n      throw new Error(\"bad cls_or_struct_id \" + cls_or_struct_id);\r\n    }\r\n\r\n    stt = this.structs[cls.structName];\r\n\r\n    packer_debug(\"\\n\\n=Begin reading \" + cls.structName + \"=\");\r\n    let thestruct = this;\r\n    let this2 = this;\r\n    let was_run = false;\r\n    let fromJSON = sintern2.fromJSON;\r\n\r\n    function makeLoader(stt) {\r\n      return function load(obj) {\r\n        if (was_run) {\r\n          return;\r\n        }\r\n\r\n        was_run = true;\r\n\r\n        let fields = stt.fields;\r\n        let flen = fields.length;\r\n\r\n        for (let i = 0; i < flen; i++) {\r\n          let f = fields[i];\r\n\r\n          let val;\r\n\r\n          if (f.name === 'this') {\r\n            val = json;\r\n          } else {\r\n            val = json[f.name];\r\n          }\r\n\r\n          if (val === undefined) {\r\n            if (warninglvl > 1) {\r\n              console.warn(\"nstructjs.readJSON: Missing field \" + f.name + \" in struct \" + stt.name);\r\n            }\r\n            continue;\r\n          }\r\n\r\n          let instance = f.name === 'this' ? obj : objInstance;\r\n\r\n          let ret = fromJSON(this2, val, obj, f, f.type, instance);\r\n\r\n          if (f.name !== 'this') {\r\n            obj[f.name] = ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let load = makeLoader(stt);\r\n\r\n    if (cls.prototype.loadSTRUCT !== undefined) {\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      obj.loadSTRUCT(load);\r\n      return obj;\r\n    } else if (cls.fromSTRUCT !== undefined) {\r\n      if (warninglvl > 1) {\r\n        console.warn(\"Warning: class \" + unmangle(cls.name) + \" is using deprecated fromSTRUCT interface; use newSTRUCT/loadSTRUCT instead\");\r\n      }\r\n      return cls.fromSTRUCT(load);\r\n    } else { //default case, make new instance and then call load() on it\r\n      let obj = objInstance;\r\n\r\n      if (!obj && cls.newSTRUCT !== undefined) {\r\n        obj = cls.newSTRUCT(load);\r\n      } else if (!obj) {\r\n        obj = new cls();\r\n      }\r\n\r\n      load(obj);\r\n\r\n      return obj;\r\n    }\r\n  }\r\n\r\n  formatJSON_intern(json, stt, field, tlvl = 0) {\r\n    const keywords = this.constructor.keywords;\r\n    const addComments = this.formatCtx.addComments;\r\n\r\n    let s = '{';\r\n\r\n    if (addComments && field && field.comment.trim()) {\r\n      s += \" \" + field.comment.trim();\r\n    }\r\n\r\n    s += \"\\n\";\r\n\r\n    for (let f of stt.fields) {\r\n      let value = json[f.name];\r\n\r\n      s += tab(tlvl + 1) + f.name + \": \";\r\n\r\n      s += sintern2.formatJSON(this, value, json, f, f.type, undefined, tlvl + 1);\r\n      s += \",\";\r\n\r\n      let basetype = f.type.type;\r\n\r\n      if (ArrayTypes.has(basetype)) {\r\n        basetype = f.type.data.type.type;\r\n      }\r\n\r\n      const addComment = ValueTypes.has(basetype) && addComments && f.comment.trim();\r\n\r\n      if (addComment) {\r\n        s += \" \" + f.comment.trim();\r\n      }\r\n\r\n      s += \"\\n\";\r\n    }\r\n\r\n    s += tab(tlvl) + \"}\";\r\n    return s;\r\n  }\r\n\r\n  formatJSON(json, cls, addComments = true, validate = true) {\r\n    const keywords = this.constructor.keywords;\r\n\r\n    let s = '';\r\n\r\n    if (validate) {\r\n      this.validateJSON(json, cls);\r\n    }\r\n\r\n    let stt = this.structs[cls.structName];\r\n\r\n    this.formatCtx = {\r\n      addComments,\r\n      validate\r\n    };\r\n\r\n    return this.formatJSON_intern(json, stt);\r\n  }\r\n};\r\n//$KEYWORD_CONFIG_END\r\n\r\nif (haveCodeGen) {\r\n  var StructClass;\r\n\r\n  try {\r\n    eval(code);\r\n  } catch (error) {\r\n    printEvalError(code);\r\n  }\r\n\r\n  StructClass.keywords = {\r\n    name  : \"structName\",\r\n    script: \"STRUCT\",\r\n    load  : \"loadSTRUCT\",\r\n    from  : \"fromSTRUCT\",\r\n    new   : \"newSTRUCT\",\r\n  };\r\n\r\n  STRUCT = StructClass;\r\n}\r\n\r\nSTRUCT.setClassKeyword(\"STRUCT\");\r\n\r\nfunction deriveStructManager(keywords = {\r\n  script: \"STRUCT\",\r\n  name  : undefined, //script.toLowerCase + \"Name\"\r\n  load  : undefined, //\"load\" + script\r\n  new   : undefined, //\"new\" + script\r\n  from  : undefined, //\"from\" + script\r\n}) {\r\n\r\n  if (!keywords.name) {\r\n    keywords.name = keywords.script.toLowerCase() + \"Name\";\r\n  }\r\n\r\n  if (!keywords.load) {\r\n    keywords.load = \"load\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.new) {\r\n    keywords.new = \"new\" + keywords.script;\r\n  }\r\n\r\n  if (!keywords.from) {\r\n    keywords.from = \"from\" + keywords.script;\r\n  }\r\n\r\n  if (!haveCodeGen) {\r\n    class NewSTRUCT extends STRUCT {\r\n\r\n    }\r\n\r\n    NewSTRUCT.keywords = keywords;\r\n    return NewSTRUCT;\r\n  } else {\r\n    var StructClass;\r\n    var _json_parser = jsonParser;\r\n    var _util = util;\r\n\r\n    let code2 = code;\r\n    code2 = code2.replace(/\\[keywords.script\\]/g, \".\" + keywords.script);\r\n    code2 = code2.replace(/\\[keywords.name\\]/g, \".\" + keywords.name);\r\n    code2 = code2.replace(/\\bjsonParser\\b/g, \"_json_parser\");\r\n    code2 = code2.replace(/\\butil\\b/g, \"_util\");\r\n\r\n    //console.log(\"\\n\\n\");\r\n    //console.log(printCodeLines(code2));\r\n    //console.log(\"\\n\\n\");\r\n\r\n    try {\r\n      eval(code2);\r\n    } catch (error) {\r\n      printEvalError(code2);\r\n    }\r\n\r\n    StructClass.keywords = keywords;\r\n    return StructClass;\r\n  }\r\n}\r\n\r\n//main struct script manager\r\nmanager = new STRUCT();\r\n\r\n/**\r\n * Write all defined structs out to a string.\r\n *\r\n * @param nManager STRUCT instance, defaults to nstructjs.manager\r\n * @param include_code include save code snippets\r\n * */\r\nfunction write_scripts(nManager = manager, include_code = false) {\r\n  let buf = \"\";\r\n\r\n  /* prevent code generation bugs in configurable mode */\r\n  let nl = String.fromCharCode(10);\r\n  let tab = String.fromCharCode(9);\r\n\r\n  nManager.forEach(function (stt) {\r\n    buf += STRUCT.fmt_struct(stt, false, !include_code) + nl;\r\n  });\r\n\r\n  let buf2 = buf;\r\n  buf = \"\";\r\n\r\n  for (let i = 0; i < buf2.length; i++) {\r\n    let c = buf2[i];\r\n    if (c === nl) {\r\n      buf += nl;\r\n      let i2 = i;\r\n      while (i < buf2.length && (buf2[i] === \" \" || buf2[i] === tab || buf2[i] === nl)) {\r\n        i++;\r\n      }\r\n      if (i !== i2)\r\n        i--;\r\n    } else {\r\n      buf += c;\r\n    }\r\n  }\r\n\r\n  return buf;\r\n}\r\n\r\n\"use strict\";\r\n\r\nlet nbtoa, natob;\r\n\r\nif (typeof btoa === \"undefined\") {\r\n  nbtoa = function btoa(str) {\r\n    let buffer = new Buffer(\"\" + str, 'binary');\r\n    return buffer.toString('base64');\r\n  };\r\n\r\n  natob = function atob(str) {\r\n    return new Buffer(str, 'base64').toString('binary');\r\n  };\r\n} else {\r\n  natob = atob;\r\n  nbtoa = btoa;\r\n}\r\n\r\n/*\r\nfile format:\r\n  magic signature              : 4 bytes\r\n  file version major           : 2 bytes\r\n  file version minor           : 1 bytes\r\n  file version micro           : 1 bytes\r\n  length of struct scripts     : 4 bytes\r\n  struct scripts for this file : ...\r\n  \r\n  block:\r\n    magic signature for block              : 4 bytes\r\n    length of data  (not including header) : 4 bytes\r\n    id of struct type                      : 4 bytes\r\n    \r\n    data                                   : ...\r\n*/\r\n\r\nfunction versionToInt(v) {\r\n  v = versionCoerce(v);\r\n  let mul = 64;\r\n  return ~~(v.major*mul*mul*mul + v.minor*mul*mul + v.micro*mul);\r\n}\r\n\r\nlet ver_pat = /[0-9]+\\.[0-9]+\\.[0-9]+$/;\r\n\r\nfunction versionCoerce(v) {\r\n  if (!v) {\r\n    throw new Error(\"empty version: \" + v);\r\n  }\r\n\r\n  if (typeof v === \"string\") {\r\n    if (!ver_pat.exec(v)) {\r\n      throw new Error(\"invalid version string \" + v);\r\n    }\r\n\r\n    let ver = v.split(\".\");\r\n    return {\r\n      major : parseInt(ver[0]),\r\n      minor : parseInt(ver[1]),\r\n      micro : parseInt(ver[2])\r\n    }\r\n  } else if (Array.isArray(v)) {\r\n    return {\r\n      major : v[0],\r\n      minor : v[1],\r\n      micro : v[2]\r\n    }\r\n  } else if (typeof v === \"object\") {\r\n    let test = (k) => k in v && typeof v[k] === \"number\";\r\n\r\n    if (!test(\"major\") || !test(\"minor\") || !test(\"micro\")) {\r\n      throw new Error(\"invalid version object: \" + v);\r\n    }\r\n\r\n    return v;\r\n  } else {\r\n    throw new Error(\"invalid version \" + v);\r\n  }\r\n}\r\n\r\nfunction versionLessThan(a, b) {\r\n  return versionToInt(a) < versionToInt(b);\r\n}\r\n\r\nclass FileParams {\r\n  constructor() {\r\n    this.magic = \"STRT\";\r\n    this.ext = \".bin\";\r\n    this.blocktypes = [\"DATA\"];\r\n\r\n    this.version = {\r\n      major: 0,\r\n      minor: 0,\r\n      micro: 1\r\n    };\r\n  }\r\n}\r\n\r\n//used to define blocks\r\nclass Block {\r\n  constructor(type_magic, data) {\r\n    this.type = type_magic;\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nclass FileeError extends Error {\r\n}\r\n\r\nclass FileHelper {\r\n  //params can be FileParams instance, or object literal\r\n  //(it will convert to FileParams)\r\n  constructor(params) {\r\n    if (params === undefined) {\r\n      params = new FileParams();\r\n    } else {\r\n      let fp = new FileParams();\r\n\r\n      for (let k in params) {\r\n        fp[k] = params[k];\r\n      }\r\n      params = fp;\r\n    }\r\n\r\n    this.version = params.version;\r\n    this.blocktypes = params.blocktypes;\r\n    this.magic = params.magic;\r\n    this.ext = params.ext;\r\n    this.struct = undefined;\r\n    this.unpack_ctx = undefined;\r\n  }\r\n\r\n  read(dataview) {\r\n    this.unpack_ctx = new unpack_context();\r\n\r\n    let magic = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n\r\n    if (magic !== this.magic) {\r\n      throw new FileError(\"corrupted file\");\r\n    }\r\n\r\n    this.version = {};\r\n    this.version.major = unpack_short(dataview, this.unpack_ctx);\r\n    this.version.minor = unpack_byte(dataview, this.unpack_ctx);\r\n    this.version.micro = unpack_byte(dataview, this.unpack_ctx);\r\n\r\n    let struct = this.struct = new STRUCT();\r\n\r\n    let scripts = unpack_string(dataview, this.unpack_ctx);\r\n    this.struct.parse_structs(scripts, manager);\r\n\r\n    let blocks = [];\r\n    let dviewlen = dataview.buffer.byteLength;\r\n\r\n    while (this.unpack_ctx.i < dviewlen) {\r\n      //console.log(\"reading block. . .\", this.unpack_ctx.i, dviewlen);\r\n\r\n      let type = unpack_static_string(dataview, this.unpack_ctx, 4);\r\n      let datalen = unpack_int(dataview, this.unpack_ctx);\r\n      let bstruct = unpack_int(dataview, this.unpack_ctx);\r\n      let bdata;\r\n\r\n      //console.log(type, datalen, bstruct);\r\n\r\n      if (bstruct === -2) { //string data, e.g. JSON\r\n        bdata = unpack_static_string(dataview, this.unpack_ctx, datalen);\r\n      } else {\r\n        bdata = unpack_bytes(dataview, this.unpack_ctx, datalen);\r\n        bdata = struct.read_object(bdata, bstruct, new unpack_context());\r\n      }\r\n\r\n      let block = new Block();\r\n      block.type = type;\r\n      block.data = bdata;\r\n\r\n      blocks.push(block);\r\n    }\r\n\r\n    this.blocks = blocks;\r\n    return blocks;\r\n  }\r\n\r\n  doVersions(old) {\r\n    let blocks = this.blocks;\r\n\r\n    if (versionLessThan(old, \"0.0.1\")) {\r\n      //do something\r\n    }\r\n  }\r\n\r\n  write(blocks) {\r\n    this.struct = manager;\r\n    this.blocks = blocks;\r\n\r\n    let data = [];\r\n\r\n    pack_static_string(data, this.magic, 4);\r\n    pack_short(data, this.version.major);\r\n    pack_byte(data, this.version.minor & 255);\r\n    pack_byte(data, this.version.micro & 255);\r\n\r\n    let scripts = write_scripts();\r\n    pack_string(data, scripts);\r\n\r\n    let struct = this.struct;\r\n\r\n    for (let block of blocks) {\r\n      if (typeof block.data === \"string\") { //string data, e.g. JSON\r\n        pack_static_string(data, block.type, 4);\r\n        pack_int(data, block.data.length);\r\n        pack_int(data, -2); //flag as string data\r\n        pack_static_string(data, block.data, block.data.length);\r\n        continue;\r\n      }\r\n\r\n      let structName = block.data.constructor.structName;\r\n      if (structName === undefined || !(structName in struct.structs)) {\r\n        throw new Error(\"Non-STRUCTable object \" + block.data);\r\n      }\r\n\r\n      let data2 = [];\r\n      let stt = struct.structs[structName];\r\n\r\n      struct.write_object(data2, block.data);\r\n\r\n      pack_static_string(data, block.type, 4);\r\n      pack_int(data, data2.length);\r\n      pack_int(data, stt.id);\r\n\r\n      pack_bytes(data, data2);\r\n    }\r\n\r\n    return new DataView(new Uint8Array(data).buffer);\r\n  }\r\n\r\n  writeBase64(blocks) {\r\n    let dataview = this.write(blocks);\r\n\r\n    let str = \"\";\r\n    let bytes = new Uint8Array(dataview.buffer);\r\n\r\n    for (let i = 0; i < bytes.length; i++) {\r\n      str += String.fromCharCode(bytes[i]);\r\n    }\r\n\r\n    return nbtoa(str);\r\n  }\r\n\r\n  makeBlock(type, data) {\r\n    return new Block(type, data);\r\n  }\r\n\r\n  readBase64(base64) {\r\n    let data = natob(base64);\r\n    let data2 = new Uint8Array(data.length);\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n      data2[i] = data.charCodeAt(i);\r\n    }\r\n\r\n    return this.read(new DataView(data2.buffer));\r\n  }\r\n}\r\n\r\nvar struct_filehelper = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  versionToInt: versionToInt,\r\n  versionCoerce: versionCoerce,\r\n  versionLessThan: versionLessThan,\r\n  FileParams: FileParams,\r\n  Block: Block,\r\n  FileeError: FileeError,\r\n  FileHelper: FileHelper\r\n});\r\n\r\n/** truncate webpack mangled names. defaults to true\r\n *  so Mesh$1 turns into Mesh */\r\nfunction truncateDollarSign(value = true) {\r\n  setTruncateDollarSign(value);\r\n}\r\n\r\nfunction validateStructs(onerror) {\r\n  return manager.validateStructs(onerror);\r\n}\r\n\r\n/**\r\n true means little endian, false means big endian\r\n */\r\nfunction setEndian(mode) {\r\n  let ret = STRUCT_ENDIAN;\r\n\r\n  setBinaryEndian(mode);\r\n\r\n  return ret;\r\n}\r\n\r\nfunction consoleLogger() {\r\n  console.log(...arguments);\r\n}\r\n\r\n/** Validate json\r\n *\r\n * @param json\r\n * @param cls\r\n * @param useInternalParser If true (the default) an internal parser will be used that generates nicer error messages\r\n * @param printColors\r\n * @param logger\r\n * @returns {*}\r\n */\r\nfunction validateJSON(json, cls, useInternalParser, printColors = true, logger = consoleLogger) {\r\n  return manager.validateJSON(json, cls, useInternalParser, printColors, logger);\r\n}\r\n\r\nfunction getEndian() {\r\n  return STRUCT_ENDIAN;\r\n}\r\n\r\nfunction setAllowOverriding(t) {\r\n  return manager.allowOverriding = !!t;\r\n}\r\n\r\nfunction isRegistered(cls) {\r\n  return manager.isRegistered(cls);\r\n}\r\n\r\n/** Register a class inline.\r\n *\r\n * Note: No need to use nstructjs.inherit,\r\n * inheritance is handled for you.  Unlike\r\n * nstructjs.inherit fields can be properly\r\n * overridden in the child class without\r\n * being written twice.\r\n *\r\n * class Test {\r\n *  test = 0;\r\n *\r\n *  static STRUCT = nstructjs.inlineRegister(this, `\r\n *  namespace.Test {\r\n *    test : int;\r\n *  }\r\n *  `);\r\n * }\r\n **/\r\nfunction inlineRegister(cls, structScript) {\r\n  return manager.inlineRegister(cls, structScript);\r\n}\r\n\r\n/** Register a class with nstructjs **/\r\nfunction register(cls, structName) {\r\n  return manager.register(cls, structName);\r\n}\r\n\r\nfunction unregister(cls) {\r\n  manager.unregister(cls);\r\n}\r\n\r\nfunction inherit(child, parent, structName = child.name) {\r\n\r\n  return STRUCT.inherit(...arguments);\r\n}\r\n\r\n/**\r\n @param data : DataView\r\n */\r\nfunction readObject(data, cls, __uctx = undefined) {\r\n  return manager.readObject(data, cls, __uctx);\r\n}\r\n\r\n/**\r\n @param data : Array instance to write bytes to\r\n */\r\nfunction writeObject(data, obj) {\r\n  return manager.writeObject(data, obj);\r\n}\r\n\r\nfunction writeJSON(obj) {\r\n  return manager.writeJSON(obj);\r\n}\r\n\r\nfunction formatJSON(json, cls, addComments = true, validate = true) {\r\n  return manager.formatJSON(json, cls, addComments, validate);\r\n}\r\n\r\nfunction readJSON(json, class_or_struct_id) {\r\n  return manager.readJSON(json, class_or_struct_id);\r\n}\r\n\r\nexport { JSONError, STRUCT, _truncateDollarSign, struct_binpack as binpack, consoleLogger, deriveStructManager, struct_filehelper as filehelper, formatJSON, getEndian, inherit, inlineRegister, isRegistered, manager, struct_parser as parser, struct_parseutil as parseutil, readJSON, readObject, register, setAllowOverriding, setDebugMode, setEndian, setTruncateDollarSign, setWarningMode, truncateDollarSign, struct_typesystem as typesystem, unpack_context, unregister, validateJSON, validateStructs, writeJSON, writeObject, write_scripts };\r\n", "import * as nstructjs from './nstructjs_es6.js';\r\nexport default nstructjs;\r\n", "// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\r\n// This work is free. You can redistribute it and/or modify it\r\n// under the terms of the WTFPL, Version 2\r\n// For more information see LICENSE.txt or http://www.wtfpl.net/\r\n//\r\n// For more information, the home page:\r\n// http://pieroxy.net/blog/pages/lz-string/testing.html\r\n//\r\n// LZ-based compression algorithm, version 1.4.4\r\n\r\n// private property\r\nlet f = String.fromCharCode;\r\nlet keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\nlet keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\r\nlet baseReverseDic = {};\r\n\r\nfunction getBaseValue(alphabet, character) {\r\n  if (!baseReverseDic[alphabet]) {\r\n    baseReverseDic[alphabet] = {};\r\n    for (let i = 0; i < alphabet.length; i++) {\r\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\r\n    }\r\n  }\r\n  return baseReverseDic[alphabet][character];\r\n}\r\n\r\nfunction getInput(input) {\r\n  if (input === null) {\r\n    return '';\r\n  } else if (input === '') {\r\n    return null;\r\n  }\r\n\r\n  if (typeof input === \"string\") {\r\n    return input;\r\n  }\r\n\r\n  if (input instanceof ArrayBuffer) {\r\n    input = new Uint8Array(input);\r\n  }\r\n\r\n  let s = '';\r\n  for (let i = 0; i < input.length; i++) {\r\n    s += String.fromCharCode(input[i]);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nexport default {\r\n  compressToBase64: function (input) {\r\n    input = getInput(input);\r\n\r\n    if (!input) return \"\";\r\n\r\n    let res = this._compress(input, 6, function (a) {\r\n      return keyStrBase64.charAt(a);\r\n    });\r\n    switch (res.length%4) { // To produce valid Base64\r\n      default: // When could this happen ?\r\n      case 0 :\r\n        return res;\r\n      case 1 :\r\n        return res + \"===\";\r\n      case 2 :\r\n        return res + \"==\";\r\n      case 3 :\r\n        return res + \"=\";\r\n    }\r\n  },\r\n\r\n  decompressFromBase64: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n\r\n    input = getInput(input);\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrBase64, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compressToUTF16: function (input) {\r\n    if (input === null) return \"\";\r\n\r\n    input = getInput(input);\r\n    return this._compress(input, 15, function (a) {\r\n      return f(a + 32);\r\n    }) + \" \";\r\n  },\r\n\r\n  decompressFromUTF16: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n    return this._decompress(compressed.length, 16384, function (index) {\r\n      return compressed.charCodeAt(index) - 32;\r\n    });\r\n  },\r\n\r\n  //compress into uint8array (UCS-2 big endian format)\r\n  compressToUint8Array: function (uncompressed) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    let compressed = this.compress(uncompressed);\r\n    let buf = new Uint8Array(compressed.length*2); // 2 bytes per character\r\n\r\n    for (let i = 0, TotalLen = compressed.length; i < TotalLen; i++) {\r\n      let current_value = compressed.charCodeAt(i);\r\n      buf[i*2] = current_value>>>8;\r\n      buf[i*2 + 1] = current_value%256;\r\n    }\r\n    return buf;\r\n  },\r\n\r\n  //decompress from uint8array (UCS-2 big endian format)\r\n  decompressFromUint8Array: function (compressed) {\r\n    if (compressed === null || compressed === undefined) {\r\n      return this.decompress(compressed);\r\n    } else {\r\n      compressed = getInput(compressed);\r\n\r\n      let buf = new Array(compressed.length/2); // 2 bytes per character\r\n      for (let i = 0, TotalLen = buf.length; i < TotalLen; i++) {\r\n        buf[i] = compressed[i*2]*256 + compressed[i*2 + 1];\r\n      }\r\n\r\n      let result = [];\r\n      buf.forEach(function (c) {\r\n        result.push(f(c));\r\n      });\r\n      return this.decompress(result.join(''));\r\n\r\n    }\r\n\r\n  },\r\n\r\n\r\n  //compress into a string that is already URI encoded\r\n  compressToEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    return this._compress(input, 6, function (a) {\r\n      return keyStrUriSafe.charAt(a);\r\n    });\r\n  },\r\n\r\n  //decompress from an output of compressToEncodedURIComponent\r\n  decompressFromEncodedURIComponent: function (input) {\r\n    if (input === null) return \"\";\r\n    if (input === \"\") return null;\r\n    input = input.replace(/ /g, \"+\");\r\n    return this._decompress(input.length, 32, function (index) {\r\n      return getBaseValue(keyStrUriSafe, input.charAt(index));\r\n    });\r\n  },\r\n\r\n  compress : function (uncompressed) {\r\n    return this._compress(uncompressed, 16, function (a) {\r\n      return f(a);\r\n    });\r\n  },\r\n\r\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\r\n    uncompressed = getInput(uncompressed);\r\n\r\n    if (uncompressed === null) return \"\";\r\n    let i, value, context_dictionary = {}, context_dictionaryToCreate = {}, context_c = \"\", context_wc = \"\",\r\n        context_w                                                                                      = \"\", context_enlargeIn = 2, // Compensate for the first entry which should not count\r\n        context_dictSize                                                                               = 3, context_numBits = 2, context_data                                        = [], context_data_val = 0,\r\n        context_data_position                                                                          = 0, ii;\r\n\r\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\r\n      context_c = uncompressed.charAt(ii);\r\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\r\n        context_dictionary[context_c] = context_dictSize++;\r\n        context_dictionaryToCreate[context_c] = true;\r\n      }\r\n\r\n      context_wc = context_w + context_c;\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\r\n        context_w = context_wc;\r\n      } else {\r\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n          if (context_w.charCodeAt(0) < 256) {\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 8; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          } else {\r\n            value = 1;\r\n            for (i = 0; i < context_numBits; i++) {\r\n              context_data_val = (context_data_val<<1) | value;\r\n              if (context_data_position == bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = 0;\r\n            }\r\n            value = context_w.charCodeAt(0);\r\n            for (i = 0; i < 16; i++) {\r\n              context_data_val = (context_data_val<<1) | (value & 1);\r\n              if (context_data_position === bitsPerChar - 1) {\r\n                context_data_position = 0;\r\n                context_data.push(getCharFromInt(context_data_val));\r\n                context_data_val = 0;\r\n              } else {\r\n                context_data_position++;\r\n              }\r\n              value = value>>1;\r\n            }\r\n          }\r\n          context_enlargeIn--;\r\n          if (context_enlargeIn === 0) {\r\n            context_enlargeIn = Math.pow(2, context_numBits);\r\n            context_numBits++;\r\n          }\r\n          delete context_dictionaryToCreate[context_w];\r\n        } else {\r\n          value = context_dictionary[context_w];\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n\r\n\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        // Add wc to the dictionary.\r\n        context_dictionary[context_wc] = context_dictSize++;\r\n        context_w = String(context_c);\r\n      }\r\n    }\r\n\r\n    // Output the code for w.\r\n    if (context_w !== \"\") {\r\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\r\n        if (context_w.charCodeAt(0) < 256) {\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 8; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        } else {\r\n          value = 1;\r\n          for (i = 0; i < context_numBits; i++) {\r\n            context_data_val = (context_data_val<<1) | value;\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = 0;\r\n          }\r\n          value = context_w.charCodeAt(0);\r\n          for (i = 0; i < 16; i++) {\r\n            context_data_val = (context_data_val<<1) | (value & 1);\r\n            if (context_data_position === bitsPerChar - 1) {\r\n              context_data_position = 0;\r\n              context_data.push(getCharFromInt(context_data_val));\r\n              context_data_val = 0;\r\n            } else {\r\n              context_data_position++;\r\n            }\r\n            value = value>>1;\r\n          }\r\n        }\r\n        context_enlargeIn--;\r\n        if (context_enlargeIn === 0) {\r\n          context_enlargeIn = Math.pow(2, context_numBits);\r\n          context_numBits++;\r\n        }\r\n        delete context_dictionaryToCreate[context_w];\r\n      } else {\r\n        value = context_dictionary[context_w];\r\n        for (i = 0; i < context_numBits; i++) {\r\n          context_data_val = (context_data_val<<1) | (value & 1);\r\n          if (context_data_position === bitsPerChar - 1) {\r\n            context_data_position = 0;\r\n            context_data.push(getCharFromInt(context_data_val));\r\n            context_data_val = 0;\r\n          } else {\r\n            context_data_position++;\r\n          }\r\n          value = value>>1;\r\n        }\r\n\r\n\r\n      }\r\n      context_enlargeIn--;\r\n      if (context_enlargeIn === 0) {\r\n        context_enlargeIn = Math.pow(2, context_numBits);\r\n        context_numBits++;\r\n      }\r\n    }\r\n\r\n    // Mark the end of the stream\r\n    value = 2;\r\n    for (i = 0; i < context_numBits; i++) {\r\n      context_data_val = (context_data_val<<1) | (value & 1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data_position = 0;\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        context_data_val = 0;\r\n      } else {\r\n        context_data_position++;\r\n      }\r\n      value = value>>1;\r\n    }\r\n\r\n    // Flush the last char\r\n    while (true) {\r\n      context_data_val = (context_data_val<<1);\r\n      if (context_data_position === bitsPerChar - 1) {\r\n        context_data.push(getCharFromInt(context_data_val));\r\n        break;\r\n      } else context_data_position++;\r\n    }\r\n    return context_data.join('');\r\n  },\r\n\r\n  decompress: function (compressed) {\r\n    if (compressed === null) return \"\";\r\n    if (compressed === \"\") return null;\r\n\r\n    compressed = getInput(compressed);\r\n\r\n    return this._decompress(compressed.length, 32768, function (index) {\r\n      return compressed.charCodeAt(index);\r\n    });\r\n  },\r\n\r\n  _decompress: function (length, resetValue, getNextValue) {\r\n    let dictionary = [], next, enlargeIn = 4, dictSize = 4, numBits = 3, entry = \"\", result = [], i, w,\r\n        bits, resb,\r\n        maxpower, power, c, data                                                            = {val: getNextValue(0), position: resetValue, index: 1};\r\n\r\n    for (i = 0; i < 3; i += 1) {\r\n      dictionary[i] = i;\r\n    }\r\n\r\n    bits = 0;\r\n    maxpower = Math.pow(2, 2);\r\n    power = 1;\r\n    while (power !== maxpower) {\r\n      resb = data.val & data.position;\r\n      data.position >>= 1;\r\n      if (data.position === 0) {\r\n        data.position = resetValue;\r\n        data.val = getNextValue(data.index++);\r\n      }\r\n      bits |= (resb > 0 ? 1 : 0)*power;\r\n      power <<= 1;\r\n    }\r\n\r\n    switch (next = bits) {\r\n      case 0:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 8);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 1:\r\n        bits = 0;\r\n        maxpower = Math.pow(2, 16);\r\n        power = 1;\r\n        while (power !== maxpower) {\r\n          resb = data.val & data.position;\r\n          data.position >>= 1;\r\n          if (data.position === 0) {\r\n            data.position = resetValue;\r\n            data.val = getNextValue(data.index++);\r\n          }\r\n          bits |= (resb > 0 ? 1 : 0)*power;\r\n          power <<= 1;\r\n        }\r\n        c = f(bits);\r\n        break;\r\n      case 2:\r\n        return \"\";\r\n    }\r\n    dictionary[3] = c;\r\n    w = c;\r\n    result.push(c);\r\n    while (true) {\r\n      if (data.index > length) {\r\n        return \"\";\r\n      }\r\n\r\n      bits = 0;\r\n      maxpower = Math.pow(2, numBits);\r\n      power = 1;\r\n      while (power !== maxpower) {\r\n        resb = data.val & data.position;\r\n        data.position >>= 1;\r\n        if (data.position === 0) {\r\n          data.position = resetValue;\r\n          data.val = getNextValue(data.index++);\r\n        }\r\n        bits |= (resb > 0 ? 1 : 0)*power;\r\n        power <<= 1;\r\n      }\r\n\r\n      switch (c = bits) {\r\n        case 0:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 8);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 1:\r\n          bits = 0;\r\n          maxpower = Math.pow(2, 16);\r\n          power = 1;\r\n          while (power !== maxpower) {\r\n            resb = data.val & data.position;\r\n            data.position >>= 1;\r\n            if (data.position === 0) {\r\n              data.position = resetValue;\r\n              data.val = getNextValue(data.index++);\r\n            }\r\n            bits |= (resb > 0 ? 1 : 0)*power;\r\n            power <<= 1;\r\n          }\r\n          dictionary[dictSize++] = f(bits);\r\n          c = dictSize - 1;\r\n          enlargeIn--;\r\n          break;\r\n        case 2:\r\n          return result.join('');\r\n      }\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n      if (dictionary[c]) {\r\n        entry = dictionary[c];\r\n      } else {\r\n        if (c === dictSize) {\r\n          entry = w + w.charAt(0);\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n      result.push(entry);\r\n\r\n      // Add w+entry[0] to the dictionary.\r\n      dictionary[dictSize++] = w + entry.charAt(0);\r\n      enlargeIn--;\r\n\r\n      w = entry;\r\n\r\n      if (enlargeIn === 0) {\r\n        enlargeIn = Math.pow(2, numBits);\r\n        numBits++;\r\n      }\r\n\r\n    }\r\n  }\r\n};\r\n", "export let config = {\r\n  doubleClickTime : 500,\r\n\r\n  //auto load 1d bspline templates, can hurt startup time\r\n  autoLoadSplineTemplates : true,\r\n\r\n  //timeout for press-and-hold (touch) version of double clicking\r\n  doubleClickHoldTime : 750,\r\n  DEBUG : {\r\n\r\n  }\r\n};\r\n\r\nexport function setConfig(obj) {\r\n  for (let k in obj) {\r\n    config[k] = obj[k];\r\n  }\r\n}\r\n\r\nexport default config;\r\n", "let _clipdata = {\r\n  name: \"nothing\",\r\n  mime: \"nothing\",\r\n  data: undefined\r\n};\r\n\r\nlet _clipboards = {};\r\n\r\nimport * as ctrlconfig from '../path-controller/config/config.js';\r\n\r\nwindow.setInterval(() => {\r\n  if (!document.hasFocus()) {\r\n    return\r\n  }\r\n\r\n  let cb = navigator.clipboard;\r\n  if (!cb || !cb.read) {\r\n    return;\r\n  }\r\n\r\n  cb.read().then((data) => {\r\n    for (let item of data) {\r\n      for (let i = 0; i < item.types.length; i++) {\r\n        let type = item.types[i];\r\n\r\n        if (!(type in _clipboards)) {\r\n          _clipboards[type] = {\r\n            name: type,\r\n            mime: type,\r\n            data: undefined\r\n          };\r\n        }\r\n        ;\r\n\r\n        item.getType(type).then((blob) => new Response(blob).text()).then((text) => {\r\n          _clipboards[type].data = text;\r\n        });\r\n      }\r\n    }\r\n  }).catch(function () {\r\n  });\r\n}, 200);\r\n\r\nlet exports = {\r\n  /** Client code can override this using `.loadConstants`, this is\r\n   *  a simple implementation that just handles color data.\r\n   *\r\n   * `desiredMimes` is either a string, or an array of strings\r\n   */\r\n  getClipboardData(desiredMimes = \"text/plain\") {\r\n    if (typeof desiredMimes === \"string\") {\r\n      desiredMimes = [desiredMimes];\r\n    }\r\n\r\n    for (let m of desiredMimes) {\r\n      let cb = _clipboards[m];\r\n\r\n      if (cb && cb.data) {\r\n        return cb;\r\n      }\r\n    }\r\n  },\r\n\r\n\r\n  /** Client code can override this. This is a simple implementation\r\n   *  that just handles color data\r\n   */\r\n  setClipboardData(name, mime, data) {\r\n    _clipboards[mime] = {\r\n      name: name,\r\n      mime: mime,\r\n      data: data\r\n    };\r\n\r\n    let clipboard = navigator.clipboard;\r\n    if (!clipboard) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      clipboard.write([new ClipboardItem({\r\n        [mime]: new Blob([data], {type: mime})\r\n      })]).catch((error) => {\r\n        //try pushing through text/plain\r\n        if (mime.startsWith(\"text\") && mime !== \"text/plain\") {\r\n          this.setClipboardData(name, \"text/plain\", data);\r\n        } else {\r\n          console.error(error);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(\"failed to write to system clipboard\");\r\n    }\r\n  },\r\n  colorSchemeType: \"light\",\r\n  docManualPath  : \"../simple_docsys/doc_build/\",\r\n  docEditorPath  : \"../simple_docsys.js\",\r\n\r\n  /* Add textboxes to rollar sliders,\r\n     note that  users can also double click them to\r\n     enter text as well\r\n   */\r\n  useNumSliderTextboxes: true,\r\n\r\n  numSliderArrowLimit: 15, /* Threshold to check if numslider arrow was clicked. */\r\n  simpleNumSliders   : false,\r\n\r\n  menusCanPopupAbove: false,\r\n  menu_close_time   : 500,\r\n  doubleClickTime   : 500,\r\n\r\n  /* Timeout for press-and-hold (touch) version of double clicking. */\r\n  doubleClickHoldTime: 750,\r\n  DEBUG              : {\r\n    paranoidEvents      : false,\r\n    screenborders       : false,\r\n    areaContextPushes   : false,\r\n    allBordersMovable   : false,\r\n    doOnce              : false,\r\n    modalEvents         : false,\r\n    areaConstraintSolver: false,\r\n    datapaths           : false,\r\n    lastToolPanel       : false,\r\n\r\n    domEvents        : false,\r\n    domEventAddRemove: false,\r\n\r\n    debugUIUpdatePerf: false, /* Turns async FrameManager.update_intern loop into sync. */\r\n\r\n    screenAreaPosSizeAccesses: false,\r\n    buttonEvents             : false,\r\n\r\n    /*\r\n    customWindowSize: {\r\n      width: 2048, height: 2048\r\n    },\r\n    //*/\r\n  },\r\n\r\n  /* Auto load 1d bspline templates, can hurt startup time. */\r\n  autoLoadSplineTemplates: true,\r\n\r\n  addHelpPickers: true,\r\n\r\n  useAreaTabSwitcher : false,\r\n  autoSizeUpdate     : true,\r\n  showPathsInToolTips: true,\r\n\r\n  enableThemeAutoUpdate: true,\r\n  useNativeToolTips    : true,\r\n  noElectronMenus      : false,\r\n\r\n  loadConstants: function (args) {\r\n    for (let k in args) {\r\n      if (k === \"loadConstants\")\r\n        continue;\r\n\r\n      this[k] = args[k];\r\n    }\r\n\r\n    ctrlconfig.setConfig(this);\r\n  }\r\n};\r\n\r\nexport default exports;\r\nwindow.DEBUG = exports.DEBUG;\r\n\r\nlet cfg = document.getElementById(\"pathux-config\");\r\nif (cfg) {\r\n  exports.loadConstants(JSON.parse(cfg.innerText));\r\n}\r\n", "import * as util from './util.js';\r\nimport nstructjs from './struct.js';\r\n\r\nexport const EulerOrders = {\r\n  XYZ: 0,\r\n  XZY: 1,\r\n  YXZ: 2,\r\n  YZX: 3,\r\n  ZXY: 4,\r\n  ZYX: 5\r\n};\r\n\r\n/**\r\n * @param mode one of 'es', 'commonjs', 'rjs'\r\n */\r\nwindow.makeCompiledVectormathCode = function (mode = \"es\") {\r\n  let s = \"\";\r\n  let es6exports = mode === \"es\";\r\n\r\n  function doExports(name) {\r\n    if (es6exports) {\r\n      return \"export\";\r\n    } else {\r\n      return `let ${name} = exports.${name} =`;\r\n    }\r\n  }\r\n\r\n  let classes = [Vector2, Vector3, Vector4, a];\r\n  let lens = {\r\n    Vector2: 2,\r\n    Vector3: 3,\r\n    Vector4: 4,\r\n    Quat   : 4\r\n  };\r\n\r\n  let modecode = \"\";\r\n\r\n  let nstructjscode = `\r\n  let g = typeof window !== \"undefined\" ? window : \"undefined\";\r\n  \r\n  g = g || (typeof global !== \"undefined\" ? global : \"undefined\");\r\n  g = g || (typeof self !== \"undefined\" ? self : \"undefined\");\r\n  g = g || (typeof globals !== \"undefined\" ? globals : \"undefined\");\r\n\r\n  if (typeof nstructjs === \"undefined\") {\r\n    //add nstructjs stub\r\n    g.nstructjs = {\r\n      register : function() {}\r\n    }\r\n  }\r\n  `\r\n\r\n  if (mode !== \"rjs\") {\r\n    if (mode === \"commonjs\") {\r\n      modecode = `if (typeof module !== \"undefined\" && typeof exports === \"undefined\") {\r\n      if (module.exports === undefined) {\r\n        module.exports = {};\r\n      }\r\n      \r\n      g.exports = module.exports;\r\n    } else if (typeof module === \"undefined\") {\r\n      g.exports = g.vectormath = {};\r\n    }\\n`;\r\n    }\r\n\r\n    s += `{\r\n      ${nstructjscode}\r\n    ${modecode}\r\n  }`;\r\n  }\r\n\r\n  s += `\r\nclass cachering extends Array {\r\n  constructor(func, size) {\r\n    super()\r\n\r\n    this.cur = 0;\r\n\r\n    for (let i=0; i<size; i++) {\r\n      this.push(func());\r\n    }\r\n  }\r\n\r\n  static fromConstructor(cls, size) {\r\n    let func = function() {\r\n      return new cls();\r\n    }\r\n\r\n    return new cachering(func, size);\r\n  }\r\n\r\n  next() {\r\n    let ret = this[this.cur];\r\n    this.cur = (this.cur+1)%this.length;\r\n\r\n    return ret;\r\n  }\r\n}\r\n`;\r\n  s += `\r\n\r\nlet M_SQRT2 = Math.sqrt(2.0);\r\nlet FLT_EPSILON = 2.22e-16;  \r\nlet sin=Math.sin, cos=Math.cos, abs=Math.abs, log=Math.log,\r\n    asin=Math.asin, exp=Math.exp, acos=Math.acos, fract=Math.fract,\r\n    sign=Math.sign, tent=Math.tent, atan2=Math.atan2, atan=Math.atan,\r\n    pow=Math.pow, sqrt=Math.sqrt, floor=Math.floor, ceil=Math.ceil,\r\n    min=Math.min, max=Math.max, PI=Math.PI, E=2.718281828459045;\r\n\r\nlet DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\n\r\n${doExports(\"BaseVector\")} class BaseVector extends Array {\r\n  constructor() {\r\n    super();\r\n    \r\n    this.vec = undefined; //for compatibility with old files\r\n  }\r\n\r\n  copy() {\r\n    return new this.constructor(this);\r\n  }\r\n\r\n  load(data) {\r\n    throw new Error(\"Implement me!\");\r\n  }\r\n  \r\n  vectorLength() {\r\n    return sqrt(this.dot(this));\r\n  }\r\n  \r\n  normalize() {\r\n    let l = this.vectorLength();\r\n    if (l > 0.00000001) {\r\n      this.mulScalar(1.0/l);\r\n    }\r\n    \r\n    return this;\r\n  }\r\n}\r\n  \r\n`;\r\n\r\n  function indent(s, pad = \"  \") {\r\n    let l = s.split(\"\\n\");\r\n    let s2 = \"\";\r\n\r\n    for (let l2 of l) {\r\n      s2 += pad + l2 + \"\\n\";\r\n    }\r\n\r\n    return s2;\r\n  }\r\n\r\n  let i = 0;\r\n  for (let cls of classes) {\r\n    s += doExports(cls.name) + \" class \" + cls.name + \" extends BaseVector {\\n\";\r\n\r\n    let keys = Reflect.ownKeys(cls.prototype);\r\n\r\n    for (let k of keys) {\r\n      let v = cls.prototype[k];\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"symbol\") {\r\n        k = \"  [\" + k.toString() + \"]\";\r\n      }\r\n\r\n      v = (\"\" + v).trim();\r\n      if (v.startsWith(\"function(\") || v.startsWith(\"function (\")) {\r\n        v = k + v.slice(8, v.length).trim();\r\n      } else if (v.startsWith(\"function\")) {\r\n        v = v.slice(8, v.length).trim();\r\n      }\r\n\r\n      if (v.endsWith(\";}\")) {\r\n        v = v.slice(0, v.length - 1) + \"\\n  }\\n\";\r\n      }\r\n\r\n      let zero = \"\";\r\n      let l = lens[cls.name];\r\n\r\n      for (let j = 0; j < l; j++) {\r\n        if (j > 0) {\r\n          zero += \" = \";\r\n        }\r\n        zero += `this[${j}]`;\r\n      }\r\n\r\n      zero += \" = 0.0\";\r\n\r\n      if (k === \"constructor\") {\r\n        s += `  constructor(data) {\r\n    super(${l});\r\n        \r\n    this.vec = undefined; //for compatibility with old files\r\n    \r\n    if (arguments.length > 1) {\r\n      throw new Error(\"unexpected argument\");\r\n    }\r\n\r\n    //this.length = ${l};\r\n    ${zero};\r\n\r\n    if (data !== undefined) {\r\n      this.load(data);\r\n    }\r\n  }\r\n`;\r\n      } else {\r\n        s += indent(v);\r\n      }\r\n\r\n      s += \"\\n\";\r\n      i++;\r\n    }\r\n    s += \"}\\n\\n\"\r\n\r\n    s += `${cls.name}.STRUCT = \\`${cls.STRUCT}\\`;\\n`;\r\n    s += `nstructjs.register(${cls.name});\\n\\n`;\r\n  }\r\n\r\n  s += \"\\n\\n\" + (\"\" + internal_matrix).trim() + \"\\n\";\r\n  s += \"\\n\" + doExports(\"Matrix4\") + Matrix4;\r\n\r\n  s += `\\n  Matrix4.STRUCT = \\`${Matrix4.STRUCT}\\`;\\n`;\r\n  s += \"nstructjs.register(Matrix4)\\n\";\r\n\r\n  s += `\r\n  let _quat_vs3_temps = cachering.fromConstructor(Vector3, 64);\r\n  let _v3nd4_n1_normalizedDot4 = new Vector3();\r\n  let _v3nd4_n2_normalizedDot4 = new Vector3();\r\n  let _v3nd_n1_normalizedDot = new Vector3();\r\n  let _v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  let $_v3nd4_n1_normalizedDot4 = new Vector3();\r\n  let $_v3nd4_n2_normalizedDot4 = new Vector3();\r\n  let $_v3nd_n1_normalizedDot = new Vector3();\r\n  let $_v3nd_n2_normalizedDot = new Vector3();\r\n\r\n  let lookat_cache_vs3 = cachering.fromConstructor(Vector3, 64);\r\n  let lookat_cache_vs4 = cachering.fromConstructor(Vector4, 64);\r\n\r\n  let makenormalcache = cachering.fromConstructor(Vector3, 64);\r\n`;\r\n\r\n  if (mode === \"rjs\") {\r\n    s = `define([], function() {\r\n  \"use strict\";\r\n\r\n  let exports = {};\r\n\r\n  {\r\n    ${nstructjscode}\r\n  }\r\n  ${indent(s)}\r\n\r\n  return exports;\r\n});\r\n`;\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet sin                                                          = Math.sin, cos = Math.cos, abs = Math.abs, log = Math.log,\r\n    asin                                                         = Math.asin, exp = Math.exp, acos = Math.acos, fract    = Math.fract,\r\n    sign = Math.sign, tent = Math.tent, atan2 = Math.atan2, atan = Math.atan,\r\n    pow                                                          = Math.pow, sqrt = Math.sqrt, floor                      = Math.floor, ceil   = Math.ceil,\r\n    min                                                          = Math.min, max                                          = Math.max, PI = Math.PI, E = 2.718281828459045;\r\n\r\nlet DOT_NORM_SNAP_LIMIT = 0.00000000001;\r\nlet M_SQRT2 = Math.sqrt(2.0);\r\nlet FLT_EPSILON = 2.22e-16;\r\n\r\nlet basic_funcs = {\r\n  equals: [[\"b\"], \"this[X] === b[X]\", \"&&\"],\r\n  /*dot is made manually so it's safe for acos\r\n  dot     : [[\"b\"], \"this[X]*b[X]\", \"+\"],\r\n   */\r\n  zero     : [[], \"0.0;\"],\r\n  negate   : [[], \"-this[X];\"],\r\n  combine  : [[\"b\", \"u\", \"v\"], \"this[X]*u + this[X]*v;\"],\r\n  interp   : [[\"b\", \"t\"], \"this[X] + (b[X] - this[X])*t;\"],\r\n  add      : [[\"b\"], \"this[X] + b[X];\"],\r\n  addFac   : [[\"b\", \"F\"], \"this[X] + b[X]*F;\"],\r\n  fract    : [[], \"Math.fract(this[X]);\"],\r\n  sub      : [[\"b\"], \"this[X] - b[X];\"],\r\n  mul      : [[\"b\"], \"this[X] * b[X];\"],\r\n  div      : [[\"b\"], \"this[X] / b[X];\"],\r\n  mulScalar: [[\"b\"], \"this[X] * b;\"],\r\n  divScalar: [[\"b\"], \"this[X] / b;\"],\r\n  addScalar: [[\"b\"], \"this[X] + b;\"],\r\n  subScalar: [[\"b\"], \"this[X] - b;\"],\r\n  minScalar: [[\"b\"], \"Math.min(this[X], b);\"],\r\n  maxScalar: [[\"b\"], \"Math.max(this[X], b);\"],\r\n  ceil     : [[], \"Math.ceil(this[X])\"],\r\n  floor    : [[], \"Math.floor(this[X])\"],\r\n  abs      : [[], \"Math.abs(this[X])\"],\r\n  min      : [[\"b\"], \"Math.min(this[X], b[X])\"],\r\n  max      : [[\"b\"], \"Math.max(this[X], b[X])\"],\r\n  clamp    : [[\"MIN\", \"MAX\"], \"min(max(this[X], MAX), MIN)\"],\r\n};\r\n\r\nfunction bounded_acos(fac) {\r\n  if (fac <= -1.0)\r\n    return Math.pi;\r\n  else if (fac >= 1.0)\r\n    return 0.0;\r\n  else\r\n    return Math.acos(fac);\r\n}\r\n\r\nfunction make_norm_safe_dot(cls) {\r\n  let _dot = cls.prototype.dot;\r\n\r\n  cls.prototype._dot = _dot;\r\n  cls.prototype.dot = function (b) {\r\n    let ret = _dot.call(this, b);\r\n\r\n    if (ret >= 1.0 - DOT_NORM_SNAP_LIMIT && ret <= 1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return 1.0;\r\n    if (ret >= -1.0 - DOT_NORM_SNAP_LIMIT && ret <= -1.0 + DOT_NORM_SNAP_LIMIT)\r\n      return -1.0;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nfunction getBaseVector(parent) {\r\n  return class BaseVector extends parent {\r\n    constructor() {\r\n      super(...arguments);\r\n\r\n      this.vec = undefined; //for compatibility with old nstructjs-saved files\r\n\r\n      //this.xyzw = this.init_swizzle(4);\r\n      //this.xyz = this.init_swizzle(3);\r\n      //this.xy = this.init_swizzle(2);\r\n    }\r\n\r\n    static inherit(cls, vectorsize) {\r\n      make_norm_safe_dot(cls);\r\n\r\n      var f;\r\n\r\n      let vectorDotDistance = \"f = function vectorDotDistance(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDotDistance += \"  let d\" + i + \" = this[\" + i + \"]-b[\" + i + \"];\\n\\n  \";\r\n      }\r\n\r\n      vectorDotDistance += \"  return \"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDotDistance += \" + \";\r\n        vectorDotDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDotDistance += \";\\n\"\r\n      vectorDotDistance += \"};\";\r\n      cls.prototype.vectorDotDistance = eval(vectorDotDistance);\r\n\r\n      f = undefined\r\n      let vectorDistance = \"f = function vectorDistance(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDistance += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistance += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistance += \"  return Math.sqrt(\"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistance += \" + \";\r\n        vectorDistance += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistance += \");\\n\"\r\n      vectorDistance += \"};\";\r\n      cls.prototype.vectorDistance = eval(vectorDistance);\r\n\r\n      let vectorDistanceSqr = \"f = function vectorDistanceSqr(b) {\\n\";\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        vectorDistanceSqr += `  let d${i} = this[${i}] - (b[${i}]||0);\\n\\n  `;\r\n        //vectorDistanceSqr += \"  let d\"+i+\" = this[\"+i+\"]-(b[\"+i+\"]||0);\\n\\n  \";\r\n      }\r\n\r\n      vectorDistanceSqr += \"  return (\"\r\n      for (let i = 0; i < vectorsize; i++) {\r\n        if (i > 0)\r\n          vectorDistanceSqr += \" + \";\r\n        vectorDistanceSqr += \"d\" + i + \"*d\" + i;\r\n      }\r\n      vectorDistanceSqr += \");\\n\"\r\n      vectorDistanceSqr += \"};\";\r\n      cls.prototype.vectorDistanceSqr = eval(vectorDistanceSqr);\r\n\r\n\r\n      for (let k in basic_funcs) {\r\n        let func = basic_funcs[k];\r\n        let args = func[0];\r\n        let line = func[1];\r\n        var f;\r\n\r\n        let code = \"f = function \" + k + \"(\"\r\n        for (let i = 0; i < args.length; i++) {\r\n          if (i > 0)\r\n            code += \", \";\r\n\r\n          line = line.replace(args[i], args[i].toLowerCase());\r\n          code += args[i].toLowerCase();\r\n        }\r\n        code += \") {\\n\";\r\n\r\n        if (func.length > 2) {\r\n          //make summation\r\n          code += \"  return \";\r\n\r\n          for (let i = 0; i < vectorsize; i++) {\r\n            if (i > 0)\r\n              code += func[2];\r\n\r\n            code += \"(\" + line.replace(/X/g, \"\" + i) + \")\";\r\n          }\r\n          code += \";\\n\";\r\n        } else {\r\n          for (let i = 0; i < vectorsize; i++) {\r\n            let line2 = line.replace(/X/g, \"\" + i);\r\n            code += \"  this[\" + i + \"] = \" + line2 + \";\\n\";\r\n          }\r\n          code += \"  return this;\\n\"\r\n        }\r\n\r\n        code += \"}\\n\";\r\n\r\n        //console.log(code);\r\n        f = eval(code);\r\n\r\n        cls.prototype[k] = f;\r\n        //console.log(k, f);\r\n      }\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this);\r\n    }\r\n\r\n    load(data) {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n    init_swizzle(size) {\r\n      let ret = {};\r\n      let cls = size === 4 ? Vector4 : (size === 3 ? Vector3 : Vector2);\r\n\r\n      for (let k in cls.prototype) {\r\n        let v = cls.prototype[k];\r\n        if (typeof v !== \"function\" && !(v instanceof Function))\r\n          continue;\r\n\r\n        ret[k] = v.bind(this);\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    vectorLength() {\r\n      return sqrt(this.dot(this));\r\n    }\r\n\r\n    swapAxes(axis1, axis2) {\r\n      let t = this[axis1];\r\n      this[axis1] = this[axis2];\r\n      this[axis2] = t;\r\n\r\n      return this;\r\n    }\r\n\r\n    sinterp(v2, t) {\r\n      let l1 = this.vectorLength();\r\n      let l2 = v2.vectorLength();\r\n\r\n      //XXX this seems horribly incorrect.\r\n      return this.interp(v2, t).normalize().mulScalar(l1 + (l2 - l1)*t);\r\n    }\r\n\r\n    perpSwap(axis1 = 0, axis2 = 1, sign = 1) {\r\n      let tmp = this[axis1];\r\n\r\n      this[axis1] = this[axis2]*sign;\r\n      this[axis2] = -tmp*sign;\r\n\r\n      return this;\r\n    }\r\n\r\n    normalize() {\r\n      /*\r\n      for (let i=0; i<this.length; i++) {\r\n        if (util.isDenormal(this[i])) {\r\n          console.error(\"Denormal error\", i, this[i]);\r\n          this[i] = 0.0;\r\n        }\r\n      }\r\n      //*/\r\n\r\n      let l = this.vectorLength();\r\n\r\n      /*\r\n      if (util.isDenormal(l)) {\r\n        console.error(\"Denormal error\", l);\r\n      }\r\n      //*/\r\n\r\n      if (l > 0.00000001) {\r\n        this.mulScalar(1.0/l);\r\n      }\r\n\r\n      return this;\r\n    }\r\n  }\r\n}\r\n\r\nexport const BaseVector = getBaseVector(Array);\r\nexport const F64BaseVector = getBaseVector(Float64Array);\r\nexport const F32BaseVector = getBaseVector(Float32Array);\r\nexport const I32BaseVector = getBaseVector(Int32Array);\r\nexport const I16BaseVector = getBaseVector(Int16Array);\r\nexport const I8BaseVector = getBaseVector(Int8Array);\r\nexport const UI32BaseVector = getBaseVector(Uint32Array);\r\nexport const UI16BaseVector = getBaseVector(Uint16Array);\r\nexport const UI8BaseVector = getBaseVector(Uint8Array);\r\n\r\n\r\nfunction myclamp(f, a, b) {\r\n  return Math.min(Math.max(f, a), b);\r\n}\r\n\r\nexport function makeVector4(BaseVector, structName = 'vec4', structType = 'float') {\r\n  let temp1, temp2, temp3, temp4;\r\n\r\n  const Vector4 = class Vector4 extends BaseVector {\r\n    static STRUCT = nstructjs.inlineRegister(this, `\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n      2 : ${structType};\r\n      3 : ${structType};\r\n    }`);\r\n\r\n    constructor(data) {\r\n      super(4);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = this[2] = this[3] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n    }\r\n\r\n    toCSS() {\r\n      let r = ~~(this[0]*255);\r\n      let g = ~~(this[1]*255);\r\n      let b = ~~(this[2]*255);\r\n      let a = this[3];\r\n      return `rgba(${r},${g},${b},${a})`\r\n    }\r\n\r\n    loadXYZW(x, y, z, w) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n      this[3] = w;\r\n\r\n      return this;\r\n    }\r\n\r\n    loadXYZ(x, y, z) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n      this[2] = data[2];\r\n      this[3] = data[3];\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1] + this[2]*b[2] + this[3]*b[3];\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1] - q[3]*this[2];\r\n      let t1 = q[0]*this[0] + q[2]*this[2] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0] - q[1]*this[2];\r\n\r\n      this[2] = q[0]*this[2] + q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + this[2]*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - this[2]*q[1] + this[0]*q[3];\r\n\r\n      this[2] = t0* -q[3] + this[2]*q[0] - this[0]*q[2] + this[1]*q[1];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    multVecMatrix(matrix) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n      let z = this[2];\r\n      let w = this[3];\r\n\r\n      this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n      this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n      this[2] = w*matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n      this[3] = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n      return this[3];\r\n    }\r\n\r\n    cross(v) {\r\n      let x = this[1]*v[2] - this[2]*v[1];\r\n      let y = this[2]*v[0] - this[0]*v[2];\r\n      let z = this[0]*v[1] - this[1]*v[0];\r\n\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    preNormalizedAngle(v2) {\r\n      let th = this.dot(v2)*0.99999;\r\n      return Math.acos(th);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== \"undefined\") {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  temp1 = new Vector4();\r\n  temp2 = new Vector4();\r\n  temp3 = new Vector4();\r\n  temp4 = new Vector4();\r\n\r\n  return Vector4;\r\n}\r\n\r\nexport const Vector4 = makeVector4(BaseVector);\r\n\r\nlet _v3nd_n1_normalizedDot, _v3nd_n2_normalizedDot;\r\nlet _v3nd4_n1_normalizedDot4, _v3nd4_n2_normalizedDot4;\r\n\r\nexport function makeVector3(BaseVector, structName = 'vec3', structType = 'float', customConstructorCode = undefined) {\r\n  var Vector3;\r\n  var bundlehelper = [nstructjs];\r\n\r\n  const constructorCode = customConstructorCode ?? `\r\n    constructor(data) {\r\n      super(3);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = this[2] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n\r\n      if (this.constructor === Vector3) {\r\n        Object.preventExtensions(this);\r\n      }\r\n    }\r\n  `;\r\n\r\n  const code = `\r\n  let temp1, temp2, temp3, temp4;\r\n  Vector3 = class Vector3 extends BaseVector {\r\n    static STRUCT = bundlehelper[0].inlineRegister(this, \\`\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n      2 : ${structType};\r\n    }\\`);\r\n\r\n    ${constructorCode}\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    toCSS() {\r\n      let r = ~~(this[0]*255);\r\n      let g = ~~(this[1]*255);\r\n      let b = ~~(this[2]*255);\r\n      return \\`rgb(\\${r},\\${g},\\${b})\\`\r\n    }\r\n\r\n    loadXYZ(x, y, z) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    loadXY(x, y) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n\r\n      return this;\r\n    }\r\n\r\n    toJSON() {\r\n      return [this[0], this[1], this[2]];\r\n    }\r\n\r\n    loadJSON(obj) {\r\n      return this.load(obj);\r\n    }\r\n\r\n    initVector3() {\r\n      this.length = 3;\r\n      this[0] = this[1] = this[2] = 0;\r\n      return this;\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      //if (isNaN(data[0]) || isNaN(data[1]) || isNaN(data[2])) {\r\n      //  throw new Error(\"NaN\");\r\n      //}\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n      this[2] = data[2];\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1] + this[2]*b[2];\r\n    }\r\n\r\n    normalizedDot(v) {\r\n      $_v3nd_n1_normalizedDot.load(this);\r\n      $_v3nd_n2_normalizedDot.load(v);\r\n      $_v3nd_n1_normalizedDot.normalize();\r\n      $_v3nd_n2_normalizedDot.normalize();\r\n      return $_v3nd_n1_normalizedDot.dot($_v3nd_n2_normalizedDot);\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1] - q[3]*this[2];\r\n      let t1 = q[0]*this[0] + q[2]*this[2] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0] - q[1]*this[2];\r\n\r\n      this[2] = q[0]*this[2] + q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + this[2]*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - this[2]*q[1] + this[0]*q[3];\r\n\r\n      this[2] = t0* -q[3] + this[2]*q[0] - this[0]*q[2] + this[1]*q[1];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    multVecMatrix(matrix, ignore_w) {\r\n      if (ignore_w === undefined) {\r\n        ignore_w = false;\r\n      }\r\n      let x = this[0];\r\n      let y = this[1];\r\n      let z = this[2];\r\n      this[0] = matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21 + z*matrix.$matrix.m31;\r\n      this[1] = matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22 + z*matrix.$matrix.m32;\r\n      this[2] = matrix.$matrix.m43 + x*matrix.$matrix.m13 + y*matrix.$matrix.m23 + z*matrix.$matrix.m33;\r\n      let w = matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24 + z*matrix.$matrix.m34;\r\n\r\n      if (!ignore_w && w !== 1 && w !== 0 && matrix.isPersp) {\r\n        this[0] /= w;\r\n        this[1] /= w;\r\n        this[2] /= w;\r\n      }\r\n      return w;\r\n    }\r\n\r\n    cross(v) {\r\n      let x = this[1]*v[2] - this[2]*v[1];\r\n      let y = this[2]*v[0] - this[0]*v[2];\r\n      let z = this[0]*v[1] - this[1]*v[0];\r\n\r\n      this[0] = x;\r\n      this[1] = y;\r\n      this[2] = z;\r\n\r\n      return this;\r\n    }\r\n\r\n    //axis is optional, 0\r\n    rot2d(A, axis = 0) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      if (axis === 1) {\r\n        this[0] = x*cos(A) + y*sin(A);\r\n        this[1] = y*cos(A) - x*sin(A);\r\n      } else {\r\n        this[0] = x*cos(A) - y*sin(A);\r\n        this[1] = y*cos(A) + x*sin(A);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    preNormalizedAngle(v2) {\r\n      let th = this.dot(v2)*0.99999;\r\n      return Math.acos(th);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== \"undefined\") {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  temp1 = new Vector3();\r\n  temp2 = new Vector3();\r\n  temp3 = new Vector3();\r\n  temp4 = new Vector3();\r\n  `;\r\n\r\n  eval(code);\r\n  return Vector3;\r\n}\r\n\r\nexport const Vector3 = makeVector3(F64BaseVector);\r\n\r\nexport function makeVector2(BaseVector, structName = 'vec2', structType = 'float') {\r\n  let temp1, temp2, temp3, temp4;\r\n\r\n  const Vector2 = class Vector2 extends BaseVector {\r\n    static STRUCT = nstructjs.inlineRegister(this, `\r\n    ${structName} {\r\n      0 : ${structType};\r\n      1 : ${structType};\r\n    }`);\r\n\r\n    constructor(data) {\r\n      super(2);\r\n\r\n      if (arguments.length > 1) {\r\n        throw new Error(\"unexpected argument\");\r\n      }\r\n\r\n      this[0] = this[1] = 0.0;\r\n\r\n      if (data !== undefined) {\r\n        this.load(data);\r\n      }\r\n    }\r\n\r\n    initVector2(co) {\r\n      this.length = 2;\r\n\r\n      if (co !== undefined) {\r\n        this[0] = co[0];\r\n        this[1] = co[1];\r\n      } else {\r\n        this[0] = this[1] = 0.0;\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    static normalizedDot4(v1, v2, v3, v4) {\r\n      temp1.load(v2).sub(v1).normalize()\r\n      temp2.load(v4).sub(v3).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    static normalizedDot3(v1, center, v2) {\r\n      temp1.load(v1).sub(center).normalize();\r\n      temp2.load(v2).sub(center).normalize();\r\n\r\n      return temp1.dot(temp2);\r\n    }\r\n\r\n    toJSON() {\r\n      return [this[0], this[1]];\r\n    }\r\n\r\n    loadJSON(obj) {\r\n      return this.load(obj);\r\n    }\r\n\r\n    loadXY(x, y) {\r\n      this[0] = x;\r\n      this[1] = y;\r\n\r\n      return this;\r\n    }\r\n\r\n    load(data) {\r\n      if (data === undefined)\r\n        return this;\r\n\r\n      this[0] = data[0];\r\n      this[1] = data[1];\r\n\r\n      return this;\r\n    }\r\n\r\n    //axis is optional, 0\r\n    rot2d(A, axis) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      if (axis === 1) {\r\n        this[0] = x*cos(A) + y*sin(A);\r\n        this[1] = y*cos(A) - x*sin(A);\r\n      } else {\r\n        this[0] = x*cos(A) - y*sin(A);\r\n        this[1] = y*cos(A) + x*sin(A);\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    dot(b) {\r\n      return this[0]*b[0] + this[1]*b[1];\r\n    }\r\n\r\n    multVecMatrix(matrix) {\r\n      let x = this[0];\r\n      let y = this[1];\r\n\r\n      let w = 1.0;\r\n\r\n      this[0] = w*matrix.$matrix.m41 + x*matrix.$matrix.m11 + y*matrix.$matrix.m21;\r\n      this[1] = w*matrix.$matrix.m42 + x*matrix.$matrix.m12 + y*matrix.$matrix.m22;\r\n\r\n      if (matrix.isPersp) {\r\n        let w2 = w*matrix.$matrix.m44 + x*matrix.$matrix.m14 + y*matrix.$matrix.m24;\r\n\r\n        if (w2 !== 0.0) {\r\n          this[0] /= w2;\r\n          this[1] /= w2;\r\n        }\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    mulVecQuat(q) {\r\n      let t0 = -q[1]*this[0] - q[2]*this[1];\r\n      let t1 = q[0]*this[0] - q[3]*this[1];\r\n      let t2 = q[0]*this[1] + q[3]*this[0];\r\n\r\n      let z = q[1]*this[1] - q[2]*this[0];\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      t1 = t0* -q[1] + this[0]*q[0] - this[1]*q[3] + z*q[2];\r\n      t2 = t0* -q[2] + this[1]*q[0] - z*q[1] + this[0]*q[3];\r\n\r\n      this[0] = t1;\r\n      this[1] = t2;\r\n\r\n      return this;\r\n    }\r\n\r\n    vectorLengthSqr() {\r\n      return this.dot(this);\r\n    }\r\n\r\n    loadSTRUCT(reader) {\r\n      reader(this);\r\n\r\n      if (typeof this.vec !== undefined) {\r\n        this.load(this.vec);\r\n        this.vec = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  temp1 = new Vector2();\r\n  temp2 = new Vector2();\r\n  temp3 = new Vector2();\r\n  temp4 = new Vector2();\r\n\r\n  return Vector2;\r\n}\r\n\r\nexport const Vector2 = makeVector2(BaseVector)\r\n\r\nlet _quat_vs3_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport class Quat extends Vector4 {\r\n  makeUnitQuat() {\r\n    this[0] = 1.0;\r\n    this[1] = this[2] = this[3] = 0.0;\r\n  }\r\n\r\n  isZero() {\r\n    return (this[0] === 0 && this[1] === 0 && this[2] === 0 && this[3] === 0);\r\n  }\r\n\r\n  mulQuat(qt) {\r\n    let a = this[0]*qt[0] - this[1]*qt[1] - this[2]*qt[2] - this[3]*qt[3];\r\n    let b = this[0]*qt[1] + this[1]*qt[0] + this[2]*qt[3] - this[3]*qt[2];\r\n    let c = this[0]*qt[2] + this[2]*qt[0] + this[3]*qt[1] - this[1]*qt[3];\r\n    this[3] = this[0]*qt[3] + this[3]*qt[0] + this[1]*qt[2] - this[2]*qt[1];\r\n    this[0] = a;\r\n    this[1] = b;\r\n    this[2] = c;\r\n  }\r\n\r\n  conjugate() {\r\n    this[1] = -this[1];\r\n    this[2] = -this[2];\r\n    this[3] = -this[3];\r\n  }\r\n\r\n  dotWithQuat(q2) {\r\n    return this[0]*q2[0] + this[1]*q2[1] + this[2]*q2[2] + this[3]*q2[3];\r\n  }\r\n\r\n  invert() {\r\n    let f = this.dot(this);\r\n\r\n    if (f === 0.0)\r\n      return;\r\n\r\n    conjugate_qt(q);\r\n    this.mulscalar(1.0/f);\r\n  }\r\n\r\n  sub(q2) {\r\n    let nq2 = new Quat();\r\n\r\n    nq2[0] = -q2[0];\r\n    nq2[1] = q2[1];\r\n    nq2[2] = q2[2];\r\n    nq2[3] = q2[3];\r\n\r\n    this.mul(nq2);\r\n  }\r\n\r\n  mulScalarWithFactor(fac) {\r\n    let angle = fac*bounded_acos(this[0]);\r\n    let co = Math.cos(angle);\r\n    let si = Math.sin(angle);\r\n\r\n    this[0] = co;\r\n\r\n    let last3 = Vector3([this[1], this[2], this[3]]);\r\n    last3.normalize();\r\n    last3.mulScalar(si);\r\n    this[1] = last3[0];\r\n    this[2] = last3[1];\r\n    this[3] = last3[2];\r\n    return this;\r\n  }\r\n\r\n  toMatrix(m) {\r\n    if (m === undefined) {\r\n      m = new Matrix4();\r\n    }\r\n\r\n    let q0 = M_SQRT2*this[0];\r\n    let q1 = M_SQRT2*this[1];\r\n    let q2 = M_SQRT2*this[2];\r\n    let q3 = M_SQRT2*this[3];\r\n    let qda = q0*q1;\r\n    let qdb = q0*q2;\r\n    let qdc = q0*q3;\r\n    let qaa = q1*q1;\r\n    let qab = q1*q2;\r\n    let qac = q1*q3;\r\n    let qbb = q2*q2;\r\n    let qbc = q2*q3;\r\n    let qcc = q3*q3;\r\n    m.$matrix.m11 = (1.0 - qbb - qcc);\r\n    m.$matrix.m12 = (qdc + qab);\r\n    m.$matrix.m13 = (-qdb + qac);\r\n    m.$matrix.m14 = 0.0;\r\n    m.$matrix.m21 = (-qdc + qab);\r\n    m.$matrix.m22 = (1.0 - qaa - qcc);\r\n    m.$matrix.m23 = (qda + qbc);\r\n    m.$matrix.m24 = 0.0;\r\n    m.$matrix.m31 = (qdb + qac);\r\n    m.$matrix.m32 = (-qda + qbc);\r\n    m.$matrix.m33 = (1.0 - qaa - qbb);\r\n    m.$matrix.m34 = 0.0;\r\n    m.$matrix.m41 = m.$matrix.m42 = m.$matrix.m43 = 0.0;\r\n    m.$matrix.m44 = 1.0;\r\n\r\n    return m;\r\n  }\r\n\r\n  matrixToQuat(wmat) {\r\n    let mat = temp_mats.next();\r\n    mat.load(wmat);\r\n\r\n    mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n    mat.$matrix.m44 = 1.0;\r\n\r\n    let r1 = new Vector3([mat.$matrix.m11, mat.$matrix.m12, mat.$matrix.m13]);\r\n    let r2 = new Vector3([mat.$matrix.m21, mat.$matrix.m22, mat.$matrix.m23]);\r\n    let r3 = new Vector3([mat.$matrix.m31, mat.$matrix.m32, mat.$matrix.m33]);\r\n\r\n    r1.normalize();\r\n    r2.normalize();\r\n    r3.normalize();\r\n\r\n    mat.$matrix.m11 = r1[0];\r\n    mat.$matrix.m12 = r1[1];\r\n    mat.$matrix.m13 = r1[2];\r\n    mat.$matrix.m21 = r2[0];\r\n    mat.$matrix.m22 = r2[1];\r\n    mat.$matrix.m23 = r2[2];\r\n    mat.$matrix.m31 = r3[0];\r\n    mat.$matrix.m32 = r3[1];\r\n    mat.$matrix.m33 = r3[2];\r\n    let tr = 0.25*(1.0 + mat.$matrix.m11 + mat.$matrix.m22 + mat.$matrix.m33);\r\n    let s = 0;\r\n    if (tr > FLT_EPSILON) {\r\n      s = Math.sqrt(tr);\r\n      this[0] = s;\r\n      s = 1.0/(4.0*s);\r\n      this[1] = ((mat.$matrix.m23 - mat.$matrix.m32)*s);\r\n      this[2] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n      this[3] = ((mat.$matrix.m12 - mat.$matrix.m21)*s);\r\n    } else {\r\n      if (mat.$matrix.m11 > mat.$matrix.m22 && mat.$matrix.m11 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m11 - mat.$matrix.m22 - mat.$matrix.m33);\r\n        this[1] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m32 - mat.$matrix.m23)*s);\r\n        this[2] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n      } else if (mat.$matrix.m22 > mat.$matrix.m33) {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m22 - mat.$matrix.m11 - mat.$matrix.m33);\r\n        this[2] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m31 - mat.$matrix.m13)*s);\r\n        this[1] = ((mat.$matrix.m21 + mat.$matrix.m12)*s);\r\n        this[3] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      } else {\r\n        s = 2.0*Math.sqrt(1.0 + mat.$matrix.m33 - mat.$matrix.m11 - mat.$matrix.m22);\r\n        this[3] = (0.25*s);\r\n        s = 1.0/s;\r\n        this[0] = ((mat.$matrix.m21 - mat.$matrix.m12)*s);\r\n        this[1] = ((mat.$matrix.m31 + mat.$matrix.m13)*s);\r\n        this[2] = ((mat.$matrix.m32 + mat.$matrix.m23)*s);\r\n      }\r\n    }\r\n    this.normalize();\r\n  }\r\n\r\n  normalize() {\r\n    let len = Math.sqrt(this.dot(this));\r\n\r\n    if (len !== 0.0) {\r\n      this.mulScalar(1.0/len);\r\n    } else {\r\n      this[1] = 1.0;\r\n      this[0] = this[2] = this[3] = 0.0;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  axisAngleToQuat(axis, angle) {\r\n    let nor = _quat_vs3_temps.next().load(axis);\r\n    nor.normalize();\r\n\r\n    if (nor.dot(nor) !== 0.0) {\r\n      let phi = angle/2.0;\r\n      let si = Math.sin(phi);\r\n      this[0] = Math.cos(phi);\r\n      this[1] = nor[0]*si;\r\n      this[2] = nor[1]*si;\r\n      this[3] = nor[2]*si;\r\n    } else {\r\n      this.makeUnitQuat();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  rotationBetweenVecs(v1, v2, fac = 1.0) {\r\n    v1 = new Vector3(v1);\r\n    v2 = new Vector3(v2);\r\n    v1.normalize();\r\n    v2.normalize();\r\n\r\n    if (Math.abs(v1.dot(v2)) > 0.9999) {\r\n      this.makeUnitQuat();\r\n      return this;\r\n    }\r\n\r\n    let axis = new Vector3(v1);\r\n    axis.cross(v2);\r\n\r\n    let angle = v1.preNormalizedAngle(v2)*fac;\r\n\r\n    this.axisAngleToQuat(axis, angle);\r\n\r\n    return this;\r\n  }\r\n\r\n  quatInterp(quat2, t) {\r\n    let quat = new Quat();\r\n    let cosom = this[0]*quat2[0] + this[1]*quat2[1] + this[2]*quat2[2] + this[3]*quat2[3];\r\n    if (cosom < 0.0) {\r\n      cosom = -cosom;\r\n      quat[0] = -this[0];\r\n      quat[1] = -this[1];\r\n      quat[2] = -this[2];\r\n      quat[3] = -this[3];\r\n    } else {\r\n      quat[0] = this[0];\r\n      quat[1] = this[1];\r\n      quat[2] = this[2];\r\n      quat[3] = this[3];\r\n    }\r\n\r\n    let omega, sinom, sc1, sc2;\r\n    if ((1.0 - cosom) > 0.0001) {\r\n      omega = Math.acos(cosom);\r\n      sinom = Math.sin(omega);\r\n      sc1 = Math.sin((1.0 - t)*omega)/sinom;\r\n      sc2 = Math.sin(t*omega)/sinom;\r\n    } else {\r\n      sc1 = 1.0 - t;\r\n      sc2 = t;\r\n    }\r\n    this[0] = sc1*quat[0] + sc2*quat2[0];\r\n    this[1] = sc1*quat[1] + sc2*quat2[1];\r\n    this[2] = sc1*quat[2] + sc2*quat2[2];\r\n    this[3] = sc1*quat[3] + sc2*quat2[3];\r\n\r\n    return this;\r\n  }\r\n};\r\n\r\nQuat.STRUCT = nstructjs.inherit(Quat, Vector4, 'quat') + `\r\n}\r\n`;\r\nnstructjs.register(Quat);\r\n\r\n_v3nd4_n1_normalizedDot4 = new Vector3();\r\n_v3nd4_n2_normalizedDot4 = new Vector3();\r\n_v3nd_n1_normalizedDot = new Vector3();\r\n_v3nd_n2_normalizedDot = new Vector3();\r\n\r\nBaseVector.inherit(Vector4, 4);\r\nF64BaseVector.inherit(Vector3, 3);\r\nBaseVector.inherit(Vector2, 2);\r\n\r\nlet lookat_cache_vs3;\r\nlet lookat_cache_vs4;\r\nlet lookat_cache_ms;\r\nlet euler_rotate_mats;\r\nlet makenormalcache;\r\nlet temp_mats;\r\n\r\nlet preMultTemp;\r\n\r\nlookat_cache_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlookat_cache_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\n\r\nmakenormalcache = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nlet $_v3nd_n1_normalizedDot = new Vector3();\r\nlet $_v3nd_n2_normalizedDot = new Vector3();\r\nlet $_v3nd4_n1_normalizedDot4 = new Vector3();\r\nlet $_v3nd4_n2_normalizedDot4 = new Vector3();\r\nlet $_v3nd4_n1_normalizedDot3 = new Vector3();\r\nlet $_v3nd4_n2_normalizedDot3 = new Vector3();\r\n\r\nclass internal_matrix {\r\n  constructor() {\r\n    this.m11 = 1.0;\r\n    this.m12 = 0.0;\r\n    this.m13 = 0.0;\r\n    this.m14 = 0.0;\r\n    this.m21 = 0.0;\r\n    this.m22 = 1.0;\r\n    this.m23 = 0.0;\r\n    this.m24 = 0.0;\r\n    this.m31 = 0.0;\r\n    this.m32 = 0.0;\r\n    this.m33 = 1.0;\r\n    this.m34 = 0.0;\r\n    this.m41 = 0.0;\r\n    this.m42 = 0.0;\r\n    this.m43 = 0.0;\r\n    this.m44 = 1.0;\r\n  }\r\n}\r\n\r\n/** Incredibly old matrix class. */\r\nexport class Matrix4 {\r\n  constructor(m) {\r\n    this.$matrix = new internal_matrix();\r\n    this.isPersp = false;\r\n\r\n    if (typeof m === 'object') {\r\n      if (\"length\" in m && m.length >= 16) {\r\n        this.load(m);\r\n      } else if (m instanceof Matrix4) {\r\n        this.load(m);\r\n      }\r\n    }\r\n  }\r\n\r\n  static fromJSON() {\r\n    let mat = new Matrix4();\r\n    mat.load(json.items);\r\n    mat.isPersp = json.isPersp;\r\n    return mat;\r\n  }\r\n\r\n  copy() {\r\n    return this.clone();\r\n  }\r\n\r\n  clone() {\r\n    return new Matrix4(this);\r\n  }\r\n\r\n  addToHashDigest(hash) {\r\n    let m = this.$matrix;\r\n\r\n    hash.add(m.m11);\r\n    hash.add(m.m12);\r\n    hash.add(m.m13);\r\n    hash.add(m.m14);\r\n\r\n    hash.add(m.m21);\r\n    hash.add(m.m22);\r\n    hash.add(m.m23);\r\n    hash.add(m.m24);\r\n\r\n    hash.add(m.m31);\r\n    hash.add(m.m32);\r\n    hash.add(m.m33);\r\n    hash.add(m.m34);\r\n\r\n    hash.add(m.m41);\r\n    hash.add(m.m42);\r\n    hash.add(m.m43);\r\n    hash.add(m.m44);\r\n\r\n    return this;\r\n  }\r\n\r\n  equals(m) {\r\n    let m1 = this.$matrix;\r\n    let m2 = m.$matrix;\r\n\r\n    let ok = 1;\r\n\r\n    ok = ok && m1.m11 === m2.m11;\r\n    ok = ok && m1.m12 === m2.m12;\r\n    ok = ok && m1.m13 === m2.m13;\r\n    ok = ok && m1.m14 === m2.m14;\r\n\r\n    ok = ok && m1.m21 === m2.m21;\r\n    ok = ok && m1.m22 === m2.m22;\r\n    ok = ok && m1.m23 === m2.m23;\r\n    ok = ok && m1.m24 === m2.m24;\r\n\r\n    ok = ok && m1.m31 === m2.m31;\r\n    ok = ok && m1.m32 === m2.m32;\r\n    ok = ok && m1.m33 === m2.m33;\r\n    ok = ok && m1.m34 === m2.m34;\r\n\r\n    ok = ok && m1.m41 === m2.m41;\r\n    ok = ok && m1.m42 === m2.m42;\r\n    ok = ok && m1.m43 === m2.m43;\r\n    ok = ok && m1.m44 === m2.m44;\r\n\r\n    return ok;\r\n  }\r\n\r\n  loadColumn(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        m.m11 = vec[0];\r\n        m.m21 = vec[1];\r\n        m.m31 = vec[2];\r\n        if (have4) {\r\n          m.m41 = vec[3];\r\n        }\r\n        break;\r\n      case 1:\r\n        m.m12 = vec[0];\r\n        m.m22 = vec[1];\r\n        m.m32 = vec[2];\r\n        if (have4) {\r\n          m.m42 = vec[3];\r\n        }\r\n        break;\r\n      case 2:\r\n        m.m13 = vec[0];\r\n        m.m23 = vec[1];\r\n        m.m33 = vec[2];\r\n        if (have4) {\r\n          m.m43 = vec[3];\r\n        }\r\n        break;\r\n      case 3:\r\n        m.m14 = vec[0];\r\n        m.m24 = vec[1];\r\n        m.m34 = vec[2];\r\n        if (have4) {\r\n          m.m44 = vec[3];\r\n        }\r\n        break;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyColumnTo(i, vec) {\r\n    let m = this.$matrix;\r\n    let have4 = vec.length > 3;\r\n\r\n    switch (i) {\r\n      case 0:\r\n        vec[0] = m.m11;\r\n        vec[1] = m.m21;\r\n        vec[2] = m.m31;\r\n        if (have4) {\r\n          vec[3] = m.m41;\r\n        }\r\n        break;\r\n      case 1:\r\n        vec[0] = m.m12;\r\n        vec[1] = m.m22;\r\n        vec[2] = m.m32;\r\n        if (have4) {\r\n          vec[3] = m.m42;\r\n        }\r\n        break;\r\n      case 2:\r\n        vec[0] = m.m13;\r\n        vec[1] = m.m23;\r\n        vec[2] = m.m33;\r\n        if (have4) {\r\n          vec[3] = m.m43;\r\n        }\r\n        break;\r\n      case 3:\r\n        vec[0] = m.m14;\r\n        vec[1] = m.m24;\r\n        vec[2] = m.m34;\r\n        if (have4) {\r\n          vec[3] = m.m44;\r\n        }\r\n        break;\r\n    }\r\n\r\n    return vec;\r\n  }\r\n\r\n  copyColumn(i) {\r\n    return this.copyColumnTo(i, new Vector3());\r\n  }\r\n\r\n  load() {\r\n    if (arguments.length === 1 && typeof arguments[0] === 'object') {\r\n      let matrix;\r\n      if (arguments[0] instanceof Matrix4) {\r\n        matrix = arguments[0].$matrix;\r\n        this.isPersp = arguments[0].isPersp;\r\n        this.$matrix.m11 = matrix.m11;\r\n        this.$matrix.m12 = matrix.m12;\r\n        this.$matrix.m13 = matrix.m13;\r\n        this.$matrix.m14 = matrix.m14;\r\n        this.$matrix.m21 = matrix.m21;\r\n        this.$matrix.m22 = matrix.m22;\r\n        this.$matrix.m23 = matrix.m23;\r\n        this.$matrix.m24 = matrix.m24;\r\n        this.$matrix.m31 = matrix.m31;\r\n        this.$matrix.m32 = matrix.m32;\r\n        this.$matrix.m33 = matrix.m33;\r\n        this.$matrix.m34 = matrix.m34;\r\n        this.$matrix.m41 = matrix.m41;\r\n        this.$matrix.m42 = matrix.m42;\r\n        this.$matrix.m43 = matrix.m43;\r\n        this.$matrix.m44 = matrix.m44;\r\n        return this;\r\n      } else\r\n        matrix = arguments[0];\r\n      if (\"length\" in matrix && matrix.length >= 16) {\r\n        this.$matrix.m11 = matrix[0];\r\n        this.$matrix.m12 = matrix[1];\r\n        this.$matrix.m13 = matrix[2];\r\n        this.$matrix.m14 = matrix[3];\r\n        this.$matrix.m21 = matrix[4];\r\n        this.$matrix.m22 = matrix[5];\r\n        this.$matrix.m23 = matrix[6];\r\n        this.$matrix.m24 = matrix[7];\r\n        this.$matrix.m31 = matrix[8];\r\n        this.$matrix.m32 = matrix[9];\r\n        this.$matrix.m33 = matrix[10];\r\n        this.$matrix.m34 = matrix[11];\r\n        this.$matrix.m41 = matrix[12];\r\n        this.$matrix.m42 = matrix[13];\r\n        this.$matrix.m43 = matrix[14];\r\n        this.$matrix.m44 = matrix[15];\r\n        return this;\r\n      }\r\n    }\r\n\r\n    this.makeIdentity();\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {isPersp: this.isPersp, items: this.getAsArray()}\r\n  }\r\n\r\n  getAsArray() {\r\n    return [this.$matrix.m11, this.$matrix.m12, this.$matrix.m13, this.$matrix.m14, this.$matrix.m21, this.$matrix.m22,\r\n            this.$matrix.m23, this.$matrix.m24, this.$matrix.m31, this.$matrix.m32, this.$matrix.m33, this.$matrix.m34,\r\n            this.$matrix.m41, this.$matrix.m42, this.$matrix.m43, this.$matrix.m44];\r\n  }\r\n\r\n  getAsFloat32Array() {\r\n    return new Float32Array(this.getAsArray());\r\n  }\r\n\r\n  setUniform(ctx, loc, transpose) {\r\n    if (Matrix4.setUniformArray === undefined) {\r\n      Matrix4.setUniformWebGLArray = new Float32Array(16);\r\n      Matrix4.setUniformArray = new Array(16);\r\n    }\r\n\r\n    Matrix4.setUniformArray[0] = this.$matrix.m11;\r\n    Matrix4.setUniformArray[1] = this.$matrix.m12;\r\n    Matrix4.setUniformArray[2] = this.$matrix.m13;\r\n    Matrix4.setUniformArray[3] = this.$matrix.m14;\r\n    Matrix4.setUniformArray[4] = this.$matrix.m21;\r\n    Matrix4.setUniformArray[5] = this.$matrix.m22;\r\n    Matrix4.setUniformArray[6] = this.$matrix.m23;\r\n    Matrix4.setUniformArray[7] = this.$matrix.m24;\r\n    Matrix4.setUniformArray[8] = this.$matrix.m31;\r\n    Matrix4.setUniformArray[9] = this.$matrix.m32;\r\n    Matrix4.setUniformArray[10] = this.$matrix.m33;\r\n    Matrix4.setUniformArray[11] = this.$matrix.m34;\r\n    Matrix4.setUniformArray[12] = this.$matrix.m41;\r\n    Matrix4.setUniformArray[13] = this.$matrix.m42;\r\n    Matrix4.setUniformArray[14] = this.$matrix.m43;\r\n    Matrix4.setUniformArray[15] = this.$matrix.m44;\r\n\r\n    Matrix4.setUniformWebGLArray.set(Matrix4.setUniformArray);\r\n\r\n    ctx.uniformMatrix4fv(loc, transpose, Matrix4.setUniformWebGLArray);\r\n\r\n    return this;\r\n  }\r\n\r\n  makeIdentity() {\r\n    this.$matrix.m11 = 1;\r\n    this.$matrix.m12 = 0;\r\n    this.$matrix.m13 = 0;\r\n    this.$matrix.m14 = 0;\r\n    this.$matrix.m21 = 0;\r\n    this.$matrix.m22 = 1;\r\n    this.$matrix.m23 = 0;\r\n    this.$matrix.m24 = 0;\r\n    this.$matrix.m31 = 0;\r\n    this.$matrix.m32 = 0;\r\n    this.$matrix.m33 = 1;\r\n    this.$matrix.m34 = 0;\r\n    this.$matrix.m41 = 0;\r\n    this.$matrix.m42 = 0;\r\n    this.$matrix.m43 = 0;\r\n    this.$matrix.m44 = 1;\r\n\r\n    //drop isPersp\r\n    this.isPersp = false;\r\n\r\n    return this;\r\n  }\r\n\r\n  transpose() {\r\n    let tmp = this.$matrix.m12;\r\n    this.$matrix.m12 = this.$matrix.m21;\r\n    this.$matrix.m21 = tmp;\r\n    tmp = this.$matrix.m13;\r\n    this.$matrix.m13 = this.$matrix.m31;\r\n    this.$matrix.m31 = tmp;\r\n    tmp = this.$matrix.m14;\r\n    this.$matrix.m14 = this.$matrix.m41;\r\n    this.$matrix.m41 = tmp;\r\n    tmp = this.$matrix.m23;\r\n    this.$matrix.m23 = this.$matrix.m32;\r\n    this.$matrix.m32 = tmp;\r\n    tmp = this.$matrix.m24;\r\n    this.$matrix.m24 = this.$matrix.m42;\r\n    this.$matrix.m42 = tmp;\r\n    tmp = this.$matrix.m34;\r\n    this.$matrix.m34 = this.$matrix.m43;\r\n    this.$matrix.m43 = tmp;\r\n\r\n    return this;\r\n  }\r\n\r\n  determinant() {\r\n    return this._determinant4x4();\r\n  }\r\n\r\n  invert() {\r\n    let det = this._determinant4x4();\r\n\r\n    if (Math.abs(det) < 1e-08)\r\n      return null;\r\n\r\n    this._makeAdjoint();\r\n\r\n    this.$matrix.m11 /= det;\r\n    this.$matrix.m12 /= det;\r\n    this.$matrix.m13 /= det;\r\n    this.$matrix.m14 /= det;\r\n    this.$matrix.m21 /= det;\r\n    this.$matrix.m22 /= det;\r\n    this.$matrix.m23 /= det;\r\n    this.$matrix.m24 /= det;\r\n    this.$matrix.m31 /= det;\r\n    this.$matrix.m32 /= det;\r\n    this.$matrix.m33 /= det;\r\n    this.$matrix.m34 /= det;\r\n    this.$matrix.m41 /= det;\r\n    this.$matrix.m42 /= det;\r\n    this.$matrix.m43 /= det;\r\n    this.$matrix.m44 /= det;\r\n\r\n    return this;\r\n  }\r\n\r\n  translate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.multiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  preTranslate(x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    }\r\n\r\n    x = x === undefined ? 0 : x;\r\n    y = y === undefined ? 0 : y;\r\n    z = z === undefined ? 0 : z;\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m41 = x;\r\n    matrix.$matrix.m42 = y;\r\n    matrix.$matrix.m43 = z;\r\n\r\n    this.preMultiply(matrix);\r\n    return this;\r\n  }\r\n\r\n  scale(x, y, z, w = 1.0) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (x === undefined)\r\n        x = 1;\r\n\r\n      if (z === undefined) {\r\n        if (y === undefined) {\r\n          y = x;\r\n          z = x;\r\n        } else {\r\n          z = x;\r\n        }\r\n      } else if (y === undefined) {\r\n        y = x;\r\n      }\r\n    }\r\n\r\n\r\n    let matrix = temp_mats.next().makeIdentity();\r\n    matrix.$matrix.m11 = x;\r\n    matrix.$matrix.m22 = y;\r\n    matrix.$matrix.m33 = z;\r\n    matrix.$matrix.m44 = w;\r\n    this.multiply(matrix);\r\n    return this\r\n  }\r\n\r\n  preScale(x, y, z, w = 1.0) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n    mat.scale(x, y, z, w);\r\n\r\n    this.preMultiply(mat);\r\n    return this\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n\r\n  c1 := cx; comment: cos(thx);\r\n  s1 := sx; comment: sin(thx);\r\n\r\n  c2 := cy; comment: cos(thy);\r\n  s2 := sy; comment: sin(thy);\r\n\r\n  c3 := cz; comment: cos(thz);\r\n  s3 := sz; comment: sin(thz);\r\n\r\n  cx := cos(thx);\r\n  sx := sin(thx);\r\n  cy := cos(thy);\r\n  sy := sin(thy);\r\n  cz := cos(thz);\r\n  sz := sin(thz);\r\n\r\n  imat := mat((1, 0, 0, 0),\r\n              (0, 1, 0, 0),\r\n              (0, 0, 1, 0),\r\n              (0, 0, 0, 1));\r\n\r\n  xmat :=mat((1,  0,  0,  0),\r\n             (0, c1, -s1, 0),\r\n             (0, s1,  c1, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  ymat :=mat((c2, 0, s2, 0),\r\n             (0,  1,  0,  0),\r\n             (-s2, 0,  c2, 0),\r\n             (0,  0,  0,  0));\r\n\r\n  zmat :=mat(( c3, -s3, 0, 0),\r\n             (s3, c3, 0, 0),\r\n             ( 0,  0,  1, 0),\r\n             ( 0,  0,  0, 0));\r\n\r\n  mmat := mat((m11, m21, m31, 0),\r\n              (m12, m22, m32, 0),\r\n              (m13, m23, m33, 0),\r\n              (0,   0,   0,   0));\r\n\r\n  fmat := zmat * ymat * xmat;\r\n\r\n  f1 := m11**2 + m12**2 + m13**2 - 1.0;\r\n  f2 := m21**2 + m22**2 + m23**2 - 1.0;\r\n  f3 := m31**2 + m32**2 + m33**2 - 1.0;\r\n\r\n  tmat := fmat * mmat;\r\n  f1 := tmat(1, 1) - 1.0;\r\n  f2 := tmat(2, 2) - 1.0;\r\n  f3 := tmat(3, 3) - 1.0;\r\n\r\n  operator myasin;\r\n\r\n  fthy := asin(mmat(3, 1));\r\n  f1 := mmat(3,1)**2 + mmat(2,1)**2 + mmat(1,1)**2 = 1.0;\r\n\r\n  fmat2 := sub(thy=fthy, fmat);\r\n\r\n  fmat3 := fmat2 * (tp mmat);\r\n  ffz := solve(fmat2(1, 1) - m11, thz);\r\n  ffx := solve(fmat2(3, 3) - m33, thx);\r\n\r\n  fthz := part(ffz, 1, 2);\r\n  fthx := part(ffx, 1, 2);\r\n\r\n  sub(thx=fthx, thy=fthy, thz=fthz, fmat);\r\n\r\n(cos(thy)*cos(thz),         cos(thx)*sin(thz)-cos(thz)*sin(thx)*sin(thy),  -(cos(thx)*cos(thz)*sin(thy)+sin(thx)*sin(thz)), 0),\r\n\r\n(-cos(thy)*sin(thz),        cos(thx)*cos(thz) + sin(thx)*sin(thy)*sin(thz),  cos(thx)*sin(thy)*sin(thz)-cos(thz)*sin(thx), 0),\r\n\r\n(sin(thy),                  cos(thy)*sin(thx),                               cos(thx)*cos(thy),  0),\r\n\r\n    (0,0,0,1))\r\n\r\n  */\r\n\r\n  euler_rotate_order(x, y, z, order = EulerOrders.XYZ) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n\r\n    x = -x;\r\n    y = -y;\r\n    z = -z;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    let a, b;\r\n\r\n    switch (order) {\r\n      case EulerOrders.XYZ:\r\n        a = xmat;\r\n        b = ymat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.XZY:\r\n        a = xmat;\r\n        b = zmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.YXZ:\r\n        a = ymat;\r\n        b = xmat;\r\n        c = zmat;\r\n        break;\r\n      case EulerOrders.YZX:\r\n        a = ymat;\r\n        b = zmat;\r\n        c = xmat;\r\n        break;\r\n      case EulerOrders.ZXY:\r\n        a = zmat;\r\n        b = xmat;\r\n        c = ymat;\r\n        break;\r\n      case EulerOrders.ZYX:\r\n        a = zmat;\r\n        b = ymat;\r\n        c = xmat;\r\n        break;\r\n    }\r\n\r\n    b.preMultiply(c);\r\n    b.multiply(a);\r\n\r\n    this.preMultiply(b);\r\n\r\n    return this;\r\n  }\r\n\r\n  euler_rotate(x, y, z) {\r\n    if (y === undefined) {\r\n      y = 0.0;\r\n    }\r\n    if (z === undefined) {\r\n      z = 0.0;\r\n    }\r\n    window.Matrix4 = Matrix4;\r\n\r\n    let xmat = euler_rotate_mats.next().makeIdentity();\r\n    let m = xmat.$matrix;\r\n\r\n    let c = Math.cos(x), s = Math.sin(x);\r\n\r\n    m.m22 = c;\r\n    m.m23 = s;\r\n    m.m32 = -s;\r\n    m.m33 = c;\r\n\r\n    let ymat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(y);\r\n    s = Math.sin(y);\r\n    m = ymat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m13 = -s;\r\n    m.m31 = s;\r\n    m.m33 = c;\r\n\r\n    ymat.multiply(xmat);\r\n\r\n    let zmat = euler_rotate_mats.next().makeIdentity();\r\n    c = Math.cos(z);\r\n    s = Math.sin(z);\r\n    m = zmat.$matrix;\r\n\r\n    m.m11 = c;\r\n    m.m12 = s;\r\n    m.m21 = -s;\r\n    m.m22 = c;\r\n\r\n    zmat.multiply(ymat);\r\n\r\n    //console.log(\"\"+ymat);\r\n    //this.multiply(zmat);\r\n    this.preMultiply(zmat);\r\n\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    let s = \"\"\r\n    let m = this.$matrix;\r\n\r\n    function dec(d) {\r\n      let ret = d.toFixed(3);\r\n\r\n      if (ret[0] !== \"-\") //make room for negative signs\r\n        ret = \" \" + ret\r\n      return ret\r\n    }\r\n\r\n    s = dec(m.m11) + \", \" + dec(m.m12) + \", \" + dec(m.m13) + \", \" + dec(m.m14) + \"\\n\";\r\n    s += dec(m.m21) + \", \" + dec(m.m22) + \", \" + dec(m.m23) + \", \" + dec(m.m24) + \"\\n\";\r\n    s += dec(m.m31) + \", \" + dec(m.m32) + \", \" + dec(m.m33) + \", \" + dec(m.m34) + \"\\n\";\r\n    s += dec(m.m41) + \", \" + dec(m.m42) + \", \" + dec(m.m43) + \", \" + dec(m.m44) + \"\\n\";\r\n\r\n    return s\r\n  }\r\n\r\n  rotate(angle, x, y, z) {\r\n    if (typeof x === 'object' && \"length\" in x) {\r\n      let t = x;\r\n      x = t[0];\r\n      y = t[1];\r\n      z = t[2];\r\n    } else {\r\n      if (arguments.length === 1) {\r\n        x = y = 0;\r\n        z = 1;\r\n      } else if (arguments.length === 3) {\r\n        this.rotate(angle, 1, 0, 0);\r\n        this.rotate(x, 0, 1, 0);\r\n        this.rotate(y, 0, 0, 1);\r\n        return;\r\n      }\r\n    }\r\n\r\n    angle /= 2;\r\n    let sinA = Math.sin(angle);\r\n    let cosA = Math.cos(angle);\r\n    let sinA2 = sinA*sinA;\r\n    let len = Math.sqrt(x*x + y*y + z*z);\r\n\r\n    if (len === 0) {\r\n      x = 0;\r\n      y = 0;\r\n      z = 1;\r\n    } else if (len !== 1) {\r\n      x /= len;\r\n      y /= len;\r\n      z /= len;\r\n    }\r\n\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    if (x === 1 && y === 0 && z === 0) {\r\n      mat.$matrix.m11 = 1;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 2*sinA*cosA;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = -2*sinA*cosA;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 1 && z === 0) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 0;\r\n      mat.$matrix.m13 = -2*sinA*cosA;\r\n      mat.$matrix.m21 = 0;\r\n      mat.$matrix.m22 = 1;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 2*sinA*cosA;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1 - 2*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else if (x === 0 && y === 0 && z === 1) {\r\n      mat.$matrix.m11 = 1 - 2*sinA2;\r\n      mat.$matrix.m12 = 2*sinA*cosA;\r\n      mat.$matrix.m13 = 0;\r\n      mat.$matrix.m21 = -2*sinA*cosA;\r\n      mat.$matrix.m22 = 1 - 2*sinA2;\r\n      mat.$matrix.m23 = 0;\r\n      mat.$matrix.m31 = 0;\r\n      mat.$matrix.m32 = 0;\r\n      mat.$matrix.m33 = 1;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    } else {\r\n      let x2 = x*x;\r\n      let y2 = y*y;\r\n      let z2 = z*z;\r\n      mat.$matrix.m11 = 1 - 2*(y2 + z2)*sinA2;\r\n      mat.$matrix.m12 = 2*(x*y*sinA2 + z*sinA*cosA);\r\n      mat.$matrix.m13 = 2*(x*z*sinA2 - y*sinA*cosA);\r\n      mat.$matrix.m21 = 2*(y*x*sinA2 - z*sinA*cosA);\r\n      mat.$matrix.m22 = 1 - 2*(z2 + x2)*sinA2;\r\n      mat.$matrix.m23 = 2*(y*z*sinA2 + x*sinA*cosA);\r\n      mat.$matrix.m31 = 2*(z*x*sinA2 + y*sinA*cosA);\r\n      mat.$matrix.m32 = 2*(z*y*sinA2 - x*sinA*cosA);\r\n      mat.$matrix.m33 = 1 - 2*(x2 + y2)*sinA2;\r\n      mat.$matrix.m14 = mat.$matrix.m24 = mat.$matrix.m34 = 0;\r\n      mat.$matrix.m41 = mat.$matrix.m42 = mat.$matrix.m43 = 0;\r\n      mat.$matrix.m44 = 1;\r\n    }\r\n    this.multiply(mat);\r\n\r\n    return this;\r\n  }\r\n\r\n  normalize() {\r\n    let m = this.$matrix;\r\n\r\n    let v1 = new Vector4([m.m11, m.m12, m.m13, m.m14]);\r\n    let v2 = new Vector4([m.m21, m.m22, m.m23, m.m24]);\r\n    let v3 = new Vector4([m.m31, m.m32, m.m33, m.m34]);\r\n    let v4 = new Vector4([m.m41, m.m42, m.m43, m.m44]);\r\n\r\n    v1.normalize();\r\n    v2.normalize();\r\n    v3.normalize();\r\n\r\n    let flat = new Array().concat(v1).concat(v2).concat(v3).concat(v4);\r\n    this.load(flat);\r\n\r\n    return this;\r\n  }\r\n\r\n  clearTranslation(set_w_to_one = false) {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n\r\n    if (set_w_to_one) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setTranslation(x, y, z, resetW = true) {\r\n    if (typeof x === \"object\") {\r\n      y = x[1];\r\n      z = x[2];\r\n      x = x[0];\r\n    }\r\n\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = x;\r\n    m.m42 = y;\r\n    m.m43 = z;\r\n\r\n    if (resetW) {\r\n      m.m44 = 1.0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  //this is really like the lookAt method, isn't it.\r\n  makeNormalMatrix(normal, up = undefined) {\r\n    if (normal === undefined) {\r\n      throw new Error(\"normal cannot be undefined\");\r\n    }\r\n\r\n    let n = makenormalcache.next().load(normal).normalize();\r\n\r\n    if (up === undefined) {\r\n      up = makenormalcache.next().zero();\r\n\r\n      if (Math.abs(n[2]) > 0.95) {\r\n        up[1] = 1.0;\r\n      } else {\r\n        up[2] = 1.0;\r\n      }\r\n    }\r\n\r\n    up = makenormalcache.next().load(up);\r\n\r\n    up.normalize();\r\n\r\n    if (up.dot(normal) > 0.99) {\r\n      this.makeIdentity();\r\n      return this;\r\n    } else if (up.dot(normal) < -0.99) {\r\n      this.makeIdentity();\r\n      this.scale(1.0, 1.0, -1.0);\r\n      return this;\r\n    }\r\n\r\n    let x = makenormalcache.next();\r\n    let y = makenormalcache.next();\r\n\r\n    x.load(n).cross(up).normalize();\r\n    y.load(x).cross(n).normalize();\r\n    //y.negate();\r\n\r\n    this.makeIdentity();\r\n    let m = this.$matrix;\r\n\r\n    m.m11 = x[0];\r\n    m.m12 = x[1];\r\n    m.m13 = x[2];\r\n\r\n    m.m21 = y[0];\r\n    m.m22 = y[1];\r\n    m.m23 = y[2];\r\n\r\n    m.m31 = n[0];\r\n    m.m32 = n[1];\r\n    m.m33 = n[2];\r\n    m.m44 = 1.0;\r\n\r\n    return this;\r\n  }\r\n\r\n  preMultiply(mat) {\r\n    preMultTemp.load(mat);\r\n    preMultTemp.multiply(this);\r\n\r\n    this.load(preMultTemp);\r\n\r\n    return this;\r\n  }\r\n\r\n  multiply(mat) {\r\n    let mm = this.$matrix;\r\n    let mm2 = mat.$matrix;\r\n\r\n    let m11 = (mm2.m11*mm.m11 + mm2.m12*mm.m21 + mm2.m13*mm.m31 + mm2.m14*mm.m41);\r\n    let m12 = (mm2.m11*mm.m12 + mm2.m12*mm.m22 + mm2.m13*mm.m32 + mm2.m14*mm.m42);\r\n    let m13 = (mm2.m11*mm.m13 + mm2.m12*mm.m23 + mm2.m13*mm.m33 + mm2.m14*mm.m43);\r\n    let m14 = (mm2.m11*mm.m14 + mm2.m12*mm.m24 + mm2.m13*mm.m34 + mm2.m14*mm.m44);\r\n    let m21 = (mm2.m21*mm.m11 + mm2.m22*mm.m21 + mm2.m23*mm.m31 + mm2.m24*mm.m41);\r\n    let m22 = (mm2.m21*mm.m12 + mm2.m22*mm.m22 + mm2.m23*mm.m32 + mm2.m24*mm.m42);\r\n    let m23 = (mm2.m21*mm.m13 + mm2.m22*mm.m23 + mm2.m23*mm.m33 + mm2.m24*mm.m43);\r\n    let m24 = (mm2.m21*mm.m14 + mm2.m22*mm.m24 + mm2.m23*mm.m34 + mm2.m24*mm.m44);\r\n    let m31 = (mm2.m31*mm.m11 + mm2.m32*mm.m21 + mm2.m33*mm.m31 + mm2.m34*mm.m41);\r\n    let m32 = (mm2.m31*mm.m12 + mm2.m32*mm.m22 + mm2.m33*mm.m32 + mm2.m34*mm.m42);\r\n    let m33 = (mm2.m31*mm.m13 + mm2.m32*mm.m23 + mm2.m33*mm.m33 + mm2.m34*mm.m43);\r\n    let m34 = (mm2.m31*mm.m14 + mm2.m32*mm.m24 + mm2.m33*mm.m34 + mm2.m34*mm.m44);\r\n    let m41 = (mm2.m41*mm.m11 + mm2.m42*mm.m21 + mm2.m43*mm.m31 + mm2.m44*mm.m41);\r\n    let m42 = (mm2.m41*mm.m12 + mm2.m42*mm.m22 + mm2.m43*mm.m32 + mm2.m44*mm.m42);\r\n    let m43 = (mm2.m41*mm.m13 + mm2.m42*mm.m23 + mm2.m43*mm.m33 + mm2.m44*mm.m43);\r\n    let m44 = (mm2.m41*mm.m14 + mm2.m42*mm.m24 + mm2.m43*mm.m34 + mm2.m44*mm.m44);\r\n\r\n    mm.m11 = m11;\r\n    mm.m12 = m12;\r\n    mm.m13 = m13;\r\n    mm.m14 = m14;\r\n    mm.m21 = m21;\r\n    mm.m22 = m22;\r\n    mm.m23 = m23;\r\n    mm.m24 = m24;\r\n    mm.m31 = m31;\r\n    mm.m32 = m32;\r\n    mm.m33 = m33;\r\n    mm.m34 = m34;\r\n    mm.m41 = m41;\r\n    mm.m42 = m42;\r\n    mm.m43 = m43;\r\n    mm.m44 = m44;\r\n\r\n    return this;\r\n  }\r\n\r\n  divide(divisor) {\r\n    this.$matrix.m11 /= divisor;\r\n    this.$matrix.m12 /= divisor;\r\n    this.$matrix.m13 /= divisor;\r\n    this.$matrix.m14 /= divisor;\r\n    this.$matrix.m21 /= divisor;\r\n    this.$matrix.m22 /= divisor;\r\n    this.$matrix.m23 /= divisor;\r\n    this.$matrix.m24 /= divisor;\r\n    this.$matrix.m31 /= divisor;\r\n    this.$matrix.m32 /= divisor;\r\n    this.$matrix.m33 /= divisor;\r\n    this.$matrix.m34 /= divisor;\r\n    this.$matrix.m41 /= divisor;\r\n    this.$matrix.m42 /= divisor;\r\n    this.$matrix.m43 /= divisor;\r\n    this.$matrix.m44 /= divisor;\r\n\r\n    return this;\r\n  }\r\n\r\n  ortho(left, right, bottom, top, near, far) {\r\n    console.warn(\"Matrix4.ortho() is deprecated, use .orthographic() instead\");\r\n\r\n    let tx = (left + right)/(left - right);\r\n    let ty = (top + bottom)/(top - bottom);\r\n    let tz = (far + near)/(far - near);\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    matrix.$matrix.m11 = 2/(left - right);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = 0;\r\n    matrix.$matrix.m32 = 0;\r\n    matrix.$matrix.m33 = -2/(far - near);\r\n    matrix.$matrix.m34 = 0;\r\n    matrix.$matrix.m41 = tx;\r\n    matrix.$matrix.m42 = ty;\r\n    matrix.$matrix.m43 = tz;\r\n    matrix.$matrix.m44 = 1;\r\n\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  frustum(left, right, bottom, top, near, far) {\r\n    let matrix = temp_mats.next().makeIdentity();\r\n\r\n    let A = (right + left)/(right - left);\r\n    let B = (top + bottom)/(top - bottom);\r\n    let C = -(far + near)/(far - near);\r\n    let D = -(2*far*near)/(far - near);\r\n\r\n    matrix.$matrix.m11 = (2*near)/(right - left);\r\n    matrix.$matrix.m12 = 0;\r\n    matrix.$matrix.m13 = 0;\r\n    matrix.$matrix.m14 = 0;\r\n    matrix.$matrix.m21 = 0;\r\n    matrix.$matrix.m22 = 2*near/(top - bottom);\r\n    matrix.$matrix.m23 = 0;\r\n    matrix.$matrix.m24 = 0;\r\n    matrix.$matrix.m31 = A;\r\n    matrix.$matrix.m32 = B;\r\n    matrix.$matrix.m33 = C;\r\n    matrix.$matrix.m34 = -1;\r\n    matrix.$matrix.m41 = 0;\r\n    matrix.$matrix.m42 = 0;\r\n    matrix.$matrix.m43 = D;\r\n    matrix.$matrix.m44 = 0;\r\n\r\n    this.isPersp = true;\r\n    this.multiply(matrix);\r\n\r\n    return this;\r\n  }\r\n\r\n  orthographic(scale, aspect, near, far) {\r\n    let mat = temp_mats.next().makeIdentity();\r\n\r\n    let zscale = far - near;\r\n\r\n    mat.scale(2.0/aspect, 2.0, -1.0/scale/zscale, 1.0/scale);\r\n    mat.translate(0.0, 0.0, 0.5*zscale - near);\r\n\r\n    this.isPersp = true; //we still make use of auto homogenous divide in BaseVector.multVecMatrix\r\n    this.multiply(mat);\r\n\r\n    return mat;\r\n  }\r\n\r\n  perspective(fovy, aspect, zNear, zFar) {\r\n    let top = Math.tan(fovy*Math.PI/360)*zNear;\r\n    let bottom = -top;\r\n    let left = aspect*bottom;\r\n    let right = aspect*top;\r\n\r\n    this.frustum(left, right, bottom, top, zNear, zFar);\r\n\r\n    return this;\r\n  }\r\n\r\n  lookat(pos, target, up) {\r\n    let matrix = lookat_cache_ms.next();\r\n    matrix.makeIdentity();\r\n\r\n    let vec = lookat_cache_vs3.next().load(pos).sub(target);\r\n    let len = vec.vectorLength();\r\n    vec.normalize();\r\n\r\n    let zvec = vec;\r\n    let yvec = lookat_cache_vs3.next().load(up).normalize();\r\n    let xvec = lookat_cache_vs3.next().load(yvec).cross(zvec).normalize();\r\n\r\n    let mm = matrix.$matrix;\r\n\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = yvec[0];\r\n    mm.m13 = zvec[0];\r\n    mm.m14 = 0;\r\n    mm.m21 = xvec[1];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = zvec[1];\r\n    mm.m24 = 0;\r\n    mm.m31 = xvec[2];\r\n    mm.m32 = yvec[2];\r\n    mm.m33 = zvec[2];\r\n\r\n    //*\r\n    mm.m11 = xvec[0];\r\n    mm.m12 = xvec[1];\r\n    mm.m13 = xvec[2];\r\n    mm.m14 = 0;\r\n    mm.m21 = yvec[0];\r\n    mm.m22 = yvec[1];\r\n    mm.m23 = yvec[2];\r\n    mm.m24 = 0;\r\n    mm.m31 = zvec[0];\r\n    mm.m32 = zvec[1];\r\n    mm.m33 = zvec[2];\r\n    mm.m34 = 0;\r\n    mm.m41 = pos[0];\r\n    mm.m42 = pos[1];\r\n    mm.m43 = pos[2];\r\n    mm.m44 = 1;\r\n    //*/\r\n\r\n    this.multiply(matrix);\r\n\r\n\r\n    return this;\r\n  }\r\n\r\n  makeRotationOnly() {\r\n    let m = this.$matrix;\r\n\r\n    m.m41 = m.m42 = m.m43 = 0.0;\r\n    m.m44 = 1.0;\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  alignAxis(axis, vec) {\r\n    vec = new Vector3(vec);\r\n    vec.normalize();\r\n\r\n    let mat = this.inputs.transformMatrix.getValue();\r\n    let m = mat.$matrix;\r\n\r\n    let mat2 = new Matrix4(mat);\r\n    let loc = new Vector3(), scale = new Vector3(), rot = new Vector3();\r\n\r\n    //we don't use rot\r\n    mat2.decompose(loc, rot, scale);\r\n\r\n    mat2.makeRotationOnly();\r\n    let axes = mat2.getAsVecs();\r\n\r\n    let axis2 = (axis + 1)%3;\r\n    let axis3 = (axis + 2)%3;\r\n\r\n    axes[axis].load(vec)\r\n    axes[axis2].cross(axes[axis]).cross(axes[axis])\r\n    axes[axis3].load(axes[axis]).cross(axes[axis2])\r\n\r\n    axes[0][3] = 1.0;\r\n    axes[1][3] = 1.0;\r\n    axes[2][3] = 1.0;\r\n\r\n    axes[0].normalize();\r\n    axes[1].normalize();\r\n    axes[2].normalize();\r\n\r\n    this.loadFromVecs(axes);\r\n    this.scale(scale[0], scale[1], scale[2]);\r\n\r\n    m.m41 = loc[0];\r\n    m.m42 = loc[1];\r\n    m.m43 = loc[2];\r\n\r\n    return this;\r\n  }\r\n\r\n  decompose(_translate, _rotate, _scale, _skew, _perspective, order = EulerOrders.XYZ) {\r\n    if (this.$matrix.m44 === 0)\r\n      return false;\r\n\r\n    let mat = temp_mats.next().load(this);\r\n    let m = mat.$matrix;\r\n\r\n    let t = _translate, r = _rotate, s = _scale;\r\n    if (t) {\r\n      t[0] = m.m41;\r\n      t[1] = m.m42;\r\n      t[2] = m.m43;\r\n    }\r\n\r\n    let l1 = Math.sqrt(m.m11*m.m11 + m.m12*m.m12 + m.m13*m.m13);\r\n    let l2 = Math.sqrt(m.m21*m.m21 + m.m22*m.m22 + m.m23*m.m23);\r\n    let l3 = Math.sqrt(m.m31*m.m31 + m.m32*m.m32 + m.m33*m.m33);\r\n\r\n    if (l1) {\r\n      m.m11 /= l1;\r\n      m.m12 /= l1;\r\n      m.m13 /= l1;\r\n    }\r\n    if (l2) {\r\n      m.m21 /= l2;\r\n      m.m22 /= l2;\r\n      m.m23 /= l2;\r\n    }\r\n    if (l3) {\r\n      m.m31 /= l3;\r\n      m.m32 /= l3;\r\n      m.m33 /= l3;\r\n    }\r\n\r\n    if (s) {\r\n      s[0] = l1;\r\n      s[1] = l2;\r\n      s[2] = l3;\r\n    }\r\n\r\n    if (r) { //THREE.js code\r\n      let clamp = myclamp;\r\n\r\n      let rmat = temp_mats.next().load(this);\r\n      rmat.normalize();\r\n\r\n      m = rmat.$matrix;\r\n\r\n      // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n      let m11 = m.m11, m12 = m.m12, m13 = m.m13, m14 = m.m14;\r\n      let m21 = m.m21, m22 = m.m22, m23 = m.m23, m24 = m.m24;\r\n      let m31 = m.m31, m32 = m.m32, m33 = m.m33, m34 = m.m34;\r\n      //let m41 = m.m41, m42 = m.m42, m43 = m.m43, m44 = m.m44;\r\n\r\n      if (order === EulerOrders.XYZ) {\r\n\r\n        r[1] = Math.asin(clamp(m13, -1, 1));\r\n\r\n        if (Math.abs(m13) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[2] = Math.atan2(-m12, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YXZ) {\r\n\r\n        r[0] = Math.asin(-clamp(m23, -1, 1));\r\n\r\n        if (Math.abs(m23) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(m13, m33);\r\n          r[2] = Math.atan2(m21, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = Math.atan2(-m31, m11);\r\n          r[2] = 0;\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZXY) {\r\n\r\n        r[0] = Math.asin(clamp(m32, -1, 1));\r\n\r\n        if (Math.abs(m32) < 0.9999999) {\r\n\r\n          r[1] = Math.atan2(-m31, m33);\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        } else {\r\n\r\n          r[1] = 0;\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.ZYX) {\r\n\r\n        r[1] = Math.asin(-clamp(m31, -1, 1));\r\n\r\n        if (Math.abs(m31) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m33);\r\n          r[2] = Math.atan2(m21, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[2] = Math.atan2(-m12, m22);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.YZX) {\r\n\r\n        r[2] = Math.asin(clamp(m21, -1, 1));\r\n\r\n        if (Math.abs(m21) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(-m23, m22);\r\n          r[1] = Math.atan2(-m31, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = 0;\r\n          r[1] = Math.atan2(m13, m33);\r\n\r\n        }\r\n\r\n      } else if (order === EulerOrders.XZY) {\r\n\r\n        r[2] = Math.asin(-clamp(m12, -1, 1));\r\n\r\n        if (Math.abs(m12) < 0.9999999) {\r\n\r\n          r[0] = Math.atan2(m32, m22);\r\n          r[1] = Math.atan2(m13, m11);\r\n\r\n        } else {\r\n\r\n          r[0] = Math.atan2(-m23, m33);\r\n          r[1] = 0;\r\n\r\n        }\r\n\r\n      } else {\r\n        console.warn('unsupported euler order:', order);\r\n      }\r\n      //r[0] = Math.atan2(m.m23, m.m33);\r\n      //r[1] = Math.atan2(-m.m13, Math.sqrt(m.m23*m.m23 + m.m33*m.m33));\r\n      //r[2] = Math.atan2(m.m12, m.m11);\r\n    }\r\n  }\r\n\r\n  _determinant2x2(a, b, c, d) {\r\n    return a*d - b*c;\r\n  }\r\n\r\n  _determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3) {\r\n    return a1*this._determinant2x2(b2, b3, c2, c3) - b1*this._determinant2x2(a2, a3, c2, c3) + c1*this._determinant2x2(a2, a3, b2, b3);\r\n  }\r\n\r\n  _determinant4x4() {\r\n    let a1 = this.$matrix.m11;\r\n    let b1 = this.$matrix.m12;\r\n    let c1 = this.$matrix.m13;\r\n    let d1 = this.$matrix.m14;\r\n    let a2 = this.$matrix.m21;\r\n    let b2 = this.$matrix.m22;\r\n    let c2 = this.$matrix.m23;\r\n    let d2 = this.$matrix.m24;\r\n    let a3 = this.$matrix.m31;\r\n    let b3 = this.$matrix.m32;\r\n    let c3 = this.$matrix.m33;\r\n    let d3 = this.$matrix.m34;\r\n    let a4 = this.$matrix.m41;\r\n    let b4 = this.$matrix.m42;\r\n    let c4 = this.$matrix.m43;\r\n    let d4 = this.$matrix.m44;\r\n    return a1*this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) - b1*this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) + c1*this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) - d1*this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n  }\r\n\r\n  _makeAdjoint() {\r\n    let a1 = this.$matrix.m11;\r\n    let b1 = this.$matrix.m12;\r\n    let c1 = this.$matrix.m13;\r\n    let d1 = this.$matrix.m14;\r\n    let a2 = this.$matrix.m21;\r\n    let b2 = this.$matrix.m22;\r\n    let c2 = this.$matrix.m23;\r\n    let d2 = this.$matrix.m24;\r\n    let a3 = this.$matrix.m31;\r\n    let b3 = this.$matrix.m32;\r\n    let c3 = this.$matrix.m33;\r\n    let d3 = this.$matrix.m34;\r\n    let a4 = this.$matrix.m41;\r\n    let b4 = this.$matrix.m42;\r\n    let c4 = this.$matrix.m43;\r\n    let d4 = this.$matrix.m44;\r\n\r\n    this.$matrix.m11 = this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m21 = -this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\r\n    this.$matrix.m31 = this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\r\n    this.$matrix.m41 = -this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\r\n    this.$matrix.m12 = -this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m22 = this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\r\n    this.$matrix.m32 = -this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\r\n    this.$matrix.m42 = this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\r\n    this.$matrix.m13 = this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m23 = -this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\r\n    this.$matrix.m33 = this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\r\n    this.$matrix.m43 = -this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\r\n    this.$matrix.m14 = -this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m24 = this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\r\n    this.$matrix.m34 = -this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\r\n    this.$matrix.m44 = this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.load(this.mat);\r\n    this.__mat = this.mat;\r\n    //delete this.mat;\r\n  }\r\n}\r\n\r\nMatrix4.STRUCT = `\r\nmat4 {\r\n  mat      : array(float) | this.getAsArray();\r\n  isPersp  : int          | this.isPersp;\r\n}\r\n`;\r\nnstructjs.register(Matrix4);\r\n\r\npreMultTemp = new Matrix4();\r\n\r\nwindow.testmat = (x = 0, y = 0, z = Math.PI*0.5) => {\r\n  let m1 = new Matrix4();\r\n  m1.euler_rotate(x, y, z);\r\n  //m1.scale(2.0, 0.5, 3.0);\r\n\r\n  let t = [0, 0, 0], r = [0, 0, 0], s = [0, 0, 0]\r\n\r\n  m1.decompose(t, r, s);\r\n\r\n  window.console.log(\"\\n\");\r\n  window.console.log(t);\r\n  window.console.log(r);\r\n  window.console.log(s);\r\n\r\n\r\n  let mat = m1.clone();\r\n  mat.transpose();\r\n  mat.multiply(m1);\r\n\r\n  console.log(mat.toString());\r\n  return r;\r\n}\r\n\r\nlookat_cache_ms = util.cachering.fromConstructor(Matrix4, 64);\r\neuler_rotate_mats = util.cachering.fromConstructor(Matrix4, 64);\r\ntemp_mats = util.cachering.fromConstructor(Matrix4, 64);\r\n", "import * as util from \"./util.js\";\r\nimport cconst from '../config/config.js';\r\nimport {Vector2} from './vectormath.js';\r\n\r\nexport let modalstack = [];\r\nlet singleMouseCBs = {};\r\n\r\nfunction debugDomEvents() {\r\n  let cbsymbol = Symbol(\"event-callback\");\r\n  let thsymbol = Symbol(\"debug-info\");\r\n\r\n  let idgen = 0;\r\n\r\n  function init(et) {\r\n    if (!et[thsymbol]) {\r\n      et[thsymbol] = idgen++;\r\n    }\r\n  }\r\n\r\n  function getkey(et, type, options) {\r\n    init(et);\r\n    return \"\" + et[thsymbol] + \":\" + type + \":\" + JSON.stringify(options);\r\n  }\r\n\r\n  let addEventListener = EventTarget.prototype.addEventListener;\r\n  let removeEventListener = EventTarget.prototype.removeEventListener;\r\n\r\n  EventTarget.prototype.addEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      cb[cbsymbol] = new Set();\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n    cb[cbsymbol].add(key);\r\n\r\n    return addEventListener.call(this, type, cb, options);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (type, cb, options) {\r\n    init(this);\r\n\r\n    if (!cb[cbsymbol]) {\r\n      console.error(\"Invalid callback in removeEventListener for\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    let key = getkey(this, type, options);\r\n\r\n    if (!cb[cbsymbol].has(key)) {\r\n      console.error(\"Callback not in removeEventListener;\", type, this, cb);\r\n      return;\r\n    }\r\n\r\n    cb[cbsymbol].delete(key);\r\n\r\n    return removeEventListener.call(this, type, cb, options);\r\n  }\r\n}\r\n\r\nfunction singletonMouseEvents() {\r\n  let keys = [\"mousedown\", \"mouseup\", \"mousemove\"];\r\n  for (let k of keys) {\r\n    singleMouseCBs[k] = new Set();\r\n  }\r\n\r\n  let ddd = -1.0;\r\n  window.testSingleMouseUpEvent = (type = \"mousedown\") => {\r\n    let id = ddd++;\r\n    singleMouseEvent(() => {\r\n      console.log(\"mouse event\", id);\r\n    }, type)\r\n  };\r\n\r\n  let _mpos = new Vector2();\r\n\r\n  function doSingleCbs(e, type) {\r\n    let list = singleMouseCBs[type];\r\n    singleMouseCBs[type] = new Set();\r\n\r\n    if (e.type !== \"touchend\" && e.type !== \"touchcancel\") {\r\n      _mpos[0] = e.touches && e.touches.length > 0 ? e.touches[0].pageX : e.x;\r\n      _mpos[1] = e.touches && e.touches.length > 0 ? e.touches[0].pageY : e.y;\r\n    }\r\n\r\n    if (e.touches) {\r\n      e = copyEvent(e);\r\n\r\n      e.type = type;\r\n      if (e.touches.length > 0) {\r\n        e.x = e.pageX = e.touches[0].pageX;\r\n        e.y = e.pageY = e.touches[0].pageY;\r\n      } else {\r\n        e.x = _mpos[0];\r\n        e.y = _mpos[1];\r\n      }\r\n    }\r\n\r\n    for (let cb of list) {\r\n      try {\r\n        cb(e);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.warn(\"Error in event callback\");\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"mouseup\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  window.addEventListener(\"touchcancel\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchend\", (e) => {\r\n    doSingleCbs(e, \"mouseup\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousedown\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchstart\", (e) => {\r\n    doSingleCbs(e, \"mousedown\");\r\n  }, {capture: true});\r\n\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n  document.addEventListener(\"touchmove\", (e) => {\r\n    doSingleCbs(e, \"mousemove\");\r\n  }, {capture: true});\r\n\r\n  return {\r\n    singleMouseEvent(cb, type) {\r\n      if (!(type in singleMouseCBs)) {\r\n        throw new Error(\"not a mouse event\");\r\n      }\r\n\r\n      singleMouseCBs[type].add(cb);\r\n    }\r\n  };\r\n}\r\n\r\nsingletonMouseEvents = singletonMouseEvents();\r\n\r\n/**\r\n * adds a mouse event callback that only gets called once\r\n * */\r\nexport function singleMouseEvent(cb, type) {\r\n  return singletonMouseEvents.singleMouseEvent(cb, type);\r\n}\r\n\r\n\r\n/*tests if either the left mouse button is down,\r\n* or a touch event has happened and e.touches.length == 1*/\r\nexport function isLeftClick(e) {\r\n  if (e.touches !== undefined) {\r\n    return e.touches.length === 1;\r\n  }\r\n\r\n  return e.button === 0;\r\n}\r\n\r\nexport class DoubleClickHandler {\r\n  constructor() {\r\n    this.down = 0;\r\n    this.last = 0;\r\n    this.dblEvent = undefined;\r\n\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._on_mouseup = this._on_mouseup.bind(this);\r\n    this._on_mousemove = this._on_mousemove.bind(this);\r\n  }\r\n\r\n  _on_mouseup(e) {\r\n    //console.log(\"mup\", e);\r\n    this.mdown = false;\r\n  }\r\n\r\n  _on_mousemove(e) {\r\n    let mpos = new Vector2();\r\n    mpos[0] = e.x;\r\n    mpos[1] = e.y;\r\n\r\n    let dist = mpos.vectorDistance(this.start_mpos)*devicePixelRatio;\r\n\r\n    if (dist > 11) {\r\n      //console.log(\"cancel\", dist);\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown) {\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  mousedown(e) {\r\n    //console.log(\"mdown\", e.x, e.y);\r\n\r\n    if (!this.last) {\r\n      this.last = 0;\r\n    }\r\n    if (!this.down) {\r\n      this.down = 0;\r\n    }\r\n    if (!this.up) {\r\n      this.up = 0;\r\n    }\r\n\r\n    if (isMouseDown(e)) {\r\n      this.mdown = true;\r\n\r\n      let cpy = Object.assign({}, e);\r\n\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n\r\n      singleMouseEvent(this._on_mousemove, \"mousemove\");\r\n\r\n      if (e.type.search(\"touch\") >= 0 && e.touches.length > 0) {\r\n        cpy.x = cpy.pageX = e.touches[0].pageX;\r\n        cpy.y = cpy.pageY = e.touches[1].pageY;\r\n      } else {\r\n        cpy.x = cpy.pageX = e.x;\r\n        cpy.y = cpy.pageY = e.y;\r\n      }\r\n\r\n      //stupid real MouseEvent class zeros .x/.y\r\n      //continue using hackish copyEvent for now...\r\n\r\n      this.dblEvent = copyEvent(e);\r\n      this.dblEvent.type = \"dblclick\";\r\n\r\n      this.last = this.down;\r\n      this.down = util.time_ms();\r\n\r\n      if (this.down - this.last < cconst.doubleClickTime) {\r\n        this.mdown = false;\r\n        this.ondblclick(this.dblEvent);\r\n\r\n        this.down = this.last = 0.0;\r\n      } else {\r\n        singleMouseEvent(this._on_mouseup, \"mouseup\");\r\n      }\r\n    } else {\r\n      this.mdown = false;\r\n    }\r\n  }\r\n\r\n  //you may override this\r\n  ondblclick(e) {\r\n\r\n  }\r\n\r\n  update() {\r\n    if (modalstack.length > 0) {\r\n      //cancel double click requests\r\n      this.mdown = false;\r\n    }\r\n\r\n    if (this.mdown && util.time_ms() - this.down > cconst.doubleClickHoldTime) {\r\n      this.mdown = false;\r\n      this.ondblclick(this.dblEvent);\r\n    }\r\n  }\r\n\r\n  abort() {\r\n    this.last = this.down = 0;\r\n  }\r\n}\r\n\r\nexport function isMouseDown(e) {\r\n  let mdown = 0;\r\n\r\n  if (e.touches !== undefined) {\r\n    mdown = e.touches.length > 0;\r\n  } else {\r\n    mdown = e.buttons;\r\n  }\r\n\r\n  mdown = mdown & 1;\r\n\r\n  return mdown;\r\n}\r\n\r\nexport function pathDebugEvent(e, extra) {\r\n  e.__prevdef = e.preventDefault;\r\n  e.__stopprop = e.stopPropagation;\r\n\r\n  e.preventDefault = function () {\r\n    console.warn(\"preventDefault\", extra);\r\n    return this.__prevdef();\r\n  };\r\n\r\n  e.stopPropagation = function () {\r\n    console.warn(\"stopPropagation\", extra);\r\n    return this.__stopprop();\r\n  }\r\n}\r\n\r\n/** Returns true if event came from a touchscreen or pen device */\r\nexport function eventWasTouch(e) {\r\n  let ret = e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents;\r\n  ret = ret || e.was_touch;\r\n  ret = ret || e instanceof TouchEvent;\r\n  ret = ret || e.touches !== undefined;\r\n\r\n  if (e instanceof PointerEvent) {\r\n    ret = ret || (e.pointerType === \"pen\" || e.pointerType === \"touch\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function copyEvent(e) {\r\n  let ret = {};\r\n  let keys = [];\r\n\r\n  for (let k in e) {\r\n    keys.push(k);\r\n  }\r\n\r\n  keys = keys.concat(Object.getOwnPropertySymbols(e));\r\n  keys = keys.concat(Object.getOwnPropertyNames(e));\r\n\r\n  for (let k of keys) {\r\n    let v;\r\n\r\n    try {\r\n      v = e[k];\r\n    } catch (error) {\r\n      console.warn(\"read error for event key\", k);\r\n      continue;\r\n    }\r\n\r\n    if (typeof v == \"function\") {\r\n      ret[k] = v.bind(e);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  ret.original = e;\r\n\r\n  return ret;\r\n}\r\n\r\nlet Screen;\r\n\r\nexport function _setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n\r\nfunction findScreen() {\r\n  let rec = (n) => {\r\n    for (let n2 of n.childNodes) {\r\n      if (n2 && typeof n2 === \"object\" && n2 instanceof Screen) {\r\n        return n2;\r\n      }\r\n    }\r\n\r\n    for (let n2 of n.childNodes) {\r\n      let ret = rec(n2);\r\n      if (ret) {\r\n        return ret;\r\n      }\r\n    }\r\n  };\r\n\r\n  return rec(document.body);\r\n}\r\n\r\nwindow._findScreen = findScreen;\r\n\r\nlet ContextAreaClass;\r\n\r\nexport function _setModalAreaClass(cls) {\r\n  ContextAreaClass = cls;\r\n}\r\n\r\nexport function pushPointerModal(obj, elem, pointerId, autoStopPropagation = true) {\r\n  return pushModalLight(obj, autoStopPropagation, elem, pointerId);\r\n}\r\n\r\nexport function pushModalLight(obj, autoStopPropagation = true, elem, pointerId) {\r\n  let keys;\r\n\r\n  if (pointerId === undefined) {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\",\r\n      \"touchcancel\", \"mousewheel\", \"mousemove\", \"mouseover\", \"mouseout\", \"mouseenter\",\r\n      \"mouseleave\", \"dragstart\", \"drag\", \"dragend\", \"dragexit\", \"dragleave\", \"dragover\",\r\n      \"dragenter\", \"drop\", \"pointerdown\", \"pointermove\", \"pointerup\", \"pointercancel\",\r\n      \"pointerstart\", \"pointerend\", \"pointerleave\", \"pointerexit\", \"pointerenter\",\r\n      \"pointerover\"\r\n    ]);\r\n  } else {\r\n    keys = new Set([\r\n      \"keydown\", \"keyup\", \"keypress\", \"mousewheel\"\r\n    ]);\r\n  }\r\n\r\n  let ret = {\r\n    keys     : keys,\r\n    handlers : {},\r\n    last_mpos: [0, 0]\r\n  };\r\n\r\n  let touchmap = {\r\n    \"touchstart\" : \"mousedown\",\r\n    \"touchmove\"  : \"mousemove\",\r\n    \"touchend\"   : \"mouseup\",\r\n    \"touchcancel\": \"mouseup\"\r\n  };\r\n\r\n  let mpos = [0, 0];\r\n\r\n  let screen = findScreen();\r\n  if (screen) {\r\n    mpos[0] = screen.mpos[0];\r\n    mpos[1] = screen.mpos[1];\r\n    screen = undefined;\r\n  }\r\n\r\n  function handleAreaContext() {\r\n    let screen = findScreen();\r\n    if (screen) {\r\n      let sarea = screen.findScreenArea(mpos[0], mpos[1]);\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_default_touchhandler(type, state) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (touchmap[type] in ret.handlers) {\r\n        let type2 = touchmap[type];\r\n\r\n        let e2 = copyEvent(e);\r\n\r\n        e2.was_touch = true;\r\n        e2.type = type2;\r\n        e2.button = type == \"touchcancel\" ? 1 : 0;\r\n        e2.touches = e.touches;\r\n\r\n        if (e.touches.length > 0) {\r\n          let t = e.touches[0];\r\n\r\n          mpos[0] = t.pageX;\r\n          mpos[1] = t.pageY;\r\n\r\n          e2.pageX = e2.x = t.pageX;\r\n          e2.pageY = e2.y = t.pageY;\r\n          e2.clientX = t.clientX;\r\n          e2.clientY = t.clientY;\r\n          e2.x = t.clientX;\r\n          e2.y = t.clientY;\r\n\r\n          ret.last_mpos[0] = e2.x;\r\n          ret.last_mpos[1] = e2.y;\r\n        } else {\r\n          e2.x = e2.clientX = e2.pageX = e2.screenX = ret.last_mpos[0];\r\n          e2.y = e2.clientY = e2.pageY = e2.screenY = ret.last_mpos[1];\r\n        }\r\n\r\n        e2.was_touch = true;\r\n\r\n        handleAreaContext();\r\n        //console.log(e2.x, e2.y);\r\n        ret.handlers[type2](e2);\r\n      }\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  function make_handler(type, key) {\r\n    return function (e) {\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      if (typeof key !== \"string\") {\r\n        //console.warn(\"key was undefined\", key, type);\r\n        return;\r\n      }\r\n\r\n      if (key.startsWith(\"mouse\")) {\r\n        mpos[0] = e.pageX;\r\n        mpos[1] = e.pageY;\r\n      } else if (key.startsWith(\"pointer\")) {\r\n        mpos[0] = e.x;\r\n        mpos[1] = e.y;\r\n      }\r\n\r\n      handleAreaContext();\r\n\r\n      if (key !== undefined)\r\n        obj[key](e);\r\n\r\n      if (autoStopPropagation) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n  }\r\n\r\n  let found = {};\r\n\r\n  for (let k of keys) {\r\n    let key;\r\n\r\n    if (obj[k])\r\n      key = k;\r\n    else if (obj[\"on\" + k])\r\n      key = \"on\" + k;\r\n    else if (obj[\"on_\" + k])\r\n      key = \"on_\" + k;\r\n    else if (k in touchmap)\r\n      continue; //default touch event handlers will be done seperately\r\n    else\r\n      key = undefined; //make handler that still blocks events\r\n\r\n    //check we don't override other mouse pointer event handlers\r\n    if (key === undefined && k.search(\"pointer\") === 0) {\r\n      continue;\r\n    }\r\n\r\n    if (key !== undefined) {\r\n      found[k] = 1;\r\n    }\r\n\r\n    let handler = make_handler(k, key);\r\n    ret.handlers[k] = handler;\r\n\r\n    let settings = handler.settings = {passive: false, capture: true};\r\n    window.addEventListener(k, handler, settings);\r\n  }\r\n\r\n  for (let k in touchmap) {\r\n    if (!(k in found)) {\r\n      //console.log(\"making touch handler for\", '\"' + k + '\"', ret.handlers[k]);\r\n\r\n      ret.handlers[k] = make_default_touchhandler(k, ret);\r\n\r\n      let settings = ret.handlers[k].settings = {passive: false, capture: true};\r\n      window.addEventListener(k, ret.handlers[k], settings);\r\n    }\r\n  }\r\n\r\n  if (pointerId !== undefined) {\r\n    ret.pointer = {\r\n      elem, pointerId\r\n    };\r\n\r\n    function make_pointer(k) {\r\n      let k2 = \"on_\" + k;\r\n\r\n      ret.pointer[k] = function (e) {\r\n        if (obj[k2] !== undefined) {\r\n          obj[k2](e);\r\n        }\r\n\r\n        if (autoStopPropagation) {\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    }\r\n\r\n    make_pointer(\"pointerdown\");\r\n    make_pointer(\"pointermove\");\r\n    make_pointer(\"pointerup\");\r\n    make_pointer(\"pointerstart\");\r\n    make_pointer(\"pointerend\");\r\n    make_pointer(\"pointerleave\");\r\n    make_pointer(\"pointerenter\");\r\n    make_pointer(\"pointerout\");\r\n    make_pointer(\"pointerover\");\r\n    make_pointer(\"pointerexit\");\r\n    make_pointer(\"pointercancel\");\r\n\r\n    for (let k in ret.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.addEventListener(k, ret.pointer[k]);\r\n      }\r\n    }\r\n\r\n    try {\r\n      elem.setPointerCapture(pointerId)\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n\r\n      console.log(\"attempting fallback\");\r\n\r\n      for (let k in ret.pointer) {\r\n        if (k !== \"elem\" && k !== \"pointerId\") {\r\n          elem.removeEventListener(k, ret.pointer[k]);\r\n        }\r\n      }\r\n\r\n      delete ret.pointer;\r\n\r\n      modalstack.push(ret);\r\n      popModalLight(ret);\r\n\r\n      for (let k in obj) {\r\n        if (k === \"pointercancel\" || k === \"pointerend\" || k === \"pointerstart\") {\r\n          continue;\r\n        }\r\n\r\n        if (k.startsWith(\"pointer\")) {\r\n          let k2 = k.replace(/pointer/, \"mouse\");\r\n          if (k2 in obj) {\r\n            console.warn(\"warning, existing mouse handler\", k2);\r\n            continue;\r\n          }\r\n\r\n          let v = obj[k];\r\n          obj[k] = undefined;\r\n\r\n          obj[k2] = v;\r\n        }\r\n      }\r\n\r\n      console.log(obj);\r\n\r\n      return pushModalLight(obj, autoStopPropagation);\r\n    }\r\n  }\r\n\r\n  modalstack.push(ret);\r\n  ContextAreaClass.lock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"pushModalLight\", ret.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/* Trace all calls to EventTarget.prototype.[add/rem]EventListener */\r\nif (0) {\r\n  window._print_evt_debug = false;\r\n\r\n  function evtprint() {\r\n    if (window.window._print_evt_debug) {\r\n      console.warn(...arguments);\r\n    }\r\n  }\r\n\r\n  let addevent = EventTarget.prototype.addEventListener;\r\n  let remevent = EventTarget.prototype.removeEventListener;\r\n\r\n  const funckey = Symbol(\"eventfunc\");\r\n\r\n  EventTarget.prototype.addEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener added\", name, func.name, args);\r\n    //}\r\n\r\n    let func2 = function (e) {\r\n      let proxy = new Proxy(e, {\r\n        get(target, p, receiver) {\r\n          if (p === \"preventDefault\") {\r\n            return function () {\r\n              evtprint(\"preventDefault\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          } else if (p === \"stopPropagation\") {\r\n            return function () {\r\n              evtprint(\"stopPropagation\", name, arguments);\r\n              return e.preventDefault(...arguments);\r\n            }\r\n          }\r\n\r\n          return e[p];\r\n        }\r\n      });\r\n\r\n      return func.call(this, proxy);\r\n    }\r\n\r\n    func[funckey] = func2;\r\n\r\n    return addevent.call(this, name, func2, args);\r\n  }\r\n\r\n  EventTarget.prototype.removeEventListener = function (name, func, args) {\r\n    //if (name.startsWith(\"key\")) {\r\n    evtprint(\"listener removed\", name, func.name, args);\r\n    //}\r\n\r\n    func = func[funckey];\r\n\r\n    return remevent.call(this, name, func, args);\r\n  }\r\n}\r\n\r\nexport function popModalLight(state) {\r\n  if (state === undefined) {\r\n    console.warn(\"Bad call to popModalLight: state was undefined\");\r\n    return;\r\n  }\r\n\r\n  if (state !== modalstack[modalstack.length - 1]) {\r\n    if (modalstack.indexOf(state) < 0) {\r\n      console.warn(\"Error in popModalLight; modal handler not found\");\r\n      return;\r\n    } else {\r\n      console.warn(\"Error in popModalLight; called in wrong order\");\r\n    }\r\n  }\r\n\r\n  for (let k in state.handlers) {\r\n    //console.log(k);\r\n    window.removeEventListener(k, state.handlers[k], state.handlers[k].settings);\r\n  }\r\n\r\n  state.handlers = {};\r\n  modalstack.remove(state);\r\n  ContextAreaClass.unlock();\r\n\r\n  if (cconst.DEBUG.modalEvents) {\r\n    console.warn(\"popModalLight\", modalstack, state.pointer ? \"(pointer events)\" : \"\");\r\n  }\r\n\r\n  if (state.pointer) {\r\n    let elem = state.pointer.elem;\r\n\r\n    try {\r\n      elem.releasePointerCapture(state.pointer.pointerId);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let k in state.pointer) {\r\n      if (k !== \"elem\" && k !== \"pointerId\") {\r\n        elem.removeEventListener(k, state.pointer[k]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function haveModal() {\r\n  return modalstack.length > 0;\r\n}\r\n\r\nwindow._haveModal = haveModal; //for debugging console\r\n\r\nexport var keymap_latin_1 = {\r\n  \"Space\" : 32,\r\n  \"Escape\": 27,\r\n  \"Enter\" : 13,\r\n  \"Return\": 13,\r\n  \"Up\"    : 38,\r\n  \"Down\"  : 40,\r\n  \"Left\"  : 37,\r\n  \"Right\" : 39,\r\n\r\n  \"Num0\"     : 96,\r\n  \"Num1\"     : 97,\r\n  \"Num2\"     : 98,\r\n  \"Num3\"     : 99,\r\n  \"Num4\"     : 100,\r\n  \"Num5\"     : 101,\r\n  \"Num6\"     : 102,\r\n  \"Num7\"     : 103,\r\n  \"Num8\"     : 104,\r\n  \"Num9\"     : 105,\r\n  \"Home\"     : 36,\r\n  \"End\"      : 35,\r\n  \"Delete\"   : 46,\r\n  \"Backspace\": 8,\r\n  \"Insert\"   : 45,\r\n  \"PageUp\"   : 33,\r\n  \"PageDown\" : 34,\r\n  \"Tab\"      : 9,\r\n  \"-\"        : 189,\r\n  \"=\"        : 187,\r\n  \".\"        : 190,\r\n  \"/\"        : 191,\r\n  \",\"        : 188,\r\n  \";\"        : 186,\r\n  \"'\"        : 222,\r\n  \"[\"        : 219,\r\n  \"]\"        : 221,\r\n  \"NumPlus\"  : 107,\r\n  \"NumMinus\" : 109,\r\n  \"Shift\"    : 16,\r\n  \"Ctrl\"     : 17,\r\n  \"Control\"  : 17,\r\n  \"Alt\"      : 18\r\n}\r\n\r\nfor (var i = 0; i < 26; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 65)] = i + 65\r\n}\r\nfor (var i = 0; i < 10; i++) {\r\n  keymap_latin_1[String.fromCharCode(i + 48)] = i + 48\r\n}\r\n\r\nfor (var k in keymap_latin_1) {\r\n  if (!(k in keymap_latin_1)) {\r\n    keymap_latin_1[keymap_latin_1[k]] = k;\r\n  }\r\n}\r\n\r\nvar keymap_latin_1_rev = {}\r\nfor (var k in keymap_latin_1) {\r\n  keymap_latin_1_rev[keymap_latin_1[k]] = k\r\n}\r\n\r\nexport var keymap = keymap_latin_1;\r\nexport var reverse_keymap = keymap_latin_1_rev;\r\n\r\nexport class HotKey {\r\n  /**action can be a callback or a toolpath string*/\r\n  constructor(key, modifiers, action, uiname) {\r\n    this.action = action;\r\n    this.mods = modifiers;\r\n    this.key = keymap[key];\r\n    this.uiname = uiname;\r\n  }\r\n\r\n  exec(ctx) {\r\n    if (typeof this.action == \"string\") {\r\n      ctx.api.execTool(ctx, this.action);\r\n    } else {\r\n      this.action(ctx);\r\n    }\r\n  }\r\n\r\n  buildString() {\r\n    let s = \"\";\r\n\r\n    for (let i = 0; i < this.mods.length; i++) {\r\n      if (i > 0) {\r\n        s += \" + \";\r\n      }\r\n\r\n      let k = this.mods[i].toLowerCase();\r\n      k = k[0].toUpperCase() + k.slice(1, k.length).toLowerCase();\r\n\r\n      s += k;\r\n    }\r\n\r\n    if (this.mods.length > 0) {\r\n      s += \"+\";\r\n    }\r\n\r\n    s += reverse_keymap[this.key];\r\n\r\n    return s.trim();\r\n  }\r\n}\r\n\r\nexport class KeyMap extends Array {\r\n  /**\r\n   *\r\n   * @param pathid{string} Id of keymap, used when patching hotkeys, when\r\n   *                       that is implemented\r\n   * */\r\n  constructor(hotkeys = [], pathid = \"undefined\") {\r\n    super();\r\n\r\n    this.pathid = pathid;\r\n\r\n    for (let hk of hotkeys) {\r\n      this.add(hk);\r\n    }\r\n  }\r\n\r\n  handle(ctx, e) {\r\n    let mods = new util.set();\r\n    if (e.shiftKey)\r\n      mods.add(\"shift\");\r\n    if (e.altKey)\r\n      mods.add(\"alt\");\r\n    if (e.ctrlKey) {\r\n      mods.add(\"ctrl\");\r\n    }\r\n    if (e.commandKey) {\r\n      mods.add(\"command\");\r\n    }\r\n\r\n    for (let hk of this) {\r\n      let ok = e.keyCode === hk.key;\r\n      if (!ok) continue;\r\n\r\n      let count = 0;\r\n      for (let m of hk.mods) {\r\n        m = m.toLowerCase().trim();\r\n\r\n        if (!mods.has(m)) {\r\n          ok = false;\r\n          break;\r\n        }\r\n\r\n        count++;\r\n      }\r\n\r\n      if (count !== mods.length) {\r\n        ok = false;\r\n      }\r\n\r\n      if (ok) {\r\n        try {\r\n          hk.exec(ctx);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.log(\"failed to execute a hotkey\", keymap[e.keyCode]);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  add(hk) {\r\n    this.push(hk);\r\n  }\r\n\r\n  push(hk) {\r\n    super.push(hk);\r\n  }\r\n}\r\n\r\n", "export const ClassIdSymbol = Symbol(\"pathux-class-id\");\r\n", "//import * as nstructjs from './struct.js';\r\nimport {haveModal, _setModalAreaClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nimport '../path-controller/util/struct.js';\r\n\r\nlet ScreenClass = undefined;\r\n\r\nimport {ClassIdSymbol} from '../core/ui_consts.js';\r\n\r\n\r\nexport function setScreenClass(cls) {\r\n  ScreenClass = cls;\r\n}\r\n\r\nexport function getAreaIntName(name) {\r\n  let hash = 0;\r\n\r\n  for (let i = 0; i < name.length; i++) {\r\n    let c = name.charCodeAt(i);\r\n\r\n    if (i%2 === 0) {\r\n      hash += c<<8;\r\n      hash *= 13;\r\n      hash = hash & ((1<<15) - 1);\r\n    } else {\r\n      hash += c;\r\n    }\r\n  }\r\n\r\n  return hash;\r\n}\r\n\r\n//XXX get rid of me\r\nwindow.getAreaIntName = getAreaIntName;\r\n\r\n//XXX get rid of me\r\nexport var AreaTypes = {\r\n  TEST_CANVAS_EDITOR: 0\r\n};\r\n\r\n  export function setAreaTypes(def) {\r\n  for (let k in AreaTypes) {\r\n    delete AreaTypes[k];\r\n  }\r\n\r\n  for (let k in def) {\r\n    AreaTypes[k] = def[k];\r\n  }\r\n}\r\n\r\nexport let areaclasses = {};\r\n\r\n/*hackish! store ref an active wrangler so simple_event's modal\r\n* system can lock it!*/\r\nlet theWrangler = undefined;\r\n\r\nexport class AreaWrangler {\r\n  constructor() {\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.idgen = 0;\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    theWrangler = this;\r\n  }\r\n\r\n  /*Yeek this is particularly evil, it creates a context\r\n  * that can be used by popups with the original context\r\n  * area stack intact of the elements that spawned them.*/\r\n  makeSafeContext(ctx) {\r\n    let wrangler = this.copy();\r\n    let this2 = this;\r\n\r\n    return new Proxy(ctx, {\r\n      get(target, key, rec) {\r\n        wrangler.copyTo(contextWrangler);\r\n        return target[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  copyTo(ret) {\r\n    for (let [key, stack1] of this.stacks) {\r\n      ret.stack.set(key, util.list(stack1));\r\n    }\r\n\r\n    for (let [key, val] of this.lasts) {\r\n      ret.lasts.set(key, val);\r\n    }\r\n\r\n    ret.stack = util.list(this.stack);\r\n    ret.lastArea = this.lastArea;\r\n  }\r\n\r\n  copy(b) {\r\n    let ret = new AreaWrangler();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  _checkWrangler(ctx) {\r\n    if (ctx === undefined) {\r\n      return true;\r\n    }\r\n\r\n    if (this._last_screen_id === undefined) {\r\n      this._last_screen_id = ctx.screen._id;\r\n      return true;\r\n    }\r\n\r\n    if (ctx.screen._id !== this._last_screen_id) {\r\n      this.reset();\r\n\r\n      this._last_screen_id = ctx.screen._id;\r\n      console.warn(\"contextWrangler detected a new screen; new file?\");\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  reset() {\r\n    theWrangler = this;\r\n    this.stacks = new Map();\r\n    this.lasts = new Map();\r\n    this.lastArea = undefined;\r\n    this.stack = [];\r\n    this.locked = 0;\r\n    this._last_screen_id = undefined;\r\n\r\n    return this;\r\n  }\r\n\r\n  static findInstance() {\r\n    return theWrangler;\r\n  }\r\n\r\n  static lock() {\r\n    return this.findInstance().lock();\r\n  }\r\n\r\n  static unlock() {\r\n    return this.findInstance().unlock();\r\n  }\r\n\r\n  lock() {\r\n    this.locked++;\r\n    return this;\r\n  }\r\n\r\n  unlock() {\r\n    this.locked = Math.max(this.locked - 1, 0);\r\n    return this;\r\n  }\r\n\r\n  push(type, area, pushLastRef = true) {\r\n    theWrangler = this;\r\n\r\n    if (haveModal() || this.locked) {\r\n      pushLastRef = false;\r\n    }\r\n\r\n    if (pushLastRef || !this.lasts.has(type[ClassIdSymbol])) {\r\n      this.lasts.set(type[ClassIdSymbol], area);\r\n      this.lastArea = area;\r\n    }\r\n\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n    if (stack === undefined) {\r\n      stack = [];\r\n      this.stacks.set(type[ClassIdSymbol], stack);\r\n    }\r\n\r\n    let last = this.lasts.get(type[ClassIdSymbol]);\r\n\r\n    stack.push(last);\r\n    stack.push(area);\r\n\r\n    this.stack.push(area);\r\n  }\r\n\r\n  updateLastRef(type, area) {\r\n    theWrangler = this;\r\n\r\n    if ((this.locked || haveModal()) && this.lasts.has(type[ClassIdSymbol])) {\r\n      return;\r\n    }\r\n\r\n    this.lasts.set(type[ClassIdSymbol], area);\r\n    this.lastArea = area;\r\n  }\r\n\r\n  pop(type, area) {\r\n    let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n    if (stack === undefined) {\r\n      console.warn(\"pop_ctx_area called in error\");\r\n      //throw new Error(\"pop_ctx_area called in error\");\r\n      return;\r\n    }\r\n\r\n    if (stack.length > 0) {\r\n      stack.pop();\r\n      let last = stack.pop();\r\n\r\n      /* paranoia isConnected check to ensure stale elements don't\r\n       * pollute the lasts stack */\r\n      if (!this.locked && last && last.isConnected) {\r\n        this.lasts.set(type[ClassIdSymbol], last);\r\n      }\r\n    } else {\r\n      console.error(\"pop_ctx_area called in error\");\r\n    }\r\n\r\n    if (this.stack.length > 0) {\r\n      this.stack.pop();\r\n    }\r\n  }\r\n\r\n  getLastArea(type) {\r\n    //if (Math.random() > 0.9995) {\r\n      //console.warn(\"getLastArea!\", type, this.lasts.get(type[ClassIdSymbol]));\r\n    //}\r\n\r\n    if (type === undefined) {\r\n      if (this.stack.length > 0) {\r\n        return this.stack[this.stack.length - 1];\r\n      } else {\r\n        return this.lastArea;\r\n      }\r\n    } else {\r\n      if (this.stacks.has(type[ClassIdSymbol])) {\r\n        let stack = this.stacks.get(type[ClassIdSymbol]);\r\n\r\n        if (stack.length > 0) {\r\n          return stack[stack.length-1];\r\n        }\r\n      }\r\n\r\n      return this.lasts.get(type[ClassIdSymbol]);\r\n    }\r\n  }\r\n}\r\n_setModalAreaClass(AreaWrangler);\r\n\r\nexport let contextWrangler = new AreaWrangler();\r\n", "\"use strict\";\r\n\r\n/**\r\n * Assorted geometry utility functions.\r\n *\r\n * This file was originally written in a modified form of ES6 way back in ~2010.\r\n * It was then transpiled to ES5 before being ported later to ES6.\r\n *\r\n * TODO: cleanup this file.\r\n */\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\n\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from './vectormath.js';\r\n\r\nlet dtvtmps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\n\r\nlet quad_co_rets2 = util.cachering.fromConstructor(Vector2, 512);\r\n\r\nexport function quad_bilinear(v1, v2, v3, v4, u, v) {\r\n  return -((v1 - v2)*u - v1 - (u*v1 - u*v2 + u*v3 - u*v4 - v1 + v4)*v);\r\n}\r\n\r\n/*\r\n\r\n on factor;\r\n off period;\r\n\r\n a1 := v1 + (v2 - v1) * u;\r\n a2 := v4 + (v3 - v4) * u;\r\n bilin := a1 + (a2 - a1) * v;\r\n\r\n v1x := 0;\r\n v1y := 0;\r\n\r\n bx := sub(v1=v1x, v2=v2x, v3=v3x, v4=v4x, bilin);\r\n by := sub(v1=v1y, v2=v2y, v3=v3y, v4=v4y, bilin);\r\n\r\n f1 := bx - x;\r\n f2 := by - y;\r\n\r\n ff := solve({f1, f2}, {u, v});\r\n\r\n */\r\nfunction quad_uv_2d(p, v1, v2, v3, v4) {\r\n  let u, v;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v3x = v3[0] - v1[0];\r\n  let v3y = v3[1] - v1[1];\r\n  let v4x = v4[0] - v1[0];\r\n  let v4y = v4[1] - v1[1];\r\n\r\n  let x = p[0] - v1[0];\r\n  let y = p[1] - v1[1];\r\n  let sqrt = Math.sqrt;\r\n\r\n  let A = 2*(((v4y + y)*x - 2*v4x*y)*\r\n      v3y + (v4x*y - v4y*x)*(v4y + y) - ((v4x - x)*v2y - v3x*y)*(v4y - y))*v2x - 2*(\r\n      (v4x*y - v4y*x)*(v4x + x) - (v4x - x)*v3y*x + ((2*v4y - y)*x - v4x*y)*v3x)*\r\n    v2y + (v4x*y - v4y*x + v3y*x - v3x*y)**2 + (v4x - x)**2*v2y**2 + (v4y - y)**2*\r\n    v2x**2;\r\n\r\n  let B = v4x*y - v4y*x + v3y*x - v3x*y;\r\n\r\n  let C1 = (2*(v3x - v4x)*v2y - 2*(v3y - v4y)*v2x);\r\n  let C2 = (2*(v3x*v4y - v3y*v4x + v2y*v4x) - 2*v2x*v4y);\r\n\r\n  let u1, u2;\r\n\r\n  if (A < 0.0) {\r\n    console.log(\"A was < 0\", A);\r\n    A = -A;\r\n    C1 = C2 = 0.0;\r\n  }\r\n\r\n  if (Math.abs(C1) < 0.00001) { //perfectly 90 degrees?\r\n    let dx = v2x;\r\n    let dy = v2y;\r\n\r\n    console.log(\"C1 bad\");\r\n\r\n    let l = Math.sqrt(dx*dx + dy*dy);\r\n    if (l > 0.000001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    u1 = u2 = dx*x + dy*y;\r\n  } else {\r\n    u1 = (-(B + sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n    u2 = (-(B - sqrt(A) - (v4y - y)*v2x) - (v4x - x)*v2y)/C1;\r\n  }\r\n\r\n  if (Math.abs(C2) < 0.00001) { //perfectly 90 degrees?\r\n    let dx, dy;\r\n\r\n    dx = v3x - v2x;\r\n    dy = v3y - v2y;\r\n\r\n    console.log(\"C2 bad\");\r\n\r\n    let l = Math.sqrt(dx**2 + dy**2);\r\n    if (l > 0.00001) {\r\n      dx /= l*l;\r\n      dy /= l*l;\r\n    }\r\n\r\n    v1 = v2 = x*dx + y*dy;\r\n  } else {\r\n    v1 = (-(B - sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n    v2 = (-(B + sqrt(A) + (v4y + y)*v2x) + (v4x + x)*v2y)/C2;\r\n  }\r\n\r\n  let ret = quad_co_rets2.next();\r\n\r\n  let d1 = (u1 - 0.5)**2 + (v1 - 0.5)**2;\r\n  let d2 = (u2 - 0.5)**2 + (v2 - 0.5)**2;\r\n\r\n  if (d1 < d2) {\r\n    ret[0] = u1;\r\n    ret[1] = v1;\r\n  } else {\r\n    ret[0] = u2;\r\n    ret[1] = v2;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n\r\nexport const ClosestModes = {\r\n  CLOSEST  : 0,\r\n  START    : 1,\r\n  END      : 2,\r\n  ENDPOINTS: 3,\r\n  ALL      : 4\r\n};\r\n\r\nlet advs = util.cachering.fromConstructor(Vector4, 128);\r\n\r\nexport class AbstractCurve {\r\n  evaluate(t) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  derivative(t) {\r\n  }\r\n\r\n  curvature(t) {\r\n\r\n  }\r\n\r\n  normal(t) {\r\n\r\n  }\r\n\r\n  width(t) {\r\n\r\n  }\r\n}\r\n\r\nexport class ClosestCurveRets {\r\n  constructor() {\r\n    this.p = new Vector3();\r\n    this.t = 0;\r\n  }\r\n}\r\n\r\nlet cvrets = util.cachering.fromConstructor(ClosestCurveRets, 2048);\r\nlet cvarrays = new util.ArrayPool();\r\nlet cvtmp = new Array(1024);\r\n\r\nexport function closestPoint(p, curve, mode) {\r\n  let steps = 5;\r\n  let s = 0, ds = 1.0/steps;\r\n\r\n  let ri = 0;\r\n\r\n  for (let i = 0; i < steps; i++, s += ds) {\r\n    let c1 = curve.evaluate(s);\r\n    let c2 = curve.evaluate(s + ds);\r\n\r\n\r\n  }\r\n}\r\n\r\nlet poly_normal_tmps = util.cachering.fromConstructor(Vector3, 64);\r\nlet pncent = new Vector3();\r\n\r\nexport function normal_poly(vs) {\r\n  if (vs.length === 3) {\r\n    return poly_normal_tmps.next().load(normal_tri(vs[0], vs[1], vs[2]));\r\n  } else if (vs.length === 4) {\r\n    return poly_normal_tmps.next().load(normal_quad(vs[0], vs[1], vs[2], vs[3]));\r\n  }\r\n\r\n  if (vs.length === 0) {\r\n    return poly_normal_tmps.next().zero();\r\n  }\r\n\r\n  let cent = pncent.zero();\r\n  let tot = 0;\r\n\r\n  for (let v of vs) {\r\n    cent.add(v);\r\n    tot++;\r\n  }\r\n\r\n  cent.mulScalar(1.0/tot);\r\n  let n = poly_normal_tmps.next().zero();\r\n\r\n  for (let i = 0; i < vs.length; i++) {\r\n    let a = vs[i];\r\n    let b = vs[(i + 1)%vs.length];\r\n    let c = cent;\r\n\r\n    let n2 = normal_tri(a, b, c);\r\n    n.add(n2);\r\n  }\r\n\r\n  n.normalize();\r\n  return n;\r\n}\r\n\r\n/*\r\non factor;\r\noff period;\r\n\r\nf1 := u*v1x + v*v2x + (1.0-u-v)*v3x - px;\r\nf2 := u*v1y + v*v2y + (1.0-u-v)*v3y - py;\r\n\r\nff := solve({f1, f2}, {u, v});\r\n\r\non fort;\r\npart(ff, 1, 1);\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n*/\r\n\r\nlet barycentric_v2_rets = util.cachering.fromConstructor(Vector2, 2048);\r\nlet calc_proj_refs = new util.cachering(() => [0, 0], 64);\r\n\r\n/*\r\n  a b c d\r\n     b\r\n\r\n  a------c\r\n\r\n     d\r\n\r\n  on factor;\r\n  load_package avector;\r\n\r\n  ax := 0;\r\n  ay := 0;\r\n  az := 0;\r\n\r\n  a := avec(ax, ay, az);\r\n  b := avec(bx, by, bz);\r\n  c := avec(cx, cy, cz);\r\n  d := avec(dx, dy, dz);\r\n\r\n  n1 := d cross c;\r\n  n2 := c cross b;\r\n\r\n  n1 := n1 / (VMOD n1);\r\n  n2 := n2 / (VMOD n2);\r\n\r\n  d := n1 dot n2;\r\n  on fort;\r\n\r\n  d*d;\r\n\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n/**\r\n\r\n v2\r\n\r\n v1------v3\r\n\r\n v4\r\n\r\n */\r\nexport function dihedral_v3_sqr(v1, v2, v3, v4) {\r\n  let bx = v2[0] - v1[0];\r\n  let by = v2[1] - v1[1];\r\n  let bz = v2[2] - v1[2];\r\n\r\n  let cx = v3[0] - v1[0];\r\n  let cy = v3[1] - v1[1];\r\n  let cz = v3[2] - v1[2];\r\n\r\n  let dx = v4[0] - v1[0];\r\n  let dy = v4[1] - v1[1];\r\n  let dz = v4[2] - v1[2];\r\n\r\n\r\n  return ((bx*cz - bz*cx)*(cx*dz - cz*dx) + (by*cz - bz*cy)*(cy*dz - cz*dy) + (bx*cy - by*cx)*\r\n    (cx*dy - cy*dx))**2/(((bx*cz - bz*cx)**2 + (by*cz - bz*cy)**2\r\n    + (bx*cy - by*cx)**2)*((cx*dz - cz*dx)**2 + (cy*dz - cz*dy)**2 + (cx*dy - cy*dx)**2));\r\n}\r\n\r\nlet tet_area_tmps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tet_volume(a, b, c, d) {\r\n  a = tet_area_tmps.next().load(a);\r\n  b = tet_area_tmps.next().load(b);\r\n  c = tet_area_tmps.next().load(c);\r\n  d = tet_area_tmps.next().load(d);\r\n\r\n  a.sub(d);\r\n  b.sub(d);\r\n  c.sub(d);\r\n\r\n  b.cross(c);\r\n  return a.dot(b)/6.0;\r\n}\r\n\r\nexport function calc_projection_axes(no) {\r\n  let ax = Math.abs(no[0]), ay = Math.abs(no[1]), az = Math.abs(no[2]);\r\n\r\n  let ret = calc_proj_refs.next();\r\n\r\n  if (ax > ay && ax > az) {\r\n    ret[0] = 1;\r\n    ret[1] = 2;\r\n  } else if (ay > az && ay > ax) {\r\n    ret[0] = 0;\r\n    ret[1] = 2;\r\n  } else {\r\n    ret[0] = 0;\r\n    ret[1] = 1;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _avtmps = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction inrect_3d(p, min, max) {\r\n  let ok = p[0] >= min[0] && p[0] <= max[0];\r\n  ok = ok && p[1] >= min[1] && p[1] <= max[1];\r\n  ok = ok && p[2] >= min[2] && p[2] <= max[2];\r\n\r\n  return ok;\r\n}\r\n\r\nexport function aabb_isect_line_3d(v1, v2, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  return inrect_3d(p, min, max);\r\n}\r\n\r\nexport function aabb_isect_cylinder_3d(v1, v2, radius, min, max) {\r\n  let inside = inrect_3d(v1, min, max);\r\n  inside = inside || inrect_3d(v2, min, max);\r\n\r\n  if (inside) {\r\n    return true;\r\n  }\r\n\r\n  let cent = _avtmps.next().load(min).interp(max, 0.5);\r\n\r\n  let p = closest_point_on_line(cent, v1, v2, true);\r\n  if (!p) {\r\n    return false;\r\n  }\r\n\r\n  p = p[0];\r\n\r\n  let size = _avtmps.next().load(max).sub(min);\r\n\r\n  size.mulScalar(0.5);\r\n  size.addScalar(radius); //*(3**0.5));\r\n\r\n  p.sub(cent).abs();\r\n\r\n  return p[0] <= size[0] && p[1] <= size[1] && p[2] <= size[2];\r\n}\r\n\r\nexport function barycentric_v2(p, v1, v2, v3, axis1 = 0, axis2 = 1, out = undefined) {\r\n  let div = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*v1[axis1] - (v2[axis1] - v3[axis1])*v1[axis2]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    div = 0.00001;\r\n  }\r\n\r\n  let u = (v2[axis1]*v3[axis2] - v2[axis2]*v3[axis1] + (v2[axis2] - v3[axis2])*p[axis1] - (v2[axis1] - v3[axis1])*p[axis2])/div;\r\n  let v = (-(v1[axis1]*v3[axis2] - v1[axis2]*v3[axis1] + (v1[axis2] - v3[axis2])*p[axis1]) + (v1[axis1] - v3[axis1])*p[axis2])/div;\r\n\r\n  if (!out) {\r\n    out = barycentric_v2_rets.next();\r\n  }\r\n\r\n  out[0] = u;\r\n  out[1] = v;\r\n\r\n  return out;\r\n}\r\n\r\n/*\r\n\r\non factor;\r\n\r\nload_package \"avector\";\r\n\r\npx := 0;\r\npy := 0;\r\npz := 0;\r\n\r\nv1 := avec(v1x, v1y, v1z);\r\nv2 := avec(v2x, v2y, v2z);\r\np := avec(px, py, pz);\r\n\r\nt1 := p - v1;\r\nt2 := v2 - v1;\r\n\r\nl1 := t2 / VMOD t2;\r\n\r\nt := dot(t1, t2);\r\n\r\np2 := v1 + t2*t;\r\n\r\non fort;\r\ndot(p2, p2);\r\noff fort;\r\n\r\n**/\r\n\r\nfunction _linedis2(co, v1, v2) {\r\n  let v1x = v1[0] - co[0];\r\n  let v1y = v1[1] - co[1];\r\n  let v1z = v1[2] - co[2];\r\n\r\n  let v2x = v2[0] - co[0];\r\n  let v2y = v2[1] - co[1];\r\n  let v2z = v2[2] - co[2];\r\n\r\n  let dis = (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1y - v2y) - v1y)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1z - v2z) - v1z)**2 +\r\n    (((v1y - v2y)*v1y + (v1z - v2z)*v1z + (v1x - v2x)*v1x)*(v1x - v2x) - v1x)**2;\r\n\r\n  return dis;\r\n}\r\n\r\nlet closest_p_tri_rets = new util.cachering(() => {\r\n  return {\r\n    co  : new Vector3(),\r\n    uv  : new Vector2(),\r\n    dist: 0\r\n  }\r\n}, 512);\r\n\r\nlet cpt_v1 = new Vector3();\r\nlet cpt_v2 = new Vector3();\r\nlet cpt_v3 = new Vector3();\r\nlet cpt_v4 = new Vector3();\r\nlet cpt_v5 = new Vector3();\r\nlet cpt_v6 = new Vector3();\r\nlet cpt_p = new Vector3();\r\nlet cpt_n = new Vector3();\r\nlet cpt_mat = new Matrix4();\r\nlet cpt_mat2 = new Matrix4();\r\nlet cpt_b = new Vector3();\r\n\r\nexport function closest_point_on_quad(p, v1, v2, v3, v4, n, uvw) {\r\n  let a = closest_point_on_tri(p, v1, v2, v3, n, uvw);\r\n  let b = closest_point_on_tri(p, v1, v3, v4, n, uvw);\r\n\r\n  return a.dist <= b.dist ? a : b;\r\n}\r\n\r\nexport function closest_point_on_tri(p, v1, v2, v3, n, uvw) {\r\n  let op = p;\r\n\r\n  if (uvw) {\r\n    uvw[0] = uvw[1] = 0.0;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = 0.0;\r\n    }\r\n  }\r\n\r\n  v1 = cpt_v1.load(v1);\r\n  v2 = cpt_v2.load(v2);\r\n  v3 = cpt_v3.load(v3);\r\n  p = cpt_p.load(p);\r\n\r\n  if (n === undefined) {\r\n    n = cpt_n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  v1.sub(p);\r\n  v2.sub(p);\r\n  v3.sub(p);\r\n  p.zero();\r\n\r\n\r\n  /*use least squares to solve for barycentric coordinates\r\n    then clip to triangle\r\n\r\n    we do this in 2d, as all solutions are coplanar anyway and that way we\r\n    can have one of the equations be \"u+v+w = 1\".\r\n    should investigate if this is really necassary.\r\n   */\r\n\r\n  let ax1, ax2;\r\n  let ax = Math.abs(n[0]), ay = Math.abs(n[1]), az = Math.abs(n[2]);\r\n  if (ax === 0.0 && ay === 0.0 && az === 0.0) {\r\n    console.log(\"eek1\", n, v1, v2, v3);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  let ax3;\r\n  if (ax >= ay && ax >= az) {\r\n    ax1 = 1;\r\n    ax2 = 2;\r\n    ax3 = 0;\r\n  } else if (ay >= ax && ay >= az) {\r\n    ax1 = 0;\r\n    ax2 = 2;\r\n    ax3 = 1;\r\n  } else {\r\n    ax1 = 0;\r\n    ax2 = 1;\r\n    ax3 = 2;\r\n  }\r\n\r\n  let mat = cpt_mat;\r\n  let mat2 = cpt_mat2;\r\n  mat.makeIdentity();\r\n\r\n  let m = mat.$matrix;\r\n\r\n  m.m11 = v1[ax1];\r\n  m.m12 = v2[ax1];\r\n  m.m13 = v3[ax1];\r\n  m.m14 = 0.0;\r\n\r\n  m.m21 = v1[ax2];\r\n  m.m22 = v2[ax2];\r\n  m.m23 = v3[ax2];\r\n  m.m24 = 0.0;\r\n\r\n  /*\r\n  m.m31 = v1[ax3];\r\n  m.m32 = v2[ax3];\r\n  m.m33 = v3[ax3];\r\n  m.m34 = 0.0;\r\n  */\r\n\r\n  m.m31 = 1;\r\n  m.m32 = 1;\r\n  m.m33 = 1;\r\n  m.m34 = 0.0;\r\n\r\n  mat.transpose();\r\n\r\n  let b = cpt_b.zero();\r\n\r\n  b[0] = p[ax1];\r\n  b[1] = p[ax2];\r\n  //b[2] = p[ax3];\r\n  b[2] = 1.0;\r\n  b[3] = 0.0;\r\n\r\n  mat2.load(mat).transpose();\r\n\r\n  mat.preMultiply(mat2);\r\n\r\n  if (mat.invert() === null) {\r\n    console.log(\"eek2\", mat.determinant(), ax1, ax2, n);\r\n    let ret = closest_p_tri_rets.next();\r\n\r\n    ret.dist = 1e17;\r\n    ret.co.zero();\r\n    ret.uv.zero();\r\n\r\n    return ret;\r\n  }\r\n\r\n  mat.multiply(mat2);\r\n\r\n\r\n  b.multVecMatrix(mat);\r\n\r\n  let u = b[0];\r\n  let v = b[1];\r\n  let w = b[2];\r\n\r\n  for (let i = 0; i < 1; i++) {\r\n    u = Math.min(Math.max(u, 0.0), 1.0);\r\n    v = Math.min(Math.max(v, 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let tot = u + v + w;\r\n\r\n    if (tot !== 0.0) {\r\n      tot = 1.0/tot;\r\n      u *= tot;\r\n      v *= tot;\r\n      w *= tot;\r\n    }\r\n  }\r\n\r\n  if (uvw) {\r\n    uvw[0] = u;\r\n    uvw[1] = v;\r\n    if (uvw.length > 2) {\r\n      uvw[2] = w;\r\n    }\r\n  }\r\n\r\n  let x = v1[0]*u + v2[0]*v + v3[0]*w;\r\n  let y = v1[1]*u + v2[1]*v + v3[1]*w;\r\n  let z = v1[2]*u + v2[2]*v + v3[2]*w;\r\n\r\n  let ret = closest_p_tri_rets.next();\r\n\r\n  ret.co.loadXYZ(x, y, z);\r\n  ret.uv[0] = u;\r\n  ret.uv[1] = v;\r\n\r\n  ret.dist = ret.co.vectorLength();\r\n  ret.co.add(op);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function dist_to_tri_v3_old(co, v1, v2, v3, no = undefined) {\r\n  if (!no) {\r\n    no = dtvtmps.next().load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  let p = dtvtmps.next().load(co);\r\n  p.sub(v1);\r\n\r\n  let planedis = -p.dot(no);\r\n\r\n  let [axis, axis2] = calc_projection_axes(no);\r\n\r\n  let p1 = dtvtmps.next();\r\n  let p2 = dtvtmps.next();\r\n  let p3 = dtvtmps.next();\r\n\r\n  p1[0] = v1[axis];\r\n  p1[1] = v1[axis2];\r\n  p1[2] = 0.0;\r\n\r\n  p2[0] = v2[axis];\r\n  p2[1] = v2[axis2];\r\n  p2[2] = 0.0;\r\n\r\n  p3[0] = v3[axis];\r\n  p3[1] = v3[axis2];\r\n  p3[2] = 0.0;\r\n\r\n  let pp = dtvtmps.next();\r\n  pp[0] = co[axis];\r\n  pp[1] = co[axis2];\r\n  pp[2] = 0.0;\r\n\r\n  let dis = 1e17;\r\n\r\n  function linedis2d(a, b, c) {\r\n    let dx1 = a[0] - b[0];\r\n    let dy1 = a[1] - b[1];\r\n    let dx2 = c[0] - b[0];\r\n    let dy2 = c[1] - b[1];\r\n\r\n    let len = dx2*dx2 + dy2*dy2;\r\n    len = len > 0.000001 ? 1.0/len : 0.0;\r\n\r\n    dx2 *= len;\r\n    dy2 *= len;\r\n\r\n    return Math.abs(dx1*dy2 - dx2*dy1);\r\n  }\r\n\r\n  let tmp = dtvtmps.next();\r\n  let tmp2 = dtvtmps.next();\r\n\r\n  function linedis3d(a, b, c) {\r\n    tmp.load(a).sub(b);\r\n    tmp2.load(c).sub(b).normalize();\r\n\r\n    let t = tmp.dot(tmp2);\r\n    t = Math.min(Math.max(t, 0.0), b.vectorDistance(c));\r\n\r\n    tmp2.mulScalar(t).add(b);\r\n\r\n    return tmp2.vectorDistance(a);\r\n  }\r\n\r\n\r\n  /* are we above the triangle? if so use plane distance */\r\n  if (point_in_tri(pp, p1, p2, p3)) {\r\n    return Math.abs(planedis);\r\n  }\r\n\r\n  /* get distance to the closest edge */\r\n  dis = Math.min(dis, linedis3d(co, v1, v2));\r\n  dis = Math.min(dis, linedis3d(co, v2, v3));\r\n  dis = Math.min(dis, linedis3d(co, v3, v1));\r\n\r\n  if (0) {\r\n    let uv = barycentric_v2(pp, p1, p2, p3);\r\n\r\n    let w = 1.0 - uv[0] - uv[1];\r\n    uv[0] = Math.min(Math.max(uv[0], 0.0), 1.0);\r\n    uv[1] = Math.min(Math.max(uv[1], 0.0), 1.0);\r\n    w = Math.min(Math.max(w, 0.0), 1.0);\r\n\r\n    let sum = (uv[0] + uv[1] + w);\r\n    sum = sum !== 0.0 ? 1.0/sum : 0.0;\r\n\r\n    w *= sum;\r\n    uv[0] *= sum;\r\n    uv[1] *= sum;\r\n\r\n    pp.zero();\r\n\r\n    pp.addFac(v1, uv[0]);\r\n    pp.addFac(v2, uv[1]);\r\n    pp.addFac(v3, 1.0 - uv[0] - uv[1]);\r\n\r\n    dis = Math.min(dis, pp.vectorDistance(co));\r\n  }\r\n\r\n  return dis;\r\n}\r\n\r\n\r\nexport function dist_to_tri_v3(p, v1, v2, v3, n) {\r\n  return dist_to_tri_v3_old(p, v1, v2, v3, n);\r\n  //return Math.sqrt(Math.abs(dist_to_tri_v3_sqr(p, v1, v2, v3, n)));\r\n}\r\n\r\n\r\n/* reduce script\r\n\r\non factor;\r\n\r\nax := 0;\r\nay := 0;\r\n\r\ne1x := bx - ax;\r\ne1y := by - ay;\r\ne2x := cx - bx;\r\ne2y := cy - by;\r\ne3x := ax - cx;\r\ne3y := ay - cy;\r\n\r\nl1 := (e1x**2 + e1y**2)**0.5;\r\nl2 := (e2x**2 + e2y**2)**0.5;\r\nl3 := (e3x**2 + e3y**2)**0.5;\r\n\r\nload_package \"avector\";\r\n\r\ne1 := avec(e1x / l1, e1y / l1, 0.0);\r\ne2 := avec(e2x / l2, e2y / l2, 0.0);\r\ne3 := avec(e3x / l3, e3y / l3, 0.0);\r\n\r\nd1 := x1*e1[1] - y1*e1[0];\r\nd2 := x1*e2[1] - y1*e2[0];\r\nd3 := x1*e3[1] - y1*e3[0];\r\n\r\nd1 := d1**2;\r\nd2 := d2**2;\r\nd3 := d3**2;\r\n\r\non fort;\r\nd1;\r\nd2;\r\nd3;\r\noff fort;\r\n\r\n*/\r\n\r\nlet _dt3s_n = new Vector3();\r\n\r\nexport function dist_to_tri_v3_sqr(p, v1, v2, v3, n) {\r\n  if (n === undefined) {\r\n    n = _dt3s_n;\r\n    n.load(normal_tri(v1, v2, v3));\r\n  }\r\n\r\n  // find projection axis;\r\n  let axis1, axis2, axis3;\r\n  let nx = n[0] < 0.0 ? -n[0] : n[0];\r\n  let ny = n[1] < 0.0 ? -n[1] : n[1];\r\n  let nz = n[2] < 0.0 ? -n[2] : n[2];\r\n\r\n  const feps = 0.0000001;\r\n\r\n  if (nx > ny && nx > nz) {\r\n    axis1 = 1;\r\n    axis2 = 2;\r\n    axis3 = 0;\r\n  } else if (ny > nx && ny > nz) {\r\n    axis1 = 0;\r\n    axis2 = 2;\r\n    axis3 = 1;\r\n  } else {\r\n    axis1 = 0;\r\n    axis2 = 1;\r\n    axis3 = 2;\r\n  }\r\n\r\n  //n.load(normal_tri(v1, v2, v3));\r\n\r\n  let planedis = (p[0] - v1[0])*n[0] + (p[1] - v1[1])*n[1] + (p[2] - v1[2])*n[2];\r\n  planedis = planedis < 0.0 ? -planedis : planedis;\r\n\r\n  let ax = v1[axis1], ay = v1[axis2], az = v1[axis3];\r\n\r\n  let bx = v2[axis1] - ax, by = v2[axis2] - ay, bz = v2[axis3] - az;\r\n  let cx = v3[axis1] - ax, cy = v3[axis2] - ay, cz = v3[axis3] - az;\r\n\r\n  let bx2 = bx*bx, by2 = by*by, bz2 = bz*bz, cx2 = cx*cx, cy2 = cy*cy, cz2 = cz*cz;\r\n\r\n  let x1 = p[axis1] - ax;\r\n  let y1 = p[axis2] - ay;\r\n  let z1 = p[axis3] - az;\r\n\r\n  const testf = 0.0;\r\n\r\n  let l1 = Math.sqrt(bx**2 + by**2);\r\n  let l2 = Math.sqrt((cx - bx)**2 + (cy - by)**2);\r\n  let l3 = Math.sqrt(cx**2 + cy**2);\r\n\r\n  let s1 = x1*by - y1*bx < testf;\r\n  let s2 = (x1 - bx)*(cy - by) - (y1 - by)*(cx - bx) < testf;\r\n  let s3 = (x1* -cy + y1*cx) < testf;\r\n\r\n  /*\r\n    (x1-cx)*-cy - (y1-cy)*-cx\r\n   reduces to:\r\n     x1*-cy + y1*cx;\r\n   */\r\n\r\n  //console.log(axis1, axis2, axis3, n);\r\n  //console.log(s1, s2, s3);\r\n  //console.log(bx, by, cx, cy);\r\n\r\n  if (1 && n[axis3] < 0.0) {\r\n    s1 = !s1;\r\n    s2 = !s2;\r\n    s3 = !s3;\r\n    /*\r\n        bx = v3[axis1];\r\n        by = v3[axis2];\r\n        bz = v3[axis3];\r\n\r\n        cx = v2[axis1];\r\n        cy = v2[axis2];\r\n        cz = v2[axis3];\r\n\r\n        bx2 = bx*bx;\r\n        by2 = by*by;\r\n        bz2 = bz*bz;\r\n\r\n        cx2 = cx*cx;\r\n        cy2 = cy*cy;\r\n        cz2 = cz*cz;*/\r\n  }\r\n\r\n  let mask = (s1 & 1) | (s2<<1) | (s3<<2);\r\n  if (mask === 0 || mask === 7) {\r\n    return planedis*planedis;\r\n  }\r\n\r\n  let d1, d2, d3, div;\r\n\r\n\r\n  /*\r\n//\\  3|\r\n//  \\ |\r\n//    b\r\n//    | \\\r\n//  1 |   \\  2\r\n//    |  0  \\\r\n// ___a_______c___\r\n//  5 |   4      \\ 6\r\n*/\r\n\r\n  let dis = 0.0;\r\n  let lx, ly, lz;\r\n\r\n  lx = bx;\r\n  ly = by;\r\n  lz = bz;\r\n\r\n  nx = n[axis1];\r\n  ny = n[axis2];\r\n  nz = n[axis3];\r\n\r\n  switch (mask) {\r\n    case 1:\r\n      div = (bx2 + by2);\r\n\r\n      if (div > feps) {\r\n        d1 = (bx*y1 - by*x1);\r\n        d1 = (d1*d1)/div;\r\n\r\n        lx = -by;\r\n        ly = bx;\r\n        lz = bz;\r\n      } else {\r\n        d1 = x1*x1 + y1*y1;\r\n\r\n        lx = x1;\r\n        ly = y1;\r\n        lz = z1;\r\n      }\r\n\r\n      dis = d1;\r\n      break;\r\n    case 3:\r\n      lx = x1 - bx;\r\n      ly = y1 - by;\r\n      lz = z1 - bz;\r\n\r\n      dis = lx*lx + ly*ly;\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 2:\r\n      div = (bx - cx)**2 + (by - cy)**2;\r\n\r\n      if (div > feps) {\r\n        d2 = ((bx - cx)*y1 - (by - cy)*x1);\r\n        d2 = d2/div;\r\n\r\n        lx = (by - cy);\r\n        ly = (cx - bx);\r\n        lz = cz - bz;\r\n      } else {\r\n        d2 = (x1 - bx)*(x1 - bx) + (y1 - by)*(y1 - by);\r\n\r\n        lx = x1 - bx;\r\n        ly = y1 - by;\r\n        lz = z1 - bz;\r\n      }\r\n\r\n      dis = d2;\r\n      break;\r\n    case 6:\r\n      lx = x1 - cx;\r\n      ly = y1 - cy;\r\n      lz = z1 - cz;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n    case 4:\r\n      div = (cx2 + cy2);\r\n\r\n      if (div > feps) {\r\n        d3 = (cx*y1 - cy*x1);\r\n        d3 = (d3*d3)/div;\r\n\r\n        lx = cy;\r\n        ly = -cx;\r\n        lz = cz;\r\n      } else {\r\n        d3 = (x1 - cx)*(x1 - cx) + (y1 - cy)*(y1 - cy);\r\n\r\n        lx = x1 - cx;\r\n        ly = y1 - cy;\r\n        lz = z1 - cz;\r\n      }\r\n\r\n      dis = d3;\r\n      break;\r\n    case 5:\r\n      lx = x1;\r\n      ly = y1;\r\n      lz = z1;\r\n\r\n      return lx*lx + ly*ly + lz*lz;\r\n  }\r\n\r\n  //lx = p[axis1] - v1[axis1];\r\n  //ly = p[axis2] - v1[axis2];\r\n  {\r\n    let d = lx*nx + ly*ny + lz*nz;\r\n\r\n    d = -d;\r\n\r\n    lx += nx*d;\r\n    ly += ny*d;\r\n    lz += nz*d;\r\n\r\n    //dis = lx*lx + ly*ly;\r\n\r\n    if (0 && Math.random() > 0.999) {\r\n      console.log(\"d\", d.toFixed(6));\r\n      console.log(lx*nx + ly*ny + lz*nz);\r\n    }\r\n  }\r\n\r\n  let mul = ((lx**2 + ly**2)*nz**2 + (lx*nx + ly*ny)**2)/((lx**2 + ly**2)*nz**2);\r\n  //let mul = ((lx**2+ly**2)*nz**2+(lx*nx+ly*ny)**2)/((ly**2+lz**2+lx**2)*nz**2);\r\n\r\n  //mul = 1.0 / nz;\r\n  //mul *= mul;\r\n\r\n  if (Math.random() > 0.999) {\r\n    console.log(mul.toFixed(4));\r\n  }\r\n\r\n  //mul = 1.0;\r\n\r\n  if (0) {\r\n    let odis = dis;\r\n\r\n    dis = x1**2 + y1**2 + z1**2;\r\n\r\n    if (Math.random() > 0.999) {\r\n      console.log((dis/odis).toFixed(4), mul.toFixed(4));\r\n    }\r\n    mul = 1.0;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n\r\n  dx := sqrt(dis)*(lx / sqrt(lx**2 + ly**2));\r\n  dy := sqrt(dis)*(ly / sqrt(lx**2 + ly**2));\r\n  f2 := dx*nx + dy*ny + dz*nz;\r\n\r\n  fz := solve(f2, dz);\r\n  fz := part(fz, 1, 2);\r\n\r\n  dis2 := dx*dx + dy*dy + fz*fz;\r\n  fmul := dis2/dis;\r\n\r\n  on fort;\r\n  fmul;\r\n  off fort;\r\n\r\n\r\n  */\r\n\r\n  return dis*mul + planedis*planedis;\r\n}\r\n\r\nlet tri_area_temps = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function tri_area(v1, v2, v3) {\r\n  let l1 = v1.vectorDistance(v2);\r\n  let l2 = v2.vectorDistance(v3);\r\n  let l3 = v3.vectorDistance(v1);\r\n\r\n  let s = (l1 + l2 + l3)/2.0;\r\n  s = s*(s - l1)*(s - l2)*(s - l3);\r\n  s = Math.max(s, 0); /* Numerical error can dip into negative numbers. */\r\n  return Math.sqrt(s);\r\n}\r\n\r\nexport function aabb_overlap_area(pos1, size1, pos2, size2) {\r\n  let r1 = 0.0, r2 = 0.0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    let a1 = pos1[i], a2 = pos2[i];\r\n    let b1 = pos1[i] + size1[i];\r\n    let b2 = pos2[i] + size2[i];\r\n\r\n    if (b1 >= a2 && b2 >= a1) {\r\n      let r = Math.abs(a2 - b1);\r\n      r = Math.min(r, Math.abs(a1 - b2));\r\n\r\n      if (i) {\r\n        r2 = r;\r\n      } else {\r\n        r1 = r;\r\n      }\r\n    }\r\n  }\r\n\r\n  return r1*r2;\r\n}\r\n\r\n/**\r\n * Returns true if two aabbs intersect\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\n\r\nexport function aabb_isect_2d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n  for (let i = 0; i < 2; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 2;\r\n};\r\n\r\n\r\nexport function aabb_isect_3d(pos1, size1, pos2, size2) {\r\n  let ret = 0;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    let a = pos1[i];\r\n    let b = pos1[i] + size1[i];\r\n\r\n    let c = pos2[i];\r\n    let d = pos2[i] + size2[i];\r\n\r\n    if (b >= c && a <= d)\r\n      ret += 1;\r\n  }\r\n  return ret === 3;\r\n}\r\n\r\n\r\nlet aabb_intersect_vs = util.cachering.fromConstructor(Vector2, 32);\r\nlet aabb_intersect_rets = new util.cachering(() => {\r\n  return {\r\n    pos : new Vector2(),\r\n    size: new Vector2()\r\n  }\r\n}, 512);\r\n\r\n/**\r\n * Returns aabb that's the intersection of two aabbs\r\n * @param {*} pos1\r\n * @param {*} size1\r\n * @param {*} pos2\r\n * @param {*} size2\r\n */\r\nexport function aabb_intersect_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next().load(pos1);\r\n  let v2 = aabb_intersect_vs.next().load(pos1).add(size1);\r\n  let v3 = aabb_intersect_vs.next().load(pos2);\r\n  let v4 = aabb_intersect_vs.next().load(pos2).add(size2);\r\n\r\n  let min = aabb_intersect_vs.next().zero();\r\n  let max = aabb_intersect_vs.next().zero();\r\n\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (v2[i] >= v3[i] && v1[i] <= v4[i]) {\r\n      tot++;\r\n\r\n      min[i] = Math.max(v3[i], v1[i]);\r\n      max[i] = Math.min(v2[i], v4[i]);\r\n    }\r\n  }\r\n\r\n  if (tot !== 2) {\r\n    return undefined;\r\n  }\r\n\r\n  let ret = aabb_intersect_rets.next();\r\n  ret.pos.load(min);\r\n  ret.size.load(max).sub(min);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.test_aabb_intersect_2d = function () {\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n\r\n  if (!canvas) {\r\n    canvas = document.createElement(\"canvas\");\r\n    canvas.setAttribute(\"id\", \"test_canvas\");\r\n    canvas.g = canvas.getContext(\"2d\");\r\n\r\n    document.body.appendChild(canvas);\r\n  }\r\n\r\n  canvas.width = ~~(window.innerWidth*devicePixelRatio);\r\n  canvas.height = ~~(window.innerHeight*devicePixelRatio);\r\n  canvas.style.width = (canvas.width/devicePixelRatio) + \"px\";\r\n  canvas.style.height = (canvas.height/devicePixelRatio) + \"px\";\r\n  canvas.style.position = \"absolute\";\r\n  canvas.style[\"z-index\"] = \"1000\";\r\n\r\n  let g = canvas.g;\r\n  g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  let sz = 800;\r\n  let a1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let a2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b1 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n  let b2 = new Vector2([Math.random()*sz, Math.random()*sz]).floor();\r\n\r\n  let p1 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  p1.load(a1).min(a2);\r\n  s1.load(a1).max(a2);\r\n  p2.load(b1).min(b2);\r\n  s2.load(b1).max(b2);\r\n\r\n  s1.sub(p1);\r\n  s2.sub(p1);\r\n\r\n  console.log(p1, s1);\r\n  console.log(p2, s2);\r\n\r\n  g.beginPath();\r\n  g.rect(0, 0, canvas.width, canvas.height);\r\n  g.fillStyle = \"white\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p1[0], p1[1], s1[0], s1[1]);\r\n  g.fillStyle = \"rgba(255, 100, 75, 1.0)\";\r\n  g.fill();\r\n\r\n  g.beginPath();\r\n  g.rect(p2[0], p2[1], s2[0], s2[1]);\r\n  g.fillStyle = \"rgba(75, 100, 255, 1.0)\";\r\n  g.fill();\r\n\r\n  let ret = aabb_intersect_2d(p1, s1, p2, s2);\r\n\r\n  if (ret) {\r\n\r\n    g.beginPath();\r\n    g.rect(ret.pos[0], ret.pos[1], ret.size[0], ret.size[1]);\r\n    g.fillStyle = \"rgba(0, 0, 0, 1.0)\";\r\n    g.fill();\r\n  }\r\n\r\n  /*\r\n  window.setTimeout(() => {\r\n    canvas.remove();\r\n  }, 2000);\r\n  //*/\r\n\r\n  return {\r\n    end  : test_aabb_intersect_2d.end,\r\n    timer: test_aabb_intersect_2d.timer\r\n  };\r\n}\r\n\r\ntest_aabb_intersect_2d.stop = function stop() {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    console.log(\"stopping timer\");\r\n\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n  }\r\n}\r\n\r\ntest_aabb_intersect_2d.end = function end() {\r\n  test_aabb_intersect_2d.stop();\r\n\r\n  let canvas = document.getElementById(\"test_canvas\");\r\n  if (canvas) {\r\n    canvas.remove();\r\n  }\r\n}\r\ntest_aabb_intersect_2d.timer = function timer(rate = 500) {\r\n  if (test_aabb_intersect_2d._timer) {\r\n    window.clearInterval(test_aabb_intersect_2d._timer);\r\n    test_aabb_intersect_2d._timer = undefined;\r\n    console.log(\"stopping timer\");\r\n    return;\r\n  }\r\n\r\n  console.log(\"starting timer\");\r\n\r\n  test_aabb_intersect_2d._timer = window.setInterval(() => {\r\n    test_aabb_intersect_2d();\r\n  }, rate);\r\n};\r\n\r\nlet aabb_intersect_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_intersect_3d(min1, max1, min2, max2) {\r\n  let tot = 0;\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    if (max1[i] >= min2[i] && min1[i] <= max2[i]) {\r\n      tot++;\r\n    }\r\n  }\r\n\r\n  if (tot !== 3) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * AABB union of a and b.\r\n * Result is in a.\r\n *\r\n * @param a List of two vectors\r\n * @param b List of two vectors\r\n * @returns a\r\n */\r\nexport function aabb_union(a, b) {\r\n  for (let i = 0; i < 2; i++) {\r\n    for (let j = 0; j < a[i].length; j++) {\r\n      a[i][j] = i ? Math.max(a[i][j], b[i][j]) : Math.min(a[i][j], b[i][j]);\r\n    }\r\n  }\r\n\r\n  return a;\r\n}\r\n\r\nexport function aabb_union_2d(pos1, size1, pos2, size2) {\r\n  let v1 = aabb_intersect_vs.next();\r\n  let v2 = aabb_intersect_vs.next();\r\n  let min = aabb_intersect_vs.next();\r\n  let max = aabb_intersect_vs.next();\r\n  v1.load(pos1).add(size1);\r\n  v2.load(pos2).add(size2);\r\n\r\n  min.load(v1).min(v2);\r\n  max.load(v1).max(v2);\r\n\r\n  max.sub(min);\r\n  let ret = aabb_intersect_rets.next();\r\n\r\n  ret.pos.load(min);\r\n  ret.pos.load(max);\r\n\r\n  return ret;\r\n}\r\n\r\n//XXX refactor to use es6 classes,\r\n//    or at last the class system in typesystem.js\r\nfunction init_prototype(cls, proto) {\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nfunction inherit(cls, parent, proto) {\r\n  cls.prototype = Object.create(parent.prototype);\r\n\r\n  for (let k in proto) {\r\n    cls.prototype[k] = proto[k];\r\n  }\r\n\r\n  return cls.prototype;\r\n}\r\n\r\nlet set = util.set;\r\n\r\n//everything below here was compiled from es6 code  \r\n//variables starting with $ are function static local vars,\r\n//like in C.  don't use them outside their owning functions.\r\n//\r\n//except for $_mh and $_swapt.  they were used with a C macro\r\n//preprocessor.\r\nlet $_mh, $_swapt;\r\n\r\n//XXX destroy me\r\nexport const feps = 2.22e-16;\r\n\r\nexport const COLINEAR = 1;\r\nexport const LINECROSS = 2;\r\nexport const COLINEAR_ISECT = 3;\r\n\r\nlet _cross_vec1 = new Vector3();\r\nlet _cross_vec2 = new Vector3();\r\n\r\nexport const SQRT2 = Math.sqrt(2.0);\r\nexport const FEPS_DATA = {\r\n  F16: 1.11e-16,\r\n  F32: 5.96e-08,\r\n  F64: 4.88e-04\r\n};\r\n\r\n/*use 32 bit epsilon by default, since we're often working from\r\n  32-bit float data.  note that javascript uses 64-bit doubles \r\n  internally.*/\r\nexport const FEPS = FEPS_DATA.F32;\r\nexport const FLOAT_MIN = -1e+21;\r\nexport const FLOAT_MAX = 1e+22;\r\nexport const Matrix4UI = Matrix4;\r\n\r\n/*\r\nThis must be truly ancient code, possibly from\r\nallshape days.\r\n\r\nif (FLOAT_MIN != FLOAT_MIN || FLOAT_MAX != FLOAT_MAX) {\r\n  FLOAT_MIN = 1e-05;\r\n  FLOAT_MAX = 1000000.0;\r\n  console.log(\"Floating-point 16-bit system detected!\");\r\n}\r\n*/\r\n\r\nlet _static_grp_points4 = new Array(4);\r\nlet _static_grp_points8 = new Array(8);\r\n\r\nexport function get_rect_points(p, size) {\r\n  let cs;\r\n  if (p.length === 2) {\r\n    cs = _static_grp_points4;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n    cs[3] = [p[0], p[1] + size[1]];\r\n  } else if (p.length === 3) {\r\n    cs = _static_grp_points8;\r\n    cs[0] = p;\r\n    cs[1] = [p[0] + size[0], p[1], p[2]];\r\n    cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n    cs[3] = [p[0], p[1] + size[0], p[2]];\r\n    cs[4] = [p[0], p[1], p[2] + size[2]];\r\n    cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n    cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n    cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n  return cs;\r\n};\r\n\r\nexport function get_rect_lines(p, size) {\r\n  let ps = get_rect_points(p, size);\r\n  if (p.length === 2) {\r\n    return [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n  } else if (p.length === 3) {\r\n    let l1 = [[ps[0], ps[1]], [ps[1], ps[2]], [ps[2], ps[3]], [ps[3], ps[0]]];\r\n    let l2 = [[ps[4], ps[5]], [ps[5], ps[6]], [ps[6], ps[7]], [ps[7], ps[4]]];\r\n    l1.concat(l2);\r\n    l1.push([ps[0], ps[4]]);\r\n    l1.push([ps[1], ps[5]]);\r\n    l1.push([ps[2], ps[6]]);\r\n    l1.push([ps[3], ps[7]]);\r\n    return l1;\r\n  } else {\r\n    throw \"get_rect_points has no implementation for \" + p.length + \"-dimensional data\";\r\n  }\r\n};\r\n\r\nlet $vs_simple_tri_aabb_isect = [0, 0, 0];\r\n\r\nexport function simple_tri_aabb_isect(v1, v2, v3, min, max) {\r\n  $vs_simple_tri_aabb_isect[0] = v1;\r\n  $vs_simple_tri_aabb_isect[1] = v2;\r\n  $vs_simple_tri_aabb_isect[2] = v3;\r\n  for (let i = 0; i < 3; i++) {\r\n    let isect = true;\r\n    for (let j = 0; j < 3; j++) {\r\n      if ($vs_simple_tri_aabb_isect[j][i] < min[i] || $vs_simple_tri_aabb_isect[j][i] >= max[i])\r\n        isect = false;\r\n    }\r\n    if (isect)\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport class MinMax {\r\n  constructor(totaxis) {\r\n    if (totaxis === undefined) {\r\n      totaxis = 1;\r\n    }\r\n    this.totaxis = totaxis;\r\n    if (totaxis !== 1) {\r\n      let cls;\r\n\r\n      switch (totaxis) {\r\n        case 2:\r\n          cls = Vector2;\r\n          break;\r\n        case 3:\r\n          cls = Vector3;\r\n          break;\r\n        case 4:\r\n          cls = Vector4;\r\n          break;\r\n        default:\r\n          cls = Array;\r\n          break;\r\n      }\r\n\r\n      this._min = new cls(totaxis);\r\n      this._max = new cls(totaxis);\r\n      this.min = new cls(totaxis);\r\n      this.max = new cls(totaxis);\r\n    } else {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    }\r\n    this.reset();\r\n    this._static_mr_co = new Array(this.totaxis);\r\n    this._static_mr_cs = new Array(this.totaxis*this.totaxis);\r\n  }\r\n\r\n  static fromSTRUCT(reader) {\r\n    let ret = new MinMax();\r\n    reader(ret);\r\n    return ret;\r\n  }\r\n\r\n  load(mm) {\r\n    if (this.totaxis === 1) {\r\n      this.min = mm.min;\r\n      this.max = mm.max;\r\n      this._min = mm.min;\r\n      this._max = mm.max;\r\n    } else {\r\n      this.min = new Vector3(mm.min);\r\n      this.max = new Vector3(mm.max);\r\n      this._min = new Vector3(mm._min);\r\n      this._max = new Vector3(mm._max);\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    let totaxis = this.totaxis;\r\n    if (totaxis === 1) {\r\n      this.min = this.max = 0;\r\n      this._min = FLOAT_MAX;\r\n      this._max = FLOAT_MIN;\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = FLOAT_MAX;\r\n        this._max[i] = FLOAT_MIN;\r\n        this.min[i] = 0;\r\n        this.max[i] = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  minmax_rect(p, size) {\r\n    let totaxis = this.totaxis;\r\n    let cs = this._static_mr_cs;\r\n    if (totaxis === 2) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1]];\r\n      cs[3] = [p[0], p[1] + size[1]];\r\n    } else if (totaxis = 3) {\r\n      cs[0] = p;\r\n      cs[1] = [p[0] + size[0], p[1], p[2]];\r\n      cs[2] = [p[0] + size[0], p[1] + size[1], p[2]];\r\n      cs[3] = [p[0], p[1] + size[0], p[2]];\r\n      cs[4] = [p[0], p[1], p[2] + size[2]];\r\n      cs[5] = [p[0] + size[0], p[1], p[2] + size[2]];\r\n      cs[6] = [p[0] + size[0], p[1] + size[1], p[2] + size[2]];\r\n      cs[7] = [p[0], p[1] + size[0], p[2] + size[2]];\r\n    } else {\r\n      throw \"Minmax.minmax_rect has no implementation for \" + totaxis + \"-dimensional data\";\r\n    }\r\n    for (let i = 0; i < cs.length; i++) {\r\n      this.minmax(cs[i]);\r\n    }\r\n  }\r\n\r\n  minmax(p) {\r\n    let totaxis = this.totaxis;\r\n\r\n    if (totaxis === 1) {\r\n      this._min = this.min = Math.min(this._min, p);\r\n      this._max = this.max = Math.max(this._max, p);\r\n    } else if (totaxis === 2) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n    } else if (totaxis === 3) {\r\n      this._min[0] = this.min[0] = Math.min(this._min[0], p[0]);\r\n      this._min[1] = this.min[1] = Math.min(this._min[1], p[1]);\r\n      this._min[2] = this.min[2] = Math.min(this._min[2], p[2]);\r\n      this._max[0] = this.max[0] = Math.max(this._max[0], p[0]);\r\n      this._max[1] = this.max[1] = Math.max(this._max[1], p[1]);\r\n      this._max[2] = this.max[2] = Math.max(this._max[2], p[2]);\r\n    } else {\r\n      for (let i = 0; i < totaxis; i++) {\r\n        this._min[i] = this.min[i] = Math.min(this._min[i], p[i]);\r\n        this._max[i] = this.max[i] = Math.max(this._max[i], p[i]);\r\n      }\r\n    }\r\n  }\r\n};\r\nMinMax.STRUCT = \"\\n  math.MinMax {\\n    min     : vec3;\\n    max     : vec3;\\n    _min    : vec3;\\n    _max    : vec3;\\n    totaxis : int;\\n  }\\n\";\r\n\r\nexport function winding_axis(a, b, c, up_axis) {\r\n  let xaxis = (up_axis + 1)%3;\r\n  let yaxis = (up_axis + 2)%3;\r\n\r\n  let x1 = a[xaxis], y1 = a[yaxis];\r\n  let x2 = b[xaxis], y2 = b[yaxis];\r\n  let x3 = c[xaxis], y3 = c[yaxis];\r\n\r\n  let dx1 = x1 - x2, dy1 = y1 - y2;\r\n  let dx2 = x3 - x2, dy2 = y3 - y2;\r\n\r\n  let f = dx1*dy2 - dy1*dx2;\r\n  return f >= 0.0;\r\n}\r\n\r\n/** returns false if clockwise */\r\nexport function winding(a, b, c, zero_z = false, tol = 0.0) {\r\n  let dx1 = b[0] - a[0];\r\n  let dy1 = b[1] - a[1];\r\n  let dx2 = c[0] - a[0];\r\n  let dy2 = c[1] - a[1];\r\n\r\n  return dx1*dy2 - dy1*dx2 > tol;\r\n}\r\n\r\nexport function inrect_2d(p, pos, size) {\r\n  if (p === undefined || pos === undefined || size === undefined) {\r\n    console.trace();\r\n    console.log(\"Bad paramters to inrect_2d()\");\r\n    console.log(\"p: \", p, \", pos: \", pos, \", size: \", size);\r\n    return false;\r\n  }\r\n  return p[0] >= pos[0] && p[0] <= pos[0] + size[0] && p[1] >= pos[1] && p[1] <= pos[1] + size[1];\r\n}\r\n\r\nlet $ps_aabb_isect_line_2d = [new Vector2(), new Vector2(), new Vector2(), new Vector2()];\r\n\r\nexport function aabb_isect_line_2d(v1, v2, min, max) {\r\n  if (point_in_aabb_2d(v1, min, max) || point_in_aabb(v2, min, max)) {\r\n    return true;\r\n  }\r\n\r\n  let lines = $ps_aabb_isect_line_2d;\r\n  lines[0][0] = min[0];\r\n  lines[0][1] = min[1];\r\n\r\n  lines[1][0] = min[0];\r\n  lines[1][1] = max[1];\r\n\r\n  lines[2][0] = max[0];\r\n  lines[2][1] = max[1];\r\n\r\n  lines[3][0] = max[0];\r\n  lines[3][1] = min[1];\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (line_line_cross(v1, v2, lines[i], lines[(i + 1)%4])) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n\r\nexport function expand_rect2d(pos, size, margin) {\r\n  pos[0] -= Math.floor(margin[0]);\r\n  pos[1] -= Math.floor(margin[1]);\r\n  size[0] += Math.floor(margin[0]*2.0);\r\n  size[1] += Math.floor(margin[1]*2.0);\r\n};\r\n\r\nexport function expand_line(l, margin) {\r\n  let c = new Vector3();\r\n  c.add(l[0]);\r\n  c.add(l[1]);\r\n  c.mulScalar(0.5);\r\n  l[0].sub(c);\r\n  l[1].sub(c);\r\n  let l1 = l[0].vectorLength();\r\n  let l2 = l[1].vectorLength();\r\n  l[0].normalize();\r\n  l[1].normalize();\r\n  l[0].mulScalar(margin + l1);\r\n  l[1].mulScalar(margin + l2);\r\n  l[0].add(c);\r\n  l[1].add(c);\r\n  return l;\r\n}\r\n\r\nexport function colinear(a, b, c, limit = 2.2e-16, distLimit = 0.00001**2) {\r\n  let t1 = _cross_vec1;\r\n  let t2 = _cross_vec2;\r\n\r\n  let axes = a.length;\r\n\r\n  for (let i = 0; i < axes; i++) {\r\n    t1[i] = b[i] - a[i];\r\n    t2[i] = c[i] - a[i];\r\n  }\r\n\r\n  for (let i = axes; i < 3; i++) {\r\n    t1[i] = t2[i] = 0.0;\r\n  }\r\n\r\n  if (t1.dot(t1) <= distLimit || t2.dot(t2) <= distLimit) {\r\n    return true;\r\n  }\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n\r\n  t1.cross(t2);\r\n  return t1.dot(t1) <= limit;\r\n}\r\n\r\nexport function colinear2d(a, b, c, limit = 0.00001, precise = false) {\r\n  let dx1 = a[0] - b[0];\r\n  let dy1 = a[1] - b[1];\r\n  let dx2 = c[0] - b[0];\r\n  let dy2 = c[1] - b[1];\r\n\r\n  let det = Math.abs(dx1*dy2 - dy1*dx2);\r\n  if (precise) {\r\n    let len = (dx1**2 + dy1**2)**0.5 + (dx2**2 + dy2**2)**0.5;\r\n    if (len <= 0.00001) {\r\n      return true;\r\n    }\r\n\r\n    det /= len;\r\n  }\r\n\r\n  return det <= limit;\r\n}\r\n\r\nlet _llc_l1 = [new Vector3(), new Vector3()];\r\nlet _llc_l2 = [new Vector3(), new Vector3()];\r\nlet _llc_l3 = [new Vector3(), new Vector3()];\r\nlet _llc_l4 = [new Vector3(), new Vector3()];\r\n\r\nlet lli_v1 = new Vector3(), lli_v2 = new Vector3(), lli_v3 = new Vector3(), lli_v4 = new Vector3();\r\n\r\nlet _zero_cn = new Vector3();\r\nlet _tmps_cn = util.cachering.fromConstructor(Vector3, 64);\r\nlet _rets_cn = util.cachering.fromConstructor(Vector3, 64);\r\n\r\n//vec1, vec2 should both be normalized\r\nexport function corner_normal(vec1, vec2, width) {\r\n  let ret = _rets_cn.next().zero();\r\n\r\n  let vec = _tmps_cn.next().zero();\r\n  vec.load(vec1).add(vec2).normalize();\r\n\r\n  /*\r\n  ret.load(vec).mulScalar(width);\r\n  return ret;\r\n  */\r\n\r\n  //handle colinear case\r\n  if (Math.abs(vec1.normalizedDot(vec2)) > 0.9999) {\r\n    if (vec1.dot(vec2) > 0.0001) {\r\n      ret.load(vec1).add(vec2).normalize();\r\n    } else {\r\n      ret.load(vec1).normalize();\r\n    }\r\n\r\n    ret.mulScalar(width);\r\n\r\n    return ret;\r\n  } else { //XXX\r\n    //ret.load(vec).mulScalar(width);\r\n    //return ret;\r\n  }\r\n\r\n  vec1 = _tmps_cn.next().load(vec1).mulScalar(width);\r\n  vec2 = _tmps_cn.next().load(vec2).mulScalar(width);\r\n\r\n  let p1 = _tmps_cn.next().load(vec1);\r\n  let p2 = _tmps_cn.next().load(vec2);\r\n\r\n  vec1.addFac(vec1, 0.01);\r\n  vec2.addFac(vec2, 0.01);\r\n\r\n  let sc = 1.0;\r\n\r\n  p1[0] += vec1[1]*sc;\r\n  p1[1] += -vec1[0]*sc;\r\n\r\n  p2[0] += -vec2[1]*sc;\r\n  p2[1] += vec2[0]*sc;\r\n\r\n  let p = line_line_isect(vec1, p1, vec2, p2, false);\r\n\r\n  if (p === undefined || p === COLINEAR_ISECT || p.dot(p) < 0.000001) {\r\n    ret.load(vec1).add(vec2).normalize().mulScalar(width);\r\n  } else {\r\n    ret.load(p);\r\n\r\n    if (vec.dot(vec) > 0 && vec.dot(ret) < 0) {\r\n      ret.load(vec).mulScalar(width);\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//test_segment is optional, true\r\nexport function line_line_isect(v1, v2, v3, v4, test_segment = true) {\r\n  if (test_segment && !line_line_cross(v1, v2, v3, v4)) {\r\n    return undefined;\r\n  }\r\n\r\n  /*\r\n  on factor;\r\n  off period;\r\n  \r\n  xa := xa1 + (xa2 - xa1)*t1;\r\n  xb := xb1 + (xb2 - xb1)*t2;\r\n  ya := ya1 + (ya2 - ya1)*t1;\r\n  yb := yb1 + (yb2 - yb1)*t2;\r\n  \r\n  f1 := xa - xb;\r\n  f2 := ya - yb;\r\n  \r\n  f := solve({f1, f2}, {t1, t2});\r\n  ft1 := part(f, 1, 1, 2);\r\n  ft2 := part(f, 1, 2, 2);\r\n  \r\n  */\r\n\r\n  let xa1 = v1[0], xa2 = v2[0], ya1 = v1[1], ya2 = v2[1];\r\n  let xb1 = v3[0], xb2 = v4[0], yb1 = v3[1], yb2 = v4[1];\r\n\r\n  let div = ((xa1 - xa2)*(yb1 - yb2) - (xb1 - xb2)*(ya1 - ya2));\r\n  if (Math.abs(div) < 0.00000001) { //parallel but intersecting lines.\r\n    return COLINEAR_ISECT;\r\n  } else { //intersection exists\r\n    let t1 = (-((ya1 - yb2)*xb1 - (yb1 - yb2)*xa1 - (ya1 - yb1)*xb2))/div;\r\n\r\n    return lli_v1.load(v1).interp(v2, t1);\r\n  }\r\n}\r\n\r\nexport function line_line_cross(a, b, c, d) {\r\n  /*\r\n  let limit=feps*1000;\r\n  if (Math.abs(l1[0].vectorDistance(l2[0])+l1[1].vectorDistance(l2[0])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l1[0].vectorDistance(l2[1])+l1[1].vectorDistance(l2[1])-l1[0].vectorDistance(l1[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[0])+l2[1].vectorDistance(l1[0])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  if (Math.abs(l2[0].vectorDistance(l1[1])+l2[1].vectorDistance(l1[1])-l2[0].vectorDistance(l2[1]))<limit) {\r\n      return true;\r\n  }\r\n  //*/\r\n\r\n  let w1 = winding(a, b, c);\r\n  let w2 = winding(c, a, d);\r\n  let w3 = winding(a, b, d);\r\n  let w4 = winding(c, b, d);\r\n  return (w1 === w2) && (w3 === w4) && (w1 !== w3);\r\n};\r\n\r\nlet _asi_v1 = new Vector3();\r\nlet _asi_v2 = new Vector3();\r\nlet _asi_v3 = new Vector3();\r\nlet _asi_v4 = new Vector3();\r\nlet _asi_v5 = new Vector3();\r\nlet _asi_v6 = new Vector3();\r\n\r\nexport function point_in_aabb_2d(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1];\r\n}\r\n\r\nlet _asi2d_v1 = new Vector2();\r\nlet _asi2d_v2 = new Vector2();\r\nlet _asi2d_v3 = new Vector2();\r\nlet _asi2d_v4 = new Vector2();\r\nlet _asi2d_v5 = new Vector2();\r\nlet _asi2d_v6 = new Vector2();\r\n\r\nexport function aabb_sphere_isect_2d(p, r, min, max) {\r\n  let v1 = _asi2d_v1, v2 = _asi2d_v2, v3 = _asi2d_v3, mvec = _asi2d_v4;\r\n  let v4 = _asi2d_v5;\r\n\r\n  p = _asi2d_v6.load(p);\r\n  v1.load(p);\r\n  v2.load(p);\r\n\r\n  min = _asi_v5.load(min);\r\n  max = _asi_v6.load(max);\r\n\r\n  mvec.load(max).sub(min).normalize().mulScalar(r + 0.0001);\r\n\r\n  v1.sub(mvec);\r\n  v2.add(mvec);\r\n  v3.load(p);\r\n\r\n  let ret = point_in_aabb_2d(v1, min, max) || point_in_aabb_2d(v2, min, max)\r\n    || point_in_aabb_2d(v3, min, max);\r\n\r\n  if (ret)\r\n    return ret;\r\n\r\n  /*\r\n  v1.load(min).add(max).mulScalar(0.5);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(min);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1.load(max);\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = min[0], v1[1] = max[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  \r\n  v1[0] = max[0], v1[1] = min[1];\r\n  ret = ret || v1.vectorDistance(p) < r;\r\n  */\r\n  //*\r\n  v1.load(min);\r\n  v2[0] = min[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = max[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = max[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n\r\n  v1.load(max);\r\n  v2[0] = min[0];\r\n  v2[1] = min[1];\r\n  ret = ret || dist_to_line_2d(p, v1, v2) < r;\r\n  //*/\r\n  return ret;\r\n};\r\n\r\nexport function point_in_aabb(p, min, max) {\r\n  return p[0] >= min[0] && p[0] <= max[0] && p[1] >= min[1] && p[1] <= max[1]\r\n    && p[2] >= min[2] && p[2] <= max[2];\r\n}\r\n\r\nlet asi_rect = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  asi_rect[i] = new Vector3();\r\n}\r\n\r\nlet aabb_sphere_isect_vs = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function aabb_sphere_isect(p, r, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  r *= r;\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return true;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    if (p.vectorDistanceSqr(rect[i]) < r) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let isect = p2.vectorDistanceSqr(p) <= r;\r\n\r\n    if (isect) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport function aabb_sphere_dist(p, min, max) {\r\n  {\r\n    let p1 = aabb_sphere_isect_vs.next().load(p);\r\n    let min1 = aabb_sphere_isect_vs.next().load(min);\r\n    let max1 = aabb_sphere_isect_vs.next().load(max);\r\n    if (p.length === 2) {\r\n      p1[2] = 0.0;\r\n    }\r\n    if (min1.length === 2) {\r\n      min1[2] = 0.0;\r\n    }\r\n    if (max.length === 2) {\r\n      max1[2] = 0.0;\r\n    }\r\n\r\n    p = p1;\r\n    min = min1;\r\n    max = max1;\r\n  }\r\n\r\n  let cent = aabb_sphere_isect_vs.next().load(min).interp(max, 0.5);\r\n  p.sub(cent);\r\n  min.sub(cent);\r\n  max.sub(cent);\r\n\r\n  let isect = point_in_aabb(p, min, max);\r\n\r\n  if (isect) {\r\n    return 0.0;\r\n  }\r\n\r\n  let rect = asi_rect;\r\n\r\n  rect[0].loadXYZ(min[0], min[1], min[2]);\r\n  rect[1].loadXYZ(min[0], max[1], min[2]);\r\n  rect[2].loadXYZ(max[0], max[1], min[2]);\r\n  rect[3].loadXYZ(max[0], min[1], min[2]);\r\n\r\n  rect[4].loadXYZ(min[0], min[1], max[2]);\r\n  rect[5].loadXYZ(min[0], max[1], max[2]);\r\n  rect[6].loadXYZ(max[0], max[1], max[2]);\r\n  rect[7].loadXYZ(max[0], min[1], max[2]);\r\n\r\n  let mindis;\r\n\r\n  for (let i = 0; i < 8; i++) {\r\n    let dis = p.vectorDistanceSqr(rect[i]);\r\n\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  let p2 = aabb_sphere_isect_vs.next().load(p);\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p2.load(p);\r\n\r\n    let i2 = (i + 1)%3;\r\n    let i3 = (i + 2)%3;\r\n\r\n    p2[i] = p2[i] < 0.0 ? min[i] : max[i];\r\n\r\n    p2[i2] = Math.min(Math.max(p2[i2], min[i2]), max[i2]);\r\n    p2[i3] = Math.min(Math.max(p2[i3], min[i3]), max[i3]);\r\n\r\n    let dis = p2.vectorDistanceSqr(p);\r\n    if (mindis === undefined || dis < mindis) {\r\n      mindis = dis;\r\n    }\r\n  }\r\n\r\n  return mindis === undefined ? 1e17 : mindis;\r\n};\r\n\r\nexport function point_in_tri(p, v1, v2, v3) {\r\n  let w1 = winding(p, v1, v2);\r\n  let w2 = winding(p, v2, v3);\r\n  let w3 = winding(p, v3, v1);\r\n  return w1 === w2 && w2 === w3;\r\n};\r\n\r\nexport function convex_quad(v1, v2, v3, v4) {\r\n  return line_line_cross([v1, v3], [v2, v4]);\r\n};\r\n\r\nlet $e1_normal_tri = new Vector3();\r\nlet $e3_normal_tri = new Vector3();\r\nlet $e2_normal_tri = new Vector3();\r\n\r\nexport function isNum(f) {\r\n  let ok = typeof f === \"number\";\r\n\r\n  ok = ok && !isNaN(f) && isFinite(f);\r\n\r\n  return ok;\r\n}\r\n\r\nconst _normal_tri_rets = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function normal_tri(v1, v2, v3) {\r\n  let x1 = v2[0] - v1[0];\r\n  let y1 = v2[1] - v1[1];\r\n  let z1 = v2[2] - v1[2];\r\n  let x2 = v3[0] - v1[0];\r\n  let y2 = v3[1] - v1[1];\r\n  let z2 = v3[2] - v1[2];\r\n\r\n  if (!isNum(x1 + y1 + z1 + z2 + y2 + z2)) {\r\n    throw new Error(\"NaN in normal_tri\");\r\n  }\r\n\r\n  let x3, y3, z3;\r\n\r\n  x1 = v2[0] - v1[0];\r\n  y1 = v2[1] - v1[1];\r\n  z1 = v2[2] - v1[2];\r\n  x2 = v3[0] - v1[0];\r\n  y2 = v3[1] - v1[1];\r\n  z2 = v3[2] - v1[2];\r\n  x3 = y1*z2 - z1*y2;\r\n  y3 = z1*x2 - x1*z2;\r\n  z3 = x1*y2 - y1*x2;\r\n\r\n  let len = Math.sqrt((x3*x3 + y3*y3 + z3*z3));\r\n\r\n  if (len > 1e-05)\r\n    len = 1.0/len;\r\n\r\n  x3 *= len;\r\n  y3 *= len;\r\n  z3 *= len;\r\n\r\n  let n = _normal_tri_rets.next();\r\n\r\n  if (!isNum(x3 + y3 + z3)) {\r\n    throw new Error(\"NaN!\");\r\n  }\r\n\r\n  n[0] = x3;\r\n  n[1] = y3;\r\n  n[2] = z3;\r\n\r\n  return n;\r\n};\r\n\r\nlet $n2_normal_quad = new Vector3();\r\n\r\nlet _q1 = new Vector3(), _q2 = new Vector3(), _q3 = new Vector3();\r\n\r\nexport function normal_quad(v1, v2, v3, v4) {\r\n  _q1.load(normal_tri(v1, v2, v3));\r\n  _q2.load(normal_tri(v2, v3, v4));\r\n\r\n  _q1.add(_q2).normalize();\r\n  return _q1;\r\n}\r\n\r\nexport function normal_quad_old(v1, v2, v3, v4) {\r\n  let n = normal_tri(v1, v2, v3);\r\n  $n2_normal_quad[0] = n[0];\r\n  $n2_normal_quad[1] = n[1];\r\n  $n2_normal_quad[2] = n[2];\r\n  n = normal_tri(v1, v3, v4);\r\n  $n2_normal_quad[0] = $n2_normal_quad[0] + n[0];\r\n  $n2_normal_quad[1] = $n2_normal_quad[1] + n[1];\r\n  $n2_normal_quad[2] = $n2_normal_quad[2] + n[2];\r\n  let _len = Math.sqrt(($n2_normal_quad[0]*$n2_normal_quad[0] + $n2_normal_quad[1]*$n2_normal_quad[1] + $n2_normal_quad[2]*$n2_normal_quad[2]));\r\n  if (_len > 1e-05)\r\n    _len = 1.0/_len;\r\n  $n2_normal_quad[0] *= _len;\r\n  $n2_normal_quad[1] *= _len;\r\n  $n2_normal_quad[2] *= _len;\r\n  return $n2_normal_quad;\r\n};\r\n\r\nlet _li_vi = new Vector3();\r\n\r\n//calc_t is optional, false\r\nexport function line_isect(v1, v2, v3, v4, calc_t) {\r\n  if (calc_t === undefined) {\r\n    calc_t = false;\r\n  }\r\n  let div = (v2[0] - v1[0])*(v4[1] - v3[1]) - (v2[1] - v1[1])*(v4[0] - v3[0]);\r\n  if (div === 0.0)\r\n    return [new Vector3(), COLINEAR, 0.0];\r\n  let vi = _li_vi;\r\n  vi[0] = 0;\r\n  vi[1] = 0;\r\n  vi[2] = 0;\r\n  vi[0] = ((v3[0] - v4[0])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[0] - v2[0])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  vi[1] = ((v3[1] - v4[1])*(v1[0]*v2[1] - v1[1]*v2[0]) - (v1[1] - v2[1])*(v3[0]*v4[1] - v3[1]*v4[0]))/div;\r\n  if (calc_t || v1.length === 3) {\r\n    let n1 = new Vector2(v2).sub(v1);\r\n    let n2 = new Vector2(vi).sub(v1);\r\n    let t = n2.vectorLength()/n1.vectorLength();\r\n    n1.normalize();\r\n    n2.normalize();\r\n    if (n1.dot(n2) < 0.0) {\r\n      t = -t;\r\n    }\r\n    if (v1.length === 3) {\r\n      vi[2] = v1[2] + (v2[2] - v1[2])*t;\r\n    }\r\n    return [vi, LINECROSS, t];\r\n  }\r\n  return [vi, LINECROSS];\r\n};\r\n\r\nlet dt2l_v1 = new Vector2();\r\nlet dt2l_v2 = new Vector2();\r\nlet dt2l_v3 = new Vector2();\r\nlet dt2l_v4 = new Vector2();\r\nlet dt2l_v5 = new Vector2();\r\n\r\nexport function dist_to_line_2d(p, v1, v2, clip = true, closest_co_out = undefined, t_out = undefined) {\r\n  v1 = dt2l_v4.load(v1);\r\n  v2 = dt2l_v5.load(v2);\r\n\r\n  let n = dt2l_v1;\r\n  let vec = dt2l_v3;\r\n\r\n  n.load(v2).sub(v1).normalize();\r\n  vec.load(p).sub(v1);\r\n\r\n  let t = vec.dot(n);\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), v1.vectorDistance(v2));\r\n  }\r\n\r\n  n.mulScalar(t).add(v1);\r\n\r\n  if (closest_co_out) {\r\n    closest_co_out[0] = n[0];\r\n    closest_co_out[1] = n[1];\r\n  }\r\n\r\n  if (t_out !== undefined) {\r\n    t_out = t;\r\n  }\r\n\r\n  return n.vectorDistance(p);\r\n}\r\n\r\nlet dt3l_v1 = new Vector3();\r\nlet dt3l_v2 = new Vector3();\r\nlet dt3l_v3 = new Vector3();\r\nlet dt3l_v4 = new Vector3();\r\nlet dt3l_v5 = new Vector3();\r\n\r\nexport function dist_to_line_sqr(p, v1, v2, clip = true) {\r\n  let px = p[0] - v1[0];\r\n  let py = p[1] - v1[1];\r\n  let pz = p.length < 3 ? 0.0 : p[2] - v1[2];\r\n\r\n  pz = pz === undefined ? 0.0 : pz;\r\n\r\n  let v2x = v2[0] - v1[0];\r\n  let v2y = v2[1] - v1[1];\r\n  let v2z = v2.length < 3 ? 0.0 : v2[2] - v1[2];\r\n\r\n  let len = v2x*v2x + v2y*v2y + v2z*v2z;\r\n\r\n  if (len === 0.0) {\r\n    return Math.sqrt(px*px + py*py + pz*pz);\r\n  }\r\n\r\n  let len2 = 1.0/len;\r\n  v2x *= len2;\r\n  v2y *= len2;\r\n  v2z *= len2;\r\n\r\n  let t = px*v2x + py*v2y + pz*v2z;\r\n  if (clip) {\r\n    t = Math.min(Math.max(t, 0.0), len);\r\n  }\r\n\r\n  v2x *= t;\r\n  v2y *= t;\r\n  v2z *= t;\r\n\r\n  return (v2x - px)*(v2x - px) + (v2y - py)*(v2y - py) + (v2z - pz)*(v2z - pz);\r\n}\r\n\r\nexport function dist_to_line(p, v1, v2, clip = true) {\r\n  return Math.sqrt(dist_to_line_sqr(p, v1, v2, clip));\r\n}\r\n\r\n//p cam be 2d, 3d, or 4d point, v1/v2 however must be full homogenous coordinates\r\nlet _cplw_vs4 = util.cachering.fromConstructor(Vector4, 64);\r\nlet _cplw_vs3 = util.cachering.fromConstructor(Vector3, 64);\r\nlet _cplw_vs2 = util.cachering.fromConstructor(Vector2, 64);\r\n\r\nfunction wclip(x1, x2, w1, w2, near) {\r\n  let r1 = near*w1 - x1;\r\n  let r2 = (w1 - w2)*near - (x1 - x2);\r\n\r\n  if (r2 === 0.0) return 0.0;\r\n\r\n  return r1/r2;\r\n}\r\n\r\nfunction clip(a, b, znear) {\r\n  if (a - b === 0.0) return 0.0;\r\n\r\n  return (a - znear)/(a - b);\r\n}\r\n\r\n/*clips v1 and v2 to lie within homogenous projection range\r\n  v1 and v2 are assumed to be projected, pre-division Vector4's\r\n  returns a positive number (how much the line was scaled) if either _v1 or _v2 are\r\n  in front of the near clipping plane otherwise, returns 0\r\n */\r\nexport function clip_line_w(_v1, _v2, znear, zfar) {\r\n  let v1 = _cplw_vs4.next().load(_v1);\r\n  let v2 = _cplw_vs4.next().load(_v2);\r\n\r\n  //are we fully behind the view plane?\r\n  if ((v1[2] < 1.0 && v2[2] < 1.0))\r\n    return false;\r\n\r\n  function doclip1(v1, v2, axis) {\r\n    if (v1[axis]/v1[3] < -1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], -1);\r\n      v1.interp(v2, t);\r\n    } else if (v1[axis]/v1[3] > 1) {\r\n      let t = wclip(v1[axis], v2[axis], v1[3], v2[3], 1);\r\n      v1.interp(v2, t);\r\n    }\r\n  }\r\n\r\n  function doclip(v1, v2, axis) {\r\n    doclip1(v1, v2, axis);\r\n    doclip1(v2, v1, axis);\r\n  }\r\n\r\n  function dozclip(v1, v2) {\r\n    if (v1[2] < 1) {\r\n      let t = clip(v1[2], v2[2], 1);\r\n      v1.interp(v2, t);\r\n    } else if (v2[2] < 1) {\r\n      let t = clip(v2[2], v1[2], 1);\r\n      v2.interp(v1, t);\r\n    }\r\n  }\r\n\r\n  dozclip(v1, v2, 1);\r\n  doclip(v1, v2, 0);\r\n  doclip(v1, v2, 1);\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    _v1[i] = v1[i];\r\n    _v2[i] = v2[i];\r\n  }\r\n\r\n  return !(v1[0]/v1[3] === v2[0]/v2[3] || v1[1]/v2[3] === v2[1]/v2[3]);\r\n};\r\n\r\n//clip is optional, true.  clip point to lie within line segment v1->v2\r\nlet _closest_point_on_line_cache = util.cachering.fromConstructor(Vector3, 64);\r\nlet _closest_point_rets = new util.cachering(function () {\r\n  return [0, 0];\r\n}, 64);\r\n\r\nlet _closest_tmps = [new Vector3(), new Vector3(), new Vector3()];\r\n\r\nexport function closest_point_on_line(p, v1, v2, clip = true) {\r\n  let l1 = _closest_tmps[0], l2 = _closest_tmps[1];\r\n  let len;\r\n\r\n\r\n  l1.load(v2).sub(v1);\r\n\r\n  if (clip) {\r\n    len = l1.vectorLength();\r\n  }\r\n\r\n  l1.normalize();\r\n  l2.load(p).sub(v1);\r\n\r\n  let t = l2.dot(l1);\r\n  if (clip) {\r\n    //t = t*(t<0.0) + t*(t>1.0) + (t>1.0);\r\n    t = t < 0.0 ? 0.0 : t;\r\n    t = t > len ? len : t;\r\n  }\r\n\r\n  let co = _closest_point_on_line_cache.next();\r\n  co.load(l1).mulScalar(t).add(v1);\r\n  let ret = _closest_point_rets.next();\r\n\r\n  ret[0] = co;\r\n  ret[1] = t;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n  \r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan_ret = new util.cachering(function () {\r\n  return [new Vector3(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan(a, b, t) {\r\n  let p1 = _circ_from_line_tan_vs.next();\r\n  let t2 = _circ_from_line_tan_vs.next();\r\n  let n1 = _circ_from_line_tan_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n  let r = -(ax*ax + ay*ay + az*az);\r\n  let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n  if (Math.abs(div) > 0.000001) {\r\n    r /= div;\r\n  } else {\r\n    r = 1000000.0;\r\n  }\r\n\r\n  let ret = _circ_from_line_tan_ret.next();\r\n  ret[0].load(n1).mulScalar(r).add(a)\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n}\r\n\r\n/*given input line (a,d) and tangent t,\r\n  returns a circle that goes through both\r\n  a and d, whose normalized tangent at a is the same\r\n  as normalized t.\r\n\r\n  note that t need not be normalized, this function\r\n  does that itself*/\r\nlet _circ_from_line_tan2d_vs = util.cachering.fromConstructor(Vector3, 32);\r\nlet _circ_from_line_tan2d_ret = new util.cachering(function () {\r\n  return [new Vector2(), 0];\r\n}, 64);\r\n\r\nexport function circ_from_line_tan_2d(a, b, t) {\r\n  a = _circ_from_line_tan2d_vs.next().load(a);\r\n  b = _circ_from_line_tan2d_vs.next().load(b);\r\n  t = _circ_from_line_tan2d_vs.next().load(t);\r\n\r\n  a[2] = b[2] = t[2] = 0.0;\r\n\r\n  let p1 = _circ_from_line_tan2d_vs.next();\r\n  let t2 = _circ_from_line_tan2d_vs.next();\r\n  let n1 = _circ_from_line_tan2d_vs.next();\r\n\r\n  p1.load(a).sub(b);\r\n  t2.load(t).normalize();\r\n  n1.load(p1).normalize().cross(t2).cross(t2).normalize();\r\n\r\n  if (1) {\r\n    let cx, cy, r;\r\n    let x1 = a[0], y1 = a[1];\r\n    let x2 = b[0], y2 = b[1];\r\n    let tanx1 = t[0], tany1 = t[1];\r\n\r\n    let div = (4.0*((x1 - x2)*tany1 - (y1 - y2)*tanx1)**2);\r\n    let div2 = (2.0*(x1 - x2)*tany1 - 2.0*(y1 - y2)*tanx1);\r\n\r\n    if (Math.abs(div) < 0.0001 || Math.abs(div2) < 0.0001) {\r\n      let ret = _circ_from_line_tan2d_ret.next();\r\n\r\n      ret[0].load(a).interp(b, 0.5);\r\n      let dx = a[1] - b[1];\r\n      let dy = b[0] - a[0];\r\n\r\n      r = 1000000.0;\r\n\r\n      ret[0][0] += dx*r;\r\n      ret[0][1] += dy*r;\r\n      ret[1] = r;\r\n\r\n      return ret;\r\n    }\r\n    cx = (((x1 + x2)*(x1 - x2) - (y1 - y2)**2)*tany1 - 2.0*(y1 - y2)*tanx1*x1\r\n    )/div2;\r\n\r\n    cy = (-((y1 + y2)*(y1 - y2) - x2**2 - (x1 - 2.0*x2)*x1)*tanx1 + 2.0*(x1 -\r\n      x2)*tany1*y1)/div2;\r\n\r\n    r = (((y1 - y2)**2 + x2**2 + (x1 - 2.0*x2)*x1)**2*(tanx1**2 + tany1**2)\r\n    )/div;\r\n\r\n    let midx = a[0]*0.5 + b[0]*0.5;\r\n    let midy = a[1]*0.5 + b[1]*0.5;\r\n\r\n    //mirror\r\n    cx = 2.0*midx - cx;\r\n    cy = 2.0*midy - cy;\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].loadXY(cx, cy);\r\n    ret[1] = Math.sqrt(r);\r\n\r\n    return ret;\r\n  } else {\r\n    let ax = p1[0], ay = p1[1], az = p1[2], nx = n1[0], ny = n1[1], nz = n1[2];\r\n    let r = -(ax*ax + ay*ay + az*az);\r\n    let div = (2*(ax*nx + ay*ny + az*nz));\r\n\r\n    if (Math.abs(div) > 0.000001) {\r\n      r /= div;\r\n    } else {\r\n      r = 1000000.0;\r\n    }\r\n\r\n    let ret = _circ_from_line_tan2d_ret.next();\r\n    ret[0].load(n1).mulScalar(r).add(a)\r\n    ret[1] = r;\r\n\r\n    return ret;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nlet _gtc_e1 = new Vector3();\r\nlet _gtc_e2 = new Vector3();\r\nlet _gtc_e3 = new Vector3();\r\nlet _gtc_p1 = new Vector3();\r\nlet _gtc_p2 = new Vector3();\r\nlet _gtc_v1 = new Vector3();\r\nlet _gtc_v2 = new Vector3();\r\nlet _gtc_p12 = new Vector3();\r\nlet _gtc_p22 = new Vector3();\r\nlet _get_tri_circ_ret = new util.cachering(function () {\r\n  return [0, 0]\r\n});\r\n\r\nexport function get_tri_circ(a, b, c) {\r\n  let v1 = _gtc_v1;\r\n  let v2 = _gtc_v2;\r\n  let e1 = _gtc_e1;\r\n  let e2 = _gtc_e2;\r\n  let e3 = _gtc_e3;\r\n  let p1 = _gtc_p1;\r\n  let p2 = _gtc_p2;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    e1[i] = b[i] - a[i];\r\n    e2[i] = c[i] - b[i];\r\n    e3[i] = a[i] - c[i];\r\n  }\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    p1[i] = (a[i] + b[i])*0.5;\r\n    p2[i] = (c[i] + b[i])*0.5;\r\n  }\r\n\r\n  e1.normalize();\r\n\r\n  v1[0] = -e1[1];\r\n  v1[1] = e1[0];\r\n  v1[2] = e1[2];\r\n\r\n  v2[0] = -e2[1];\r\n  v2[1] = e2[0];\r\n  v2[2] = e2[2];\r\n\r\n  v1.normalize();\r\n  v2.normalize();\r\n\r\n  let cent;\r\n  let type;\r\n  for (let i = 0; i < 3; i++) {\r\n    _gtc_p12[i] = p1[i] + v1[i];\r\n    _gtc_p22[i] = p2[i] + v2[i];\r\n  }\r\n\r\n  let isect = line_isect(p1, _gtc_p12, p2, _gtc_p22);\r\n  cent = isect[0];\r\n  type = isect[1];\r\n\r\n  e1.load(a);\r\n  e2.load(b);\r\n  e3.load(c);\r\n\r\n  let r = e1.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e2.sub(cent).vectorLength();\r\n  if (r < feps)\r\n    r = e3.sub(cent).vectorLength();\r\n\r\n  let ret = _get_tri_circ_ret.next();\r\n  ret[0] = cent;\r\n  ret[1] = r;\r\n\r\n  return ret;\r\n};\r\n\r\nexport function gen_circle(m, origin, r, stfeps) {\r\n  let pi = Math.PI;\r\n  let f = -pi/2;\r\n  let df = (pi*2)/stfeps;\r\n  let verts = new Array();\r\n  for (let i = 0; i < stfeps; i++) {\r\n    let x = origin[0] + r*Math.sin(f);\r\n    let y = origin[1] + r*Math.cos(f);\r\n    let v = m.make_vert(new Vector3([x, y, origin[2]]));\r\n    verts.push(v);\r\n    f += df;\r\n  }\r\n  for (let i = 0; i < verts.length; i++) {\r\n    let v1 = verts[i];\r\n    let v2 = verts[(i + 1)%verts.length];\r\n    m.make_edge(v1, v2);\r\n  }\r\n  return verts;\r\n};\r\n\r\nlet cos = Math.cos;\r\nlet sin = Math.sin;\r\n\r\n//axis is optional, 0\r\nexport function rot2d(v1, A, axis) {\r\n  let x = v1[0];\r\n  let y = v1[1];\r\n\r\n  if (axis === 1) {\r\n    v1[0] = x*cos(A) + y*sin(A);\r\n    v1[2] = y*cos(A) - x*sin(A);\r\n  } else {\r\n    v1[0] = x*cos(A) - y*sin(A);\r\n    v1[1] = y*cos(A) + x*sin(A);\r\n  }\r\n}\r\n\r\nexport function makeCircleMesh(gl, radius, stfeps) {\r\n  let mesh = new Mesh();\r\n  let verts1 = gen_circle(mesh, new Vector3(), radius, stfeps);\r\n  let verts2 = gen_circle(mesh, new Vector3(), radius/1.75, stfeps);\r\n  mesh.make_face_complex([verts1, verts2]);\r\n  return mesh;\r\n};\r\n\r\nexport function minmax_verts(verts) {\r\n  let min = new Vector3([1000000000000.0, 1000000000000.0, 1000000000000.0]);\r\n  let max = new Vector3([-1000000000000.0, -1000000000000.0, -1000000000000.0]);\r\n  let __iter_v = __get_iter(verts);\r\n  let v;\r\n  while (1) {\r\n    let __ival_v = __iter_v.next();\r\n    if (__ival_v.done) {\r\n      break;\r\n    }\r\n    v = __ival_v.value;\r\n    for (let i = 0; i < 3; i++) {\r\n      min[i] = Math.min(min[i], v.co[i]);\r\n      max[i] = Math.max(max[i], v.co[i]);\r\n    }\r\n  }\r\n  return [min, max];\r\n};\r\n\r\nexport function unproject(vec, ipers, iview) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(ipers);\r\n  newvec.multVecMatrix(iview);\r\n  return newvec;\r\n};\r\n\r\nexport function project(vec, pers, view) {\r\n  let newvec = new Vector3(vec);\r\n  newvec.multVecMatrix(pers);\r\n  newvec.multVecMatrix(view);\r\n  return newvec;\r\n};\r\n\r\nlet _sh_minv = new Vector3();\r\nlet _sh_maxv = new Vector3();\r\nlet _sh_start = [];\r\nlet _sh_end = [];\r\n\r\nlet static_cent_gbw = new Vector3();\r\n\r\nexport function get_boundary_winding(points) {\r\n  let cent = static_cent_gbw.zero();\r\n  if (points.length === 0)\r\n    return false;\r\n  for (let i = 0; i < points.length; i++) {\r\n    cent.add(points[i]);\r\n  }\r\n  cent.divideScalar(points.length);\r\n  let w = 0, totw = 0;\r\n  for (let i = 0; i < points.length; i++) {\r\n    let v1 = points[i];\r\n    let v2 = points[(i + 1)%points.length];\r\n    if (!colinear(v1, v2, cent)) {\r\n      w += winding(v1, v2, cent);\r\n      totw += 1;\r\n    }\r\n  }\r\n  if (totw > 0)\r\n    w /= totw;\r\n  return Math.round(w) === 1;\r\n};\r\n\r\nexport class PlaneOps {\r\n  constructor(normal) {\r\n    let no = normal;\r\n    this.axis = [0, 0, 0];\r\n    this.reset_axis(normal);\r\n  }\r\n\r\n  reset_axis(no) {\r\n    let ax, ay, az;\r\n    let nx = Math.abs(no[0]), ny = Math.abs(no[1]), nz = Math.abs(no[2]);\r\n    if (nz > nx && nz > ny) {\r\n      ax = 0;\r\n      ay = 1;\r\n      az = 2;\r\n    } else if (nx > ny && nx > nz) {\r\n      ax = 2;\r\n      ay = 1;\r\n      az = 0;\r\n    } else {\r\n      ax = 0;\r\n      ay = 2;\r\n      az = 1;\r\n    }\r\n    this.axis = [ax, ay, az];\r\n  }\r\n\r\n  convex_quad(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    return convex_quad(v1, v2, v3, v4);\r\n  }\r\n\r\n  line_isect(v1, v2, v3, v4) {\r\n    let ax = this.axis;\r\n    let orig1 = v1, orig2 = v2;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], v1[ax[2]]]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], v2[ax[2]]]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], v3[ax[2]]]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], v4[ax[2]]]);\r\n    let ret = line_isect(v1, v2, v3, v4, true);\r\n    let vi = ret[0];\r\n    if (ret[1] === LINECROSS) {\r\n      ret[0].load(orig2).sub(orig1).mulScalar(ret[2]).add(orig1);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  line_line_cross(l1, l2) {\r\n    let ax = this.axis;\r\n    let v1 = l1[0], v2 = l1[1], v3 = l2[0], v4 = l2[1];\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    v4 = new Vector3([v4[ax[0]], v4[ax[1]], 0.0]);\r\n    return line_line_cross([v1, v2], [v3, v4]);\r\n  }\r\n\r\n  winding(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    if (v1 === undefined)\r\n      console.trace();\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return winding(v1, v2, v3);\r\n  }\r\n\r\n  colinear(v1, v2, v3) {\r\n    let ax = this.axis;\r\n    v1 = new Vector3([v1[ax[0]], v1[ax[1]], 0.0]);\r\n    v2 = new Vector3([v2[ax[0]], v2[ax[1]], 0.0]);\r\n    v3 = new Vector3([v3[ax[0]], v3[ax[1]], 0.0]);\r\n    return colinear(v1, v2, v3);\r\n  }\r\n\r\n  get_boundary_winding(points) {\r\n    let ax = this.axis;\r\n    let cent = new Vector3();\r\n    if (points.length === 0)\r\n      return false;\r\n    for (let i = 0; i < points.length; i++) {\r\n      cent.add(points[i]);\r\n    }\r\n    cent.divideScalar(points.length);\r\n    let w = 0, totw = 0;\r\n    for (let i = 0; i < points.length; i++) {\r\n      let v1 = points[i];\r\n      let v2 = points[(i + 1)%points.length];\r\n      if (!this.colinear(v1, v2, cent)) {\r\n        w += this.winding(v1, v2, cent);\r\n        totw += 1;\r\n      }\r\n    }\r\n    if (totw > 0)\r\n      w /= totw;\r\n    return Math.round(w) === 1;\r\n  }\r\n}\r\n\r\n/*\r\non factor;\r\n\r\npx := rox + rnx*t;\r\npy := roy + rny*t;\r\npz := roz + rnz*t;\r\n\r\nf1 := (px-pox)*pnx + (py-poy)*pny + (pz-poz)*pnz;\r\nff := solve(f1, t);\r\non fort;\r\npart(ff, 1, 2);\r\noff fort;\r\n\r\n* */\r\nlet _isrp_ret = new Vector3();\r\nlet isect_ray_plane_rets = util.cachering.fromConstructor(Vector3, 256);\r\n\r\nexport function isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let po = planeorigin, pn = planenormal, ro = rayorigin, rn = raynormal;\r\n\r\n  let div = (pn[1]*rn[1] + pn[2]*rn[2] + pn[0]*rn[0]);\r\n\r\n  if (Math.abs(div) < 0.000001) {\r\n    return undefined;\r\n  }\r\n\r\n  let t = ((po[1] - ro[1])*pn[1] + (po[2] - ro[2])*pn[2] + (po[0] - ro[0])*pn[0])/div;\r\n  _isrp_ret.load(ro).addFac(rn, t);\r\n\r\n  return isect_ray_plane_rets.next().load(_isrp_ret);\r\n}\r\n\r\nexport function _old_isect_ray_plane(planeorigin, planenormal, rayorigin, raynormal) {\r\n  let p = planeorigin, n = planenormal;\r\n  let r = rayorigin, v = raynormal;\r\n\r\n  let d = p.vectorLength();\r\n  let t = -(r.dot(n) - p.dot(n))/v.dot(n);\r\n  _isrp_ret.load(v);\r\n  _isrp_ret.mulScalar(t);\r\n  _isrp_ret.add(r);\r\n  return _isrp_ret;\r\n};\r\n\r\nexport class Mat4Stack {\r\n  constructor() {\r\n    this.stack = [];\r\n    this.matrix = new Matrix4();\r\n    this.matrix.makeIdentity();\r\n    this.update_func = undefined;\r\n  }\r\n\r\n  set_internal_matrix(mat, update_func) {\r\n    this.update_func = update_func;\r\n    this.matrix = mat;\r\n  }\r\n\r\n  reset(mat) {\r\n    this.matrix.load(mat);\r\n    this.stack = [];\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  load(mat) {\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  multiply(mat) {\r\n    this.matrix.multiply(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  identity() {\r\n    this.matrix.loadIdentity();\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n  }\r\n\r\n  push(mat2) {\r\n    this.stack.push(new Matrix4(this.matrix));\r\n    if (mat2 !== undefined) {\r\n      this.matrix.load(mat2);\r\n      if (this.update_func !== undefined)\r\n        this.update_func();\r\n    }\r\n  }\r\n\r\n  pop() {\r\n    let mat = this.stack.pop(this.stack.length - 1);\r\n    this.matrix.load(mat);\r\n    if (this.update_func !== undefined)\r\n      this.update_func();\r\n    return mat;\r\n  }\r\n}\r\n\r\n\r\n/*\r\n\r\non factor;\r\noff period;\r\n\r\nload_package \"avector\";\r\n\r\n\r\na1 := avec(a1x, a1y, a1z);\r\nb1 := avec(b1x, b1y, b1z);\r\nc1 := avec(c1x, c1y, c1z);\r\nd1 := avec(d1x, d1y, d1z);\r\n\r\na1x := 0;\r\na1y := 0;\r\na1z := 0;\r\n\r\na2 := avec(a2x, a2y, a2z);\r\nb2 := avec(b2x, b2y, b2z);\r\nc2 := avec(c2x, c2y, c2z);\r\nd2 := avec(d2x, d2y, d2z);\r\n\r\np1 := a1 + (b1 - a1) * v;\r\np2 := d1 + (c1 - d1) * v;\r\np3 := p1 + (p2 - p1) * u;\r\n\r\np4 := a2 + (b2 - a2) * v;\r\np5 := d2 + (c2 - d2) * v;\r\np6 := p4 + (p5 - p4) * u;\r\n\r\np7 := p3 + (p6 - p3) * w;\r\n\r\nf1 := p7[0] - goalx;\r\nf2 := p7[1] - goaly;\r\nf3 := p7[2] - goalz;\r\n\r\ncomment: solve({f1, f2, f3}, {u, v, w});\r\n\r\non fort;\r\np7;\r\noff fort;\r\n\r\nsub(u=0, v=1, w=0, p7[0]);\r\n\r\n*/\r\n\r\nconst tril_rets = util.cachering.fromConstructor(Vector3, 128);\r\n\r\nfunction lreport() {\r\n  //console.log(...arguments);\r\n}\r\n\r\nexport function trilinear_v3(uvw, boxverts) {\r\n  let [u, v, w] = uvw;\r\n\r\n  const a1x = boxverts[0][0], a1y = boxverts[0][1], a1z = boxverts[0][2];\r\n\r\n  const b1x = boxverts[1][0] - a1x, b1y = boxverts[1][1] - a1y, b1z = boxverts[1][2] - a1z;\r\n  const c1x = boxverts[2][0] - a1x, c1y = boxverts[2][1] - a1y, c1z = boxverts[2][2] - a1z;\r\n  const d1x = boxverts[3][0] - a1x, d1y = boxverts[3][1] - a1y, d1z = boxverts[3][2] - a1z;\r\n\r\n  const a2x = boxverts[4][0] - a1x, a2y = boxverts[4][1] - a1y, a2z = boxverts[4][2] - a1z;\r\n  const b2x = boxverts[5][0] - a1x, b2y = boxverts[5][1] - a1y, b2z = boxverts[5][2] - a1z;\r\n  const c2x = boxverts[6][0] - a1x, c2y = boxverts[6][1] - a1y, c2z = boxverts[6][2] - a1z;\r\n  const d2x = boxverts[7][0] - a1x, d2y = boxverts[7][1] - a1y, d2z = boxverts[7][2] - a1z;\r\n\r\n  const x = (((a2x - b2x)*v - a2x + (c2x - d2x)*v + d2x)*u - ((a2x - b2x)*v - a2x) - (\r\n      ((c1x - d1x)*v + d1x - b1x*v)*u + b1x*v))*w + ((c1x - d1x)*v + d1x - b1x*v)*u +\r\n    b1x*v;\r\n  const y = (((a2y - b2y)*v - a2y + (c2y - d2y)*v + d2y)*u - ((a2y - b2y)*v - a2y) - (\r\n      ((c1y - d1y)*v + d1y - b1y*v)*u + b1y*v))*w + ((c1y - d1y)*v + d1y - b1y*v)*u +\r\n    b1y*v;\r\n  const z = (((a2z - b2z)*v - a2z + (c2z - d2z)*v + d2z)*u - ((a2z - b2z)*v - a2z) - (\r\n      ((c1z - d1z)*v + d1z - b1z*v)*u + b1z*v))*w + ((c1z - d1z)*v + d1z - b1z*v)*u +\r\n    b1z*v;\r\n\r\n  let p = tril_rets.next();\r\n\r\n  p[0] = x + a1x;\r\n  p[1] = y + a1y;\r\n  p[2] = z + a1z;\r\n\r\n  return p;\r\n}\r\n\r\nlet tril_co_rets = util.cachering.fromConstructor(Vector3, 128);\r\nlet tril_co_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nlet tril_mat_1 = new Matrix4();\r\nlet tril_mat_2 = new Matrix4();\r\n\r\nlet wtable = [\r\n  [\r\n    [0.5, 0.5, 0], //u triplet\r\n    [0.5, 0.5, 0], //v triplet\r\n    [0.5, 0.5, 0]  //w triplet\r\n  ],\r\n  [\r\n    [0.5, 0.5, 0],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n  [\r\n    [0.0, 0.5, 0.5],\r\n    [0.5, 0.5, 0],\r\n    [0.5, 0.5, 0]\r\n  ],\r\n];\r\n\r\nfor (let i = 0; i < 4; i++) {\r\n  let w = wtable[i];\r\n  w = [w[0], w[1], [0.0, 0.5, 0.5]];\r\n  wtable.push(w);\r\n}\r\n\r\nconst pih_tmps = util.cachering.fromConstructor(Vector3, 16);\r\nconst boxfaces_table = [\r\n  [0, 1, 2, 3],\r\n  [7, 6, 5, 4],\r\n  [0, 4, 5, 1],\r\n  [1, 5, 6, 2],\r\n  [2, 6, 7, 3],\r\n  [3, 7, 4, 0]\r\n];\r\n\r\nlet boxfaces_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfaces_tmp[i] = new Vector3();\r\n}\r\n\r\nlet boxfacenormals_tmp = new Array(6);\r\nfor (let i = 0; i < 6; i++) {\r\n  boxfacenormals_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function point_in_hex(p, boxverts, boxfacecents = undefined, boxfacenormals = undefined) {\r\n  if (!boxfacecents) {\r\n    boxfacecents = boxfaces_tmp;\r\n\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      boxfacecents[i].load(v1).add(v2).add(v3).add(v4).mulScalar(0.25);\r\n    }\r\n  }\r\n\r\n  if (!boxfacenormals) {\r\n    boxfacenormals = boxfacenormals_tmp;\r\n    for (let i = 0; i < 6; i++) {\r\n      let [v1, v2, v3, v4] = boxfaces_table[i];\r\n      v1 = boxverts[v1];\r\n      v2 = boxverts[v2];\r\n      v3 = boxverts[v3];\r\n      v4 = boxverts[v4];\r\n\r\n      let n = normal_quad(v1, v2, v3, v4);\r\n      boxfacenormals[i].load(n).negate();\r\n    }\r\n  }\r\n\r\n  let t1 = pih_tmps.next();\r\n  let t2 = pih_tmps.next();\r\n\r\n  let cent = pih_tmps.next().zero();\r\n  for (let i = 0; i < 6; i++) {\r\n    cent.add(boxfacecents[i]);\r\n  }\r\n  cent.mulScalar(1.0/6.0);\r\n\r\n  let ret = true;\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    t1.load(p).sub(boxfacecents[i]);\r\n    t2.load(cent).sub(boxfacecents[i]);\r\n    let n = boxfacenormals[i];\r\n\r\n    if (1) {\r\n      t1.normalize();\r\n      t2.normalize();\r\n\r\n      //console.log(i, \"DOT\", n.dot(t1).toFixed(5), n, t1);\r\n    }\r\n\r\n    if (t1.dot(t2) < 0) {\r\n      //console.log(\"\\n\");\r\n      ret = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //console.log(\"\\n\");\r\n  return ret;\r\n  //return true;\r\n}\r\n\r\nconst boxverts_tmp = new Array(8);\r\nfor (let i = 0; i < 8; i++) {\r\n  boxverts_tmp[i] = new Vector3();\r\n}\r\n\r\nexport function trilinear_co(p, boxverts) {\r\n  let uvw = tril_co_rets.next();\r\n\r\n  uvw.zero();\r\n\r\n  let u = tril_co_tmps.next();\r\n  let v = tril_co_tmps.next();\r\n  let w = tril_co_tmps.next();\r\n\r\n  u.loadXYZ(0.0, 0.5, 1.0);\r\n  v.loadXYZ(0.0, 0.5, 1.0);\r\n  w.loadXYZ(0.0, 0.5, 1.0);\r\n\r\n  let uvw2 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 4; step++) {\r\n    uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n    let mini = undefined;\r\n    let mindis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n    for (let i = 0; i < 8; i++) {\r\n      let [t1, t2, t3] = wtable[i];\r\n\r\n      let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n      let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n      let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n      let du = Math.abs(u2 - u[1]);\r\n      let dv = Math.abs(v2 - v[1]);\r\n      let dw = Math.abs(w2 - w[1]);\r\n\r\n      uvw.loadXYZ(u2, v2, w2);\r\n      let dis = trilinear_v3(uvw, boxverts).vectorDistanceSqr(p);\r\n\r\n      if (mindis === undefined || dis < mindis) {\r\n        //mindis = dis;\r\n        //mini = i;\r\n      }\r\n\r\n      if (1) {\r\n        let bv = boxverts_tmp;\r\n\r\n        /*\r\n        let dd = 1.0 - 0.001;\r\n\r\n        du *= dd;\r\n        dv *= dd;\r\n        dw *= dd;\r\n        //*/\r\n\r\n        bv[0].loadXYZ(u2 - du, v2 - dv, w2 - dw);\r\n        bv[1].loadXYZ(u2 - du, v2 + dv, w2 - dw);\r\n        bv[2].loadXYZ(u2 + du, v2 + dv, w2 - dw);\r\n        bv[3].loadXYZ(u2 + du, v2 - dv, w2 - dw);\r\n\r\n        bv[4].loadXYZ(u2 - du, v2 - dv, w2 + dw);\r\n        bv[5].loadXYZ(u2 - du, v2 + dv, w2 + dw);\r\n        bv[6].loadXYZ(u2 + du, v2 + dv, w2 + dw);\r\n        bv[7].loadXYZ(u2 + du, v2 - dv, w2 + dw);\r\n\r\n        for (let j = 0; j < 8; j++) {\r\n          bv[j].load(trilinear_v3(bv[j], boxverts));\r\n        }\r\n\r\n        if (point_in_hex(p, bv)) {\r\n          mini = i;\r\n          mindis = dis;\r\n          //console.log(\"DIS\", (dis**0.5).toFixed(3));\r\n          break;\r\n        }\r\n\r\n        //console.log(\"\\n\");\r\n      }\r\n    }\r\n\r\n    if (mini === undefined) {\r\n      lreport(\"mindis:\", (mindis**0.5).toFixed(3));\r\n      break;\r\n    }\r\n\r\n    let [t1, t2, t3] = wtable[mini];\r\n\r\n    let u2 = t1[0]*u[0] + t1[1]*u[1] + t1[2]*u[2];\r\n    let v2 = t2[0]*v[0] + t2[1]*v[1] + t2[2]*v[2];\r\n    let w2 = t3[0]*w[0] + t3[1]*w[1] + t3[2]*w[2];\r\n\r\n    let du = Math.abs(u2 - u[1]);\r\n    let dv = Math.abs(v2 - v[1]);\r\n    let dw = Math.abs(w2 - w[1]);\r\n\r\n    u[0] = u2 - du;\r\n    v[0] = v2 - dv;\r\n    w[0] = w2 - dw;\r\n\r\n    u[1] = u2;\r\n    v[1] = v2;\r\n    w[1] = w2;\r\n\r\n    u[2] = u2 + du;\r\n    v[2] = v2 + dv;\r\n    w[2] = w2 + dw;\r\n\r\n    lreport(\"mindis:\", (mindis**0.5).toFixed(3), u2, v2, w2);\r\n  }\r\n\r\n  uvw.loadXYZ(u[1], v[1], w[1]);\r\n\r\n  //console.log(\"uvw\", uvw);\r\n\r\n  //return uvw;\r\n\r\n  return trilinear_co2(p, boxverts, uvw);\r\n}\r\n\r\n//newton-raphson\r\nexport function trilinear_co2(p, boxverts, uvw) {\r\n  //let uvw = tril_co_rets.next();\r\n  let grad = tril_co_tmps.next();\r\n\r\n  //uvw[0] = uvw[1] = uvw[2] = 0.5;\r\n\r\n  let df = 0.00001;\r\n\r\n  let mat = tril_mat_1;\r\n  let m = mat.$matrix;\r\n  let mat2 = tril_mat_2;\r\n\r\n  let r1 = tril_co_tmps.next();\r\n\r\n  for (let step = 0; step < 55; step++) {\r\n    //let r1 = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n    let totg = 0;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      let axis_error = 0.0;\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      }\r\n      //r1[i] = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n      r1[i] = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n\r\n      let orig = uvw[i];\r\n\r\n      uvw[i] += df;\r\n      //let r2 = trilinear_v3(uvw, boxverts)[i] - p[i];\r\n\r\n      if (uvw[i] < 0) {\r\n        axis_error = -uvw[i];\r\n      } else if (uvw[i] > 1.0) {\r\n        axis_error = uvw[i] - 1.0;\r\n      } else {\r\n        axis_error = 0.0;\r\n      }\r\n      let r2 = trilinear_v3(uvw, boxverts).vectorDistance(p) + 10.0*axis_error;\r\n      uvw[i] = orig;\r\n\r\n      grad[i] = (r2 - r1[i])/df;\r\n      totg += grad[i]**2;\r\n    }\r\n\r\n    if (totg === 0.0) {\r\n      break;\r\n    }\r\n\r\n    let err = trilinear_v3(uvw, boxverts).vectorDistance(p);\r\n\r\n    if (1) {\r\n      //grad.normalize();\r\n      uvw.addFac(grad, -err/totg*0.85);\r\n    } else {\r\n      mat.makeIdentity();\r\n      m.m11 = grad[0];\r\n      m.m12 = grad[1];\r\n      m.m13 = grad[2];\r\n      m.m22 = m.m33 = m.m44 = 0.0;\r\n\r\n      mat.transpose();\r\n      mat2.load(mat).transpose();\r\n\r\n      //right-indepdenent pseudo inverse\r\n      //mat.multiply(mat2).invert();\r\n      //mat.preMultiply(mat2);\r\n\r\n      //left-independent\r\n      mat.preMultiply(mat2).invert();\r\n      mat.multiply(mat2);\r\n\r\n      grad.load(r1);\r\n      grad.multVecMatrix(mat);\r\n      uvw.addFac(grad, -1.0);\r\n    }\r\n\r\n    lreport(\"error:\", err.toFixed(3), uvw);\r\n\r\n    if (r1.dot(r1)**0.5 < 0.0001) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  lreport(\"\\n\");\r\n\r\n  return uvw;\r\n}\r\n\r\nlet angle_tri_v3_rets = util.cachering.fromConstructor(Vector3, 32);\r\nlet angle_tri_v3_vs = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function tri_angles(v1, v2, v3) {\r\n  let t1 = angle_tri_v3_vs.next().load(v1).sub(v2);\r\n  let t2 = angle_tri_v3_vs.next().load(v3).sub(v2);\r\n  let t3 = angle_tri_v3_vs.next().load(v2).sub(v3);\r\n\r\n  t1.normalize();\r\n  t2.normalize();\r\n  t3.normalize();\r\n\r\n  let th1 = Math.acos(t1.dot(t2)*0.99999);\r\n  t2.negate();\r\n\r\n  let th2 = Math.acos(t2.dot(t3)*0.99999);\r\n  let th3 = Math.PI - (th1 + th2);\r\n\r\n  let ret = angle_tri_v3_rets.next();\r\n\r\n  ret[0] = th1;\r\n  ret[1] = th2;\r\n  ret[2] = th3;\r\n\r\n  return ret;\r\n}\r\n\r\nlet angle_v2_temps = util.cachering.fromConstructor(Vector2, 32);\r\nlet angle_v3_temps = util.cachering.fromConstructor(Vector3, 32);\r\n\r\nexport function angle_between_vecs(v1, vcent, v2) {\r\n  let t1, t2;\r\n\r\n  if (v1.length === 2) {\r\n    t1 = angle_v2_temps.next();\r\n    t2 = angle_v2_temps.next();\r\n  } else {\r\n    t1 = angle_v3_temps.next();\r\n    t2 = angle_v3_temps.next();\r\n  }\r\n\r\n  t1.load(v1).sub(vcent).normalize();\r\n  t2.load(v2).sub(vcent).normalize();\r\n\r\n  let d = t1.dot(t2);\r\n\r\n  /* Handle numerical error. */\r\n  if (d < -1.0) {\r\n    return Math.PI;\r\n  } else if (d > 1.0) {\r\n    return 0.0;\r\n  } else {\r\n    return Math.acos(d);\r\n  }\r\n}\r\n", "/*\r\nTHEME REFACTOR:\r\n\r\n* Use CSS as much as possible\r\n* Create a compatibility layer\r\n\r\n*/\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport nstructjs from \"../path-controller/util/struct.js\";\r\nimport cconst from '../config/const.js';\r\n\r\nexport let compatMap = {\r\n  BoxMargin       : \"padding\",\r\n  BoxBG           : \"background\",\r\n  BoxRadius       : \"border-radius\",\r\n  background      : \"background-color\",\r\n  defaultWidth    : \"width\",\r\n  defaultHeight   : \"height\",\r\n  DefaultWidth    : \"width\",\r\n  DefaultHeight   : \"height\",\r\n  BoxBorder       : \"border-color\",\r\n  BoxLineWidth    : \"border-width\",\r\n  BoxSubBG        : \"background-color\",\r\n  BoxSub2BG       : \"background-color\",\r\n  DefaultPanelBG  : \"background-color\",\r\n  InnerPanelBG    : \"background-color\",\r\n  Background      : \"background-color\",\r\n  numslider_width : \"width\",\r\n  numslider_height: \"height\",\r\n};\r\n\r\nexport let ColorSchemeTypes = {\r\n  LIGHT: \"light\",\r\n  DARK : \"dark\"\r\n};\r\n\r\nexport function parsepx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nexport function color2css(c, alpha_override) {\r\n  let r = ~~(c[0]*255);\r\n  let g = ~~(c[1]*255);\r\n  let b = ~~(c[2]*255);\r\n  let a = c.length < 4 ? 1.0 : c[3];\r\n\r\n  a = alpha_override !== undefined ? alpha_override : a;\r\n\r\n  if (c.length === 3 && alpha_override === undefined) {\r\n    return `rgb(${r},${g},${b})`;\r\n  } else {\r\n    return `rgba(${r},${g},${b}, ${a})`;\r\n  }\r\n}\r\n\r\nwindow.color2css = color2css;\r\n\r\nlet css2color_rets = util.cachering.fromConstructor(Vector4, 64);\r\nlet basic_colors = {\r\n  'white' : [1, 1, 1],\r\n  'grey'  : [0.5, 0.5, 0.5],\r\n  'gray'  : [0.5, 0.5, 0.5],\r\n  'black' : [0, 0, 0],\r\n  'red'   : [1, 0, 0],\r\n  'yellow': [1, 1, 0],\r\n  'green' : [0, 1, 0],\r\n  'teal'  : [0, 1, 1],\r\n  'cyan'  : [0, 1, 1],\r\n  'blue'  : [0, 0, 1],\r\n  'orange': [1, 0.5, 0.25],\r\n  'brown' : [0.5, 0.4, 0.3],\r\n  'purple': [1, 0, 1],\r\n  'pink'  : [1, 0.5, 0.5]\r\n};\r\n\r\nexport function color2web(color) {\r\n  function tostr(n) {\r\n    n = ~~(n*255);\r\n    let s = n.toString(16);\r\n\r\n    if (s.length > 2) {\r\n      s = s.slice(0, 2);\r\n    }\r\n\r\n    while (s.length < 2) {\r\n      s = \"0\" + s;\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  if (color.length === 3 || color[3] === 1.0) {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n\r\n    return \"#\" + r + g + b;\r\n  } else {\r\n    let r = tostr(color[0]);\r\n    let g = tostr(color[1]);\r\n    let b = tostr(color[2]);\r\n    let a = tostr(color[3]);\r\n\r\n    return \"#\" + r + g + b + a;\r\n  }\r\n}\r\n\r\nwindow.color2web = color2web;\r\n\r\nexport function css2color(color) {\r\n  if (!color) {\r\n    return new Vector4([0, 0, 0, 1]);\r\n  }\r\n\r\n  color = (\"\" + color).trim();\r\n\r\n  let ret = css2color_rets.next();\r\n\r\n  if (color[0] === \"#\") {\r\n    color = color.slice(1, color.length);\r\n    let parts = [];\r\n\r\n    for (let i = 0; i < color.length>>1; i++) {\r\n      let part = \"0x\" + color.slice(i*2, i*2 + 2);\r\n      parts.push(parseInt(part));\r\n    }\r\n\r\n    ret.zero();\r\n    let i;\r\n    for (i = 0; i < Math.min(parts.length, ret.length); i++) {\r\n      ret[i] = parts[i]/255.0;\r\n    }\r\n\r\n    if (i < 4) {\r\n      ret[3] = 1.0;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (color in basic_colors) {\r\n    ret.load(basic_colors[color]);\r\n    ret[3] = 1.0;\r\n    return ret;\r\n  }\r\n\r\n  const hasAlpha = color.startsWith(\"rgba(\");\r\n  color = color.replace(\"rgba\", \"\").replace(\"rgb\", \"\").replace(/[\\(\\)]/g, \"\").trim().split(\",\")\r\n\r\n  for (let i = 0; i < color.length; i++) {\r\n    ret[i] = parseFloat(color[i]);\r\n    if (i < 3) {\r\n      ret[i] /= 255;\r\n    }\r\n  }\r\n\r\n  if (ret.length === 3) {\r\n    ret.push(1.0);\r\n  }\r\n\r\n  if (!hasAlpha) {\r\n    ret[3] = 1.0;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.css2color = css2color\r\n\r\nexport function web2color(str) {\r\n  if (typeof str === \"string\" && str.trim()[0] !== \"#\") {\r\n    str = \"#\" + str.trim();\r\n  }\r\n\r\n  return css2color(str);\r\n}\r\n\r\nwindow.web2color = web2color;\r\n\r\nlet validate_pat = /\\#?[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/;\r\n\r\nexport function validateWebColor(str) {\r\n  if (typeof str !== \"string\" && !(str instanceof String))\r\n    return false;\r\n\r\n  return str.trim().search(validate_pat) === 0;\r\n}\r\n\r\nlet num = \"(([0-9]+\\.[0-9]+)|[0-9a-f]+)\";\r\n\r\nlet validate_rgba = new RegExp(`rgba\\\\(${num},${num},${num},${num}\\\\)$`);\r\nlet validate_rgb = new RegExp(`rgb\\\\(${num},${num},${num}\\\\)$`);\r\n\r\nexport function validateCSSColor(color) {\r\n  if (color.toLowerCase() in basic_colors) {\r\n    return true;\r\n  }\r\n\r\n  let rgba = color.toLowerCase().replace(/[ \\t]/g, \"\");\r\n  rgba = rgba.trim();\r\n\r\n  if (validate_rgba.test(rgba) || validate_rgb.exec(rgba)) {\r\n    return true;\r\n  }\r\n\r\n  return validateWebColor(color);\r\n}\r\n\r\nwindow.validateCSSColor = validateCSSColor;\r\n\r\nexport let theme = {};\r\n\r\nexport function invertTheme() {\r\n  cconst.colorSchemeType = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? ColorSchemeTypes.DARK\r\n                                                                             : ColorSchemeTypes.LIGHT;\r\n\r\n  function inverted(color) {\r\n    if (Array.isArray(color)) {\r\n      for (let i = 0; i < 3; i++) {\r\n        color[i] = 1.0 - color[i];\r\n      }\r\n\r\n      return color;\r\n    }\r\n\r\n    color = css2color(color);\r\n    return color2css(inverted(color));\r\n  }\r\n\r\n  let bg = document.body.style[\"background-color\"];\r\n  //if (!bg) {\r\n  bg = cconst.colorSchemeType === ColorSchemeTypes.LIGHT ? \"rgb(200,200,200)\" : \"rgb(55, 55, 55)\";\r\n  //} else {\r\n  //  bg = inverted(bg);\r\n  //}\r\n\r\n  document.body.style[\"background-color\"] = bg;\r\n\r\n  for (let style in theme) {\r\n    style = theme[style];\r\n\r\n    for (let k in style) {\r\n      let v = style[k];\r\n\r\n      if (v instanceof CSSFont) {\r\n        v.color = inverted(v.color);\r\n      } else if (typeof v === \"string\") {\r\n        v = v.trim().toLowerCase();\r\n\r\n        let iscolor = v.search(\"rgb\") >= 0;\r\n        iscolor = iscolor || v in basic_colors;\r\n        iscolor = iscolor || validateWebColor(v);\r\n\r\n        if (iscolor) {\r\n          style[k] = inverted(v);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nwindow.invertTheme = invertTheme;\r\n\r\nexport function setColorSchemeType(mode) {\r\n  if (!!mode !== cconst.colorSchemeType) {\r\n    invertTheme();\r\n    cconst.colorSchemeType = mode;\r\n  }\r\n\r\n}\r\n\r\nwindow.validateWebColor = validateWebColor;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport class CSSFont {\r\n  constructor(args = {}) {\r\n    this._size = args.size ? args.size : 12;\r\n    this.font = args.font;\r\n    this.style = args.style !== undefined ? args.style : \"normal\";\r\n    this.weight = args.weight !== undefined ? args.weight : \"normal\";\r\n    this.variant = args.variant !== undefined ? args.variant : \"normal\";\r\n    this.color = args.color;\r\n  }\r\n\r\n  calcHashUpdate(digest = _digest.reset()) {\r\n    digest.add(this._size || 0);\r\n    digest.add(this.font);\r\n    digest.add(this.style);\r\n    digest.add(this.weight);\r\n    digest.add(this.variant);\r\n    digest.add(this.color);\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  set size(val) {\r\n    this._size = val;\r\n  }\r\n\r\n  get size() {\r\n    if (util.isMobile()) {\r\n      let mul = theme.base.mobileTextSizeMultiplier/visualViewport.scale;\r\n      if (mul) {\r\n        return this._size*mul;\r\n        ;\r\n      }\r\n    }\r\n\r\n    return this._size;\r\n  }\r\n\r\n  copyTo(b) {\r\n    b._size = this._size;\r\n    b.font = this.font;\r\n    b.style = this.style;\r\n    b.color = this.color;\r\n    b.variant = this.variant;\r\n    b.weight = this.weight;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new CSSFont();\r\n    this.copyTo(ret);\r\n    return ret;\r\n  }\r\n\r\n  genCSS(size = this.size) {\r\n    return `${this.style} ${this.variant} ${this.weight} ${size}px ${this.font}`;\r\n  }\r\n\r\n  //deprecated, use genKey()\r\n  hash() {\r\n    return this.genKey();\r\n  }\r\n\r\n  genKey() {\r\n    let color = this.color;\r\n\r\n    if (typeof this.color === \"object\" || typeof this.color === \"function\") {\r\n      color = JSON.stringify(color);\r\n    }\r\n\r\n    return this.genCSS() + \":\" + this.size + \":\" + color;\r\n  }\r\n}\r\n\r\nCSSFont.STRUCT = `\r\nCSSFont {\r\n  size     : float | obj._size;\r\n  font     : string | obj.font || \"\";\r\n  style    : string | obj.font || \"\";\r\n  color    : string | \"\"+obj.color;\r\n  variant  : string | obj.variant || \"\";\r\n  weight   : string | \"\"+obj.weight;\r\n}\r\n`;\r\nnstructjs.register(CSSFont);\r\n\r\nexport function exportTheme(theme1 = theme, addVarDecl = true) {\r\n  let sortkeys = (obj) => {\r\n    let keys = [];\r\n    for (let k in obj) {\r\n      keys.push(k);\r\n    }\r\n    keys.sort();\r\n\r\n    return keys;\r\n  }\r\n\r\n  let s = addVarDecl ? \"var theme = {\\n\" : \"{\\n\";\r\n\r\n  function writekey(v, indent = \"\") {\r\n    if (typeof v === \"string\") {\r\n      if (v.search(\"\\n\") >= 0) {\r\n        v = \"`\" + v + \"`\";\r\n      } else {\r\n        v = \"'\" + v + \"'\";\r\n      }\r\n\r\n      return v;\r\n    } else if (typeof v === \"object\") {\r\n      if (v instanceof CSSFont) {\r\n        return `new CSSFont({\r\n${indent}  font    : ${writekey(v.font)},\r\n${indent}  weight  : ${writekey(v.weight)},\r\n${indent}  variant : ${writekey(v.variant)},\r\n${indent}  style   : ${writekey(v.style)},\r\n${indent}  size    : ${writekey(v._size)},\r\n${indent}  color   : ${writekey(v.color)}\r\n${indent}})`;\r\n      } else {\r\n        let s = \"{\\n\";\r\n\r\n        for (let k of sortkeys(v)) {\r\n          let v2 = v[k];\r\n\r\n          if (k.search(\" \") >= 0 || k.search(\"-\") >= 0) {\r\n            k = \"'\" + k + \"'\";\r\n          }\r\n\r\n          s += indent + \"  \" + k + \" : \" + writekey(v2, indent + \"  \") + \",\\n\";\r\n        }\r\n\r\n        s += indent + \"}\";\r\n        return s;\r\n      }\r\n    } else {\r\n      return \"\" + v;\r\n    }\r\n\r\n    return \"error\";\r\n  }\r\n\r\n  for (let k of sortkeys(theme1)) {\r\n    let k2 = k;\r\n\r\n    if (k.search(/[- \\t.]/) >= 0) {\r\n      k2 = \"'\" + k + \"'\";\r\n    }\r\n    s += \"  \" + k2 + \": \";\r\n\r\n    let v = theme1[k];\r\n    if (typeof v !== \"object\" || v instanceof CSSFont) {\r\n      s += writekey(v, \"  \") + \",\\n\";\r\n    } else {\r\n      s += \" {\\n\"\r\n      let s2 = \"\";\r\n\r\n      let maxwid = 0;\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        maxwid = Math.max(maxwid, k2.length);\r\n      }\r\n\r\n      for (let k2 of sortkeys(v)) {\r\n        let v2 = v[k2];\r\n\r\n        if (k2.search(\"-\") >= 0 || k2.search(\" \") >= 0) {\r\n          k2 = \"'\" + k2 + \"'\";\r\n        }\r\n\r\n        let pad = \"\";\r\n\r\n        for (let i = 0; i < maxwid - k2.length; i++) {\r\n          pad += \" \";\r\n        }\r\n\r\n        s2 += \"    \" + k2 + pad + \": \" + writekey(v2, \"    \") + \",\\n\";\r\n      }\r\n\r\n      s += s2;\r\n      s += \"  },\\n\\n\"\r\n    }\r\n  }\r\n  s += \"};\\n\";\r\n\r\n  return s;\r\n}\r\n\r\nwindow._exportTheme = exportTheme;\r\n\r\nexport function copyTheme(theme) {\r\n  if (theme instanceof CSSFont) {\r\n    return theme.copy();\r\n  }\r\n\r\n  let ret = {};\r\n  for (let k in theme) {\r\n    let v = theme[k];\r\n\r\n    if (typeof v === \"function\") {\r\n      continue;\r\n    }\r\n\r\n    if (typeof v === \"object\") {\r\n      ret[k] = copyTheme(v);\r\n    } else {\r\n      ret[k] = v;\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n", "\"use strict\";\r\n\r\nimport * as util from './util.js';\r\nimport * as simple_events from './simple_events.js';\r\n\r\nexport {keymap, reverse_keymap, keymap_latin_1} from './simple_events.js';\r\n\r\nexport class EventDispatcher {\r\n  constructor() {\r\n    this._cbs = {};\r\n  }\r\n\r\n  _fireEvent(type, data) {\r\n    let stop = false;\r\n\r\n    data = {\r\n      stopPropagation() {\r\n        stop = true;\r\n      },\r\n\r\n      data : data\r\n    };\r\n\r\n    if (type in this._cbs) {\r\n      for (let cb of this._cbs[type]) {\r\n        cb(data);\r\n        if (stop) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      this._cbs[type] = [];\r\n    }\r\n\r\n    this._cbs[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (!(type in this._cbs)) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    let stack = this._cbs[type];\r\n    if (stack.indexOf(cb) < 0) {\r\n      console.warn(\"event handler not in list\", type, cb);\r\n      return this;\r\n    }\r\n\r\n    stack.remove(cb);\r\n    return this;\r\n  }\r\n}\r\nexport function copyMouseEvent(e) {\r\n  let ret = {};\r\n  \r\n  function bind(func, obj) {\r\n    return function() {\r\n      return this._orig.apply(func, arguments);\r\n    }\r\n  }\r\n  \r\n  let exclude = new Set([\r\n    //\"prototype\",\r\n    //\"constructor\",\r\n    \"__proto__\"\r\n  ]);\r\n  \r\n  ret._orig = e;\r\n  \r\n  for (let k in e) {\r\n    let v = e[k];\r\n    \r\n    if (exclude.has(k)) {\r\n      continue;\r\n    }\r\n    \r\n    if (typeof v == \"function\") {\r\n      v = bind(v);\r\n    }\r\n    \r\n    ret[k] = v;\r\n  }\r\n\r\n  ret.ctrlKey = e.ctrlKey;\r\n  ret.shiftKey = e.shiftKey;\r\n  ret.altKey = e.altKey;\r\n\r\n  for (let i=0; i<2; i++) {\r\n    let key = i ? \"targetTouches\" : \"touches\";\r\n\r\n    if (e[key]) {\r\n      ret[key] = [];\r\n\r\n      for (let t of e[key]) {\r\n        let t2 = {};\r\n        ret[key].push(t2);\r\n\r\n        for (let k in t) {\r\n          t2[k] = t[k];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport const DomEventTypes = {\r\n  on_mousemove   : 'mousemove',\r\n  on_mousedown   : 'mousedown',\r\n  on_mouseup     : 'mouseup',\r\n  on_touchstart  : 'touchstart',\r\n  on_touchcancel : 'touchcanel',\r\n  on_touchmove   : 'touchmove',\r\n  on_touchend    : 'touchend',\r\n  on_mousewheel  : 'mousewheel',\r\n  on_keydown     : 'keydown',\r\n  on_keyup       : 'keyup',\r\n  on_pointerdown : 'pointerdown',\r\n  on_pointermove : 'pointermove',\r\n  on_pointercancel : 'pointercancel',\r\n  on_pointerup   : 'pointerup',\r\n\r\n  //on_keypress    : 'keypress'\r\n};\r\n\r\nfunction getDom(dom, eventtype) {\r\n  if (eventtype.startsWith(\"key\"))\r\n    return window;\r\n  return dom;\r\n}\r\n\r\nexport let modalStack = [];\r\nexport function isModalHead(owner) {\r\n  return modalStack.length === 0 ||\r\n         modalStack[modalStack.length-1] === owner;\r\n}\r\n\r\nexport class EventHandler {\r\n  constructor() {\r\n    this._modalstate = undefined;\r\n  }\r\n  pushPointerModal(dom, pointerId) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushPointerModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushPointerModal(this, dom, pointerId);\r\n  }\r\n  pushModal(dom, _is_root) {\r\n    if (this._modalstate) {\r\n      console.warn(\"pushModal called twiced!\");\r\n      return;\r\n    }\r\n    \r\n    this._modalstate = simple_events.pushModalLight(this);\r\n  }\r\n  \r\n  popModal() {\r\n    if (this._modalstate !== undefined) {\r\n      let modalstate = this._modalstate;\r\n\r\n      //window.setTimeout(() => {\r\n        simple_events.popModalLight(modalstate);\r\n      //});\r\n\r\n      this._modalstate = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport function pushModal(dom, handlers) {\r\n  console.warn(\"Deprecated call to pathux.events.pushModal; use api in simple_events.js instead\");\r\n  let h = new EventHandler();\r\n  \r\n  for (let k in handlers) {\r\n    h[k] = handlers[k];\r\n  }\r\n  \r\n  handlers.popModal = () => {\r\n    return h.popModal(dom);\r\n  }\r\n  \r\n  h.pushModal(dom, false);\r\n  \r\n  return h;\r\n}\r\n", "import nstructjs from \"../util/struct.js\";\r\nimport * as util from '../util/util.js';\r\n\r\nexport const CurveConstructors = [];\r\nexport const CURVE_VERSION = 1.1;\r\n\r\nexport const CurveFlags = {\r\n  SELECT   : 1,\r\n  TRANSFORM: 2,\r\n};\r\n\r\n\r\nexport const TangentModes = {\r\n  SMOOTH: 1,\r\n  BREAK : 2\r\n};\r\n\r\nexport function getCurve(type, throw_on_error = true) {\r\n  for (let cls of CurveConstructors) {\r\n    if (cls.name === type)\r\n      return cls;\r\n    if (cls.define().name === type)\r\n      return cls;\r\n  }\r\n\r\n  if (throw_on_error) {\r\n    throw new Error(\"Unknown curve type \" + type)\r\n  } else {\r\n    console.warn(\"Unknown curve type\", type);\r\n    return getCurve(\"ease\");\r\n  }\r\n}\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class CurveTypeData {\r\n  constructor() {\r\n    this.type = this.constructor.define().typeName;\r\n    this.parent = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    throw new Error(\"get hasGUI(): implement me!\");\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls.define === CurveTypeData.define) {\r\n      throw new Error(\"missing define() static method\");\r\n    }\r\n\r\n    let def = cls.define();\r\n\r\n    if (!def.name) {\r\n      throw new Error(cls.name + \".define() result is missing 'name' field\");\r\n    }\r\n\r\n    if (!def.typeName) {\r\n      throw new Error(cls.name + \".define() is missing .typeName, which should equal class name; needed for minificaiton\");\r\n    }\r\n\r\n    CurveConstructors.push(cls);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Some Curve\",\r\n      name    : \"somecurve\",\r\n      typeName: \"CurveTypeData\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    d.add(this.type);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: this.type\r\n    }\r\n  }\r\n\r\n  equals(b) {\r\n    return this.type === b.type;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n\r\n    return this;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  integrate(s1, quadSteps = 64) {\r\n    let ret = 0.0, ds = s1/quadSteps;\r\n\r\n    for (let i = 0, s = 0; i < quadSteps; i++, s += ds) {\r\n      ret += this.evaluate(s)*ds;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  update() {\r\n    if (this.parent)\r\n      this.parent._on_change();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nCurveTypeData.STRUCT = `\r\nCurveTypeData {\r\n  type : string;\r\n}\r\n`;\r\nnstructjs.register(CurveTypeData);\r\n\r\n\r\nconst unitRange = [0, 1];\r\n\r\nexport function evalHermiteTable(table, t, range = unitRange) {\r\n  t = (t - range[0])/(range[1] - range[0]);\r\n\r\n  let s = t*(table.length/4);\r\n  let i = Math.floor(s);\r\n\r\n  s -= i;\r\n  i *= 4;\r\n\r\n  let a = table[i] + (table[i + 1] - table[i])*s;\r\n  let b = table[i + 2] + (table[i + 3] - table[i + 2])*s;\r\n\r\n  return a + (b - a)*s;\r\n  //return table[i] + (table[i + 3] - table[i])*s;\r\n}\r\n\r\nexport function genHermiteTable(evaluate, steps, range = [0, 1]) {\r\n  //console.log(\"building spline approx\");\r\n\r\n  let table = new Array(steps);\r\n\r\n  let [min, max] = range;\r\n\r\n  let eps = 0.0001;\r\n  let dt = ((max - min) - eps*4.001)/(steps - 1);\r\n  let t = min + eps*4;\r\n  let lastdv1, lastf3;\r\n\r\n  for (let j = 0; j < steps; j++, t += dt) {\r\n    //let f1 = evaluate(t - eps*2);\r\n    let f2 = evaluate(t - eps);\r\n    let f3 = evaluate(t);\r\n    let f4 = evaluate(t + eps);\r\n    //let f5 = evaluate(t + eps*2);\r\n\r\n    let dv1 = (f4 - f2)/(eps*2);\r\n    dv1 /= steps;\r\n\r\n    if (j > 0) {\r\n      let j2 = j - 1;\r\n\r\n      table[j2*4] = lastf3;\r\n      table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n      table[j2*4 + 2] = f3 - dv1/3.0;\r\n      table[j2*4 + 3] = f3;\r\n    }\r\n\r\n    lastdv1 = dv1;\r\n    lastf3 = f3;\r\n  }\r\n\r\n  return table;\r\n}\r\n", "\"use strict\";\r\n\r\n/*\r\nthis file is a skeleton that defines the contract\r\nthat any tool property library must implement to interface with path.ux.\r\n*/\r\n\r\n//maps prop type names to integers\r\nimport * as util from \"../util/util.js\";\r\n\r\nexport let PropTypes = {\r\n  INT        : 1,\r\n  STRING     : 2,\r\n  BOOL       : 4,\r\n  ENUM       : 8,\r\n  FLAG       : 16,\r\n  FLOAT      : 32,\r\n  VEC2       : 64,\r\n  VEC3       : 128,\r\n  VEC4       : 256,\r\n  MATRIX4    : 512,\r\n  QUAT       : 1024,\r\n  PROPLIST   : 4096,\r\n  STRSET     : 8192,\r\n  CURVE      : 8192<<1,\r\n  FLOAT_ARRAY: 8192<<2,\r\n  REPORT     : 8192<<3\r\n  //ITER : 8192<<1\r\n};\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\n//flags\r\nexport const PropFlags = {\r\n  SELECT                : 1,\r\n  PRIVATE               : 2,\r\n  LABEL                 : 4,\r\n  USE_ICONS             : 64, /* Implies FORCE_ENUM_CHECKBOXES (for enum/flag properties). */\r\n  USE_CUSTOM_GETSET     : 128, //used by controller.js interface\r\n  SAVE_LAST_VALUE       : 256,\r\n  READ_ONLY             : 512,\r\n  SIMPLE_SLIDER         : 1<<10,\r\n  FORCE_ROLLER_SLIDER   : 1<<11,\r\n  USE_BASE_UNDO         : 1<<12, //internal to simple_controller.js\r\n  EDIT_AS_BASE_UNIT     : 1<<13, //user textbox input should be interpreted in display unit\r\n  NO_UNDO               : 1<<14,\r\n  USE_CUSTOM_PROP_GETTER: 1<<15, //hrm, not sure I need this\r\n  FORCE_ENUM_CHECKBOXES : 1<<16,/* Use a strip of checkboxes, also applies to flag properties. */\r\n  NO_DEFAULT            : 1<<17,\r\n};\r\n\r\nexport class ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname, description, flag, icon) {\r\n    this.data = undefined;\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname;\r\n    this.description = description;\r\n    this.flag = flag;\r\n    this.icon = icon;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  copyTo(b) {\r\n\r\n  }\r\n\r\n  copy() {\r\n\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n  }\r\n\r\n  on(type, cb) {\r\n  }\r\n\r\n  off(type, cb) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  setValue(val) {\r\n  }\r\n\r\n  setStep(step) {\r\n  }\r\n\r\n  setRange(min, max) {\r\n  }\r\n\r\n  setUnit(unit) {\r\n  }\r\n\r\n  //some clients have seperate ui range\r\n  setUIRange(min, max) {\r\n  }\r\n\r\n  setIcon(icon) {\r\n  }\r\n}\r\n\r\nexport class StringPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.STRING);\r\n  }\r\n}\r\n\r\nexport class NumPropertyIF extends ToolPropertyIF {\r\n};\r\n\r\nexport class IntPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.INT);\r\n  }\r\n\r\n  setRadix(radix) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport class FloatPropertyIF extends ToolPropertyIF {\r\n  constructor() {\r\n    super(PropTypes.FLOAT);\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n  }\r\n}\r\n\r\nexport class EnumPropertyIF extends ToolPropertyIF {\r\n  constructor(value, valid_values) {\r\n    super(PropTypes.ENUM);\r\n\r\n    this.values = {}\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.iconmap = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      var uin = k[0].toUpperCase() + k.slice(1, k.length);\r\n\r\n      uin = uin.replace(/\\_/g, \" \");\r\n      this.ui_value_names[k] = uin;\r\n    }\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (var k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport class FlagPropertyIF extends EnumPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.FLAG);\r\n  }\r\n}\r\n\r\nexport class Vec2PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC2);\r\n  }\r\n}\r\n\r\nexport class Vec3PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC3);\r\n  }\r\n}\r\n\r\nexport class Vec4PropertyIF extends ToolPropertyIF {\r\n  constructor(valid_values) {\r\n    super(PropTypes.VEC4);\r\n  }\r\n}\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListPropertyIF extends ToolPropertyIF {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop) {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.prop = prop;\r\n  }\r\n\r\n  get length() {\r\n  }\r\n\r\n  set length(val) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n\r\n  /**\r\n   * clear list\r\n   * */\r\n  clear() {\r\n\r\n  }\r\n\r\n  push(item = this.prop.copy()) {\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n  }\r\n}\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetPropertyIF extends ToolPropertyIF {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n  }\r\n\r\n  getValue() {\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n  }\r\n\r\n\r\n  addUINames(map) {\r\n  }\r\n\r\n  addDescriptions(map) {\r\n  }\r\n\r\n  copyTo(b) {\r\n  }\r\n\r\n  copy() {\r\n  }\r\n}\r\n\r\nexport class Curve1DPropertyIF extends ToolPropertyIF {\r\n  constructor(curve, uiname) {\r\n    super(PropTypes.CURVE);\r\n\r\n    this.data = curve;\r\n  }\r\n\r\n  getValue() {\r\n    return this.curve;\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    let json = JSON.parse(JSON.stringify(curve));\r\n    this.data.load(json);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\n", "/**\r\n * Unit system.\r\n *\r\n * Provides an API to convert units,\r\n * e.g. `convert(0.5, \"foot\", \"meter\")`\r\n *\r\n * Path.ux widgets typically have `baseUnit`\r\n * and `displayUnit` properties. `baseUnit`\r\n * is the unit of the real stored value,\r\n * while `displayUnit` is what he user sees\r\n * and edits.\r\n *\r\n * Units:\r\n * # none           No unit\r\n * # meter          Meter       (distance)\r\n * # inch           Inch        (distance)\r\n * # foot           Foot        (distance)\r\n * # square_foot    Square Feet (area)\r\n * # mile           Mile        (distance)\r\n * # degree         Degrees     (angle)\r\n * # radian         Radians     (angle)\r\n * # pixel          Pixel       (distance)\r\n * # percent        Percent\r\n *\r\n */\r\n\r\n/*\r\nall units convert to meters\r\n*/\r\n\r\nconst FLT_EPSILONE = 1.192092895507812e-07;\r\n\r\nfunction myfloor(f) {\r\n  return Math.floor(f + FLT_EPSILONE*2.0);\r\n}\r\n\r\nfunction normString(s) {\r\n  //remove all whitespace\r\n  s = s.replace(/ /g, \"\").replace(/\\t/g, \"\");\r\n  return s.toLowerCase();\r\n}\r\n\r\nfunction myToFixed(f, decimals) {\r\n  if (typeof f !== \"number\") {\r\n    return \"(error)\";\r\n  }\r\n\r\n  f = f.toFixed(decimals);\r\n  while (f.endsWith(\"0\") && f.search(/\\./) >= 0) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.endsWith(\".\")) {\r\n    f = f.slice(0, f.length - 1);\r\n  }\r\n\r\n  if (f.length === 0)\r\n    f = \"0\";\r\n\r\n  return f.trim();\r\n}\r\n\r\nexport const Units = [];\r\n\r\nexport class Unit {\r\n  static getUnit(name) {\r\n    if (name === \"none\" || name === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    for (let cls of Units) {\r\n      if (cls.unitDefine().name === name) {\r\n        return cls;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown unit \" + name);\r\n  }\r\n\r\n  static register(cls) {\r\n    Units.push(cls);\r\n  }\r\n\r\n  //subclassed static methods start here\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"\",\r\n      uiname : \"\",\r\n      type   : \"\", //e.g. distance\r\n      icon   : -1,\r\n      pattern: undefined //a re literal to validate strings\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n\r\n  }\r\n\r\n  static validate(string) {\r\n    string = normString(string);\r\n    let def = this.unitDefine();\r\n\r\n    let m = string.match(def.pattern);\r\n    if (!m)\r\n      return false;\r\n\r\n    return m[0] === string;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n\r\n  }\r\n\r\n  static fromInternal(value) {\r\n\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n\r\n  }\r\n}\r\n\r\nexport class MeterUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"meter\",\r\n      uiname : \"Meter\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?m$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"m\")) {\r\n      string = string.slice(0, string.length - 1);\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \" m\";\r\n  }\r\n}\r\n\r\nUnit.register(MeterUnit);\r\n\r\nexport class InchUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"inch\",\r\n      uiname : \"Inch\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?(in|inch)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.toLowerCase();\r\n    let i = string.indexOf(\"i\");\r\n\r\n    if (i >= 0) {\r\n      string = string.slice(0, i);\r\n    }\r\n\r\n    return parseInt(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.0254;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.0254;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"in\";\r\n  }\r\n}\r\n\r\nUnit.register(InchUnit);\r\n\r\nlet foot_re = /((-?\\d+(\\.\\d*)?ft)(-?\\d+(\\.\\d*)?(in|inch))?)|(-?\\d+(\\.\\d*)?(in|inch))$/\r\n\r\nexport class FootUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"foot\",\r\n      uiname : \"Foot\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    let i = string.search(\"ft\");\r\n    let parts = [];\r\n    let vft = 0.0, vin = 0.0;\r\n\r\n    if (i >= 0) {\r\n      parts = string.split(\"ft\");\r\n      let j = parts[1].search(\"in\");\r\n\r\n      if (j >= 0) {\r\n        parts = [parts[0]].concat(parts[1].split(\"in\"));\r\n        vin = parseFloat(parts[1]);\r\n      }\r\n\r\n      vft = parseFloat(parts[0]);\r\n    } else {\r\n      string = string.replace(/in/g, \"\");\r\n      vin = parseFloat(string);\r\n    }\r\n\r\n    return vin/12.0 + vft;\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*0.3048;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/0.3048;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(FootUnit);\r\n\r\n\r\nlet square_foot_re = /((-?\\d+(\\.\\d*)?ft(\\u00b2)?)(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)?)|(-?\\d+(\\.\\d*)?(in|inch)(\\u00b2)?)$/\r\n\r\nexport class SquareFootUnit extends FootUnit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"square_foot\",\r\n      uiname : \"Square Feet\",\r\n      type   : \"area\",\r\n      icon   : -1,\r\n      pattern: square_foot_re\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = string.replace(/\\u00b2/g, \"\");\r\n    return super.parse(string);\r\n  }\r\n\r\n\r\n  static buildString(value, decimals = 2) {\r\n    let vft = myfloor(value);\r\n    let vin = ((value + FLT_EPSILONE*2)*12)%12;\r\n\r\n    if (vft === 0.0) {\r\n      return myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    let s = \"\" + vft + \" ft\\u00b2\";\r\n    if (vin !== 0.0) {\r\n      s += \" \" + myToFixed(vin, decimals) + \" in\\u00b2\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n}\r\n\r\nUnit.register(SquareFootUnit);\r\n\r\n\r\nexport class MileUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"mile\",\r\n      uiname : \"Mile\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?miles$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    string = string.replace(/miles/, \"\");\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value*1609.34;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value/1609.34;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" miles\";\r\n  }\r\n}\r\n\r\nUnit.register(MileUnit);\r\n\r\nexport class DegreeUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"degree\",\r\n      uiname : \"Degrees\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(\\u00B0|degree|deg|d|degree|degrees)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"d\") >= 0) {\r\n      string = string.slice(0, string.search(\"d\")).trim();\r\n    } else if (string.search(\"\\u00B0\") >= 0) {\r\n      string = string.slice(0, string.search(\"\\u00B0\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value/180.0*Math.PI;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*180.0/Math.PI;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" \\u00B0\";\r\n  }\r\n};\r\nUnit.register(DegreeUnit);\r\n\r\nexport class RadianUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"radian\",\r\n      uiname : \"Radians\",\r\n      type   : \"angle\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d+)?(r|rad|radian|radians)$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.search(\"r\") >= 0) {\r\n      string = string.slice(0, string.search(\"r\")).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 3) {\r\n    return \"\" + myToFixed(value, decimals) + \" r\";\r\n  }\r\n};\r\n\r\nUnit.register(RadianUnit);\r\n\r\nexport function setBaseUnit(unit) {\r\n  Unit.baseUnit = unit;\r\n}\r\n\r\nwindow._getBaseUnit = () => Unit.baseUnit;\r\n\r\nexport function setMetric(val) {\r\n  Unit.isMetric = val;\r\n}\r\n\r\nUnit.isMetric = true;\r\nUnit.baseUnit = \"meter\";\r\n\r\nlet numre1 = /[+\\-]?[0-9]+(\\.[0-9]*)?$/\r\nlet numre2 = /[+\\-]?[0-9]?(\\.[0-9]*)+$/\r\nlet hexre1 = /[+\\-]?[0-9a-fA-F]+h$/\r\nlet hexre2 = /[+\\-]?0x[0-9a-fA-F]+$/\r\nlet binre = /[+\\-]?0b[01]+$/\r\nlet expre = /[+\\-]?[0-9]+(\\.[0-9]*)?[eE]\\-?[0-9]+$/\r\nlet intre = /[+\\-]?[0-9]+$/\r\n\r\nfunction isnumber(s) {\r\n  s = (\"\" + s).trim();\r\n\r\n  function test(re) {\r\n    return s.search(re) === 0;\r\n  }\r\n\r\n  return test(intre) || test(numre1) || test(numre2) || test(hexre1) || test(hexre2) || test(binre) || test(expre);\r\n}\r\n\r\n\r\nexport function parseValueIntern(string, baseUnit = undefined) {\r\n  string = string.trim();\r\n  if (string[0] === \".\") {\r\n    string = \"0\" + string;\r\n  }\r\n\r\n  if (typeof baseUnit === \"string\") {\r\n    let base = Unit.getUnit(baseUnit);\r\n\r\n    if (base === undefined && baseUnit !== \"none\") {\r\n      console.warn(\"Unknown unit \" + baseUnit);\r\n      return NaN;\r\n    }\r\n\r\n    baseUnit = base;\r\n  }\r\n\r\n  //unannotated string?\r\n  if (isnumber(string)) {\r\n    //assume base unit\r\n    let f = parseFloat(string);\r\n\r\n    return f;\r\n  }\r\n\r\n  if (baseUnit === undefined) {\r\n    console.warn(\"No base unit in units.js:parseValueIntern\");\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      console.log(unit);\r\n      let value = unit.parse(string);\r\n\r\n      if (baseUnit) {\r\n        value = unit.toInternal(value);\r\n        return baseUnit.fromInternal(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return NaN;\r\n}\r\n\r\n/* if displayUnit is undefined, final value will be converted from displayUnit to baseUnit */\r\nexport function parseValue(string, baseUnit = undefined, displayUnit = undefined) {\r\n  displayUnit = Unit.getUnit(displayUnit);\r\n  baseUnit = Unit.getUnit(baseUnit);\r\n\r\n  let f = parseValueIntern(string, displayUnit || baseUnit);\r\n\r\n  if (displayUnit) {\r\n    f = displayUnit.toInternal(f);\r\n  }\r\n\r\n  if (baseUnit) {\r\n    f = baseUnit.fromInternal(f);\r\n  }\r\n\r\n  return f;\r\n}\r\n\r\nexport function isNumber(string) {\r\n  if (isnumber(string)) {\r\n    return true;\r\n  }\r\n\r\n  for (let unit of Units) {\r\n    let def = unit.unitDefine();\r\n\r\n    if (unit.validate(string)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport class PixelUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"pixel\",\r\n      uiname : \"Pixel\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /-?\\d+(\\.\\d*)?px$/\r\n    }\r\n  }\r\n\r\n  static parse(string) {\r\n    string = normString(string);\r\n    if (string.endsWith(\"px\")) {\r\n      string = string.slice(0, string.length - 2).trim();\r\n    }\r\n\r\n    return parseFloat(string);\r\n  }\r\n\r\n  //convert to internal units,\r\n  //e.g. meters for distance\r\n  static toInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value;\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return \"\" + myToFixed(value, decimals) + \"px\";\r\n  }\r\n}\r\n\r\nUnit.register(PixelUnit);\r\n\r\nexport class PercentUnit extends Unit {\r\n  static unitDefine() {\r\n    return {\r\n      name   : \"percent\",\r\n      uiname : \"Percent\",\r\n      type   : \"distance\",\r\n      icon   : -1,\r\n      pattern: /[0-9]+(\\.[0-9]+)?[ \\t]*%/\r\n    }\r\n  }\r\n\r\n  static toInternal(value) {\r\n    return value/100.0;\r\n  }\r\n\r\n  static fromInternal(value) {\r\n    return value*100.0;\r\n  }\r\n\r\n  static parse(string) {\r\n    return parseFloat(string.replace(/%/g, \"\"));\r\n  }\r\n\r\n  static buildString(value, decimals = 2) {\r\n    return (value).toFixed(decimals) + \"%\";\r\n  }\r\n}\r\n\r\nUnit.register(PercentUnit);\r\n\r\n\r\nexport function convert(value, unita, unitb) {\r\n  /* Note: getUnit throws on invalid units *except* for\r\n   *       'none' where it returns undefined.\r\n   */\r\n\r\n  if (typeof unita === \"string\") {\r\n    unita = Unit.getUnit(unita);\r\n  }\r\n\r\n  if (typeof unitb === \"string\") {\r\n    unitb = Unit.getUnit(unitb);\r\n  }\r\n\r\n  if (unita && unitb) {\r\n    return unitb.fromInternal(unita.toInternal(value));\r\n  } else if (unitb) {\r\n    return unitb.fromInternal(value); /* unita was 'none' */\r\n  } else if (unita) {\r\n    return unita.toInternal(value);\r\n  } else {\r\n    return value;\r\n  }\r\n}\r\n\r\nwindow.unitConvert = convert;\r\n\r\n/**\r\n *\r\n * @param value Value (note: is not converted to internal unit)\r\n * @param unit: Unit to use, should be a string referencing unit type, see unitDefine().name\r\n * @returns {*}\r\n */\r\nexport function buildString(value, baseUnit = Unit.baseUnit, decimalPlaces = 3, displayUnit = Unit.baseUnit) {\r\n  if (typeof baseUnit === \"string\" && baseUnit !== \"none\") {\r\n    baseUnit = Unit.getUnit(baseUnit);\r\n  }\r\n  if (typeof displayUnit === \"string\" && displayUnit !== \"none\") {\r\n    displayUnit = Unit.getUnit(displayUnit);\r\n  }\r\n\r\n\r\n  if (displayUnit !== baseUnit) {\r\n    value = convert(value, baseUnit, displayUnit);\r\n  }\r\n\r\n  if (displayUnit !== \"none\") {\r\n    return displayUnit.buildString(value, decimalPlaces);\r\n  } else {\r\n    return myToFixed(value, decimalPlaces);\r\n  }\r\n}\r\n\r\nwindow._parseValueTest = parseValue;\r\nwindow._buildStringTest = buildString;\r\n", "import * as util from '../util/util.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport {ToolPropertyIF, PropTypes, PropFlags} from \"./toolprop_abstract.js\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\nexport {PropTypes, PropFlags} from './toolprop_abstract.js';\r\n\r\nexport const NumberConstraintsBase = new Set([\r\n  'range', 'expRate', 'step', 'uiRange', 'baseUnit', 'displayUnit', 'stepIsRelative',\r\n  'slideSpeed', 'sliderDisplayExp'\r\n]);\r\n\r\nexport const IntegerConstraints = new Set([\r\n  'radix'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const FloatConstrinats = new Set([\r\n  'decimalPlaces'\r\n].concat(util.list(NumberConstraintsBase)));\r\n\r\nexport const NumberConstraints = new Set(util.list(IntegerConstraints).concat(util.list(FloatConstrinats)));\r\n\r\nexport const PropSubTypes = {\r\n  COLOR: 1\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n};\r\n\r\n//set PropTypes to custom type integers\r\nexport function setPropTypes(types) {\r\n  for (let k in types) {\r\n    PropTypes[k] = types[k];\r\n  }\r\n}\r\n\r\nexport let customPropertyTypes = [];\r\nexport let PropClasses = {};\r\n\r\nlet customPropTypeBase = 17;\r\n\r\nlet wordmap = {\r\n  sel  : \"select\",\r\n  unsel: \"deselect\",\r\n  eid  : \"id\",\r\n  props: \"properties\",\r\n  res  : \"resource\",\r\n\r\n};\r\n\r\nexport var defaultRadix = 10;\r\nexport var defaultDecimalPlaces = 4;\r\n\r\nclass OnceTag {\r\n  constructor(cb) {\r\n    this.cb = cb;\r\n  }\r\n}\r\n\r\nexport class ToolProperty extends ToolPropertyIF {\r\n  constructor(type, subtype, apiname, uiname = \"\", description = \"\", flag = 0, icon = -1) {\r\n    super();\r\n\r\n    this.data = undefined;\r\n\r\n    if (type === undefined) {\r\n      type = this.constructor.PROP_TYPE_ID;\r\n    }\r\n\r\n    this.type = type;\r\n    this.subtype = subtype;\r\n\r\n    //is false if this property still has its default value,\r\n    //i.e. it hasn't been set by the user or anyone else\r\n    this.wasSet = false;\r\n\r\n    this.apiname = apiname;\r\n    this.uiname = uiname !== undefined ? uiname : apiname;\r\n    this.description = description;\r\n    this.flag = flag | PropFlags.SAVE_LAST_VALUE;\r\n    this.icon = icon;\r\n    this.icon2 = icon; //another icon, e.g. unchecked state\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = defaultDecimalPlaces;\r\n    this.radix = defaultRadix;\r\n    this.step = 0.05;\r\n\r\n    this.callbacks = {};\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    PropClasses[new cls().type] = cls;\r\n  }\r\n\r\n  static getClass(type) {\r\n    return PropClasses[type];\r\n  }\r\n\r\n  static setDefaultRadix(n) {\r\n    defaultRadix = n;\r\n  }\r\n\r\n  static setDefaultDecimalPlaces(n) {\r\n    defaultDecimalPlaces = n;\r\n  }\r\n\r\n  static makeUIName(name) {\r\n    let parts = [\"\"];\r\n    let lastc = undefined;\r\n\r\n    let ischar = (c) => {\r\n      c = c.charCodeAt(0);\r\n\r\n      let upper = c >= \"A\".charCodeAt(0);\r\n      upper = upper && c <= \"Z\".charCodeAt(0);\r\n\r\n      let lower = c >= \"a\".charCodeAt(0);\r\n      lower = lower && c <= \"z\".charCodeAt(0);\r\n\r\n      return upper || lower;\r\n    }\r\n\r\n    for (let i = 0; i < name.length; i++) {\r\n      let c = name[i];\r\n\r\n      if (c === '_' || c === '-' || c === '$') {\r\n        lastc = c;\r\n        c = ' ';\r\n        parts.push('');\r\n        continue;\r\n      }\r\n\r\n      if (i > 0 && c === c.toUpperCase() && lastc !== lastc.toUpperCase()) {\r\n        if (ischar(c) && ischar(lastc)) {\r\n          parts.push('');\r\n        }\r\n      }\r\n\r\n      parts[parts.length - 1] += c;\r\n      lastc = c;\r\n    }\r\n\r\n\r\n    let subst = (word) => {\r\n      if (word in wordmap) {\r\n        return wordmap[word];\r\n      } else {\r\n        return word;\r\n      }\r\n    }\r\n\r\n    parts = parts\r\n      .filter(f => f.trim().length > 0)\r\n      .map(f => subst(f))\r\n      .map(f => f[0].toUpperCase() + f.slice(1, f.length).toLowerCase())\r\n      .join(\" \").trim();\r\n    return parts;\r\n  }\r\n\r\n  static register(cls) {\r\n    cls.PROP_TYPE_ID = (1<<customPropTypeBase);\r\n    PropTypes[cls.name] = cls.PROP_TYPE_ID;\r\n\r\n    customPropTypeBase++;\r\n    customPropertyTypes.push(cls);\r\n\r\n    PropClasses[new cls().type] = cls;\r\n\r\n    return cls.PROP_TYPE_ID;\r\n  }\r\n\r\n  static calcRelativeStep(step, value, logBase = 1.5) {\r\n    value = Math.log(Math.abs(value) + 1.0)/Math.log(logBase);\r\n    value = Math.max(value, step);\r\n\r\n    this.report(util.termColor(\"STEP\", \"red\"), value);\r\n    return value;\r\n  }\r\n\r\n  setDescription(s) {\r\n    this.description = s;\r\n    return this;\r\n  }\r\n\r\n  setUIName(s) {\r\n    this.uiname = s;\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    function strlen(s) {\r\n      //length of string plus an assumed member pointer\r\n      return s !== undefined ? s.length + 8 : 8;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    tot += strlen(this.apiname) + strlen(this.uiname);\r\n    tot += strlen(this.description);\r\n\r\n    tot += 11*8; //assumed member pointers\r\n    for (let k in this.callbacks) {\r\n      tot += 24;\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  private() {\r\n    this.flag |= PropFlags.PRIVATE;\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  /** Save property in last value cache.  Now set by default,\r\n   *  to disable use .ignoreLastValue().\r\n   */\r\n  saveLastValue() {\r\n    this.flag |= PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  ignoreLastValue() {\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE;\r\n    return this;\r\n  }\r\n\r\n  report() {\r\n    console.warn(...arguments);\r\n  }\r\n\r\n  _fire(type, arg1, arg2) {\r\n    if (this.callbacks[type] === undefined) {\r\n      return;\r\n    }\r\n\r\n    let stack = this.callbacks[type];\r\n    stack = stack.concat([]); //copy\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let cb = stack[i];\r\n\r\n      if (cb instanceof OnceTag) {\r\n        let j = i;\r\n\r\n        //remove callback;\r\n        while (j < stack.length - 1) {\r\n          stack[j] = stack[j + 1];\r\n          j++;\r\n        }\r\n\r\n        stack[j] = undefined;\r\n        stack.length--;\r\n\r\n        i--;\r\n\r\n        cb.cb.call(this, arg1, arg2);\r\n      } else {\r\n        cb.call(this, arg1, arg2);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  clearEventCallbacks() {\r\n    this.callbacks = {}\r\n    return this;\r\n  }\r\n\r\n  once(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    //check if cb is already in callback list inside a OnceTag\r\n    for (let cb2 of this.callbacks[type]) {\r\n      if (cb2 instanceof OnceTag && cb2.cb === cb) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    cb = new OnceTag(cb);\r\n\r\n    this.callbacks[type].push(cb);\r\n\r\n    return this;\r\n  }\r\n\r\n  on(type, cb) {\r\n    if (this.callbacks[type] === undefined) {\r\n      this.callbacks[type] = [];\r\n    }\r\n\r\n    this.callbacks[type].push(cb);\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    this.callbacks[type].remove(cb);\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type       : this.type,\r\n      subtype    : this.subtype,\r\n      apiname    : this.apiname,\r\n      uiname     : this.uiname,\r\n      description: this.description,\r\n      flag       : this.flag,\r\n      icon       : this.icon,\r\n      data       : this.data,\r\n      range      : this.range,\r\n      uiRange    : this.uiRange,\r\n      step       : this.step\r\n    };\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.type = obj.type;\r\n    this.subtype = obj.subtype;\r\n    this.apiname = obj.apiname;\r\n    this.uiname = obj.uiname;\r\n    this.description = obj.description;\r\n    this.flag = obj.flag;\r\n    this.icon = obj.icon;\r\n    this.data = obj.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (this.constructor === ToolProperty) {\r\n      throw new Error(\"implement me!\");\r\n    }\r\n\r\n    this.wasSet = true;\r\n\r\n    this._fire(\"change\", val);\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.apiname = this.apiname;\r\n\r\n    b.uiname = this.uiname;\r\n    b.description = this.description;\r\n    b.icon = this.icon;\r\n    b.icon2 = this.icon2;\r\n\r\n    b.baseUnit = this.baseUnit;\r\n    b.subtype = this.subtype;\r\n    b.displayUnit = this.displayUnit;\r\n\r\n    b.flag = this.flag;\r\n\r\n    for (let k in this.callbacks) {\r\n      b.callbacks[k] = this.callbacks[k];\r\n    }\r\n  }\r\n\r\n  copy() { //default copy method\r\n    let ret = new this.constructor();\r\n\r\n    this.copyTo(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  setStep(step) {\r\n    this.step = step;\r\n    return this;\r\n  }\r\n\r\n  getStep(value = 1.0) {\r\n    if (this.stepIsRelative) {\r\n      return ToolProperty.calcRelativeStep(this.step, value);\r\n    } else {\r\n      return this.step;\r\n    }\r\n  }\r\n\r\n  setRelativeStep(step) {\r\n    this.step = step;\r\n    this.stepIsRelative = true;\r\n  }\r\n\r\n  setRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.range = [min, max];\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n    return this;\r\n  }\r\n\r\n  setBaseUnit(unit) {\r\n    this.baseUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setDisplayUnit(unit) {\r\n    this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setUnit(unit) {\r\n    this.baseUnit = this.displayUnit = unit;\r\n    return this;\r\n  }\r\n\r\n  setFlag(f, combine = false) {\r\n    this.flag = combine ? this.flag | f : f;\r\n    return this;\r\n  }\r\n\r\n  setUIRange(min, max) {\r\n    if (min === undefined || max === undefined) {\r\n      throw new Error(\"min and/or max cannot be undefined\");\r\n    }\r\n\r\n    this.uiRange = [min, max];\r\n    return this;\r\n  }\r\n\r\n  setIcon(icon) {\r\n    this.icon = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  setIcon2(icon) {\r\n    this.icon2 = icon;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.uiRange[0] === -1e17 && this.uiRange[1] === 1e17) {\r\n      this.uiRange = undefined;\r\n    }\r\n\r\n    if (this.baseUnit === \"undefined\") {\r\n      this.baseUnit = undefined;\r\n    }\r\n\r\n    if (this.displayUnit === \"undefined\") {\r\n      this.displayUnit = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nToolProperty.STRUCT = `\r\nToolProperty { \r\n  apiname        : string | \"\"+this.apiname;\r\n  type           : int;\r\n  flag           : int;\r\n  subtype        : int;\r\n  icon           : int;\r\n  icon2          : int;\r\n  baseUnit       : string | \"\"+this.baseUnit;\r\n  displayUnit    : string | \"\"+this.displayUnit;\r\n  range          : array(float) | this.range ? this.range : [-1e17, 1e17];\r\n  uiRange        : array(float) | this.uiRange ? this.uiRange : [-1e17, 1e17];\r\n  description    : string;\r\n  stepIsRelative : bool;\r\n  step           : float;\r\n  expRate        : float;\r\n  radix          : float;\r\n  decimalPlaces  : int;\r\n  uiname         : string | this.uiname || this.apiname || \"\";\r\n  wasSet         : bool;\r\n}\r\n`;\r\nnstructjs.register(ToolProperty);\r\n\r\nwindow.ToolProperty = ToolProperty;\r\n\r\nexport class FloatArrayProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT_ARRAY, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.value = [];\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.value[Symbol.iterator]();\r\n  }\r\n\r\n  setValue(value) {\r\n    super.setValue();\r\n\r\n    if (value === undefined) {\r\n      throw new Error(\"value was undefined in FloatArrayProperty's setValue method\");\r\n    }\r\n\r\n    this.value.length = 0;\r\n\r\n    for (let item of value) {\r\n      if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n        console.log(value);\r\n        throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n      }\r\n\r\n      this.value.push(item);\r\n    }\r\n  }\r\n\r\n  push(item) {\r\n    if (typeof item !== \"number\" && typeof item !== \"boolean\") {\r\n      console.log(value);\r\n      throw new Error(\"bad item for FloatArrayProperty \" + item);\r\n    }\r\n\r\n    this.value.push(item);\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this;\r\n  }\r\n}\r\n\r\nFloatArrayProperty.STRUCT = nstructjs.inherit(FloatArrayProperty, ToolProperty) + `\r\n  value : array(float);\r\n}`;\r\nnstructjs.register(FloatArrayProperty);\r\n\r\nexport class StringProperty extends ToolProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.STRING, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.multiLine = false;\r\n\r\n    if (value) {\r\n      this.setValue(value);\r\n    } else {\r\n      this.setValue(\"\");\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + (this.data !== undefined ? this.data.length*4 : 0) + 8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.data = this.data;\r\n    b.multiLine = this.multiLine;\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    //fire events\r\n    super.setValue(val);\r\n    this.data = val;\r\n  }\r\n}\r\n\r\nStringProperty.STRUCT = nstructjs.inherit(StringProperty, ToolProperty) + `\r\n  data : string;\r\n}\r\n`;\r\nnstructjs.register(StringProperty);\r\nToolProperty.internalRegister(StringProperty);\r\n\r\n/*\r\nlet num_res = [\r\n  /([0-9]+)/,\r\n  /((0x)?[0-9a-fA-F]+(h?))/,\r\n  /([0-9]+\\.[0-9]*)/,\r\n  /([0-9]*\\.[0-9]+)/,\r\n  /(\\.[0-9]+)/\r\n];\r\n//num_re = /([0-9]+\\.[0-9]*)|([0-9]*\\.[0-9]+)/\r\n*/\r\n\r\nexport {isNumber} from '../../core/units.js';\r\n/*\r\nexport function isNumber(f) {\r\n  if (f === \"NaN\" || (typeof f == \"number\" && isNaN(f))) {\r\n    return false;\r\n  }\r\n\r\n  f = (\"\" + f).trim();\r\n\r\n  let ok = false;\r\n\r\n  for (let re of num_res) {\r\n    let ret = f.match(re)\r\n    if (!ret) {\r\n      ok = false;\r\n      continue;\r\n    }\r\n\r\n    ok = ret[0].length === f.length;\r\n    if (ok) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return ok;\r\n}*/\r\n\r\n//window.isNumber = isNumber;\r\n\r\nexport class NumProperty extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0;\r\n    this.range = [0, 0];\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n};\r\nNumProperty.STRUCT = nstructjs.inherit(NumProperty, ToolProperty) + `\r\n  range : array(float);\r\n  data  : float;\r\n}\r\n`;\r\n\r\nexport class _NumberPropertyBase extends ToolProperty {\r\n  constructor(type, value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(type, null, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = 0.0;\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /** Display simple sliders with exponent divisions, don't\r\n     * confuse with expRate which affects rollar\r\n     * slider speed.\r\n     */\r\n    this.sliderDisplayExp = 1.0;\r\n\r\n    /** controls roller slider rate */\r\n    this.slideSpeed = 1.0;\r\n\r\n    /** exponential rate, used by roller sliders */\r\n    this.expRate = 1.33;\r\n    this.step = 0.1;\r\n\r\n    this.stepIsRelative = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    /** if undefined this.range will be used */\r\n    this.uiRange = undefined;\r\n\r\n    if (value !== undefined && value !== null) {\r\n      this.setValue(value);\r\n      this.wasSet = false;\r\n    }\r\n  }\r\n\r\n  get ui_range() {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    return this.uiRange;\r\n  }\r\n\r\n  set ui_range(val) {\r\n    this.report(\"NumberProperty.ui_range is deprecated\");\r\n    this.uiRange = val;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 8*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data === b.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.expRate = this.expRate;\r\n\r\n    return json;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.displayUnit = this.displayUnit;\r\n    b.baseUnit = this.baseUnit;\r\n    b.expRate = this.expRate;\r\n    b.step = this.step;\r\n    b.range = this.range ? [this.range[0], this.range[1]] : undefined;\r\n    b.uiRange = this.uiRange ? [this.uiRange[0], this.uiRange[1]] : undefined;\r\n    b.slideSpeed = this.slideSpeed;\r\n    b.sliderDisplayExp = this.sliderDisplayExp;\r\n\r\n    b.data = this.data;\r\n  }\r\n\r\n  setSliderDisplayExp(f) {\r\n    this.sliderDisplayExp = f;\r\n    return this;\r\n  }\r\n\r\n  setSlideSpeed(f) {\r\n    this.slideSpeed = f;\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * non-linear exponent for number sliders\r\n  * in roll mode\r\n  * */\r\n  setExpRate(exp) {\r\n    this.expRate = exp;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (typeof val !== \"number\") {\r\n      throw new Error(\"Invalid number \" + val);\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    let get = (key) => {\r\n      if (key in obj) {\r\n        this[key] = obj[key];\r\n      }\r\n    };\r\n\r\n    get(\"range\");\r\n    get(\"step\");\r\n    get(\"expRate\");\r\n    get(\"ui_range\");\r\n\r\n    return this;\r\n  }\r\n};\r\n_NumberPropertyBase.STRUCT = nstructjs.inherit(_NumberPropertyBase, ToolProperty) + `\r\n  range            : array(float);\r\n  expRate          : float;\r\n  data             : float;\r\n  step             : float;\r\n  slideSpeed       : float;\r\n  sliderDisplayExp : float;\r\n}\r\n`;\r\nnstructjs.register(_NumberPropertyBase);\r\n\r\nexport class IntProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.INT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    /* Integer properties don't use default unit. */\r\n    this.baseUnit = this.displayUnit = \"none\";\r\n\r\n    this.radix = 10;\r\n  }\r\n\r\n  setValue(val) {\r\n    super.setValue(Math.floor(val));\r\n    return this;\r\n  }\r\n\r\n  setRadix(radix) {\r\n    this.radix = radix;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.radix = this.radix;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.radix = obj.radix || this.radix;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nIntProperty.STRUCT = nstructjs.inherit(IntProperty, _NumberPropertyBase) + `\r\n  data : int;\r\n}`;\r\nnstructjs.register(IntProperty);\r\n\r\nToolProperty.internalRegister(IntProperty);\r\n\r\nexport class ReportProperty extends StringProperty {\r\n  constructor(value, apiname, uiname, description, flag, icon) {\r\n    super(value, apiname, uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.REPORT;\r\n  }\r\n}\r\n\r\nReportProperty.STRUCT = nstructjs.inherit(ReportProperty, StringProperty) + `\r\n}\r\n`;\r\nnstructjs.register(ReportProperty);\r\nToolProperty.internalRegister(ReportProperty);\r\n\r\nexport class BoolProperty extends ToolProperty {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.BOOL, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = !!value;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data == b.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = !!val;\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(BoolProperty);\r\nBoolProperty.STRUCT = nstructjs.inherit(BoolProperty, ToolProperty) + `\r\n  data : bool;\r\n}\r\n`;\r\nnstructjs.register(BoolProperty);\r\n\r\n\r\nexport class FloatProperty extends _NumberPropertyBase {\r\n  constructor(value, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.FLOAT, value, apiname, uiname, description, flag, icon);\r\n\r\n    //remember to update NumberConstraintsBase et al when adding new number\r\n    //constraints\r\n\r\n    this.decimalPlaces = 4;\r\n  }\r\n\r\n  setDecimalPlaces(n) {\r\n    this.decimalPlaces = n;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.data = this.data;\r\n    return this;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n\r\n    return this;\r\n  }\r\n\r\n  toJSON() {\r\n    let json = super.toJSON();\r\n\r\n    json.data = this.data;\r\n    json.decimalPlaces = this.decimalPlaces;\r\n\r\n    return json;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.data = obj.data || this.data;\r\n    this.decimalPlaces = obj.decimalPlaces || this.decimalPlaces;\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FloatProperty);\r\nFloatProperty.STRUCT = nstructjs.inherit(FloatProperty, _NumberPropertyBase) + `\r\n  decimalPlaces : int;\r\n  data          : float;\r\n}\r\n`;\r\nnstructjs.register(FloatProperty);\r\n\r\nexport class EnumKeyPair {\r\n  constructor(key, val) {\r\n    this.key = \"\" + key;\r\n    this.val = \"\" + val;\r\n    this.key_is_int = typeof key === \"number\" || typeof key === \"boolean\";\r\n    this.val_is_int = typeof val === \"number\" || typeof val === \"boolean\";\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    if (this.val_is_int) {\r\n      this.val = parseInt(this.val);\r\n    }\r\n\r\n    if (this.key_is_int) {\r\n      this.key = parseInt(this.key);\r\n    }\r\n  }\r\n}\r\n\r\nEnumKeyPair.STRUCT = `\r\nEnumKeyPair {\r\n  key        : string;\r\n  val        : string;\r\n  key_is_int : bool;\r\n  val_is_int : bool; \r\n}\r\n`\r\nnstructjs.register(EnumKeyPair);\r\n\r\nexport class EnumProperty extends ToolProperty {\r\n  constructor(string_or_int, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(PropTypes.ENUM, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    if (valid_values === undefined) return this;\r\n\r\n    if (valid_values instanceof Array || valid_values instanceof String) {\r\n      for (var i = 0; i < valid_values.length; i++) {\r\n        this.values[valid_values[i]] = valid_values[i];\r\n        this.keys[valid_values[i]] = valid_values[i];\r\n      }\r\n    } else {\r\n      for (var k in valid_values) {\r\n        this.values[k] = valid_values[k];\r\n        this.keys[valid_values[k]] = k;\r\n      }\r\n    }\r\n\r\n    if (string_or_int === undefined) {\r\n      this.data = first(valid_values);\r\n    } else {\r\n      this.setValue(string_or_int);\r\n    }\r\n\r\n    for (var k in this.values) {\r\n      let uin = k.replace(/[_-]/g, \" \").trim();\r\n      uin = uin.split(\" \")\r\n\r\n      let uiname = ToolProperty.makeUIName(k);\r\n\r\n      this.ui_value_names[k] = uiname;\r\n      this.descriptions[k] = uiname;\r\n    }\r\n\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcHash(digest = new util.HashDigest()) {\r\n    for (let key in this.keys) {\r\n      digest.add(key);\r\n      digest.add(this.keys[key]);\r\n    }\r\n\r\n    return digest.get();\r\n  }\r\n\r\n  updateDefinition(enumdef_or_prop) {\r\n    let descriptions = this.descriptions;\r\n    let ui_value_names = this.ui_value_names;\r\n\r\n    this.values = {};\r\n    this.keys = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n\r\n    let enumdef;\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      enumdef = enumdef_or_prop.values;\r\n    } else {\r\n      enumdef = enumdef_or_prop;\r\n    }\r\n\r\n    for (let k in enumdef) {\r\n      let v = enumdef[k];\r\n\r\n      this.values[k] = v;\r\n      this.keys[v] = k;\r\n    }\r\n\r\n    if (enumdef_or_prop instanceof EnumProperty) {\r\n      let prop = enumdef_or_prop;\r\n      this.iconmap = Object.assign({}, prop.iconmap);\r\n      this.iconmap2 = Object.assign({}, prop.iconmap2);\r\n\r\n      this.ui_value_names = Object.assign({}, prop.ui_value_names);\r\n      this.descriptions = Object.assign({}, prop.descriptions);\r\n    } else {\r\n      for (let k in this.values) {\r\n        if (k in ui_value_names) {\r\n          this.ui_value_names[k] = ui_value_names[k];\r\n        } else {\r\n          this.ui_value_names[k] = ToolProperty.makeUIName(k);\r\n        }\r\n\r\n        if (k in descriptions) {\r\n          this.descriptions[k] = descriptions[k];\r\n        } else {\r\n          this.descriptions[k] = ToolProperty.makeUIName(k);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._fire('metaChange', this);\r\n\r\n    return this;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length*4 + 16)*4;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.getValue() === b.getValue();\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (this.iconmap2 === undefined) {\r\n      this.iconmap2 = {};\r\n    }\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (this.iconmap === undefined) {\r\n      this.iconmap = {};\r\n    }\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(p) {\r\n    super.copyTo(p);\r\n\r\n    p.data = this.data;\r\n\r\n    p.keys = Object.assign({}, this.keys);\r\n    p.values = Object.assign({}, this.values);\r\n    p.ui_value_names = this.ui_value_names;\r\n    p.update = this.update;\r\n    p.api_update = this.api_update;\r\n\r\n    p.iconmap = this.iconmap;\r\n    p.iconmap2 = this.iconmap2;\r\n    p.descriptions = this.descriptions;\r\n\r\n    return p;\r\n  }\r\n\r\n  copy() {\r\n    var p = new this.constructor(\"dummy\", {\"dummy\": 0}, this.apiname, this.uiname, this.description, this.flag)\r\n\r\n    this.copyTo(p);\r\n    return p;\r\n  }\r\n\r\n  getValue() {\r\n    if (this.data in this.values)\r\n      return this.values[this.data];\r\n    else\r\n      return this.data;\r\n  }\r\n\r\n  setValue(val) {\r\n    if (!(val in this.values) && (val in this.keys))\r\n      val = this.keys[val];\r\n\r\n    if (!(val in this.values)) {\r\n      this.report(\"Invalid value for enum!\", val, this.values);\r\n      return;\r\n    }\r\n\r\n    this.data = val;\r\n\r\n    //fire events\r\n    super.setValue(val);\r\n    return this;\r\n  }\r\n\r\n  _loadMap(obj) {\r\n    if (!obj) {\r\n      return {};\r\n    }\r\n\r\n    let ret = {};\r\n    for (let k of obj) {\r\n      ret[k.key] = k.val;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _saveMap(obj) {\r\n    obj = obj === undefined ? {} : obj;\r\n    let ret = [];\r\n\r\n    for (let k in obj) {\r\n      ret.push(new EnumKeyPair(k, obj[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    this.keys = this._loadMap(this._keys);\r\n    this.values = this._loadMap(this._values);\r\n    this.ui_value_names = this._loadMap(this._ui_value_names);\r\n    this.iconmap = this._loadMap(this._iconmap);\r\n    this.iconmap2 = this._loadMap(this._iconmap2);\r\n    this.descriptions = this._loadMap(this._descriptions);\r\n\r\n    if (this.data_is_int) {\r\n      this.data = parseInt(this.data);\r\n      delete this.data_is_int;\r\n    } else if (this.data in this.keys) {\r\n      this.data = this.keys[this.data];\r\n    }\r\n  }\r\n\r\n  _is_data_int() {\r\n    return typeof this.data === \"number\";\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(EnumProperty);\r\nEnumProperty.STRUCT = nstructjs.inherit(EnumProperty, ToolProperty) + `\r\n  data            : string             | \"\"+this.data;\r\n  data_is_int     : bool               | this._is_data_int();\r\n  _keys           : array(EnumKeyPair) | this._saveMap(this.keys) ;\r\n  _values         : array(EnumKeyPair) | this._saveMap(this.values) ;\r\n  _ui_value_names : array(EnumKeyPair) | this._saveMap(this.ui_value_names) ;\r\n  _iconmap        : array(EnumKeyPair) | this._saveMap(this.iconmap) ;\r\n  _iconmap2       : array(EnumKeyPair) | this._saveMap(this.iconmap2) ;\r\n  _descriptions   : array(EnumKeyPair) | this._saveMap(this.descriptions) ;  \r\n}\r\n`;\r\nnstructjs.register(EnumProperty);\r\n\r\nexport class FlagProperty extends EnumProperty {\r\n  constructor(string_or_int, valid_values, apiname,\r\n              uiname, description, flag, icon) {\r\n    super(string_or_int, valid_values, apiname,\r\n      uiname, description, flag, icon);\r\n\r\n    this.type = PropTypes.FLAG;\r\n    this.wasSet = false;\r\n  }\r\n\r\n  setValue(bitmask) {\r\n    this.data = bitmask;\r\n\r\n    //do not trigger EnumProperty's setValue\r\n    ToolProperty.prototype.setValue.call(this, bitmask);\r\n    return this;\r\n  }\r\n}\r\n\r\nToolProperty.internalRegister(FlagProperty);\r\nFlagProperty.STRUCT = nstructjs.inherit(FlagProperty, EnumProperty) + `\r\n}\r\n`;\r\nnstructjs.register(FlagProperty);\r\n\r\n\r\nexport class VecPropertyBase extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.hasUniformSlider = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + this.data.length*8;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  uniformSlider(state = true) {\r\n    this.hasUniformSlider = state;\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n    b.hasUniformSlider = this.hasUniformSlider;\r\n  }\r\n}\r\n\r\nVecPropertyBase.STRUCT = nstructjs.inherit(VecPropertyBase, FloatProperty) + `\r\n  hasUniformSlider : bool | this.hasUniformSlider || false;\r\n}\r\n`;\r\n\r\n\r\nexport class Vec2Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC2;\r\n    this.data = new Vector2(data);\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec2Property.STRUCT = nstructjs.inherit(Vec2Property, VecPropertyBase) + `\r\n  data : vec2;\r\n}\r\n`;\r\nnstructjs.register(Vec2Property);\r\n\r\nToolProperty.internalRegister(Vec2Property);\r\n\r\nexport class Vec3Property extends VecPropertyBase {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC3;\r\n    this.data = new Vector3(data);\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec3Property.STRUCT = nstructjs.inherit(Vec3Property, VecPropertyBase) + `\r\n  data : vec3;\r\n}\r\n`;\r\nnstructjs.register(Vec3Property);\r\nToolProperty.internalRegister(Vec3Property);\r\n\r\nexport class Vec4Property extends FloatProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(undefined, apiname, uiname, description);\r\n\r\n    this.type = PropTypes.VEC4;\r\n    this.data = new Vector4(data);\r\n  }\r\n\r\n  setValue(v, w = 1.0) {\r\n    this.data.load(v);\r\n\r\n    //do not trigger parent classes's setValue\r\n    ToolProperty.prototype.setValue.call(this, v);\r\n\r\n    if (v.length < 3) {\r\n      this.data[2] = 0.0;\r\n    }\r\n    if (v.length < 4) {\r\n      this.data[3] = w;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  isColor() {\r\n    this.subtype = PropSubTypes.COLOR;\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nVec4Property.STRUCT = nstructjs.inherit(Vec4Property, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(Vec4Property);\r\nToolProperty.internalRegister(Vec4Property);\r\n\r\nexport class QuatProperty extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.QUAT, undefined, apiname, uiname, description);\r\n    this.data = new Quat(data);\r\n  }\r\n\r\n  equals(b) {\r\n    return this.data.vectorDistance(b.data) < 0.00001;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n\r\n    b.data = data;\r\n    b.data.load(this.data);\r\n  }\r\n}\r\n\r\nQuatProperty.STRUCT = nstructjs.inherit(QuatProperty, VecPropertyBase) + `\r\n  data : vec4;\r\n}\r\n`;\r\nnstructjs.register(QuatProperty);\r\n\r\nToolProperty.internalRegister(QuatProperty);\r\n\r\nexport class Mat4Property extends ToolProperty {\r\n  constructor(data, apiname, uiname, description) {\r\n    super(PropTypes.MATRIX4, undefined, apiname, uiname, description);\r\n    this.data = new Matrix4(data);\r\n  }\r\n\r\n  calcMemSize() {\r\n    return super.calcMemSize() + 16*8 + 32;\r\n  }\r\n\r\n  equals(b) {\r\n    let m1 = this.data.$matrix;\r\n    let m2 = b.data.$matrix;\r\n\r\n    for (let i = 1; i <= 4; i++) {\r\n      for (let j = 1; j <= 4; j++) {\r\n        let key = `m${i}${j}`;\r\n\r\n        if (Math.abs(m1[key] - m2[key]) > 0.00001) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  setValue(v) {\r\n    this.data.load(v);\r\n    super.setValue(v);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  copyTo(b) {\r\n    let data = b.data;\r\n    super.copyTo(b);\r\n    b.data = data;\r\n\r\n    b.data.load(this.data);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n  }\r\n}\r\n\r\nMat4Property.STRUCT = nstructjs.inherit(Mat4Property, FloatProperty) + `\r\n  data           : mat4;\r\n}\r\n`;\r\nnstructjs.register(Mat4Property);\r\nToolProperty.internalRegister(Mat4Property);\r\n\r\n/**\r\n * List of other tool props (all of one type)\r\n */\r\nexport class ListProperty extends ToolProperty {\r\n  /*\r\n  * Prop must be a ToolProperty subclass instance\r\n  * */\r\n  constructor(prop, list = [], uiname = \"\") {\r\n    super(PropTypes.PROPLIST);\r\n\r\n    this.uiname = uiname;\r\n    this.flag &= ~PropFlags.SAVE_LAST_VALUE\r\n\r\n    if (typeof prop == \"number\") {\r\n      prop = PropClasses[prop];\r\n\r\n      if (prop !== undefined) {\r\n        prop = new prop();\r\n      }\r\n    } else if (prop !== undefined) {\r\n      if (prop instanceof ToolProperty) {\r\n        prop = prop.copy();\r\n      } else {\r\n        prop = new prop();\r\n      }\r\n    }\r\n\r\n\r\n    this.prop = prop;\r\n    this.value = [];\r\n\r\n    if (list) {\r\n      for (let val of list) {\r\n        this.push(val);\r\n      }\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  get length() {\r\n    return this.value.length;\r\n  }\r\n\r\n  set length(val) {\r\n    this.value.length = val;\r\n  }\r\n\r\n  splice(i, deleteCount, ...newItems) {\r\n    const deletedItems = this.value.splice(i, deleteCount, ...newItems)\r\n    this.length = this.value.length\r\n    return deletedItems\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    let psize = this.prop ? this.prop.calcMemSize() + 8 : 8;\r\n    if (!this.prop && this.value.length > 0) {\r\n      psize = this.value[0].calcMemSize();\r\n    }\r\n\r\n    tot += psize*this.value.length + 8;\r\n    tot += 16;\r\n\r\n    return tot;\r\n  }\r\n\r\n  equals(b) {\r\n    let l1 = this.value ? this.value.length : 0;\r\n    let l2 = b.value ? b.value.length : 0;\r\n\r\n    if (l1 !== l2) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < l1; i++) {\r\n      let prop1 = this.value[i];\r\n      let prop2 = b.value[i];\r\n\r\n      let bad = prop1.constructor !== prop2.constructor;\r\n      bad = bad || !prop1.equals(prop2);\r\n\r\n      if (bad) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.prop = this.prop.copy();\r\n    b.value.length = []\r\n\r\n    for (let prop of this.value) {\r\n      b.value.push(prop.copy());\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    return this.copyTo(new ListProperty(this.prop.copy()));\r\n  }\r\n\r\n  push(item = undefined) {\r\n    if (item === undefined) {\r\n      item = this.prop.copy();\r\n    }\r\n\r\n    if (!(item instanceof ToolProperty)) {\r\n      let prop = this.prop.copy();\r\n      prop.setValue(item);\r\n      item = prop;\r\n    }\r\n\r\n    this.value.push(item);\r\n    return item;\r\n  }\r\n\r\n  clear() {\r\n    this.value.length = 0;\r\n    return this\r\n  }\r\n\r\n  getListItem(i) {\r\n    if (i < 0) {\r\n      i += this.length\r\n    }\r\n    return this.value[i].getValue();\r\n  }\r\n\r\n  setListItem(i, val) {\r\n    if (i < 0) {\r\n      i += this.length\r\n    }\r\n    this.value[i].setValue(val);\r\n  }\r\n\r\n  setValue(value) {\r\n    this.clear();\r\n\r\n    for (let item of value) {\r\n      let prop = this.push();\r\n\r\n      if (typeof item !== \"object\") {\r\n        prop.setValue(item);\r\n      } else if (item instanceof prop.constructor) {\r\n        item.copyTo(prop);\r\n      } else {\r\n        this.report(item);\r\n        throw new Error(\"invalid value \" + item);\r\n      }\r\n    }\r\n\r\n    super.setValue(value);\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    let list = this.value;\r\n\r\n    return (function* () {\r\n      for (let item of list) {\r\n        yield item.getValue();\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nListProperty.STRUCT = nstructjs.inherit(ListProperty, ToolProperty) + `\r\n  prop  : abstract(ToolProperty);\r\n  value : array(abstract(ToolProperty));\r\n}`;\r\nnstructjs.register(ListProperty);\r\n\r\nToolProperty.internalRegister(ListProperty);\r\n\r\n\r\n//like FlagsProperty but uses strings\r\nexport class StringSetProperty extends ToolProperty {\r\n  constructor(value = undefined, definition = []) {\r\n    super(PropTypes.STRSET);\r\n\r\n    let values = [];\r\n\r\n    this.value = new util.set();\r\n\r\n    let def = definition;\r\n    if (Array.isArray(def) || def instanceof util.set || def instanceof Set) {\r\n      for (let item of def) {\r\n        values.push(item);\r\n      }\r\n    } else if (typeof def === \"object\") {\r\n      for (let k in def) {\r\n        values.push(k);\r\n      }\r\n    } else if (typeof def === \"string\") {\r\n      values.push(def);\r\n    }\r\n\r\n    this.values = {};\r\n    this.ui_value_names = {};\r\n    this.descriptions = {};\r\n    this.iconmap = {};\r\n    this.iconmap2 = {};\r\n\r\n    for (let v of values) {\r\n      this.values[v] = v;\r\n\r\n      let uiname = ToolProperty.makeUIName(v);\r\n      this.ui_value_names[v] = uiname;\r\n    }\r\n\r\n    if (value !== undefined) {\r\n      this.setValue(value);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    let tot = super.calcMemSize();\r\n\r\n    for (let k in this.values) {\r\n      tot += (k.length + 16)*5;\r\n    }\r\n\r\n    if (this.descriptions) {\r\n      for (let k in this.descriptions) {\r\n        tot += (k.length + this.descriptions[k].length + 8)*4;\r\n      }\r\n    }\r\n\r\n    return tot + 64;\r\n  }\r\n\r\n  equals(b) {\r\n    return this.value.equals(b.value);\r\n  }\r\n\r\n  /*\r\n  * Values can be a string, undefined/null, or a list/set/object-literal of strings.\r\n  * If destructive is true, then existing set will be cleared.\r\n  * */\r\n  setValue(values, destructive = true, soft_fail = true) {\r\n    let bad = typeof values !== \"string\";\r\n    bad = bad && typeof values !== \"object\";\r\n    bad = bad && values !== undefined && values !== null;\r\n\r\n    if (bad) {\r\n      if (soft_fail) {\r\n        this.report(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n        return;\r\n      } else {\r\n        throw new Error(\"Invalid argument to StringSetProperty.prototype.setValue() \" + values);\r\n      }\r\n    }\r\n\r\n    //handle undefined/null\r\n    if (!values) {\r\n      this.value.clear();\r\n    } else if (typeof values === \"string\") {\r\n      if (destructive)\r\n        this.value.clear();\r\n\r\n      if (!(values in this.values)) {\r\n        if (soft_fail) {\r\n          this.report(`\"${values}\" is not in this StringSetProperty`);\r\n          return;\r\n        } else {\r\n          throw new Error(`\"${values}\" is not in this StringSetProperty`);\r\n        }\r\n      }\r\n\r\n      this.value.add(values);\r\n    } else {\r\n      let data = [];\r\n\r\n      if (Array.isArray(values) || values instanceof util.set || values instanceof Set) {\r\n        for (let item of values) {\r\n          data.push(item);\r\n        }\r\n      } else { //object literal?\r\n        for (let k in values) {\r\n          data.push(k);\r\n        }\r\n      }\r\n\r\n      for (let item of data) {\r\n        if (!(item in this.values)) {\r\n          if (soft_fail) {\r\n            this.report(`\"${item}\" is not in this StringSetProperty`);\r\n            continue;\r\n          } else {\r\n            throw new Error(`\"${item}\" is not in this StringSetProperty`);\r\n          }\r\n        }\r\n\r\n        this.value.add(item);\r\n      }\r\n    }\r\n\r\n    super.setValue();\r\n    return this;\r\n  }\r\n\r\n  getValue() {\r\n    return this.value;\r\n  }\r\n\r\n  addIcons2(iconmap2) {\r\n    if (iconmap2 === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap2) {\r\n      this.iconmap2[k] = iconmap2[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addIcons(iconmap) {\r\n    if (iconmap === undefined)\r\n      return;\r\n\r\n    for (let k in iconmap) {\r\n      this.iconmap[k] = iconmap[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addUINames(map) {\r\n    for (let k in map) {\r\n      this.ui_value_names[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  addDescriptions(map) {\r\n    for (let k in map) {\r\n      this.descriptions[k] = map[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    for (let val of this.value) {\r\n      b.value.add(val);\r\n    }\r\n\r\n    b.values = {};\r\n    for (let k in this.values) {\r\n      b.values[k] = this.values[k];\r\n    }\r\n\r\n    b.ui_value_names = {};\r\n    for (let k in this.ui_value_names) {\r\n      b.ui_value_names[k] = this.ui_value_names[k];\r\n    }\r\n\r\n    b.iconmap = {};\r\n    b.iconmap2 = {};\r\n\r\n    for (let k in this.iconmap) {\r\n      b.iconmap[k] = this.iconmap[k];\r\n    }\r\n\r\n    for (let k in this.iconmap2) {\r\n      b.iconmap2[k] = this.iconmap2[k];\r\n    }\r\n\r\n    b.descriptions = {};\r\n    for (let k in this.descriptions) {\r\n      b.descriptions[k] = this.descriptions[k];\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let values = this.values;\r\n    this.values = {};\r\n\r\n    for (let s of values) {\r\n      this.values[s] = s;\r\n    }\r\n\r\n    this.value = new util.set(this.value);\r\n  }\r\n}\r\n\r\nStringSetProperty.STRUCT = nstructjs.inherit(StringSetProperty, ToolProperty) + `\r\n  value  : iter(string);\r\n  values : iterkeys(string);  \r\n}`;\r\nnstructjs.register(StringSetProperty);\r\n\r\nToolProperty.internalRegister(StringSetProperty);\r\n", "import {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {Quat, Vector2, Vector3, Vector4} from '../util/vectormath.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport {print_stack, cachering} from '../util/util.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\n\r\nexport const DataFlags = {\r\n  READ_ONLY              : 1,\r\n  USE_CUSTOM_GETSET      : 2,\r\n  USE_FULL_UNDO          : 4, //DataPathSetOp in controller_ops.js saves/loads entire file for undo/redo\r\n  USE_CUSTOM_PROP_GETTER : 8,\r\n  USE_EVAL_MASS_SET_PATHS: 16,\r\n};\r\n\r\n\r\nexport const DataTypes = {\r\n  STRUCT        : 0,\r\n  DYNAMIC_STRUCT: 1,\r\n  PROP          : 2,\r\n  ARRAY         : 3\r\n};\r\n\r\nlet propCacheRings = {};\r\n\r\nexport function getTempProp(type) {\r\n  if (!(type in propCacheRings)) {\r\n    propCacheRings[type] = cachering.fromConstructor(ToolProperty.getClass(type), 32);\r\n  }\r\n\r\n  return propCacheRings[type].next();\r\n}\r\n\r\nexport class DataPathError extends Error {\r\n};\r\n\r\n\r\nexport function getVecClass(proptype) {\r\n  switch (proptype) {\r\n    case PropTypes.VEC2:\r\n      return Vector2;\r\n    case PropTypes.VEC3:\r\n      return Vector3;\r\n    case PropTypes.VEC4:\r\n      return Vector4;\r\n    case PropTypes.QUAT:\r\n      return Quat;\r\n    default:\r\n      throw new Error(\"bad prop type \" + proptype);\r\n  }\r\n}\r\n\r\nexport function isVecProperty(prop) {\r\n  if (!prop || typeof prop !== \"object\" || prop === null)\r\n    return false;\r\n\r\n  let ok = false;\r\n\r\n  ok = ok || prop instanceof toolprop_abstract.Vec2PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec3PropertyIF;\r\n  ok = ok || prop instanceof toolprop_abstract.Vec4PropertyIF;\r\n  ok = ok || prop instanceof toolprop.Vec2Property;\r\n  ok = ok || prop instanceof toolprop.Vec3Property;\r\n  ok = ok || prop instanceof toolprop.Vec4Property;\r\n\r\n  ok = ok || prop.type === PropTypes.VEC2;\r\n  ok = ok || prop.type === PropTypes.VEC3;\r\n  ok = ok || prop.type === PropTypes.VEC4;\r\n  ok = ok || prop.type === PropTypes.QUAT;\r\n\r\n  return ok;\r\n}\r\n\r\nexport class DataPath {\r\n  constructor(path, apiname, prop, type = DataTypes.PROP) {\r\n    this.type = type;\r\n    this.data = prop;\r\n    this.apiname = apiname;\r\n    this.path = path;\r\n    this.flag = 0;\r\n    this.struct = undefined;\r\n\r\n    if (type === DataTypes.PROP && this.data && (\"\" + this.data.uiname).trim().length === 0) {\r\n      this.data.uiname = ToolProperty.makeUIName(apiname);\r\n    }\r\n  }\r\n\r\n  evalMassSetFilter() {\r\n    this.flag |= DataFlags.USE_EVAL_MASS_SET_PATHS;\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataPath();\r\n\r\n    ret.flag = this.flag;\r\n    ret.type = this.type;\r\n    ret.data = this.data;\r\n    ret.apiname = this.apiname;\r\n    ret.path = this.path;\r\n    ret.struct = this.struct;\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** this property should not be treated as something\r\n   *  that should be kept track off in the undo stack*/\r\n  noUndo() {\r\n    this.data.flag |= PropFlags.NO_UNDO;\r\n    return this;\r\n  }\r\n\r\n  setProp(prop) {\r\n    this.data = prop;\r\n  }\r\n\r\n  readOnly() {\r\n    this.flag |= DataFlags.READ_ONLY;\r\n\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.flag |= PropFlags.READ_ONLY;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  read_only() {\r\n    console.warn(\"DataPath.read_only is deprecated; use readOnly\");\r\n    return this.readOnly();\r\n  }\r\n\r\n  /** used to override tool property settings,\r\n   *  e.g. ranges, units, etc; returns a\r\n   *  base class instance of ToolProperty.\r\n   *\r\n   *  The this context points to the original ToolProperty and contains\r\n   *  a few useful references:\r\n   *\r\n   *  this.dataref - an object instance of this struct type\r\n   *  this.ctx - a context\r\n   *\r\n   *  callback takes one argument, a new (freshly copied of original)\r\n   *  tool property to modify\r\n   *\r\n   * */\r\n  customPropCallback(callback) {\r\n    this.flag |= DataFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.data.flag |= PropFlags.USE_CUSTOM_PROP_GETTER;\r\n    this.propGetter = callback;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * For the callbacks 'this' points to an internal ToolProperty;\r\n   * Referencing object lives in 'this.dataref'; calling context in 'this.ctx';\r\n   * and the datapath is 'this.datapath'\r\n   **/\r\n  customGetSet(get, set) {\r\n    this.flag |= DataFlags.USE_CUSTOM_GETSET;\r\n\r\n    if (this.type !== DataTypes.DYNAMIC_STRUCT && this.type !== DataTypes.STRUCT) {\r\n      this.data.flag |= PropFlags.USE_CUSTOM_GETSET;\r\n      this.data._getValue = this.data.getValue;\r\n      this.data._setValue = this.data.setValue;\r\n\r\n      if (get)\r\n        this.data.getValue = get;\r\n\r\n      if (set)\r\n        this.data.setValue = set;\r\n    } else {\r\n      this.getSet = {\r\n        get, set\r\n      };\r\n\r\n      this.getSet.dataref = undefined;\r\n      this.getSet.datapath = undefined;\r\n      this.getSet.ctx = undefined;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  customSet(set) {\r\n    this.customGetSet(undefined, set);\r\n    return this;\r\n  }\r\n\r\n  customGet(get) {\r\n    this.customGetSet(get, undefined);\r\n    return this;\r\n  }\r\n\r\n  /**db will be executed with underlying data object\r\n   that contains this path in 'this.dataref'\r\n\r\n   main event is 'change'\r\n   */\r\n  on(type, cb) {\r\n    if (this.type == DataTypes.PROP) {\r\n      this.data.on(type, cb);\r\n    } else {\r\n      throw new Error(\"invalid call to DataPath.on\");\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  off(type, cb) {\r\n    if (this.type === DataTypes.PROP) {\r\n      this.data.off(type, cb);\r\n    }\r\n  }\r\n\r\n  simpleSlider() {\r\n    this.data.flag |= PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag &= ~PropFlags.FORCE_ROLLER_SLIDER;\r\n    return this;\r\n  }\r\n\r\n  rollerSlider() {\r\n    this.data.flag &= ~PropFlags.SIMPLE_SLIDER;\r\n    this.data.flag |= PropFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    return this;\r\n  }\r\n\r\n  checkStrip(state = true) {\r\n    if (state) {\r\n      this.data.flag |= PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    } else {\r\n      this.data.flag &= ~PropFlags.FORCE_ENUM_CHECKBOXES;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noUnits() {\r\n    this.baseUnit(\"none\");\r\n    this.displayUnit(\"none\");\r\n    return this;\r\n  }\r\n\r\n  baseUnit(unit) {\r\n    this.data.setBaseUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  displayUnit(unit) {\r\n    this.data.setDisplayUnit(unit);\r\n    return this;\r\n  }\r\n\r\n  unit(unit) {\r\n    return this.baseUnit(unit).displayUnit(unit);\r\n  }\r\n\r\n  editAsBaseUnit() {\r\n    this.data.flag |= PropFlags.EDIT_AS_BASE_UNIT;\r\n    return this;\r\n  }\r\n\r\n  range(min, max) {\r\n    this.data.setRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  uiRange(min, max) {\r\n    this.data.setUIRange(min, max);\r\n    return this;\r\n  }\r\n\r\n  decimalPlaces(n) {\r\n    this.data.setDecimalPlaces(n);\r\n    return this;\r\n  }\r\n\r\n  sliderDisplayExp(f) {\r\n    this.data.setSliderDisplayExp(f);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * like other callbacks (until I refactor it),\r\n   * func will be called with a mysterious object that stores\r\n   * the following properties:\r\n   *\r\n   * this.dataref  : owning object reference\r\n   * this.datactx  : ctx\r\n   * this.datapath : datapath\r\n   * */\r\n  uiNameGetter(func) {\r\n    this.ui_name_get = func;\r\n    return this;\r\n  }\r\n\r\n  expRate(exp) {\r\n    this.data.setExpRate(exp);\r\n    return this;\r\n  }\r\n\r\n  slideSpeed(speed) {\r\n    this.data.setSlideSpeed(speed);\r\n    return this;\r\n  }\r\n\r\n  /**adds a slider for moving vector component sliders simultaneously*/\r\n  uniformSlider(state = true) {\r\n    this.data.uniformSlider(state);\r\n\r\n    return this;\r\n  }\r\n\r\n  radix(r) {\r\n    this.data.setRadix(r);\r\n    return this;\r\n  }\r\n\r\n  relativeStep(s) {\r\n    this.data.setRelativeStep(s);\r\n    return this;\r\n  }\r\n\r\n  step(s) {\r\n    this.data.setStep(s);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Tell DataPathSetOp to save/load entire app state for undo/redo\r\n   *\r\n   * */\r\n  fullSaveUndo() {\r\n    this.flag |= DataFlags.USE_FULL_UNDO;\r\n    this.data.flag |= PropFlags.USE_BASE_UNDO;\r\n\r\n    return this;\r\n  }\r\n\r\n  icon(i) {\r\n    this.data.setIcon(i);\r\n    return this;\r\n  }\r\n\r\n  icon2(i) {\r\n    this.data.setIcon2(i);\r\n    return this;\r\n  }\r\n\r\n  icons(icons) { //for enum/flag properties\r\n    this.data.addIcons(icons);\r\n    return this;\r\n  }\r\n\r\n  /** secondary icons (e.g. disabled states) */\r\n  icons2(icons) {\r\n    this.data.addIcons2(icons);\r\n    return this;\r\n  }\r\n\r\n  descriptions(description_map) { //for enum/flag properties\r\n    this.data.addDescriptions(description_map);\r\n    return this;\r\n  }\r\n\r\n  uiNames(uinames) {\r\n    this.data.addUINames(uinames);\r\n    return this;\r\n  }\r\n\r\n  description(d) {\r\n    this.data.description = d;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const StructFlags = {\r\n  NO_UNDO: 1 //struct and its child structs can't participate in undo\r\n             //via the DataPathToolOp\r\n};\r\n\r\nexport class ListIface {\r\n  getStruct(api, list, key) {\r\n\r\n  }\r\n\r\n  get(api, list, key) {\r\n\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n\r\n  }\r\n\r\n  getActive(api, list) {\r\n\r\n  }\r\n\r\n  setActive(api, list, val) {\r\n\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    list[key] = val;\r\n  }\r\n\r\n  getIter() {\r\n\r\n  }\r\n\r\n  filter(api, list, filter) {\r\n\r\n  }\r\n}\r\n\r\nexport class ToolOpIface {\r\n  constructor() {\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"!untitled tool\",\r\n      icon       : -1,\r\n      toolpath   : \"logical_module.tool\", //logical_module need not match up to real module name\r\n      description: undefined,\r\n      is_modal   : false,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n};\r\n\r\n\r\nlet DataAPIClass = undefined;\r\n\r\nexport function setImplementationClass(cls) {\r\n  DataAPIClass = cls;\r\n}\r\n\r\nexport function registerTool(cls) {\r\n  if (DataAPIClass === undefined) {\r\n    throw new Error(\"data api not initialized properly; call setImplementationClass\");\r\n  }\r\n\r\n  return DataAPIClass.registerTool(cls);\r\n}\r\n", "/**\r\n see doc_src/context.md\r\n */\r\n\r\nimport * as util from '../util/util.js';\r\n\r\nimport cconst from '../config/config.js';\r\n\r\nlet notifier = undefined;\r\n\r\nexport function setNotifier(cls) {\r\n  notifier = cls;\r\n}\r\n\r\nexport const ContextFlags = {\r\n  IS_VIEW : 1\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(data) {\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nlet __idgen = 1;\r\n\r\nif (Symbol.ContextID === undefined) {\r\n  Symbol.ContextID = Symbol(\"ContextID\");\r\n}\r\n\r\nif (Symbol.CachedDef === undefined) {\r\n  Symbol.CachedDef = Symbol(\"CachedDef\");\r\n}\r\n\r\nconst _ret_tmp = [undefined];\r\n\r\nexport const OverlayClasses = [];\r\n\r\nexport function makeDerivedOverlay(parent) {\r\n  return class ContextOverlay extends parent {\r\n    constructor(appstate) {\r\n      super(appstate);\r\n\r\n      this.ctx = undefined; //owning context\r\n      this._state = appstate;\r\n    }\r\n\r\n    get state() {\r\n      return this._state;\r\n    }\r\n\r\n    set state(state) {\r\n      this._state = state;\r\n    }\r\n\r\n    onRemove(have_new_file = false) {\r\n    }\r\n\r\n    copy() {\r\n      return new this.constructor(this._state);\r\n    }\r\n\r\n    validate() {\r\n      throw new Error(\"Implement me!\");\r\n    }\r\n\r\n\r\n    //base classes override this\r\n    static contextDefine() {\r\n      throw new Error(\"implement me!\");\r\n      return {\r\n        name: \"\",\r\n        flag: 0\r\n      }\r\n    }\r\n\r\n    //don't override this\r\n    static resolveDef() {\r\n      if (this.hasOwnProperty(Symbol.CachedDef)) {\r\n        return this[Symbol.CachedDef];\r\n      }\r\n\r\n      let def2 = Symbol.CachedDef = {};\r\n\r\n      let def = this.contextDefine();\r\n\r\n      if (def === undefined) {\r\n        def = {};\r\n      }\r\n\r\n      for (let k in def) {\r\n        def2[k] = def[k];\r\n      }\r\n\r\n      if (!(\"flag\" in def)) {\r\n        def2.flag = Context.inherit(0);\r\n      }\r\n\r\n      let parents = [];\r\n      let p = util.getClassParent(this);\r\n\r\n      while (p && p !== ContextOverlay) {\r\n        parents.push(p);\r\n        p = util.getClassParent(p);\r\n      }\r\n\r\n      if (def2.flag instanceof InheritFlag) {\r\n        let flag = def2.flag.data;\r\n        for (let p of parents) {\r\n          let def = p.contextDefine();\r\n\r\n          if (!def.flag) {\r\n            continue;\r\n          } else if (def.flag instanceof InheritFlag) {\r\n            flag |= def.flag.data;\r\n          } else {\r\n            flag |= def.flag;\r\n            //don't go past non-inheritable parents\r\n            break;\r\n          }\r\n        }\r\n\r\n        def2.flag = flag;\r\n      }\r\n\r\n      return def2;\r\n    }\r\n  };\r\n}\r\n\r\nexport const ContextOverlay = makeDerivedOverlay(Object);\r\n\r\nexport const excludedKeys = new Set([\"onRemove\", \"reset\", \"toString\", \"_fix\",\r\n                                     \"valueOf\", \"copy\", \"next\", \"save\", \"load\", \"clear\", \"hasOwnProperty\",\r\n                                     \"toLocaleString\", \"constructor\", \"propertyIsEnumerable\", \"isPrototypeOf\",\r\n                                     \"state\", \"saveProperty\", \"loadProperty\", \"getOwningOverlay\", \"_props\"]);\r\n\r\nexport class LockedContext {\r\n  constructor(ctx, noWarnings) {\r\n    this.props = {};\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n\r\n    this.noWarnings = noWarnings;\r\n\r\n    this.load(ctx);\r\n  }\r\n\r\n  toLocked() {\r\n    //just return itself\r\n    return this;\r\n  }\r\n\r\n  error() {\r\n    return this.ctx.error(...arguments);\r\n  }\r\n  warning() {\r\n    return this.ctx.warning(...arguments);\r\n  }\r\n  message() {\r\n    return this.ctx.message(...arguments);\r\n  }\r\n  progbar() {\r\n    return this.ctx.progbar(...arguments);\r\n  }\r\n\r\n  load(ctx) {\r\n    //let keys = util.getAllKeys(ctx);\r\n    let keys = ctx._props;\r\n\r\n    function wrapget(name) {\r\n      return function(ctx2, data) {\r\n        return ctx.loadProperty(ctx2, name, data);\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n      if (k === \"state\" || k === \"toolstack\" || k === \"api\") {\r\n        continue;\r\n      }\r\n\r\n      if (typeof k === \"string\" && (k.endsWith(\"_save\") || k.endsWith(\"_load\"))) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = ctx[k];\r\n      } catch (error) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.warn(\"failed to look up property in context: \", k);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      let data, getter;\r\n      let overlay = ctx.getOwningOverlay(k);\r\n\r\n      if (overlay === undefined) {\r\n        //property must no longer be used?\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        if (typeof k === \"string\" && (overlay[k + \"_save\"] && overlay[k + \"_load\"])) {\r\n          data = overlay[k + \"_save\"]();\r\n          getter = overlay[k + \"_load\"];\r\n        } else {\r\n          data = ctx.saveProperty(k);\r\n          getter = wrapget(k);\r\n        }\r\n      } catch (error) {\r\n        //util.print_stack(error);\r\n        console.warn(\"Failed to save context property\", k);\r\n        continue;\r\n      }\r\n\r\n      this.props[k] = {\r\n        data : data,\r\n        get  : getter\r\n      };\r\n    }\r\n\r\n    let defineProp = (name) => {\r\n      Object.defineProperty(this, name, {\r\n        get : function() {\r\n          let def = this.props[name];\r\n          return def.get(this.ctx, def.data)\r\n        }\r\n      })\r\n    };\r\n\r\n    for (let k in this.props) {\r\n      defineProp(k);\r\n    }\r\n\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  setContext(ctx) {\r\n    this.ctx = ctx;\r\n\r\n    this.state = ctx.state;\r\n    this.api = ctx.api;\r\n    this.toolstack = ctx.toolstack;\r\n  }\r\n}\r\n\r\nlet next_key = {};\r\nlet idgen = 1;\r\n\r\nexport class Context {\r\n  constructor(appstate) {\r\n    this.state = appstate;\r\n\r\n    this._props = new Set();\r\n    this._stack = [];\r\n    this._inside_map = {};\r\n  }\r\n\r\n  static isContextSubclass(cls) {\r\n    while (cls) {\r\n      if (cls === Context) {\r\n        return true;\r\n      }\r\n\r\n      cls = cls.__proto__;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /** chrome's debug console corrupts this._inside_map,\r\n   this method fixes it*/\r\n  _fix() {\r\n    this._inside_map = {};\r\n  }\r\n\r\n  fix() {\r\n    this._fix();\r\n  }\r\n\r\n  error(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.error(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  warning(message, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(message);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.warning(state.screen, message, timeout);\r\n    }\r\n  }\r\n\r\n  message(msg, timeout=1500) {\r\n    let state = this.state;\r\n\r\n    console.warn(msg);\r\n\r\n    if (state && state.screen) {\r\n      return notifier.message(state.screen, msg, timeout);\r\n    }\r\n  }\r\n\r\n  progbar(msg, perc=0.0, timeout=1500, id=msg) {\r\n    let state = this.state;\r\n\r\n    if (state && state.screen) {\r\n      //progbarNote(screen, msg, percent, color, timeout) {\r\n      return notifier.progbarNote(state.screen, msg, perc, \"green\", timeout, id);\r\n    }\r\n  }\r\n\r\n  validateOverlays() {\r\n    let stack = this._stack;\r\n    let stack2 = [];\r\n\r\n    for (let i=0; i<stack.length; i++) {\r\n      if (stack[i].validate()) {\r\n        stack2.push(stack[i]);\r\n      }\r\n    }\r\n\r\n    this._stack = stack2;\r\n  }\r\n\r\n  hasOverlay(cls) {\r\n    return this.getOverlay(cls) !== undefined;\r\n  }\r\n\r\n  getOverlay(cls) {\r\n    for (let overlay of this._stack) {\r\n      if (overlay.constructor === cls) {\r\n        return overlay;\r\n      }\r\n    }\r\n  }\r\n\r\n  clear(have_new_file=false) {\r\n    for (let overlay of this._stack) {\r\n      overlay.onRemove(have_new_file);\r\n    }\r\n\r\n    this._stack = [];\r\n  }\r\n\r\n  //this is implemented by child classes\r\n  //it should load the same default overlays as in constructor\r\n  reset(have_new_file=false) {\r\n    this.clear(have_new_file);\r\n  }\r\n\r\n  //returns a new context with overriden properties\r\n  //unlike pushOverlay, overrides can be a simple object\r\n  override(overrides) {\r\n    if (overrides.copy === undefined) {\r\n      overrides.copy = function() {\r\n        return Object.assign({}, this);\r\n      }\r\n    }\r\n\r\n    let ctx = this.copy();\r\n    ctx.pushOverlay(overrides);\r\n    return ctx;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new this.constructor(this.state);\r\n\r\n    for (let item of this._stack) {\r\n      ret.pushOverlay(item.copy());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   Used by overlay property getters.  If returned,\r\n   the next overlay in the struct will have its getter used.\r\n\r\n   Example:\r\n\r\n   class overlay {\r\n      get scene() {\r\n        if (some_reason) {\r\n          return Context.super();\r\n        }\r\n\r\n        return something_else;\r\n      }\r\n    }\r\n   */\r\n  static super() {\r\n    return next_key;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * saves a property into some kind of non-object-reference form\r\n   *\r\n   * */\r\n  saveProperty(key) {\r\n    //console.warn(\"Missing saveProperty implementation in Context; passing through values...\", key)\r\n    return this[key];\r\n  }\r\n\r\n  /**\r\n   *\r\n   * lookup property based on saved data\r\n   *\r\n   * */\r\n  loadProperty(ctx, key, data) {\r\n    //console.warn(\"Missing loadProperty implementation in Context; passing through values...\", key)\r\n    return data;\r\n  }\r\n\r\n  getOwningOverlay(name, _val_out) {\r\n    let inside_map = this._inside_map;\r\n    let stack = this._stack;\r\n\r\n    if (cconst.DEBUG.contextSystem) {\r\n      console.log(name, inside_map);\r\n    }\r\n\r\n    for (let i=stack.length-1; i >= 0; i--) {\r\n      let overlay = stack[i];\r\n      let ret = next_key;\r\n\r\n      if (overlay[Symbol.ContextID] === undefined) {\r\n        throw new Error(\"context corruption\");\r\n      }\r\n\r\n      let ikey = overlay[Symbol.ContextID];\r\n\r\n      if (cconst.DEBUG.contextSystem) {\r\n        console.log(ikey, overlay);\r\n      }\r\n\r\n      //prevent infinite recursion\r\n      if (inside_map[ikey]) {\r\n        continue;\r\n      }\r\n\r\n      if (overlay.__allKeys.has(name)) {\r\n        if (cconst.DEBUG.contextSystem) {\r\n          console.log(\"getting value\");\r\n        }\r\n\r\n        //Chrome's console messes this up\r\n\r\n        inside_map[ikey] = 1;\r\n\r\n        try {\r\n          ret = overlay[name];\r\n        } catch (error) {\r\n\r\n          inside_map[ikey] = 0;\r\n          throw error;\r\n        }\r\n\r\n        inside_map[ikey] = 0;\r\n      }\r\n\r\n      if (ret !== next_key) {\r\n        if (_val_out !== undefined) {\r\n          _val_out[0] = ret;\r\n        }\r\n        return overlay;\r\n      }\r\n    }\r\n\r\n    if (_val_out !== undefined) {\r\n      _val_out[0] = undefined;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensureProperty(name) {\r\n    if (this.hasOwnProperty(name)) {\r\n      return;\r\n    }\r\n\r\n    this._props.add(name);\r\n\r\n    Object.defineProperty(this, name, {\r\n      get : function() {\r\n        let ret = _ret_tmp;\r\n        _ret_tmp[0] = undefined;\r\n\r\n        this.getOwningOverlay(name, ret);\r\n        return ret[0];\r\n      }, set : function() {\r\n        throw new Error(\"Cannot set ctx properties\")\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Returns a new context that doesn't\r\n   * contain any direct object references\r\n   * except for .state .datalib and .api, but\r\n   * instead uses those three to look up references\r\n   * on property access.\r\n   * */\r\n  toLocked() {\r\n    return new LockedContext(this);\r\n  }\r\n\r\n  pushOverlay(overlay) {\r\n    if (!overlay.hasOwnProperty(Symbol.ContextID)) {\r\n      overlay[Symbol.ContextID] = idgen++;\r\n    }\r\n\r\n    let keys = new Set();\r\n    for (let key of util.getAllKeys(overlay)) {\r\n      if (!excludedKeys.has(key) && !(typeof key === \"string\" && key[0] === \"_\")) {\r\n        keys.add(key);\r\n      }\r\n    }\r\n\r\n    overlay.ctx = this;\r\n\r\n    if (overlay.__allKeys === undefined) {\r\n      overlay.__allKeys = keys;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let bad = typeof k === \"symbol\" || excludedKeys.has(k);\r\n      bad = bad || (typeof k === \"string\" && k[0] === \"_\");\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_save\"));\r\n      bad = bad || (typeof k === \"string\" && k.endsWith(\"_load\"));\r\n\r\n      if (bad) {\r\n        continue;\r\n      }\r\n\r\n      this.ensureProperty(k);\r\n    }\r\n\r\n    if (this._stack.indexOf(overlay) >= 0) {\r\n      console.warn(\"Overlay already added once\");\r\n      if (this._stack[this._stack.length-1] === overlay) {\r\n        console.warn(\"  Definitely an error, overlay is already at top of stack\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    this._stack.push(overlay);\r\n  }\r\n\r\n  popOverlay(overlay) {\r\n    if (overlay !== this._stack[this._stack.length-1]) {\r\n      console.warn(\"Context.popOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.pop();\r\n  }\r\n\r\n  removeOverlay(overlay) {\r\n    if (this._stack.indexOf(overlay) < 0) {\r\n      console.warn(\"Context.removeOverlay called in error\", overlay);\r\n      return;\r\n    }\r\n\r\n    overlay.onRemove();\r\n    this._stack.remove(overlay);\r\n  }\r\n\r\n  static inherit(data) {\r\n    return new InheritFlag(data);\r\n  }\r\n\r\n  static register(cls) {\r\n    if (cls[Symbol.ContextID]) {\r\n      console.warn(\"Tried to register same class twice:\", cls);\r\n      return;\r\n    }\r\n\r\n    cls[Symbol.ContextID] = __idgen++;\r\n    OverlayClasses.push(cls);\r\n  }\r\n}\r\n\r\nexport function test() {\r\n  function testInheritance() {\r\n    class Test0 extends ContextOverlay {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 1\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test1 extends Test0 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: 2\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test2 extends Test1 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(4)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test3 extends Test2 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(8)\r\n        }\r\n      }\r\n    }\r\n\r\n    class Test4 extends Test3 {\r\n      static contextDefine() {\r\n        return {\r\n          flag: Context.inherit(16)\r\n        }\r\n      }\r\n    }\r\n\r\n    return Test4.resolveDef().flag === 30;\r\n  }\r\n\r\n  return testInheritance();\r\n}\r\n\r\nif (!test()) {\r\n  throw new Error(\"Context test failed\");\r\n}\r\n", "\"use strict\";\r\nimport nstructjs from '../util/struct.js';\r\n\r\n/**\r\n\r\n ToolOps are base operators for modifying application state.\r\n They operate on Contexts and can use the datapath API.\r\n They make up the undo stack.\r\n\r\n ToolOp subclasses handle undo with their undoPre (run before tool execution)\r\n and undo methods.  You can set default handlers (most commonly this is just\r\n saving/reloading the app state) with setDefaultUndoHandlers.\r\n\r\n ToolOps have inputs and outputs (which are ToolProperties) and can also\r\n be modal.\r\n\r\n ## Rules\r\n\r\n Tools are never, EVER allowed to store direct pointers to the application state,\r\n with one exception: tools in modal mode may store such pointers, but they must\r\n delete them when existing modal mode by overriding modalEnd.\r\n\r\n This is to prevent very evil and difficult to debug bugs in the undo stack\r\n and nasty memory leaks.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n const ExampleEnum = {\r\n  ITEM1 : 0,\r\n  ITEM2 : 1\r\n}\r\n\r\n class MyTool extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Tool Name\",\r\n      toolpath   : \"my.tool\",\r\n      inputs     : {\r\n          input1 : new IntProperty(),\r\n          input2 : new EnumProperty(0, ExampleEnum)\r\n      },\r\n      outputs    : {\r\n          someoutput : new IntProperty\r\n      }\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    //run before tool starts\r\n  }\r\n\r\n  undo(ctx) {\r\n    //undo handler\r\n  }\r\n\r\n  execPre(ctx) {\r\n    //run right before exec\r\n  }\r\n  exec(ctx) {\r\n    //main execution method\r\n  }\r\n  execPost(ctx) {\r\n    //run right after exec\r\n  }\r\n}\r\n ToolOp.register(MyTool);\r\n\r\n </pre>\r\n */\r\n\r\nimport * as events from '../util/events.js';\r\nimport {keymap} from '../util/simple_events.js';\r\nimport {PropFlags, PropTypes} from './toolprop.js';\r\nimport {DataPath} from '../controller/controller_base.js';\r\nimport * as util from '../util/util.js';\r\nimport {Context} from '../controller/context.js';\r\n\r\nexport let ToolClasses = [];\r\nwindow._ToolClasses = ToolClasses;\r\n\r\nexport function setContextClass(cls) {\r\n  console.warn(\"setContextClass is deprecated\");\r\n}\r\n\r\nexport const ToolFlags = {\r\n  PRIVATE: 1\r\n\r\n};\r\n\r\n\r\nexport const UndoFlags = {\r\n  NO_UNDO      : 2,\r\n  IS_UNDO_ROOT : 4,\r\n  UNDO_BARRIER : 8,\r\n  HAS_UNDO_DATA: 16\r\n};\r\n\r\nclass InheritFlag {\r\n  constructor(slots = {}) {\r\n    this.slots = slots;\r\n  }\r\n}\r\n\r\nlet modalstack = [];\r\n\r\nlet defaultUndoHandlers = {\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me\");\r\n  },\r\n  undo(ctx) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n}\r\n\r\nexport function setDefaultUndoHandlers(undoPre, undo) {\r\n  if (!undoPre || !undo) {\r\n    throw new Error(\"invalid parameters to setDefaultUndoHandlers\");\r\n  }\r\n\r\n  defaultUndoHandlers.undoPre = undoPre;\r\n  defaultUndoHandlers.undo = undo;\r\n}\r\n\r\nexport class ToolPropertyCache {\r\n  constructor() {\r\n    this.map = new Map();\r\n    this.pathmap = new Map();\r\n    this.accessors = {};\r\n\r\n    this.userSetMap = new Set();\r\n\r\n    this.api = undefined;\r\n    this.dstruct = undefined;\r\n  }\r\n\r\n  static getPropKey(cls, key, prop) {\r\n    return prop.apiname && prop.apiname.length > 0 ? prop.apiname : key;\r\n  }\r\n\r\n  _buildAccessors(cls, key, prop, dstruct, api) {\r\n    let tdef = cls._getFinalToolDef();\r\n\r\n    this.api = api;\r\n    this.dstruct = dstruct;\r\n\r\n    if (!tdef.toolpath) {\r\n      console.warn(\"Bad tool property\", cls, \"it's tooldef was missing a toolpath field\");\r\n      return;\r\n    }\r\n\r\n    let path = tdef.toolpath.trim().split(\".\").filter(f => f.trim().length > 0);\r\n    let obj = this.accessors;\r\n\r\n    let st = dstruct;\r\n    let partial = \"\";\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let k = path[i];\r\n      let pathk = k;\r\n\r\n      if (i === 0) {\r\n        pathk = \"accessors.\" + k;\r\n      }\r\n\r\n      if (i > 0) {\r\n        partial += \".\";\r\n      }\r\n      partial += k;\r\n\r\n      if (!(k in obj)) {\r\n        obj[k] = {};\r\n      }\r\n\r\n      let st2 = api.mapStruct(obj[k], true, k);\r\n      if (!(k in st.pathmap)) {\r\n        st.struct(pathk, k, k, st2);\r\n      }\r\n      st = st2;\r\n\r\n      this.pathmap.set(partial, obj[k]);\r\n\r\n      obj = obj[k];\r\n    }\r\n\r\n    let name = prop.apiname !== undefined && prop.apiname.length > 0 ? prop.apiname : key;\r\n    let prop2 = prop.copy()\r\n\r\n    let dpath = new DataPath(name, name, prop2);\r\n    let uiname = prop.uiname;\r\n\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = prop.apiname;\r\n    }\r\n    if (!uiname || uiname.trim().length === 0) {\r\n      uiname = key;\r\n    }\r\n\r\n    uiname = ToolProperty.makeUIName(uiname);\r\n\r\n    prop2.uiname = uiname;\r\n    prop2.description = prop2.description || prop2.uiname;\r\n\r\n    st.add(dpath);\r\n\r\n    obj[name] = prop2.getValue();\r\n  }\r\n\r\n  _getAccessor(cls) {\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    return this.pathmap.get(toolpath);\r\n  }\r\n\r\n  useDefault(cls, key, prop) {\r\n    key = this.userSetMap.has(cls.tooldef().trim() + \".\" + this.constructor.getPropKey(key));\r\n    key = key.trim();\r\n\r\n    return key;\r\n  }\r\n\r\n  has(cls, key, prop) {\r\n    if (prop.flag & PropFlags.NO_DEFAULT) {\r\n      return false;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n    return obj && key in obj;\r\n  }\r\n\r\n  get(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let obj = this._getAccessor(cls);\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    if (obj) {\r\n      return obj[key];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  set(cls, key, prop) {\r\n    if (cls === ToolMacro) {\r\n      return;\r\n    }\r\n\r\n    let toolpath = cls.tooldef().toolpath.trim();\r\n    let obj = this._getAccessor(cls);\r\n\r\n    if (!obj) {\r\n      console.warn(\"Warning, toolop \" + cls.name + \" was not in the default map; unregistered?\");\r\n      this._buildAccessors(cls, key, prop, this.dstruct, this.api);\r\n\r\n      obj = this.pathmap.get(toolpath);\r\n    }\r\n\r\n    if (!obj) {\r\n      console.error(\"Malformed toolpath in toolop definition: \" + toolpath);\r\n      return;\r\n    }\r\n\r\n    key = this.constructor.getPropKey(cls, key, prop);\r\n\r\n    //copy prop first in case we're a non-primitive-value type, e.g. vector properties\r\n    obj[key] = prop.copy().getValue();\r\n\r\n    let path = toolpath + \".\" + key;\r\n    this.userSetMap.add(path);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const SavedToolDefaults = new ToolPropertyCache();\r\n\r\nexport class ToolOp extends events.EventHandler {\r\n  /**\r\n   Main ToolOp constructor.  It reads the inputs/outputs properteis from\r\n   this.constructor.tooldef() and copies them to build this.inputs and this.outputs.\r\n   If inputs or outputs are wrapped in ToolOp.inherit(), it will walk up the class\r\n   chain to fetch parent class properties.\r\n\r\n\r\n   Default input values are loaded from SavedToolDefaults.  If initialized (buildToolSysAPI\r\n   has been called) SavedToolDefaults will have a copy of all the default\r\n   property values of all registered ToolOps.\r\n   **/\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._pointerId = undefined;\r\n    this._overdraw = undefined;\r\n    this.__memsize = undefined;\r\n\r\n    var def = this.constructor.tooldef();\r\n\r\n    if (def.undoflag !== undefined) {\r\n      this.undoflag = def.undoflag;\r\n    }\r\n\r\n    if (def.flag !== undefined) {\r\n      this.flag = def.flag;\r\n    }\r\n\r\n    this._accept = this._reject = undefined;\r\n    this._promise = undefined;\r\n\r\n    for (var k in def) {\r\n      this[k] = def[k];\r\n    }\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this.constructor;\r\n      let lastp = undefined;\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp && p !== lastp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        lastp = p;\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    if (dinputs) {\r\n      for (let k in dinputs) {\r\n        let prop = dinputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        if (!this.hasDefault(prop, k)) {\r\n          this.inputs[k] = prop;\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          prop.setValue(this.getDefault(prop, k));\r\n        } catch (error) {\r\n          console.log(error.stack);\r\n          console.log(error.message);\r\n        }\r\n\r\n        prop.wasSet = false;\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    if (doutputs) {\r\n      for (let k in doutputs) {\r\n        let prop = doutputs[k].copy();\r\n        prop.apiname = prop.apiname && prop.apiname.length > 0 ? prop.apiname : k;\r\n\r\n        this.outputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.drawlines = [];\r\n  }\r\n\r\n  /**\r\n   ToolOp definition.\r\n\r\n   An example:\r\n   <pre>\r\n   static tooldef() {\r\n    return {\r\n      uiname   : \"Tool Name\",\r\n      toolpath : \"logical_module.tool\", //logical_module need not match up to a real module\r\n      icon     : -1, //tool's icon, or -1 if there is none\r\n      description : \"tooltip\",\r\n      is_modal : false, //tool is interactive and takes control of events\r\n      hotkey   : undefined,\r\n      undoflag : 0, //see UndoFlags\r\n      flag     : 0,\r\n      inputs   : ToolOp.inherit({\r\n        f32val : new Float32Property(1.0),\r\n        path   : new StringProperty(\"./path\");\r\n      }),\r\n      outputs  : {}\r\n      }\r\n    }\r\n   </pre>\r\n   */\r\n  static tooldef() {\r\n    if (this === ToolOp) {\r\n      throw new Error(\"Tools must implemented static tooldef() methods!\");\r\n    }\r\n\r\n    return {};\r\n  }\r\n\r\n  /** Returns a map of input property values,\r\n   *  e.g. `let {prop1, prop2} = this.getValues()` */\r\n  getInputs() {\r\n    let ret = {};\r\n\r\n    for (let k in this.inputs) {\r\n      ret[k] = this.inputs[k].getValue();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static Equals(a, b) {\r\n    if (!a || !b) return false;\r\n    if (a.constructor !== b.constructor) return false;\r\n\r\n    let bad = false;\r\n\r\n    for (let k in a.inputs) {\r\n      bad = bad || !(k in b.inputs);\r\n      bad = bad || a.inputs[k].constructor !== b.inputs[k];\r\n      bad = bad || !a.inputs[k].equals(b.inputs[k]);\r\n\r\n      if (bad) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return !bad;\r\n  }\r\n\r\n  static inherit(slots = {}) {\r\n    return new InheritFlag(slots);\r\n  }\r\n\r\n  /**\r\n\r\n   Creates a new instance of this toolop from args and a context.\r\n   This is often use to fill properties with default arguments\r\n   stored somewhere in the context.\r\n\r\n   */\r\n  static invoke(ctx, args) {\r\n    let tool = new this();\r\n\r\n    for (let k in args) {\r\n      if (!(k in tool.inputs)) {\r\n        console.warn(\"Unknown tool argument \" + k);\r\n        continue;\r\n      }\r\n\r\n      let prop = tool.inputs[k];\r\n      let val = args[k];\r\n\r\n      if ((typeof val === \"string\") && prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (val in prop.values) {\r\n          val = prop.values[val];\r\n        } else {\r\n          console.warn(\"Possible invalid enum/flag:\", val);\r\n          continue;\r\n        }\r\n      }\r\n\r\n      tool.inputs[k].setValue(val);\r\n    }\r\n\r\n    return tool;\r\n  }\r\n\r\n  static register(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      console.warn(\"Tried to register same ToolOp class twice:\", cls.name, cls);\r\n      return;\r\n    }\r\n\r\n    ToolClasses.push(cls);\r\n  }\r\n\r\n  static _regWithNstructjs(cls, structName = cls.name) {\r\n    if (nstructjs.isRegistered(cls)) {\r\n      return;\r\n    }\r\n\r\n    let parent = cls.prototype.__proto__.constructor;\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      if (parent !== ToolOp && parent !== ToolMacro && parent !== Object) {\r\n        this._regWithNstructjs(parent);\r\n      }\r\n\r\n      cls.STRUCT = nstructjs.inherit(cls, parent) + '}\\n';\r\n    }\r\n\r\n    nstructjs.register(cls);\r\n  }\r\n\r\n  static isRegistered(cls) {\r\n    return ToolClasses.indexOf(cls) >= 0;\r\n  }\r\n\r\n  static unregister(cls) {\r\n    if (ToolClasses.indexOf(cls) >= 0) {\r\n      ToolClasses.remove(cls);\r\n    }\r\n  }\r\n\r\n  static _getFinalToolDef() {\r\n    let def = this.tooldef();\r\n\r\n    let getSlots = (slots, key) => {\r\n      if (slots === undefined)\r\n        return {};\r\n\r\n      if (!(slots instanceof InheritFlag)) {\r\n        return slots;\r\n      }\r\n\r\n      slots = {};\r\n      let p = this\r\n\r\n      while (p !== undefined && p !== Object && p !== ToolOp) {\r\n        if (p.tooldef) {\r\n          let def = p.tooldef();\r\n\r\n          if (def[key] !== undefined) {\r\n            let slots2 = def[key];\r\n            let stop = !(slots2 instanceof InheritFlag);\r\n\r\n            if (slots2 instanceof InheritFlag) {\r\n              slots2 = slots2.slots;\r\n            }\r\n\r\n            for (let k in slots2) {\r\n              if (!(k in slots)) {\r\n                slots[k] = slots2[k];\r\n              }\r\n            }\r\n\r\n            if (stop) {\r\n              break;\r\n            }\r\n          }\r\n\r\n        }\r\n        p = p.prototype.__proto__.constructor;\r\n      }\r\n\r\n      return slots;\r\n    };\r\n\r\n    let dinputs = getSlots(def.inputs, \"inputs\");\r\n    let doutputs = getSlots(def.outputs, \"outputs\");\r\n\r\n    def.inputs = dinputs;\r\n    def.outputs = doutputs;\r\n\r\n    return def;\r\n  }\r\n\r\n  static onTick() {\r\n    for (let toolop of modalstack) {\r\n      toolop.on_tick();\r\n    }\r\n  }\r\n\r\n  static searchBoxOk(ctx) {\r\n    let flag = this.tooldef().flag;\r\n    let ret = !(flag && (flag & ToolFlags.PRIVATE));\r\n    ret = ret && this.canRun(ctx);\r\n\r\n    return ret;\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  /** Called when the undo system needs to destroy\r\n   *  this toolop to save memory*/\r\n  onUndoDestroy() {\r\n\r\n  }\r\n\r\n  /** Used by undo system to limit memory */\r\n  calcMemSize(ctx) {\r\n    if (this.__memsize !== undefined) {\r\n      return this.__memsize;\r\n    }\r\n\r\n    let tot = 0;\r\n\r\n    for (let step = 0; step < 2; step++) {\r\n      let props = step ? this.outputs : this.inputs;\r\n\r\n      for (let k in props) {\r\n        let prop = props[k];\r\n\r\n        let size = prop.calcMemSize();\r\n\r\n        if (isNaN(size) || !isFinite(size)) {\r\n          console.warn(\"Got NaN when calculating mem size for property\", prop);\r\n          continue;\r\n        }\r\n\r\n        tot += size;\r\n      }\r\n    }\r\n\r\n    let size = this.calcUndoMem(ctx);\r\n\r\n    if (isNaN(size) || !isFinite(size)) {\r\n      console.warn(\"Got NaN in calcMemSize\", this);\r\n    } else {\r\n      tot += size;\r\n    }\r\n\r\n    this.__memsize = tot;\r\n\r\n    return tot;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (!force && prop.wasSet) {\r\n        continue;\r\n      }\r\n\r\n      if (this.hasDefault(prop, k)) {\r\n        prop.setValue(this.getDefault(prop, k));\r\n        prop.wasSet = false;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this.constructor, key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this.constructor;\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this.constructor, k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  genToolString() {\r\n    let def = this.constructor.tooldef();\r\n    let path = def.toolpath + \"(\";\r\n\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      path += k + \"=\";\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n\r\n      if (prop.type === PropTypes.FLOAT) {\r\n        path += prop.getValue().toFixed(3);\r\n      } else {\r\n        path += prop.getValue();\r\n      }\r\n\r\n      if (prop.type === PropTypes.STRING)\r\n        path += \"'\";\r\n      path += \" \";\r\n    }\r\n    path += \")\";\r\n    return path;\r\n  }\r\n\r\n  on_tick() {\r\n\r\n  }\r\n\r\n  /**default on_keydown implementation for modal tools,\r\n   no need to call super() to execute this if you don't want to*/\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.modalEnd(false);\r\n        break;\r\n      case keymap[\"Escape\"]:\r\n        this.modalEnd(true);\r\n        break;\r\n    }\r\n  }\r\n\r\n  //called after undoPre\r\n  calcUndoMem(ctx) {\r\n    console.warn(\"ToolOp.prototype.calcUndoMem: implement me!\");\r\n    return 0;\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  undo(ctx) {\r\n    throw new Error(\"implement me!\");\r\n    //_appstate.loadUndoFile(this._undo);\r\n  }\r\n\r\n  redo(ctx) {\r\n    this._was_redo = true; //also set by toolstack.redo\r\n\r\n    this.undoPre(ctx);\r\n    this.execPre(ctx);\r\n    this.exec(ctx);\r\n    this.execPost(ctx);\r\n  }\r\n\r\n  //for compatibility with fairmotion\r\n  exec_pre(ctx) {\r\n    this.execPre(ctx);\r\n  }\r\n\r\n  execPre(ctx) {\r\n  }\r\n\r\n  exec(ctx) {\r\n  }\r\n\r\n  execPost(ctx) {\r\n\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  resetTempGeom() {\r\n    var ctx = this.modal_ctx;\r\n\r\n    for (var dl of this.drawlines) {\r\n      dl.remove();\r\n    }\r\n\r\n    this.drawlines.length = 0;\r\n  }\r\n\r\n  error(msg) {\r\n    console.warn(msg);\r\n  }\r\n\r\n  getOverdraw() {\r\n    if (this._overdraw === undefined) {\r\n      this._overdraw = document.createElement(\"overdraw-x\");\r\n      this._overdraw.start(this.modal_ctx.screen);\r\n    }\r\n\r\n    return this._overdraw;\r\n  }\r\n\r\n  /**for use in modal mode only*/\r\n  makeTempLine(v1, v2, style) {\r\n    let line = this.getOverdraw().line(v1, v2, style);\r\n    this.drawlines.push(line);\r\n    return line;\r\n  }\r\n\r\n  pushModal(node) {\r\n    throw new Error(\"cannot call this; use modalStart\")\r\n  }\r\n\r\n  popModal() {\r\n    throw new Error(\"cannot call this; use modalEnd\");\r\n  }\r\n\r\n  /**returns promise to be executed on modalEnd*/\r\n  modalStart(ctx) {\r\n    if (this.modalRunning) {\r\n      console.warn(\"Warning, tool is already in modal mode consuming events\");\r\n      return this._promise;\r\n    }\r\n\r\n    this.modal_ctx = ctx;\r\n    this.modalRunning = true\r\n\r\n    this._promise = new Promise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n\r\n      modalstack.push(this);\r\n\r\n      if (this._pointerId !== undefined) {\r\n        super.pushPointerModal(ctx.screen, this._pointerId);\r\n      } else {\r\n        super.pushModal(ctx.screen);\r\n      }\r\n    });\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  /*eek, I've not been using this.\r\n    guess it's a non-enforced contract, I've been naming\r\n    cancel methods 'cancel' all this time.\r\n\r\n    XXX fix\r\n  */\r\n  toolCancel() {\r\n  }\r\n\r\n  modalEnd(was_cancelled) {\r\n    if (this._modalstate) {\r\n      modalstack.pop();\r\n    }\r\n\r\n    if (this._overdraw !== undefined) {\r\n      this._overdraw.end();\r\n      this._overdraw = undefined;\r\n    }\r\n\r\n    if (was_cancelled && this._on_cancel !== undefined) {\r\n      if (this._accept) {\r\n        this._accept(this.modal_ctx, true);\r\n      }\r\n\r\n      this._on_cancel(this);\r\n      this._on_cancel = undefined;\r\n    }\r\n\r\n    this.resetTempGeom();\r\n\r\n    var ctx = this.modal_ctx;\r\n\r\n    this.modal_ctx = undefined;\r\n    this.modalRunning = false;\r\n    this.is_modal = false;\r\n\r\n    super.popModal();\r\n\r\n    this._promise = undefined;\r\n\r\n    if (this._accept) {\r\n      this._accept(ctx, false);//Context, was_cancelled\r\n      this._accept = this._reject = undefined;\r\n    }\r\n\r\n    this.saveDefaultInputs();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    let outs = this.outputs;\r\n    let ins = this.inputs;\r\n\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n\r\n    for (let pair of ins) {\r\n      this.inputs[pair.key] = pair.val;\r\n    }\r\n\r\n    for (let pair of outs) {\r\n      this.outputs[pair.key] = pair.val;\r\n    }\r\n  }\r\n\r\n  _save_inputs() {\r\n    let ret = [];\r\n    for (let k in this.inputs) {\r\n      ret.push(new PropKey(k, this.inputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _save_outputs() {\r\n    let ret = [];\r\n    for (let k in this.outputs) {\r\n      ret.push(new PropKey(k, this.outputs[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nToolOp.STRUCT = `\r\ntoolsys.ToolOp {\r\n  inputs  : array(toolsys.PropKey) | this._save_inputs();\r\n  outputs : array(toolsys.PropKey) | this._save_outputs();\r\n}\r\n`;\r\nnstructjs.register(ToolOp);\r\n\r\nclass PropKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nPropKey.STRUCT = `\r\ntoolsys.PropKey {\r\n  key : string;\r\n  val : abstract(ToolProperty);\r\n}\r\n`;\r\nnstructjs.register(PropKey);\r\n\r\nexport class MacroLink {\r\n  constructor(sourcetool_idx, srckey, srcprops = \"outputs\", desttool_idx, dstkey, dstprops = \"inputs\") {\r\n    this.source = sourcetool_idx;\r\n    this.dest = desttool_idx;\r\n\r\n    this.sourceProps = srcprops;\r\n    this.destProps = dstprops;\r\n\r\n    this.sourcePropKey = srckey;\r\n    this.destPropKey = dstkey;\r\n  }\r\n}\r\n\r\nMacroLink.STRUCT = `\r\ntoolsys.MacroLink {\r\n  source         : int;\r\n  dest           : int;\r\n  sourcePropKey  : string;\r\n  destPropKey    : string;\r\n  sourceProps    : string;\r\n  destProps      : string; \r\n}\r\n`;\r\nnstructjs.register(MacroLink);\r\n\r\nexport const MacroClasses = {};\r\nwindow._MacroClasses = MacroClasses;\r\n\r\nlet macroidgen = 0;\r\n\r\n\r\nexport class ToolMacro extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.tools = [];\r\n    this.curtool = 0;\r\n    this.has_modal = false;\r\n    this.connects = [];\r\n    this.connectLinks = [];\r\n\r\n    this._macro_class = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname: \"Tool Macro\"\r\n    }\r\n  }\r\n\r\n  //toolop is an optional instance of this class, may be undefined\r\n  static canRun(ctx, toolop = undefined) {\r\n    return true;\r\n  }\r\n\r\n  _getTypeClass() {\r\n    if (this._macro_class && this._macro_class.ready) {\r\n      return this._macro_class;\r\n    }\r\n\r\n    if (!this._macro_class) {\r\n      this._macro_class = class MacroTypeClass extends ToolOp {\r\n        static tooldef() {\r\n          return this.__tooldef;\r\n        }\r\n      }\r\n\r\n      this._macro_class.__tooldef = {\r\n        toolpath: this.constructor.tooldef().toolpath || ''\r\n      };\r\n      this._macro_class.ready = false;\r\n    }\r\n\r\n    if (!this.tools || this.tools.length === 0) {\r\n      /* We've been invoked by ToolOp constructor,\r\n      *  for now just return an empty class  */\r\n      return this._macro_class;\r\n    }\r\n\r\n    let key = \"\";\r\n    for (let tool of this.tools) {\r\n      key = tool.constructor.name + \":\";\r\n    }\r\n\r\n    /* Handle child classes of ToolMacro */\r\n    if (this.constructor !== ToolMacro) {\r\n      key += \":\" + this.constructor.tooldef().toolpath;\r\n    }\r\n\r\n    for (let k in this.inputs) {\r\n      key += k + \":\";\r\n    }\r\n\r\n    if (key in MacroClasses) {\r\n      this._macro_class = MacroClasses[key];\r\n      return this._macro_class;\r\n    }\r\n\r\n    let name = \"Macro(\"\r\n    let i = 0;\r\n    let is_modal;\r\n\r\n    for (let tool of this.tools) {\r\n      let def = tool.constructor.tooldef();\r\n\r\n      if (i > 0) {\r\n        name += \", \";\r\n      } else {\r\n        is_modal = def.is_modal;\r\n      }\r\n\r\n      if (def.uiname) {\r\n        name += def.uiname;\r\n      } else if (def.toolpath) {\r\n        name += def.toolpath;\r\n      } else {\r\n        name += tool.constructor.name;\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    let inputs = {};\r\n\r\n    for (let k in this.inputs) {\r\n      inputs[k] = this.inputs[k].copy().clearEventCallbacks();\r\n      inputs[k].wasSet = false;\r\n    }\r\n\r\n    let tdef = {\r\n      uiname  : name,\r\n      toolpath: key,\r\n      inputs,\r\n      outputs : {},\r\n      is_modal\r\n    };\r\n\r\n    let cls = this._macro_class;\r\n    cls.__tooldef = tdef;\r\n    cls._macroTypeId = macroidgen++;\r\n    cls.ready = true;\r\n\r\n    /*\r\n    let cls = {\r\n      name : key,\r\n      tooldef() {\r\n        return tdef\r\n      },\r\n      _getFinalToolDef() {\r\n        return this.tooldef();\r\n      }\r\n    };//*/\r\n\r\n    MacroClasses[key] = cls;\r\n\r\n    return cls;\r\n  }\r\n\r\n  saveDefaultInputs() {\r\n    for (let k in this.inputs) {\r\n      let prop = this.inputs[k];\r\n\r\n      if (prop.flag & PropFlags.SAVE_LAST_VALUE) {\r\n        SavedToolDefaults.set(this._getTypeClass(), k, prop);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  hasDefault(toolprop, key = toolprop.apiname) {\r\n    return SavedToolDefaults.has(this._getTypeClass(), key, toolprop);\r\n  }\r\n\r\n  getDefault(toolprop, key = toolprop.apiname) {\r\n    let cls = this._getTypeClass();\r\n\r\n    if (SavedToolDefaults.has(cls, key, toolprop)) {\r\n      return SavedToolDefaults.get(cls, key, toolprop);\r\n    } else {\r\n      return toolprop.getValue();\r\n    }\r\n  }\r\n\r\n  connect(srctool, srcoutput, dsttool, dstinput, srcprops = \"outputs\", dstprops = \"inputs\") {\r\n    if (typeof dsttool === \"function\") {\r\n      return this.connectCB(...arguments);\r\n    }\r\n\r\n    let i1 = this.tools.indexOf(srctool);\r\n    let i2 = this.tools.indexOf(dsttool);\r\n\r\n    if (i1 < 0 || i2 < 0) {\r\n      throw new Error(\"tool not in macro\");\r\n    }\r\n\r\n    //remove linked properties from this.inputs\r\n    if (srcprops === \"inputs\") {\r\n      let tool = this.tools[i1];\r\n\r\n      let prop = tool.inputs[srcoutput];\r\n      if (prop === this.inputs[srcoutput]) {\r\n        delete this.inputs[srcoutput];\r\n      }\r\n    }\r\n\r\n    if (dstprops === \"inputs\") {\r\n      let tool = this.tools[i2];\r\n      let prop = tool.inputs[dstinput];\r\n\r\n      if (this.inputs[dstinput] === prop) {\r\n        delete this.inputs[dstinput];\r\n      }\r\n    }\r\n\r\n    this.connectLinks.push(new MacroLink(i1, srcoutput, srcprops, i2, dstinput, dstprops));\r\n    return this;\r\n  }\r\n\r\n  connectCB(srctool, dsttool, callback, thisvar) {\r\n    this.connects.push({\r\n      srctool : srctool,\r\n      dsttool : dsttool,\r\n      callback: callback,\r\n      thisvar : thisvar\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  add(tool) {\r\n    if (tool.is_modal) {\r\n      this.is_modal = true;\r\n    }\r\n\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (!(prop.flag & PropFlags.PRIVATE)) {\r\n        this.inputs[k] = prop;\r\n      }\r\n    }\r\n\r\n    this.tools.push(tool);\r\n\r\n    return this;\r\n  }\r\n\r\n  _do_connections(tool) {\r\n    let i = this.tools.indexOf(tool);\r\n\r\n    for (let c of this.connectLinks) {\r\n      if (c.source === i) {\r\n        let tool2 = this.tools[c.dest];\r\n\r\n        tool2[c.destProps][c.destPropKey].setValue(tool[c.sourceProps][c.sourcePropKey].getValue());\r\n      }\r\n    }\r\n\r\n    for (var c of this.connects) {\r\n      if (c.srctool === tool) {\r\n        c.callback.call(c.thisvar, c.srctool, c.dsttool);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n  canRun(ctx) {\r\n    if (this.tools.length == 0)\r\n      return false;\r\n\r\n    //poll first tool only in list\r\n    return this.tools[0].constructor.canRun(ctx);\r\n  }//*/\r\n\r\n  modalStart(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    this.loadDefaults(false);\r\n\r\n    this._promise = new Promise((function (accept, reject) {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }).bind(this));\r\n\r\n    this.curtool = 0;\r\n\r\n    let i;\r\n\r\n    for (i = 0; i < this.tools.length; i++) {\r\n      if (this.tools[i].is_modal)\r\n        break;\r\n\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n\r\n    var on_modal_end = (function on_modal_end() {\r\n      this._do_connections(this.tools[this.curtool]);\r\n      this.curtool++;\r\n\r\n      while (this.curtool < this.tools.length &&\r\n      !this.tools[this.curtool].is_modal) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].execPre(ctx);\r\n        this.tools[this.curtool].exec(ctx);\r\n        this.tools[this.curtool].execPost(ctx);\r\n        this._do_connections(this.tools[this.curtool]);\r\n\r\n        this.curtool++;\r\n      }\r\n\r\n      if (this.curtool < this.tools.length) {\r\n        this.tools[this.curtool].undoPre(ctx);\r\n        this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n      } else {\r\n        this._accept(this, false);\r\n      }\r\n    }).bind(this);\r\n\r\n    if (i < this.tools.length) {\r\n      this.curtool = i;\r\n      this.tools[this.curtool].undoPre(ctx);\r\n      this.tools[this.curtool].modalStart(ctx).then(on_modal_end);\r\n    }\r\n\r\n    return this._promise;\r\n  }\r\n\r\n  loadDefaults(force = true) {\r\n    return super.loadDefaults(force);\r\n  }\r\n\r\n  exec(ctx) {\r\n    //macros obviously can't call loadDefaults in the constructor\r\n    //like normal tool ops can.\r\n    //note that this will detect if the user changes property values\r\n\r\n    this.loadDefaults(false);\r\n\r\n    for (var i = 0; i < this.tools.length; i++) {\r\n      this.tools[i].undoPre(ctx);\r\n      this.tools[i].execPre(ctx);\r\n      this.tools[i].exec(ctx);\r\n      this.tools[i].execPost(ctx);\r\n      this._do_connections(this.tools[i]);\r\n    }\r\n  }\r\n\r\n  calcUndoMem(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcUndoMem(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  calcMemSize(ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this.tools) {\r\n      tot += tool.calcMemSize(ctx);\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  undoPre() {\r\n    return; //undoPre is handled in exec() or modalStart()\r\n  }\r\n\r\n  undo(ctx) {\r\n    for (var i = this.tools.length - 1; i >= 0; i--) {\r\n      this.tools[i].undo(ctx);\r\n    }\r\n  }\r\n}\r\n\r\nToolMacro.STRUCT = nstructjs.inherit(ToolMacro, ToolOp, \"toolsys.ToolMacro\") + `\r\n  tools        : array(abstract(toolsys.ToolOp));\r\n  connectLinks : array(toolsys.MacroLink);\r\n}\r\n`;\r\nnstructjs.register(ToolMacro);\r\n\r\nexport class ToolStack extends Array {\r\n  constructor(ctx) {\r\n    super();\r\n\r\n    this.memLimit = 512*1024*1024;\r\n    this.enforceMemLimit = false;\r\n\r\n    this.cur = -1;\r\n    this.ctx = ctx;\r\n\r\n    this.modalRunning = 0;\r\n\r\n    this._undo_branch = undefined; //used to save undo branch in case of tool cancel\r\n  }\r\n\r\n  get head() {\r\n    return this[this.cur];\r\n  }\r\n\r\n  limitMemory(maxmem = this.memLimit, ctx = this.ctx) {\r\n    if (maxmem === undefined) {\r\n      throw new Error(\"maxmem cannot be undefined\");\r\n    }\r\n\r\n    let size = this.calcMemSize();\r\n\r\n    let start = 0;\r\n\r\n    while (start < this.cur - 2 && size > maxmem) {\r\n      size -= this[start].calcMemSize(ctx);\r\n      start++;\r\n    }\r\n\r\n    if (start === 0) {\r\n      return size;\r\n    }\r\n\r\n    for (let i = 0; i < start; i++) {\r\n      this[i].onUndoDestroy();\r\n    }\r\n\r\n    this.cur -= start;\r\n\r\n    for (let i = 0; i < this.length - start; i++) {\r\n      this[i] = this[i + start];\r\n    }\r\n    this.length -= start;\r\n\r\n    return this.calcMemSize(ctx);\r\n  }\r\n\r\n  calcMemSize(ctx = this.ctx) {\r\n    let tot = 0;\r\n\r\n    for (let tool of this) {\r\n      try {\r\n        tot += tool.calcMemSize();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to execute a calcMemSize method\");\r\n      }\r\n    }\r\n\r\n    return tot;\r\n  }\r\n\r\n  setRestrictedToolContext(ctx) {\r\n    this.toolctx = ctx;\r\n  }\r\n\r\n  reset(ctx) {\r\n    if (ctx !== undefined) {\r\n      this.ctx = ctx;\r\n    }\r\n\r\n    this.modalRunning = 0;\r\n    this.cur = -1;\r\n    this.length = 0;\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, tool, compareInputs = false) {\r\n    let head = this.head;\r\n\r\n    let ok = compareInputs ? ToolOp.Equals(head, tool) : head && head.constructor === tool.constructor;\r\n\r\n    tool.__memsize = undefined; //reset cache memsize\r\n\r\n    if (ok) {\r\n      //console.warn(\"Same tool detected\");\r\n\r\n      this.undo();\r\n\r\n      //can inputs differ? in that case, execute new tool\r\n      if (!compareInputs) {\r\n        this.execTool(ctx, tool);\r\n      } else {\r\n        this.rerun();\r\n      }\r\n\r\n      return false;\r\n    } else {\r\n      this.execTool(ctx, tool);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  execTool(ctx, toolop) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit, ctx);\r\n    }\r\n\r\n    if (!toolop.constructor.canRun(ctx, toolop)) {\r\n      console.log(\"toolop.constructor.canRun returned false\");\r\n      return;\r\n    }\r\n\r\n    let tctx = ctx.toLocked();\r\n\r\n    let undoflag = toolop.constructor.tooldef().undoflag;\r\n    if (toolop.undoflag !== undefined) {\r\n      undoflag = toolop.undoflag;\r\n    }\r\n    undoflag = undoflag === undefined ? 0 : undoflag;\r\n\r\n    //if (!(undoflag & UndoFlags.IS_UNDO_ROOT) && !(undoflag & UndoFlags.NO_UNDO)) {\r\n    //tctx = new SavedContext(ctx, ctx.datalib);\r\n    //}\r\n\r\n    toolop.execCtx = tctx;\r\n\r\n    if (!(undoflag & UndoFlags.NO_UNDO)) {\r\n      this.cur++;\r\n\r\n      //save branch for if tool cancel\r\n      this._undo_branch = this.slice(this.cur + 1, this.length);\r\n\r\n      //truncate\r\n      this.length = this.cur + 1;\r\n\r\n      this[this.cur] = toolop;\r\n      toolop.undoPre(tctx);\r\n    }\r\n\r\n    if (toolop.is_modal) {\r\n      ctx = toolop.modal_ctx = ctx;\r\n\r\n      this.modal_running = true;\r\n\r\n      toolop._on_cancel = (function (toolop) {\r\n        if (!(toolop.undoflag & UndoFlags.NO_UNDO)) {\r\n          this[this.cur].undo(ctx);\r\n          this.pop_i(this.cur);\r\n          this.cur--;\r\n        }\r\n      }).bind(this);\r\n\r\n      //will handle calling .exec itself\r\n      toolop.modalStart(ctx);\r\n    } else {\r\n      toolop.execPre(tctx);\r\n      toolop.exec(tctx);\r\n      toolop.execPost(tctx);\r\n      toolop.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  toolCancel(ctx, tool) {\r\n    if (tool._was_redo) { //also set by toolstack.redo\r\n      //ignore tool cancel requests on redo\r\n      return;\r\n    }\r\n\r\n    if (tool !== this[this.cur]) {\r\n      console.warn(\"toolCancel called in error\", this, tool);\r\n      return;\r\n    }\r\n\r\n    this.undo();\r\n    this.length = this.cur + 1;\r\n\r\n    if (this._undo_branch !== undefined) {\r\n      for (let item of this._undo_branch) {\r\n        this.push(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  undo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= 0 && !(this[this.cur].undoflag & UndoFlags.IS_UNDO_ROOT)) {\r\n      let tool = this[this.cur];\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      this.cur--;\r\n    }\r\n  }\r\n\r\n  //reruns a tool if it's at the head of the stack\r\n  rerun(tool) {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (tool === this[this.cur]) {\r\n      tool._was_redo = false;\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool.undo(tool.execCtx);\r\n\r\n      tool._was_redo = true; //also set by toolstack.redo\r\n\r\n      tool.undoPre(tool.execCtx);\r\n      tool.execPre(tool.execCtx);\r\n      tool.exec(tool.execCtx);\r\n      tool.execPost(tool.execCtx);\r\n    } else {\r\n      console.warn(\"Tool wasn't at head of stack\", tool);\r\n    }\r\n  }\r\n\r\n  redo() {\r\n    if (this.enforceMemLimit) {\r\n      this.limitMemory(this.memLimit);\r\n    }\r\n\r\n    if (this.cur >= -1 && this.cur + 1 < this.length) {\r\n      //console.log(\"redo!\", this.cur, this.length);\r\n\r\n      this.cur++;\r\n      let tool = this[this.cur];\r\n\r\n\r\n      if (!tool.execCtx) {\r\n        tool.execCtx = this.ctx;\r\n      }\r\n\r\n      tool._was_redo = true;\r\n      tool.redo(tool.execCtx);\r\n\r\n      tool.saveDefaultInputs();\r\n    }\r\n  }\r\n\r\n  save() {\r\n    let data = [];\r\n    nstructjs.writeObject(data, this);\r\n    return data;\r\n  }\r\n\r\n  rewind() {\r\n    while (this.cur >= 0) {\r\n      let last = this.cur;\r\n      this.undo();\r\n\r\n      //prevent infinite loops\r\n      if (last === this.cur) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**cb is a function(ctx), if it returns the value false then playback stops\r\n   promise will still be fulfilled.\r\n\r\n   onstep is a callback, if it returns a promise that promise will be\r\n   waited on, otherwise execution is queue with window.setTimeout().\r\n   */\r\n  replay(cb, onStep) {\r\n    let cur = this.cur;\r\n\r\n    this.rewind();\r\n\r\n    let last = this.cur;\r\n\r\n    let start = util.time_ms();\r\n\r\n    return new Promise((accept, reject) => {\r\n      let next = () => {\r\n        last = this.cur;\r\n\r\n        if (cb && cb(ctx) === false) {\r\n          accept();\r\n          return;\r\n        }\r\n\r\n        if (this.cur < this.length) {\r\n          this.cur++;\r\n          this.rerun();\r\n        }\r\n\r\n        if (last === this.cur) {\r\n          console.warn(\"time:\", (util.time_ms() - start)/1000.0);\r\n          accept(this);\r\n        } else {\r\n          if (onStep) {\r\n            let ret = onStep();\r\n\r\n            if (ret && ret instanceof Promise) {\r\n              ret.then(() => {\r\n                next();\r\n              });\r\n            } else {\r\n              window.setTimeout(() => {\r\n                next();\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      next();\r\n    });\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    for (let item of this._stack) {\r\n      this.push(item);\r\n    }\r\n\r\n    delete this._stack;\r\n  }\r\n\r\n  //note that this makes sure tool classes are registered with nstructjs\r\n  //during save\r\n  _save() {\r\n    for (let tool of this) {\r\n      let cls = tool.constructor;\r\n\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        cls._regWithNstructjs(cls);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nToolStack.STRUCT = `\r\ntoolsys.ToolStack {\r\n  cur    : int;\r\n  _stack : array(abstract(toolsys.ToolOp)) | this._save();\r\n}\r\n`;\r\nnstructjs.register(ToolStack);\r\n\r\nwindow._testToolStackIO = function () {\r\n  let data = [];\r\n  let cls = _appstate.toolstack.constructor;\r\n\r\n  nstructjs.writeObject(data, _appstate.toolstack);\r\n  data = new DataView(new Uint8Array(data).buffer);\r\n\r\n  let toolstack = nstructjs.readObject(data, cls);\r\n\r\n  _appstate.toolstack.rewind();\r\n\r\n  toolstack.cur = -1;\r\n  toolstack.ctx = _appstate.toolstack.ctx;\r\n  _appstate.toolstack = toolstack;\r\n\r\n  return toolstack;\r\n}\r\n\r\nexport function buildToolOpAPI(api, cls) {\r\n  let st = api.mapStruct(cls, true);\r\n  let def = cls._getFinalToolDef();\r\n\r\n  if (window.DEBUG && window.DEBUG.datapaths) {\r\n    console.log(\"Building api for \", def.toolpath);\r\n  }\r\n\r\n  function makeProp(k) {\r\n    let prop = def.inputs[k];\r\n\r\n    if (prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY)) {\r\n      return;\r\n    }\r\n\r\n    prop.uiname = prop.uiname || ToolProperty.makeUIName(k);\r\n\r\n    let dpath = new DataPath(k, k, prop);\r\n    st.add(dpath);\r\n\r\n    dpath.customGetSet(function () {\r\n      return this.dataref.inputs[k].getValue()\r\n    }, function (val) {\r\n      this.dataref.inputs[k].setValue(val);\r\n    });\r\n  }\r\n\r\n  for (let k in def.inputs) {\r\n    makeProp(k);\r\n  }\r\n\r\n  return st;\r\n}\r\n\r\n/**\r\n * Call this to build the tool property cache data binding API.\r\n *\r\n * If rootCtxClass is not undefined and insertToolDefaultsIntoContext is true\r\n * then \".toolDefaults\" will be automatically added to rootCtxClass's prototype\r\n * if necessary.\r\n */\r\nexport function buildToolSysAPI(api, registerWithNStructjs    = true,\r\n                                rootCtxStruct                 = undefined,\r\n                                rootCtxClass                  = undefined,\r\n                                insertToolDefaultsIntoContext = true) {\r\n  let datastruct = api.mapStruct(ToolPropertyCache, true);\r\n\r\n  for (let cls of ToolClasses) {\r\n    let def = cls._getFinalToolDef();\r\n\r\n    buildToolOpAPI(api, cls);\r\n\r\n    for (let k in def.inputs) {\r\n      let prop = def.inputs[k];\r\n\r\n      if (!(prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY))) {\r\n        SavedToolDefaults._buildAccessors(cls, k, prop, datastruct, api);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (rootCtxStruct) {\r\n    rootCtxStruct.struct(\"toolDefaults\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n    rootCtxStruct.dynamicStruct(\"last_tool\", \"last_tool\", \"Last Tool\");\r\n  }\r\n\r\n  if (rootCtxClass && insertToolDefaultsIntoContext) {\r\n    let inst = new rootCtxClass({});\r\n\r\n    function haveprop(k) {\r\n      return Reflect.ownKeys(inst).indexOf(k) >= 0\r\n        || Reflect.ownKeys(rootCtxClass.prototype).indexOf(k) >= 0;\r\n    }\r\n\r\n    if (!haveprop(\"last_tool\")) {\r\n      Object.defineProperty(rootCtxClass.prototype, \"last_tool\", {\r\n        get() {\r\n          return this.toolstack.head;\r\n        }\r\n      });\r\n\r\n      if (Context.isContextSubclass(rootCtxClass)) {\r\n        rootCtxClass.prototype.last_tool_save = () => ({});\r\n        rootCtxClass.prototype.last_tool_load = () => undefined;\r\n      }\r\n    }\r\n\r\n    if (!haveprop(\"toolDefaults\")) {\r\n      Object.defineProperty(rootCtxClass.prototype, \"toolDefaults\", {\r\n        get() {\r\n          return SavedToolDefaults;\r\n        }\r\n      });\r\n\r\n      if (Context.isContextSubclass(rootCtxClass)) {\r\n        rootCtxClass.prototype.toolDefaults_save = () => ({});\r\n        rootCtxClass.prototype.toolDefaults_load = () => undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!registerWithNStructjs) {\r\n    return;\r\n  }\r\n\r\n  //register tools with nstructjs\r\n  for (let cls of ToolClasses) {\r\n    try {\r\n      if (!nstructjs.isRegistered(cls)) {\r\n        ToolOp._regWithNstructjs(cls);\r\n      }\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.error(\"Failed to register a tool with nstructjs\");\r\n    }\r\n  }\r\n}\r\n", "\"use strict\";\r\n\r\n/**\r\n *\r\n * A not-so-simple 1d bspline curve class.\r\n *\r\n * It's actually a 2d bspline curve class that\r\n * uses a root finding algorithm to find the value\r\n * along the x dimension.\r\n *\r\n * To make things worse, due to the rule that widgets\r\n * cannot store direct references into the data model\r\n * there is a lot of weird event handling code that's\r\n * used by curve widgets to sync their internal curve copy\r\n * and the model.\r\n **/\r\nimport nstructjs from \"../util/struct.js\";\r\nimport config from '../config/config.js';\r\nimport {ToolOp} from '../toolsys/toolsys.js';\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\n//import {EventDispatcher} from \"../util/events.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nexport const SplineTemplates = {\r\n  CONSTANT      : 0,\r\n  LINEAR        : 1,\r\n  SHARP         : 2,\r\n  SQRT          : 3,\r\n  SMOOTH        : 4,\r\n  SMOOTHER      : 5,\r\n  SHARPER       : 6,\r\n  SPHERE        : 7,\r\n  REVERSE_LINEAR: 8,\r\n  GUASSIAN      : 9\r\n};\r\n\r\nconst templates = {\r\n  [SplineTemplates.CONSTANT]      : [\r\n    [1, 1], [1, 1]\r\n  ],\r\n  [SplineTemplates.LINEAR]        : [\r\n    [0, 0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARP]         : [\r\n    [0, 0], [0.9999, 0.0001], [1, 1]\r\n  ],\r\n  [SplineTemplates.SQRT]          : [\r\n    [0, 0], [0.05, 0.25], [0.15, 0.45], [0.33, 0.65], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTH]        : [\r\n    \"DEG\", 3, [0, 0], [1.0/3.0, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SMOOTHER]      : [\r\n    \"DEG\", 6, [0, 0], [1.0/2.25, 0], [2.0/3.0, 1.0], [1, 1]\r\n  ],\r\n  [SplineTemplates.SHARPER]       : [\r\n    [0, 0], [0.3, 0.03], [0.7, 0.065], [0.9, 0.16], [1, 1]\r\n  ],\r\n  [SplineTemplates.SPHERE]        : [\r\n    [0, 0], [0.01953, 0.23438], [0.08203, 0.43359], [0.18359, 0.625], [0.35938, 0.81641], [0.625, 0.97656], [1, 1]\r\n  ],\r\n  [SplineTemplates.REVERSE_LINEAR]: [\r\n    [0, 1], [1, 0]\r\n  ],\r\n  [SplineTemplates.GUASSIAN]      : [\r\n    \"DEG\", 5, [0, 0], [0.17969, 0.007], [0.48958, 0.01172], [0.77995, 0.99609], [1, 1]\r\n  ]\r\n};\r\n\r\n//is initialized below\r\nexport const SplineTemplateIcons = {};\r\n\r\nlet RecalcFlags = {\r\n  BASIS: 1,\r\n  FULL : 2,\r\n  ALL  : 3,\r\n\r\n  //private flag\r\n  FULL_BASIS: 4\r\n}\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\n\r\nlet bin_cache = {};\r\nwindow._bin_cache = bin_cache;\r\n\r\nlet eval2_rets = util.cachering.fromConstructor(Vector2, 32);\r\n\r\n/*\r\n  I hate these stupid curve widgets.  This horrible one here works by\r\n  root-finding the x axis on a two dimensional b-spline (which works\r\n  surprisingly well).\r\n*/\r\n\r\nfunction bez3(a, b, c, t) {\r\n  let r1 = a + (b - a)*t;\r\n  let r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  let r1 = bez3(a, b, c, t);\r\n  let r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport function binomial(n, i) {\r\n  if (i > n) {\r\n    throw new Error(\"Bad call to binomial(n, i), i was > than n\");\r\n  }\r\n\r\n  if (i === 0 || i === n) {\r\n    return 1;\r\n  }\r\n\r\n  let key = \"\" + n + \",\" + i;\r\n\r\n  if (key in bin_cache)\r\n    return bin_cache[key];\r\n\r\n  let ret = binomial(n - 1, i - 1) + bin(n - 1, i);\r\n  bin_cache[key] = ret;\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.bin = binomial;\r\n\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\nimport {\r\n  BoolProperty, EnumProperty, FloatProperty, IntProperty, StringProperty, Vec2Property\r\n} from '../toolsys/toolprop.js';\r\n\r\nexport class Curve1dBSplineOpBase extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      inputs : {\r\n        dataPath: new StringProperty()\r\n      },\r\n      outputs: {},\r\n    };\r\n  }\r\n\r\n  _undo = undefined;\r\n\r\n  undoPre(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      this._undo = curve1d.copy();\r\n    } else {\r\n      this._undo = undefined;\r\n    }\r\n  }\r\n\r\n  undo(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.load(this._undo);\r\n      curve1d._fireEvent(\"update\", curve1d);\r\n    }\r\n  }\r\n\r\n  getCurve1d(ctx) {\r\n    let {dataPath} = this.getInputs();\r\n\r\n    let curve1d;\r\n    try {\r\n      curve1d = ctx.api.getValue(ctx, dataPath);\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"Failed to lookup curve1d property at path \", dataPath);\r\n      return;\r\n    }\r\n\r\n    return curve1d;\r\n  }\r\n\r\n  execPost(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d._fireEvent(\"update\", curve1d);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Curve1dBSplineResetOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.reset_bspline\",\r\n      inputs  : ToolOp.inherit({}),\r\n      outputs : {},\r\n    }\r\n  }\r\n\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.reset();\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineResetOp);\r\n\r\nexport class Curve1dBSplineLoadTemplOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_load_template\",\r\n      inputs  : ToolOp.inherit({\r\n        template: new EnumProperty(SplineTemplates.SMOOTH, SplineTemplates)\r\n      }),\r\n      outputs : {},\r\n    }\r\n  }\r\n\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    let {template} = this.getInputs();\r\n\r\n    if (curve1d) {\r\n      curve1d.generators.active.loadTemplate(template);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineLoadTemplOp);\r\n\r\nexport class Curve1dBSplineDeleteOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_delete_point\",\r\n      inputs  : ToolOp.inherit({}),\r\n      outputs : {},\r\n    }\r\n  }\r\n\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      curve1d.generators.active.deletePoint();\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineDeleteOp);\r\n\r\nexport class Curve1dBSplineSelectOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_select_point\",\r\n      inputs  : ToolOp.inherit({\r\n        point : new IntProperty(-1),\r\n        state : new BoolProperty(true),\r\n        unique: new BoolProperty(true),\r\n      }),\r\n      outputs : {},\r\n    }\r\n  }\r\n\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n      let {point, state, unique} = this.getInputs();\r\n\r\n      for (let p of bspline.points) {\r\n        if (p.eid === point) {\r\n          if (state) {\r\n            p.flag |= CurveFlags.SELECT;\r\n          } else {\r\n            p.flag &= ~CurveFlags.SELECT;\r\n          }\r\n        } else if (unique) {\r\n          p.flag &= ~CurveFlags.SELECT;\r\n        }\r\n      }\r\n\r\n      curve1d._fireEvent(\"select\", bspline);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineSelectOp);\r\n\r\nexport class Curve1dBSplineAddOp extends Curve1dBSplineOpBase {\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.bspline_add_point\",\r\n      inputs  : ToolOp.inherit({\r\n        x: new FloatProperty(),\r\n        y: new FloatProperty()\r\n      }),\r\n      outputs : {},\r\n    }\r\n  }\r\n\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let {x, y} = this.getInputs();\r\n      curve1d.generators.active.addFromMouse(x, y);\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(Curve1dBSplineAddOp);\r\n\r\nexport class BSplineTransformOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.first = true;\r\n    this.start_mpos = new Vector2();\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      toolpath: \"curve1d.transform_bspline\",\r\n      inputs  : {\r\n        dataPath: new StringProperty(),\r\n        off     : new Vec2Property(),\r\n        dpi     : new FloatProperty(1.0),\r\n      },\r\n      is_modal: true,\r\n      outputs : {},\r\n    };\r\n  }\r\n\r\n  _undo = undefined;\r\n\r\n  storePoints(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n      return Array.from(bspline.points).map(p => p.copy());\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  loadPoints(ctx, ps) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n\r\n    if (curve1d) {\r\n      let bspline = curve1d.generators.active;\r\n\r\n      for (let p1 of bspline.points) {\r\n        for (let p2 of ps) {\r\n          if (p2.eid === p1.eid) {\r\n            p1.co.load(p2.co);\r\n            p1.rco.load(p2.rco);\r\n            p1.sco.load(p2.sco);\r\n          }\r\n        }\r\n      }\r\n\r\n      bspline.parent._fireEvent(\"transform\", bspline);\r\n\r\n      bspline.recalc = RecalcFlags.ALL;\r\n      bspline.updateKnots();\r\n      bspline.update();\r\n      bspline.redraw();\r\n    }\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    this._undo = this.storePoints(ctx);\r\n  }\r\n\r\n  undo(ctx) {\r\n    this.loadPoints(ctx, this._undo);\r\n  }\r\n\r\n  getCurve1d(ctx) {\r\n    let {dataPath} = this.getInputs();\r\n\r\n    let curve1d;\r\n    try {\r\n      curve1d = ctx.api.getValue(ctx, dataPath);\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"Failed to lookup curve1d property at path \", dataPath);\r\n      return;\r\n    }\r\n\r\n    return curve1d;\r\n  }\r\n\r\n  finish(cancel = false) {\r\n    let ctx = this.modal_ctx;\r\n    this.modalEnd(cancel);\r\n\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.fastmode = false;\r\n    }\r\n\r\n    if (cancel) {\r\n      this.undo(ctx);\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(ctx);\r\n\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (!curve1d) {\r\n      console.log(\"Failed to get curve1d!\");\r\n      return;\r\n    }\r\n\r\n    let bspline = curve1d.generators.active;\r\n    for (let p of bspline.points) {\r\n      p.startco.load(p.co);\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let mpos = new Vector2().loadXY(e.x, e.y);\r\n    if (this.first) {\r\n      this.start_mpos.load(mpos);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n    let curve1d = this.getCurve1d(this.modal_ctx);\r\n    if (curve1d) {\r\n      curve1d.generators.active.fastmode = true;\r\n    }\r\n\r\n    const {dpi} = this.getInputs();\r\n    let off = new Vector2(mpos).sub(this.start_mpos).mulScalar(dpi);\r\n    off[1] = -off[1];\r\n\r\n    this.inputs.off.setValue(off);\r\n\r\n    const bspline = curve1d.generators.active;\r\n    for (let p of bspline.points) {\r\n      p.co.load(p.startco);\r\n    }\r\n\r\n    this.exec(this.modal_ctx);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  exec(ctx) {\r\n    let curve1d = this.getCurve1d(ctx);\r\n    if (!curve1d) {\r\n      return;\r\n    }\r\n\r\n    let bspline = curve1d.generators.active;\r\n    let {off} = this.getInputs();\r\n\r\n    const xRange = curve1d.xRange, yRange = curve1d.yRange;\r\n\r\n    for (let p of bspline.points) {\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        p.co.add(off);\r\n        p.co[0] = Math.min(Math.max(p.co[0], xRange[0]), xRange[1]);\r\n        p.co[1] = Math.min(Math.max(p.co[1], yRange[0]), yRange[1]);\r\n      }\r\n    }\r\n\r\n    bspline.parent._fireEvent(\"transform\", bspline);\r\n\r\n    bspline.recalc = RecalcFlags.ALL;\r\n    bspline.updateKnots();\r\n    bspline.update();\r\n    bspline.redraw();\r\n  }\r\n}\r\n\r\nToolOp.register(BSplineTransformOp);\r\n\r\nexport class Curve1DPoint {\r\n  constructor(co) {\r\n    this.co = new Vector2(co);\r\n    this.rco = new Vector2(co);\r\n    this.sco = new Vector2(co);\r\n\r\n    //for transform\r\n    this.startco = new Vector2();\r\n    this.eid = -1;\r\n    this.flag = 0;\r\n\r\n    this.tangent = TangentModes.SMOOTH;\r\n\r\n    Object.seal(this);\r\n  }\r\n\r\n  get 0() {\r\n    throw new Error(\"Curve1DPoint get 0\");\r\n  }\r\n\r\n  get 1() {\r\n    throw new Error(\"Curve1DPoint get 1\");\r\n  }\r\n\r\n  /* Needed for file compatibility. */\r\n  set 0(v) {\r\n    this.co[0] = v;\r\n  }\r\n\r\n  set 1(v) {\r\n    this.co[1] = v;\r\n  }\r\n\r\n  load(b) {\r\n    this.eid = b.eid;\r\n    this.flag = b.flag;\r\n    this.tangent = b.tangent;\r\n\r\n    this.co.load(b.co);\r\n    this.rco.load(b.rco);\r\n    this.sco.load(b.sco);\r\n    this.startco.load(b.startco);\r\n\r\n    return this;\r\n  }\r\n\r\n  set deg(v) {\r\n    console.warn(\"old file data detected\");\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    let ret = new Curve1DPoint(obj);\r\n\r\n    if (\"0\" in obj) {\r\n      ret.co[0] = obj[0];\r\n      ret.co[1] = obj[1];\r\n    } else {\r\n      ret.co.load(obj.co);\r\n    }\r\n\r\n    ret.startco.load(obj.startco);\r\n    ret.eid = obj.eid;\r\n    ret.flag = obj.flag;\r\n    ret.tangent = obj.tangent;\r\n\r\n    ret.rco.load(obj.rco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new Curve1DPoint(this.co);\r\n\r\n    ret.tangent = this.tangent;\r\n    ret.flag = this.flag;\r\n    ret.eid = this.eid;\r\n\r\n    ret.startco.load(this.startco);\r\n    ret.rco.load(this.rco);\r\n    ret.sco.load(this.sco);\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      co     : this.co,\r\n      eid    : this.eid,\r\n      flag   : this.flag,\r\n      tangent: this.tangent,\r\n\r\n      rco    : this.rco,\r\n      startco: this.startco,\r\n    };\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.sco.load(this.co);\r\n    this.rco.load(this.co);\r\n\r\n    splineCache.update(this);\r\n  }\r\n};\r\nCurve1DPoint.STRUCT = `\r\nCurve1DPoint {\r\n  co      : vec2;\r\n  rco     : vec2;\r\n  sco     : vec2;\r\n  startco : vec2;\r\n  eid     : int;\r\n  flag    : int;\r\n  tangent : int;\r\n}\r\n`;\r\nnstructjs.register(Curve1DPoint);\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nclass BSplineCache {\r\n  constructor() {\r\n    this.curves = [];\r\n    this.map = new Map();\r\n    this.maxCurves = 32;\r\n    this.gen = 0;\r\n  }\r\n\r\n  limit() {\r\n    if (this.curves.length <= this.maxCurves) {\r\n      return;\r\n    }\r\n\r\n    this.curves.sort((a, b) => b.cache_w - a.cache_w);\r\n    while (this.curves.length > this.maxCurves) {\r\n      let curve = this.curves.pop();\r\n      this.map.delete(curve.calcHashKey());\r\n    }\r\n  }\r\n\r\n  has(curve) {\r\n    let curve2 = this.map.get(curve.calcHashKey());\r\n    return curve2 && curve2.equals(curve);\r\n  }\r\n\r\n  get(curve) {\r\n    let key = curve.calcHashKey();\r\n    curve._last_cache_key = key;\r\n\r\n    let curve2 = this.map.get(key);\r\n    if (curve2 && curve2.equals(curve)) {\r\n      curve2.cache_w = this.gen++;\r\n      return curve2;\r\n    }\r\n\r\n    curve2 = curve.copy();\r\n    curve2._last_cache_key = key;\r\n\r\n    curve2.updateKnots();\r\n    curve2.regen_basis();\r\n    curve2.regen_hermite();\r\n\r\n    this.map.set(curve2);\r\n    this.curves.push(curve2);\r\n\r\n    curve2.cache_w = this.gen++;\r\n\r\n    this.limit();\r\n\r\n    return curve2;\r\n  }\r\n\r\n  _remove(key) {\r\n    let curve = this.map.get(key);\r\n    this.map.delete(key);\r\n    this.curves.remove(curve);\r\n  }\r\n\r\n  update(curve) {\r\n    let key = curve._last_cache_key;\r\n\r\n    if (this.map.has(key)) {\r\n      this._remove(curve);\r\n      this.get(curve);\r\n    }\r\n  }\r\n}\r\n\r\nlet splineCache = new BSplineCache();\r\nwindow._splineCache = splineCache;\r\n\r\nlet _idgen = 1;\r\n\r\nclass BSplineCurve extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this._bid = _idgen++;\r\n\r\n    this._degOffset = 0;\r\n    this.cache_w = 0;\r\n    this._last_cache_key = 0;\r\n\r\n    this.fastmode = false;\r\n    this.points = [];\r\n    this.length = 0;\r\n    this.interpolating = false;\r\n\r\n    this._ps = [];\r\n    this.hermite = [];\r\n    this.fastmode = false;\r\n\r\n    this.deg = 6;\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.basis_tables = [];\r\n    this.eidgen = new util.IDGen();\r\n\r\n    this.add(0, 0);\r\n    this.add(1, 1);\r\n\r\n    this.mpos = new Vector2();\r\n\r\n    this.on_mousedown = this.on_mousedown.bind(this);\r\n    this.on_mousemove = this.on_mousemove.bind(this);\r\n    this.on_mouseup = this.on_mouseup.bind(this);\r\n    this.on_keydown = this.on_keydown.bind(this);\r\n    this.on_touchstart = this.on_touchstart.bind(this);\r\n    this.on_touchmove = this.on_touchmove.bind(this);\r\n    this.on_touchend = this.on_touchend.bind(this);\r\n    this.on_touchcancel = this.on_touchcancel.bind(this);\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"B-Spline\",\r\n      name    : \"bspline\",\r\n      typeName: \"BSplineCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.deg);\r\n    d.add(this.interpolating);\r\n    d.add(this.points.length);\r\n\r\n    for (let p of this.points) {\r\n      let x = ~~(p.co[0]*1024);\r\n      let y = ~~(p.co[1]*1024);\r\n\r\n      d.add(x);\r\n      d.add(y);\r\n      d.add(p.tangent); //is an enum\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  copyTo(b) {\r\n    b.deg = this.deg;\r\n    b.interpolating = this.interpolating;\r\n    b.fastmode = this.fastmode;\r\n\r\n    for (let p of this.points) {\r\n      let p2 = p.copy();\r\n\r\n      b.points.push(p2);\r\n    }\r\n\r\n    return b;\r\n  }\r\n\r\n  copy() {\r\n    let curve = new BSplineCurve();\r\n    this.copyTo(curve);\r\n    return curve;\r\n  }\r\n\r\n  equals(b) {\r\n    if (b.type !== this.type) {\r\n      return false;\r\n    }\r\n\r\n    let bad = this.points.length !== b.points.length;\r\n\r\n    bad = bad || this.deg !== b.deg;\r\n    bad = bad || this.interpolating !== b.interpolating;\r\n\r\n    if (bad) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p1 = this.points[i];\r\n      let p2 = b.points[i];\r\n\r\n      if (p1.co.vectorDistance(p2.co) > 0.00001) {\r\n        return false;\r\n      }\r\n\r\n      if (p1.tangent !== p2.tangent) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  remove(p) {\r\n    let ret = this.points.remove(p);\r\n    this.length = this.points.length;\r\n\r\n    return ret;\r\n  }\r\n\r\n  add(x, y, no_update = false) {\r\n    let p = new Curve1DPoint();\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    p.eid = this.eidgen.next();\r\n\r\n    p.co.loadXY(x, y);\r\n    p.sco.load(p.co);\r\n    p.rco.load(p.co);\r\n\r\n    this.points.push(p);\r\n    if (!no_update) {\r\n      this.update();\r\n    }\r\n\r\n    this.length = this.points.length;\r\n\r\n    return p;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  _sortPoints() {\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this.points.length; i++) {\r\n        this.points[i].rco.load(this.points[i].co);\r\n      }\r\n    }\r\n\r\n    this.points.sort(function (a, b) {\r\n      return a.co[0] - b.co[0];\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  updateKnots(recalc = true, points = this.points) {\r\n    if (recalc) {\r\n      this.recalc = RecalcFlags.ALL;\r\n    }\r\n\r\n    this._sortPoints();\r\n\r\n    this._ps = [];\r\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    let a = points[0].co[0], b = points[points.length - 1].co[0];\r\n\r\n    let degExtra = this.deg;\r\n    this._degOffset = -this.deg;\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      this._ps.push(points[i]);\r\n    }\r\n\r\n    if (degExtra) {\r\n      let last = points.length - 1;\r\n      for (let i = 0; i < degExtra; i++) {\r\n        let p = points[last].copy();\r\n        this._ps.push(p);\r\n      }\r\n    }\r\n\r\n    if (!this.interpolating) {\r\n      for (let i = 0; i < this._ps.length; i++) {\r\n        this._ps[i].rco.load(this._ps[i].co);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < points.length; i++) {\r\n      let p = points[i];\r\n      let x = p.co[0], y = p.co[1];//this.evaluate(x);\r\n\r\n      p.sco[0] = x;\r\n      p.sco[1] = y;\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    this._sortPoints();\r\n\r\n    let ret = super.toJSON();\r\n\r\n    ret = Object.assign(ret, {\r\n      points       : this.points.map(p => p.toJSON()),\r\n      deg          : this.deg,\r\n      interpolating: this.interpolating,\r\n      eidgen       : this.eidgen.toJSON()\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.interpolating = obj.interpolating;\r\n    this.deg = obj.deg;\r\n\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (obj.range) {\r\n      /* Will be version patched later. */\r\n      this.range = [new Vector2(obj.range[0]), new Vector2(obj.range[1])];\r\n    }\r\n\r\n    this.hightlight = undefined;\r\n    this.eidgen = util.IDGen.fromJSON(obj.eidgen);\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.mpos = [0, 0];\r\n\r\n    for (let i = 0; i < obj.points.length; i++) {\r\n      this.points.push(Curve1DPoint.fromJSON(obj.points[i]));\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  basis(t, i) {\r\n    if (this.recalc & RecalcFlags.FULL_BASIS) {\r\n      return this._basis(t, i);\r\n    }\r\n\r\n    if (this.recalc & RecalcFlags.BASIS) {\r\n      this.regen_basis();\r\n      this.recalc &= ~RecalcFlags.BASIS;\r\n    }\r\n\r\n    i = Math.min(Math.max(i, 0), this._ps.length - 1);\r\n    t = Math.min(Math.max(t, 0.0), 1.0)*0.999999999;\r\n\r\n    let table = this.basis_tables[i];\r\n\r\n    let s = t*(table.length/4)*0.99999;\r\n\r\n    let j = ~~s;\r\n    s -= j;\r\n\r\n    j *= 4;\r\n\r\n    //return table[j] + (table[j + 3] - table[j])*s; //linear\r\n    return bez4(table[j], table[j + 1], table[j + 2], table[j + 3], s); //cubic\r\n  }\r\n\r\n  reset(empty = false) {\r\n    this.length = 0;\r\n    this.points = [];\r\n    this._ps = [];\r\n\r\n    if (!empty) {\r\n      this.add(0, 0, true);\r\n      this.add(1, 1, true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  regen_hermite(steps) {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading spline approx from cached bspline data\");\r\n\r\n      this.hermite = splineCache.get(this).hermite;\r\n      return;\r\n    }\r\n\r\n    if (steps === undefined) {\r\n      steps = this.fastmode ? 120 : 340;\r\n    }\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.hermite = new Array(steps);\r\n    let table = this.hermite;\r\n\r\n    let eps = 0.00001;\r\n    let dt = (1.0 - eps*4.001)/(steps - 1);\r\n    let t = eps*4;\r\n    let lastdv1, lastf3;\r\n\r\n    for (let j = 0; j < steps; j++, t += dt) {\r\n      let f1 = this._evaluate(t - eps*2);\r\n      let f2 = this._evaluate(t - eps);\r\n      let f3 = this._evaluate(t);\r\n      let f4 = this._evaluate(t + eps);\r\n      let f5 = this._evaluate(t + eps*2);\r\n\r\n      let dv1 = (f4 - f2)/(eps*2);\r\n      dv1 /= steps;\r\n\r\n      if (j > 0) {\r\n        let j2 = j - 1;\r\n\r\n        table[j2*4] = lastf3;\r\n        table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n        table[j2*4 + 2] = f3 - dv1/3.0;\r\n        table[j2*4 + 3] = f3;\r\n      }\r\n\r\n      lastdv1 = dv1;\r\n      lastf3 = f3;\r\n    }\r\n  }\r\n\r\n  solve_interpolating() {\r\n    //this.recalc |= RecalcFlags.FULL_BASIS;\r\n\r\n    for (let p of this._ps) {\r\n      p.rco.load(p.co);\r\n    }\r\n\r\n    let points = this.points.concat(this.points);\r\n\r\n\r\n    this._evaluate2(0.5);\r\n\r\n    let error1 = (p) => {\r\n      //return p.vectorDistance(this._evaluate2(p.co[0]));\r\n      return this._evaluate(p.co[0]) - p.co[1];\r\n    }\r\n\r\n    let error = (p) => {\r\n      return error1(p);\r\n\r\n      /*\r\n      let err = 0.0;\r\n      for (let p of this.points) {\r\n        //err += error1(p)**2;\r\n        err += Math.abs(error1(p));\r\n      }\r\n\r\n      //return Math.sqrt(err);\r\n      return err;\r\n      //*/\r\n    };\r\n\r\n    let err = 0.0;\r\n    let g = new Vector2();\r\n\r\n    for (let step = 0; step < 25; step++) {\r\n      err = 0.0;\r\n\r\n      for (let p of this._ps) {\r\n        let r1 = error(p);\r\n        const df = 0.000001;\r\n\r\n        err += Math.abs(r1);\r\n\r\n        if (p === this._ps[this._ps.length - 1]) {\r\n          continue;\r\n        }\r\n\r\n        g.zero();\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n          let orig = p.rco[i];\r\n          p.rco[i] += df;\r\n          let r2 = error(p);\r\n          p.rco[i] = orig;\r\n\r\n          g[i] = (r2 - r1)/df;\r\n        }\r\n\r\n        let totgs = g.dot(g);\r\n\r\n        if (totgs < 0.00000001) {\r\n          continue;\r\n        }\r\n\r\n        r1 /= totgs;\r\n        let k = 0.5;\r\n\r\n        p.rco[0] += -r1*g[0]*k;\r\n        p.rco[1] += -r1*g[1]*k;\r\n      }\r\n\r\n      let th = this.fastmode ? 0.001 : 0.00005;\r\n      if (err < th) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    //this.recalc &= ~RecalcFlags.FULL_BASIS;\r\n  }\r\n\r\n  regen_basis() {\r\n    if (splineCache.has(this)) {\r\n      console.log(\"loading from cached bspline data\");\r\n\r\n      this.basis_tables = splineCache.get(this).basis_tables;\r\n      return;\r\n    }\r\n\r\n    //let steps = this.fastmode && !this.interpolating ? 64 : 128;\r\n    let steps = this.fastmode ? 64 : 128;\r\n\r\n    if (this.interpolating) {\r\n      steps *= 2;\r\n    }\r\n\r\n    this.basis_tables = new Array(this._ps.length);\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let table = this.basis_tables[i] = new Array((steps - 1)*4);\r\n\r\n      let eps = 0.00001;\r\n      let dt = (1.0 - eps*8)/(steps - 1);\r\n      let t = eps*4;\r\n      let lastdv1 = 0.0, lastf3 = 0.0;\r\n\r\n      for (let j = 0; j < steps; j++, t += dt) {\r\n\r\n        let f3 = this._basis(t, i);\r\n        let dv1;\r\n\r\n        if (0) {\r\n          //let f1 = this._basis(t - eps*2, i);\r\n          let f2 = this._basis(t - eps, i);\r\n          let f4 = this._basis(t + eps, i);\r\n          //let f5 = this._basis(t + eps*2, i);\r\n\r\n          dv1 = (f4 - f2)/(eps*2);\r\n        } else {\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n\r\n        if (isNaN(dv1)) {\r\n          console.log(\"NaN!\");\r\n          debugger;\r\n          dv1 = this._dbasis(t, i);\r\n        }\r\n        //dv1 = 0.0;\r\n\r\n        //dv1 = 0.0;\r\n        dv1 /= steps;\r\n\r\n        if (j > 0) {\r\n          let j2 = j - 1;\r\n\r\n          table[j2*4] = lastf3;\r\n          table[j2*4 + 1] = lastf3 + lastdv1/3.0;\r\n          table[j2*4 + 2] = f3 - dv1/3.0;\r\n          table[j2*4 + 3] = f3;\r\n        }\r\n\r\n        lastdv1 = dv1;\r\n        lastf3 = f3;\r\n      }\r\n    }\r\n  }\r\n\r\n  _dbasis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0/n;\r\n    }\r\n\r\n    /*\r\n    on factor;\r\n\r\n    operator bas;\r\n\r\n    a := (s - ki) / (knn - ki);\r\n    b := (knn1 - s) / (knn1 - kn);\r\n\r\n    f := a*bas(s, j, n-1) + b*bas(s, j+1, n-1);\r\n    df(f, s);\r\n    */\r\n\r\n    function bas(s, i, n) {\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n\r\n        let a = (s - ps[ki].rco[0])*safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s)*safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a*bas(s, i, n - 1) + b*bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    function dbas(s, j, n) {\r\n      let kn = Math.min(Math.max(j + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(j + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(j + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(j, 0), len - 1);\r\n\r\n      kn = ps[kn].rco[0];\r\n      knn = ps[knn].rco[0];\r\n      knn1 = ps[knn1].rco[0];\r\n      ki = ps[ki].rco[0];\r\n\r\n      if (n === 0) {\r\n        return 0;\r\n        //return s >= ki && s < kn ? 1 : 0;\r\n      } else {\r\n        let div = ((ki - knn)*(kn - knn1));\r\n\r\n        if (div === 0.0) {\r\n          return 0.0;\r\n        }\r\n\r\n        return (((ki - s)*dbas(s, j, n - 1) - bas(s, j, n - 1))*(kn - knn1) - ((knn1 -\r\n          s)*dbas(s, j + 1, n - 1) - bas(s, j + 1, n - 1))*(ki - knn))/div;\r\n      }\r\n    }\r\n\r\n    let deg = this.deg;\r\n    return dbas(t, i + this._degOffset, deg);\r\n  }\r\n\r\n  _basis(t, i) {\r\n    let len = this._ps.length;\r\n    let ps = this._ps;\r\n\r\n    function safe_inv(n) {\r\n      return n === 0 ? 0 : 1.0/n;\r\n    }\r\n\r\n    function bas(s, i, n) {\r\n      let kp = Math.min(Math.max(i - 1, 0), len - 1);\r\n      let kn = Math.min(Math.max(i + 1, 0), len - 1);\r\n      let knn = Math.min(Math.max(i + n, 0), len - 1);\r\n      let knn1 = Math.min(Math.max(i + n + 1, 0), len - 1);\r\n      let ki = Math.min(Math.max(i, 0), len - 1);\r\n\r\n      if (n === 0) {\r\n        return s >= ps[ki].rco[0] && s < ps[kn].rco[0] ? 1 : 0;\r\n      } else {\r\n\r\n        let a = (s - ps[ki].rco[0])*safe_inv(ps[knn].rco[0] - ps[ki].rco[0] + 0.0001);\r\n        let b = (ps[knn1].rco[0] - s)*safe_inv(ps[knn1].rco[0] - ps[kn].rco[0] + 0.0001);\r\n\r\n        return a*bas(s, i, n - 1) + b*bas(s, i + 1, n - 1);\r\n      }\r\n    }\r\n\r\n    let p = this._ps[i].rco, nk, pk;\r\n    let deg = this.deg;\r\n\r\n    let b = bas(t, i + this._degOffset, deg);\r\n\r\n    return b;\r\n  }\r\n\r\n  evaluate(t) {\r\n    if (this.points.length === 0) {\r\n      return 0.0;\r\n    }\r\n\r\n    let a = this.points[0].rco, b = this.points[this.points.length - 1].rco;\r\n\r\n    if (t < a[0]) return a[1];\r\n    if (t > b[0]) return b[1];\r\n\r\n    if (this.points.length === 2) {\r\n      t = (t - a[0])/(b[0] - a[0]);\r\n      return a[1] + (b[1] - a[1])*t;\r\n    }\r\n\r\n    if (this.recalc) {\r\n      this.regen_basis();\r\n\r\n      if (this.interpolating) {\r\n        this.solve_interpolating();\r\n      }\r\n\r\n      this.regen_hermite();\r\n      this.recalc = 0;\r\n    }\r\n\r\n    t *= 0.999999;\r\n\r\n    let table = this.hermite;\r\n    let s = t*(table.length/4);\r\n\r\n    let i = Math.floor(s);\r\n    s -= i;\r\n\r\n    i *= 4;\r\n\r\n    return table[i] + (table[i + 3] - table[i])*s;\r\n  }\r\n\r\n  /* Root find t on the x axis of the curve.  This\r\n   * is more intuitive for the user.\r\n   */\r\n  _evaluate(t) {\r\n    let start_t = t;\r\n\r\n    if (this.points.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    let xmin = this.points[0].rco[0];\r\n    let xmax = this.points[this.points.length - 1].rco[0];\r\n\r\n    let steps = this.fastmode ? 16 : 32;\r\n    let s = xmin, ds = (xmax - xmin)/(steps - 1);\r\n\r\n    let miny;\r\n    let mins;\r\n    let mindx;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let p = this._evaluate2(s);\r\n\r\n      let dx = Math.abs(p[0] - start_t);\r\n      if (mindx === undefined || dx < mindx) {\r\n        mindx = dx;\r\n        miny = p[1];\r\n        mins = s;\r\n      }\r\n    }\r\n\r\n    let start = mins - ds, end = mins + ds;\r\n    s = mins;\r\n\r\n    for (let i = 0; i < 16; i++) {\r\n      let p = this._evaluate2(s);\r\n\r\n      if (p[0] > start_t) {\r\n        end = s;\r\n      } else {\r\n        start = s;\r\n      }\r\n\r\n      s = (start + end)*0.5;\r\n      miny = p[1];\r\n    }\r\n\r\n    if (miny === undefined) {\r\n      miny = 0;\r\n    }\r\n    return miny;\r\n\r\n    /* newton-raphson\r\n    //t = mins;\r\n    t = s;\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let df = 0.0001;\r\n      let ret1 = this._evaluate2(t < 0.5 ? t : t - df);\r\n      let ret2 = this._evaluate2(t < 0.5 ? t + df : t);\r\n\r\n      let f1 = Math.abs(ret1[0] - start_t);\r\n      let f2 = Math.abs(ret2[0] - start_t);\r\n      let g = (f2 - f1)/df;\r\n\r\n      if (f1 === f2) break;\r\n\r\n      //if (f1 < 0.0005) break;\r\n\r\n      if (f1 === 0.0 || g === 0.0)\r\n        return this._evaluate2(t)[1];\r\n\r\n      let fac = -(f1/g)*0.5;\r\n      if (fac === 0.0) {\r\n        fac = 0.01;\r\n      } else if (Math.abs(fac) > 0.1) {\r\n        fac = 0.1*Math.sign(fac);\r\n      }\r\n\r\n      t += fac;\r\n      let eps = 0.00001;\r\n      t = Math.min(Math.max(t, eps), 1.0 - eps);\r\n    }\r\n\r\n    return this._evaluate2(t)[1];\r\n    */\r\n  }\r\n\r\n  _evaluate2(t) {\r\n    let ret = eval2_rets.next();\r\n\r\n    t *= 0.9999999;\r\n\r\n    let sumx = 0;\r\n    let sumy = 0;\r\n\r\n    let totbasis = 0;\r\n\r\n    for (let i = 0; i < this._ps.length; i++) {\r\n      let p = this._ps[i].rco;\r\n      let b = this.basis(t, i);\r\n\r\n      sumx += b*p[0];\r\n      sumy += b*p[1];\r\n\r\n      totbasis += b;\r\n    }\r\n\r\n    if (totbasis !== 0.0) {\r\n      sumx /= totbasis;\r\n      sumy /= totbasis;\r\n    }\r\n\r\n    ret[0] = sumx;\r\n    ret[1] = sumy;\r\n\r\n    return ret;\r\n  }\r\n\r\n  _wrapTouchEvent(e) {\r\n    return {\r\n      x              : e.touches.length ? e.touches[0].pageX : this.mpos[0],\r\n      y              : e.touches.length ? e.touches[0].pageY : this.mpos[1],\r\n      button         : 0,\r\n      shiftKey       : e.shiftKey,\r\n      altKey         : e.altKey,\r\n      ctrlKey        : e.ctrlKey,\r\n      isTouch        : true,\r\n      commandKey     : e.commandKey,\r\n      stopPropagation: () => e.stopPropagation(),\r\n      preventDefault : () => e.preventDefault()\r\n    };\r\n  }\r\n\r\n  on_touchstart(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n\r\n    this.on_mousemove(e2);\r\n    this.on_mousedown(e2);\r\n  }\r\n\r\n  loadTemplate(templ) {\r\n    if (templ === undefined || !templates[templ]) {\r\n      console.warn(\"Unknown bspline template\", templ);\r\n      return;\r\n    }\r\n\r\n    templ = templates[templ];\r\n\r\n    this.reset(true);\r\n    this.deg = 3.0;\r\n\r\n    for (let i = 0; i < templ.length; i++) {\r\n      let p = templ[i];\r\n\r\n      if (p === \"DEG\") {\r\n        this.deg = templ[i + 1];\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      this.add(p[0], p[1], true);\r\n    }\r\n\r\n    this.recalc = 1;\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    if (this.parent) {\r\n      this.parent._fireEvent(\"update\", this.parent);\r\n    }\r\n  }\r\n\r\n  on_touchmove(e) {\r\n    this.mpos[0] = e.touches[0].pageX;\r\n    this.mpos[1] = e.touches[0].pageY;\r\n\r\n    let e2 = this._wrapTouchEvent(e);\r\n    this.on_mousemove(e2);\r\n  }\r\n\r\n  on_touchend(e) {\r\n    this.on_mouseup(this._wrapTouchEvent(e));\r\n  }\r\n\r\n  on_touchcancel(e) {\r\n    this.on_touchend(e);\r\n  }\r\n\r\n  deletePoint() {\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n\r\n      if (p.flag & CurveFlags.SELECT) {\r\n        this.points.remove(p);\r\n        i--;\r\n      }\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.regen_basis();\r\n    this.recalc = RecalcFlags.ALL;\r\n    this.redraw();\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform, datapath, onSourceUpdate) {\r\n    console.warn(this._bid, \"makeGUI\", this.uidata, this.uidata ? this.uidata.start_mpos : undefined);\r\n\r\n    let start_mpos;\r\n    if (this.uidata) {\r\n      start_mpos = this.uidata.start_mpos;\r\n    }\r\n\r\n    this.uidata = {\r\n      start_mpos : new Vector2(start_mpos),\r\n      transpoints: [],\r\n\r\n      dom         : container,\r\n      canvas      : canvas,\r\n      g           : canvas.g,\r\n      transforming: false,\r\n      draw_trans  : drawTransform,\r\n      datapath\r\n    };\r\n\r\n    console.warn(\"Building gui\");\r\n\r\n    canvas.addEventListener(\"touchstart\", this.on_touchstart);\r\n    canvas.addEventListener(\"touchmove\", this.on_touchmove);\r\n    canvas.addEventListener(\"touchend\", this.on_touchend);\r\n    canvas.addEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n    canvas.addEventListener(\"mousedown\", this.on_mousedown);\r\n    canvas.addEventListener(\"mousemove\", this.on_mousemove);\r\n    canvas.addEventListener(\"mouseup\", this.on_mouseup);\r\n    canvas.addEventListener(\"keydown\", this.on_keydown);\r\n\r\n    let bstrip = container.row().strip();\r\n\r\n    let makebutton = (strip, k) => {\r\n      let uiname = k[0] + k.slice(1, k.length).toLowerCase();\r\n      uiname = uiname.replace(/_/g, \" \");\r\n\r\n      let icon = strip.iconbutton(-1, uiname, () => {\r\n        if (datapath) {\r\n          row.ctx.api.execTool(row.ctx, \"curve1d.bspline_load_template\", {\r\n            dataPath: datapath,\r\n            template: SplineTemplates[k]\r\n          });\r\n          onSourceUpdate();\r\n        } else {\r\n          this.loadTemplate(SplineTemplates[k]);\r\n        }\r\n      });\r\n\r\n      icon.iconsheet = 0;\r\n      icon.customIcon = SplineTemplateIcons[k];\r\n    }\r\n\r\n    for (let k in SplineTemplates) {\r\n      makebutton(bstrip, k);\r\n    }\r\n\r\n    let row = container.row();\r\n\r\n    let fullUpdate = () => {\r\n      this.updateKnots();\r\n      this.update();\r\n      this.regen_basis();\r\n      this.recalc = RecalcFlags.ALL;\r\n      this.redraw();\r\n    };\r\n\r\n    let Icons = row.constructor.getIconEnum();\r\n\r\n    let icon = Icons.LARGE_X !== undefined ? Icons.LARGE_X : Icons.TINY_X;\r\n    if (Icons.LARGE_X === undefined) {\r\n      console.log(Icons);\r\n      console.error(\"Curve widget expects Icons.LARGE_X icon for delete button.\");\r\n    }\r\n\r\n    row.iconbutton(icon, \"Delete Point\", () => {\r\n      if (datapath) {\r\n        row.ctx.api.execTool(row.ctx, \"curve1d.bspline_delete_point\", {\r\n          dataPath: datapath\r\n        });\r\n      } else {\r\n        this.deletePoint();\r\n      }\r\n\r\n      onSourceUpdate();\r\n      fullUpdate();\r\n    });\r\n\r\n    row.button(\"Reset\", () => {\r\n      if (datapath) {\r\n        row.ctx.api.execTool(row.ctx, \"curve1d.reset_bspline\", {\r\n          dataPath: datapath\r\n        });\r\n        onSourceUpdate();\r\n      } else {\r\n        this.reset();\r\n      }\r\n    });\r\n\r\n    let slider = row.simpleslider(undefined, {\r\n      name      : \"Degree\",\r\n      min       : 1,\r\n      max       : 7,\r\n      isInt     : true,\r\n      callback  : (slider) => {\r\n        this.deg = Math.floor(slider.value);\r\n        fullUpdate();\r\n      }\r\n    });\r\n    slider.setValue(this.deg);\r\n\r\n    let last_deg = this.deg;\r\n    slider.update.after(() => {\r\n      if (last_deg !== this.deg) {\r\n        console.log(\"degree update\", this.deg);\r\n        last_deg = this.deg;\r\n        slider.setValue(this.deg);\r\n      }\r\n    });\r\n\r\n    /*\r\n    let slider = row.simpleslider(undefined, \"Degree\", this.deg, 1, 6, 1, true, true, (slider) => {\r\n      this.deg = Math.floor(slider.value);\r\n      console.log(slider.value);\r\n\r\n      fullUpdate();\r\n    });*/\r\n\r\n    slider.baseUnit = \"none\";\r\n    slider.displayUnit = \"none\";\r\n\r\n    row = container.row();\r\n    let check = row.check(undefined, \"Interpolating\");\r\n    check.checked = this.interpolating;\r\n\r\n    check.onchange = () => {\r\n      this.interpolating = check.value;\r\n      fullUpdate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  killGUI(container, canvas) {\r\n    if (this.uidata !== undefined) {\r\n      let ud = this.uidata;\r\n      this.uidata = undefined;\r\n\r\n      canvas.removeEventListener(\"touchstart\", this.on_touchstart);\r\n      canvas.removeEventListener(\"touchmove\", this.on_touchmove);\r\n      canvas.removeEventListener(\"touchend\", this.on_touchend);\r\n      canvas.removeEventListener(\"touchcancel\", this.on_touchcancel);\r\n\r\n      canvas.removeEventListener(\"mousedown\", this.on_mousedown);\r\n      canvas.removeEventListener(\"mousemove\", this.on_mousemove);\r\n      canvas.removeEventListener(\"mouseup\", this.on_mouseup);\r\n      canvas.removeEventListener(\"keydown\", this.on_keydown);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  start_transform(useSelected = true) {\r\n    let dpi = 1.0/this.uidata.draw_trans[0];\r\n\r\n    /* Manually set p.startco to avoid trashing it\r\n     * if we're proxying another Curve1D.*/\r\n    for (let p of this.points) {\r\n      p.startco.load(p.co);\r\n    }\r\n\r\n    let transform_op = new BSplineTransformOp();\r\n    transform_op.inputs.dataPath.setValue(this.uidata.datapath);\r\n    transform_op.inputs.dpi.setValue(dpi);\r\n\r\n    this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, transform_op);\r\n\r\n  }\r\n\r\n  on_mousedown(e) {\r\n    this.uidata.start_mpos.load(this.transform_mpos(e.x, e.y));\r\n    this.fastmode = true;\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n    this.do_highlight(x, y);\r\n\r\n    if (this.points.highlight !== undefined) {\r\n      if (!e.shiftKey) {\r\n        for (let i = 0; i < this.points.length; i++) {\r\n          this.points[i].flag &= ~CurveFlags.SELECT;\r\n        }\r\n\r\n        this.points.highlight.flag |= CurveFlags.SELECT;\r\n      } else {\r\n        this.points.highlight.flag ^= CurveFlags.SELECT;\r\n      }\r\n\r\n      if (this.uidata.datapath) {\r\n        let state = e.shiftKey ? !(this.points.highlight.flag & CurveFlags.SELECT) : true;\r\n\r\n        this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, \"curve1d.bspline_select_point\", {\r\n          dataPath: this.uidata.datapath,\r\n          state,\r\n          unique  : !e.shiftKey,\r\n          point   : this.points.highlight.eid,\r\n        });\r\n      }\r\n      this.start_transform();\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n    } else {\r\n      let uidata = this.uidata;\r\n\r\n      if (this.uidata.datapath) {\r\n        /*\r\n         * Note: this may not update this particular curve instance,\r\n         * that instance however should update this one via the \"update\"\r\n         * event.\r\n         **/\r\n        let start_mpos = this.uidata.start_mpos;\r\n        this.uidata.dom.ctx.api.execTool(this.uidata.dom.ctx, \"curve1d.bspline_add_point\", {\r\n          dataPath: this.uidata.datapath,\r\n          x       : start_mpos[0],\r\n          y       : start_mpos[1],\r\n        });\r\n      } else {\r\n        this.addFromMouse(this.uidata.start_mpos[0], this.uidata.start_mpos[1]);\r\n        this.parent._fire(\"update\", this.parent);\r\n      }\r\n\r\n      this.updateKnots();\r\n      this.update();\r\n      this.redraw();\r\n\r\n      /* Event system may have regenerated this.uidata (from killGUI,\r\n       * called from the update event handler),\r\n       * restore the one we started with.\r\n       */\r\n\r\n      this.uidata = uidata;\r\n      this.start_transform();\r\n    }\r\n  }\r\n\r\n  load(b) {\r\n    if (this === b) {\r\n      return;\r\n    }\r\n\r\n    this.recalc = RecalcFlags.ALL;\r\n\r\n    this.length = b.points.length;\r\n    this.points.length = 0;\r\n    this.eidgen = b.eidgen.copy();\r\n\r\n    this.deg = b.deg;\r\n    this.interpolating = b.interpolating;\r\n\r\n    for (let p of b.points) {\r\n      let p2 = new Curve1DPoint();\r\n      p2.load(p);\r\n\r\n      if (p === b.points.highlight) {\r\n        this.points.highlight = p2;\r\n      }\r\n\r\n      this.points.push(p2);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  addFromMouse(x, y) {\r\n    let p = this.add(x, y);\r\n    p.startco.load(p.co);\r\n    this.points.highlight = p;\r\n\r\n    for (let p2 of this.points) {\r\n      p2.flag &= ~CurveFlags.SELECT;\r\n    }\r\n    p.flag |= CurveFlags.SELECT;\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n\r\n    this.points.highlight.flag |= CurveFlags.SELECT;\r\n  }\r\n\r\n  do_highlight(x, y) {\r\n    let trans = this.uidata.draw_trans;\r\n    let mindis = 1e17, minp = undefined;\r\n    let limit = 19/trans[0], limitsqr = limit*limit;\r\n\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      let p = this.points[i];\r\n      let dx = x - p.sco[0], dy = y - p.sco[1], dis = dx*dx + dy*dy;\r\n\r\n      if (dis < mindis && dis < limitsqr) {\r\n        mindis = dis;\r\n        minp = p;\r\n      }\r\n    }\r\n\r\n    if (this.points.highlight !== minp) {\r\n      this.points.highlight = minp;\r\n      this.redraw()\r\n    }\r\n  }\r\n\r\n  do_transform(x, y) {\r\n    let off = new Vector2([x, y]).sub(this.uidata.start_mpos);\r\n\r\n    let xRange = this.parent.xRange;\r\n    let yRange = this.parent.yRange;\r\n\r\n    for (let i = 0; i < this.uidata.transpoints.length; i++) {\r\n      let p = this.uidata.transpoints[i];\r\n      p.co.load(p.startco).add(off);\r\n\r\n      p.co[0] = Math.min(Math.max(p.co[0], xRange[0]), xRange[1]);\r\n      p.co[1] = Math.min(Math.max(p.co[1], yRange[0]), yRange[1]);\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.update();\r\n    this.redraw();\r\n  }\r\n\r\n  transform_mpos(x, y) {\r\n    let r = this.uidata.canvas.getClientRects()[0];\r\n    let dpi = devicePixelRatio; //evil module cycle: UIBase.getDPI();\r\n\r\n    x -= parseInt(r.left);\r\n    y -= parseInt(r.top);\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    let trans = this.uidata.draw_trans;\r\n\r\n    x = x/trans[0] - trans[1][0];\r\n    y = -y/trans[0] - trans[1][1];\r\n\r\n    return [x, y];\r\n  }\r\n\r\n  on_mousemove(e) {\r\n    if (e.isTouch && this.uidata.transforming) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let mpos = this.transform_mpos(e.x, e.y);\r\n    let x = mpos[0], y = mpos[1];\r\n\r\n    if (this.uidata.transforming) {\r\n      this.do_transform(x, y);\r\n      this.evaluate(0.5);\r\n      //this.update();\r\n      //this.doSave();\r\n    } else {\r\n      this.do_highlight(x, y);\r\n    }\r\n  }\r\n\r\n  end_transform() {\r\n    this.uidata.transforming = false;\r\n    this.fastmode = false;\r\n    this.updateKnots();\r\n    this.update();\r\n\r\n    splineCache.update(this);\r\n  }\r\n\r\n  on_mouseup(e) {\r\n    this.end_transform();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case 88: //xkeey\r\n      case 46: //delete\r\n        if (this.points.highlight !== undefined) {\r\n          this.points.remove(this.points.highlight);\r\n          this.recalc = RecalcFlags.ALL;\r\n\r\n          this.points.highlight = undefined;\r\n          this.updateKnots();\r\n          this.update();\r\n\r\n          if (this._save_hook !== undefined) {\r\n            this._save_hook();\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  draw(canvas, g, draw_trans) {\r\n    g.save();\r\n\r\n    if (this.uidata === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.uidata.canvas = canvas;\r\n    this.uidata.g = g;\r\n    this.uidata.draw_trans = draw_trans;\r\n\r\n    let sz = draw_trans[0], pan = draw_trans[1];\r\n    g.lineWidth *= 1.5;\r\n    let strokeStyle = g.strokeStyle;\r\n\r\n    for (let ssi = 0; ssi < 1; ssi++) {\r\n      break; //uncomment to draw basis functions\r\n\r\n      let steps = 512;\r\n      for (let si = 0; si < this.points.length; si++) {\r\n        g.beginPath();\r\n\r\n        let f = 0;\r\n        let df = 1.0/(steps - 1);\r\n        for (let i = 0; i < steps; i++, f += df) {\r\n          let totbasis = 0;\r\n\r\n          for (let j = 0; j < this.points.length; j++) {\r\n            totbasis += this.basis(f, j);\r\n          }\r\n\r\n          let val = this.basis(f, si);\r\n\r\n          if (ssi)\r\n            val /= (totbasis === 0 ? 1 : totbasis);\r\n\r\n          (i === 0 ? g.moveTo : g.lineTo).call(g, f, ssi ? val : val*0.5);\r\n        }\r\n\r\n        let color, alpha = this.points[si] === this.points.highlight ? 1.0 : 0.7;\r\n\r\n        if (ssi) {\r\n          color = \"rgba(205, 125, 5,\" + alpha + \")\";\r\n        } else {\r\n          color = \"rgba(25, 145, 45,\" + alpha + \")\";\r\n        }\r\n        g.strokeStyle = color;\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    g.strokeStyle = strokeStyle;\r\n    g.lineWidth /= 3.0;\r\n\r\n    let w = 0.03;\r\n\r\n    for (let p of this.points) {\r\n      g.beginPath();\r\n\r\n      if (p === this.points.highlight) {\r\n        g.fillStyle = \"green\";\r\n      } else if (p.flag & CurveFlags.SELECT) {\r\n        g.fillStyle = \"red\";\r\n      } else {\r\n        g.fillStyle = \"orange\";\r\n      }\r\n\r\n      g.rect(p.sco[0] - w/2, p.sco[1] - w/2, w, w);\r\n\r\n      g.fill();\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    if (this.highlightPoint >= 0) {\r\n      for (let p of this.points) {\r\n        if (p.eid === this.highlightPoint) {\r\n          this.points.highlight = p;\r\n        }\r\n      }\r\n\r\n      delete this.highlightPoint;\r\n    }\r\n\r\n    this.updateKnots();\r\n    this.recalc = RecalcFlags.ALL;\r\n  }\r\n}\r\n\r\nBSplineCurve.STRUCT = nstructjs.inherit(BSplineCurve, CurveTypeData) + `\r\n  points         : array(Curve1DPoint);\r\n  highlightPoint : int | this.points.highlight ? this.points.highlight.eid : -1;\r\n  deg            : int;\r\n  eidgen         : IDGen;\r\n  interpolating  : bool;\r\n}\r\n`;\r\nnstructjs.register(BSplineCurve);\r\nCurveTypeData.register(BSplineCurve);\r\n\r\n\r\nfunction makeSplineTemplateIcons(size = 64) {\r\n  let dpi = devicePixelRatio;\r\n  size = ~~(size*dpi);\r\n\r\n  for (let k in SplineTemplates) {\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k])\r\n\r\n    curve.fastmode = true;\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    canvas.width = canvas.height = size;\r\n\r\n    let g = canvas.getContext(\"2d\");\r\n    let steps = 64;\r\n\r\n    curve.update();\r\n\r\n    let scale = 0.5;\r\n\r\n    g.translate(-0.5, -0.5);\r\n    g.scale(size*scale, size*scale);\r\n    g.translate(0.5, 0.5);\r\n\r\n    //margin\r\n    let m = 0.0;\r\n\r\n    let tent = f => 1.0 - Math.abs(Math.fract(f) - 0.5)*2.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      let s = i/(steps - 1);\r\n      let f = 1.0 - curve.evaluate(tent(s));\r\n\r\n      s = s*(1.0 - m*2.0) + m;\r\n      f = f*(1.0 - m*2.0) + m;\r\n\r\n      //s += 0.5;\r\n      //f += 0.5;\r\n\r\n      if (i === 0) {\r\n        g.moveTo(s, f);\r\n      } else {\r\n        g.lineTo(s, f);\r\n      }\r\n    }\r\n\r\n    const ls = 7.0;\r\n\r\n    g.lineCap = \"round\";\r\n    g.strokeStyle = \"black\";\r\n    g.lineWidth = ls*3*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = ls*dpi/(size*scale);\r\n    g.stroke();\r\n\r\n    let url = canvas.toDataURL();\r\n    let img = document.createElement(\"img\");\r\n    img.src = url;\r\n\r\n    SplineTemplateIcons[k] = img;\r\n    SplineTemplateIcons[SplineTemplates[k]] = img;\r\n  }\r\n}\r\n\r\nlet splineTemplatesLoaded = false;\r\n\r\nexport function initSplineTemplates() {\r\n  if (splineTemplatesLoaded) {\r\n    return;\r\n  }\r\n\r\n  splineTemplatesLoaded = true;\r\n\r\n  for (let k in SplineTemplates) {\r\n    console.log(\"Loading spline template\", k);\r\n    let curve = new BSplineCurve();\r\n    curve.loadTemplate(SplineTemplates[k]);\r\n    splineCache.get(curve);\r\n  }\r\n\r\n  makeSplineTemplateIcons();\r\n  window._SplineTemplateIcons = SplineTemplateIcons;\r\n}\r\n\r\n//delay to ensure config is fully loaded\r\nwindow.setTimeout(() => {\r\n  if (config.autoLoadSplineTemplates) {\r\n    initSplineTemplates();\r\n  }\r\n}, 0);\r\n\r\n", "\"use strict\";\r\n\r\n/*FIXME: not sure this works anymore*/\r\nimport nstructjs from \"../util/struct.js\";\r\n\r\nimport * as util from '../util/util.js';\r\n//import * as ui_base from './ui_base.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4} from '../util/vectormath.js';\r\nimport {EventDispatcher} from \"../util/events.js\";\r\n\r\nexport {getCurve} from './curve1d_base.js';\r\nexport {SplineTemplates, SplineTemplateIcons} from './curve1d_bspline.js';\r\n\r\nexport function mySafeJSONStringify(obj) {\r\n  return JSON.stringify(obj.toJSON(), function (key) {\r\n    let v = this[key];\r\n\r\n    if (typeof v === \"number\") {\r\n      if (v !== Math.floor(v)) {\r\n        v = parseFloat(v.toFixed(5));\r\n      } else {\r\n        v = v;\r\n      }\r\n    }\r\n\r\n    return v;\r\n  });\r\n}\r\n\r\nexport function mySafeJSONParse(buf) {\r\n  return JSON.parse(buf, (key, val) => {\r\n\r\n  });\r\n};\r\n\r\nwindow.mySafeJSONStringify = mySafeJSONStringify;\r\n\r\nexport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\nimport {CurveConstructors, CURVE_VERSION, CurveTypeData} from './curve1d_base.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class Curve1D {\r\n  constructor() {\r\n    this._eventCBs = [];\r\n\r\n    this.uiZoom = 1.0;\r\n    this.xRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.yRange = new Vector2().loadXY(0.0, 1.0);\r\n    this.clipToRange = false;\r\n\r\n    this.generators = [];\r\n    this.VERSION = CURVE_VERSION;\r\n\r\n    for (let gen of CurveConstructors) {\r\n      gen = new gen();\r\n\r\n      gen.parent = this;\r\n      this.generators.push(gen);\r\n    }\r\n\r\n    //this.generators.active = this.generators[0];\r\n    this.setGenerator(\"bspline\");\r\n  }\r\n\r\n  get generatorType() {\r\n    return this.generators.active ? this.generators.active.type : undefined;\r\n  }\r\n\r\n  get fastmode() {\r\n    return this._fastmode;\r\n  }\r\n\r\n  set fastmode(val) {\r\n    this._fastmode = val;\r\n\r\n    for (let gen of this.generators) {\r\n      gen.fastmode = val;\r\n    }\r\n  }\r\n\r\n  /** cb_is_dead is a callback that returns true if it\r\n   *  should be removed from the callback list. */\r\n  on(type, cb, owner, cb_is_dead) {\r\n    if (cb_is_dead === undefined) {\r\n      cb_is_dead = () => false;\r\n    }\r\n\r\n    this._eventCBs.push({type, cb, owner, dead: cb_is_dead, once: false});\r\n  }\r\n\r\n  off(type, cb) {\r\n    this._eventCBs = this._eventCBs.filter(cb => cb.cb !== cb);\r\n  }\r\n\r\n  once(type, cb, owner, cb_is_dead) {\r\n    this.on(type, cb, owner, cb_is_dead);\r\n    this._eventCBs[this._eventCBs.length - 1].once = true;\r\n  }\r\n\r\n  subscribed(type, owner) {\r\n    for (let cb of this._eventCBs) {\r\n      if ((!type || cb.type === type) && cb.owner === owner) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  _pruneEventCallbacks() {\r\n    this._eventCBs = this._eventCBs.filter(cb => !cb.dead());\r\n  }\r\n\r\n  _fireEvent(evt, data) {\r\n    this._pruneEventCallbacks();\r\n\r\n    for (let i = 0; i < this._eventCBs.length; i++) {\r\n      let cb = this._eventCBs[i];\r\n\r\n      if (cb.type !== evt) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        cb.cb(data);\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n      }\r\n\r\n      if (cb.once) {\r\n        this._eventCBs.remove(cb);\r\n        i--;\r\n      }\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    for (let g of this.generators) {\r\n      g.calcHashKey(d);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let gen1 = this.generators.active;\r\n    let gen2 = b.generators.active;\r\n\r\n    if (!gen1 || !gen2 || gen1.constructor !== gen2.constructor) {\r\n      return false;\r\n    }\r\n\r\n    return gen1.equals(gen2);\r\n  }\r\n\r\n  load(b) {\r\n    if (b === undefined || b === this) {\r\n      return this;\r\n    }\r\n    /*\r\n    if (b === undefined) {\r\n      return;\r\n    }\r\n\r\n    let buf1 = mySafeJSONStringify(b);\r\n    let buf2 = mySafeJSONStringify(this);\r\n\r\n    if (buf1 === buf2) {\r\n      return;\r\n    }\r\n\r\n    this.loadJSON(JSON.parse(buf1));\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;*/\r\n\r\n    let json = nstructjs.writeJSON(b, Curve1D);\r\n    let cpy = nstructjs.readJSON(json, Curve1D);\r\n\r\n    let activeCls = cpy.generators.active.constructor;\r\n    let oldGens = this.generators;\r\n\r\n    this.generators = cpy.generators;\r\n\r\n    for (let gen of cpy.generators) {\r\n      /* See if generator provides a .load() method. */\r\n      for (let gen2 of oldGens) {\r\n        if (gen2.constructor === gen.constructor && gen2.load !== undefined) {\r\n          cpy.generators[cpy.generators.indexOf(gen)] = gen2;\r\n\r\n          if (gen2.constructor === activeCls) {\r\n            this.generators.active = gen2;\r\n          }\r\n\r\n          gen2.parent = this;\r\n          gen2.load(gen);\r\n          gen = gen2;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (gen.constructor === activeCls) {\r\n        this.generators.active = gen;\r\n      }\r\n      gen.parent = this;\r\n    }\r\n\r\n    for (let k in json) {\r\n      if (k === \"generators\") {\r\n        continue;\r\n      }\r\n      if (k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      let v = cpy[k];\r\n      if (typeof v === \"number\" || typeof v === \"boolean\" || typeof v === \"string\") {\r\n        this[k] = v;\r\n      } else if (v instanceof Vector2 || v instanceof Vector3 || v instanceof Vector4 || v instanceof Matrix4) {\r\n        this[k].load(v);\r\n      }\r\n    }\r\n\r\n    this._on_change();\r\n    this.redraw();\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let json = nstructjs.writeJSON(this, Curve1D);\r\n    return nstructjs.readJSON(json, Curve1D);\r\n  }\r\n\r\n  _on_change() {\r\n\r\n  }\r\n\r\n  redraw() {\r\n    this._fireEvent(\"draw\", this);\r\n  }\r\n\r\n  setGenerator(type) {\r\n    for (let gen of this.generators) {\r\n      if (gen.constructor.define().name === type\r\n        || gen.type === type\r\n        || gen.constructor.define().typeName === type\r\n        || gen.constructor === type) {\r\n        if (this.generators.active) {\r\n          this.generators.active.onInactive();\r\n        }\r\n\r\n        this.generators.active = gen;\r\n        gen.onActive();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"unknown curve type \" + type);\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      generators      : [],\r\n      uiZoom          : this.uiZoom,\r\n      VERSION         : this.VERSION,\r\n      active_generator: this.generatorType,\r\n      xRange          : this.xRange,\r\n      yRange          : this.yRange,\r\n      clipToRange     : this.clipToRange,\r\n    };\r\n\r\n    for (let gen of this.generators) {\r\n      ret.generators.push(gen.toJSON());\r\n    }\r\n\r\n    ret.generators.sort((a, b) => a.type.localeCompare(b.type));\r\n\r\n    return ret;\r\n  }\r\n\r\n  getGenerator(type, throw_on_error = true) {\r\n    for (let gen of this.generators) {\r\n      if (gen.type === type) {\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    //was a new generator registerd?\r\n    for (let cls of CurveConstructors) {\r\n      if (cls.define().typeName === type) {\r\n        let gen = new cls();\r\n        gen.type = type;\r\n        gen.parent = this;\r\n        this.generators.push(gen);\r\n        return gen;\r\n      }\r\n    }\r\n\r\n    if (throw_on_error) {\r\n      throw new Error(\"Unknown generator \" + type + \".\");\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  switchGenerator(type) {\r\n    let gen = this.getGenerator(type);\r\n\r\n    if (gen !== this.generators.active) {\r\n      let old = this.generators.active;\r\n\r\n      this.generators.active = gen;\r\n\r\n      old.onInactive(this);\r\n      gen.onActive(this);\r\n    }\r\n\r\n    return gen;\r\n  }\r\n\r\n  destroy() {\r\n    return this;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    this.VERSION = obj.VERSION;\r\n\r\n    this.uiZoom = parseFloat(obj.uiZoom) || this.uiZoom;\r\n    if (obj.xRange) {\r\n      this.xRange = new Vector2(obj.xRange);\r\n    }\r\n    if (obj.yRange) {\r\n      this.yRange = new Vector2(obj.yRange);\r\n    }\r\n    this.clipToRange = Boolean(obj.clipToRange);\r\n\r\n    //this.generators = [];\r\n    for (let gen of obj.generators) {\r\n      let gen2 = this.getGenerator(gen.type, false);\r\n\r\n      if (!gen2 || !(gen2 instanceof CurveTypeData)) {\r\n        //old curve class?\r\n        console.warn(\"Bad curve generator class:\", gen2);\r\n        if (gen2) {\r\n          this.generators.remove(gen2);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      gen2.parent = undefined;\r\n      gen2.reset();\r\n      gen2.loadJSON(gen);\r\n      gen2.parent = this;\r\n\r\n      if (gen.type === obj.active_generator) {\r\n        this.generators.active = gen2;\r\n      }\r\n\r\n      //this.generators.push(gen2);\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  evaluate(s) {\r\n    if (this.clipToRange) {\r\n      s = Math.min(Math.max(s, this.xRange[0]), this.xRange[1]);\r\n    }\r\n\r\n    let f;\r\n\r\n    try {\r\n      f = this.generators.active.evaluate(s);\r\n    } catch (error) {\r\n      f = 0.0;\r\n      console.warn(error.stack);\r\n      console.warn(error.message);\r\n    }\r\n\r\n    if (this.clipToRange) {\r\n      f = Math.min(Math.max(f, this.yRange[0]), this.yRange[1]);\r\n    }\r\n\r\n    return f;\r\n  }\r\n\r\n  integrate(s, quadSteps) {\r\n    return this.generators.active.integrate(s, quadSteps);\r\n  }\r\n\r\n  derivative(s) {\r\n    return this.generators.active.derivative(s);\r\n  }\r\n\r\n  derivative2(s) {\r\n    return this.generators.active.derivative2(s);\r\n  }\r\n\r\n  inverse(s) {\r\n    return this.generators.active.inverse(s);\r\n  }\r\n\r\n  reset() {\r\n    this.generators.active.reset();\r\n  }\r\n\r\n  update() {\r\n    return this.generators.active.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let w = canvas.width, h = canvas.height;\r\n\r\n    g.save();\r\n\r\n    let sz = draw_transform[0], pan = draw_transform[1];\r\n\r\n    g.beginPath();\r\n    g.moveTo(-1, 0);\r\n    g.lineTo(1, 0);\r\n    g.strokeStyle = \"red\";\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, -1);\r\n    g.lineTo(0, 1);\r\n    g.strokeStyle = \"green\";\r\n    g.stroke();\r\n\r\n    //g.rect(0, 0, 1, 1);\r\n    //g.fillStyle = \"rgb(50, 50, 50)\";\r\n    //g.fill();\r\n\r\n    let f = this.xRange[0], steps = 64;\r\n    let df = (this.xRange[1] - this.xRange[0])/(steps - 1);\r\n    w = 6.0/sz;\r\n\r\n    let curve = this.generators.active;\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, f += df) {\r\n      let val = this.evaluate(f);\r\n\r\n      (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n    }\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.stroke();\r\n\r\n    if (this.overlay_curvefunc !== undefined) {\r\n      g.beginPath();\r\n      f = this.xRange[0];\r\n\r\n      for (let i = 0; i < steps; i++, f += df) {\r\n        let val = this.overlay_curvefunc(f);\r\n\r\n        (i === 0 ? g.moveTo : g.lineTo).call(g, f, val, w, w);\r\n      }\r\n\r\n      g.strokeStyle = \"green\";\r\n      g.stroke();\r\n    }\r\n\r\n    this.generators.active.draw(canvas, g, draw_transform);\r\n\r\n    g.restore();\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.generators = [];\r\n    reader(this);\r\n\r\n    if (this.VERSION <= 0.75) {\r\n      this.generators = [];\r\n\r\n      for (let cls of CurveConstructors) {\r\n        this.generators.push(new cls());\r\n      }\r\n\r\n      this.generators.active = this.getGenerator(\"BSplineCurve\");\r\n    }\r\n\r\n    for (let gen of this.generators.concat([])) {\r\n      if (!(gen instanceof CurveTypeData)) {\r\n        console.warn(\"Bad generator data found:\", gen);\r\n        this.generators.remove(gen);\r\n        continue;\r\n      }\r\n\r\n      if (gen.type === this._active) {\r\n        this.generators.active = gen;\r\n      }\r\n    }\r\n\r\n    for (let gen of this.generators) {\r\n      gen.parent = this;\r\n    }\r\n\r\n    if (this.VERSION < 1.1) {\r\n      this.#patchRange();\r\n    }\r\n\r\n    delete this._active;\r\n    this.VERSION = CURVE_VERSION;\r\n  }\r\n\r\n  #patchRange() {\r\n    let range = this.getGenerator(\"BSplineCurve\").range;\r\n    if (range) {\r\n      this.xRange.load(range[0]);\r\n      this.yRange.load(range[1]);\r\n    }\r\n  }\r\n}\r\n\r\n/* Remember to update toJSON() loadJSON api. */\r\nCurve1D.STRUCT = `\r\nCurve1D {\r\n  generators  : array(abstract(CurveTypeData));\r\n  _active     : string | obj.generators.active.type;\r\n  VERSION     : float;\r\n  uiZoom      : float;\r\n  xRange      : vec2;\r\n  yRange      : vec2;\r\n  clipToRange : bool;\r\n}\r\n`;\r\nnstructjs.register(Curve1D);\r\n\r\n", "import {Vector2, Matrix4, Quat, Vector3, Vector4} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js'\r\nimport {color2css, css2color, parsepx} from './ui_theme.js';\r\nimport {Curve1D, getCurve} from \"../path-controller/curve/curve1d.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\n\r\nclass Task {\r\n  constructor(taskcb) {\r\n    this.task = taskcb;\r\n    this.start = util.time_ms();\r\n    this.done = false;\r\n  }\r\n}\r\n\r\nexport class AnimManager {\r\n  constructor() {\r\n    this.tasks = [];\r\n    this.timer = undefined;\r\n\r\n    //all animation tasks that last longer then 10 seconds are terminated\r\n    this.timeOut = 10*1000.0;\r\n  }\r\n\r\n  stop() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n\r\n  add(task) {\r\n    this.tasks.push(new Task(task));\r\n  }\r\n\r\n  remove(task) {\r\n    for (let t of this.tasks) {\r\n      if (t.task === task) {\r\n        t.dead = true;\r\n        this.tasks.remove(t);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  start() {\r\n    this.timer = window.setInterval(() => {\r\n      for (let t of this.tasks) {\r\n        try {\r\n          t.task();\r\n        } catch (error) {\r\n          t.done = true;\r\n          util.print_stack(error);\r\n        }\r\n\r\n        if (util.time_ms() - t.start > this.timeOut) {\r\n          t.dead = true;\r\n        }\r\n      }\r\n\r\n      for (let i=0; i<this.tasks.length; i++) {\r\n        if (this.tasks[i].done) {\r\n          let t = this.tasks[i];\r\n          this.tasks.remove(t);\r\n          i--;\r\n\r\n          try {\r\n            if (t.task.onend) {\r\n              t.task.onend();\r\n            }\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n          }\r\n        }\r\n      }\r\n    }, 1000/40.0);\r\n  }\r\n}\r\n\r\n\r\nexport const manager = new AnimManager();\r\nmanager.start();\r\n\r\nexport class AbstractCommand {\r\n  constructor() {\r\n    this.cbs = [];\r\n    this.end_cbs = [];\r\n  }\r\n\r\n  start(animator, done) {\r\n\r\n  }\r\n\r\n  exec(animator, done) {\r\n\r\n  }\r\n}\r\n\r\nexport class WaitCommand extends AbstractCommand {\r\n  constructor(ms) {\r\n    super();\r\n    this.ms = ms;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n  }\r\n\r\n  exec(animator, done) {\r\n    if (animator.time - this.time > this.ms) {\r\n      done();\r\n    }\r\n  }\r\n}\r\n\r\nexport class GoToCommand extends AbstractCommand {\r\n  constructor(obj, key, value, time, curve=\"ease\") {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = value;\r\n    this.ms = time;\r\n\r\n    if (typeof curve === \"string\") {\r\n      this.curve = new (getCurve(curve))();\r\n    } else {\r\n      this.curve = curve;\r\n    }\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.time = animator.time;\r\n\r\n    let value = this.object[this.key];\r\n\r\n    if (Array.isArray(value)) {\r\n      this.startValue = util.list(value);\r\n    } else {\r\n      this.startValue = value;\r\n    }\r\n  }\r\n\r\n  exec(animator, done) {\r\n    let t = animator.time - this.time;\r\n    let ms = this.ms;\r\n\r\n    if (t > ms) {\r\n      done();\r\n      t = ms;\r\n    }\r\n\r\n    t /= ms;\r\n\r\n    t = this.curve.evaluate(t);\r\n\r\n    if (Array.isArray(this.startValue)) {\r\n      let value = this.object[this.key];\r\n\r\n      for (let i=0; i<this.startValue.length; i++) {\r\n        if (value[i] === undefined || this.value[i] === undefined) {\r\n          continue;\r\n        }\r\n\r\n        value[i] = this.startValue[i] + (this.value[i] - this.startValue[i]) * t;\r\n      }\r\n    } else {\r\n      this.object[this.key] = this.startValue + (this.value - this.startValue) * t;\r\n\r\n    }\r\n  }\r\n}\r\n\r\nexport class SetCommand extends AbstractCommand {\r\n  constructor(obj, key, val) {\r\n    super();\r\n\r\n    this.object = obj;\r\n    this.key = key;\r\n    this.value = val;\r\n  }\r\n\r\n  start(animator, done) {\r\n    this.object[key] = val;\r\n    done();\r\n  }\r\n}\r\n\r\nexport class Command {\r\n  constructor(type, args) {\r\n    this.args = args;\r\n    this.cbs = [];\r\n  }\r\n}\r\n\r\nexport class Animator {\r\n  constructor(owner, method = \"update\") {\r\n    this.on_tick = this.on_tick.bind(this);\r\n    this.on_tick.onend = () => {\r\n      if (this.onend) {\r\n        this.onend();\r\n      }\r\n    }\r\n\r\n    this.commands = [];\r\n    this.owner = owner;\r\n    this._done = false;\r\n    this.method = method;\r\n    this.onend = null;\r\n    this.first = true;\r\n\r\n    this.time = 0.0;\r\n    this.last = util.time_ms();\r\n\r\n    this.bind(owner);\r\n  }\r\n\r\n  bind(owner) {\r\n    this._done = false;\r\n    this.owner = owner;\r\n    //this.owner[this.method].after(this.on_tick);\r\n    manager.add(this.on_tick);\r\n  }\r\n\r\n  wait(ms) {\r\n    this.commands.push(new WaitCommand(ms));\r\n    return this;\r\n  }\r\n\r\n  goto(key, val, timeMs, curve = \"ease\") {\r\n    let cmd = new GoToCommand(this.owner, key, val, timeMs, curve);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  set(key, val, time) {\r\n    let cmd = new SetCommand(this.owner, key, val);\r\n    this.commands.push(cmd);\r\n    return this;\r\n  }\r\n\r\n  /** Call this while the current command is still being executed. */\r\n  while(cb) {\r\n    this.commands[this.commands.length - 1].cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  then(cb) {\r\n    this.commands[this.commands.length-1].end_cbs.push(cb);\r\n    return this;\r\n  }\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n\r\n    this._done = true;\r\n    manager.remove(this.on_tick);\r\n    //this.owner.update.remove(this.on_tick);\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  on_tick() {\r\n    if (this._done) {\r\n      throw new Error(\"animation wasn't properly cleaned up\");\r\n    }\r\n\r\n    let dt = util.time_ms() - this.last;\r\n    this.time += dt;\r\n    this.last = util.time_ms();\r\n\r\n    if (this.commands.length === 0) {\r\n      this.end();\r\n      return\r\n    }\r\n\r\n    let cmd = this.commands[0];\r\n    let done = false;\r\n\r\n    function donecb() {\r\n      done = true;\r\n    }\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      //console.log(cmd, cmd.start)\r\n      cmd.start(this, donecb);\r\n    }\r\n\r\n    try {\r\n      cmd.exec(this, donecb);\r\n    } catch (error) {\r\n      done = true;\r\n      util.print_stack(error);\r\n    }\r\n\r\n    for (let cb of this.commands[0].cbs) {\r\n      try {\r\n        cb();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n      }\r\n    }\r\n\r\n    if (done) {\r\n      for (let cb of this.commands[0].end_cbs) {\r\n        try {\r\n          cb();\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n      while (this.commands.length > 0) {\r\n        this.commands.shift();\r\n\r\n        done = false;\r\n\r\n        if (this.commands.length > 0) {\r\n          this.commands[0].start(this, donecb);\r\n        }\r\n\r\n        if (!done) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n", "export class token {\r\n  constructor(type, val, lexpos, lexlen, lineno, lexer, parser) {\r\n    this.type = type;\r\n    this.value = val;\r\n    this.lexpos = lexpos;\r\n    this.lexlen = lexlen;\r\n    this.lineno = lineno;\r\n    this.lexer = lexer;\r\n    this.parser = parser;\r\n  }\r\n\r\n  setValue(val) {\r\n    this.value = val;\r\n    return this;\r\n  }\r\n\r\n  toString() {\r\n    if (this.value !== undefined)\r\n      return \"token(type=\" + this.type + \", value='\" + this.value + \"')\"\r\n    else\r\n      return \"token(type=\" + this.type + \")\"\r\n  }\r\n}\r\n\r\n//func is optional. it takes a function\r\n//with one parameter, token, and either\r\n//a) returns the token, or b) returns\r\n//undefined, in which case the token\r\n//should be ignored by the lexer\r\nexport class tokdef {\r\n  constructor(name, regexpr, func) {\r\n    this.name = name;\r\n    this.re = regexpr\r\n    this.func = func\r\n  }\r\n}\r\n\r\nexport class PUTLParseError extends Error {\r\n}\r\n\r\n//errfunc is optional.  it requires\r\n//a function that takes one param, lexer,\r\n//and returns true if the lexer\r\n//should propegate an error when an error\r\n//has happened\r\nexport class lexer {\r\n  constructor(tokdef, errfunc) {\r\n    this.tokdef = tokdef;\r\n    this.tokens = new Array();\r\n    this.lexpos = 0;\r\n    this.lexdata = \"\";\r\n    this.lineno = 0;\r\n    this.errfunc = errfunc;\r\n    this.tokints = {}\r\n    this.print_tokens = false;\r\n    this.print_debug = false;\r\n\r\n    for (let i = 0; i < tokdef.length; i++) {\r\n      this.tokints[tokdef[i].name] = i;\r\n    }\r\n\r\n    this.statestack = [[\"__main__\", 0]];\r\n    this.states = {\"__main__\": [tokdef, errfunc]};\r\n    this.statedata = 0; //public variable\r\n  }\r\n\r\n  copy() {\r\n    let ret = new lexer(this.tokdef, this.errfunc);\r\n\r\n    for (let k in this.states) {\r\n      let state = this.states[k];\r\n\r\n      state = [state[0], state[1]];\r\n      ret.states[k] = state;\r\n    }\r\n\r\n    ret.statedata = this.statedata;\r\n\r\n    return ret;\r\n  }\r\n\r\n//errfunc is optional, defines state-specific error function\r\n  add_state(name, tokdef, errfunc) {\r\n    if (errfunc === undefined) {\r\n      errfunc = function (lexer) {\r\n        return true;\r\n      };\r\n    }\r\n\r\n    this.states[name] = [tokdef, errfunc];\r\n  }\r\n\r\n  tok_int(name) {\r\n\r\n  }\r\n\r\n  //statedata is optional.\r\n  //it stores state-specific data in lexer.statedata.\r\n  push_state(state, statedata) {\r\n    this.statestack.push([state, statedata])\r\n\r\n    state = this.states[state];\r\n    this.statedata = statedata;\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n  }\r\n\r\n  pop_state() {\r\n    let item = this.statestack[this.statestack.length - 1];\r\n    let state = this.states[item[0]];\r\n\r\n    this.tokdef = state[0];\r\n    this.errfunc = state[1];\r\n    this.statedata = item[1];\r\n  }\r\n\r\n  input(str) {\r\n    //go back to main state\r\n    while (this.statestack.length > 1) {\r\n      this.pop_state();\r\n    }\r\n\r\n    this.lexdata = str;\r\n    this.lexpos = 0;\r\n    this.lineno = 0;\r\n    this.tokens = new Array();\r\n\r\n    this.peeked_tokens = [];\r\n  }\r\n\r\n  error() {\r\n    if (this.errfunc !== undefined && !this.errfunc(this))\r\n      return;\r\n\r\n    console.log(\"Syntax error near line \" + this.lineno);\r\n    let next = Math.min(this.lexpos + 8, this.lexdata.length);\r\n    console.log(\"  \" + this.lexdata.slice(this.lexpos, next));\r\n\r\n    throw new PUTLParseError(\"Parse error\");\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.next(true);\r\n\r\n    if (tok === undefined)\r\n      return undefined;\r\n\r\n    this.peeked_tokens.push(tok);\r\n    return tok;\r\n  }\r\n\r\n\r\n  peek_i(i) {\r\n    while (this.peeked_tokens.length <= i) {\r\n      let t = this.peek();\r\n      if (t === undefined)\r\n        return undefined;\r\n    }\r\n\r\n    return this.peeked_tokens[i];\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexpos >= this.lexdata.length && this.peeked_tokens.length === 0;\r\n  }\r\n\r\n  next(ignore_peek) {\r\n    if (ignore_peek !== true && this.peeked_tokens.length > 0) {\r\n      let tok = this.peeked_tokens[0];\r\n\r\n      if (this.print_debug) {\r\n        console.log(\"PEEK_SHIFTING\", \"\" + tok);\r\n      }\r\n\r\n      this.peeked_tokens.shift();\r\n\r\n      if (this.print_tokens) {\r\n        console.log(tok.toString());\r\n      }\r\n\r\n      return tok;\r\n    }\r\n\r\n    if (this.lexpos >= this.lexdata.length)\r\n      return undefined;\r\n\r\n    let ts = this.tokdef;\r\n    let tlen = ts.length;\r\n\r\n    let lexdata = this.lexdata.slice(this.lexpos, this.lexdata.length);\r\n\r\n    let results = []\r\n\r\n    for (let i = 0; i < tlen; i++) {\r\n      let t = ts[i];\r\n\r\n      if (t.re === undefined)\r\n        continue;\r\n\r\n      let res = t.re.exec(lexdata);\r\n\r\n      if (res !== null && res !== undefined && res.index === 0) {\r\n        results.push([t, res]);\r\n      }\r\n    }\r\n\r\n    let max_res = 0;\r\n    let theres = undefined;\r\n    for (let i = 0; i < results.length; i++) {\r\n      let res = results[i];\r\n\r\n      if (res[1][0].length > max_res) {\r\n        theres = res;\r\n        max_res = res[1][0].length;\r\n      }\r\n    }\r\n\r\n    if (theres === undefined) {\r\n      this.error();\r\n      return;\r\n    }\r\n\r\n    let def = theres[0];\r\n\r\n    let lexlen = max_res;\r\n    let tok = new token(def.name, theres[1][0], this.lexpos, lexlen, this.lineno, this, undefined);\r\n    this.lexpos += max_res;\r\n\r\n    if (def.func) {\r\n      tok = def.func(tok)\r\n\r\n      if (tok === undefined) {\r\n        return this.next(ignore_peek);\r\n      }\r\n    }\r\n\r\n    if (this.print_tokens) {\r\n      console.log(tok.toString());\r\n    }\r\n\r\n    if (!ignore_peek && this.print_debug) {\r\n      console.log(\"CONSUME\", tok.toString(), \"\\n\" + getTraceBack());\r\n    }\r\n\r\n    return tok;\r\n  }\r\n}\r\n\r\nexport function getTraceBack(limit, start) {\r\n  try {\r\n    throw new Error();\r\n  } catch (error) {\r\n    let stack = error.stack.split(\"\\n\");\r\n    stack = stack.slice(1, stack.length);\r\n\r\n    if (start === undefined) {\r\n      start = 0;\r\n    }\r\n\r\n    for (let i = 0; i < stack.length; i++) {\r\n      let l = stack[i];\r\n\r\n      let j = l.length - 1;\r\n      while (j > 0 && l[j] !== \"/\") {\r\n        j--;\r\n      }\r\n\r\n      let k = j;\r\n      while (k >= 0 && l[k] !== \"(\") {\r\n        k--;\r\n      }\r\n\r\n      let func = l.slice(0, k).trim();\r\n      let file = l.slice(j + 1, l.length - 1);\r\n\r\n      l = `  ${func} (${file})`;\r\n\r\n      if (l.search(/parseutil\\.js/) >= 0) {\r\n        start = Math.max(start, i);\r\n      }\r\n      stack[i] = l;\r\n    }\r\n\r\n    if (limit !== undefined) {\r\n      stack.length = Math.min(stack.length, limit);\r\n    }\r\n\r\n    if (start !== undefined) {\r\n      stack = stack.slice(start, stack.length);\r\n    }\r\n\r\n    stack = stack.join(\"\\n\");\r\n    return stack;\r\n  }\r\n}\r\n\r\nexport class parser {\r\n  constructor(lexer, errfunc) {\r\n    this.lexer = lexer;\r\n    this.errfunc = errfunc;\r\n    this.start = undefined;\r\n    this.userdata = undefined;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new parser(this.lexer.copy(), this.errfunc);\r\n    ret.start = this.start;\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  parse(data, err_on_unconsumed) {\r\n    if (err_on_unconsumed === undefined)\r\n      err_on_unconsumed = true;\r\n\r\n    if (data !== undefined)\r\n      this.lexer.input(data);\r\n\r\n    let ret = this.start(this);\r\n\r\n    if (err_on_unconsumed && !this.lexer.at_end() && this.lexer.next() !== undefined) {\r\n      //console.log(this.lexer.lexdata.slice(this.lexer.lexpos-1, this.lexer.lexdata.length));\r\n      this.error(undefined, \"parser did not consume entire input\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  input(data) {\r\n    this.lexer.input(data);\r\n  }\r\n\r\n  error(tok, msg) {\r\n    if (msg === undefined)\r\n      msg = \"\"\r\n\r\n    let estr;\r\n\r\n    if (tok === undefined)\r\n      estr = \"Parse error at end of input: \" + msg\r\n    else\r\n      estr = \"Parse error at line \" + (tok.lineno + 1) + \": \" + msg;\r\n\r\n    let buf = \"1| \"\r\n    let ld = this.lexer.lexdata;\r\n    let l = 1;\r\n    for (let i = 0; i < ld.length; i++) {\r\n      let c = ld[i];\r\n      if (c === '\\n') {\r\n        l++;\r\n        buf += \"\\n\" + l + \"| \"\r\n      } else {\r\n        buf += c;\r\n      }\r\n    }\r\n\r\n    console.log(\"------------------\")\r\n    console.log(buf);\r\n    console.log(\"==================\")\r\n    console.log(estr);\r\n\r\n    if (this.errfunc && !this.errfunc(tok)) {\r\n      return;\r\n    }\r\n\r\n    throw new PUTLParseError(estr);\r\n  }\r\n\r\n  peek() {\r\n    let tok = this.lexer.peek();\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peek_i(i) {\r\n    let tok = this.lexer.peek_i(i);\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  peeknext() {\r\n    return this.peek_i(0);\r\n  }\r\n\r\n  next() {\r\n    let tok = this.lexer.next();\r\n\r\n    if (tok !== undefined)\r\n      tok.parser = this;\r\n\r\n    return tok;\r\n  }\r\n\r\n  optional(type) {\r\n    let tok = this.peek_i(0);\r\n\r\n    if (tok && tok.type === type) {\r\n      this.next();\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  at_end() {\r\n    return this.lexer.at_end();\r\n  }\r\n\r\n  expect(type, msg) {\r\n    let tok = this.next();\r\n\r\n    if (msg === undefined)\r\n      msg = type\r\n\r\n    if (tok === undefined || tok.type != type) {\r\n      this.error(tok, \"Expected \" + msg + \", not \" + tok.type);\r\n    }\r\n\r\n    return tok.value;\r\n  }\r\n}\r\n\r\nfunction test_parser() {\r\n  let basic_types = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\"]);\r\n\r\n  let reserved_tokens = new set([\r\n    \"int\",\r\n    \"float\",\r\n    \"double\",\r\n    \"vec2\",\r\n    \"vec3\",\r\n    \"vec4\",\r\n    \"mat4\",\r\n    \"string\",\r\n    \"static_string\",\r\n    \"array\"]);\r\n\r\n  function tk(name, re, func) {\r\n    return new tokdef(name, re, func);\r\n  }\r\n\r\n  let tokens = [\r\n    tk(\"ID\", /[a-zA-Z]+[a-zA-Z0-9_]*/, function (t) {\r\n      if (reserved_tokens.has(t.value)) {\r\n        t.type = t.value.toUpperCase();\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    tk(\"OPEN\", /\\{/),\r\n    tk(\"CLOSE\", /}/),\r\n    tk(\"COLON\", /:/),\r\n    tk(\"JSCRIPT\", /\\|/, function (t) {\r\n      let js = \"\"\r\n      let lexer = t.lexer;\r\n      while (lexer.lexpos < lexer.lexdata.length) {\r\n        let c = lexer.lexdata[lexer.lexpos];\r\n        if (c === \"\\n\")\r\n          break;\r\n\r\n        js += c;\r\n        lexer.lexpos++;\r\n      }\r\n\r\n      if (js.endsWith(\";\")) {\r\n        js = js.slice(0, js.length - 1);\r\n        lexer.lexpos--;\r\n      }\r\n\r\n      t.value = js;\r\n      return t;\r\n    }),\r\n\r\n    tk(\"LPARAM\", /\\(/),\r\n    tk(\"RPARAM\", /\\)/),\r\n    tk(\"COMMA\", /,/),\r\n    tk(\"NUM\", /[0-9]/),\r\n    tk(\"SEMI\", /;/),\r\n    tk(\"NEWLINE\", /\\n/, function (t) {\r\n      t.lexer.lineno += 1;\r\n    }),\r\n    tk(\"SPACE\", / |\\t/, function (t) {\r\n      //throw out non-newline whitespace tokens\r\n    })\r\n  ];\r\n\r\n  for (let rt in reserved_tokens) {\r\n    tokens.push(tk(rt.toUpperCase()));\r\n  }\r\n\r\n  /*let a =\r\n  Loop {\r\n    eid : int;\r\n    flag : int;\r\n    index : int;\r\n    type : int;\r\n\r\n    co : vec3;\r\n    no : vec3;\r\n    loop : int | eid(loop);\r\n    edges : array(e, int) | e.eid;\r\n\r\n    loops : array(Loop);\r\n  }\r\n  `;\r\n  */\r\n\r\n  function errfunc(lexer) {\r\n    return true; //throw error\r\n  }\r\n\r\n  let lex = new lexer(tokens, errfunc)\r\n  console.log(\"Testing lexical scanner...\")\r\n\r\n  lex.input(a);\r\n\r\n  let tok;\r\n  while (tok = lex.next()) {\r\n    console.log(tok.toString())\r\n  }\r\n\r\n  let parser = new parser(lex);\r\n  parser.input(a);\r\n\r\n  function p_Array(p) {\r\n    p.expect(\"ARRAY\");\r\n    p.expect(\"LPARAM\");\r\n\r\n    let arraytype = p_Type(p);\r\n    let itername = \"\";\r\n\r\n    if (p.optional(\"COMMA\")) {\r\n      itername = arraytype;\r\n      arraytype = p_Type(p);\r\n    }\r\n\r\n\r\n    p.expect(\"RPARAM\");\r\n\r\n    return {type: \"array\", data: {type: arraytype, iname: itername}};\r\n  }\r\n\r\n  function p_Type(p) {\r\n    let tok = p.peek()\r\n\r\n    if (tok.type === \"ID\") {\r\n      p.next();\r\n      return {type: \"struct\", data: \"\\\"\" + tok.value + \"\\\"\"};\r\n    } else if (basic_types.has(tok.type.toLowerCase())) {\r\n      p.next();\r\n      return {type: tok.type.toLowerCase()};\r\n    } else if (tok.type === \"ARRAY\") {\r\n      return p_Array(p);\r\n    } else {\r\n      p.error(tok, \"invalid type \" + tok.type); //(tok.value === \"\" ? tok.type : tok.value));\r\n    }\r\n  }\r\n\r\n  function p_Field(p) {\r\n    let field = {}\r\n\r\n    console.log(\"-----\", p.peek().type);\r\n\r\n    field.name = p.expect(\"ID\", \"struct field name\");\r\n    p.expect(\"COLON\");\r\n\r\n    field.type = p_Type(p);\r\n    field.set = undefined;\r\n    field.get = undefined;\r\n\r\n    let tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.get = tok.value;\r\n      p.next()\r\n    }\r\n\r\n    tok = p.peek();\r\n    if (tok.type === \"JSCRIPT\") {\r\n      field.set = tok.value;\r\n      p.next();\r\n    }\r\n\r\n    p.expect(\"SEMI\");\r\n\r\n    return field;\r\n  }\r\n\r\n  function p_Struct(p) {\r\n    let st = {}\r\n    st.name = p.expect(\"ID\", \"struct name\")\r\n    st.fields = [];\r\n\r\n    p.expect(\"OPEN\");\r\n\r\n    while (1) {\r\n      if (p.at_end()) {\r\n        p.error(undefined);\r\n      } else if (p.optional(\"CLOSE\")) {\r\n        break;\r\n      } else {\r\n        st.fields.push(p_Field(p));\r\n      }\r\n    }\r\n\r\n    return st;\r\n  }\r\n\r\n  let ret = p_Struct(parser);\r\n\r\n  console.log(JSON.stringify(ret));\r\n}\r\n", "import {ToolClasses, ToolOp, ToolFlags, UndoFlags, ToolMacro} from './toolsys.js';\r\nimport {tokdef, lexer, parser, PUTLParseError} from '../util/parseutil.js';\r\nimport {DataPathError} from '../controller/controller_base.js';\r\nimport {cachering} from '../util/util.js';\r\n\r\nexport let ToolPaths = {};\r\n\r\nvar initToolPaths_run = false;\r\n\r\nexport function buildParser() {\r\n  let t = (name, re, func) => new tokdef(name, re, func);\r\n\r\n  let tokens = [\r\n    t('ID', /[a-zA-Z_$]+[a-zA-Z0-9_$]*/, (t) => {\r\n      if (t.value == \"true\" || t.value == \"false\") {\r\n        t.type = \"BOOL\";\r\n        t.value = t.value == \"true\";\r\n      }\r\n\r\n      return t;\r\n    }),\r\n    t('LPAREN', /\\(/),\r\n    t('RPAREN', /\\)/),\r\n    t('LSBRACKET', /\\[/),\r\n    t('RSBRACKET', /\\]/),\r\n    t('DOT', /\\./),\r\n    t('COMMA', /\\,/),\r\n    t('EQUALS', /\\=/),\r\n    t('STRLIT', /\"[^\"]*\"/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('STRLIT', /'[^']*'/, (t) => {\r\n      t.value = t.value.slice(1, t.value.length-1);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+/, (t) => {\r\n      t.value = parseInt(t.value);\r\n      return t;\r\n    }),\r\n    t('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n      t.value = parseFloat(t.value);\r\n      return t;\r\n    }),\r\n    t('WS', /[ \\n\\r\\t]/, (t) => undefined) //ignore whitespace\r\n  ];\r\n\r\n  let lexerror = (t) => {\r\n    console.warn(\"Parse error\");\r\n    return true;\r\n  };\r\n\r\n  let valid_datatypes = {\r\n    \"STRLIT\" : 1, \"NUMBER\" : 1, \"BOOL\" : 1\r\n  };\r\n\r\n  function p_Start(p) {\r\n    let args = {};\r\n\r\n    while (!p.at_end()) {\r\n      let keyword = p.expect(\"ID\");\r\n\r\n      p.expect(\"EQUALS\");\r\n\r\n      let t = p.next();\r\n      if (!(t.type in valid_datatypes)) {\r\n        throw new PUTLParseError(\"parse error: unexpected \" + t.type);\r\n      }\r\n\r\n      args[keyword] = t.value;\r\n    }\r\n\r\n    return args;\r\n  }\r\n\r\n  let lex = new lexer(tokens, lexerror)\r\n  let p = new parser(lex);\r\n  p.start = p_Start;\r\n\r\n  return p;\r\n}\r\n\r\nexport let Parser = buildParser();\r\n/*\r\nlet parse_rets = new cachering(() => return {\r\n  toolclass : undefined,\r\n  args : {}\r\n}, 64);\r\n//*/\r\n\r\nexport function parseToolPath(str, check_tool_exists=true) {\r\n  if (!initToolPaths_run) {\r\n    initToolPaths_run = true;\r\n    initToolPaths();\r\n  }\r\n\r\n  let startstr = str;\r\n\r\n  let i1 = str.search(/\\(/);\r\n  let i2 = str.search(/\\)/);\r\n  let args = \"\";\r\n\r\n  if (i1 >= 0 && i2 >= 0) {\r\n    args = str.slice(i1+1, i2).trim();\r\n    str = str.slice(0, i1).trim();\r\n  }\r\n\r\n  if (!(str in ToolPaths) && check_tool_exists) {\r\n    throw new DataPathError(\"unknown tool \" + str);\r\n  }\r\n\r\n  let ret;\r\n\r\n  try {\r\n    ret = Parser.parse(args);\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new DataPathError(`\"${startstr}\"\\n  ${error.message}`);\r\n  }\r\n\r\n  return {\r\n    toolclass : ToolPaths[str],\r\n    args      : ret\r\n  };\r\n}\r\n\r\nexport function testToolParser() {\r\n  let ret = parseToolPath(\"view3d.sometool(selectmode=1 str='str' bool=true)\", false);\r\n\r\n  return ret;\r\n}\r\n\r\nwindow.parseToolPath = parseToolPath;\r\n//window._ToolPaths = ToolPaths;\r\n\r\n//tool path parser for simple_toolsys.js\r\nexport function initToolPaths() {\r\n  for (let cls of ToolClasses) {\r\n    if (!cls.hasOwnProperty(\"tooldef\")) { //ignore abstract classes\r\n      continue;\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    let path = def.toolpath;\r\n\r\n    ToolPaths[path] = cls;\r\n  }\r\n}", "import {ToolOp} from '../toolsys/toolsys.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {PropFlags, PropTypes} from '../toolsys/toolprop_abstract.js';\r\nimport {ToolProperty} from '../toolsys/toolprop.js';\r\nimport {DataPathError, isVecProperty, ListIface} from './controller_base.js';\r\n\r\nexport class ModelInterface {\r\n  constructor() {\r\n    this.prefix = \"\";\r\n  }\r\n\r\n  getToolDef(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  getToolPathHotkey(ctx, path) {\r\n    return undefined;\r\n  }\r\n\r\n  get list() {\r\n    throw new Error(\"implement me\");\r\n    return ListIface;\r\n  }\r\n\r\n  createTool(path, inputs = {}, constructor_argument = undefined) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //returns tool class, or undefined if one cannot be found for path\r\n  parseToolPath(path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * runs .undo,.redo if toolstack head is same as tool\r\n   *\r\n   * otherwise, .execTool(ctx, tool) is called.\r\n   *\r\n   * @param compareInputs : check if toolstack head has identical input values, defaults to false\r\n   * */\r\n  execOrRedo(ctx, toolop, compareInputs = false) {\r\n    return ctx.toolstack.execOrRedo(ctx, toolop, compareInputs);\r\n  }\r\n\r\n  execTool(ctx, path, inputs = {}, constructor_argument = undefined, event = undefined) {\r\n    return new Promise((accept, reject) => {\r\n      let tool = path;\r\n\r\n      try {\r\n        if (typeof tool == \"string\" || !(tool instanceof ToolOp)) {\r\n          tool = this.createTool(ctx, path, inputs, constructor_argument);\r\n        }\r\n      } catch (error) {\r\n        print_stack(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      //give client a chance to change tool instance directly\r\n      accept(tool);\r\n\r\n      //execute\r\n      try {\r\n        ctx.toolstack.execTool(ctx, tool, event);\r\n      } catch (error) { //for some reason chrome is suppressing errors\r\n        print_stack(error);\r\n        throw error;\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  pushReportContext(name) {\r\n\r\n  }\r\n\r\n  //used by simple_controller.js for tagging error messages\r\n  popReportContext() {\r\n\r\n  }\r\n\r\n  static toolRegistered(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  static registerTool(tool) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  //not yet supported by path.ux's controller implementation\r\n  massSetProp(ctx, mass_set_path, value) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /** takes a mass_set_path and returns an array of individual paths */\r\n  resolveMassSetPaths(ctx, mass_set_path) {\r\n    throw new Error(\"implement me\");\r\n  }\r\n\r\n  /**\r\n   * @example\r\n   *\r\n   * return {\r\n   *   obj      : [object owning property key]\r\n   *   parent   : [parent of obj]\r\n   *   key      : [property key]\r\n   *   subkey   : used by flag properties, represents a key within the property\r\n   *   value    : [value of property]\r\n   *   prop     : [optional toolprop.ToolProperty representing the property definition]\r\n   *   struct   : [optional datastruct representing the type, if value is an object]\r\n   *   mass_set : mass setter string, if controller implementation supports it\r\n   * }\r\n   */\r\n  resolvePath(ctx, path, ignoreExistence, rootStruct) {\r\n  }\r\n\r\n  setValue(ctx, path, val, rootStruct) {\r\n    let res = this.resolvePath(ctx, path, undefined, rootStruct);\r\n    let prop = res.prop;\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.READ_ONLY)) {\r\n      throw new DataPathError(\"Tried to set read only property\");\r\n    }\r\n\r\n    if (prop !== undefined && (prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      prop.dataref = res.obj;\r\n      prop.ctx = ctx;\r\n      prop.datapath = path;\r\n\r\n      if (res.subkey !== undefined) {\r\n        let val2 = prop.getValue();\r\n        if (typeof val2 === \"object\") {\r\n          val2 = val2.copy();\r\n        }\r\n\r\n        if (prop.type === PropTypes.FLAG) {\r\n          if (val) {\r\n            val2 |= prop.values[res.subkey];\r\n          } else {\r\n            val2 &= ~prop.values[res.subkey];\r\n          }\r\n\r\n          val = val2;\r\n        } else if (prop.type === PropTypes.ENUM) {\r\n          val = prop.values[res.subkey];\r\n        } else {\r\n          val2[res.subkey] = val;\r\n          val = val2;\r\n        }\r\n      }\r\n\r\n      prop.setValue(val);\r\n      return;\r\n    }\r\n\r\n    if (prop !== undefined) {\r\n      if (prop.type === PropTypes.CURVE && !val) {\r\n        throw new DataPathError(\"can't set curve data to nothing\");\r\n      }\r\n\r\n      let use_range = (prop.type & (PropTypes.INT | PropTypes.FLOAT));\r\n\r\n      use_range = use_range || (res.subkey && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)));\r\n      use_range = use_range && prop.range;\r\n      use_range = use_range && !(prop.range[0] === 0.0 && prop.range[1] === 0.0);\r\n      use_range = use_range && typeof val === \"number\";\r\n\r\n      if (use_range) {\r\n        val = Math.min(Math.max(val, prop.range[0]), prop.range[1]);\r\n      }\r\n    }\r\n\r\n    let old = res.obj[res.key];\r\n\r\n    if (res.subkey !== undefined && res.prop !== undefined && res.prop.type === PropTypes.ENUM) {\r\n      let ival = res.prop.values[res.subkey];\r\n\r\n      if (val) {\r\n        res.obj[res.key] = ival;\r\n      }\r\n    } else if (res.prop !== undefined && res.prop.type === PropTypes.FLAG) {\r\n      if (res.subkey !== undefined) {\r\n        let ival = res.prop.values[res.subkey];\r\n\r\n        if (val) {\r\n          res.obj[res.key] |= ival;\r\n        } else {\r\n          res.obj[res.key] &= ~ival;\r\n        }\r\n      } else if (typeof val === \"number\" || typeof val === \"boolean\") {\r\n        val = typeof val === \"boolean\" ? (val & 1) : val;\r\n\r\n        res.obj[res.key] = val;\r\n      } else {\r\n        throw new DataPathError(\"Expected a number for a bitmask property\");\r\n      }\r\n    } else if (res.subkey !== undefined && isVecProperty(res.prop)) {\r\n      if (res.key !== \"\") {\r\n        res.obj[res.key][res.subkey] = val;\r\n      } else {\r\n        res.obj[res.subkey] = val;\r\n      }\r\n    } else if (res.key === \"\" && isVecProperty(res.prop)) {\r\n      for (let i = 0; i < res.obj.length; i++) {\r\n        res.obj[i] = val[i];\r\n      }\r\n    } else if (!(prop !== undefined && prop instanceof ListIface)) {\r\n      res.obj[res.key] = val;\r\n    }\r\n\r\n    if (prop !== undefined && prop instanceof ListIface) {\r\n      prop.set(this, res.obj, res.key, val);\r\n    } else if (prop !== undefined) {\r\n      prop.dataref = res.obj;\r\n      prop.datapath = path;\r\n      prop.ctx = ctx;\r\n\r\n      prop._fire(\"change\", res.obj[res.key], old);\r\n    }\r\n  }\r\n\r\n  getDescription(ctx, path) {\r\n    let rdef = this.resolvePath(ctx, path);\r\n    if (rdef === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    if (!rdef.prop || !(rdef.prop instanceof ToolProperty)) {\r\n      return \"\";\r\n    }\r\n\r\n    let type = rdef.prop.type;\r\n    let prop = rdef.prop;\r\n\r\n    if (rdef.subkey !== undefined) {\r\n      let subkey = rdef.subkey;\r\n\r\n      if (type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        if (!(subkey in prop.values) && subkey in prop.keys) {\r\n          subkey = prop.keys[subkey]\r\n        }\r\n        ;\r\n\r\n        if (prop.descriptions && subkey in prop.descriptions) {\r\n          return prop.descriptions[subkey];\r\n        }\r\n      } else if (type === PropTypes.PROPLIST) {\r\n        let val = tdef.value;\r\n        if (typeof val === \"object\" && val instanceof ToolProperty) {\r\n          return val.description;\r\n        }\r\n      }\r\n    }\r\n\r\n    return rdef.prop.description ? rdef.prop.description : rdef.prop.uiname;\r\n  }\r\n\r\n  validPath(ctx, path, rootStruct) {\r\n    try {\r\n      this.getValue(ctx, path, rootStruct);\r\n      return true;\r\n    } catch (error) {\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getPropName(ctx, path) {\r\n    let i = path.length - 1;\r\n    while (i >= 0 && path[i] !== \".\") {\r\n      i--;\r\n    }\r\n\r\n    path = path.slice(i + 1, path.length).trim();\r\n\r\n    if (path.endsWith(\"]\")) {\r\n      i = path.length - 1;\r\n      while (i >= 0 && path[i] !== \"[\") {\r\n        i--;\r\n      }\r\n\r\n      path = path.slice(0, i).trim();\r\n\r\n      return this.getPropName(ctx, path);\r\n    }\r\n\r\n    return path;\r\n  }\r\n\r\n  getValue(ctx, path, rootStruct = undefined) {\r\n    if (typeof ctx == \"string\") {\r\n      throw new Error(\"You forgot to pass context to getValue\");\r\n    }\r\n\r\n    let ret = this.resolvePath(ctx, path, undefined, rootStruct);\r\n\r\n    if (ret === undefined) {\r\n      throw new DataPathError(\"invalid path \" + path);\r\n    }\r\n\r\n    let exec = ret.prop !== undefined && (ret.prop.flag & PropFlags.USE_CUSTOM_GETSET);\r\n\r\n    //resolvePath handles the case of vector properties with custom callbacks for us\r\n    //(and possibly all the other cases too, need to check)\r\n    exec = exec && !(ret.prop !== undefined && (ret.prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT)));\r\n\r\n    if (exec) {\r\n      ret.prop.dataref = ret.obj;\r\n      ret.prop.datapath = path;\r\n      ret.prop.ctx = ctx;\r\n\r\n      let val = ret.prop.getValue();\r\n\r\n      if (typeof val === \"string\" && (ret.prop.type & (PropTypes.FLAG | PropTypes.ENUM))) {\r\n        val = ret.prop.values[val];\r\n      }\r\n\r\n      if (ret.subkey && ret.prop.type === PropTypes.ENUM) {\r\n        val = val === ret.prop.values[ret.subkey];\r\n      } else if (ret.subkey && ret.prop.type === PropTypes.FLAG) {\r\n        val = val & ret.prop.values[ret.subkey];\r\n      }\r\n\r\n      return val;\r\n\r\n    }\r\n\r\n    return ret.value;\r\n  }\r\n}\r\n", "import {ToolOp, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {\r\n  PropTypes, PropFlags, BoolProperty, IntProperty, FloatProperty, FlagProperty,\r\n  EnumProperty, StringProperty, Vec3Property, Vec2Property, Vec4Property,\r\n  QuatProperty, Mat4Property\r\n} from \"../toolsys/toolprop.js\";\r\n\r\nimport * as util from '../util/util.js';\r\nimport {isVecProperty, getVecClass} from \"./controller_base.js\";\r\n\r\nexport class DataPathSetOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.propType = -1;\r\n    this._undo = undefined;\r\n  }\r\n\r\n  setValue(ctx, val, object) {\r\n    let prop = this.inputs.prop;\r\n    let path = this.inputs.dataPath.getValue();\r\n\r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        if (typeof subkey === \"string\") {\r\n          subkey = rdef.prop.values[subkey];\r\n        }\r\n\r\n        this.inputs.flagBit.setValue(subkey);\r\n        this.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      //if (rdef.subkey !== undefined) {\r\n      //  val = rdef.value;\r\n      //val = !!val;\r\n      //}\r\n    }\r\n\r\n    prop.dataref = object;\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n\r\n    try {\r\n      prop.setValue(val);\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.error(\"Error setting datapath\", path);\r\n      this.hadError = true;\r\n    }\r\n  }\r\n\r\n  static create(ctx, datapath, value, id, massSetPath) {\r\n    let rdef = ctx.api.resolvePath(ctx, datapath);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"DataPathSetOp failed\", rdef, rdef.prop);\r\n      return;\r\n    }\r\n\r\n    let prop = rdef.prop;\r\n    let tool = new DataPathSetOp();\r\n\r\n    tool.propType = prop.type;\r\n    tool.inputs.destType.setValue(prop.type);\r\n\r\n    if (prop && (prop.flag & PropFlags.USE_BASE_UNDO)) {\r\n      tool.inputs.fullSaveUndo.setValue(true);\r\n    }\r\n\r\n    let mask = PropTypes.FLAG | PropTypes.ENUM;\r\n    mask |= PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT;\r\n\r\n    if (rdef.subkey !== undefined && (prop.type & mask)) {\r\n      if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n        let i = datapath.length - 1;\r\n\r\n        //chope off enum selector\r\n        while (i >= 0 && datapath[i] !== '[' && datapath[i] !== '=') {\r\n          i--;\r\n        }\r\n\r\n        if (i >= 0) {\r\n          if (!value && prop.type === PropTypes.ENUM) {\r\n            /* This is a no-op. */\r\n            return undefined;\r\n          }\r\n\r\n          datapath = datapath.slice(0, i).trim();\r\n        }\r\n\r\n        tool.inputs.prop = new IntProperty();\r\n      } else {\r\n        tool.inputs.prop = new FloatProperty();\r\n      }\r\n\r\n      let subkey = rdef.subkey;\r\n      if (typeof subkey !== \"number\") {\r\n        subkey = rdef.prop.values[subkey];\r\n      }\r\n\r\n      if (prop.type === PropTypes.FLAG) {\r\n        tool.inputs.flagBit.setValue(subkey);\r\n        tool.inputs.useFlagBit.setValue(true);\r\n      }\r\n\r\n      if (prop.type === PropTypes.ENUM) {\r\n        value = subkey;\r\n      } else if (prop.type === PropTypes.FLAG) {\r\n        let value2 = ctx.api.getValue(ctx, datapath);\r\n\r\n        if (typeof value2 !== \"number\") {\r\n          value2 = typeof value2 === \"boolean\" ? (value & 1) : 0;\r\n        }\r\n\r\n        if (value) {\r\n          value2 |= subkey;\r\n        } else {\r\n          value2 &= ~subkey;\r\n        }\r\n\r\n        value = value2;\r\n      }\r\n      //value = rdef.obj[rdef.key];\r\n      //console.log(\"rdef.value\", value);\r\n    } else {\r\n      tool.inputs.prop = prop.copy();\r\n    }\r\n\r\n    tool.inputs.dataPath.setValue(datapath);\r\n\r\n    if (massSetPath) {\r\n      tool.inputs.massSetPath.setValue(massSetPath);\r\n    } else {\r\n      tool.inputs.massSetPath.setValue(\"\");\r\n    }\r\n\r\n    tool.id = id;\r\n\r\n    tool.setValue(ctx, value, rdef.obj);\r\n\r\n    return tool;\r\n  }\r\n\r\n  hash(massSetPath, dataPath, prop, id) {\r\n    massSetPath = massSetPath === undefined ? \"\" : massSetPath;\r\n    massSetPath = massSetPath === null ? \"\" : massSetPath;\r\n\r\n    let ret = \"\" + massSetPath + \":\" + dataPath + \":\" + prop + \":\" + id;\r\n\r\n    return ret;\r\n  }\r\n\r\n  hashThis() {\r\n    return this.hash(this.inputs.massSetPath.getValue(),\r\n      this.inputs.dataPath.getValue(),\r\n      this.propType,\r\n      this.id);\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undoPre(ctx);\r\n    }\r\n\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    this._undo = {};\r\n\r\n    let paths = new Set();\r\n\r\n    if (this.inputs.massSetPath.getValue().trim()) {\r\n      let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n      paths = new Set(ctx.api.resolveMassSetPaths(ctx, massSetPath));\r\n\r\n    }\r\n\r\n    paths.add(this.inputs.dataPath.getValue());\r\n\r\n    for (let path of paths) {\r\n      let val = ctx.api.getValue(ctx, path);\r\n\r\n      if (typeof val === \"object\") {\r\n        val = val.copy();\r\n      }\r\n\r\n      this._undo[path] = val;\r\n    }\r\n\r\n    /*\r\n    for (let path of paths) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef === undefined) {\r\n        console.warn(\"Failed to lookup path in DataPathSetOp.undoPre\", path);\r\n        continue;\r\n      }\r\n\r\n      let prop = rdef.prop;\r\n      let value = rdef.value;\r\n\r\n      if (prop.type & (PropTypes.ENUM|PropTypes.FLAG)) {\r\n        this._undo[path] = rdef.obj[rdef.key];\r\n      } else if (isVecProperty(prop)) {\r\n        if (rdef.subkey) {\r\n          this._undo[path] = rdef.value;\r\n        } else {\r\n          let cls = getVecClass(prop.type);\r\n          this._undo[path] = new cls(rdef.value);\r\n        }\r\n      } else {\r\n        let prop2 = prop.copy();\r\n\r\n        prop2.dataref = rdef.obj;\r\n        prop2.datapath = path;\r\n        prop2.ctx = ctx;\r\n\r\n        prop2.setValue(value);\r\n\r\n        this._undo[path] = prop2.getValue();\r\n      }\r\n    }*/\r\n  }\r\n\r\n  undo(ctx) {\r\n    if (this.__ctx)\r\n      ctx = this.__ctx;\r\n\r\n    if (this.inputs.fullSaveUndo.getValue()) {\r\n      return super.undo(ctx);\r\n    }\r\n\r\n    for (let path in this._undo) {\r\n      let rdef = ctx.api.resolvePath(ctx, path);\r\n\r\n      if (rdef.prop !== undefined && (rdef.prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        let old = rdef.obj[rdef.key];\r\n\r\n        if (rdef.subkey) {\r\n          let key = rdef.subkey;\r\n\r\n          if (typeof key !== \"number\") {\r\n            key = rdef.prop.values[key];\r\n          }\r\n\r\n          if (rdef.prop.type === PropTypes.FLAG) {\r\n            if (this._undo[path]) {\r\n              rdef.obj[rdef.key] |= key;\r\n            } else {\r\n              rdef.obj[rdef.key] &= ~key;\r\n            }\r\n          } else {\r\n            rdef.obj[rdef.key] = key;\r\n          }\r\n        } else {\r\n          rdef.obj[rdef.key] = this._undo[path];\r\n        }\r\n\r\n        rdef.prop.dataref = rdef.obj;\r\n        rdef.prop.datapath = path;\r\n        rdef.prop.ctx = ctx;\r\n\r\n        rdef.prop._fire(\"change\", rdef.obj[rdef.key], old);\r\n      } else {\r\n        try {\r\n          ctx.api.setValue(ctx, path, this._undo[path]);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"Failed to set property in undo for DataPathSetOp\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    //use saved ctx we got from modal start\r\n    if (this.__ctx) {\r\n      ctx = this.__ctx;\r\n    }\r\n\r\n    let path = this.inputs.dataPath.getValue();\r\n    let massSetPath = this.inputs.massSetPath.getValue().trim();\r\n\r\n    try {\r\n      ctx.api.setValue(ctx, path, this.inputs.prop.getValue());\r\n      this.hadError = false;\r\n    } catch (error) {\r\n      console.log(error.stack);\r\n      console.log(error.message);\r\n      console.log(\"error setting \" + path);\r\n\r\n      this.hadError = true;\r\n    }\r\n\r\n    if (massSetPath) {\r\n      let value = this.inputs.prop.getValue();\r\n      let useFlagBit = this.inputs.useFlagBit.getValue();\r\n\r\n      if (useFlagBit && this.inputs.destType.getValue() === PropTypes.FLAG) {\r\n        let bit = this.inputs.flagBit.getValue();\r\n\r\n        value = !!(value & bit);\r\n      }\r\n      try {\r\n        ctx.api.massSetProp(ctx, massSetPath, value);\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.log(\"error setting \" + path);\r\n\r\n        this.hadError = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    this.__ctx = ctx.toLocked();\r\n\r\n    //save full, modal ctx\r\n    super.modalStart(this.__ctx);\r\n\r\n    this.exec(this.__ctx);\r\n    this.modalEnd(false);\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Property Set\",\r\n      toolpath: \"app.prop_set\",\r\n      icon    : -1,\r\n      flag    : ToolFlags.PRIVATE,\r\n      is_modal: true,\r\n      inputs  : {\r\n        dataPath    : new StringProperty(),\r\n        massSetPath : new StringProperty(),\r\n        fullSaveUndo: new BoolProperty(false),\r\n        flagBit     : new IntProperty(),\r\n        useFlagBit  : new BoolProperty(),\r\n        destType    : new EnumProperty(PropTypes.INT, PropTypes),\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DataPathSetOp);\r\n", "import nstructjs from \"../util/struct.js\";\r\nimport {CurveFlags, TangentModes, CurveTypeData} from './curve1d_base.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../util/vectormath.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nfunction feq(a, b) {\r\n  return Math.abs(a - b) < 0.00001;\r\n}\r\n\r\nclass EquationCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.equation = \"x\";\r\n    this._last_equation = \"\";\r\n    this._last_xrange = new Vector2();\r\n    this._func = undefined;\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Equation\",\r\n      name    : \"equation\",\r\n      typeName: \"EquationCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n\r\n    super.calcHashKey(d);\r\n\r\n    d.add(this.equation);\r\n    d.add(this.parent.xRange[0]);\r\n    d.add(this.parent.xRange[1]);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    return super.equals(b) && this.equation === b.equation;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      equation: this.equation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    if (obj.equation !== undefined) {\r\n      this.equation = obj.equation;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    let row = container.row();\r\n\r\n    let text = this.uidata.textbox = row.textbox(undefined, \"\" + this.equation);\r\n    text.onchange = (val) => {\r\n      console.log(val);\r\n      this.equation = val;\r\n      this.update();\r\n      this.redraw();\r\n    }\r\n\r\n    container.label(\"Equation\");\r\n\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.textbox.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (this.uidata && this.uidata.textbox) {\r\n      this.uidata.textbox.text = this.equation;\r\n    }\r\n  }\r\n\r\n  evaluate(s) {\r\n    let update = this.hermite || this._last_equation !== this.equation;\r\n    update = update || this._last_xrange.vectorDistance(this.parent.xRange) > 0.0;\r\n    update = update || !this._func;\r\n\r\n    if (update) {\r\n      this._last_xrange.load(this.parent.xRange);\r\n      this._last_equation = this.equation;\r\n\r\n      this.updateTextBox();\r\n      this.#makeFunc();\r\n\r\n      this._evaluate(0.0);\r\n\r\n      if (this._haserror) {\r\n        console.warn(\"ERROR!\");\r\n        return 0.0;\r\n      }\r\n    }\r\n\r\n    return this._func(s);\r\n  }\r\n\r\n  #makeFunc() {\r\n    this._func = undefined;\r\n\r\n    var sin = Math.sin, cos = Math.cos, pi = Math.PI, PI = Math.PI,\r\n        e                                                = Math.E, E                                    = Math.E, tan                      = Math.tan, abs = Math.abs,\r\n        floor                                            = Math.floor, ceil = Math.ceil, acos = Math.acos,\r\n        asin                                             = Math.asin, atan = Math.atan, cosh         = Math.cos,\r\n        sinh                                             = Math.sinh, log                            = Math.log, pow = Math.pow,\r\n        exp                                              = Math.exp, sqrt = Math.sqrt, cbrt           = Math.cbrt,\r\n        min                                              = Math.min, max = Math.max;\r\n\r\n    var func;\r\n    let code = `\r\n    func = function(x) {\r\n      return ${this.equation};\r\n    }\r\n    `;\r\n    try {\r\n      eval(code);\r\n\r\n      this._haserror = false;\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"Compile error!\", error.message);\r\n    }\r\n\r\n    this._func = func;\r\n  }\r\n\r\n  _evaluate(s) {\r\n    try {\r\n      let f = this._func(s);\r\n      this._haserror = false;\r\n\r\n      if (isNaN(f)) {\r\n        return 0.0;\r\n      }\r\n    } catch (error) {\r\n      this._haserror = true;\r\n      console.warn(\"ERROR!\");\r\n      return 0.0;\r\n    }\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n\r\n  onActive(parent, draw_transform) {\r\n  }\r\n\r\n  onInactive(parent, draw_transform) {\r\n  }\r\n\r\n  reset() {\r\n    this.equation = \"x\";\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    g.save();\r\n    if (this._haserror) {\r\n\r\n      g.fillStyle = g.strokeStyle = \"rgba(255, 50, 0, 0.25)\";\r\n      g.beginPath();\r\n      g.rect(0, 0, 1, 1);\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(0, 0);\r\n      g.lineTo(1, 1);\r\n      g.moveTo(0, 1);\r\n      g.lineTo(1, 0);\r\n\r\n      g.lineWidth *= 3;\r\n      g.stroke();\r\n\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n}\r\n\r\nEquationCurve.STRUCT = nstructjs.inherit(EquationCurve, CurveTypeData) + `\r\n  equation : string;\r\n}\r\n`;\r\nnstructjs.register(EquationCurve);\r\nCurveTypeData.register(EquationCurve);\r\n\r\n\r\nclass GuassianCurve extends CurveTypeData {\r\n  constructor(type) {\r\n    super();\r\n\r\n    this.height = 1.0;\r\n    this.offset = 1.0;\r\n    this.deviation = 0.3; //standard deviation\r\n  }\r\n\r\n  get hasGUI() {\r\n    return this.uidata !== undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      uiname  : \"Guassian\",\r\n      name    : \"guassian\",\r\n      typeName: \"GuassianCurve\"\r\n    }\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    super.calcHashKey(digest);\r\n\r\n    let d = digest;\r\n\r\n    d.add(this.height);\r\n    d.add(this.offset);\r\n    d.add(this.deviation);\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    let r = super.equals(b);\r\n\r\n    r = r && feq(this.height, b.height);\r\n    r = r && feq(this.offset, b.offset);\r\n    r = r && feq(this.deviation, b.deviation);\r\n\r\n    return r;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = super.toJSON();\r\n\r\n    return Object.assign(ret, {\r\n      height   : this.height,\r\n      offset   : this.offset,\r\n      deviation: this.deviation\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n\r\n    this.height = obj.height !== undefined ? obj.height : 1.0;\r\n    this.offset = obj.offset;\r\n    this.deviation = obj.deviation;\r\n\r\n    return this;\r\n  }\r\n\r\n  makeGUI(container, canvas, drawTransform) {\r\n    this.uidata = {\r\n      canvas    : canvas,\r\n      g         : canvas.g,\r\n      draw_trans: drawTransform,\r\n    };\r\n\r\n    this.uidata.hslider = container.slider(undefined, \"Height\", this.height, -10, 10, 0.0001);\r\n    this.uidata.hslider.onchange = () => {\r\n      this.height = this.uidata.hslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.oslider = container.slider(undefined, \"Offset\", this.offset, -10, 10, 0.0001);\r\n    this.uidata.oslider.onchange = () => {\r\n      this.offset = this.uidata.oslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n    this.uidata.dslider = container.slider(undefined, \"STD Deviation\", this.deviation, -10, 10, 0.0001);\r\n    this.uidata.dslider.onchange = () => {\r\n      this.deviation = this.uidata.dslider.value;\r\n      this.redraw();\r\n      this.update();\r\n    }\r\n\r\n    /*\r\n    this.uidata.oslider = gui.slider(undefined, \"Offset\", this.offset,\r\n      -2.5, 2.5, 0.0001, false, false, (val) => {this.offset = val, this.update(), this.redraw();});\r\n    this.uidata.dslider = gui.slider(undefined, \"STD Deviation\", this.deviation,\r\n      0.0001, 1.25, 0.0001, false, false, (val) => {this.deviation = val, this.update(), this.redraw();});\r\n    //*/\r\n  }\r\n\r\n  killGUI(dom, gui, canvas, g, draw_transform) {\r\n    if (this.uidata !== undefined) {\r\n      this.uidata.hslider.remove();\r\n      this.uidata.oslider.remove();\r\n      this.uidata.dslider.remove();\r\n    }\r\n\r\n    this.uidata = undefined;\r\n  }\r\n\r\n  evaluate(s) {\r\n    let r = this.height*Math.exp(-((s - this.offset)*(s - this.offset))/(2*this.deviation*this.deviation));\r\n    return r;\r\n  }\r\n\r\n  derivative(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.evaluate(s) - this.evaluate(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.evaluate(s + df) - this.evaluate(s))/df;\r\n    } else {\r\n      return (this.evaluate(s + df) - this.evaluate(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  derivative2(s) {\r\n    let df = 0.0001;\r\n\r\n    if (s > 1.0 - df*3) {\r\n      return (this.derivative(s) - this.derivative(s - df))/df;\r\n    } else if (s < df*3) {\r\n      return (this.derivative(s + df) - this.derivative(s))/df;\r\n    } else {\r\n      return (this.derivative(s + df) - this.derivative(s - df))/(2*df);\r\n    }\r\n  }\r\n\r\n  inverse(y) {\r\n    let steps = 9;\r\n    let ds = 1.0/steps, s = 0.0;\r\n    let best = undefined;\r\n    let ret = undefined;\r\n\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let s1 = s, s2 = s + ds;\r\n\r\n      let mid;\r\n\r\n      for (let j = 0; j < 11; j++) {\r\n        let y1 = this.evaluate(s1);\r\n        let y2 = this.evaluate(s2);\r\n        mid = (s1 + s2)*0.5;\r\n\r\n        if (Math.abs(y1 - y) < Math.abs(y2 - y)) {\r\n          s2 = mid;\r\n        } else {\r\n          s1 = mid;\r\n        }\r\n      }\r\n\r\n      let ymid = this.evaluate(mid);\r\n\r\n      if (best === undefined || Math.abs(y - ymid) < best) {\r\n        best = Math.abs(y - ymid);\r\n        ret = mid;\r\n      }\r\n    }\r\n\r\n    return ret === undefined ? 0.0 : ret;\r\n  }\r\n}\r\n\r\nGuassianCurve.STRUCT = nstructjs.inherit(GuassianCurve, CurveTypeData) + `\r\n  height    : float;\r\n  offset    : float;\r\n  deviation : float;\r\n}\r\n`;\r\nnstructjs.register(GuassianCurve);\r\nCurveTypeData.register(GuassianCurve);\r\n", "/*\r\n* Ease\r\n* Visit http://createjs.com/ for documentation, updates and examples.\r\n*\r\n* Copyright (c) 2010 gskinner.com, inc.\r\n*\r\n* Permission is hereby granted, free of charge, to any person\r\n* obtaining a copy of this software and associated documentation\r\n* files (the \"Software\"), to deal in the Software without\r\n* restriction, including without limitation the rights to use,\r\n* copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n* copies of the Software, and to permit persons to whom the\r\n* Software is furnished to do so, subject to the following\r\n* conditions:\r\n*\r\n* The above copyright notice and this permission notice shall be\r\n* included in all copies or substantial portions of the Software.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\n* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\n* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\n* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n* OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n* @module TweenJS\r\n*/\r\n\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with TweenJS. It does not use the standard 4 param\r\n * easing signature. Instead it uses a single param which indicates the current linear ratio (0 to 1) of the tween.\r\n *\r\n * Most methods on Ease can be passed directly as easing functions:\r\n *\r\n *      createjs.Tween.get(target).to({x:100}, 500, createjs.Ease.linear);\r\n *\r\n * However, methods beginning with \"get\" will return an easing function based on parameter values:\r\n *\r\n *      createjs.Tween.get(target).to({y:200}, 500, createjs.Ease.getPowIn(2.2));\r\n *\r\n * Please see the <a href=\"http://www.createjs.com/Demos/TweenJS/Tween_SparkTable\">spark table demo</a> for an\r\n * overview of the different ease types on <a href=\"http://tweenjs.com\">TweenJS.com</a>.\r\n *\r\n * <em>Equations derived from work by Robert Penner.</em>\r\n * @class Ease\r\n * @static\r\n **/\r\n\r\n\r\nfunction Ease() {\r\n  throw \"Ease cannot be instantiated.\";\r\n}\r\n\r\nexport default Ease;\r\n\r\n// static methods and properties\r\n/**\r\n * @method linear\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.linear = function(t) { return t; };\r\n\r\n/**\r\n * Identical to linear.\r\n * @method none\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.none = Ease.linear;\r\n\r\n/**\r\n * Mimics the simple -100 to 100 easing in Adobe Flash/Animate.\r\n * @method get\r\n * @param {Number} amount A value from -1 (ease in) to 1 (ease out) indicating the strength and direction of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.get = function(amount) {\r\n  if (amount < -1) { amount = -1; }\r\n  else if (amount > 1) { amount = 1; }\r\n  return function(t) {\r\n    if (amount==0) { return t; }\r\n    if (amount<0) { return t*(t*-amount+1+amount); }\r\n    return t*((2-t)*amount+(1-amount));\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowIn\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowIn = function(pow) {\r\n  return function(t) {\r\n    return Math.pow(t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowOut = function(pow) {\r\n  return function(t) {\r\n    return 1-Math.pow(1-t,pow);\r\n  };\r\n};\r\n\r\n/**\r\n * Configurable exponential ease.\r\n * @method getPowInOut\r\n * @param {Number} pow The exponent to use (ex. 3 would return a cubic ease).\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getPowInOut = function(pow) {\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*Math.pow(t,pow);\r\n    return 1-0.5*Math.abs(Math.pow(2-t,pow));\r\n  };\r\n};\r\n\r\n/**\r\n * @method quadIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadIn = Ease.getPowIn(2);\r\n/**\r\n * @method quadOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadOut = Ease.getPowOut(2);\r\n/**\r\n * @method quadInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quadInOut = Ease.getPowInOut(2);\r\n\r\n/**\r\n * @method cubicIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicIn = Ease.getPowIn(3);\r\n/**\r\n * @method cubicOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicOut = Ease.getPowOut(3);\r\n/**\r\n * @method cubicInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.cubicInOut = Ease.getPowInOut(3);\r\n\r\n/**\r\n * @method quartIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartIn = Ease.getPowIn(4);\r\n/**\r\n * @method quartOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartOut = Ease.getPowOut(4);\r\n/**\r\n * @method quartInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quartInOut = Ease.getPowInOut(4);\r\n\r\n/**\r\n * @method quintIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintIn = Ease.getPowIn(5);\r\n/**\r\n * @method quintOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintOut = Ease.getPowOut(5);\r\n/**\r\n * @method quintInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.quintInOut = Ease.getPowInOut(5);\r\n\r\n/**\r\n * @method sineIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineIn = function(t) {\r\n  return 1-Math.cos(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineOut = function(t) {\r\n  return Math.sin(t*Math.PI/2);\r\n};\r\n\r\n/**\r\n * @method sineInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.sineInOut = function(t) {\r\n  return -0.5*(Math.cos(Math.PI*t) - 1);\r\n};\r\n\r\n/**\r\n * Configurable \"back in\" ease.\r\n * @method getBackIn\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackIn = function(amount) {\r\n  return function(t) {\r\n    return t*t*((amount+1)*t-amount);\r\n  };\r\n};\r\n/**\r\n * @method backIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backIn = Ease.getBackIn(1.7);\r\n\r\n/**\r\n * Configurable \"back out\" ease.\r\n * @method getBackOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackOut = function(amount) {\r\n  return function(t) {\r\n    return (--t*t*((amount+1)*t + amount) + 1);\r\n  };\r\n};\r\n/**\r\n * @method backOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backOut = Ease.getBackOut(1.7);\r\n\r\n/**\r\n * Configurable \"back in out\" ease.\r\n * @method getBackInOut\r\n * @param {Number} amount The strength of the ease.\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getBackInOut = function(amount) {\r\n  amount*=1.525;\r\n  return function(t) {\r\n    if ((t*=2)<1) return 0.5*(t*t*((amount+1)*t-amount));\r\n    return 0.5*((t-=2)*t*((amount+1)*t+amount)+2);\r\n  };\r\n};\r\n/**\r\n * @method backInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.backInOut = Ease.getBackInOut(1.7);\r\n\r\n/**\r\n * @method circIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circIn = function(t) {\r\n  return -(Math.sqrt(1-t*t)- 1);\r\n};\r\n\r\n/**\r\n * @method circOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circOut = function(t) {\r\n  return Math.sqrt(1-(--t)*t);\r\n};\r\n\r\n/**\r\n * @method circInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.circInOut = function(t) {\r\n  if ((t*=2) < 1) return -0.5*(Math.sqrt(1-t*t)-1);\r\n  return 0.5*(Math.sqrt(1-(t-=2)*t)+1);\r\n};\r\n\r\n/**\r\n * @method bounceIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceIn = function(t) {\r\n  return 1-Ease.bounceOut(1-t);\r\n};\r\n\r\n/**\r\n * @method bounceOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceOut = function(t) {\r\n  if (t < 1/2.75) {\r\n    return (7.5625*t*t);\r\n  } else if (t < 2/2.75) {\r\n    return (7.5625*(t-=1.5/2.75)*t+0.75);\r\n  } else if (t < 2.5/2.75) {\r\n    return (7.5625*(t-=2.25/2.75)*t+0.9375);\r\n  } else {\r\n    return (7.5625*(t-=2.625/2.75)*t +0.984375);\r\n  }\r\n};\r\n\r\n/**\r\n * @method bounceInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.bounceInOut = function(t) {\r\n  if (t<0.5) return Ease.bounceIn (t*2) * .5;\r\n  return Ease.bounceOut(t*2-1)*0.5+0.5;\r\n};\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticIn\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticIn = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2*Math.asin(1/amplitude);\r\n    return -(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period));\r\n  };\r\n};\r\n/**\r\n * @method elasticIn\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticIn = Ease.getElasticIn(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    if (t==0 || t==1) return t;\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    return (amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period )+1);\r\n  };\r\n};\r\n/**\r\n * @method elasticOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticOut = Ease.getElasticOut(1,0.3);\r\n\r\n/**\r\n * Configurable elastic ease.\r\n * @method getElasticInOut\r\n * @param {Number} amplitude\r\n * @param {Number} period\r\n * @static\r\n * @return {Function}\r\n **/\r\nEase.getElasticInOut = function(amplitude,period) {\r\n  var pi2 = Math.PI*2;\r\n  return function(t) {\r\n    var s = period/pi2 * Math.asin(1/amplitude);\r\n    if ((t*=2)<1) return -0.5*(amplitude*Math.pow(2,10*(t-=1))*Math.sin( (t-s)*pi2/period ));\r\n    return amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*0.5+1;\r\n  };\r\n};\r\n/**\r\n * @method elasticInOut\r\n * @param {Number} t\r\n * @static\r\n * @return {Number}\r\n **/\r\nEase.elasticInOut = Ease.getElasticInOut(1,0.3*1.5);\r\n", "import nstructjs from \"../util/struct.js\";\r\nimport {CurveConstructors, CurveTypeData} from \"./curve1d_base.js\";\r\nimport Ease from './ease.js';\r\nimport * as util from '../util/util.js';\r\n\r\nfunction bez3(a, b, c, t) {\r\n  var r1 = a + (b - a)*t;\r\n  var r2 = b + (c - b)*t;\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nfunction bez4(a, b, c, d, t) {\r\n  var r1 = bez3(a, b, c, t);\r\n  var r2 = bez3(b, c, d, t);\r\n\r\n  return r1 + (r2 - r1)*t;\r\n}\r\n\r\nexport class ParamKey {\r\n  constructor(key, val) {\r\n    this.key = key;\r\n    this.val = val;\r\n  }\r\n}\r\n\r\nParamKey.STRUCT = `\r\nParamKey {\r\n  key : string;\r\n  val : float;\r\n}\r\n`\r\nnstructjs.register(ParamKey);\r\nlet BOOL_FLAG = 1e17;\r\n\r\nlet _udigest = new util.HashDigest();\r\n\r\nexport class SimpleCurveBase extends CurveTypeData {\r\n  constructor() {\r\n    super();\r\n\r\n    this.type = this.constructor.name;\r\n\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    this.params = {};\r\n    for (let k in params) {\r\n      this.params[k] = params[k][1];\r\n    }\r\n  }\r\n\r\n  get hasGUI() {\r\n    return true;\r\n  }\r\n\r\n  calcHashKey(digest = _udigest.reset()) {\r\n    let d = digest;\r\n    super.calcHashKey(d);\r\n\r\n    for (let k in this.params) {\r\n      digest.add(k);\r\n      digest.add(this.params[k]);\r\n    }\r\n\r\n    return d.get();\r\n  }\r\n\r\n  equals(b) {\r\n    if (this.type !== b.type) {\r\n      return false;\r\n    }\r\n\r\n    for (let k in this.params) {\r\n      if (Math.abs(this.params[k] - b.params[k]) > 0.000001) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  redraw() {\r\n    if (this.parent)\r\n      this.parent.redraw();\r\n  }\r\n\r\n  makeGUI(container) {\r\n    let def = this.constructor.define();\r\n    let params = def.params;\r\n\r\n    for (let k in params) {\r\n      let p = params[k];\r\n\r\n      if (p[2] === BOOL_FLAG) {\r\n        let check = container.check(undefined, p[0]);\r\n        check.checked = !!this.params[k];\r\n        check.key = k;\r\n\r\n        let this2 = this;\r\n        check.onchange = function () {\r\n          this2.params[this.key] = this.checked ? 1 : 0;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      } else {\r\n        let slider = container.slider(undefined, {\r\n          name      : p[0],\r\n          defaultval: this.params[k],\r\n          min       : p[2],\r\n          max       : p[3]\r\n        })\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        slider.key = k;\r\n\r\n        let this2 = this;\r\n        slider.onchange = function () {\r\n          this2.params[this.key] = this.value;\r\n          this2.update();\r\n          this2.redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  killGUI(container) {\r\n    container.clear();\r\n  }\r\n\r\n  evaluate(s) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  reset() {\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  draw(canvas, g, draw_transform) {\r\n    let steps = 128;\r\n    let s = 0, ds = 1.0/(steps - 1);\r\n\r\n    g.beginPath();\r\n    for (let i = 0; i < steps; i++, s += ds) {\r\n      let co = this.evaluate(s);\r\n\r\n      if (i) {\r\n        g.lineTo(co[0], co[1]);\r\n      } else {\r\n        g.moveTo(co[0], co[1]);\r\n      }\r\n    }\r\n\r\n    g.stroke();\r\n  }\r\n\r\n  _saveParams() {\r\n    let ret = [];\r\n    for (let k in this.params) {\r\n      ret.push(new ParamKey(k, this.params[k]));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      params: this.params\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    for (let k in obj.params) {\r\n      this.params[k] = obj.params[k];\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n    super.loadSTRUCT(reader);\r\n\r\n    let ps = this.params;\r\n    this.params = {};\r\n\r\n    let pdef = this.constructor.define().params;\r\n    if (!pdef) {\r\n      console.warn(\"Missing define function for curve\", this.constructor.name)\r\n      return;\r\n    }\r\n\r\n    for (let pair of ps) {\r\n      if (pair.key in pdef) {\r\n        this.params[pair.key] = pair.val;\r\n      }\r\n    }\r\n\r\n    for (let k in pdef) {\r\n      if (!(k in this.params)) {\r\n        this.params[k] = pdef[k][1];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSimpleCurveBase.STRUCT = nstructjs.inherit(SimpleCurveBase, CurveTypeData) + `\r\n  params : array(ParamKey) | obj._saveParams();\r\n}\r\n`;\r\nnstructjs.register(SimpleCurveBase);\r\n\r\nexport class BounceCurve extends SimpleCurveBase {\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        decay : [\"Decay\", 1.0, 0.1, 5.0],\r\n        scale : [\"Scale\", 1.0, 0.01, 10.0],\r\n        freq  : [\"Freq\", 1.0, 0.01, 50.0],\r\n        phase : [\"Phase\", 0.0, -Math.PI*2.0, Math.PI*2.0],\r\n        offset: [\"Offset\", 0.0, -2.0, 2.0]\r\n      },\r\n      name    : \"bounce\",\r\n      uiname  : \"Bounce\",\r\n      typeName: \"BounceCurve\"\r\n\r\n    }\r\n  }\r\n\r\n  _evaluate(t) {\r\n    let params = this.params;\r\n    let decay = params.decay + 1.0;\r\n    let scale = params.scale;\r\n    let freq = params.freq;\r\n    let phase = params.phase;\r\n    let offset = params.offset;\r\n\r\n    t *= freq;\r\n    let t2 = Math.abs(Math.cos(phase + t*Math.PI*2.0))*scale;\r\n    ;//+ (1.0-scale);\r\n\r\n    t2 *= Math.exp(decay*t)/Math.exp(decay);\r\n\r\n    return t2;\r\n  }\r\n\r\n  evaluate(t) {\r\n    let s = this._evaluate(0.0);\r\n    let e = this._evaluate(1.0);\r\n\r\n    return (this._evaluate(t) - s)/(e - s) + this.params.offset;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(BounceCurve);\r\nBounceCurve.STRUCT = nstructjs.inherit(BounceCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(BounceCurve);\r\n\r\n\r\nexport class ElasticCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._func = undefined;\r\n    this._last_hash = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode     : [\"Out Mode\", false, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 10.0],\r\n        period   : [\"Period\", 1.0, 0.01, 5.0]\r\n      },\r\n      name    : \"elastic\",\r\n      uiname  : \"Elastic\",\r\n      typeName: \"ElasticCurve\",\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let hash = ~~(this.params.mode*127 + this.params.amplitude*256 + this.params.period*512);\r\n\r\n    if (hash !== this._last_hash || !this._func) {\r\n      this._last_hash = hash;\r\n\r\n      if (this.params.mode) {\r\n        this._func = Ease.getElasticOut(this.params.amplitude, this.params.period);\r\n      } else {\r\n        this._func = Ease.getElasticIn(this.params.amplitude, this.params.period);\r\n      }\r\n    }\r\n    return this._func(t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(ElasticCurve);\r\nElasticCurve.STRUCT = nstructjs.inherit(ElasticCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(ElasticCurve);\r\n\r\n\r\nexport class EaseCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        mode_in  : [\"in\", true, BOOL_FLAG, BOOL_FLAG],\r\n        mode_out : [\"out\", true, BOOL_FLAG, BOOL_FLAG],\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0]\r\n      },\r\n      name    : \"ease\",\r\n      uiname  : \"Ease\",\r\n      typeName: \"EaseCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let amp = this.params.amplitude;\r\n    let a1 = this.params.mode_in ? 1.0 - amp : 1.0/3.0;\r\n    let a2 = this.params.mode_out ? amp : 2.0/3.0;\r\n\r\n    return bez4(0.0, a1, a2, 1.0, t);\r\n  }\r\n}\r\n\r\nCurveTypeData.register(EaseCurve);\r\nEaseCurve.STRUCT = nstructjs.inherit(EaseCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(EaseCurve);\r\n\r\n\r\nexport class RandCurve extends SimpleCurveBase {\r\n  constructor() {\r\n    super();\r\n    this.random = new util.MersenneRandom();\r\n    this.seed = 0;\r\n  }\r\n\r\n  get seed() {\r\n    return this._seed;\r\n  }\r\n\r\n  set seed(v) {\r\n    this.random.seed(v);\r\n    this._seed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      params  : {\r\n        amplitude: [\"Amplitude\", 1.0, 0.01, 4.0],\r\n        decay    : [\"Decay\", 1.0, 0.0, 5.0],\r\n        in_mode  : [\"In\", true, BOOL_FLAG, BOOL_FLAG]\r\n      },\r\n      name    : \"random\",\r\n      uiname  : \"Random\",\r\n      typeName: \"RandCurve\"\r\n    }\r\n  }\r\n\r\n  evaluate(t) {\r\n    let r = this.random.random();\r\n    let decay = this.params.decay + 1.0;\r\n    let amp = this.params.amplitude;\r\n    let in_mode = this.params.in_mode;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n    //r *= t;\r\n\r\n    let d;\r\n\r\n    //r *= 0.5;\r\n\r\n    if (in_mode) {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    } else {\r\n      d = Math.exp(t*decay)/Math.exp(decay);\r\n    }\r\n\r\n    t = t + (r - t)*d;\r\n\r\n    if (in_mode) {\r\n      t = 1.0 - t;\r\n    }\r\n\r\n    return t;\r\n  }\r\n}\r\n\r\nCurveTypeData.register(RandCurve);\r\nRandCurve.STRUCT = nstructjs.inherit(RandCurve, SimpleCurveBase) + `\r\n}`;\r\nnstructjs.register(RandCurve);\r\n\r\n\r\n", "import {Curve1D} from './curve1d.js';\r\nimport {ToolProperty, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as nstructjs from '../util/nstructjs_es6.js';\r\n\r\nimport './curve1d_all.js';\r\n\r\nexport class Curve1DProperty extends ToolProperty {\r\n  constructor(curve, apiname, uiname, description, flag, icon) {\r\n    super(PropTypes.CURVE, undefined, apiname, uiname, description, flag, icon);\r\n\r\n    this.data = new Curve1D();\r\n\r\n    if (curve !== undefined) {\r\n      this.setValue(curve);\r\n    }\r\n\r\n    this.wasSet = false;\r\n  }\r\n\r\n  calcMemSize() {\r\n    //bleh, just return a largish block size\r\n    return 1024;\r\n  }\r\n\r\n  equals(b) {\r\n\r\n  }\r\n\r\n  getValue() {\r\n    return this.data;\r\n  }\r\n\r\n  evaluate(t) {\r\n    return this.data.evaluate(t);\r\n  }\r\n\r\n  setValue(curve) {\r\n    if (curve === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.data.load(curve);\r\n    super.setValue(curve);\r\n  }\r\n\r\n  copyTo(b) {\r\n    super.copyTo(b);\r\n\r\n    b.setValue(this.data);\r\n  }\r\n}\r\n\r\nCurve1DProperty.STRUCT = nstructjs.inherit(Curve1DProperty, ToolProperty) + `\r\n  data : Curve1D;\r\n}\r\n`;\r\n\r\nnstructjs.register(Curve1DProperty);\r\nToolProperty.internalRegister(Curve1DProperty);\r\n\r\n", "/**\r\n\r\n This is the main datapath controller module, inspired by Blender's RNA system.\r\n\r\n Datapaths are special bindings for objects; they store types (e.g. float, int, enumeration, string),\r\n as well as lots of UI-specific metadata (like human-readable names, tooltips, icons, numeric ranges, etc).\r\n\r\n Controller bindings are intended to present a more unified and coherent model of the\r\n application model than may actually exists.  This is inspired by Blender's RNA system, which\r\n hides almost all of Blender's core data structure complexity (Blender is written in C) from\r\n users who e.g. write python scripts, extend the UI, use advanced animation features, or anything else\r\n that uses RNA paths.\r\n\r\n ## Contexts\r\n\r\n The datapath system works in tandem with the context module.  Contexts are client-provided classes\r\n that the datapath API and ToolOps use to communicate with the application state.\r\n\r\n ## Example\r\n\r\n <pre>\r\n\r\n function initMyDataAPI() {\r\n let api = new DataAPI();\r\n\r\n //map MyContextClass to a struct, true tells mapStruct to auto-create\r\n //the struct if it doesn't already exist.\r\n //\r\n //MyContextClass should have a member \"propCache\" pointing at SavedToolDefaults.\r\n let st = api.mapStruct(MyContextClass, true);\r\n\r\n //set fields of struct, e.g. st.int, st.float, st.enum, st.struct, etc\r\n\r\n //build toolsys api\r\n buildToolSysAPI(api);\r\n\r\n //create bindings for default tool operator settings\r\n cstruct.struct(\"propCache\", \"toolDefaults\", \"Tool Defaults\", api.mapStruct(ToolPropertyCache));\r\n\r\n return api;\r\n }\r\n </pre>\r\n */\r\nimport * as toolprop from '../toolsys/toolprop.js';\r\nimport * as parseutil from '../util/parseutil.js';\r\nimport {print_stack} from '../util/util.js';\r\nimport {ToolOp, UndoFlags, ToolFlags} from \"../toolsys/toolsys.js\";\r\nimport {Vec2Property, Vec3Property, Vec4Property, PropTypes, PropFlags} from '../toolsys/toolprop.js';\r\nimport * as toolprop_abstract from '../toolsys/toolprop_abstract.js';\r\nimport * as util from '../util/util.js';\r\n\r\nimport {DataPath, DataFlags, DataTypes, DataPathError, StructFlags, getTempProp} from './controller_base.js';\r\n\r\nexport * from './controller_base.js';\r\n\r\nlet PUTLParseError = parseutil.PUTLParseError;\r\n\r\nlet tk = (name, re, func) => new parseutil.tokdef(name, re, func);\r\nlet tokens = [\r\n  tk(\"ID\", /[a-zA-Z_$]+[a-zA-Z_$0-9]*/),\r\n  tk(\"NUM\", /-?[0-9]+/, (t) => {\r\n    t.value = parseInt(t.value);\r\n    return t;\r\n  }),\r\n  tk('NUMBER', /-?[0-9]+\\.[0-9]*/, (t) => {\r\n    t.value = parseFloat(t.value);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /'.*?'/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"STRLIT\", /\".*?\"/, (t) => {\r\n    t.value = t.value.slice(1, t.value.length - 1);\r\n    return t;\r\n  }),\r\n  tk(\"DOT\", /\\./),\r\n  tk(\"EQUALS\", /(\\=)|(\\=\\=)/),\r\n  tk(\"LSBRACKET\", /\\[/),\r\n  tk(\"RSBRACKET\", /\\]/),\r\n  tk(\"AND\", /\\&/),\r\n  tk(\"WS\", /[ \\t\\n\\r]+/, (t) => undefined), //drop token\r\n];\r\n\r\nlet lexer = new parseutil.lexer(tokens, (t) => {\r\n  console.warn(\"Parse error\", t);\r\n  throw new DataPathError();\r\n});\r\n\r\nexport let pathParser = new parseutil.parser(lexer);\r\n\r\nlet parserStack = new Array(32);\r\nfor (let i = 0; i < parserStack.length; i++) {\r\n  parserStack[i] = pathParser.copy();\r\n}\r\nparserStack.cur = 0;\r\n\r\nimport {\r\n  setImplementationClass, isVecProperty, ListIface\r\n} from './controller_base.js';\r\nimport {initToolPaths, parseToolPath} from '../toolsys/toolpath.js';\r\nimport {ModelInterface} from './controller_abstract.js';\r\n\r\nexport {DataPathError, DataFlags} from './controller_base.js';\r\n\r\nimport {ToolClasses} from '../toolsys/toolsys.js';\r\nimport {ToolProperty, IntProperty} from \"../toolsys/toolprop.js\";\r\n\r\nlet tool_classes = ToolClasses;\r\n\r\nlet tool_idgen = 1;\r\nSymbol.ToolID = Symbol(\"toolid\");\r\n\r\nfunction toolkey(cls) {\r\n  if (!(Symbol.ToolID in cls)) {\r\n    cls[Symbol.ToolID] = tool_idgen++;\r\n  }\r\n\r\n  return cls[Symbol.ToolID];\r\n}\r\n\r\nlet lt = util.time_ms();\r\nlet lastmsg = undefined;\r\nlet lcount = 0;\r\n\r\nlet reportstack = [\"api\"];\r\n\r\nexport function pushReportName(name) {\r\n  if (reportstack.length > 1024) {\r\n    console.trace(\"eerk, reportstack overflowed\");\r\n    reportstack.length = 0;\r\n    reportstack.push(\"api\");\r\n  }\r\n\r\n  reportstack.push(name);\r\n}\r\n\r\nfunction report(msg) {\r\n  let name = reportstack.length === 0 ? \"api\" : reportstack[reportstack.length - 1];\r\n\r\n  util.console.context(name).warn(msg);\r\n}\r\n\r\nexport function popReportName() {\r\n  reportstack.pop();\r\n}\r\n\r\n\r\nexport class DataList extends ListIface {\r\n  constructor(callbacks) {\r\n    super();\r\n\r\n    if (callbacks === undefined) {\r\n      throw new DataPathError(\"missing callbacks argument to DataList\");\r\n    }\r\n\r\n    this.cb = {};\r\n\r\n    if (typeof callbacks === \"object\" && !Array.isArray(callbacks)) {\r\n      for (let k in callbacks) {\r\n        this.cb[k] = callbacks[k];\r\n      }\r\n    } else {\r\n      for (let cb of callbacks) {\r\n        this.cb[cb.name] = cb;\r\n      }\r\n    }\r\n\r\n    let check = (key) => {\r\n      if (!(key in this.cbs)) {\r\n        throw new DataPathError(`Missing ${key} callback in DataList`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   Generic list API.\r\n\r\n   * Callbacks is an array of name functions, like so:\r\n   - function getStruct(api, list, key) //return DataStruct type of object in key, key is optional if omitted return base type of all objects?\r\n   - function get(api, list, key)\r\n   - function set(api, list, key, val) //this one has default behavior: list[key] = val\r\n   - function getLength(api, list)\r\n   - function getActive(api, list)\r\n   - function setActive(api, list, key)\r\n   - function getIter(api, list)\r\n   - function getKey(api, list, object) returns object's key in this list, either a string or a number\r\n   * */\r\n\r\n  copy() {\r\n    let ret = new DataList([this.cb.get]);\r\n\r\n    for (let k in this.cb) {\r\n      ret.cb[k] = this.cb[k];\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get(api, list, key) {\r\n    return this.cb.get(api, list, key);\r\n  }\r\n\r\n  getLength(api, list) {\r\n    this._check(\"getLength\");\r\n    return this.cb.getLength(api, list);\r\n  }\r\n\r\n  _check(cb) {\r\n    if (!(cb in this.cb)) {\r\n      throw new DataPathError(cb + \" not supported by this list\");\r\n    }\r\n  }\r\n\r\n  set(api, list, key, val) {\r\n    if (this.cb.set === undefined) {\r\n      list[key] = val;\r\n    } else {\r\n      this.cb.set(api, list, key, val);\r\n    }\r\n  }\r\n\r\n  getIter(api, list) {\r\n    this._check(\"getIter\");\r\n    return this.cb.getIter(api, list);\r\n  }\r\n\r\n  filter(api, list, bitmask) {\r\n    this._check(\"filter\");\r\n    return this.cb.filter(api, list, bitmask);\r\n  }\r\n\r\n  getActive(api, list) {\r\n    this._check(\"getActive\");\r\n    return this.cb.getActive(api, list);\r\n  }\r\n\r\n  setActive(api, list, key) {\r\n    this._check(\"setActive\");\r\n    this.cb.setActive(api, list, key);\r\n  }\r\n\r\n  getKey(api, list, obj) {\r\n    this._check(\"getKey\");\r\n    return this.cb.getKey(api, list, obj);\r\n  }\r\n\r\n  getStruct(api, list, key) {\r\n    if (this.cb.getStruct !== undefined) {\r\n      return this.cb.getStruct(api, list, key);\r\n    }\r\n\r\n    let obj = this.get(api, list, key);\r\n\r\n    if (obj === undefined)\r\n      return undefined;\r\n\r\n    return api.getStruct(obj.constructor);\r\n  }\r\n}\r\n\r\nexport class DataStruct {\r\n  constructor(members = [], name = \"unnamed\") {\r\n    this.members = [];\r\n    this.name = name;\r\n    this.pathmap = {};\r\n    this.flag = 0;\r\n    this.dpath = undefined; //owning DataPath\r\n\r\n    this.inheritFlag = 0;\r\n\r\n    for (let m of members) {\r\n      this.add(m);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.pathmap = {};\r\n    this.members = [];\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    let ret = new DataStruct();\r\n\r\n    ret.name = this.name;\r\n    ret.flag = this.flag;\r\n    ret.inheritFlag = this.inheritFlag;\r\n\r\n    for (let m of this.members) {\r\n      let m2 = m.copy();\r\n\r\n      //don't copy struct or list references, just\r\n      //direct properties\r\n\r\n      if (m2.type === DataTypes.PROP) {\r\n        m2.data = m2.data.copy();\r\n      }\r\n\r\n      ret.add(m2);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Like .struct, but the type of struct is looked up\r\n   * for objects at runtime.  Note that to work correctly each object\r\n   * must create its own struct definition via api.mapStruct\r\n   *\r\n   * @param path\r\n   * @param apiname\r\n   * @param uiname\r\n   * @param default_struct : default struct if one can't be looked up\r\n   * @returns {*}\r\n   */\r\n  dynamicStruct(path, apiname, uiname, default_struct = undefined) {\r\n    let ret = default_struct ? default_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.DYNAMIC_STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  struct(path, apiname, uiname, existing_struct = undefined) {\r\n    let ret = existing_struct ? existing_struct : new DataStruct();\r\n\r\n    let dpath = new DataPath(path, apiname, ret, DataTypes.STRUCT);\r\n    ret.inheritFlag |= this.inheritFlag;\r\n\r\n    ret.dpath = dpath;\r\n\r\n    this.add(dpath);\r\n    return ret;\r\n  }\r\n\r\n  customGet(getter) {\r\n    this.dpath.customGet(getter);\r\n\r\n    return this;\r\n  }\r\n\r\n  customGetSet(getter, setter) {\r\n    this.dpath.customGetSet(getter, setter);\r\n\r\n    return this;\r\n  }\r\n\r\n  color3(path, apiname, uiname, description) {\r\n    let ret = this.vec3(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  color4(path, apiname, uiname, description = uiname) {\r\n    let ret = this.vec4(path, apiname, uiname, description);\r\n\r\n    ret.data.subtype = toolprop.PropSubTypes.COLOR;\r\n    ret.range(0, 1);\r\n    ret.simpleSlider();\r\n\r\n    ret.noUnits();\r\n\r\n    return ret;\r\n  }\r\n\r\n  arrayList(path, apiname, structdef, uiname, description) {\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key === \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return structdef;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  color3List(path, apiname, uiname, description) {\r\n    return this.vectorList(3, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  color4List(path, apiname, uiname, description) {\r\n    return this.vectorList(4, path, apiname, uiname, description, toolprop.PropSubTypes.COLOR);\r\n  }\r\n\r\n  vectorList(size, path, apiname, uiname, description, subtype) {\r\n    let type;\r\n\r\n    switch (size) {\r\n      case 2:\r\n        type = toolprop.Vec2Property;\r\n        break;\r\n      case 3:\r\n        type = toolprop.Vec3Property;\r\n      case 4:\r\n        type = toolprop.Vec4Property;\r\n    }\r\n\r\n    if (type === undefined) {\r\n      throw new DataPathError(\"Invalid size for vectorList; expected 2 3 or 4\");\r\n    }\r\n\r\n    let prop = new type(undefined, apiname, uiname, description);\r\n\r\n    let pstruct = new DataStruct(undefined, \"Vector\");\r\n    pstruct.vec3(\"\", \"co\", \"Coords\", \"Coordinates\");\r\n\r\n    let ret = this.list(path, apiname, [\r\n      function getIter(api, list) {\r\n        return list[Symbol.iterator]();\r\n      },\r\n      function getLength(api, list) {\r\n        return list.length;\r\n      },\r\n      function get(api, list, key) {\r\n        return list[key];\r\n      },\r\n      function set(api, list, key, val) {\r\n        if (typeof key == \"string\") {\r\n          key = parseInt(key);\r\n        }\r\n\r\n        if (key < 0 || key >= list.length) {\r\n          throw new DataPathError(\"Invalid index \" + key);\r\n        }\r\n\r\n        list[key] = val;\r\n      },\r\n      function getKey(api, list, obj) {\r\n        return list.indexOf(obj);\r\n      },\r\n      function getStruct(api, list, key) {\r\n        return pstruct;\r\n      }]);\r\n\r\n    return ret;\r\n  }\r\n\r\n  bool(path, apiname, uiname, description) {\r\n    let prop = new toolprop.BoolProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec2(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec2Property(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec3(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec3Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  vec4(path, apiname, uiname, description) {\r\n    let prop = new toolprop.Vec4Property(undefined, apiname, uiname, description);\r\n    //prop.uiname = uiname;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  float(path, apiname, uiname, description) {\r\n    let prop = new toolprop.FloatProperty(0, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  textblock(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n    prop.multiLine = true;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  report(path, apiname, uiname, description) {\r\n    let prop = new toolprop.ReportProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  string(path, apiname, uiname, description) {\r\n    let prop = new toolprop.StringProperty(undefined, apiname, uiname, description);\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  int(path, apiname, uiname, description, prop = undefined) {\r\n    if (!prop) {\r\n      prop = new toolprop.IntProperty(0, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  curve1d(path, apiname, uiname, description) {\r\n    let prop = new Curve1DProperty(undefined);\r\n\r\n    prop.apiname = apiname;\r\n    prop.uiname = uiname;\r\n    prop.description = description;\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  enum(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef instanceof toolprop.EnumProperty) {\r\n      prop = enumdef;\r\n    } else {\r\n      prop = new toolprop.EnumProperty(undefined, enumdef, apiname, uiname, description);\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  list(path, apiname, funcs) {\r\n    let array = new DataList(funcs);\r\n\r\n    let dpath = new DataPath(path, apiname, array);\r\n    dpath.type = DataTypes.ARRAY;\r\n\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  flags(path, apiname, enumdef, uiname, description) {\r\n    let prop;\r\n\r\n    if (enumdef === undefined || !(enumdef instanceof toolprop.ToolProperty)) {\r\n      prop = new toolprop.FlagProperty(undefined, enumdef, apiname, uiname, description);\r\n    } else {\r\n      prop = enumdef;\r\n    }\r\n\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  remove(m) {\r\n    if (typeof m === \"string\") {\r\n      m = this.pathmap[m];\r\n    }\r\n\r\n    if (!(m.apiname in this.pathmap)) {\r\n      throw new Error(\"Member not in struct \" + m.apiname);\r\n    }\r\n\r\n    delete this.pathmap[m.apiname];\r\n    this.members.remove(m);\r\n  }\r\n\r\n  fromToolProp(path, prop, apiname = prop.apiname.length > 0 ? prop.apiname : path) {\r\n    let dpath = new DataPath(path, apiname, prop);\r\n    this.add(dpath);\r\n    return dpath;\r\n  }\r\n\r\n  add(m) {\r\n    if (m.apiname in this.pathmap) {\r\n      if (window.DEBUG.datapaths) {\r\n        console.warn(\"Overriding existing member '\" + m.apiname + \"' in datapath struct\", this.name);\r\n      }\r\n\r\n      this.remove(this.pathmap[m.apiname]);\r\n    }\r\n\r\n    m.flag |= this.inheritFlag;\r\n\r\n    this.members.push(m);\r\n    m.parent = this;\r\n\r\n    this.pathmap[m.apiname] = m;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nlet _map_struct_idgen = 1;\r\nlet _map_structs = {};\r\n\r\nwindow._debug__map_structs = _map_structs; //global for debugging purposes only\r\n\r\nlet _dummypath = new DataPath();\r\n\r\nlet DummyIntProperty = new IntProperty();\r\nconst CLS_API_KEY = Symbol(\"dp_map_id\");\r\nconst CLS_API_KEY_CUSTOM = Symbol(\"dp_map_custom\");\r\n\r\nexport class DataAPI extends ModelInterface {\r\n  constructor() {\r\n    super();\r\n\r\n    this.rootContextStruct = undefined;\r\n    this.structs = [];\r\n  }\r\n\r\n  get list() {\r\n    return undefined;\r\n  }\r\n\r\n  static toolRegistered(cls) {\r\n    return ToolOp.isRegistered(cls);\r\n    //let key = toolkey(cls);\r\n    //return key in tool_classes;\r\n  }\r\n\r\n  static registerTool(cls) {\r\n    console.warn(\"Outdated function simple_controller.DataAPI.registerTool called\");\r\n\r\n    return ToolOp.register(cls);\r\n\r\n    //let key = toolkey(cls);\r\n    //\r\n    //if (!(key in tool_classes)) {\r\n    //  tool_classes[key] = cls;\r\n    //}\r\n  }\r\n\r\n  getStructs() {\r\n    return this.structs;\r\n  }\r\n\r\n  setRoot(sdef) {\r\n    this.rootContextStruct = sdef;\r\n  }\r\n\r\n  hasStruct(cls) {\r\n    return cls.hasOwnProperty(CLS_API_KEY);\r\n  }\r\n\r\n  getStruct(cls) {\r\n    return this.mapStruct(cls, false);\r\n  }\r\n\r\n  mergeStructs(dest, src) {\r\n    for (let m of src.members) {\r\n      dest.add(m.copy());\r\n    }\r\n  }\r\n\r\n  inheritStruct(cls, parent, auto_create_parent = false) {\r\n    let st = this.mapStruct(parent, auto_create_parent);\r\n\r\n    if (st === undefined) {\r\n      throw new Error(\"parent has no struct definition\");\r\n    }\r\n\r\n    st = st.copy();\r\n    st.name = cls.name;\r\n\r\n    this._addClass(cls, st);\r\n    return st;\r\n  }\r\n\r\n  /**\r\n   * Look up struct definition for a class.\r\n   *\r\n   * @param cls: the class\r\n   * @param auto_create: If true, automatically create definition if not already existing.\r\n   * @returns {IterableIterator<*>}\r\n   */\r\n\r\n  _addClass(cls, dstruct) {\r\n    let key = _map_struct_idgen++;\r\n    cls[CLS_API_KEY] = key;\r\n\r\n    this.structs.push(dstruct);\r\n\r\n    _map_structs[key] = dstruct;\r\n  }\r\n\r\n  /* Associate cls with a DataStruct\r\n   * via callback, which will be called\r\n   * with an instance of cls as its argument*/\r\n  mapStructCustom(cls, callback) {\r\n    this.mapStruct(cls, true);\r\n    cls[CLS_API_KEY_CUSTOM] = callback;\r\n  }\r\n\r\n  mapStruct(cls, auto_create = true, name = cls.name) {\r\n    let key;\r\n\r\n    if (!cls.hasOwnProperty(CLS_API_KEY)) {\r\n      key = undefined;\r\n    } else {\r\n      key = cls[CLS_API_KEY];\r\n    }\r\n\r\n    if (key === undefined && auto_create) {\r\n      let dstruct = new DataStruct(undefined, name);\r\n      this._addClass(cls, dstruct);\r\n      return dstruct;\r\n    } else if (key === undefined) {\r\n      throw new Error(\"class does not have a struct definition: \" + name);\r\n    }\r\n\r\n    return _map_structs[key];\r\n  }\r\n\r\n  //used for tagging error messages\r\n  pushReportContext(name) {\r\n    pushReportName(name);\r\n  }\r\n\r\n  //used for tagging error messages\r\n  popReportContext() {\r\n    popReportName();\r\n  }\r\n\r\n  /*\r\n  massSetProp operate on lists.  The idea is to\r\n  write a filter str inside a data path, e.g.\r\n\r\n  ctx.api.massSetProp(ctx, \"obj.list[{$.select}].value\", 1);\r\n\r\n\r\n  * */\r\n  massSetProp(ctx, massSetPath, value) {\r\n    for (let path of this.resolveMassSetPaths(ctx, massSetPath)) {\r\n      this.setValue(ctx, path, value);\r\n    }\r\n  }\r\n\r\n  resolveMassSetPaths(ctx, massSetPath) {\r\n    if (massSetPath.startsWith(\"/\")) {\r\n      massSetPath = massSetPath.slice(1, massSetPath.length);\r\n    }\r\n\r\n    let start = massSetPath.search(\"{\");\r\n    let end = massSetPath.search(\"}\");\r\n\r\n    if (start < 0 || end < 0) {\r\n      throw new DataPathError(\"Invalid mass set datapath: \" + massSetPath);\r\n      return;\r\n    }\r\n\r\n    let prefix = massSetPath.slice(0, start - 1);\r\n    let filter = massSetPath.slice(start + 1, end);\r\n    let suffix = massSetPath.slice(end + 2, massSetPath.length);\r\n\r\n    let rdef = this.resolvePath(ctx, prefix);\r\n\r\n    if (!(rdef.prop instanceof DataList)) {\r\n      throw new DataPathError(\"massSetPath expected a path resolving to a DataList: \" + massSetPath);\r\n    }\r\n\r\n    let paths = [];\r\n\r\n    let list = rdef.prop;\r\n    let api = ctx.api;\r\n\r\n    function applyFilter(obj) {\r\n      const forceEval = rdef.dpath.flag & DataFlags.USE_EVAL_MASS_SET_PATHS;\r\n\r\n      if (obj === undefined) {\r\n        return undefined;\r\n      } else if (!forceEval && (typeof obj === \"object\" || typeof obj === \"function\")) {\r\n        let st = api.mapStruct(obj.constructor, false);\r\n\r\n        let path = filter;\r\n        if (path.startsWith(\"$\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n        if (path.startsWith(\".\")) {\r\n          path = path.slice(1, filter.length).trim();\r\n        }\r\n\r\n        try {\r\n          return api.getValue(obj, path, st);\r\n        } catch (error) {\r\n          if (!(error instanceof DataPathError)) {\r\n            util.print_stack(error);\r\n            console.error(\"Error in datapath callback\");\r\n          }\r\n\r\n          return false;\r\n        }\r\n      } else {\r\n        let $ = obj;\r\n        return eval(filter);\r\n      }\r\n    }\r\n\r\n    for (let obj of list.getIter(this, rdef.value)) {\r\n      if (!applyFilter(obj)) {\r\n        continue;\r\n      }\r\n\r\n      let key = \"\" + list.getKey(this, rdef.value, obj);\r\n      let path = `${prefix}[${key}]${suffix}`;\r\n\r\n      /* validate the final path */\r\n      try {\r\n        this.getValue(ctx, path);\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.error(path + \": Error in datapath API\");\r\n        }\r\n\r\n        continue;\r\n      }\r\n\r\n      paths.push(path);\r\n    }\r\n\r\n    return paths;\r\n  }\r\n\r\n  resolvePath(ctx, inpath, ignoreExistence = false, dstruct = undefined) {\r\n    let parser = parserStack[parserStack.cur++];\r\n    let ret = undefined;\r\n\r\n    if (inpath[0] === \"/\") {\r\n      inpath = inpath.slice(1, inpath.length).trim();\r\n    }\r\n\r\n    try {\r\n      ret = this.resolvePath_intern(ctx, inpath, ignoreExistence, parser, dstruct)\r\n    } catch (error) {\r\n      //throw new DataPathError(\"bad path \" + path);\r\n      if (!(error instanceof DataPathError)) {\r\n        util.print_stack(error);\r\n        report(\"error while evaluating path \" + inpath);\r\n      }\r\n\r\n      if (window.DEBUG && window.DEBUG.datapaths) {\r\n        util.print_stack(error);\r\n      }\r\n\r\n      ret = undefined;\r\n    }\r\n\r\n    parserStack.cur--;\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && (ret.dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n      ret.prop = this.getPropOverride(ctx, inpath, ret.dpath, ret.obj);\r\n    }\r\n\r\n    if (ret !== undefined && ret.prop && ret.dpath && ret.dpath.ui_name_get) {\r\n      let dummy = {\r\n        datactx : ctx,\r\n        datapath: inpath,\r\n        dataref : ret.obj\r\n      };\r\n\r\n      let name = ret.dpath.ui_name_get.call(dummy);\r\n\r\n      ret.prop.uiname = \"\" + name;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getPropOverride(ctx, path, dpath, obj, prop = dpath.data) {\r\n    prop.ctx = ctx;\r\n    prop.datapath = path;\r\n    prop.dataref = obj;\r\n\r\n    let newprop = getTempProp(prop.type);\r\n    prop.copyTo(newprop);\r\n\r\n    dpath.propGetter.call(prop, newprop);\r\n    prop.ctx = prop.datapath = prop.dataref = undefined;\r\n\r\n    return newprop;\r\n  }\r\n\r\n  /**\r\n   get meta information for a datapath.\r\n\r\n   @param ignoreExistence: don't try to get actual data associated with path,\r\n    just want meta information\r\n   */\r\n  resolvePath_intern(ctx, inpath, ignoreExistence = false, p = pathParser, dstruct = undefined) {\r\n    inpath = inpath.replace(\"==\", \"=\");\r\n\r\n    p.input(inpath);\r\n\r\n    dstruct = dstruct || this.rootContextStruct;\r\n\r\n    let obj = ctx;\r\n    let lastobj = ctx;\r\n    let subkey;\r\n    let lastobj2 = undefined;\r\n    let lastkey = undefined;\r\n    let prop = undefined;\r\n    let lastdpath = undefined;\r\n\r\n    function p_key() {\r\n      let t = p.peeknext();\r\n      if (t.type === \"NUM\" || t.type === \"STRLIT\") {\r\n        p.next();\r\n        return t.value;\r\n      } else {\r\n        throw new PUTLParseError(\"Expected list key\");\r\n      }\r\n    }\r\n\r\n    let _i = 0;\r\n    while (!p.at_end()) {\r\n      let key = p.expect(\"ID\");\r\n      let dpath = dstruct.pathmap[key];\r\n\r\n      lastdpath = dpath;\r\n\r\n      if (dpath === undefined) {\r\n        if (key === \"length\" && prop !== undefined && prop instanceof DataList) {\r\n          prop.getLength(this, obj);\r\n          key = \"length\";\r\n\r\n          prop = DummyIntProperty;\r\n\r\n          prop.name = \"length\";\r\n          prop.flag = PropFlags.READ_ONLY;\r\n\r\n          dpath = _dummypath;\r\n          dpath.type = DataTypes.PROP;\r\n          dpath.data = prop;\r\n          dpath.struct = dpath.parent = dstruct;\r\n          dpath.flag = DataFlags.READ_ONLY;\r\n          dpath.path = \"length\";\r\n\r\n          /*\r\n          parent: lastobj2,\r\n            obj: lastobj,\r\n            value: obj,\r\n            key: lastkey,\r\n            //*/\r\n        } else if (key === \"active\" && prop !== undefined && prop instanceof DataList) {\r\n          let act = prop.getActive(this, obj);\r\n\r\n          if (act === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no active elem ent for list\");\r\n          }\r\n\r\n          let actkey = obj !== undefined && act !== undefined ? prop.getKey(this, obj, act) : undefined;\r\n\r\n          dstruct = prop.getStruct(this, obj, actkey);\r\n          if (dstruct === undefined) {\r\n            throw new DataPathError(\"couldn't get data type for \" + inpath + \"'s element '\" + key + \"'\");\r\n          }\r\n\r\n          _dummypath.parent = dpath;\r\n          dpath = _dummypath;\r\n\r\n          lastobj = obj;\r\n          obj = act;\r\n\r\n          dpath.type = DataTypes.STRUCT;\r\n          dpath.data = dstruct;\r\n          dpath.path = key;\r\n\r\n          p.optional(\"DOT\");\r\n\r\n          continue;\r\n        } else {\r\n          throw new DataPathError(inpath + \": unknown property \" + key);\r\n        }\r\n      }\r\n\r\n      let dynstructobj = undefined;\r\n\r\n      if (dpath.type === DataTypes.STRUCT) {\r\n        dstruct = dpath.data;\r\n      } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n        let ok = false;\r\n\r\n        if (obj !== undefined) {\r\n          let obj2;\r\n\r\n          if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n            let fakeprop = dpath.getSet;\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj2 = fakeprop.get();\r\n\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          } else {\r\n            obj2 = obj[dpath.path];\r\n          }\r\n\r\n          dynstructobj = obj2;\r\n\r\n          if (obj2 !== undefined) {\r\n            if (CLS_API_KEY_CUSTOM in obj2.constructor) {\r\n              dstruct = obj2.constructor[CLS_API_KEY_CUSTOM](obj2);\r\n            } else {\r\n              dstruct = this.mapStruct(obj2.constructor, false);\r\n            }\r\n          } else {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          if (dstruct === undefined) {\r\n            dstruct = dpath.data;\r\n          }\r\n\r\n          ok = dstruct !== undefined;\r\n        }\r\n\r\n        if (!ok) {\r\n          throw new DataPathError(\"dynamic struct error for path: \" + inpath);\r\n        }\r\n      } else {\r\n        prop = dpath.data;\r\n      }\r\n\r\n      if (prop && (dpath.flag & DataFlags.USE_CUSTOM_PROP_GETTER)) {\r\n        prop = this.getPropOverride(ctx, inpath, dpath, obj);\r\n      }\r\n\r\n      if (dpath.path.search(/\\./) >= 0) {\r\n        let keys = dpath.path.split(/\\./);\r\n\r\n        for (let key of keys) {\r\n          lastobj2 = lastobj;\r\n          lastobj = obj;\r\n          lastkey = key;\r\n\r\n          if (obj === undefined && !ignoreExistence) {\r\n            throw new DataPathError(\"no data for \" + inpath);\r\n          } else if (obj !== undefined) {\r\n            obj = obj[key.trim()];\r\n          }\r\n        }\r\n      } else {\r\n        lastobj2 = lastobj;\r\n        lastobj = obj;\r\n\r\n        lastkey = dpath.path;\r\n\r\n        if (dpath.flag & DataFlags.USE_CUSTOM_GETSET) {\r\n          let fakeprop = dpath.getSet;\r\n\r\n          if (!fakeprop && dpath.type === DataTypes.PROP) {\r\n            let prop = dpath.data;\r\n\r\n            prop.ctx = ctx;\r\n            prop.dataref = obj;\r\n            prop.datapath = inpath;\r\n\r\n            try {\r\n              obj = prop.getValue();\r\n            } catch (error) {\r\n              util.print_stack(error);\r\n              obj = undefined;\r\n            }\r\n\r\n            if (typeof obj === \"string\" && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n              obj = prop.values[obj];\r\n            }\r\n\r\n            prop.ctx = prop.dataref = prop.datapath = undefined;\r\n          } else {\r\n            fakeprop.ctx = ctx;\r\n            fakeprop.dataref = obj;\r\n            fakeprop.datapath = inpath;\r\n\r\n            obj = fakeprop.get();\r\n            fakeprop.ctx = fakeprop.datapath = fakeprop.dataref = undefined;\r\n          }\r\n        } else if (obj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for \" + inpath);\r\n        } else if (dpath.type === DataTypes.DYNAMIC_STRUCT) {\r\n          obj = dynstructobj;\r\n        } else if (obj !== undefined && dpath.path !== \"\") {\r\n          obj = obj[dpath.path];\r\n        }\r\n      }\r\n\r\n      let t = p.peeknext();\r\n      if (t === undefined) {\r\n        break;\r\n      }\r\n\r\n      if (t.type === \"DOT\") {\r\n        p.next();\r\n      } else if (t.type === \"EQUALS\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"EQUALS\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] == val);\r\n      } else if (t.type === \"AND\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"AND\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        key = dpath.path;\r\n        obj = !!(lastobj[key] & val);\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && (prop.type & (PropTypes.ENUM | PropTypes.FLAG))) {\r\n        p.expect(\"LSBRACKET\");\r\n\r\n        let t2 = p.peeknext();\r\n        let type = t2 && t2.type === \"ID\" ? \"ID\" : \"NUM\";\r\n\r\n        let val = p.expect(type);\r\n\r\n        let val1 = val;\r\n\r\n        if (typeof val == \"string\") {\r\n          val = prop.values[val];\r\n        }\r\n\r\n        if (val === undefined) {\r\n          console.warn(inpath, prop.values, val1, prop);\r\n          throw new DataPathError(\"unknown value \" + val1);\r\n        }\r\n\r\n        if (val in prop.keys) {\r\n          subkey = prop.keys[val];\r\n        }\r\n\r\n        let bitfield;\r\n        key = dpath.path;\r\n\r\n        if (!(prop.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n          bitfield = lastobj ? lastobj[key] : 0;\r\n        } else {\r\n          prop.dataref = lastobj;\r\n          prop.datapath = inpath;\r\n          prop.ctx = ctx;\r\n\r\n          try {\r\n            bitfield = prop.getValue();\r\n          } catch (error) {\r\n            util.print_stack(error);\r\n\r\n            bitfield = NaN;\r\n          }\r\n        }\r\n\r\n        if (lastobj === undefined && !ignoreExistence) {\r\n          throw new DataPathError(\"no data for path \" + inpath);\r\n        } else if (lastobj !== undefined) {\r\n          if (prop.type === PropTypes.ENUM) {\r\n            obj = !!(bitfield === val);\r\n          } else {\r\n            obj = !!(bitfield & val);\r\n          }\r\n        }\r\n\r\n        p.expect(\"RSBRACKET\");\r\n      } else if (t.type === \"LSBRACKET\" && prop !== undefined && isVecProperty(prop)) {\r\n        p.expect(\"LSBRACKET\");\r\n        let num = p.expect(\"NUM\");\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        subkey = num;\r\n\r\n        if (prop !== undefined && !(prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n          lastobj = obj;\r\n        }\r\n\r\n        obj = obj[num];\r\n      } else if (t.type === \"LSBRACKET\") {\r\n        p.expect(\"LSBRACKET\")\r\n\r\n        if (lastobj && lastkey && typeof lastkey === \"string\" && lastkey.length > 0) {\r\n          lastobj = lastobj[lastkey];\r\n        }\r\n\r\n        lastkey = p_key();\r\n        p.expect(\"RSBRACKET\");\r\n\r\n        if (!(prop instanceof DataList)) {\r\n          throw new DataPathError(\"bad property, not a list\");\r\n        }\r\n\r\n        obj = prop.get(this, lastobj, lastkey);\r\n        dstruct = prop.getStruct(this, lastobj, lastkey);\r\n\r\n        if (!dstruct) {\r\n          throw new DataPathError(inpath + \": list has no entry \" + lastkey);\r\n        }\r\n\r\n        if (p.peeknext() !== undefined && p.peeknext().type === \"DOT\") {\r\n          p.next();\r\n        }\r\n      }\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop in resolvePath parser\");\r\n        break;\r\n      }\r\n    }\r\n\r\n    return {\r\n      dpath  : lastdpath,\r\n      parent : lastobj2,\r\n      obj    : lastobj,\r\n      value  : obj,\r\n      key    : lastkey,\r\n      dstruct: dstruct,\r\n      prop   : prop,\r\n      subkey : subkey\r\n    };\r\n  }\r\n\r\n  _parsePathOverrides(path) {\r\n    let parts = ['', undefined, undefined];\r\n\r\n    const TOOLPATH = 0, NAME = 1, HOTKEY = 2;\r\n    let part = TOOLPATH;\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let c = path[i];\r\n      let n = i < path.length - 1 ? path[i + 1] : \"\";\r\n\r\n      if (c === \"|\") {\r\n        part = NAME;\r\n        parts[NAME] = \"\";\r\n        continue;\r\n      } else if (c === \":\" && n === \":\") {\r\n        part = HOTKEY;\r\n        parts[HOTKEY] = \"\";\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      parts[part] += c;\r\n    }\r\n\r\n    return {\r\n      path  : parts[TOOLPATH].trim(),\r\n      uiname: parts[NAME] ? parts[NAME].trim() : undefined,\r\n      hotkey: parts[HOTKEY] ? parts[HOTKEY].trim() : undefined,\r\n    };\r\n  }\r\n\r\n  /** Get tooldef for path, applying any modifications, e.g.:\r\n   *  \"app.some_tool()|Label::CustomHotkeyString\"\r\n   * */\r\n  getToolDef(toolpath) {\r\n    let {path, uiname, hotkey} = this._parsePathOverrides(toolpath);\r\n\r\n    let cls = this.parseToolPath(path);\r\n    if (cls === undefined) {\r\n      throw new DataPathError(\"unknown path \\\"\" + path + \"\\\"\");\r\n    }\r\n\r\n    let def = cls.tooldef();\r\n    if (uiname) {\r\n      def.uiname = uiname;\r\n    }\r\n    if (hotkey) {\r\n      def.hotkey = hotkey;\r\n    }\r\n\r\n    return def;\r\n  }\r\n\r\n  getToolPathHotkey(ctx, toolpath) {\r\n    let {path, uiname, hotkey} = this._parsePathOverrides(toolpath);\r\n\r\n    if (hotkey) {\r\n      return hotkey;\r\n    }\r\n\r\n    try {\r\n      return this.#getToolPathHotkey_intern(ctx, path);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      util.console.context(\"api\").log(\"failed to fetch tool path: \" + path);\r\n\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  #getToolPathHotkey_intern(ctx, path) {\r\n    let screen = ctx.screen;\r\n    let this2 = this;\r\n\r\n    function searchKeymap(keymap) {\r\n      if (keymap === undefined) {\r\n        return undefined;\r\n      }\r\n\r\n      let ret;\r\n\r\n      function search(cb) {\r\n        if (ret) {\r\n          return;\r\n        }\r\n\r\n        for (let hk of keymap) {\r\n          if (typeof hk.action === \"string\" && cb(hk.action)) {\r\n            ret = hk.buildString();\r\n          }\r\n        }\r\n      }\r\n\r\n      search((tool) => tool.trim() === path.trim());\r\n      search((tool) => this2._parsePathOverrides(tool).path === path.trim());\r\n\r\n      return ret;\r\n    }\r\n\r\n    if (screen.sareas.length === 0) {\r\n      return searchKeymap(screen.keymap);\r\n    }\r\n\r\n    //client might have its own area subclass with\r\n    //getActiveArea defined (that's encouraged),\r\n    //which is why we don't just call Area.getActiveArea\r\n    let areacls = screen.sareas[0].area.constructor;\r\n    let area = areacls.getActiveArea();\r\n\r\n    if (area) {\r\n      for (let keymap of area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret !== undefined) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    //search all other areas\r\n    for (let sarea of screen.sareas) {\r\n      if (!sarea.area) continue;\r\n\r\n      for (let keymap of sarea.area.getKeyMaps()) {\r\n        let ret = searchKeymap(keymap);\r\n\r\n        if (ret) {\r\n          return ret;\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.keymap ? searchKeymap(this.keymap) : false;\r\n  }\r\n\r\n  parseToolPath(path) {\r\n    try {\r\n      return parseToolPath(path).toolclass;\r\n    } catch (error) {\r\n      if (error instanceof DataPathError) {\r\n        console.warn(\"warning, bad tool path \" + path);\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  parseToolArgs(path) {\r\n    return parseToolPath(path).args;\r\n  }\r\n\r\n  createTool(ctx, path, inputs = {}) {\r\n    let cls;\r\n    let args;\r\n\r\n    if (typeof path == \"string\" || path instanceof String) {\r\n      //parseToolPath will raise DataPathError if path is malformed\r\n      let tpath = parseToolPath(path);\r\n\r\n      cls = tpath.toolclass;\r\n      args = tpath.args;\r\n    } else {\r\n      cls = path;\r\n      args = {};\r\n    }\r\n\r\n    if (!cls) {\r\n      debugger;\r\n      console.error(\"Unknown tool \" + path);\r\n    }\r\n\r\n    args = {...args}\r\n\r\n    // feed inputs to invoke\r\n    const tooldef = cls._getFinalToolDef()\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tooldef.inputs)) {\r\n          console.warn(cls.tooldef().uiname + \": Unknown tool property \\\"\" + k + \"\\\"\");\r\n          continue;\r\n        }\r\n\r\n        if (!(k in args)) {\r\n          args[k] = inputs[k]\r\n        }\r\n      }\r\n    }\r\n\r\n    let tool = cls.invoke(ctx, args);\r\n\r\n    if (inputs !== undefined) {\r\n      for (let k in inputs) {\r\n        if (!(k in tool.inputs)) {\r\n          console.warn(cls.tooldef().uiname + \": Unknown tool property \\\"\" + k + \"\\\"\");\r\n          continue;\r\n        }\r\n\r\n        tool.inputs[k].setValue(inputs[k]);\r\n      }\r\n    }\r\n\r\n    return tool;\r\n  }\r\n}\r\n\r\nexport function initSimpleController() {\r\n  initToolPaths();\r\n}\r\n\r\nimport {DataPathSetOp} from \"./controller_ops.js\";\r\nimport {Curve1DProperty} from '../curve/curve1d_toolprop.js';\r\n\r\nlet dpt = DataPathSetOp;\r\n\r\nexport function getDataPathToolOp() {\r\n  return dpt;\r\n}\r\n\r\nexport function setDataPathToolOp(cls) {\r\n  ToolOp.unregister(DataPathSetOp);\r\n\r\n  if (!ToolOp.isRegistered(cls)) {\r\n    ToolOp.register(cls);\r\n  }\r\n\r\n  dpt = cls;\r\n}\r\n\r\nsetImplementationClass(DataAPI);\r\n", "import * as util from '../util/util.js';\r\nimport * as vectormath from '../util/vectormath.js';\r\nimport {Vector3, Vector4} from '../util/vectormath.js';\r\n\r\nlet rgb_to_hsv_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function rgb_to_hsv(r, g, b) {\r\n  let computedH = 0;\r\n  let computedS = 0;\r\n  let computedV = 0;\r\n\r\n  if (r == null || g == null || b == null ||\r\n    isNaN(r) || isNaN(g) || isNaN(b)) {\r\n    throw new Error(`Please enter numeric RGB values! r: ${r} g: ${g} b: ${b}`);\r\n  }\r\n  /*\r\n  if (r<0 || g<0 || b<0 || r>1.0 || g>1.0 || b>1.0) {\r\n   throw new Error('RGB values must be in the range 0 to 1.0');\r\n   return;\r\n  }//*/\r\n\r\n  let minRGB = Math.min(r, Math.min(g, b));\r\n  let maxRGB = Math.max(r, Math.max(g, b));\r\n\r\n  // Black-gray-white\r\n  if (minRGB === maxRGB) {\r\n    computedV = minRGB;\r\n\r\n    let ret = rgb_to_hsv_rets.next();\r\n    ret[0] = 0, ret[1] = 0, ret[2] = computedV;\r\n    return ret;\r\n  }\r\n\r\n  // Colors other than black-gray-white:\r\n  let d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\r\n  let h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\r\n\r\n  computedH = (60*(h - d/(maxRGB - minRGB)))/360.0;\r\n  computedS = (maxRGB - minRGB)/maxRGB;\r\n  computedV = maxRGB;\r\n\r\n  let ret = rgb_to_hsv_rets.next();\r\n  ret[0] = computedH, ret[1] = computedS, ret[2] = computedV;\r\n  return ret;\r\n}\r\n\r\nlet hsv_to_rgb_rets = new util.cachering(() => [0, 0, 0], 64);\r\n\r\nexport function hsv_to_rgb(h, s, v) {\r\n  let c = 0, m = 0, x = 0;\r\n  let ret = hsv_to_rgb_rets.next();\r\n\r\n  ret[0] = ret[1] = ret[2] = 0.0;\r\n  h *= 360.0;\r\n\r\n  c = v*s;\r\n  x = c*(1.0 - Math.abs(((h/60.0)%2) - 1.0));\r\n  m = v - c;\r\n  let color;\r\n\r\n  function RgbF_Create(r, g, b) {\r\n    ret[0] = r;\r\n    ret[1] = g;\r\n    ret[2] = b;\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (h >= 0.0 && h < 60.0) {\r\n    color = RgbF_Create(c + m, x + m, m);\r\n  } else if (h >= 60.0 && h < 120.0) {\r\n    color = RgbF_Create(x + m, c + m, m);\r\n  } else if (h >= 120.0 && h < 180.0) {\r\n    color = RgbF_Create(m, c + m, x + m);\r\n  } else if (h >= 180.0 && h < 240.0) {\r\n    color = RgbF_Create(m, x + m, c + m);\r\n  } else if (h >= 240.0 && h < 300.0) {\r\n    color = RgbF_Create(x + m, m, c + m);\r\n  } else if (h >= 300.0) {\r\n    color = RgbF_Create(c + m, m, x + m);\r\n  } else {\r\n    color = RgbF_Create(m, m, m);\r\n  }\r\n\r\n  return color;\r\n}\r\n\r\nlet rgb_to_cmyk_rets = util.cachering.fromConstructor(Vector4, 512);\r\nlet cmyk_to_rgb_rets = util.cachering.fromConstructor(Vector3, 512);\r\n\r\nexport function cmyk_to_rgb(c, m, y, k) {\r\n  let ret = cmyk_to_rgb_rets.next();\r\n\r\n  if (k === 1.0) {\r\n    ret.zero();\r\n    return ret;\r\n  }\r\n\r\n  c = c - c*k + k;\r\n  m = m - m*k + k;\r\n  y = y - y*k + k;\r\n\r\n  ret[0] = 1.0 - c;\r\n  ret[1] = 1.0 - m;\r\n  ret[2] = 1.0 - y;\r\n\r\n  return ret;\r\n}\r\n\r\nexport function rgb_to_cmyk(r, g, b) {\r\n  //CMYK and CMY values from 0 to 1\r\n  let ret = rgb_to_cmyk_rets.next();\r\n\r\n  let C = 1.0 - r;\r\n  let M = 1.0 - g;\r\n  let Y = 1.0 - b;\r\n\r\n  let var_K = 1\r\n\r\n  if (C < var_K) var_K = C\r\n  if (M < var_K) var_K = M\r\n  if (Y < var_K) var_K = Y\r\n  if (var_K === 1) { //Black\r\n    C = 0\r\n    M = 0\r\n    Y = 0\r\n  } else {\r\n    C = (C - var_K)/(1 - var_K)\r\n    M = (M - var_K)/(1 - var_K)\r\n    Y = (Y - var_K)/(1 - var_K)\r\n  }\r\n\r\n  let K = var_K\r\n\r\n  ret[0] = C;\r\n  ret[1] = M;\r\n  ret[2] = Y;\r\n  ret[3] = K;\r\n\r\n  return ret;\r\n}\r\n\r\n", "import {CSSFont} from './ui_theme.js';\r\n\r\nexport const DefaultTheme = {\r\n  base: {\r\n    AreaHeaderBG        : 'rgba(200, 200, 200, 0.95)',\r\n    BasePackFlag        : 0,\r\n    BoxDepressed        : 'rgba(130,130,130, 1)',\r\n    BoxHighlight        : 'rgba(151,208,239, 1)',\r\n    \"flex-grow\"         : \"unset\",\r\n    mobileSizeMultiplier: 1.0,\r\n    DefaultText         : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    LabelText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    TitleText           : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color'  : 'rgba(207,207,207, 0.5)',\r\n    'border-color'      : 'rgba(34,34,34, 1)',\r\n    'border-radius'     : 12.010619764585666,\r\n    'focus-border-width': 2,\r\n    oneAxisPadding      : 2,\r\n    padding             : 1,\r\n  },\r\n\r\n  button: {\r\n    DefaultText        : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35,35,35, 1)'\r\n    }),\r\n    'background-color' : 'rgba(238,238,238, 0.8672412740773168)',\r\n    'border-color'     : 'rgba(255,255,255, 1)',\r\n    'border-radius'    : 4,\r\n    'border-style'     : 'solid',\r\n    'border-width'     : 2,\r\n    disabled           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(109,109,109)'\r\n      }),\r\n      'background-color': 'rgb(19,19,19)',\r\n      'border-color'    : '#f58f8f',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    height             : 25,\r\n    highlight          : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(255,255,255, 1)'\r\n      }),\r\n      'background-color': 'rgba(138,222,255, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-radius'   : 4,\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 2,\r\n    },\r\n    'highlight-pressed': {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    margin             : 4,\r\n    'margin-left'      : 4,\r\n    'margin-right'     : 4,\r\n    padding            : 1,\r\n    pressed            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(35,35,35, 1)'\r\n      }),\r\n      'background-color': 'rgba(113,113,113, 1)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width              : 25,\r\n  },\r\n\r\n  checkbox: {\r\n    CheckSide         : 'left',\r\n    height            : 32,\r\n    width             : 32,\r\n    \"background-color\": \"rgb(168,168,168)\",\r\n  },\r\n\r\n  colorfield: {\r\n    circleSize    : 11,\r\n    colorBoxHeight: 24,\r\n    fieldSize     : 400,\r\n    height        : 256,\r\n    hueHeight     : 32,\r\n    width         : 256,\r\n  },\r\n\r\n  colorpickerbutton: {\r\n    height: 32,\r\n    width : 95,\r\n  },\r\n\r\n  curvewidget: {\r\n    CanvasBG    : 'rgb(44,44,44)',\r\n    CanvasHeight: 256,\r\n    CanvasWidth : 256,\r\n  },\r\n\r\n  dropbox: {\r\n    dropTextBG: 'rgba(233,233,233, 1)',\r\n    height    : 25,\r\n    width     : 32,\r\n  },\r\n\r\n  iconbutton: {\r\n    highlight: {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed: {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'black',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 1,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  iconcheck: {\r\n    highlight         : {\r\n      'background-color': 'rgba(133,182,255,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    depressed         : {\r\n      'background-color': 'rgba(42,61,77,0.8)',\r\n      'border-color'    : 'black',\r\n      'border-radius'   : 5,\r\n      'border-width'    : 1,\r\n      height            : 32,\r\n      'margin-bottom'   : 1,\r\n      'margin-left'     : 2,\r\n      'margin-right'    : 2,\r\n      'margin-top'      : 1,\r\n      padding           : 2,\r\n      width             : 32,\r\n    },\r\n    'background-color': 'rgba(15,15,15, 0)',\r\n    'border-color'    : 'rgba(237,209,209, 1)',\r\n    'border-radius'   : 5,\r\n    'border-width'    : 0,\r\n    drawCheck         : true,\r\n    height            : 32,\r\n    'margin-bottom'   : 1,\r\n    'margin-left'     : 2,\r\n    'margin-right'    : 2,\r\n    'margin-top'      : 1,\r\n    padding           : 2,\r\n    width             : 32,\r\n  },\r\n\r\n  label: {\r\n    LabelText: new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n  },\r\n\r\n  listbox: {\r\n    ListActive   : 'rgba(200, 205, 215, 1.0)',\r\n    ListHighlight: 'rgba(155, 220, 255, 0.5)',\r\n    height       : 200,\r\n    width        : 110,\r\n  },\r\n\r\n  menu: {\r\n    MenuBG          : 'rgba(250, 250, 250, 1.0)',\r\n    \"item-radius\"   : 0,\r\n    MenuBorder      : '1px solid grey',\r\n    MenuHighlight   : 'rgba(155, 220, 255, 1.0)',\r\n    MenuSeparator   : {\r\n      width             : \"100%\",\r\n      height            : 2,\r\n      padding           : 0,\r\n      margin            : 0,\r\n      border            : \"none\",\r\n      \"background-color\": \"grey\"\r\n    },\r\n    'box-shadow'    : '5px 5px 25px rgba(0,0,0,0.75)',\r\n    MenuSpacing     : 5,\r\n    MenuText        : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(25, 25, 25, 1.0)'\r\n    }),\r\n    \"padding-top\"   : 0,\r\n    \"padding-left\"  : 0,\r\n    \"padding-right\" : 0,\r\n    \"padding-bottom\": 0,\r\n    'border-color'  : 'grey',\r\n    'border-radius' : 5,\r\n    'border-style'  : 'solid',\r\n    'border-width'  : 1,\r\n  },\r\n\r\n  notification: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'poppins',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgb(55,55,55)'\r\n    }),\r\n    \"background-color\": \"rgba(72,72,72,0)\",\r\n    \"border-radius\"   : 5,\r\n    \"border-color\"    : \"grey\",\r\n    \"border-width\"    : 1,\r\n    \"border-style\"    : \"solid\",\r\n    ProgressBarBG     : \"rgb(74,148,183)\",\r\n    ProgressBar       : \"rgb(250,132,58)\",\r\n  },\r\n\r\n  numslider: {\r\n    'arrow-color'     : '50%',\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    'border-color'    : 'rgba(255,255,255, 1)',\r\n    'border-radius'   : 1,\r\n    height            : 22,\r\n    highlight         : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(0,0,0)'\r\n      }),\r\n      'background-color': 'rgba(151,208,239, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    pressed           : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgba(0,0,0, 1)'\r\n      }),\r\n      'arrow-color'     : 'rgb(28,28,28)',\r\n      'background-color': 'rgba(178,178,178, 1)',\r\n      'border-color'    : 'rgba(255,255,255, 1)',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },\r\n    width             : 115,\r\n    /*\r\n    'highlight-pressed'            : {\r\n      DefaultText       : new CSSFont({\r\n        font   : 'poppins',\r\n        weight : 'bold',\r\n        variant: 'normal',\r\n        style  : 'normal',\r\n        size   : 12,\r\n        color  : 'rgb(245,245,245)'\r\n      }),\r\n      'background-color': 'rgb(126,126,126)',\r\n      'border-color'    : '#DADCE0',\r\n      'border-style'    : 'solid',\r\n      'border-width'    : 1,\r\n    },*/\r\n  },\r\n\r\n  numslider_simple: {\r\n    SlideHeight       : 10,\r\n    TextBoxWidth      : 45,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 18,\r\n    labelOnTop        : true,\r\n    addLabel          : true,\r\n    width             : 135,\r\n  },\r\n\r\n  numslider_textbox: {\r\n    TextBoxHeight     : 25,\r\n    TextBoxWidth      : 50,\r\n    'background-color': 'rgba(219,219,219, 1)',\r\n    height            : 25,\r\n    labelOnTop        : true,\r\n    addLabel          : false,\r\n    width             : 120,\r\n  },\r\n\r\n  panel: {\r\n    HeaderBorderRadius    : 5.329650280441558,\r\n    HeaderRadius          : 4,\r\n    TitleBackground       : 'rgba(177,219,255, 1)',\r\n    TitleBorder           : 'rgba(104,104,104, 1)',\r\n    TitleText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'    : 'rgba(184,184,184, 0.7594818376068376)',\r\n    'border-color'        : 'rgba(0,0,0, 0.5598061397157866)',\r\n    'border-radius'       : 4,\r\n    'border-style'        : 'groove',\r\n    'border-width'        : 1.141,\r\n    'margin-bottom'       : 0,\r\n    'margin-bottom-closed': 0,\r\n    'margin-left'         : 5.6584810220495445,\r\n    'margin-right'        : 0,\r\n    'margin-top'          : 0,\r\n    'margin-top-closed'   : 0,\r\n    'padding-bottom'      : 0,\r\n    'padding-left'        : 0,\r\n    'padding-right'       : 0,\r\n    'padding-top'         : 0,\r\n  },\r\n\r\n  richtext: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 16,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgb(245, 245, 245)',\r\n  },\r\n\r\n  screenborder: {\r\n    'border-inner'   : 'grey',\r\n    'border-outer'   : 'rgba(228,228,228, 1)',\r\n    'border-width'   : 2,\r\n    'mouse-threshold': 8,\r\n  },\r\n\r\n  scrollbars: {\r\n    border  : undefined,\r\n    color   : undefined,\r\n    color2  : undefined,\r\n    contrast: undefined,\r\n    width   : undefined,\r\n  },\r\n\r\n  sidebar: {\r\n    'background-color': 'rgba(55, 55, 55, 0.5)',\r\n  },\r\n\r\n  strip: {\r\n    'background-color': 'rgba(75,75,75, 0.33213141025641024)',\r\n    'border-color'    : 'rgba(0,0,0, 0.31325409987877156)',\r\n    'border-radius'   : 8.76503417507447,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    margin            : 2,\r\n    oneAxisPadding    : 2,\r\n    padding           : 1,\r\n    \"flex-grow\"       : \"unset\",\r\n  },\r\n\r\n  tabs: {\r\n    \"focus-on-tab-click\": \"false\",\r\n    \"movable-tabs\"      : \"true\",\r\n    TabPadding_mobile   : 20, //padding perpindicular to the label text\r\n    TabPadding          : 0,\r\n    TabActive           : 'rgba(212,212,212, 1)',\r\n    TabBarRadius        : 6,\r\n    TabHighlight        : 'rgba(50, 50, 50, 0.2)',\r\n    TabInactive         : 'rgba(183,183,183, 1)',\r\n    TabStrokeStyle1     : 'rgba(0,0,0, 1)',\r\n    TabStrokeStyle2     : 'rgba(0,0,0, 1)',\r\n    TabText             : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'bold',\r\n      style  : 'normal',\r\n      size   : 15,\r\n      color  : 'rgba(0,0,0, 1)'\r\n    }),\r\n    'background-color'  : 'rgba(222,222,222, 1)',\r\n  },\r\n\r\n  textbox: {\r\n    DefaultText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'normal',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 14,\r\n      color  : 'rgba(3,3,3, 1)'\r\n    }),\r\n    'border-color'    : \"rgba(0,0,0,0)\",\r\n    'border-width'    : 1,\r\n    \"border-radius\"   : 4,\r\n    \"border-style\"    : \"solid\",\r\n    'background-color': 'rgba(245,245,245, 1)',\r\n  },\r\n\r\n  tooltip: {\r\n    ToolTipText       : new CSSFont({\r\n      font   : 'sans-serif',\r\n      weight : 'bold',\r\n      variant: 'normal',\r\n      style  : 'normal',\r\n      size   : 12,\r\n      color  : 'rgba(35, 35, 35, 1.0)'\r\n    }),\r\n    'background-color': 'rgba(255,255,255, 1)',\r\n    'border-color'    : 'rgba(139,139,139, 1)',\r\n    'border-radius'   : 3,\r\n    'border-style'    : 'solid',\r\n    'border-width'    : 1,\r\n    padding           : 5,\r\n  },\r\n\r\n  treeview: {\r\n    itemIndent: 10,\r\n    rowHeight : 18,\r\n  },\r\n\r\n  vecPopupButton: {\r\n    height : 18,\r\n    padding: 3,\r\n    width  : 100,\r\n  },\r\n\r\n};\r\n", "\"use strict\";\r\n\r\n/*\r\nIcons are defined in spritesheets that live in\r\nthe iconsheet16/32 dom nodes.  Icons are numbered start from\r\nthe upper left sprite tile.\r\n\r\nThis function sets the mapping between icon numbers and names.\r\n\r\nThe following icons should be in the icon sheet and in this map:\r\n\r\nRESIZE      :\r\nSMALL_PLUS  :\r\nTRANSLATE   : for moving things\r\nUI_EXPAND   : panel open icon\r\nUI_COLLAPSE : panel close icon\r\nNOTE_EXCL   : exclamation mark for notifications\r\nHELP        : help symbol\r\n*/\r\nexport function setIconMap(icons) {\r\n  for (let k in icons) {\r\n    Icons[k] = icons[k];\r\n  }\r\n}\r\n\r\nlet a = 0;\r\nexport let Icons = {\r\n  FOLDER: a++,\r\n  FILE  : a++,\r\n  TINY_X: a++,\r\n\r\n  SMALL_PLUS : a++,\r\n  SMALL_MINUS: a++,\r\n  UNDO       : a++,\r\n\r\n  REDO: a++,\r\n  HELP: a++,\r\n\r\n  UNCHECKED   : a++,\r\n  CHECKED     : a++,\r\n  LARGE_CHECK : a++,\r\n  CURSOR_ARROW: a++,\r\n  NOTE_EXCL   : a++,\r\n  SCROLL_DOWN : a++,\r\n  SCROLL_UP   : a++,\r\n  BACKSPACE   : a++,\r\n  LEFT_ARROW  : a++,\r\n  RIGHT_ARROW : a++,\r\n  UI_EXPAND   : a++, //triangle\r\n  UI_COLLAPSE : a++, //triangle\r\n\r\n\r\n  BOLD         : a++,\r\n  ITALIC       : a++,\r\n  UNDERLINE    : a++,\r\n  STRIKETHRU   : a++,\r\n  TREE_EXPAND  : a++,\r\n  TREE_COLLAPSE: a++,\r\n  ZOOM_OUT     : a++,\r\n  ZOOM_IN      : a++,\r\n  LARGE_X      : a++, /* Used for curve widget delete button. */\r\n};\r\n/* used for icon checkboxes with overlayed check marks */\r\nIcons.ENUM_CHECKED = Icons.CHECKED;\r\nIcons.ENUM_UNCHECKED = Icons.UNCHECKED;\r\n\r\n\r\n", "let exclude = new Set([\r\n  \"toString\", \"constructor\", \"prototype\", \"__proto__\", \"toLocaleString\",\r\n  \"hasOwnProperty\", \"shadow\"\r\n]);\r\n\r\nlet UIBase = undefined;\r\n\r\n//deal with circular module refrence\r\nexport function _setUIBase(uibase) {\r\n  UIBase = uibase;\r\n}\r\n\r\nlet AspectKeys = Symbol(\"aspect-keys\");\r\n\r\nexport function initAspectClass(object, blacklist = new Set()) {\r\n  let cls = object.constructor;\r\n\r\n  if (!cls[AspectKeys]) {\r\n    cls[AspectKeys] = [];\r\n    let keys = [];\r\n\r\n    let p = object.__proto__;\r\n    while (p) {\r\n      keys = keys.concat(Reflect.ownKeys(p));\r\n      p = p.__proto__;\r\n    }\r\n    keys = new Set(keys);\r\n\r\n    function validProperty(obj, key) {\r\n      let descr = Object.getOwnPropertyDescriptor(obj, key);\r\n\r\n      if (descr && (descr.get || descr.set)) {\r\n        return false;\r\n      }\r\n\r\n      let p = obj.constructor;\r\n      do {\r\n        if (p.prototype) {\r\n          let descr = Object.getOwnPropertyDescriptor(p.prototype, key);\r\n\r\n          if (descr && (descr.set || descr.get)) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        p = p.__proto__;\r\n      } while (p && p !== p.__proto__);\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k of keys) {\r\n      let v;\r\n\r\n      if (typeof k === \"string\" && k.startsWith(\"_\")) {\r\n        continue;\r\n      }\r\n\r\n      if (k === \"constructor\") {\r\n        continue;\r\n      }\r\n\r\n      if (blacklist.has(k) || exclude.has(k)) {\r\n        continue;\r\n      }\r\n\r\n      if (!validProperty(object, k)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        v = object[k];\r\n      } catch (error) {\r\n        continue;\r\n      }\r\n\r\n      if (typeof v !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      cls[AspectKeys].push(k);\r\n    }\r\n  }\r\n\r\n  object.__aspect_methods = new Set();\r\n\r\n  for (let k of cls[AspectKeys]) {\r\n    AfterAspect.bind(object, k);\r\n  }\r\n}\r\n\r\nexport function clearAspectCallbacks(obj) {\r\n  for (let key of obj.__aspect_methods) {\r\n    obj[key].clear();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * example:\r\n *\r\n * someobject.update.after(() => {\r\n *   do_something();\r\n *   return someobject.update.value;\r\n * }\r\n *\r\n * */\r\nexport class AfterAspect {\r\n  constructor(owner, key) {\r\n    this.owner = owner;\r\n    this.key = key;\r\n\r\n    this.chain = [[owner[key], false]];\r\n    this.chain2 = [[owner[key], false]];\r\n\r\n    this.root = [[owner[key], false]];\r\n\r\n    let this2 = this;\r\n\r\n    let method = this._method = function () {\r\n      let chain = this2.chain;\r\n      let chain2 = this2.chain2;\r\n\r\n      chain2.length = chain.length;\r\n\r\n      for (let i = 0; i < chain.length; i++) {\r\n        chain2[i] = chain[i];\r\n      }\r\n\r\n      for (let i = 0; i < chain2.length; i++) {\r\n        let [cb, node, once] = chain2[i];\r\n\r\n        if (node) {\r\n          let isDead = !node.isConnected;\r\n\r\n          if (node instanceof UIBase) {\r\n            isDead = isDead || node.isDead();\r\n          }\r\n\r\n          if (isDead) {\r\n            console.warn(\"pruning dead AfterAspect callback\", node);\r\n            chain.remove(chain2[i]);\r\n            continue;\r\n          }\r\n        }\r\n\r\n\r\n        if (once && chain.indexOf(chain2[i]) >= 0) {\r\n          chain.remove(chain2[i]);\r\n        }\r\n\r\n        if (cb && cb.apply) {\r\n          method.value = cb.apply(this, arguments);\r\n          //method.value = Reflect.apply(cb, this, arguments);\r\n          //cb.apply(this, args);\r\n        }\r\n      }\r\n\r\n      let ret = method.value;\r\n      method.value = undefined;\r\n\r\n      return ret;\r\n    };\r\n\r\n    this._method_bound = false;\r\n\r\n    method.after = this.after.bind(this);\r\n    method.once = this.once.bind(this);\r\n    method.remove = this.remove.bind(this);\r\n\r\n    owner[key].after = this.after.bind(this);\r\n    owner[key].once = this.once.bind(this);\r\n    owner[key].remove = this.remove.bind(this);\r\n  }\r\n\r\n  static bind(owner, key) {\r\n    owner.__aspect_methods.add(key);\r\n\r\n    return new AfterAspect(owner, key);\r\n  }\r\n\r\n  remove(cb) {\r\n    for (let item of this.chain) {\r\n      if (item[0] === cb) {\r\n        this.chain.remove(item);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  once(cb, node) {\r\n    return this.after(cb, node, true);\r\n  }\r\n\r\n  _checkbind() {\r\n    if (!this._method_bound) {\r\n      this.owner[this.key] = this._method;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this._checkbind();\r\n    this.chain = [[this.root[0][0], this.root[0][1]]];\r\n    this.chain2 = [[this.root[0][0], this.root[0][1]]];\r\n\r\n    return this;\r\n  }\r\n\r\n  before(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain = [[cb, node, once]].concat(this.chain);\r\n    return this.owner;\r\n  }\r\n\r\n  after(cb, node, once) {\r\n    this._checkbind();\r\n\r\n    if (cb === undefined) {\r\n      console.warn(\"invalid call to .after(); cb was undefined\");\r\n      return this.owner;\r\n    }\r\n    this.chain.push([cb, node, once]);\r\n    return this.owner;\r\n  }\r\n}\r\n", "import * as util from '../util/util.js'\r\n\r\nexport const SocketFlags = {\r\n  UPDATE: 1\r\n};\r\nexport const NodeFlags = {\r\n  UPDATE   : 1,\r\n  SORT_TAG1: 2,\r\n  SORT_TAG2: 4,\r\n};\r\nexport const RecalcFlags = {\r\n  RUN   : 1,\r\n  RESORT: 2\r\n};\r\nexport const SocketTypes = {\r\n  INPUT : \"inputs\",\r\n  OUTPUT: \"outputs\"\r\n};\r\n\r\nlet graphIdGen = 1;\r\n\r\nexport class EventSocket {\r\n  static socketDef = {\r\n    typeName: \"\",\r\n    uiName  : \"\",\r\n    flag    : 0,\r\n  }\r\n\r\n  name = \"\"\r\n  id = graphIdGen++;\r\n  flag = 0;\r\n\r\n  edges = [];\r\n  node = undefined;\r\n\r\n  type = undefined;\r\n\r\n  constructor(node) {\r\n    this.node = node;\r\n  }\r\n\r\n  get value() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  set value(v) {\r\n    this.flagUpdate();\r\n  }\r\n\r\n  get isUpdated() {\r\n    return this.flag & SocketFlags.UPDATE;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    this.name = b.name;\r\n    this.flag = b.flag;\r\n\r\n    return this;\r\n  }\r\n\r\n  copy() {\r\n    return (new this.constructor()).copyFrom(this);\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.flag |= SocketFlags.UPDATE;\r\n\r\n    if (!this.node) {\r\n      return;\r\n    }\r\n\r\n    if (this.type === SocketTypes.INPUT) {\r\n      this.node.flagUpdate();\r\n    } else {\r\n      for (let sockb of this.edges) {\r\n        sockb.flag |= SocketFlags.UPDATE;\r\n        sockb.node.flagUpdate();\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  flagResort() {\r\n    if (this.node) {\r\n      this.node.flagResort();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  connect(sockb) {\r\n    this.edges.push(sockb);\r\n    sockb.edges.push(this);\r\n    return this;\r\n  }\r\n\r\n  hasNode(node) {\r\n    for (let sockb of this.edges) {\r\n      if (sockb.node === node || sockb.node.owner === node) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  has(sockb) {\r\n    return this.edges.indexOf(sockb) >= 0;\r\n  }\r\n\r\n  disconnect(sockb = undefined) {\r\n    this.flagResort();\r\n\r\n    if (sockb === undefined) {\r\n      /* Disconnect all. */\r\n      for (let sock of this.edges) {\r\n        sock.flagUpdate();\r\n        sock.edges.remove(this);\r\n      }\r\n\r\n      this.edges.length = 0;\r\n      return this;\r\n    }\r\n\r\n    sockb.flagUpdate();\r\n    this.edges.remove(sockb);\r\n    return this;\r\n  }\r\n}\r\n\r\nconst NodeClasses = [];\r\n\r\n//Interface\r\nexport class NodeCapable {\r\n  graphNode = undefined;\r\n\r\n  static graphNodeDef = {\r\n    typeName: \"\",\r\n    uiName  : \"\",\r\n    flag    : 0,\r\n\r\n    /* Sockets inherit. */\r\n    inputs : {},\r\n    outputs: {}\r\n  };\r\n\r\n  graphExec() {\r\n  }\r\n}\r\n\r\nexport class EventNode {\r\n  owner = undefined;\r\n  inputs = {};\r\n  outputs = {};\r\n  allsockets = [];\r\n  graph = undefined;\r\n  sortIndex = -1;\r\n  id = graphIdGen++;\r\n  flag = 0;\r\n\r\n  static register(cls, def) {\r\n    cls.graphNodeDef = def;\r\n    if (!def.typeName) {\r\n      throw new Error(\"Missing graphNodeDef.typeName\")\r\n    }\r\n\r\n    NodeClasses.push(cls);\r\n\r\n    return def;\r\n  }\r\n\r\n  addSocket(type, key, sock) {\r\n    this[type][key] = sock;\r\n    sock.name = key;\r\n    sock.node = this;\r\n    sock.type = type;\r\n\r\n    return this;\r\n  }\r\n\r\n  static isNodeCapable(cls) {\r\n    return cls.graphNodeDef !== undefined;\r\n  }\r\n\r\n  constructor(owner) {\r\n    this.owner = owner;\r\n\r\n    let cls = owner.constructor;\r\n\r\n    let getSockets = (key) => {\r\n      let socks = {};\r\n\r\n      let p = cls;\r\n      while (p) {\r\n        if (p.graphNodeDef) {\r\n          let socksDef = p.graphNodeDef[key] || {};\r\n\r\n          for (let k in socksDef) {\r\n            if (!(k in socks)) {\r\n              socks[k] = socksDef[k].copy();\r\n              socks[k].name = k;\r\n              socks[k].node = this;\r\n              socks[k].type = key;\r\n\r\n              this.allsockets.push(socks[k]);\r\n            }\r\n          }\r\n        }\r\n        p = p.__proto__;\r\n      }\r\n\r\n      return socks;\r\n    }\r\n\r\n    this.inputs = getSockets(\"inputs\");\r\n    this.outputs = getSockets(\"outputs\");\r\n  }\r\n\r\n  static init(owner) {\r\n    owner.graphNode = new EventNode(owner);\r\n    return owner.graphNode;\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.flag |= NodeFlags.UPDATE;\r\n\r\n    if (this.graph) {\r\n      this.graph.flagUpdate(this);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  flagResort() {\r\n    if (this.graph) {\r\n      this.graph.flagResort(this);\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class EventGraph {\r\n  nodes = [];\r\n  flag = 0;\r\n  nodeIdMap = new Map()\r\n  sockIdMap = new Map()\r\n  sortlist = [];\r\n  queueReq = undefined;\r\n  #skipQueueExec = 0;\r\n\r\n  constructor() {\r\n  }\r\n\r\n  add(node) {\r\n    node = this.eventNode(node);\r\n\r\n    node.graph = this;\r\n    this.nodeIdMap.set(node.id, node);\r\n\r\n    this.nodes.push(node);\r\n    this.flagResort(node);\r\n    this.flagUpdate(node);\r\n  }\r\n\r\n  has(node) {\r\n    node = this.eventNode(node);\r\n    return this.nodeIdMap.has(node.id);\r\n  }\r\n\r\n  eventNode(node) {\r\n    if (!(node instanceof EventNode)) {\r\n      node = node.graphNode;\r\n    }\r\n\r\n    if (node === undefined) {\r\n      console.warn(\"Not an event node:\", arguments[0]);\r\n      throw new Error(\"Not an event node\");\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  remove(node) {\r\n    node = this.eventNode(node);\r\n\r\n    if (node === undefined) {\r\n      throw new Error(\"EventGraph.prototype.remove(): node was undefined\");\r\n    }\r\n\r\n    if (!this.nodeIdMap.get(node.id)) {\r\n      throw new Error(\"Node is not in event graph\");\r\n    }\r\n\r\n    this.nodeIdMap.delete(node.id);\r\n\r\n    for (let sock of Array.from(node.eventNode.allsockets)) {\r\n      this.sockIdMap.delete(sock.id);\r\n\r\n      try {\r\n        sock.disconnect();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Failed to disconnect a socket\");\r\n      }\r\n    }\r\n\r\n    node.graph = undefined;\r\n    this.nodes.remove(node);\r\n    this.flagResort();\r\n  }\r\n\r\n  flagResort(node) {\r\n    if (node) {\r\n      node = this.eventNode(node);\r\n    }\r\n\r\n    this.flag |= RecalcFlags.RESORT | RecalcFlags.RUN;\r\n\r\n    return this;\r\n  }\r\n\r\n  flagUpdate(node) {\r\n    node = this.eventNode(node);\r\n\r\n    this.flag |= RecalcFlags.RUN;\r\n\r\n    if (!this.#skipQueueExec) {\r\n      this.queueExec();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  sort() {\r\n    console.warn(\"Sorting Graph\");\r\n\r\n    this.flag &= ~RecalcFlags.RESORT;\r\n\r\n    for (let n of this.nodes) {\r\n      n.flag &= ~(NodeFlags.SORT_TAG1 | NodeFlags.SORT_TAG2);\r\n    }\r\n\r\n    let sortlist = this.sortlist;\r\n    this.sortlist.length = 0;\r\n\r\n    let dosort = (n) => {\r\n      if (n.flag & NodeFlags.SORT_TAG2) {\r\n        console.error(\"Cycle in event dag!\", n);\r\n        return;\r\n      }\r\n\r\n      n.flag |= NodeFlags.SORT_TAG2;\r\n\r\n      for (let [k, socka] of Object.entries(n.inputs)) {\r\n        for (let sockb of socka.edges) {\r\n          let n2 = sockb.node;\r\n          if (!(n2.flag & NodeFlags.SORT_TAG1)) {\r\n            dosort(n2);\r\n          }\r\n        }\r\n      }\r\n\r\n      n.flag &= ~NodeFlags.SORT_TAG2;\r\n      n.flag |= NodeFlags.SORT_TAG1;\r\n      n.sortIndex = sortlist.length;\r\n      sortlist.push(n);\r\n\r\n      for (let [k, socka] of Object.entries(n.outputs)) {\r\n        for (let sockb of socka.edges) {\r\n          let n2 = sockb.node;\r\n\r\n          if (!(n2.flag & NodeFlags.SORT_TAG1)) {\r\n            dosort(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.nodes) {\r\n      if (!(n.flag & NodeFlags.SORT_TAG1)) {\r\n        dosort(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  queueExec() {\r\n    console.warn(\"queueExec\", this.queueReq);\r\n\r\n    this.flag |= RecalcFlags.RUN;\r\n\r\n    if (this.queueReq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.queueReq = true;\r\n    this.queueReq = window.setTimeout(() => {\r\n      this.queueReq = undefined;\r\n      this.exec();\r\n    }, 0);\r\n  }\r\n\r\n  exec() {\r\n    this.flag &= ~RecalcFlags.RUN;\r\n\r\n    if (this.flag & RecalcFlags.RESORT) {\r\n      this.sort();\r\n    }\r\n\r\n    console.warn(\"Executing Graph\");\r\n\r\n    this.#skipQueueExec++;\r\n\r\n    let sortlist = this.sortlist;\r\n    for (let n of sortlist) {\r\n      if (!(n.flag & NodeFlags.UPDATE)) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        n.owner.graphExec();\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.error(\"Error during event graph execution\");\r\n      }\r\n\r\n      n.flag &= ~NodeFlags.UPDATE;\r\n\r\n      for (let k in n.inputs) {\r\n        let sock = n.inputs[k];\r\n        sock.flag &= ~SocketFlags.UPDATE;\r\n      }\r\n\r\n      for (let k in n.outputs) {\r\n        let sock = n.outputs[k];\r\n\r\n        if (sock.flag & SocketFlags.UPDATE) {\r\n          for (let sockb of sock.edges) {\r\n            sockb.flag |= SocketFlags.UPDATE;\r\n            sockb.node.flag |= SocketFlags.UPDATE;\r\n          }\r\n\r\n          sock.flag &= ~SocketFlags.UPDATE;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.#skipQueueExec--;\r\n  }\r\n}\r\n\r\nexport const theEventGraph = new EventGraph();\r\n\r\nconst strBoolMap = {\r\n  \"true\" : \"false\",\r\n  \"false\": \"true\",\r\n  \"on\"   : \"off\",\r\n  \"off\"  : \"on\",\r\n  \"yes\"  : \"no\",\r\n  \"no\"   : \"yes\",\r\n}\r\n\r\nexport class DependSocket extends EventSocket {\r\n  static socketDef = {\r\n    typeName: \"depend\",\r\n    uiName  : \"depend\",\r\n    flag    : 0,\r\n  }\r\n\r\n  #value = undefined;\r\n\r\n  get value() {\r\n    return this.#value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.#value = v;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    super.copyFrom(b);\r\n\r\n    this.#value = b.#value;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport const PropSocketModes = {\r\n  REPLACE: 0,\r\n  MIN    : 1,\r\n  MAX    : 2,\r\n}\r\n\r\nexport class PropertySocket extends EventSocket {\r\n  static socketDef = {\r\n    typeName: \"property_socket\",\r\n    uiName  : \"Property Socket\",\r\n    flag    : 0,\r\n  }\r\n\r\n  mixMode = PropSocketModes.REPLACE;\r\n\r\n  #binding = {\r\n    obj: null,\r\n    key: \"\",\r\n  }\r\n\r\n  #callbacks = []; //(newval, oldval) => val\r\n  #invert = false; //Invert bool or number properties\r\n\r\n  oldValue = undefined;\r\n\r\n  mode(mixmode) {\r\n    this.mixMode = mixmode;\r\n    return this;\r\n  }\r\n\r\n  copyFrom(b) {\r\n    super.copyFrom(b);\r\n\r\n    this.#invert = b.#invert;\r\n    this.#callbacks = Array.from(b.#callbacks);\r\n    this.#binding = b.#binding;\r\n\r\n    return this;\r\n  }\r\n\r\n  invert(state = true) {\r\n    this.#invert = state;\r\n    return this;\r\n  }\r\n\r\n  callback(cb) {\r\n    this.#callbacks.push(cb);\r\n    return this;\r\n  }\r\n\r\n  get value() {\r\n    let bind = this.#binding;\r\n    return bind.obj ? bind.obj[bind.key] : undefined;\r\n  }\r\n\r\n  set value(v) {\r\n    let old = this.value;\r\n    if (this.#callbacks.length > 0) {\r\n      for (let cb of this.#callbacks) {\r\n        v = cb(v, old);\r\n      }\r\n    }\r\n\r\n    if (this.#invert && (typeof v === \"number\" || typeof v === \"boolean\" || typeof v === \"undefined\")) {\r\n      v = !v;\r\n    } else if (this.#invert && typeof v === \"string\") {\r\n      let s = v.toLowerCase().trim();\r\n      if (s in strBoolMap) {\r\n        v = strBoolMap[s];\r\n      }\r\n    }\r\n\r\n    let bind = this.#binding;\r\n    if (bind.obj) {\r\n      bind.obj[bind.key] = v;\r\n    } else {\r\n      console.warn(\"Attempt to set unbound property socket\", this);\r\n    }\r\n  }\r\n\r\n  bind(obj, key) {\r\n    this.#binding.obj = obj;\r\n    this.#binding.key = key;\r\n\r\n    return this;\r\n  }\r\n}\r\n", "import {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet _ui_base = undefined;\r\n\r\n//avoid circular module references\r\nlet TextBox = undefined;\r\n\r\nexport function _setTextboxClass(cls) {\r\n  TextBox = cls;\r\n}\r\n\r\n//import * as ui_save from './ui_save.js';\r\n\r\n/*\r\nif (window.document && document.body) {\r\n  console.log(\"ensuring body.style.margin/padding are zero\");\r\n  document.body.style[\"margin\"] = \"0px\";\r\n  document.body.style[\"padding\"] = \"0px\";\r\n}\r\n */\r\n\r\nimport {Animator} from \"./anim.js\";\r\nimport './units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  pushModalLight, popModalLight, copyEvent, pathDebugEvent,\r\n  haveModal, keymap, reverse_keymap, pushPointerModal\r\n} from '../path-controller/util/simple_events.js';\r\nimport {getDataPathToolOp} from '../path-controller/controller/controller.js';\r\nimport * as units from './units.js';\r\nimport {rgb_to_hsv, hsv_to_rgb} from \"../util/colorutils.js\";\r\n\r\nexport * from './ui_theme.js';\r\n\r\nimport {CSSFont, theme, parsepx, compatMap} from \"./ui_theme.js\";\r\n\r\nimport {DefaultTheme} from './theme.js';\r\n\r\n//global list of elements to, hopefully, prevent minification tree shaking\r\n//of live elements\r\nexport let ElementClasses = [];\r\n\r\nexport {theme} from \"./ui_theme.js\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nwindow.__cconst = cconst;\r\n\r\nlet Vector4 = vectormath.Vector4;\r\n\r\nexport {Icons} from '../icon_enum.js';\r\nimport {Icons} from '../icon_enum.js';\r\n\r\nexport {setIconMap} from '../icon_enum.js';\r\nimport {setIconMap} from '../icon_enum.js';\r\n\r\nimport {AfterAspect, initAspectClass} from \"./aspect.js\";\r\nimport * as aspect from './aspect.js';\r\n\r\nconst EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Area;\r\nexport let _setAreaClass = (cls) => {\r\n  Area = cls;\r\n}\r\n\r\nexport const ErrorColors = {\r\n  WARNING: \"yellow\",\r\n  ERROR  : \"red\",\r\n  OK     : \"green\"\r\n};\r\n\r\nwindow.__theme = theme;\r\n\r\nlet registered_has_happened = false;\r\nlet tagPrefix = \"\";\r\nconst EventCBSymbol = Symbol(\"wrapped event callback\");\r\n\r\nfunction calcElemCBKey(elem, type, options) {\r\n  return elem._id + \":\" + type + \":\" + JSON.stringify(options || {});\r\n}\r\n\r\n/**\r\n * Sets tag prefix for pathux html elements.\r\n * Must be called prior to loading other modules.\r\n * Since this is tricky, you can alternatively\r\n * add a script tag with the prefix with the id \"pathux-tag-prefix\",\r\n * e.g.<pre> <script type=\"text/plain\" id=\"pathux-tag-prefix\">prefix</script> </pre>\r\n * */\r\nexport function setTagPrefix(prefix) {\r\n  if (registered_has_happened) {\r\n    throw new Error(\"have to call ui_base.setTagPrefix before loading any other path.ux modules\");\r\n  }\r\n\r\n  tagPrefix = \"\" + prefix;\r\n}\r\n\r\nexport function getTagPrefix(prefix) {\r\n  return tagPrefix;\r\n}\r\n\r\nlet prefix = document.getElementById(\"pathux-tag-prefix\");\r\nif (prefix) {\r\n  console.log(\"Found pathux-tag-prefix element\");\r\n  prefix = prefix.innerText.trim();\r\n  setTagPrefix(prefix);\r\n}\r\n\r\nimport {ClassIdSymbol} from './ui_consts.js';\r\n\r\nexport {ClassIdSymbol};\r\n\r\nlet class_idgen = 1;\r\n\r\nexport function setTheme(theme2) {\r\n  //merge theme\r\n  for (let k in theme2) {\r\n    let v = theme2[k];\r\n\r\n    if (typeof v !== \"object\") {\r\n      theme[k] = v;\r\n      continue;\r\n    }\r\n\r\n    let v0 = theme[k];\r\n\r\n    if (!(k in theme)) {\r\n      theme[k] = {};\r\n    }\r\n\r\n    for (let k2 in v) {\r\n      //if (v0 && !(k2 in v0)) {\r\n      //  continue;\r\n      //}\r\n\r\n      if (k2 in compatMap) {\r\n        let k3 = compatMap[k2];\r\n\r\n        if (v[k3] === undefined) {\r\n          v[k3] = v[k2];\r\n        }\r\n\r\n        delete v[k2];\r\n        k2 = k3;\r\n      }\r\n\r\n      theme[k][k2] = v[k2];\r\n    }\r\n  }\r\n}\r\n\r\nsetTheme(DefaultTheme);\r\n\r\nlet _last_report = util.time_ms();\r\n\r\nexport function report() {\r\n  if (util.time_ms() - _last_report > 350) {\r\n    console.warn(...arguments);\r\n    _last_report = util.time_ms();\r\n  }\r\n}\r\n\r\n//this function is deprecated\r\nexport function getDefault(key, elem) {\r\n  console.warn(\"Deprecated call to ui_base.js:getDefault\");\r\n\r\n  if (key in theme.base) {\r\n    return theme.base[key];\r\n  } else {\r\n    throw new Error(\"Unknown default \" + key);\r\n  }\r\n}\r\n\r\n//XXX implement me!\r\nexport function IsMobile() {\r\n  console.warn(\"ui_base.IsMobile is deprecated; use util.isMobile instead\")\r\n  return util.isMobile();\r\n};\r\n\r\nlet keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\nkeys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\nkeys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\nkeys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\nexport const marginPaddingCSSKeys = keys;\r\n\r\n\r\nclass _IconManager {\r\n  constructor(image, tilesize, number_of_horizontal_tiles, drawsize) {\r\n    this.tilex = number_of_horizontal_tiles;\r\n    this.tilesize = tilesize;\r\n    this.drawsize = drawsize;\r\n\r\n    this.customIcons = new Map();\r\n\r\n    this.image = image;\r\n    this.promise = undefined;\r\n    this._accept = undefined;\r\n    this._reject = undefined;\r\n  }\r\n\r\n  get ready() {\r\n    return this.image && this.image.width;\r\n  }\r\n\r\n  onReady() {\r\n    if (this.ready) {\r\n      return new Promise((accept, reject) => {\r\n        accept(this);\r\n      });\r\n    }\r\n\r\n    if (this.promise) {\r\n      return this.promise;\r\n    }\r\n\r\n    let onload = this.image.onload;\r\n    this.image.onload = (e) => {\r\n      if (onload) {\r\n        onload.call(this.image, e);\r\n      }\r\n\r\n      if (!this._accept) {\r\n        return;\r\n      }\r\n\r\n      let accept = this._accept;\r\n      this._accept = this._reject = this.promise = undefined;\r\n\r\n      if (this.image.width) {\r\n        accept(this);\r\n      }\r\n    }\r\n\r\n    this.promise = new util.TimeoutPromise((accept, reject) => {\r\n      this._accept = accept;\r\n      this._reject = reject;\r\n    }, 15000, true); /* silently rejects on timeout */\r\n\r\n    this.promise.catch(error => {\r\n      util.print_stack(error);\r\n      this.promise = this._accept = this._reject = undefined;\r\n    });\r\n\r\n    return this.promise;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0) {\r\n    let customIcon = this.customIcons.get(icon);\r\n\r\n    if (customIcon) {\r\n      g.drawImage(customIcon.canvas, x, y);\r\n      return;\r\n    }\r\n\r\n    let tx = icon%this.tilex;\r\n    let ty = ~~(icon/this.tilex);\r\n\r\n    let dpi = elem.getDPI();\r\n    let ts = this.tilesize;\r\n    let ds = this.drawsize;\r\n\r\n    if (!this.image) {\r\n      //console.warn(\"Failed to render an iconsheet\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      g.drawImage(this.image, tx*ts, ty*ts, ts, ts, x, y, ds*dpi, ds*dpi);\r\n    } catch (error) {\r\n      console.log(this.image);\r\n      console.error(error.stack);\r\n      console.error(error.message);\r\n      console.error(\"failed to draw an icon\");\r\n    }\r\n  }\r\n\r\n  setCSS(icon, dom, fitsize = undefined) {\r\n    if (!fitsize) {\r\n      fitsize = this.drawsize;\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    dom.style[\"background\"] = this.getCSS(icon, fitsize);\r\n    if (this.customIcons.has(icon)) {\r\n      dom.style[\"background-size\"] = (fitsize) + \"px\";\r\n    } else {\r\n      dom.style[\"background-size\"] = (fitsize*this.tilex) + \"px\";\r\n    }\r\n\r\n    dom.style[\"background-clip\"] = \"content-box\";\r\n\r\n    if (!dom.style[\"width\"]) {\r\n      dom.style[\"width\"] = this.drawsize + \"px\";\r\n    }\r\n    if (!dom.style[\"height\"]) {\r\n      dom.style[\"height\"] = this.drawsize + \"px\";\r\n    }\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, fitsize = this.drawsize) {\r\n    if (icon === -1) { //-1 means no icon\r\n      return '';\r\n    }\r\n\r\n    if (typeof fitsize === \"object\") {\r\n      fitsize = Math.max(fitsize[0], fitsize[1]);\r\n    }\r\n\r\n    let ratio = fitsize/this.tilesize;\r\n\r\n    let customIcon = this.customIcons.get(icon);\r\n    if (customIcon !== undefined) {\r\n      //ratio = fitsize / this.drawsize;\r\n      //let d = this.drawsize*0.25;\r\n      let d = 0.0;\r\n\r\n      let css = `url(\"${customIcon.blobUrl}\")`;\r\n\r\n      return css;\r\n    }\r\n\r\n    let x = (-(icon%this.tilex)*this.tilesize)*ratio;\r\n    let y = (-(~~(icon/this.tilex))*this.tilesize)*ratio;\r\n\r\n    //x = ~~x;\r\n    //y = ~~y;\r\n\r\n    //console.log(this.tilesize, this.drawsize, x, y);\r\n    //let ts = this.tilesize;\r\n    //return `image('${this.image.src}#xywh=${x},${y},${ts},${ts}')`;\r\n    return `url(\"${this.image.src}\") ${x}px ${y}px`;\r\n  }\r\n}\r\n\r\nexport class CustomIcon {\r\n  constructor(manager, key, id, baseImage) {\r\n    this.key = key;\r\n    this.baseImage = baseImage;\r\n    this.images = []\r\n    this.id = id;\r\n    this.manager = manager;\r\n  }\r\n\r\n  regenIcons() {\r\n    let manager = this.manager;\r\n\r\n    let doSheet = (sheet) => {\r\n      let size = sheet.drawsize;\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = canvas.height = size;\r\n      g.drawImage(this.baseImage, 0, 0, size, size);\r\n\r\n      canvas.toBlob((blob) => {\r\n        let blobUrl = URL.createObjectURL(blob);\r\n\r\n        sheet.customIcons.set(this.id, {\r\n          blobUrl,\r\n          canvas\r\n        });\r\n      })\r\n    }\r\n\r\n    for (let sheet of manager.iconsheets) {\r\n      doSheet(sheet);\r\n    }\r\n  }\r\n}\r\n\r\nexport class IconManager {\r\n  /**\r\n   images is a list of dom ids of img tags\r\n\r\n   sizes is a list of tile sizes, one per image.\r\n   you can control the final *draw* size by passing an array\r\n   of [tilesize, drawsize] instead of just a number.\r\n   */\r\n  constructor(images, sizes, horizontal_tile_count) {\r\n    this.iconsheets = [];\r\n    this.tilex = horizontal_tile_count;\r\n\r\n    this.customIcons = new Map();\r\n    this.customIconIDMap = new Map();\r\n\r\n    for (let i = 0; i < images.length; i++) {\r\n      let size, drawsize;\r\n\r\n      if (typeof sizes[i] == \"object\") {\r\n        size = sizes[i][0], drawsize = sizes[i][1];\r\n      } else {\r\n        size = drawsize = sizes[i];\r\n      }\r\n\r\n      if (util.isMobile()) {\r\n        drawsize = ~~(drawsize*theme.base.mobileSizeMultiplier);\r\n      }\r\n\r\n      this.iconsheets.push(new _IconManager(images[i], size, horizontal_tile_count, drawsize));\r\n    }\r\n  }\r\n\r\n  isReady(sheet = 0) {\r\n    return this.iconsheets[sheet].ready;\r\n  }\r\n\r\n  addCustomIcon(key, image) {\r\n    let icon = this.customIcons.get(key);\r\n\r\n    if (!icon) {\r\n      let maxid = 0;\r\n\r\n      for (let k in Icons) {\r\n        maxid = Math.max(maxid, Icons[k] + 1);\r\n      }\r\n      for (let icon of this.customIcons.values()) {\r\n        maxid = Math.max(maxid, icon.id + 1);\r\n      }\r\n\r\n      maxid = Math.max(maxid, 1000); //just to be on the safe side\r\n\r\n      let id = maxid;\r\n      icon = new CustomIcon(this, key, id, image);\r\n\r\n      this.customIcons.set(key, icon);\r\n      this.customIconIDMap.set(id, icon);\r\n    }\r\n\r\n    icon.baseImage = image;\r\n    icon.regenIcons();\r\n\r\n    return icon.id;\r\n  }\r\n\r\n  load(manager2) {\r\n    this.iconsheets = manager2.iconsheets;\r\n    this.tilex = manager2.tilex;\r\n\r\n    return this;\r\n  }\r\n\r\n  reset(horizontal_tile_count) {\r\n    this.iconsheets.length = 0;\r\n    this.tilex = horizontal_tile_count;\r\n  }\r\n\r\n  add(image, size, drawsize = size) {\r\n    this.iconsheets.push(new _IconManager(image, size, this.tilex, drawsize));\r\n    return this;\r\n  }\r\n\r\n  canvasDraw(elem, canvas, g, icon, x = 0, y = 0, sheet = 0) {\r\n    let base = this.iconsheets[sheet];\r\n\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    sheet.canvasDraw(elem, canvas, g, icon, x, y);\r\n    sheet.drawsize = ds;\r\n  }\r\n\r\n  findClosestSheet(size) {\r\n    let sheets = this.iconsheets.concat([]);\r\n\r\n    sheets.sort((a, b) => a.drawsize - b.drawsize);\r\n    let sheet;\r\n\r\n    for (let i = 0; i < sheets.length; i++) {\r\n      if (sheets[i].drawsize <= size) {\r\n        sheet = sheets[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sheet)\r\n      sheet = sheets[sheets.length - 1];\r\n\r\n    return this.iconsheets.indexOf(sheet);\r\n  }\r\n\r\n  findSheet(sheet) {\r\n    if (sheet === undefined) {\r\n      console.warn(\"sheet was undefined\");\r\n      sheet = 0;\r\n    }\r\n\r\n    let base = this.iconsheets[sheet];\r\n\r\n    /**sigh**/\r\n    let dpi = UIBase.getDPI();\r\n    let minsheet = undefined;\r\n    let goal = dpi*base.drawsize;\r\n\r\n    for (let sheet of this.iconsheets) {\r\n      minsheet = sheet;\r\n\r\n      if (sheet.drawsize >= goal) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return minsheet === undefined ? base : minsheet;\r\n  }\r\n\r\n  getTileSize(sheet = 0) {\r\n    return this.iconsheets[sheet].drawsize;\r\n    return this.findSheet(sheet).drawsize;\r\n  }\r\n\r\n  getRealSize(sheet = 0) {\r\n    return this.iconsheets[sheet].tilesize;\r\n    return this.findSheet(sheet).tilesize;\r\n    //return this.iconsheets[sheet].tilesize;\r\n  }\r\n\r\n  //icon is an integer\r\n  getCSS(icon, sheet = 0) {\r\n    //return this.iconsheets[sheet].getCSS(icon);\r\n    //return this.findSheet(sheet).getCSS(icon);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.getCSS(icon);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n\r\n  setCSS(icon, dom, sheet = 0, fitsize = undefined) {\r\n    //return this.iconsheets[sheet].setCSS(icon, dom);\r\n\r\n    let base = this.iconsheets[sheet];\r\n    sheet = this.findSheet(sheet);\r\n    let ds = sheet.drawsize;\r\n\r\n    sheet.drawsize = base.drawsize;\r\n    let ret = sheet.setCSS(icon, dom, fitsize);\r\n    sheet.drawsize = ds;\r\n\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport let iconmanager = new IconManager([\r\n  document.getElementById(\"iconsheet16\"),\r\n  document.getElementById(\"iconsheet32\"),\r\n  document.getElementById(\"iconsheet48\")\r\n], [16, 32, 64], 16);\r\n\r\nwindow._iconmanager = iconmanager; //debug global\r\n\r\n//if client code overrides iconsheets, they must follow logical convention\r\n//that the first one is \"small\" and the second is \"large\"\r\nexport let IconSheets = {\r\n  SMALL : 0,\r\n  LARGE : 1,\r\n  XLARGE: 2\r\n};\r\n\r\nexport function iconSheetFromPackFlag(flag) {\r\n  if (flag & PackFlags.CUSTOM_ICON_SHEET) {\r\n    //console.log(\"Custom Icon Sheet:\", flag>>PackFlags.CUSTOM_ICON_SHEET_START);\r\n    return flag>>PackFlags.CUSTOM_ICON_SHEET_START;\r\n  }\r\n\r\n  if ((flag & PackFlags.SMALL_ICON) && !(PackFlags.LARGE_ICON)) {\r\n    return 0//IconSheets.SMALL; //0\r\n  } else {\r\n    return 1//IconSheets.LARGE; //1\r\n  }\r\n}\r\n\r\nexport function getIconManager() {\r\n  return iconmanager;\r\n}\r\n\r\nexport function setIconManager(manager, IconSheetsOverride) {\r\n  iconmanager.load(manager);\r\n\r\n  if (IconSheetsOverride !== undefined) {\r\n    for (let k in IconSheetsOverride) {\r\n      IconSheets[k] = IconSheetsOverride[k];\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeIconDiv(icon, sheet = 0) {\r\n  let size = iconmanager.getRealSize(sheet);\r\n\r\n  let drawsize = iconmanager.getTileSize(sheet);\r\n\r\n  let icontest = document.createElement(\"div\");\r\n\r\n  icontest.style[\"width\"] = icontest.style[\"min-width\"] = drawsize + \"px\";\r\n  icontest.style[\"height\"] = icontest.style[\"min-height\"] = drawsize + \"px\";\r\n\r\n  //icontest.style[\"background-color\"] = \"orange\";\r\n\r\n  icontest.style[\"margin\"] = \"0px\";\r\n  icontest.style[\"padding\"] = \"0px\";\r\n\r\n  iconmanager.setCSS(icon, icontest, sheet);\r\n\r\n  return icontest;\r\n}\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Matrix4 = vectormath.Matrix4;\r\n\r\nexport let dpistack = [];\r\n\r\nexport const UIFlags = {};\r\n\r\nconst internalElementNames = {};\r\nconst externalElementNames = {};\r\n\r\nexport const PackFlags = {\r\n  INHERIT_WIDTH : 1,\r\n  INHERIT_HEIGHT: 2,\r\n  VERTICAL      : 4,\r\n  USE_ICONS     : 8,\r\n  SMALL_ICON    : 16,\r\n  LARGE_ICON    : 32,\r\n\r\n  FORCE_PROP_LABELS         : 64, //force propeties (Container.prototype.prop()) to always have labels\r\n  PUT_FLAG_CHECKS_IN_COLUMNS: 128, //group flag property checkmarks in columns (doesn't apply to icons)\r\n\r\n  WRAP_CHECKBOXES: 256,\r\n\r\n  //internal flags\r\n  STRIP_HORIZ            : 512,\r\n  STRIP_VERT             : 1024,\r\n  STRIP                  : 512 | 1024,\r\n  SIMPLE_NUMSLIDERS      : 2048,\r\n  FORCE_ROLLER_SLIDER    : 4096,\r\n  HIDE_CHECK_MARKS       : (1<<13),\r\n  NO_NUMSLIDER_TEXTBOX   : (1<<14),\r\n  CUSTOM_ICON_SHEET      : 1<<15,\r\n  CUSTOM_ICON_SHEET_START: 20, //custom icon sheet bits are shifted to here\r\n  NO_UPDATE              : 1<<16,\r\n  LABEL_ON_RIGHT         : 1<<17,\r\n};\r\n\r\nlet first = (iter) => {\r\n  if (iter === undefined) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!(Symbol.iterator in iter)) {\r\n    for (let item in iter) {\r\n      return item;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  for (let item of iter) {\r\n    return item;\r\n  }\r\n}\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {TimeoutPromise} from '../path-controller/util/util.js';\r\nimport {IntProperty, NumberConstraints, PropFlags} from '../path-controller/toolsys/toolprop.js';\r\nimport {\r\n  DependSocket, EventNode, PropertySocket, PropSocketModes, SocketTypes, theEventGraph\r\n} from '../path-controller/dag/eventdag.js';\r\nimport {isNum} from '../path-controller/util/math.js';\r\n\r\nlet _mobile_theme_patterns = [\r\n  /.*width.*/,\r\n  /.*height.*/,\r\n  /.*size.*/,\r\n  /.*margin.*/,\r\n  /.*pad/,\r\n  /.*radius.*/\r\n];\r\n\r\n\r\nlet _idgen = 0;\r\n\r\nwindow._testSetScrollbars = function (color = \"grey\", contrast = 0.5, width = 15, border = \"solid\") {\r\n  let buf = styleScrollBars(color, undefined, contrast, width, border, \"*\");\r\n  CTX.screen.mergeGlobalCSS(buf);\r\n\r\n  //document.body.style[\"overflow\"] = \"scroll\";\r\n\r\n  /*\r\n  if (!window._tsttag) {\r\n    window._tsttag = document.createElement(\"style\");\r\n    document.body.prepend(_tsttag);\r\n  }\r\n\r\n  _tsttag.textContent = buf;\r\n  //*/\r\n\r\n  return buf;\r\n};\r\n\r\nexport function styleScrollBars(color = \"grey\", color2 = undefined, contrast = 0.5, width = 15,\r\n                                border                                                    = \"1px groove black\", selector = \"*\") {\r\n\r\n  if (!color2) {\r\n    let c = css2color(color);\r\n    let a = c.length > 3 ? c[3] : 1.0;\r\n\r\n    c = rgb_to_hsv(c[0], c[1], c[2]);\r\n    let inv = c.slice(0, c.length);\r\n\r\n    inv[2] = 1.0 - inv[2];\r\n    inv[2] += (c[2] - inv[2])*(1.0 - contrast);\r\n\r\n    inv = hsv_to_rgb(inv[0], inv[1], inv[2]);\r\n\r\n    inv.length = 4;\r\n    inv[3] = a;\r\n\r\n    inv = color2css(inv);\r\n    color2 = inv;\r\n  }\r\n\r\n  let buf = `\r\n\r\n${selector} {\r\n  scrollbar-width : ${width <= 16 ? 'thin' : 'auto'};\r\n  scrollbar-color : ${color2} ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar {\r\n  width : ${width}px;\r\n  background-color : ${color};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-track {\r\n  background-color : ${color};\r\n  border : ${border};\r\n}\r\n\r\n${selector}::-webkit-scrollbar-thumb {\r\n  background-color : ${color2};\r\n  border : ${border};\r\n}\r\n    `;\r\n\r\n  //console.log(buf);\r\n  return buf;\r\n}\r\n\r\nwindow.styleScrollBars = styleScrollBars;\r\n\r\nlet _digest = new util.HashDigest();\r\n\r\nexport function calcThemeKey(digest = _digest.reset()) {\r\n  for (let k in theme) {\r\n    let obj = theme[k];\r\n\r\n    if (typeof obj !== \"object\") {\r\n      continue;\r\n    }\r\n\r\n    for (let k2 in obj) {\r\n      let v2 = obj[k2];\r\n\r\n      if (typeof v2 === \"number\" || typeof v2 === \"boolean\" || typeof v2 === \"string\") {\r\n        digest.add(v2);\r\n      } else if (typeof v2 === \"object\" && v2 instanceof CSSFont) {\r\n        v2.calcHashUpdate(digest);\r\n      }\r\n    }\r\n  }\r\n\r\n  return digest.get();\r\n}\r\n\r\nexport var _themeUpdateKey = calcThemeKey();\r\n\r\nexport function flagThemeUpdate() {\r\n  _themeUpdateKey = calcThemeKey();\r\n}\r\n\r\nwindow._flagThemeUpdate = flagThemeUpdate;\r\n\r\nlet setTimeoutQueue = new Set();\r\nlet haveTimeout = false;\r\n\r\nfunction timeout_cb() {\r\n  if (setTimeoutQueue.size === 0) {\r\n    haveTimeout = false;\r\n    return;\r\n  }\r\n\r\n  for (let item of new Set(setTimeoutQueue)) {\r\n    let {cb, timeout, time} = item;\r\n    if (util.time_ms() - time < timeout) {\r\n      continue;\r\n    }\r\n\r\n    setTimeoutQueue.delete(item);\r\n\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      console.error(error.stack);\r\n    }\r\n  }\r\n\r\n  window.setTimeout(timeout_cb, 0);\r\n}\r\n\r\nexport function internalSetTimeout(cb, timeout) {\r\n  if (timeout > 100) { //call directly\r\n    window.setTimeout(cb, timeout);\r\n    return;\r\n  }\r\n\r\n  setTimeoutQueue.add({\r\n    cb, timeout, time: util.time_ms()\r\n  });\r\n\r\n  if (!haveTimeout) {\r\n    haveTimeout = true;\r\n    window.setTimeout(timeout_cb, 0);\r\n  }\r\n}\r\n\r\nwindow.setTimeoutQueue = setTimeoutQueue;\r\n\r\nexport class UIBase extends HTMLElement {\r\n  #reflagGraph = false;\r\n\r\n  static graphNodeDef = EventNode.register(this, {\r\n    typeName: this.name,\r\n    uiName  : this.name,\r\n    inputs  : {\r\n      depend: new DependSocket()\r\n    },\r\n    outputs : {\r\n      depend: new DependSocket()\r\n    }\r\n  })\r\n\r\n  graphExec() {\r\n    let node = this.graphNode;\r\n\r\n    if (node.inputs.depend.isUpdated) {\r\n      node.outputs.depend.flagUpdate();\r\n    }\r\n\r\n    for (let k in node.inputs) {\r\n      let sock = node.inputs[k];\r\n\r\n      if (!(sock instanceof PropertySocket)) {\r\n        continue;\r\n      }\r\n\r\n      let val = sock.value;\r\n      let first = true;\r\n\r\n      for (let sockb of sock.edges) {\r\n        if (first) {\r\n          val = sockb.value;\r\n          first = false;\r\n        } else {\r\n          switch (sock.mixMode) {\r\n            case PropSocketModes.REPLACE:\r\n              val = sockb.value;\r\n              break;\r\n            case PropSocketModes.MIN:\r\n              val = Math.min(val, sockb.value);\r\n              break;\r\n            case PropSocketModes.MAX:\r\n              val = Math.max(val, sockb.value);\r\n              break;\r\n          }\r\n        }\r\n      }\r\n\r\n      sock.value = val;\r\n    }\r\n\r\n    function isNumArray(a) {\r\n      if (!Array.isArray(a)) {\r\n        return false;\r\n      }\r\n\r\n      for (let i = 0; i < a.length; i++) {\r\n        if (a[i] !== undefined && typeof a[i] !== \"number\" && typeof a[i] !== \"boolean\") {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    for (let k in node.outputs) {\r\n      let sock = node.outputs[k];\r\n\r\n      if (!(sock instanceof PropertySocket)) {\r\n        continue;\r\n      }\r\n\r\n      let v = sock.value;\r\n      let changed;\r\n      if (typeof v === \"boolean\" || typeof v === \"string\" || typeof v === \"number\") {\r\n        changed = v !== sock.oldValue;\r\n        sock.oldValue = v;\r\n      } else if (typeof v === \"object\") {\r\n        if (isNumArray(v)) {\r\n          if (!sock.oldValue) {\r\n            sock.oldValue = Array.from(v);\r\n          } else {\r\n            if (sock.oldValue.length !== v.length) {\r\n              changed = true;\r\n            } else {\r\n              for (let i = 0; i < sock.oldValue.length; i++) {\r\n                changed = sock.oldValue[i] !== v[i];\r\n              }\r\n            }\r\n\r\n            if (sock.oldValue.length !== v.length) {\r\n              sock.oldValue.length = v.length;\r\n            }\r\n            for (let i = 0; i < v.length; i++) {\r\n              sock.oldValue[i] = v.value[i];\r\n            }\r\n          }\r\n        } else {\r\n          if (sock.oldValue === undefined) {\r\n            sock.oldValue = JSON.stringify(v);\r\n          } else {\r\n            let json = JSON.stringify(v);\r\n            changed = json !== sock.oldValue;\r\n            sock.oldValue = json;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (changed) {\r\n        console.log(\"Propagating prop update\");\r\n        sock.flagUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  ensureGraph() {\r\n    console.log(\"Ensure Graph\", this, this.graphNode, this.graphNode.id);\r\n    if (!theEventGraph.has(this)) {\r\n      theEventGraph.add(this);\r\n    }\r\n  }\r\n\r\n  flagPropSocketUpdate(path) {\r\n    let sock = this.getPropertySocket(path, SocketTypes.OUTPUT);\r\n    if (sock) {\r\n      console.warn(`Flag socket \"${path}\" for update`);\r\n      sock.flagUpdate();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  getPropertySocket(prop, socktype) {\r\n    let node = this.graphNode;\r\n    let sockets = socktype === SocketTypes.INPUT ? node.inputs : node.outputs;\r\n\r\n    if (sockets[prop]) {\r\n      return sockets[prop];\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  ensurePropertySocket(prop, socktype) {\r\n    this.ensureGraph();\r\n\r\n    let node = this.graphNode;\r\n    let sockets = socktype === SocketTypes.INPUT ? node.inputs : node.outputs;\r\n\r\n    if (sockets[prop]) {\r\n      return sockets[prop];\r\n    }\r\n\r\n    let sock = new PropertySocket();\r\n    sock.bind(this, prop);\r\n    node.addSocket(socktype, prop, sock);\r\n\r\n    if (prop === \"value\") {\r\n      sock.callback((v) => {\r\n        if (this.getValue) {\r\n          return this.getValue();\r\n        }\r\n\r\n        return this.value;\r\n      });\r\n    }\r\n\r\n    return sock;\r\n  }\r\n\r\n  /*\r\n    widget.dependsOn(\"hidden\", checkbox, \"value\")\r\n   */\r\n  dependsOn(dstProp, source, srcProp, srcCallback = undefined, dstCallback = undefined) {\r\n    let sockdst = this.ensurePropertySocket(dstProp, SocketTypes.INPUT);\r\n    let socksrc = source.ensurePropertySocket(srcProp, SocketTypes.OUTPUT);\r\n\r\n    if (srcCallback) {\r\n      socksrc.callback(srcCallback);\r\n    }\r\n\r\n    sockdst.connect(socksrc);\r\n\r\n    return sockdst;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    EventNode.init(this);\r\n\r\n    this._modalstack = [];\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n    this._tooltip_ref = undefined;\r\n\r\n    this._textBoxEvents = false;\r\n\r\n    this._themeOverride = undefined;\r\n\r\n    this._checkTheme = true;\r\n    this._last_theme_update_key = _themeUpdateKey;\r\n\r\n    this._client_disabled_set = undefined;\r\n    //this._parent_disabled_set = 0;\r\n\r\n    this._useNativeToolTips = cconst.useNativeToolTips;\r\n    this._useNativeToolTips_set = false;\r\n    this._has_own_tooltips = undefined;\r\n    this._tooltip_timer = util.time_ms();\r\n\r\n    this.pathUndoGen = 0;\r\n    this._lastPathUndoGen = 0;\r\n    this._useDataPathUndo = undefined;\r\n\r\n    this._active_animations = [];\r\n\r\n    //ref to Link element referencing Screen style node\r\n    //Screen.update_intern sets the contents of this\r\n    this._screenStyleTag = document.createElement(\"style\");\r\n    this._screenStyleUpdateHash = 0;\r\n\r\n    initAspectClass(this, new Set([\"appendChild\", \"animate\", \"shadow\", \"removeNode\", \"prepend\", \"add\", \"init\"]));\r\n\r\n    this.shadow = this.attachShadow({mode: 'open'});\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs = [];\r\n    }\r\n\r\n    this.shadow.appendChild(this._screenStyleTag);\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n\r\n    ///*\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child && typeof child === \"object\" && child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n\r\n      return this.shadow._appendChild(child, ...arguments);\r\n    };\r\n    //*/\r\n\r\n    this._wasAddedToNodeAtSomeTime = false;\r\n\r\n    this.visibleToPick = true;\r\n\r\n    this._override_class = undefined;\r\n    this.parentWidget = undefined;\r\n\r\n    /*\r\n    this.shadow._appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      if (child instanceof UIBase) {\r\n        child.ctx = this.ctx;\r\n        child.parentWidget = this;\r\n\r\n        if (child._useDataPathUndo === undefined) {\r\n          child.useDataPathUndo = this.useDataPathUndo;\r\n        }\r\n      }\r\n\r\n      return this.shadow._appendChild(child);\r\n    };\r\n    //*/\r\n\r\n    let tagname = this.constructor.define().tagname;\r\n    this._id = tagname.replace(/\\-/g, \"_\") + (_idgen++);\r\n\r\n    this.default_overrides = {}; //inherited by child widgets\r\n    this.my_default_overrides = {}; //not inherited to child widgets\r\n    this.class_default_overrides = {};\r\n\r\n    this._last_description = undefined;\r\n    this._description_final = undefined;\r\n\r\n    //getting css to flow down properly can be a pain, so\r\n    //some packing settings are set as bitflags here,\r\n    //see PackFlags\r\n\r\n    /*\r\n    setInterval(() => {\r\n      this.update();\r\n    }, 200);\r\n    //*/\r\n\r\n    this._modaldata = undefined;\r\n    this.packflag = this.getDefault(\"BasePackFlag\");\r\n    this._internalDisabled = false;\r\n    this.__disabledState = false;\r\n    this._disdata = undefined;\r\n    this._ctx = undefined;\r\n\r\n    this._description = undefined;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n    .DefaultText {\r\n      font: ` + _getFont(this) + `;\r\n    }\r\n    `;\r\n    this.shadow.appendChild(style);\r\n    this._init_done = false;\r\n\r\n    /* Deprecated touch -> mouse event conversion,\r\n       use pointer events instead. */\r\n    let do_touch = (e, type, button) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      button = button === undefined ? 0 : button;\r\n      let e2 = copyEvent(e);\r\n\r\n      if (e.touches.length === 0) {\r\n        //hrm, what to do, what to do. . .\r\n      } else {\r\n        let t = e.touches[0];\r\n\r\n        e2.pageX = t.pageX;\r\n        e2.pageY = t.pageY;\r\n        e2.screenX = t.screenX;\r\n        e2.screenY = t.screenY;\r\n        e2.clientX = t.clientX;\r\n        e2.clientY = t.clientY;\r\n        e2.x = t.x;\r\n        e2.y = t.y;\r\n      }\r\n\r\n      e2.button = button;\r\n\r\n      e2 = new MouseEvent(type, e2);\r\n\r\n      e2.was_touch = true;\r\n      e2.stopPropagation = e.stopPropagation.bind(e);\r\n      e2.preventDefault = e.preventDefault.bind(e);\r\n      e2.touches = e.touches;\r\n\r\n      this.dispatchEvent(e2);\r\n    };\r\n\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      do_touch(e, \"mousedown\", 0);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchmove\", (e) => {\r\n      do_touch(e, \"mousemove\");\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchcancel\", (e) => {\r\n      do_touch(e, \"mouseup\", 2);\r\n    }, {passive: false});\r\n    this.addEventListener(\"touchend\", (e) => {\r\n      do_touch(e, \"mouseup\", 0);\r\n    }, {passive: false});\r\n\r\n    if (this.constructor.define().havePickClipboard) {\r\n      this._clipboardHotkeyInit();\r\n    }\r\n  }\r\n\r\n  /*\r\n  set default_overrides(v) {\r\n    console.error(\"default_overrides was set\", v);\r\n    this._default_overrides = v;\r\n  }\r\n\r\n  get default_overrides() {\r\n    return this._default_overrides;\r\n  }//*/\r\n\r\n  get useNativeToolTips() {\r\n    return this._useNativeToolTips;\r\n  }\r\n\r\n  set useNativeToolTips(val) {\r\n    this._useNativeToolTips = val;\r\n    this._useNativeToolTips_set = true;\r\n  }\r\n\r\n  get parentWidget() {\r\n    return this._parentWidget;\r\n  }\r\n\r\n  set parentWidget(val) {\r\n    if (val) {\r\n      this._wasAddedToNodeAtSomeTime = true;\r\n    }\r\n\r\n    this._parentWidget = val;\r\n  }\r\n\r\n  get useDataPathUndo() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p._useDataPathUndo !== undefined) {\r\n        return p._useDataPathUndo;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    /* Default to true. */\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   causes calls to setPathValue to go through\r\n   toolpath app.datapath_set(path=\"\" newValueJSON=\"\")\r\n\r\n   every child will inherit\r\n   */\r\n  set useDataPathUndo(val) {\r\n    this._useDataPathUndo = val;\r\n  }\r\n\r\n  get description() {\r\n\r\n    return this._description;\r\n  }\r\n\r\n  set description(val) {\r\n    if (val === null) {\r\n      this._description = undefined;\r\n      return;\r\n    }\r\n\r\n    this._description = val;\r\n\r\n    if (val === undefined || val === null) {\r\n      return;\r\n    }\r\n\r\n    if (cconst.showPathsInToolTips && this.hasAttribute(\"datapath\")) {\r\n      let s = \"\" + this._description;\r\n\r\n      let path = this.getAttribute(\"datapath\");\r\n      s += \"\\n    path: \" + path;\r\n\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        let m = this.getAttribute(\"mass_set_path\");\r\n        s += \"\\n    massSetPath: \" + m;\r\n      }\r\n\r\n      this._description_final = s;\r\n    } else {\r\n      this._description_final = this._description;\r\n    }\r\n\r\n    if (cconst.useNativeToolTips) {\r\n      this.title = \"\" + this._description_final;\r\n    }\r\n  }\r\n\r\n  get background() {\r\n    return this.__background;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.overrideDefault(\"background-color\", bg, true);\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get disabled() {\r\n    //hrm, I could just propegate checks upward. . .\r\n\r\n    if (this.parentWidget && this.parentWidget.disabled) {\r\n      return true;\r\n    }\r\n\r\n    return !!this._client_disabled_set || !!this._internalDisabled;// || !!this._parent_disabled_set;\r\n  }\r\n\r\n  set disabled(v) {\r\n    this._client_disabled_set = v;\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    this._internalDisabled = !!val;\r\n\r\n    this.__updateDisable(this.disabled);\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(c) {\r\n    this._ctx = c;\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.ctx = c;\r\n    });\r\n  }\r\n\r\n  get _reportCtxName() {\r\n    return \"\" + this._id;\r\n  }\r\n\r\n  get modalRunning() {\r\n    return this._modaldata !== undefined;\r\n  }\r\n\r\n  static getIconEnum() {\r\n    return Icons;\r\n  }\r\n\r\n  static setDefault(element) {\r\n    return element;\r\n  }\r\n\r\n  /**DEPRECATED\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   */\r\n  static getDPI() {\r\n    //if (dpistack.length > 0) {\r\n    //  return dpistack[this.dpistack.length-1];\r\n    //} else {\r\n    //if (util.isMobile()) {\r\n    return window.devicePixelRatio; // * visualViewport.scale;\r\n    //}\r\n\r\n    return window.devicePixelRatio;\r\n    //}\r\n  }\r\n\r\n  static prefix(name) {\r\n    return tagPrefix + name;\r\n  }\r\n\r\n  static internalRegister(cls) {\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    registered_has_happened = true;\r\n\r\n    internalElementNames[cls.define().tagname] = this.prefix(cls.define().tagname);\r\n    customElements.define(this.prefix(cls.define().tagname), cls);\r\n  }\r\n\r\n  static getInternalName(name) {\r\n    return internalElementNames[name];\r\n  }\r\n\r\n  static createElement(name, internal = false) {\r\n    if (!internal && name in externalElementNames) {\r\n      return document.createElement(name);\r\n    } else if (name in internalElementNames) {\r\n      return document.createElement(internalElementNames[name]);\r\n    } else {\r\n      return document.createElement(name)\r\n    }\r\n  }\r\n\r\n  static register(cls) {\r\n    registered_has_happened = true;\r\n\r\n    cls[ClassIdSymbol] = class_idgen++;\r\n\r\n    ElementClasses.push(cls);\r\n\r\n    externalElementNames[cls.define().tagname] = cls.define().tagname;\r\n    customElements.define(cls.define().tagname, cls);\r\n  }\r\n\r\n  /**\r\n   * Defines core attributes of the class\r\n   *\r\n   * @example\r\n   *\r\n   * static define() {return {\r\n   *   tagname             : \"custom-element-x\",\r\n   *   style               : \"[style class in theme]\"\r\n   *   subclassChecksTheme : boolean //set to true to disable base class invokation of checkTheme()\r\n   *   havePickClipboard   : boolean //whether element supports mouse hover copy/paste\r\n   *   pasteForAllChildren : boolean //mouse hover paste happens even over child widgets\r\n   *   copyForAllChildren  : boolean //mouse hover copy happens even over child widgets\r\n   * }}\r\n   */\r\n  static define() {\r\n    throw new Error(\"Missing define() for ux element\");\r\n  }\r\n\r\n  setUndo(val) {\r\n    this.useDataPathUndo = val;\r\n    return this;\r\n  }\r\n\r\n  set hidden(state) {\r\n    state = !!state;\r\n    super.hidden = state;\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      n.hidden = state;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.hide(state);\r\n    })\r\n  }\r\n\r\n  get hidden() {\r\n    return super.hidden;\r\n  }\r\n\r\n  hide(sethide = true) {\r\n    this.hidden = sethide;\r\n    return this;\r\n  }\r\n\r\n  getElementById(id) {\r\n    let ret;\r\n\r\n    let rec = (n) => {\r\n      if (ret) {\r\n        return;\r\n      }\r\n\r\n      if (n.getAttribute(\"id\") === id || n.id === id) {\r\n        ret = n;\r\n      }\r\n\r\n      if (n instanceof UIBase && n.constructor.define().tagname === \"panelframe-x\") {\r\n        rec(n.contents);\r\n      } else if (n instanceof UIBase && n.constructor.define().tagname === \"tabcontainer-x\") {\r\n        for (let k in n.tabs) {\r\n          let tab = n.tabs[k];\r\n\r\n          if (tab) {\r\n            rec(tab);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        if (n2 instanceof HTMLElement) {\r\n          rec(n2);\r\n\r\n          if (ret) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (n2 instanceof HTMLElement) {\r\n            rec(n2);\r\n\r\n            if (ret) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this);\r\n\r\n    return ret;\r\n  }\r\n\r\n  unhide() {\r\n    this.hide(false);\r\n  }\r\n\r\n  findArea() {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (p instanceof Area) {\r\n        return p;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"addEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let cb2 = (e) => {\r\n      if (cconst.DEBUG.paranoidEvents) {\r\n        if (this.isDead()) {\r\n          this.removeEventListener(type, cb, options);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (cconst.DEBUG.domEvents) {\r\n        pathDebugEvent(e);\r\n      }\r\n\r\n      let area = this.findArea();\r\n\r\n      if (area) {\r\n        area.push_ctx_active();\r\n        try {\r\n          let ret = cb(e);\r\n          area.pop_ctx_active();\r\n          return ret;\r\n        } catch (error) {\r\n          area.pop_ctx_active();\r\n          throw error;\r\n        }\r\n      } else {\r\n        if (cconst.DEBUG.areaContextPushes) {\r\n          console.warn(\"Element is not part of an area?\", element);\r\n        }\r\n\r\n        return cb(e);\r\n      }\r\n    };\r\n\r\n    if (!cb[EventCBSymbol]) {\r\n      cb[EventCBSymbol] = new Map();\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n    cb[EventCBSymbol].set(key, cb2);\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      this.__cbs.push([type, cb2, options]);\r\n    }\r\n\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        if (item[0] == type && item[1] === cb._cb2 && (\"\" + item[2]) === (\"\" + options)) {\r\n          this.__cbs.remove(item);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (cconst.DEBUG.domEventAddRemove) {\r\n      console.log(\"removeEventListener\", type, this._id, options);\r\n    }\r\n\r\n    let key = calcElemCBKey(this, type, options);\r\n\r\n    if (!cb[EventCBSymbol] || !cb[EventCBSymbol].has(key)) {\r\n      return super.removeEventListener(type, cb, options);\r\n    } else {\r\n      let cb2 = cb[EventCBSymbol].get(key);\r\n\r\n      let ret = super.removeEventListener(type, cb2, options);\r\n\r\n      cb[EventCBSymbol].delete(key);\r\n      return ret;\r\n    }\r\n  }\r\n\r\n  connectedCallback() {\r\n\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    keys = keys.concat([\"margin-left\", \"margin-top\", \"margin-bottom\", \"margin-right\"]);\r\n    keys = keys.concat([\"padding-left\", \"padding-top\", \"padding-bottom\", \"padding-right\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * find owning screen and tell it to update\r\n   * the global tab order\r\n   * */\r\n  regenTabOrder() {\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen.needsTabRecalc = true;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  noMargins() {\r\n    this.style[\"margin\"] = this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"0px\";\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  noPadding() {\r\n    this.style[\"padding\"] = this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"0px\";\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"0px\";\r\n    return this;\r\n  }\r\n\r\n  getTotalRect() {\r\n    let found = false;\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    let doaabb = (n) => {\r\n      let rs = n.getClientRects();\r\n\r\n      for (let r of rs) {\r\n        min[0] = Math.min(min[0], r.x);\r\n        min[1] = Math.min(min[1], r.y);\r\n        max[0] = Math.max(max[0], r.x + r.width);\r\n        max[1] = Math.max(max[1], r.y + r.height);\r\n\r\n        found = true;\r\n      }\r\n    };\r\n\r\n    doaabb(this);\r\n\r\n    this._forEachChildWidget((n) => {\r\n      doaabb(n);\r\n    });\r\n\r\n    if (found) {\r\n      return {\r\n        width : max[0] - min[0],\r\n        height: max[1] - min[1],\r\n        x     : min[0],\r\n        y     : min[1],\r\n        left  : min[0],\r\n        top   : min[1],\r\n        right : max[0],\r\n        bottom: max[1]\r\n      };\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  parseNumber(value, args = {}) {\r\n    value = (\"\" + value).trim().toLowerCase();\r\n\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n\r\n    let sign = 1.0;\r\n\r\n    if (value.startsWith(\"-\")) {\r\n      value = value.slice(1, value.length).trim();\r\n      sign = -1;\r\n    }\r\n\r\n    let hexre = /-?[0-9a-f]+h$/;\r\n\r\n    if (value.startsWith(\"0b\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 2);\r\n    } else if (value.startsWith(\"0x\")) {\r\n      value = value.slice(2, value.length).trim();\r\n      value = parseInt(value, 16);\r\n    } else if (value.search(hexre) === 0) {\r\n      value = value.slice(0, value.length - 1).trim();\r\n      value = parseInt(value, 16);\r\n    } else {\r\n      value = units.parseValue(value, baseUnit);\r\n    }\r\n\r\n    if (isInt) {\r\n      value = ~~value;\r\n    }\r\n\r\n    return value*sign;\r\n  }\r\n\r\n  formatNumber(value, args = {}) {\r\n    let baseUnit = args.baseUnit || this.baseUnit;\r\n    let displayUnit = args.displayUnit || this.displayUnit;\r\n    let isInt = args.isInt || this.isInt;\r\n    let radix = args.radix || this.radix || 10;\r\n    let decimalPlaces = args.decimalPlaces || this.decimalPlaces;\r\n\r\n    //console.log(this.baseUnit, this.displayUnit);\r\n\r\n    if (isInt && radix !== 10) {\r\n      let ret = Math.floor(value).toString(radix);\r\n\r\n      if (radix === 2)\r\n        return \"0b\" + ret;\r\n      else if (radix === 16)\r\n        return ret + \"h\";\r\n    }\r\n\r\n    return units.buildString(value, baseUnit, decimalPlaces, displayUnit);\r\n  }\r\n\r\n  setBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    //debugger;\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      this.style[key] = \"unset\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) { //handle default first\r\n        for (let j = 0; j < 4; j++) {\r\n          this.style[key + \"-\" + keys[j]] = val + \"px\";\r\n        }\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) { //now do box sides\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          this.style[key2] = val2 + \"px\";\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    this.style[\"border-radius\"] = def(\"border-radius\") + \"px\";\r\n    this.style[\"border\"] = `${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")}`;\r\n  }\r\n\r\n  genBoxCSS(subkey) {\r\n    let boxcode = '';\r\n\r\n    let keys = [\"left\", \"right\", \"top\", \"bottom\"];\r\n\r\n    let sub;\r\n    if (subkey) {\r\n      sub = this.getAttribute(subkey) || {};\r\n    }\r\n\r\n    let def = (key) => {\r\n      if (sub) {\r\n        return this.getSubDefault(subkey, key);\r\n      }\r\n\r\n      return this.getDefault(key);\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"padding\" : \"margin\";\r\n\r\n      let val = def(key);\r\n      if (val !== undefined) {\r\n        boxcode += `${key}: ${val} px;\\n`;\r\n      }\r\n\r\n      for (let j = 0; j < 4; j++) {\r\n        let key2 = `${key}-${keys[j]}`;\r\n        let val2 = def(key2);\r\n\r\n        if (val2 !== undefined) {\r\n          boxcode += `${key2}: ${val}px;\\n`;\r\n        }\r\n      }\r\n    }\r\n\r\n    boxcode += `border-radius: ${def(\"border-radius\")}px;\\n`;\r\n    boxcode += `border: ${def(\"border-width\")}px ${def(\"border-style\")} ${def(\"border-color\")};\\n`;\r\n\r\n    return boxcode;\r\n  }\r\n\r\n  setCSS(setBG = true) {\r\n    if (setBG) {\r\n      let bg = this.getDefault(\"background-color\");\r\n      if (bg) {\r\n        this.style[\"background-color\"] = bg;\r\n      }\r\n    }\r\n\r\n    let zoom = this.getZoom();\r\n    if (zoom === 1.0) {\r\n      return;\r\n    }\r\n\r\n    let transform = \"\" + this.style[\"transform\"];\r\n\r\n    //try to preserve user set transform by selectively deleting scale\r\n    //kind of hackish. . .\r\n\r\n    //normalize whitespace\r\n    transform = transform.replace(/[ \\t\\n\\r]+/g, ' ');\r\n    transform = transform.replace(/, /g, ',');\r\n\r\n    //cut out scale\r\n    let transform2 = transform.replace(/scale\\([^)]+\\)/, '').trim();\r\n    this.style[\"transform\"] = transform2 + ` scale(${zoom},${zoom})`;\r\n  }\r\n\r\n  flushSetCSS() {\r\n    //check init\r\n    this._init();\r\n\r\n    this.setCSS();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (!(c.packflag & PackFlags.NO_UPDATE)) {\r\n        c.flushSetCSS();\r\n      }\r\n    });\r\n  }\r\n\r\n  /* Why is the DOM API argument order swapped here?*/\r\n  replaceChild(newnode, node) {\r\n    for (let i = 0; i < this.childNodes.length; i++) {\r\n      if (this.childNodes[i] === node) {\r\n        super.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.shadow.childNodes.length; i++) {\r\n      if (this.shadow.childNodes[i] === node) {\r\n        this.shadow.replaceChild(newnode, node);\r\n        return true;\r\n      }\r\n    }\r\n\r\n    console.error(\"Unknown child node\", node);\r\n    return false;\r\n  }\r\n\r\n  swapWith(b) {\r\n    let p1 = this.parentNode;\r\n    let p2 = b.parentNode;\r\n\r\n    if (this.parentWidget && (p1 === this.parentWidget.shadow) || p1 === null) {\r\n      p1 = this.parentWidget;\r\n    }\r\n\r\n    if (b.parentWidget && (p2 === b.parentWidget.shadow) || p2 === null) {\r\n      p2 = b.parentWidget;\r\n    }\r\n\r\n    if (!p1 || !p2) {\r\n      console.error(\"Invalid call to UIBase.prototype.swapWith\", this, b, p1, p2);\r\n      return false;\r\n    }\r\n\r\n    let getPos = (n, p) => {\r\n      let i = Array.prototype.indexOf.call(p.childNodes, n);\r\n\r\n      if (i < 0 && p.shadow) {\r\n        p = p.shadow;\r\n        i = Array.prototype.indexOf.call(p.childNodes, n);\r\n      }\r\n\r\n      return [i, p];\r\n    }\r\n\r\n    let [i1, n1] = getPos(this, p1);\r\n    let [i2, n2] = getPos(b, p2);\r\n\r\n    console.log(\"i1, i2, n1, n2\", i1, i2, n1, n2);\r\n\r\n    let tmp1 = document.createElement(\"div\");\r\n    let tmp2 = document.createElement(\"div\");\r\n\r\n    n1.insertBefore(tmp1, this);\r\n    n2.insertBefore(tmp2, b);\r\n\r\n    //HTMLElement.prototype.remove.call(this);\r\n    //HTMLElement.prototype.remove.call(b);\r\n\r\n    n1.replaceChild(b, tmp1);\r\n    n2.replaceChild(this, tmp2);\r\n\r\n    let ptmp = this.parentWidget;\r\n    this.parentWidget = b.parentWidget;\r\n    b.parentWidget = ptmp;\r\n\r\n    tmp1.remove();\r\n    tmp2.remove();\r\n\r\n    return true;\r\n  }\r\n\r\n  traverse(type_or_set) {\r\n    let this2 = this;\r\n\r\n    let classes = type_or_set;\r\n\r\n    let is_set = type_or_set instanceof Set;\r\n    is_set = is_set || type_or_set instanceof util.set;\r\n    is_set = is_set || Array.isArray(type_or_set);\r\n\r\n    if (!is_set) {\r\n      classes = [type_or_set];\r\n    }\r\n\r\n    let visit = new Set();\r\n\r\n    return (function* () {\r\n      let stack = [this2];\r\n\r\n      while (stack.length > 0) {\r\n        let n = stack.pop();\r\n\r\n        visit.add(n);\r\n\r\n        if (!n || !n.childNodes) {\r\n          continue;\r\n        }\r\n\r\n        for (let cls of classes) {\r\n          if (n instanceof cls) {\r\n            yield n;\r\n          }\r\n        }\r\n\r\n        for (let c of n.childNodes) {\r\n          if (!visit.has(c)) {\r\n            stack.push(c);\r\n          }\r\n        }\r\n\r\n        if (n.shadow) {\r\n          for (let c of n.shadow.childNodes) {\r\n            if (!visit.has(c)) {\r\n              stack.push(c);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      child.useDataPathUndo = this.useDataPathUndo;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  _clipboardHotkeyInit() {\r\n    this._clipboard_over = false;\r\n    this._last_clipboard_keyevt = undefined;\r\n\r\n    this._clipboard_keystart = () => {\r\n      if (this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = true;\r\n      window.addEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keyend = () => {\r\n      if (!this._clipboard_events) {\r\n        return;\r\n      }\r\n\r\n      this._clipboard_events = false;\r\n      window.removeEventListener(\"keydown\", this._clipboard_keydown, {capture: true, passive: false});\r\n    }\r\n\r\n    this._clipboard_keydown = (e, internal_mode) => {\r\n      if (!this.isConnected || !cconst.getClipboardData) {\r\n        this._clipboard_keyend();\r\n        return;\r\n      }\r\n\r\n      if (e === this._last_clipboard_keyevt || !this._clipboard_over) {\r\n        return;\r\n      }\r\n\r\n      /* the user's mouse cursor might not be over the element\r\n      *  if they've tabbed to it */\r\n\r\n      let is_copy = e.keyCode === keymap[\"C\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n      let is_paste = e.keyCode === keymap[\"V\"] && (e.ctrlKey || e.commandKey) && !e.shiftKey && !e.altKey;\r\n\r\n      if (!is_copy && !is_paste) {\r\n        //early out, remember that pickElement is highly expensive to run\r\n        return;\r\n      }\r\n\r\n      //pasteForAllChildren\r\n      if (!internal_mode) {\r\n        let screen = this.ctx.screen;\r\n        let elem = screen.pickElement(screen.mpos[0], screen.mpos[1]);\r\n\r\n        let checkTree = is_paste && this.constructor.define().pasteForAllChildren;\r\n        checkTree = checkTree || (is_copy && this.constructor.define().copyForAllChildren);\r\n\r\n        while (checkTree && !(elem instanceof TextBox) && elem !== this && elem.parentWidget) {\r\n          console.log(\"  \" + elem._id);\r\n\r\n          elem = elem.parentWidget;\r\n        }\r\n\r\n        console.warn(\"COLOR\", this._id, elem._id);\r\n\r\n        if (elem !== this) {\r\n          //remove global keyhandler\r\n          this._clipboard_keyend();\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"COLOR\", this._id);\r\n      }\r\n\r\n      this._last_clipboard_keyevt = e;\r\n\r\n      if (is_copy) {\r\n        this.clipboardCopy();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      if (is_paste) {\r\n        this.clipboardPaste();\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    let start = (e) => {\r\n      this._clipboard_over = true;\r\n      this._clipboard_keystart();\r\n    }\r\n\r\n    let stop = (e) => {\r\n      this._clipboard_over = false;\r\n      this._clipboard_keyend();\r\n    }\r\n\r\n    this.doOnce(() => {\r\n      this.tabIndex = 0; //enable self key events when element has focus\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      return this._clipboard_keydown(e, true);\r\n    });\r\n\r\n    this.addEventListener(\"pointerover\", start, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", stop, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", stop, {capture: true, passive: true});\r\n  }\r\n\r\n  /** set havePickClipboard to true in define() to\r\n   *  enable mouseover pick clipboarding */\r\n  clipboardCopy() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  clipboardPaste() {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  //delayed init\r\n  init() {\r\n    this._init_done = true;\r\n\r\n    if (!this.hasAttribute(\"id\") && this._id) {\r\n      this.setAttribute(\"id\", this._id);\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    if (cconst.DEBUG.paranoidEvents) {\r\n      for (let item of this.__cbs) {\r\n        this.removeEventListener(item[0], item[1], item[2]);\r\n      }\r\n\r\n      this.__cbs = [];\r\n    }\r\n\r\n\r\n    if (this.ondestroy !== undefined) {\r\n      this.ondestroy();\r\n    }\r\n  }\r\n\r\n  remove(trigger_on_destroy = true) {\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n\r\n    super.remove();\r\n\r\n    if (trigger_on_destroy) {\r\n      this._ondestroy();\r\n    }\r\n\r\n    if (this.on_remove) {\r\n      this.on_remove();\r\n    }\r\n\r\n    this.parentWidget = undefined;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * called when elements are removed.\r\n  * you should assume the element will be reused later;\r\n  * on_destroy is the callback for when elements are permanently destroyed\r\n  * */\r\n  on_remove() {\r\n\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    super.removeChild(child);\r\n\r\n    if (trigger_on_destroy) {\r\n      child._ondestroy();\r\n    }\r\n  }\r\n\r\n  flushUpdate(force = false) {\r\n    //check init\r\n    this._init();\r\n\r\n    this.update();\r\n\r\n    this._forEachChildWidget((c) => {\r\n      if (force || !(c.packflag & PackFlags.NO_UPDATE)) {\r\n        if (!c.ctx) {\r\n          c.ctx = this.ctx;\r\n        }\r\n\r\n        c.flushUpdate(force);\r\n      }\r\n    });\r\n  }\r\n\r\n  //used by container nodes\r\n  /**\r\n   * Iterates over all child widgets,\r\n   * including ones that might be inside\r\n   * of normal DOM nodes.\r\n   *\r\n   * This is done by recursing into the dom\r\n   * tree and stopping at any node that's\r\n   * descended from ui_base.UIBase\r\n   **/\r\n  _forEachChildWidget(cb, thisvar) {\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        if (thisvar !== undefined) {\r\n          cb.call(thisvar, n);\r\n        } else {\r\n          cb(n);\r\n        }\r\n      } else {\r\n        for (let n2 of n.childNodes) {\r\n          rec(n2);\r\n        }\r\n\r\n        if (n.shadow !== undefined) {\r\n          for (let n2 of n.shadow.childNodes) {\r\n            rec(n2);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    if (this.shadow) {\r\n      for (let n of this.shadow.childNodes) {\r\n        rec(n);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkInit() {\r\n    return this._init();\r\n  }\r\n\r\n  _init() {\r\n    if (this._init_done) {\r\n      return false;\r\n    }\r\n\r\n    this._init_done = true;\r\n    this.init();\r\n\r\n    return true;\r\n  }\r\n\r\n  getWinWidth() {\r\n    return window.innerWidth;\r\n  }\r\n\r\n  getWinHeight() {\r\n    return window.innerHeight;\r\n  }\r\n\r\n  calcZ() {\r\n    let p = this;\r\n    let n = this;\r\n\r\n    while (n) {\r\n      if (n.style && n.style[\"z-index\"]) {\r\n        let z = parseFloat(n.style[\"z-index\"]);\r\n        return z;\r\n      }\r\n\r\n      n = n.parentNode;\r\n\r\n      if (!n) {\r\n        n = p = p.parentWidget;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  pickElement(x, y, args = {}, marginy = 0, nodeclass = UIBase, excluded_classes = undefined) {\r\n    let clip;\r\n    let mouseEvent;\r\n    let isMouseMove, isMouseDown;\r\n\r\n    if (typeof args === \"object\") {\r\n      nodeclass = args.nodeclass || UIBase;\r\n      excluded_classes = args.excluded_classes;\r\n      clip = args.clip;\r\n      mouseEvent = args.mouseEvent;\r\n    } else {\r\n      args = {\r\n        nodeclass       : nodeclass || UIBase,\r\n        excluded_classes: excluded_classes,\r\n        clip            : clip\r\n      }\r\n    }\r\n\r\n    if (mouseEvent) {\r\n      isMouseMove = mouseEvent.type === \"mousemove\" || mouseEvent.type === \"touchmove\" || mouseEvent.type === \"pointermove\";\r\n      isMouseDown = mouseEvent.buttons || (mouseEvent.touches && mouseEvent.touches.length > 0);\r\n    }\r\n\r\n    x -= window.scrollX;\r\n    y -= window.scrollY;\r\n\r\n    let elem = document.elementFromPoint(x, y);\r\n\r\n    if (!elem) {\r\n      return;\r\n    }\r\n\r\n    let path = [elem];\r\n    let lastelem = elem;\r\n    let i = 0;\r\n\r\n    while (elem && elem.shadow) {\r\n      if (i++ > 1000) {\r\n        console.error(\"Infinite loop error\");\r\n        break;\r\n      }\r\n\r\n      elem = elem.shadow.elementFromPoint(x, y);\r\n\r\n      if (elem === lastelem) {\r\n        break;\r\n      }\r\n\r\n      if (elem) {\r\n        path.push(elem);\r\n      }\r\n\r\n      lastelem = elem;\r\n    }\r\n\r\n    path.reverse();\r\n\r\n    //console.warn(path);\r\n\r\n    for (let i = 0; i < path.length; i++) {\r\n      let node = path[i];\r\n      let ok = node instanceof nodeclass;\r\n\r\n      if (excluded_classes) {\r\n        for (let cls of excluded_classes) {\r\n          ok = ok && !(node instanceof cls);\r\n        }\r\n      }\r\n\r\n      if (clip) {\r\n        let rect = node.getBoundingClientRect();\r\n        let clip2 = math.aabb_intersect_2d(clip.pos, clip.size, [rect.x, rect.y], [rect.width, rect.height]);\r\n\r\n        ok = ok && clip2;\r\n      }\r\n\r\n      if (ok) {\r\n        window.elem = node;\r\n        //console.log(node._id);\r\n        return node;\r\n      }\r\n    }\r\n  }\r\n\r\n  __updateDisable(val) {\r\n    if (!!val === !!this.__disabledState) {\r\n      return;\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    if (val && !this._disdata) {\r\n      let style = this.getDefault(\"disabled\") || this.getDefault(\"internalDisabled\") || {\r\n        \"background-color\": this.getDefault(\"DisabledBG\")\r\n      };\r\n\r\n      this._disdata = {\r\n        style   : {},\r\n        defaults: {}\r\n      };\r\n\r\n      for (let k in style) {\r\n        //save old style information\r\n        this._disdata.style[k] = this.style[k];\r\n        this._disdata.defaults[k] = this.default_overrides[k];\r\n\r\n        let v = style[k];\r\n\r\n        if (typeof v === \"object\" && v instanceof CSSFont) {\r\n          this.style[k] = style[k].genCSS();\r\n        } else if (typeof v === \"object\") {\r\n          continue;\r\n        } else {\r\n          this.style[k] = style[k];\r\n        }\r\n        this.default_overrides[k] = style[k];\r\n      }\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_disabled();\r\n    } else if (!val && this._disdata) {\r\n\r\n      //load old style information\r\n      for (let k in this._disdata.style) {\r\n        this.style[k] = this._disdata.style[k];\r\n      }\r\n\r\n      for (let k in this._disdata.defaults) {\r\n        let v = this._disdata.defaults[k];\r\n\r\n        if (v === undefined) {\r\n          delete this.default_overrides[k];\r\n        } else {\r\n          this.default_overrides[k] = v;\r\n        }\r\n      }\r\n\r\n      //this.background = this.style[\"background-color\"];\r\n      this._disdata = undefined;\r\n\r\n      this.__disabledState = !!val;\r\n      this.on_enabled();\r\n    }\r\n\r\n    this.__disabledState = !!val;\r\n\r\n    let visit = (n) => {\r\n      if (n instanceof UIBase) {\r\n        let changed = !!n.__disabledState;\r\n\r\n        /*\r\n        if (val) {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set + 1, 0);\r\n        } else {\r\n          n._parent_disabled_set = Math.max(n._parent_disabled_set - 1, 0);\r\n        }//*/\r\n\r\n        n.__updateDisable(n.disabled);\r\n\r\n        changed = changed !== !!n.__disabledState;\r\n        if (changed) {\r\n          n.update();\r\n          n.setCSS();\r\n        }\r\n      }\r\n    };\r\n\r\n    this._forEachChildWidget(visit);\r\n  }\r\n\r\n  on_disabled() {\r\n\r\n  }\r\n\r\n  on_enabled() {\r\n\r\n  }\r\n\r\n  pushModal(handlers = this, autoStopPropagation = true, pointerId = undefined, pointerElem = this) {\r\n    if (this._modaldata !== undefined) {\r\n      console.warn(\"UIBase.prototype.pushModal called when already in modal mode\");\r\n      this.popModal();\r\n    }\r\n\r\n    let _areaWrangler = contextWrangler.copy();\r\n\r\n    contextWrangler.copy(this.ctx);\r\n\r\n    function bindFunc(func) {\r\n      return function () {\r\n        _areaWrangler.copyTo(contextWrangler);\r\n\r\n        return func.apply(handlers, arguments);\r\n      }\r\n    }\r\n\r\n    let handlers2 = {};\r\n    for (let k in handlers) {\r\n      let func = handlers[k];\r\n\r\n      if (typeof func !== \"function\") {\r\n        continue;\r\n      }\r\n\r\n      handlers2[k] = bindFunc(func);\r\n    }\r\n    //this._modalstack.push(this.ctx);\r\n    //this.ctx = this.ctx.toLocked();\r\n\r\n    if (pointerId !== undefined && pointerElem) {\r\n      this._modaldata = pushPointerModal(handlers2, autoStopPropagation);\r\n    } else {\r\n      this._modaldata = pushModalLight(handlers2, autoStopPropagation);\r\n    }\r\n\r\n    return this._modaldata;\r\n  }\r\n\r\n  popModal() {\r\n    if (this._modaldata === undefined) {\r\n      console.warn(\"Invalid call to UIBase.prototype.popModal\");\r\n      return;\r\n    }\r\n\r\n    //this.ctx = this._modalstack.pop();\r\n    popModalLight(this._modaldata);\r\n    this._modaldata = undefined;\r\n  }\r\n\r\n  /** child classes can override this to prevent focus on flash*/\r\n  _flash_focus() {\r\n    this.focus();\r\n  }\r\n\r\n  flash(color, rect_element = this, timems = 355, autoFocus = true) {\r\n    if (typeof color != \"object\") {\r\n      color = css2color(color);\r\n    }\r\n    color = new Vector4(color);\r\n    let csscolor = color2css(color);\r\n\r\n    if (this._flashtimer !== undefined && this._flashcolor !== csscolor) {\r\n      window.setTimeout(() => {\r\n        this.flash(color, rect_element, timems, autoFocus);\r\n      }, 100);\r\n\r\n      return;\r\n    } else if (this._flashtimer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    //let rect = rect_element.getClientRects()[0];\r\n    let rect = rect_element.getBoundingClientRect();\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    //okay, dom apparently calls onchange() on .remove, so we have\r\n    //to put the timer code first to avoid loops\r\n    let timer;\r\n    let tick = 0;\r\n    let max = ~~(timems/20);\r\n\r\n    let x = rect.x, y = rect.y;\r\n\r\n    let cb = (e) => {\r\n      if (timer === undefined) {\r\n        return\r\n      }\r\n\r\n      let a = 1.0 - tick/max;\r\n      div.style[\"background-color\"] = color2css(color, a*a*0.5);\r\n\r\n      if (tick > max) {\r\n        window.clearInterval(timer);\r\n\r\n        this._flashtimer = undefined;\r\n        this._flashcolor = undefined;\r\n        timer = undefined;\r\n\r\n        div.remove();\r\n\r\n        if (autoFocus) {\r\n          this._flash_focus();\r\n        }\r\n      }\r\n\r\n      tick++;\r\n    };\r\n\r\n    window.setTimeout(cb, 5);\r\n    this._flashtimer = timer = window.setInterval(cb, 20);\r\n\r\n    let div = document.createElement(\"div\");\r\n\r\n    div.style[\"pointer-events\"] = \"none\";\r\n    div.tabIndex = undefined;\r\n    div.style[\"z-index\"] = \"900\";\r\n    div.style[\"display\"] = \"float\";\r\n    div.style[\"position\"] = UIBase.PositionKey;\r\n    div.style[\"margin\"] = \"0px\";\r\n    div.style[\"left\"] = x + \"px\";\r\n    div.style[\"top\"] = y + \"px\";\r\n\r\n    div.style[\"background-color\"] = color2css(color, 0.5);\r\n    div.style[\"width\"] = rect.width + \"px\";\r\n    div.style[\"height\"] = rect.height + \"px\";\r\n    div.setAttribute(\"class\", \"UIBaseFlash\");\r\n\r\n    let screen = this.getScreen();\r\n    if (screen !== undefined) {\r\n      screen._enterPopupSafe();\r\n    }\r\n\r\n    document.body.appendChild(div);\r\n    if (autoFocus) {\r\n      this._flash_focus();\r\n    }\r\n\r\n    this._flashcolor = csscolor;\r\n\r\n    if (screen !== undefined) {\r\n      screen._exitPopupSafe();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n  }\r\n\r\n  on_resize(newsize) {\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {};\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      ret.datapath = this.getAttribute(\"datapath\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n  }\r\n\r\n  getPathValue(ctx, path) {\r\n    try {\r\n      return ctx.api.getValue(ctx, path);\r\n    } catch (error) {\r\n      //report(\"data path error in ui for\" + path);\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  undoBreakPoint() {\r\n    this.pathUndoGen++;\r\n  }\r\n\r\n  setPathValueUndo(ctx, path, val) {\r\n    this.pathSocketUpdate(ctx, path);\r\n\r\n    let mass_set_path = this.getAttribute(\"mass_set_path\");\r\n    let rdef = ctx.api.resolvePath(ctx, path);\r\n    let prop = rdef.prop;\r\n\r\n    if (ctx.api.getValue(ctx, path) === val) {\r\n      return;\r\n    }\r\n\r\n    let toolstack = this.ctx.toolstack;\r\n    let head = toolstack.head;\r\n\r\n    let bad = head === undefined || !(head instanceof getDataPathToolOp());\r\n    bad = bad || head.hashThis() !== head.hash(mass_set_path, path, prop.type, this._id);\r\n    bad = bad || this.pathUndoGen !== this._lastPathUndoGen;\r\n\r\n    //if (head !== undefined && head instanceof getDataPathToolOp()) {\r\n    //console.log(\"===>\", bad, head.hashThis());\r\n    //console.log(\"    ->\", head.hash(mass_set_path, path, prop.type, this._id));\r\n    //}\r\n\r\n    if (!bad) {\r\n      toolstack.undo();\r\n      head.setValue(ctx, val, rdef.obj);\r\n      toolstack.redo();\r\n    } else {\r\n      this._lastPathUndoGen = this.pathUndoGen;\r\n\r\n      let toolop = getDataPathToolOp().create(ctx, path, val, this._id, mass_set_path);\r\n\r\n      /* getDataPathToolOp.create can return false in case of no-op paths. */\r\n      if (!toolop) {\r\n        return;\r\n      }\r\n\r\n      ctx.toolstack.execTool(this.ctx, toolop);\r\n      head = toolstack.head;\r\n    }\r\n\r\n    if (!head || head.hadError === true) {\r\n      throw new Error(\"toolpath error\");\r\n    }\r\n  }\r\n\r\n  loadNumConstraints(prop = undefined, dom = this, onModifiedCallback = undefined) {\r\n    let modified = false;\r\n\r\n    if (!prop) {\r\n      let path;\r\n\r\n      if (dom.hasAttribute(\"datapath\")) {\r\n        path = dom.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (path === undefined && this.hasAttribute(\"datapath\")) {\r\n        path = this.getAttribute(\"datapath\");\r\n      }\r\n\r\n      if (typeof path === \"string\") {\r\n        prop = this.getPathMeta(this.ctx, path);\r\n      }\r\n    }\r\n\r\n    let loadAttr = (propkey, domkey = key, thiskey = key) => {\r\n      let old = this[thiskey];\r\n\r\n      if (dom.hasAttribute(domkey)) {\r\n        this[thiskey] = parseFloat(dom.getAttribute(domkey));\r\n      } else if (prop) {\r\n        this[thiskey] = prop[propkey];\r\n      }\r\n\r\n      if (this[thiskey] !== old) {\r\n        modified = true;\r\n      }\r\n    }\r\n\r\n    for (let key of NumberConstraints) {\r\n      let thiskey = key, domkey = key;\r\n\r\n      if (key === \"range\") { //handled later\r\n        continue;\r\n      }\r\n\r\n      loadAttr(key, domkey, thiskey);\r\n    }\r\n\r\n    let oldmin = this.range[0];\r\n    let oldmax = this.range[1];\r\n\r\n    let range = prop ? prop.range : undefined;\r\n    if (range && !dom.hasAttribute(\"min\")) {\r\n      this.range[0] = range[0];\r\n    } else if (dom.hasAttribute(\"min\")) {\r\n      this.range[0] = parseFloat(dom.getAttribute(\"min\"));\r\n    }\r\n\r\n    if (range && !dom.hasAttribute(\"max\")) {\r\n      this.range[1] = range[1];\r\n    } else if (dom.hasAttribute(\"max\")) {\r\n      this.range[1] = parseFloat(dom.getAttribute(\"max\"));\r\n    }\r\n\r\n    if (this.range[0] !== oldmin || this.range[1] !== oldmax) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldint = this.isInt;\r\n\r\n    if (dom.getAttribute(\"integer\")) {\r\n      let val = dom.getAttribute(\"integer\");\r\n      val = (\"\" + val).toLowerCase();\r\n\r\n      //handles anonymouse <numslider-x integer> case\r\n      this.isInt = val === \"null\" || val === \"true\" || val === \"yes\" || val === \"1\";\r\n    } else if (prop && prop instanceof IntProperty) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (!this.isInt !== !oldint) {\r\n      modified = true;\r\n    }\r\n\r\n    let oldedit = this.editAsBaseUnit;\r\n\r\n    if (this.editAsBaseUnit === undefined) {\r\n      if (prop && (prop.flag & PropFlags.EDIT_AS_BASE_UNIT)) {\r\n        this.editAsBaseUnit = true;\r\n      } else {\r\n        this.editAsBaseUnit = false;\r\n      }\r\n    }\r\n\r\n    if (!this.editAsBaseUnit !== !oldedit) {\r\n      modified = true;\r\n    }\r\n\r\n    if (modified) {\r\n      this.setCSS();\r\n\r\n      if (onModifiedCallback) {\r\n        onModifiedCallback.call(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n    adds a method call to the event queue,\r\n    but only if that method (for this instance, as differentiated\r\n    by ._id) isn't there already.\r\n\r\n    also, method won't be ran until this.ctx exists\r\n  */\r\n\r\n  pushReportContext(key) {\r\n    if (this.ctx.api.pushReportContext) {\r\n      this.ctx.api.pushReportContext(key);\r\n    }\r\n  }\r\n\r\n  popReportContext() {\r\n    if (this.ctx.api.popReportContext)\r\n      this.ctx.api.popReportContext();\r\n  }\r\n\r\n  pathSocketUpdate(ctx, path) {\r\n    this.flagPropSocketUpdate(\"value\");\r\n    return this;\r\n  }\r\n\r\n  setPathValue(ctx, path, val) {\r\n    this.pathSocketUpdate(ctx, path);\r\n\r\n    if (this.useDataPathUndo) {\r\n      this.pushReportContext(this._reportCtxName);\r\n\r\n      try {\r\n        this.setPathValueUndo(ctx, path, val);\r\n      } catch (error) {\r\n        this.popReportContext();\r\n\r\n        if (!(error instanceof DataPathError)) {\r\n          throw error;\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.popReportContext();\r\n      return;\r\n    }\r\n\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      if (this.hasAttribute(\"mass_set_path\")) {\r\n        ctx.api.massSetProp(ctx, this.getAttribute(\"mass_set_path\"), val);\r\n        ctx.api.setValue(ctx, path, val);\r\n      } else {\r\n        ctx.api.setValue(ctx, path, val);\r\n      }\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (!(error instanceof DataPathError)) {\r\n        throw error;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.popReportContext();\r\n  }\r\n\r\n  getPathMeta(ctx, path) {\r\n    this.pushReportContext(this._reportCtxName);\r\n    let ret = ctx.api.resolvePath(ctx, path);\r\n    this.popReportContext();\r\n\r\n    return ret !== undefined ? ret.prop : undefined;\r\n  }\r\n\r\n  getPathDescription(ctx, path) {\r\n    let ret;\r\n    this.pushReportContext(this._reportCtxName);\r\n\r\n    try {\r\n      ret = ctx.api.getDescription(ctx, path);\r\n    } catch (error) {\r\n      this.popReportContext();\r\n\r\n      if (error instanceof DataPathError) {\r\n        //console.warn(\"Invalid data path '\" + path + \"'\");\r\n        return undefined;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    this.popReportContext();\r\n    return ret;\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.ctx !== undefined)\r\n      return this.ctx.screen;\r\n  }\r\n\r\n  isDead() {\r\n    return !this.isConnected;\r\n    let p = this, lastp = this;\r\n\r\n    function find(c, n) {\r\n      for (let n2 of c) {\r\n        if (n2 === n) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n\r\n    while (p) {\r\n      lastp = p;\r\n\r\n      let parent = p.parentWidget;\r\n      if (!parent) {\r\n        parent = p.parentElement ? p.parentElement : p.parentNode;\r\n      }\r\n\r\n      if (parent && p && !find(parent.childNodes, p)) {\r\n        if (parent.shadow !== undefined && !find(parent.shadow.childNodes)) {\r\n          return true;\r\n        }\r\n      }\r\n      p = parent;\r\n\r\n      if (p === document.body) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  doOnce(func, timeout = undefined) {\r\n    if (func._doOnce === undefined) {\r\n      func._doOnce_reqs = new Set();\r\n\r\n      func._doOnce = function (thisvar, trace) {\r\n        if (func._doOnce_reqs.has(thisvar._id)) {\r\n          return;\r\n        }\r\n\r\n        func._doOnce_reqs.add(thisvar._id);\r\n\r\n        function f() {\r\n          if (thisvar.isDead()) {\r\n            func._doOnce_reqs.delete(thisvar._id);\r\n\r\n            if (func === thisvar._init || !cconst.DEBUG.doOnce) {\r\n              return;\r\n            }\r\n\r\n            console.warn(\"Ignoring doOnce call for dead element\", thisvar._id, func, trace);\r\n            return;\r\n          }\r\n\r\n          if (!thisvar.ctx) {\r\n            if (cconst.DEBUG.doOnce) {\r\n              console.warn(\"doOnce call is waiting for context...\", thisvar._id, func);\r\n            }\r\n\r\n            internalSetTimeout(f, 0);\r\n            return;\r\n          }\r\n\r\n          func._doOnce_reqs.delete(thisvar._id);\r\n          func.call(thisvar);\r\n        };\r\n\r\n        internalSetTimeout(f, timeout);\r\n      }\r\n    }\r\n\r\n    let trace = new Error().stack;\r\n    func._doOnce(this, trace);\r\n  }\r\n\r\n  float(x = 0, y = 0, zindex = undefined, positionKey = UIBase.PositionKey) {\r\n    this.style.position = positionKey;\r\n\r\n    this.style.left = x + \"px\";\r\n    this.style.top = y + \"px\";\r\n\r\n    if (zindex !== undefined) {\r\n      this.style[\"z-index\"] = zindex\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  _ensureChildrenCtx() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.parentWidget = this;\r\n\r\n      if (n.ctx === undefined) {\r\n        n.ctx = ctx;\r\n      }\r\n\r\n      n._ensureChildrenCtx(ctx);\r\n    });\r\n  }\r\n\r\n  checkThemeUpdate() {\r\n    if (!cconst.enableThemeAutoUpdate) {\r\n      return false;\r\n    }\r\n\r\n    if (_themeUpdateKey !== this._last_theme_update_key) {\r\n      this._last_theme_update_key = _themeUpdateKey;\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  abortToolTips(delayMs = 500) {\r\n    if (this._has_own_tooltips) {\r\n      this._has_own_tooltips.stop_timer();\r\n    }\r\n\r\n    if (this._tooltip_ref) {\r\n      this._tooltip_ref.remove();\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = util.time_ms() + delayMs;\r\n\r\n    return this;\r\n  }\r\n\r\n  updateToolTipHandlers() {\r\n    if (!this._useNativeToolTips_set && !cconst.useNativeToolTips !== !this._useNativeToolTips) {\r\n      this._useNativeToolTips = cconst.useNativeToolTips;\r\n    }\r\n\r\n    if (!!this.useNativeToolTips === !this._has_own_tooltips) {\r\n      return;\r\n    }\r\n\r\n    if (!this.useNativeToolTips) {\r\n      let state = this._has_own_tooltips = {\r\n        start_timer : (e) => {\r\n          this._tooltip_timer = util.time_ms();\r\n          //console.warn(this._id, \"tooltip timer start\", e.type);\r\n        },\r\n        stop_timer  : (e) => {\r\n          //console.warn(this._id, \"tooltip timer end\", util.time_ms()-this._tooltip_timer, e.type);\r\n          this._tooltip_timer = undefined;\r\n        },\r\n        reset_timer : (e) => {\r\n          //console.warn(this._id, \"tooltip timer reset\", util.time_ms()-this._tooltip_timer, e.type);\r\n          if (this._tooltip_timer !== undefined) {\r\n            this._tooltip_timer = util.time_ms();\r\n          }\r\n        },\r\n        start_events: [\r\n          \"mouseover\"\r\n        ],\r\n        reset_events: [\r\n          \"mousemove\", \"mousedown\", \"mouseup\",\r\n          \"touchstart\", \"touchend\", \"keydown\", \"focus\"\r\n        ],\r\n        stop_events : [\r\n          \"mouseleave\", \"blur\", \"mouseout\"\r\n        ],\r\n        handlers    : {}\r\n      }\r\n\r\n      let bind_handler = (type, etype) => {\r\n        let handler = (e) => {\r\n          if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n            this._tooltip_timer = undefined;\r\n            return;\r\n          }\r\n\r\n          state[type](e);\r\n        };\r\n\r\n        if (etype in state.handlers) {\r\n          console.error(type, \"is in handlers already\");\r\n          return;\r\n        }\r\n\r\n        state.handlers[etype] = handler;\r\n        return handler;\r\n      }\r\n\r\n      let i = 0;\r\n      let lists = [state.start_events, state.stop_events, state.reset_events];\r\n\r\n      for (let type of [\"start_timer\", \"stop_timer\", \"reset_timer\"]) {\r\n        for (let etype of lists[i]) {\r\n          this.addEventListener(etype, bind_handler(type, etype), {passive: true});\r\n        }\r\n\r\n        i++;\r\n      }\r\n    } else {\r\n      console.warn(this.id, \"removing tooltip handlers\");\r\n      let state = this._has_own_tooltips;\r\n\r\n      for (let k in this.state.handlers) {\r\n        let handler = this.state.handlers[k];\r\n        this.removeEventListener(k, handler);\r\n      }\r\n\r\n      this._has_own_tooltips = undefined;\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateToolTips() {\r\n    if (this._description_final === undefined || this._description_final === null ||\r\n      this._description_final.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ctx || !this.ctx.screen) {\r\n      return;\r\n    }\r\n\r\n    this.updateToolTipHandlers();\r\n\r\n    if (this.useNativeToolTips || this._tooltip_timer === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._tool_tip_abort_delay !== undefined && util.time_ms() < this._tool_tip_abort_delay) {\r\n      return;\r\n    }\r\n\r\n    this._tool_tip_abort_delay = undefined;\r\n\r\n    let screen = this.ctx.screen;\r\n\r\n    const timelimit = 500;\r\n    let ok = util.time_ms() - this._tooltip_timer > timelimit;\r\n\r\n    let x = screen.mpos[0], y = screen.mpos[1];\r\n\r\n    let r = this.getClientRects();\r\n    r = r ? r[0] : r;\r\n\r\n    if (!r) {\r\n      ok = false;\r\n    } else {\r\n      ok = ok && x >= r.x && x < r.x + r.width;\r\n      ok = ok && y >= r.y && y < r.y + r.height;\r\n    }\r\n\r\n\r\n    //console.log(r);\r\n    if (r) {\r\n      //console.warn(this._id, \"possible tooltip\", x, y, r.x-3, r.y-3, r.width, r.height);\r\n    }\r\n\r\n    ok = ok && !haveModal();\r\n    ok = ok && screen.pickElement(x, y) === this;\r\n    ok = ok && this._description_final;\r\n\r\n    if (ok) {\r\n      //console.warn(\"Showing tooltop\", this.id);\r\n      this._tooltip_ref = _ToolTip.show(this._description_final, this.ctx.screen, x, y);\r\n    } else {\r\n      if (this._tooltip_ref) {\r\n        this._tooltip_ref.remove();\r\n      }\r\n\r\n      this._tooltip_ref = undefined;\r\n    }\r\n\r\n    //console.warn(this._id, \"tooltip timer end\");\r\n    if (util.time_ms() - this._tooltip_timer > timelimit) {\r\n      this._tooltip_timer = undefined;\r\n    }\r\n  }\r\n\r\n  updateEventGraph() {\r\n    if (!this.isConnected) {\r\n      this.#reflagGraph = true;\r\n    } else if (this.#reflagGraph) {\r\n      this.#reflagGraph = false;\r\n\r\n      for (let [k, sock] of Object.entries(this.graphNode.inputs)) {\r\n        sock.flagUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  //called regularly\r\n  update() {\r\n    this.updateToolTips();\r\n    this.updateEventGraph();\r\n\r\n    if (this.ctx && this._description === undefined && this.getAttribute(\"datapath\")) {\r\n      let d = this.getPathDescription(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      this.description = d;\r\n    }\r\n\r\n    if (!this._init_done) {\r\n      this._init();\r\n    }\r\n\r\n    if (this._init_done && !this.constructor.define().subclassChecksTheme) {\r\n      if (this.checkThemeUpdate()) {\r\n        console.log(\"theme update!\");\r\n\r\n        this.setCSS();\r\n      }\r\n    }\r\n  }\r\n\r\n  onadd() {\r\n    //if (this.parentWidget !== undefined) {\r\n    //  this._useDataPathUndo = this.parentWidget._useDataPathUndo;\r\n    //}\r\n\r\n    if (!this._init_done) {\r\n      this.doOnce(this._init);\r\n    }\r\n\r\n    if (this.tabIndex >= 0) {\r\n      this.regenTabOrder();\r\n    }\r\n  }\r\n\r\n  getZoom() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getZoom();\r\n    }\r\n\r\n    return 1.0;\r\n  }\r\n\r\n  /**try to use this method\r\n\r\n   scaling ratio (e.g. for high-resolution displays)\r\n   for zoom ratio use getZoom()\r\n   */\r\n  getDPI() {\r\n    if (this.parentWidget !== undefined) {\r\n      return this.parentWidget.getDPI();\r\n    }\r\n\r\n    return UIBase.getDPI();\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   */\r\n  saveData() {\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * for saving ui state.\r\n   * see saveUIData() export\r\n   *\r\n   * should fail gracefully.\r\n   *\r\n   * also, it doesn't rebuild the object graph,\r\n   * it patches it; for true serialization use\r\n   * the toJSON/loadJSON or STRUCT interfaces.\r\n   */\r\n  loadData(obj) {\r\n    return this;\r\n  }\r\n\r\n  overrideDefault(key, val, localOnly = false) {\r\n    this.my_default_overrides[key] = val;\r\n\r\n    if (!localOnly) {\r\n      this.default_overrides[key] = val;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  overrideClass(style) {\r\n    this._override_class = style;\r\n  }\r\n\r\n  overrideClassDefault(style, key, val) {\r\n    if (!(style in this.class_default_overrides)) {\r\n      this.class_default_overrides[style] = {};\r\n    }\r\n\r\n    this.class_default_overrides[style][key] = val;\r\n  }\r\n\r\n  _doMobileDefault(key, val, obj) {\r\n    if (!util.isMobile())\r\n      return val;\r\n\r\n    const mobilekey = key + \"_mobile\";\r\n    if (obj && mobilekey in obj) {\r\n      return obj[mobilekey];\r\n    }\r\n\r\n    key = key.toLowerCase();\r\n    let ok = false;\r\n\r\n    for (let re of _mobile_theme_patterns) {\r\n      if (key.search(re) >= 0) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok && theme.base.mobileSizeMultiplier) {\r\n      val *= theme.base.mobileSizeMultiplier;\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  hasDefault(key) {\r\n    let p = this;\r\n\r\n    while (p) {\r\n      if (key in p.default_overrides) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.hasClassDefault(key);\r\n  }\r\n\r\n  hasSubDefault(key, subkey) {\r\n    return this._hasSubDefault(...arguments, theme)\r\n      || this._themeOverride && this._hasSubDefault(...arguments, this._themeOverride);\r\n  }\r\n\r\n  _hasSubDefault(key, subkey) {\r\n    let style = this.getStyleClass();\r\n\r\n    let obj = this.getDefault(key);\r\n\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  hasClassSubDefault(key, subkey, inherit = true) {\r\n    return this._hasClassSubDefault(key, subkey, inherit, undefined, theme) ||\r\n      this._themeOverride && this._hasClassSubDefault(key, subkey, inherit, undefined, this._themeOverride);\r\n  }\r\n\r\n  _hasClassSubDefault(key, subkey, inherit = true, style = this.getStyleClass(), themeDef) {\r\n    let th = themeDef;\r\n    th = th[style];\r\n\r\n    if (inherit) {\r\n      if (this._hasClassSubDefault(key, subkey, false, themeDef)) {\r\n        return true;\r\n      }\r\n\r\n      let ret = false;\r\n      let def = this.constructor.define();\r\n\r\n      if (def.parentStyle) {\r\n        ret |= this._hasClassSubDefault(key, subkey, false, def.parentStyle, themeDef);\r\n      }\r\n      ret |= this._hasClassSubDefault(key, subkey, false, \"base\", themeDef);\r\n      return ret;\r\n    }\r\n\r\n    if (!th) {\r\n      return false;\r\n    }\r\n\r\n    let obj = th[key];\r\n    if (!obj || typeof obj !== \"object\") {\r\n      return false;\r\n    }\r\n\r\n    return subkey in obj;\r\n  }\r\n\r\n  /** get a sub style from a theme style class.\r\n   *  note that if key is falsy then it just forwards to this.getDefault directly*/\r\n  getSubDefault(key, subkey, backupkey = subkey, defaultval = undefined, inherit = true) {\r\n    /* Check if client code manually overrode a theme key for this instance. */\r\n    if (subkey && subkey in this.my_default_overrides) {\r\n      //return this.getDefault(subkey, undefined, defaultval);\r\n    }\r\n\r\n    if (!key) {\r\n      return this.getDefault(subkey, undefined, defaultval, inherit);\r\n    }\r\n\r\n    let style = this.getDefault(key, undefined, undefined, inherit);\r\n\r\n    if (!style || typeof style !== \"object\" || !(subkey in style)) {\r\n      if (defaultval !== undefined) {\r\n        return defaultval;\r\n      } else if (backupkey) {\r\n        return this.getDefault(backupkey, undefined, undefined, inherit);\r\n      }\r\n    } else {\r\n      return style[subkey];\r\n    }\r\n  }\r\n\r\n  getDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let ret = this.getDefault_intern(key, checkForMobile, defaultval, inherit);\r\n\r\n    //convert pixel units straight to numbers\r\n    if (typeof ret === \"string\" && ret.trim().toLowerCase().endsWith(\"px\")) {\r\n      let s = ret.trim().toLowerCase();\r\n      s = s.slice(0, s.length - 2).trim();\r\n\r\n      let f = parseFloat(s);\r\n      if (!isNaN(f) && isFinite(f)) {\r\n        return f;\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getDefault_intern(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    if (this.my_default_overrides[key] !== undefined) {\r\n      let v = this.my_default_overrides[key];\r\n      return checkForMobile ? this._doMobileDefault(key, v, this.my_default_overrides) : v;\r\n    }\r\n\r\n    let p = this;\r\n    while (p) {\r\n      if (p.default_overrides[key] !== undefined) {\r\n        let v = p.default_overrides[key];\r\n        checkForMobile ? this._doMobileDefault(key, v, p.default_overrides) : v;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return this.getClassDefault(key, checkForMobile, defaultval, inherit);\r\n  }\r\n\r\n  getStyleClass() {\r\n    if (this._override_class !== undefined) {\r\n      return this._override_class;\r\n    }\r\n\r\n    let p = this.constructor, lastp = undefined;\r\n\r\n    while (p && p !== lastp && p !== UIBase && p !== Object) {\r\n      let def = p.define();\r\n\r\n      if (def.style) {\r\n        return def.style;\r\n      }\r\n\r\n      if (!p.prototype || !p.prototype.__proto__)\r\n        break;\r\n\r\n      p = p.prototype.__proto__.constructor;\r\n    }\r\n\r\n    return \"base\";\r\n  }\r\n\r\n  hasClassDefault(key) {\r\n    let style = this.getStyleClass();\r\n\r\n    let p = this;\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        return true;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    let th = this._themeOverride;\r\n\r\n    if (th && style in th && key in th[style]) {\r\n      return true;\r\n    }\r\n\r\n    if (style in theme && key in theme[style]) {\r\n      return true;\r\n    }\r\n\r\n    return key in theme.base;\r\n  }\r\n\r\n  getClassDefault(key, checkForMobile = true, defaultval = undefined, inherit = true) {\r\n    let style = this.getStyleClass();\r\n\r\n    if (style === \"none\") {\r\n      return undefined;\r\n    }\r\n\r\n    let themeobj;\r\n    let val;\r\n    let p = this;\r\n\r\n    while (p) {\r\n      let def = p.class_default_overrides[style];\r\n\r\n      if (def && (key in def)) {\r\n        themeobj = def;\r\n        val = def[key];\r\n        break;\r\n      }\r\n\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    if (val === undefined && style in theme && !(key in theme[style]) && !(key in theme.base)) {\r\n      if (window.DEBUG.theme) {\r\n        report(\"Missing theme key \", key, \"for\", style);\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let th = !i ? this._themeOverride : theme;\r\n\r\n      if (!th) {\r\n        continue;\r\n      }\r\n\r\n      if (val === undefined && style in th && key in th[style]) {\r\n        themeobj = th[style];\r\n        val = th[style][key];\r\n      } else if (defaultval !== undefined) {\r\n        themeobj = undefined;\r\n        val = defaultval;\r\n      } else if (val === undefined && inherit) {\r\n        let def = this.constructor.define();\r\n\r\n        if (def.parentStyle && key in th[def.parentStyle]) {\r\n          val = th[def.parentStyle][key];\r\n          themeobj = th[def.parentStyle];\r\n        } else {\r\n          val = th.base[key];\r\n          themeobj = th.base;\r\n        }\r\n      }\r\n    }\r\n\r\n    return checkForMobile ? this._doMobileDefault(key, val, themeobj) : val;\r\n  }\r\n\r\n  overrideTheme(theme) {\r\n    this._themeOverride = theme;\r\n\r\n    this._forEachChildWidget((child) => {\r\n      child.overrideTheme(theme);\r\n    });\r\n\r\n    if (this.ctx) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  getStyle() {\r\n    console.warn(\"deprecated call to UIBase.getStyle\");\r\n    return this.getStyleClass();\r\n  }\r\n\r\n  /** returns a new Animator instance\r\n   *\r\n   * example:\r\n   *\r\n   * container.animate().goto(\"style.width\", 500, 100, \"ease\");\r\n   * */\r\n  animate(_extra_handlers = {}, domAnimateOptions=undefined) {\r\n    /* User is providing DOM animation data. */\r\n    if (Array.isArray(_extra_handlers)) {\r\n      return super.animate(_extra_handlers, domAnimateOptions)\r\n    }\r\n\r\n    let transform = new DOMMatrix(this.style[\"transform\"]);\r\n\r\n    let update_trans = () => {\r\n      let t = transform;\r\n      let css = \"matrix(\" + t.a + \",\" + t.b + \",\" + t.c + \",\" + t.d + \",\" + t.e + \",\" + t.f + \")\";\r\n      this.style[\"transform\"] = css;\r\n    }\r\n\r\n    let handlers = {\r\n      background_get() {\r\n        return css2color(this.background);\r\n      },\r\n\r\n      background_set(c) {\r\n        if (typeof c !== \"string\") {\r\n          c = color2css(c);\r\n        }\r\n        this.background = c;\r\n      },\r\n\r\n      dx_get() {\r\n        return transform.m41;\r\n      },\r\n      dx_set(x) {\r\n        transform.m41 = x;\r\n        update_trans();\r\n      },\r\n\r\n      dy_get() {\r\n        return transform.m42;\r\n      },\r\n      dy_set(x) {\r\n        transform.m42 = x;\r\n        update_trans();\r\n      }\r\n    }\r\n\r\n    let pixkeys = [\"width\", \"height\", \"left\", \"top\", \"right\", \"bottom\", \"border-radius\",\r\n                   \"border-width\", \"margin\", \"padding\", \"margin-left\", \"margin-right\",\r\n                   \"margin-top\", \"margin-bottom\", \"padding-left\", \"padding-right\", \"padding-bottom\",\r\n                   \"padding-top\"];\r\n    handlers = Object.assign(handlers, _extra_handlers);\r\n\r\n    let makePixHandler = (k, k2) => {\r\n      handlers[k2 + \"_get\"] = () => {\r\n        let s = this.style[k];\r\n\r\n        if (s.endsWith(\"px\")) {\r\n          return parsepx(s);\r\n        } else {\r\n          return 0.0;\r\n        }\r\n      }\r\n\r\n      handlers[k2 + \"_set\"] = (val) => {\r\n        this.style[k] = val + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of pixkeys) {\r\n      if (!(k in handlers)) {\r\n        makePixHandler(k, `style.${k}`);\r\n        makePixHandler(k, `style[\"${k}\"]`);\r\n        makePixHandler(k, `style['${k}']`);\r\n      }\r\n    }\r\n\r\n    let handler = {\r\n      get: (target, key, receiver) => {\r\n        console.log(key, handlers[key + \"_get\"], handlers);\r\n\r\n        if ((key + \"_get\") in handlers) {\r\n          return handlers[key + \"_get\"].call(target);\r\n        } else {\r\n          return target[key];\r\n        }\r\n      },\r\n      set: (target, key, val, receiver) => {\r\n        console.log(key);\r\n\r\n        if ((key + \"_set\") in handlers) {\r\n          handlers[key + \"_set\"].call(target, val);\r\n        } else {\r\n          target[key] = val;\r\n        }\r\n\r\n        return true;\r\n      }\r\n    }\r\n\r\n    let proxy = new Proxy(this, handler);\r\n    let anim = new Animator(proxy);\r\n\r\n    anim.onend = () => {\r\n      this._active_animations.remove(anim);\r\n    }\r\n\r\n    this._active_animations.push(anim);\r\n    return anim;\r\n  }\r\n\r\n  abortAnimations() {\r\n    for (let anim of util.list(this._active_animations)) {\r\n      anim.end();\r\n    }\r\n\r\n    this._active_animations = [];\r\n  }\r\n}\r\n\r\nexport function drawRoundBox2(elem, options = {}) {\r\n  drawRoundBox(elem, options.canvas, options.g, options.width, options.height, options.r, options.op, options.color, options.margin, options.no_clear);\r\n}\r\n\r\n/**okay, I need to refactor this function,\r\n it needs to take x, y as well as width, height,\r\n and be usable for more use cases.*/\r\nexport function drawRoundBox(elem, canvas, g, width, height, r      = undefined,\r\n                             op = \"fill\", color = undefined, margin = undefined,\r\n                             no_clear                               = false) {\r\n  width = width === undefined ? canvas.width : width;\r\n  height = height === undefined ? canvas.height : height;\r\n  g.save();\r\n\r\n  let dpi = elem.getDPI();\r\n\r\n  r = r === undefined ? elem.getDefault(\"border-radius\") : r;\r\n\r\n  if (margin === undefined) {\r\n    margin = 1;\r\n  }\r\n\r\n  r *= dpi;\r\n  let r1 = r, r2 = r;\r\n\r\n  if (r > (height - margin*2)*0.5) {\r\n    r1 = (height - margin*2)*0.5;\r\n  }\r\n\r\n  if (r > (width - margin*2)*0.5) {\r\n    r2 = (width - margin*2)*0.5;\r\n  }\r\n\r\n  let bg = color;\r\n\r\n  if (bg === undefined && canvas._background !== undefined) {\r\n    bg = canvas._background;\r\n  } else if (bg === undefined) {\r\n    bg = elem.getDefault(\"background-color\");\r\n  }\r\n\r\n  if (op === \"fill\" && !no_clear) {\r\n    g.clearRect(0, 0, width, height);\r\n  }\r\n\r\n  g.fillStyle = bg;\r\n  //hackish!\r\n  g.strokeStyle = color === undefined ? elem.getDefault(\"border-color\") : color;\r\n\r\n  let w = width, h = height;\r\n\r\n  let th = Math.PI/4;\r\n  let th2 = Math.PI*0.75;\r\n\r\n  g.beginPath();\r\n\r\n  g.moveTo(margin, margin + r1);\r\n  g.lineTo(margin, h - r1 - margin);\r\n\r\n  g.quadraticCurveTo(margin, h - margin, margin + r2, h - margin);\r\n  g.lineTo(w - margin - r2, h - margin);\r\n\r\n  g.quadraticCurveTo(w - margin, h - margin, w - margin, h - margin - r1);\r\n  g.lineTo(w - margin, margin + r1);\r\n\r\n  g.quadraticCurveTo(w - margin, margin, w - margin - r2, margin);\r\n  g.lineTo(margin + r2, margin);\r\n\r\n  g.quadraticCurveTo(margin, margin, margin, margin + r1);\r\n  g.closePath();\r\n\r\n  if (op === \"clip\") {\r\n    g.clip();\r\n  } else if (op === \"fill\") {\r\n    g.fill();\r\n  } else {\r\n    g.stroke();\r\n  }\r\n\r\n  g.restore();\r\n};\r\n\r\nexport function _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n\r\n  font = elem.getDefault(font);\r\n\r\n  return font.genCSS(size);\r\n}\r\n\r\nexport function getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  return _getFont_new(elem, size, font = \"DefaultText\", do_dpi = true);\r\n}\r\n\r\n//size is optional, defaults to font's default size\r\nexport function _getFont(elem, size, font = \"DefaultText\", do_dpi = true) {\r\n  let dpi = elem.getDPI();\r\n\r\n  let font2 = elem.getDefault(font);\r\n  if (font2 !== undefined) {\r\n    //console.warn(\"New style font detected\", font2, font2.genCSS(size));\r\n    return _getFont_new(elem, size, font, do_dpi);\r\n  }\r\n\r\n  throw new Error(\"unknown font \" + font);\r\n}\r\n\r\nexport function _ensureFont(elem, canvas, g, size) {\r\n  if (canvas.font) {\r\n    g.font = canvas.font;\r\n  } else {\r\n    let font = elem.getDefault(\"DefaultText\");\r\n    g.font = font.genCSS(size);\r\n  }\r\n}\r\n\r\nlet _mc;\r\n\r\nfunction get_measure_canvas() {\r\n  if (_mc !== undefined) {\r\n    return _mc;\r\n  }\r\n\r\n  _mc = document.createElement(\"canvas\");\r\n  _mc.width = 256;\r\n  _mc.height = 256;\r\n  _mc.g = _mc.getContext(\"2d\");\r\n\r\n  return _mc;\r\n}\r\n\r\nexport function measureTextBlock(elem, text, canvas                    = undefined,\r\n                                 g = undefined, size = undefined, font = undefined) {\r\n  let lines = text.split(\"\\n\");\r\n\r\n  let ret = {\r\n    width : 0,\r\n    height: 0\r\n  };\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && typeof font === \"object\") {\r\n      size = font.size;\r\n    }\r\n\r\n    if (size === undefined) {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  for (let line of lines) {\r\n    let m = measureText(elem, line, canvas, g, size, font);\r\n\r\n    ret.width = Math.max(ret.width, m.width);\r\n    let h = m.height !== undefined ? m.height : size*1.25;\r\n\r\n    ret.height += h;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function measureText(elem, text, canvas                    = undefined,\r\n                            g = undefined, size = undefined, font = undefined) {\r\n  if (typeof canvas === \"object\" && canvas !== null && !(canvas instanceof HTMLCanvasElement) && canvas.tagName !== \"CANVAS\") {\r\n    let args = canvas;\r\n\r\n    canvas = args.canvas;\r\n    g = args.g;\r\n    size = args.size;\r\n    font = args.font;\r\n\r\n  }\r\n\r\n  if (g === undefined) {\r\n    canvas = get_measure_canvas();\r\n    g = canvas.g;\r\n  }\r\n\r\n  if (font !== undefined) {\r\n    if (typeof font === \"object\" && font instanceof CSSFont) {\r\n      font = font.genCSS(size);\r\n    }\r\n\r\n    g.font = font;\r\n  } else {\r\n    _ensureFont(elem, canvas, g, size);\r\n  }\r\n\r\n  let ret = g.measureText(text);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n//export function drawText(elem, x, y, text, canvas, g, color=undefined, size=undefined, font=undefined) {\r\nexport function drawText(elem, x, y, text, args = {}) {\r\n  let canvas = args.canvas, g = args.g, color = args.color, font = args.font;\r\n  let size = args.size;\r\n\r\n  if (size === undefined) {\r\n    if (font !== undefined && font instanceof CSSFont) {\r\n      size = font.size;\r\n    } else {\r\n      size = elem.getDefault(\"DefaultText\").size;\r\n    }\r\n  }\r\n\r\n  size *= UIBase.getDPI();\r\n\r\n\r\n  if (color === undefined) {\r\n    if (font && font.color) {\r\n      color = font.color;\r\n    } else {\r\n      color = elem.getDefault(\"DefaultText\").color;\r\n    }\r\n  }\r\n\r\n  if (font === undefined) {\r\n    _ensureFont(elem, canvas, g, size);\r\n  } else if (typeof font === \"object\" && font instanceof CSSFont) {\r\n    g.font = font = font.genCSS(size);\r\n  } else if (font) {\r\n    g.font = font;\r\n  }\r\n\r\n  if (typeof color === \"object\") {\r\n    color = color2css(color);\r\n  }\r\n\r\n\r\n  g.fillStyle = color;\r\n  g.fillText(text, x + 0.5, y + 0.5);\r\n\r\n  if (size !== undefined) {\r\n    //clear custom font for next time\r\n    g.font = undefined;\r\n  }\r\n}\r\n\r\nlet PIDX = 0, PSHADOW = 1, PTOT = 2;\r\n\r\n/**\r\n\r\n Saves UI layout data, like panel layouts, active tabs, etc.\r\n Uses the UIBase.prototype.[save/load]Data interface.\r\n\r\n Note that this is error-tolerant.\r\n */\r\nexport function saveUIData(node, key) {\r\n  if (key === undefined) {\r\n    throw new Error(\"ui_base.saveUIData(): key cannot be undefined\");\r\n  }\r\n\r\n  let paths = [];\r\n\r\n  let rec = (n, path, ni, is_shadow) => {\r\n    path = path.slice(0, path.length); //copy path\r\n\r\n    let pi = path.length;\r\n    for (let i = 0; i < PTOT; i++) {\r\n      path.push(undefined);\r\n    }\r\n\r\n    path[pi] = ni;\r\n    path[pi + 1] = is_shadow ? 1 : 0;\r\n\r\n    if (n instanceof UIBase) {\r\n      let path2 = path.slice(0, path.length);\r\n      let data = n.saveData();\r\n\r\n      let bad = !data;\r\n      bad = bad || (typeof data === \"object\" && Object.keys(data).length === 0);\r\n\r\n      if (!bad) {\r\n        path2.push(data);\r\n\r\n        if (path2[pi + 2]) {\r\n          paths.push(path2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < n.childNodes.length; i++) {\r\n      let n2 = n.childNodes[i];\r\n\r\n      rec(n2, path, i, false);\r\n    }\r\n\r\n    let shadow = n.shadow;\r\n\r\n    if (!shadow)\r\n      return;\r\n\r\n    for (let i = 0; i < shadow.childNodes.length; i++) {\r\n      let n2 = shadow.childNodes[i];\r\n\r\n      rec(n2, path, i, true);\r\n    }\r\n  }\r\n\r\n  rec(node, [], 0, false);\r\n\r\n  return JSON.stringify({\r\n    key        : key,\r\n    paths      : paths,\r\n    _ui_version: 1\r\n  });\r\n}\r\n\r\nwindow._saveUIData = saveUIData;\r\n\r\nexport function loadUIData(node, buf) {\r\n  if (buf === undefined || buf === null) {\r\n    return;\r\n  }\r\n\r\n  let obj = JSON.parse(buf);\r\n  let key = buf.key;\r\n\r\n  for (let path of obj.paths) {\r\n    let n = node;\r\n\r\n    let data = path[path.length - 1];\r\n    path = path.slice(2, path.length - 1); //in case some api doesn't want me calling .pop()\r\n\r\n    for (let pi = 0; pi < path.length; pi += PTOT) {\r\n      let ni = path[pi], shadow = path[pi + 1];\r\n\r\n      let list;\r\n\r\n      if (shadow) {\r\n        list = n.shadow;\r\n\r\n        if (list) {\r\n          list = list.childNodes;\r\n        }\r\n      } else {\r\n        list = n.childNodes;\r\n      }\r\n\r\n      if (list === undefined || list[ni] === undefined) {\r\n        //console.log(\"failed to load a ui data block\", path);\r\n        n = undefined;\r\n        break;\r\n      }\r\n\r\n      n = list[ni];\r\n    }\r\n\r\n    if (n !== undefined && n instanceof UIBase) {\r\n      n._init(); //ensure init's been called, _init will check if it has\r\n      n.loadData(data);\r\n\r\n      //console.log(n, path, data);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.PositionKey = \"fixed\";\r\n\r\nwindow._loadUIData = loadUIData;\r\n\r\n//avoid explicit circular references\r\naspect._setUIBase(UIBase);\r\n//ui_save.setUIBase(UIBase);\r\n", "\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport cconst from '../config/const.js';\r\nimport {_themeUpdateKey, CSSFont} from \"../core/ui_base.js\";\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\ncconst.DEBUG.buttonEvents = true;\r\n\r\nexport class ButtonEventBase extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._auto_depress = true;\r\n    this._highlight = false;\r\n    this._pressed = false;\r\n  }\r\n\r\n  bindEvents() {\r\n    let press_gen = 0;\r\n    let depress;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (!this.modalRunning) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_pointerdown(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointerup(e) {\r\n            this.end(e);\r\n          },\r\n\r\n          on_pointercancel(e) {\r\n            console.warn(\"Pointer cancel in button\");\r\n            this2.popModal();\r\n          },\r\n\r\n          on_keydown(e) {\r\n            switch (e.keyCode) {\r\n              case keymap[\"Enter\"]:\r\n              case keymap[\"Escape\"]:\r\n              case keymap[\"Space\"]:\r\n                this.end();\r\n                break;\r\n            }\r\n          },\r\n\r\n          end(e) {\r\n            if (!this2.modalRunning) {\r\n              return;\r\n            }\r\n\r\n            this2.popModal();\r\n            depress(e);\r\n          }\r\n        }, undefined, e.pointerId);\r\n      }\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      if (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n\r\n      if (this.onclick && e && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"click\", () => {\r\n      this._pressed = false;\r\n      this._highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(e.keyCode);\r\n\r\n      switch (e.keyCode) {\r\n        case 27: //escape\r\n          this.blur();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n        case 32: //spacebar\r\n        case 13: //enter\r\n          this.click();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"blur\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 0;\r\n      this._redraw();\r\n    });\r\n  }\r\n\r\n  _redraw() {\r\n\r\n  }\r\n}\r\n\r\nexport class Button extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.label = document.createElement(\"span\");\r\n    this.label.innerText = \"button\";\r\n    this.shadow.appendChild(this.label);\r\n\r\n    this.label.style[\"pointer-events\"] = \"none\";\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._pressedTime = 0;\r\n    this._pressedTimeout = 100;\r\n\r\n    this._auto_depress = true;\r\n\r\n    this._last_name = undefined;\r\n    this._last_disabled = undefined;\r\n  }\r\n\r\n  get name() {\r\n    return \"\" + this.getAttribute(\"name\");\r\n  }\r\n\r\n  set name(val) {\r\n    this.setAttribute(\"name\", val);\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    let changed = !v !== !this._pressed;\r\n\r\n    if (v) {\r\n      this._pressedTime = util.time_ms();\r\n    } else if (changed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      window.setTimeout(() => {\r\n        this.setCSS();\r\n      }, this._pressedTimeout - (util.time_ms() - this._pressedTime) + 1);\r\n    }\r\n\r\n    this.__pressed = v;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.tabIndex = 0;\r\n\r\n    this.bindEvents();\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (this.hasDefault(\"pressedTimeout\")) {\r\n      this._pressedTimeout = this.getDefault(\"pressedTimeout\");\r\n    }\r\n\r\n    let subkey = undefined;\r\n\r\n    let pressed = this._pressed;\r\n    if (!pressed && util.time_ms() - this._pressedTime < this._pressedTimeout) {\r\n      pressed = true;\r\n    }\r\n\r\n    if (this.disabled) {\r\n      subkey = \"disabled\";\r\n    } else if (pressed && this._highlight) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    }\r\n\r\n    let h = this.getDefault(\"height\");\r\n\r\n    this.setBoxCSS(subkey);\r\n\r\n    this.label.style[\"padding\"] = this.label.style[\"margin\"] = \"0px\";\r\n    this.style[\"background-color\"] = this.getSubDefault(subkey, \"background-color\");\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n    this.label.style[\"font\"] = font.genCSS();\r\n    this.label.style[\"color\"] = font.color;\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"width\"] = \"max-content\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.label.style[\"user-select\"] = \"none\";\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  _redraw() {\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this._last_name !== this.name) {\r\n      this.label.innerHTML = this.name;\r\n      this._last_name = this.name;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(Button);\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class OldButton extends ButtonEventBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    this._last_but_update_key = \"\";\r\n\r\n    this._name = \"\";\r\n    this._namePad = undefined;\r\n    this._leftPad = 5; //extra pad before text\r\n    this._rightPad = 5; //extra pad after text\r\n\r\n    this._last_w = 0;\r\n    this._last_h = 0;\r\n\r\n    this._last_dpi = dpi;\r\n\r\n    this._lastw = undefined;\r\n    this._lasth = undefined;\r\n\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.dom.setAttribute(\"class\", \"canvas1\");\r\n    this.dom.tabIndex = 0;\r\n\r\n    this._last_bg = undefined;\r\n\r\n    this._last_disabled = false;\r\n    this._auto_depress = true;\r\n\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get r() {\r\n    return this.getDefault(\"border-radius\");\r\n  }\r\n\r\n  set r(val) {\r\n    this.overrideDefault(\"border-radius\", val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"old-button-x\",\r\n      style  : \"button\"\r\n    };\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {\r\n        x                : x, y: y, stopPropagation: () => {\r\n        }, preventDefault: () => {\r\n        }\r\n      };\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  init() {\r\n    let dpi = this.getDPI();\r\n\r\n    //set default dimensions\r\n    let width = ~~(this.getDefault(\"width\")*dpi);\r\n    let height = ~~(this.getDefault(\"height\")*dpi);\r\n\r\n    this.dom.width = width;\r\n    this.dom.height = height;\r\n\r\n    this.dom.style[\"width\"] = (width/dpi) + \"px\";\r\n    this.dom.style[\"height\"] = (height/dpi) + \"px\";\r\n    this.dom.style[\"padding\"] = this.dom.style[\"margin\"] = \"0px\";\r\n\r\n    this._name = undefined;\r\n    this.updateName();\r\n\r\n    this.bindEvents();\r\n    this._redraw();\r\n  }\r\n\r\n  setAttribute(key, val) {\r\n    super.setAttribute(key, val);\r\n\r\n    if (key === \"name\") {\r\n      this.updateName();\r\n      this.updateWidth();\r\n    }\r\n  }\r\n\r\n  old_bindEvents() {\r\n    let press_gen = 0;\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button press\", this._pressed, this.disabled, e.button);\r\n      }\r\n\r\n      if (this.disabled) return;\r\n\r\n      this._pressed = true;\r\n\r\n      if (util.isMobile() && this.onclick && e.button === 0) {\r\n        this.onclick();\r\n      }\r\n\r\n      if (this._onpress) {\r\n        this._onpress(this);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      e.preventDefault();\r\n    };\r\n\r\n    let depress = (e) => {\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"button depress\", e.button, e.was_touch);\r\n\r\n      if (this._auto_depress) {\r\n        this._pressed = false;\r\n\r\n        if (this.disabled) return;\r\n\r\n        this._redraw();\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (util.isMobile() || e.type === \"pointerup\" && e.button) {\r\n        return;\r\n      }\r\n\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents) {\r\n        console.log(\"button click callback:\", this.onclick, this._onpress, this.onpress);\r\n      }\r\n\r\n      if (this.onclick && e.pointerType !== \"mouse\") {\r\n        this.onclick(this);\r\n      }\r\n\r\n      this.undoBreakPoint();\r\n    }\r\n\r\n    this.addEventListener(\"mousedown\", press, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseup\", depress, {captured: true, passive: false});\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = true;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n\r\n    this.addEventListener(\"mouseout\", (e) => {\r\n      if (this.disabled)\r\n        return;\r\n\r\n      this._highlight = false;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  updateDisabled() {\r\n    if (this._last_disabled !== this.disabled) {\r\n      this._last_disabled = this.disabled;\r\n\r\n      //setTimeout(() => {\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n\r\n      if (cconst.DEBUG.buttonEvents)\r\n        console.log(\"disabled update!\", this.disabled, this.style[\"background-color\"]);\r\n      //}, 100);\r\n    }\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    const dpi = UIBase.getDPI();\r\n    let height = ~~(this.getDefault(\"height\")) + this.getDefault(\"padding\");\r\n    let size = this.getDefault(\"DefaultText\").size*1.33;\r\n\r\n    if (height === undefined || size === undefined || isNaN(height) || isNaN(size)) {\r\n      return;\r\n    }\r\n\r\n    height = ~~(Math.max(height, size)*dpi);\r\n    let cssHeight = (height/dpi) + \"px\";\r\n\r\n    if (cssHeight !== this.style[\"height\"]) {\r\n      this.style[\"height\"] = cssHeight;\r\n      this.dom.style[\"height\"] = cssHeight;\r\n      this.dom.height = height;\r\n\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return _themeUpdateKey;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    this.updateDefaultSize();\r\n    this.updateWidth();\r\n    this.updateDPI();\r\n    this.updateName();\r\n    this.updateDisabled();\r\n\r\n    if (this.background !== this._last_bg) {\r\n      this._last_bg = this.background;\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    let key = this._calcUpdateKey();\r\n    if (key !== this._last_but_update_key) {\r\n      this._last_but_update_key = key;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.updateBorders();\r\n\r\n    let name = this._name;\r\n    if (name === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let pad = this.getDefault(\"padding\");\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let tw = ui_base.measureText(this, this._genLabel(), {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width + 2.0*pad + this._leftPad + this._rightPad;\r\n\r\n    if (this._namePad !== undefined) {\r\n      tw += this._namePad;\r\n    }\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    w = Math.max(w, tw);\r\n    w = ~~w;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.updateBorders();\r\n  }\r\n\r\n  updateBorders(dom=this.dom) {\r\n    let lwid = this.getDefault(\"border-width\");\r\n\r\n    if (lwid) {\r\n      dom.style[\"border-color\"] = this.getDefault(\"border-color\");\r\n      dom.style[\"border-width\"] = lwid + \"px\";\r\n      dom.style[\"border-style\"] = \"solid\";\r\n      dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    } else {\r\n      dom.style[\"border-color\"] = \"none\";\r\n      dom.style[\"border-width\"] = \"0px\";\r\n      dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    }\r\n\r\n  }\r\n\r\n  updateName() {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateWidth(w_add = 0) {\r\n  }\r\n\r\n  _repos_canvas() {\r\n    let dpi = this.getDPI();\r\n\r\n    let w = parsepx(this.dom.style[\"width\"]);\r\n    let h = parsepx(this.dom.style[\"height\"]);\r\n\r\n    let w2 = ~~(w*dpi);\r\n    let h2 = ~~(h*dpi);\r\n\r\n    w = w2/dpi;\r\n    h = h2/dpi;\r\n\r\n    this.dom.width = w2;\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n\r\n    this.dom.height = h2;\r\n    this.dom.style[\"height\"] = h + \"px\";\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = this.getDPI();\r\n\r\n    if (this._last_dpi !== dpi) {\r\n      //console.log(\"update dpi\", dpi);\r\n\r\n      this._last_dpi = dpi;\r\n\r\n      this.g.font = undefined; //reset font\r\n\r\n      this.setCSS();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.style[\"background-color\"]) {\r\n      this.dom._background = this.style[\"background-color\"];\r\n      this.style[\"background-color\"] = \"\";\r\n    }\r\n\r\n    //console.log(\">\", this.dom.style[\"background-color\"], \"-----\");\r\n    //console.log(\"width:\", this.clientWidth)\r\n  }\r\n\r\n  _genLabel() {\r\n    return \"\" + this._name;\r\n  }\r\n\r\n  _getSubKey() {\r\n    if (this._pressed) {\r\n      return 'depressed';\r\n    } else if (this._highlight) {\r\n      return 'highlight';\r\n    } else {\r\n      return undefined; //make getSubDefault forward to getDefault\r\n    }\r\n  }\r\n\r\n  _redraw(draw_text = true) {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    if (this._pressed && this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight-pressed\", \"BoxHighlight\");\r\n    } else if (this._pressed) {\r\n      this.dom._background = this.getSubDefault(subkey, \"pressed\", \"BoxDepressed\");\r\n    } else if (this._highlight) {\r\n      this.dom._background = this.getSubDefault(subkey, \"highlight\", \"BoxHighlight\");\r\n    } else {\r\n      this.dom._background = this.getSubDefault(subkey, \"background-color\", \"background-color\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g);\r\n\r\n    //drawn with CSS now\r\n    /*\r\n    let lwid = this.getDefault(\"border-width\");\r\n    if (lwid) {\r\n      this.g.lineWidth = lwid*dpi;\r\n      ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, undefined, \"stroke\");\r\n    }\r\n     */\r\n\r\n    this.updateBorders();\r\n\r\n    if (this._focus) {\r\n      let w = this.dom.width, h = this.dom.height;\r\n      let p = 1/dpi;\r\n\r\n      //XXX remove this.g.translate lines after refactoring drawRoundBox, see comment in ui_base.js\r\n      this.g.translate(p, p);\r\n      let lw = this.g.lineWidth;\r\n\r\n\r\n      this.g.lineWidth = this.getDefault(\"focus-border-width\", undefined, 1.0)*dpi;\r\n\r\n      ui_base.drawRoundBox(this, this.dom, this.g, w - p*2, h - p*2, this.r, \"stroke\", this.getDefault(\"BoxHighlight\"));\r\n\r\n      this.g.lineWidth = lw;\r\n      this.g.translate(-p, -p);\r\n    }\r\n\r\n    if (draw_text) {\r\n      this._draw_text();\r\n    }\r\n  }\r\n\r\n  _draw_text() {\r\n    let dpi = this.getDPI();\r\n\r\n    let subkey = this._getSubKey();\r\n\r\n    //if (util.isMobile()) {\r\n    //dpi = dpi; //visualViewport.scale;\r\n    //}\r\n\r\n    let font = this.getSubDefault(subkey, \"DefaultText\");\r\n\r\n    let pad = this.getDefault(\"padding\")*dpi;\r\n    let ts = font.size*dpi;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let w = this.dom.width, h = this.dom.height;\r\n\r\n    let tw = ui_base.measureText(this, text, undefined, undefined, ts, font).width;\r\n\r\n    let cx = pad*0.5 + this._leftPad*dpi;\r\n    let cy = ts + (h - ts)/3.0;\r\n\r\n    let g = this.g;\r\n\r\n    ui_base.drawText(this, ~~cx, ~~cy, text, {\r\n      canvas: this.dom,\r\n      g     : this.g,\r\n      size  : ts/dpi,\r\n      font  : font\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(OldButton);\r\n", "export * from './controller/context.js';\r\nexport * from './controller/controller.js';\r\nexport * from './controller/controller_abstract.js';\r\nexport * from './controller/controller_ops.js';\r\nexport * from './controller/controller_abstract.js';\r\nexport * from './controller/controller_base.js';\r\nexport * from './toolsys/toolsys.js';\r\nexport * from './toolsys/toolprop.js';\r\nexport * from './toolsys/toolpath.js';\r\n\r\nexport * from './curve/curve1d_all.js';\r\nexport * from './curve/curve1d.js';\r\nexport * from './curve/curve1d_base.js';\r\nexport * from './curve/curve1d_toolprop.js';\r\n\r\nimport * as eventgraph from './dag/eventdag.js';\r\nexport {eventgraph};\r\n\r\nimport * as solver from './util/solver.js';\r\nexport {solver};\r\n\r\nimport * as util from './util/util.js';\r\nexport {util};\r\n\r\nimport * as vectormath from './util/vectormath.js';\r\nexport {vectormath};\r\n\r\nimport * as math from \"./util/math.js\";\r\nexport {math};\r\n\r\nimport * as toolprop_abstract from './toolsys/toolprop_abstract.js';\r\nexport {toolprop_abstract};\r\n\r\nimport * as html5_fileapi from './util/html5_fileapi.js';\r\nexport {html5_fileapi};\r\n\r\nimport * as parseutil from './util/parseutil.js';\r\nexport {parseutil};\r\n\r\nimport * as config from './config/config.js';\r\nexport {config};\r\n\r\nimport nstructjs from './util/struct.js';\r\nexport {nstructjs};\r\n\r\nimport lzstring from './extern/lz-string/lz-string.js';\r\nexport {lzstring};\r\n\r\nexport * from './util/vectormath.js';\r\nexport * from './util/math.js';\r\nexport * from './util/colorutils.js';\r\nexport * from './util/graphpack.js';\r\nexport * from './util/solver.js';\r\nexport * from './util/simple_events.js';\r\n\r\nexport {binomial} from './curve/curve1d_bspline.js';\r\n", "import {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nexport class Constraint {\r\n  constructor(name, func, klst, params, k = 1.0) {\r\n    this.glst = [];\r\n    this.klst = klst;\r\n    this.wlst = [];\r\n    this.k = k;\r\n    this.params = params;\r\n    this.name = name;\r\n\r\n    for (let ks of klst) {\r\n      this.glst.push(new Float64Array(ks.length));\r\n      const ws = new Float64Array(ks.length);\r\n\r\n      for (let i = 0; i < ws.length; i++) {\r\n        ws[i] = 1.0;\r\n      }\r\n\r\n      this.wlst.push(ws);\r\n    }\r\n\r\n    this.df = 0.0005;\r\n    this.threshold = 0.0001;\r\n    if (func !== undefined) { /* Happens with subclass-style constraints. */\r\n      this.func = func;\r\n    }\r\n    if (!this.funcDv) {\r\n      this.funcDv = null;\r\n    }\r\n  }\r\n\r\n  postSolve() {\r\n  }\r\n\r\n  evaluate(no_dvs = false) {\r\n    let r1 = this.func(this.params);\r\n\r\n    if (this.funcDv) {\r\n      this.funcDv(this.params, this.glst);\r\n      return r1;\r\n    }\r\n\r\n    if (Math.abs(r1) < this.threshold)\r\n      return 0.0;\r\n\r\n    let df = this.df;\r\n\r\n    if (no_dvs)\r\n      return r1;\r\n\r\n    for (let i = 0; i < this.klst.length; i++) {\r\n      let gs = this.glst[i];\r\n      let ks = this.klst[i];\r\n\r\n      for (let j = 0; j < ks.length; j++) {\r\n        let orig = ks[j];\r\n        ks[j] += df;\r\n        let r2 = this.func(this.params);\r\n        ks[j] = orig;\r\n\r\n        gs[j] = (r2 - r1)/df;\r\n      }\r\n    }\r\n\r\n    return r1;\r\n  }\r\n}\r\n\r\nexport class Solver {\r\n  constructor() {\r\n    this.constraints = [];\r\n    this.gk = 0.99;\r\n    this.simple = false;\r\n    this.randCons = false;\r\n\r\n    /** stop when average constraint error falls below this */\r\n    this.threshold = 0.01;\r\n  }\r\n\r\n  remove(con) {\r\n    this.constraints.remove(con);\r\n  }\r\n\r\n  add(con) {\r\n    this.constraints.push(con);\r\n  }\r\n\r\n  solveStep(gk = this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci = 0; ci < cons.length; ci++) {\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        continue;\r\n      }\r\n\r\n      r1 /= totgs;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i], ws = con.wlst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          ks[j] += -r1*gs[j]*con.k*gk*ws[j];\r\n        }\r\n\r\n        con.postSolve();\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solveStepSimple(gk = this.gk) {\r\n    let err = 0.0;\r\n\r\n    let cons = this.constraints;\r\n    for (let ci = 0; ci < cons.length; ci++) {\r\n      let ri = ci;\r\n      if (this.randCons) {\r\n        ri = ~~(Math.random()*this.constraints.length*0.99999);\r\n      }\r\n\r\n      let con = cons[ri];\r\n\r\n      let r1 = con.evaluate();\r\n\r\n      if (r1 === 0.0)\r\n        continue;\r\n\r\n      err += Math.abs(r1);\r\n      let totgs = 0.0;\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          totgs += gs[j]*gs[j];\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        continue;\r\n      }\r\n\r\n      totgs = 0.0001/Math.sqrt(totgs);\r\n\r\n      for (let i = 0; i < con.klst.length; i++) {\r\n        let ks = con.klst[i], gs = con.glst[i], ws = con.wlst[j];\r\n        for (let j = 0; j < ks.length; j++) {\r\n          ks[j] += -totgs*gs[j]*con.k*gk*ws[j];\r\n        }\r\n      }\r\n\r\n      con.postSolve();\r\n    }\r\n\r\n    return err;\r\n  }\r\n\r\n  solve(steps, gk = this.gk, printError = false) {\r\n    let err = 0.0;\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      if (this.simple) {\r\n        err = this.solveStepSimple(gk);\r\n      } else {\r\n        err = this.solveStep(gk);\r\n      }\r\n\r\n\r\n      if (printError) {\r\n        console.warn(\"average error:\", (err/this.constraints.length).toFixed(4));\r\n      }\r\n      if (err < this.threshold/this.constraints.length) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return err;\r\n  }\r\n}\r\n", "\"use strict\";\r\n\r\nimport {Vector2} from \"./vectormath.js\";\r\nimport * as math from './math.js';\r\nimport * as util from './util.js';\r\n\r\nimport {Constraint, Solver} from './solver.js';\r\n\r\nlet idgen = 0;\r\n\r\nexport class PackNodeVertex extends Vector2 {\r\n  constructor(node, co) {\r\n    super(co);\r\n\r\n    this.node = node;\r\n    this._id = idgen++;\r\n    this.edges = [];\r\n    this._absPos = new Vector2();\r\n  }\r\n\r\n  get absPos() {\r\n    this._absPos.load(this).add(this.node.pos);\r\n    return this._absPos;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nexport class PackNode {\r\n  constructor() {\r\n    this.pos = new Vector2();\r\n    this.vel = new Vector2();\r\n    this.oldpos = new Vector2();\r\n    this._id = idgen++;\r\n    this.size = new Vector2();\r\n    this.verts = [];\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this._id;\r\n  }\r\n}\r\n\r\nfunction copyGraph(nodes) {\r\n  let ret = [];\r\n  let idmap = {};\r\n\r\n  for (let n of nodes) {\r\n    let n2 = new PackNode();\r\n    n2._id = n._id;\r\n    n2.pos.load(n.pos);\r\n    n2.vel.load(n.vel);\r\n    n2.size.load(n.size);\r\n\r\n    n2.verts = [];\r\n    idmap[n2._id] = n2;\r\n\r\n    for (let v of n.verts) {\r\n      let v2 = new PackNodeVertex(n2, v);\r\n      v2._id = v._id;\r\n      idmap[v2._id] = v2;\r\n\r\n      n2.verts.push(v2);\r\n    }\r\n\r\n    ret.push(n2);\r\n  }\r\n\r\n  for (let n of nodes) {\r\n    for (let v of n.verts) {\r\n      let v2 = idmap[v._id];\r\n\r\n      for (let v3 of v.edges) {\r\n        v2.edges.push(idmap[v3._id]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nfunction getCenter(nodes) {\r\n  let cent = new Vector2();\r\n\r\n  for (let n of nodes) {\r\n    cent.add(n.pos);\r\n  }\r\n\r\n  if (nodes.length === 0)\r\n    return cent;\r\n\r\n  cent.mulScalar(1.0 / nodes.length);\r\n\r\n  return cent;\r\n}\r\n\r\nfunction loadGraph(nodes, copy) {\r\n  let idmap = {};\r\n\r\n  for (let i=0; i<nodes.length; i++) {\r\n    nodes[i].pos.load(copy[i].pos);\r\n    nodes[i].oldpos.load(copy[i].oldpos);\r\n    nodes[i].vel.load(copy[i].vel);\r\n  }\r\n}\r\n\r\nexport function graphGetIslands(nodes) {\r\n  let islands = [];\r\n  let visit1 = new util.set();\r\n\r\n  let rec = (n, island) => {\r\n    island.push(n);\r\n    visit1.add(n);\r\n\r\n    for (let v of n.verts) {\r\n      for (let e of v.edges) {\r\n        let n2 = e.node;\r\n        if (n2 !== n && !visit1.has(n2)) {\r\n          rec(n2, island);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  for (let n of nodes) {\r\n    if (visit1.has(n)) {\r\n      continue;\r\n    }\r\n\r\n    let island = [];\r\n    islands.push(island);\r\n    rec(n, island);\r\n  }\r\n\r\n  return islands;\r\n}\r\n\r\nexport function graphPack(nodes, margin_or_args=15, steps=10, updateCb=undefined) {\r\n  let margin = margin_or_args;\r\n  let speed = 1.0;\r\n\r\n  if (typeof margin === \"object\") {\r\n    let args = margin;\r\n\r\n    margin = args.margin ?? 15;\r\n    steps = args.steps ?? 10;\r\n    updateCb = args.updateCb;\r\n    speed = args.speed ?? 1.0;\r\n  }\r\n\r\n  let orignodes = nodes;\r\n  nodes = copyGraph(nodes);\r\n\r\n  let decay = 1.0;\r\n  let decayi = 0;\r\n\r\n\r\n  let min = new Vector2().addScalar(1e17);\r\n  let max = new Vector2().addScalar(-1e17);\r\n\r\n  let tmp = new Vector2();\r\n  for (let n of nodes) {\r\n    min.min(n.pos);\r\n    tmp.load(n.pos).add(n.size);\r\n    max.max(tmp);\r\n  }\r\n\r\n  let size = new Vector2(max).sub(min);\r\n\r\n  for (let n of nodes) {\r\n    n.pos[0] += (Math.random()-0.5)*5.0/size[0]*speed;\r\n    n.pos[1] += (Math.random()-0.5)*5.0/size[1]*speed;\r\n  }\r\n\r\n  let nodemap = {};\r\n  for (let n of nodes) {\r\n    n.vel.zero();\r\n    nodemap[n._id] = n;\r\n    for (let v of n.verts) {\r\n      nodemap[v._id] = v;\r\n    }\r\n  }\r\n\r\n  let visit = new util.set();\r\n  let verts = new util.set();\r\n  let isect = [];\r\n\r\n  let disableEdges = false;\r\n\r\n  function edge_c(params) {\r\n    let [v1, v2, restlen] = params;\r\n\r\n    if (disableEdges) return 0;\r\n\r\n    return Math.abs(v1.absPos.vectorDistance(v2.absPos) - restlen);\r\n  }\r\n\r\n  let p1 = new Vector2();\r\n  let p2 = new Vector2();\r\n  let s1 = new Vector2();\r\n  let s2 = new Vector2();\r\n\r\n  function loadBoxes(n1, n2, margin1=margin) {\r\n    p1.load(n1.pos);\r\n    p2.load(n2.pos);\r\n    s1.load(n1.size);\r\n    s2.load(n2.size);\r\n\r\n    p1.subScalar(margin1);\r\n    p2.subScalar(margin1);\r\n    s1.addScalar(margin1*2.0);\r\n    s2.addScalar(margin1*2.0);\r\n  }\r\n\r\n  let disableArea = false;\r\n\r\n  function area_c(params) {\r\n    let [n1, n2] = params;\r\n\r\n    if (disableArea)\r\n      return 0.0;\r\n\r\n    loadBoxes(n1, n2);\r\n\r\n    let a1 = n1.size[0]*n1.size[1];\r\n    let a2 = n2.size[0]*n2.size[1];\r\n\r\n    return math.aabb_overlap_area(p1, s1, p2, s2);\r\n    return (math.aabb_overlap_area(p1, s1, p2, s2) / (a1+a2));\r\n  }\r\n\r\n  let lasterr, besterr, best;\r\n  let err;\r\n\r\n  let islands = graphGetIslands(nodes);\r\n  let fakeVerts = [];\r\n  for (let island of islands) {\r\n    let n = island[0];\r\n    let fv = new PackNodeVertex(n);\r\n    fakeVerts.push(fv);\r\n  }\r\n\r\n  let solveStep1 = (gk=1.0) => {\r\n    let solver = new Solver();\r\n\r\n    isect.length = 0;\r\n    visit = new util.set();\r\n\r\n    if (fakeVerts.length > 1) {\r\n      for (let i=1; i<fakeVerts.length; i++) {\r\n        let v1 = fakeVerts[0];\r\n        let v2 = fakeVerts[i];\r\n\r\n        let rlen = 1.0;\r\n\r\n        let con = new Constraint(\"edge_c\", edge_c, [v1.node.pos, v2.node.pos], [v1, v2, rlen]);\r\n        con.k = 0.25;\r\n        solver.add(con);\r\n      }\r\n    }\r\n\r\n    for (let n1 of nodes) {\r\n      for (let v of n1.verts) {\r\n        verts.add(v);\r\n        for (let v2 of v.edges) {\r\n          //hueristic to avoid adding same constraint twice\r\n          if (v2._id < v._id) continue;\r\n\r\n          let rlen = n1.size.vectorLength()*0.0;\r\n\r\n          let con = new Constraint(\"edge_c\", edge_c, [v.node.pos, v2.node.pos], [v, v2, rlen]);\r\n          con.k = 1.0;\r\n          solver.add(con);\r\n        }\r\n      }\r\n\r\n      for (let n2 of nodes) {\r\n        if (n1 === n2) continue;\r\n        let key = Math.min(n1._id, n2._id) + \":\" + Math.max(n1._id, n2._id);\r\n        if (visit.has(key)) continue;\r\n\r\n        loadBoxes(n1, n2);\r\n        let area = math.aabb_overlap_area(p1, s1, p2, s2);\r\n\r\n        if (area > 0.01) {\r\n          let size = decay*(n1.size.vectorLength() + n2.size.vectorLength())*speed;\r\n          //*\r\n          n1.pos[0] += (Math.random() - 0.5)*size;\r\n          n1.pos[1] += (Math.random() - 0.5)*size;\r\n          n2.pos[0] += (Math.random() - 0.5)*size;\r\n          n2.pos[1] += (Math.random() - 0.5)*size;\r\n          //*/\r\n\r\n          isect.push([n1, n2]);\r\n          visit.add(key);\r\n        }\r\n      }\r\n\r\n      for (let [n1, n2] of isect) {\r\n        let con = new Constraint(\"area_c\", area_c, [n1.pos, n2.pos], [n1, n2]);\r\n        solver.add(con);\r\n        con.k = 1.0;\r\n      }\r\n    }\r\n\r\n    return solver;\r\n  };\r\n\r\n  let i = 1;\r\n  let solveStep = (gk=0.5) => {\r\n    let solver = solveStep1();\r\n\r\n    if (i % 40 === 0.0) {\r\n      let c1 = getCenter(nodes);\r\n\r\n      let rfac = 1000.0;\r\n\r\n      if (best) loadGraph(nodes, best);\r\n\r\n      for (let n of nodes) {\r\n        n.pos[0] += (Math.random() - 0.5) * rfac * speed;\r\n        n.pos[1] += (Math.random() - 0.5) * rfac * speed;\r\n        n.vel.zero();\r\n      }\r\n\r\n      let c2 = getCenter(nodes);\r\n      c1.sub(c2);\r\n\r\n      for (let n of nodes) {\r\n        n.pos.add(c1);\r\n      }\r\n    }\r\n\r\n    let err = 1e17;\r\n\r\n    for (let n of nodes) {\r\n      n.oldpos.load(n.pos);\r\n      n.pos.addFac(n.vel, 0.5);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n    solver.solve(1, gk);\r\n\r\n    //solve so boxes don't overlap\r\n    disableEdges = true;\r\n    disableArea = false;\r\n\r\n    for (let j=0; j<10; j++) {\r\n      solver = solveStep1();\r\n      err = solver.solve(10, gk*speed);\r\n    }\r\n\r\n    for (let n of nodes) {\r\n      n.vel.load(n.pos).sub(n.oldpos);\r\n    }\r\n\r\n    //get error from edge constraints\r\n\r\n    disableEdges = false;\r\n    disableArea = true;\r\n\r\n    err = 0.0;\r\n    for (let con of solver.constraints) {\r\n      err += con.evaluate(true);\r\n    }\r\n\r\n    disableEdges = false;\r\n    disableArea = false;\r\n\r\n    /*\r\n    loadGraph(orignodes, nodes);\r\n    if (updateCb) {\r\n      updateCb();\r\n    }//*/\r\n\r\n    lasterr = err;\r\n\r\n    let add = Math.random()*besterr*Math.exp(-i*0.1);\r\n\r\n    if (besterr === undefined || err < besterr+add) {\r\n      best = copyGraph(nodes);\r\n      besterr = err;\r\n    }\r\n\r\n    i++;\r\n\r\n    return err;\r\n  };\r\n\r\n\r\n  for (let j=0; j<steps; j++) {\r\n    solveStep();\r\n\r\n    decayi++;\r\n    decay = Math.exp(-decayi*0.1);\r\n  }\r\n\r\n  min.zero().addScalar(1e17);\r\n  max.zero().addScalar(-1e17);\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    min.min(node.pos);\r\n    p2.load(node.pos).add(node.size);\r\n    max.max(p2);\r\n  }\r\n\r\n  for (let node of (best ? best : nodes)) {\r\n    node.pos.sub(min);\r\n  }\r\n\r\n  loadGraph(orignodes, best ? best : nodes);\r\n\r\n  if (updateCb) {\r\n    if (nodes._timer !== undefined) {\r\n      window.clearInterval(nodes._timer);\r\n    }\r\n\r\n    nodes._timer = window.setInterval(() => {\r\n      let time = util.time_ms();\r\n\r\n      while (util.time_ms() - time < 50) {\r\n        let err = solveStep();\r\n      }\r\n\r\n      if (cconst.DEBUG.boxPacker) {\r\n        console.log(\"err\", (besterr / nodes.length).toFixed(2), (lasterr / nodes.length).toFixed(2), \"isects\", isect.length);\r\n      }\r\n\r\n      if (best) loadGraph(orignodes, best);\r\n\r\n      if (updateCb() === false) {\r\n        clearInterval(nodes._timer);\r\n        return;\r\n      }\r\n    }, 100);\r\n\r\n    let timer = nodes._timer;\r\n\r\n    return {\r\n      stop : () => {\r\n        if (best) loadGraph(nodes, best);\r\n\r\n        window.clearInterval(timer);\r\n        nodes._timer = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n", "\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {OldButton} from \"./ui_button.js\";\r\nimport {DomEventTypes} from '../path-controller/util/events.js';\r\n\r\nimport {HotKey, keymap} from '../path-controller/util/simple_events.js';\r\nimport { parseToolPath } from '../path-controller/controller.js'\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nfunction debugmenu() {\r\n  if (window.DEBUG && window.DEBUG.menu) {\r\n    console.warn(\"%cmenu:\", \"color:blue\", ...arguments);\r\n  }\r\n}\r\n\r\n\r\nexport class Menu extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.parentMenu = undefined;\r\n\r\n    this._was_clicked = false;\r\n\r\n    this.items = [];\r\n    this.autoSearchMode = true;\r\n\r\n    this._ignoreFocusEvents = false;\r\n    this.closeOnMouseUp = true;\r\n\r\n    this._submenu = undefined;\r\n\r\n    this.ignoreFirstClick = false;\r\n\r\n    this.itemindex = 0;\r\n    this.closed = false;\r\n    this.started = false;\r\n    this.activeItem = undefined;\r\n\r\n    this.overrideDefault(\"DefaultText\", this.getDefault(\"MenuText\"));\r\n\r\n    //we have to make a container for any submenus to\r\n    this.container = document.createElement(\"span\");\r\n    this.container.style[\"display\"] = \"flex\";\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n\r\n    //this.container.style[\"background-color\"] = \"red\";\r\n    this.container.setAttribute(\"class\", \"menucon\");\r\n\r\n    this.dom = document.createElement(\"ul\");\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    /*\r\n              place-items: start start;\r\n              flex-wrap : nowrap;\r\n              align-content : start;\r\n              place-content : start;\r\n              justify-content : start;\r\n\r\n              align-items : start;\r\n              place-items : start;\r\n              justify-items : start;\r\n    */\r\n\r\n    let style = this.menustyle = document.createElement(\"style\");\r\n    this.buildStyle();\r\n\r\n    this.dom.setAttribute(\"tabindex\", -1);\r\n\r\n    //the menu wrangler handles key events\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"menu-x\",\r\n      style  : \"menu\"\r\n    };\r\n  }\r\n\r\n  float(x, y, zindex = undefined) {\r\n    let dpi = this.getDPI();\r\n    let rect = this.dom.getClientRects();\r\n    let maxx = this.getWinWidth() - 10;\r\n    let maxy = this.getWinHeight() - 10;\r\n\r\n    if (rect.length > 0) {\r\n      rect = rect[0];\r\n      if (y + rect.height > maxy) {\r\n        y = maxy - rect.height - 1;\r\n      }\r\n\r\n      if (x + rect.width > maxx) {\r\n        x = maxx - rect.width - 1;\r\n      }\r\n    }\r\n\r\n    super.float(x, y, 50);\r\n  }\r\n\r\n  click() {\r\n    if (this._was_clicked) {\r\n      return;\r\n    }\r\n\r\n    if (this.ignoreFirstClick) {\r\n      this.ignoreFirstClick = Math.max(this.ignoreFirstClick - 1, 0);\r\n      return;\r\n    }\r\n\r\n    if (!this.activeItem || this.activeItem._isMenu) {\r\n      return;\r\n    }\r\n\r\n    this._was_clicked = true;\r\n\r\n    if (this.onselect) {\r\n      try {\r\n        this.onselect(this.activeItem._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        console.log(\"Error in menu callback\");\r\n      }\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n\r\n      if (this.onclose) {\r\n        this.onclose();\r\n      }\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  close() {\r\n    if (this.closed) {\r\n      return;\r\n    }\r\n\r\n    this.closed = true;\r\n\r\n    if (this.started) {\r\n      menuWrangler.popMenu(this);\r\n    }\r\n\r\n    this.started = false;\r\n\r\n    if (this._popup) {\r\n      this._popup.end();\r\n      this._popup = undefined;\r\n    }\r\n\r\n    this.remove();\r\n    this.dom.remove();\r\n\r\n    if (this.onclose) {\r\n      this.onclose(this);\r\n    }\r\n  }\r\n\r\n  _select(dir, focus = true) {\r\n    if (this.activeItem === undefined) {\r\n      for (let item of this.items) {\r\n        if (!item.hidden) {\r\n          this.setActive(item, focus);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      let i = this.items.indexOf(this.activeItem);\r\n      let item = this.activeItem;\r\n\r\n      do {\r\n        i = (i + dir + this.items.length)%this.items.length;\r\n        item = this.items[i];\r\n\r\n        if (!item.hidden) {\r\n          break;\r\n        }\r\n      } while (item !== this.activeItem);\r\n\r\n      this.setActive(item, focus);\r\n    }\r\n\r\n    if (this.hasSearchBox) {\r\n      this.activeItem.scrollIntoView();\r\n    }\r\n  }\r\n\r\n  selectPrev(focus = true) {\r\n    return this._select(-1, focus);\r\n  }\r\n\r\n  selectNext(focus = true) {\r\n    return this._select(1, focus);\r\n  }\r\n\r\n  start_fancy(prepend, setActive = true) {\r\n    return this.startFancy(prepend, setActive);\r\n  }\r\n\r\n  setActive(item, focus = true) {\r\n    if (this.activeItem === item) {\r\n      return;\r\n    }\r\n\r\n    if (this.activeItem) {\r\n      this.activeItem.style[\"background-color\"] = this.getDefault(\"MenuBG\");\r\n\r\n      if (focus) {\r\n        this.activeItem.blur();\r\n      }\r\n    }\r\n\r\n    if (item) {\r\n      item.style[\"background-color\"] = this.getDefault(\"MenuHighlight\");\r\n\r\n      if (focus) {\r\n        item.focus();\r\n      }\r\n    }\r\n\r\n    this.activeItem = item;\r\n  }\r\n\r\n  startFancy(prepend, setActive = true) {\r\n    this.hasSearchBox = true;\r\n    this.started = true;\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dom2 = document.createElement(\"div\");\r\n    //let dom2 = document.createElement(\"div\");\r\n\r\n    this.dom.setAttribute(\"class\", \"menu\");\r\n    dom2.setAttribute(\"class\", \"menu\");\r\n\r\n    let sbox = this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.parentWidget = this;\r\n\r\n    dom2.appendChild(sbox);\r\n    dom2.appendChild(this.dom);\r\n\r\n    dom2.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"height\"] = \"300px\";\r\n    this.dom.style[\"overflow\"] = \"scroll\";\r\n\r\n    if (prepend) {\r\n      this.container.prepend(dom2);\r\n    } else {\r\n      this.container.appendChild(dom2);\r\n    }\r\n\r\n    dom2.parentWidget = this.container;\r\n\r\n    sbox.focus();\r\n    sbox.onchange = () => {\r\n      let t = sbox.text.trim().toLowerCase();\r\n\r\n      for (let item of this.items) {\r\n        item.hidden = true;\r\n        item.remove();\r\n      }\r\n\r\n      for (let item of this.items) {\r\n        let ok = t == \"\";\r\n        ok = ok || item.innerHTML.toLowerCase().search(t) >= 0;\r\n\r\n        if (ok) {\r\n          item.hidden = false;\r\n          this.dom.appendChild(item);\r\n        } else if (item === this.activeItem) {\r\n          this.selectNext(false);\r\n        }\r\n        //item.hidden = !ok;\r\n      }\r\n    }\r\n\r\n    sbox.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case 27: //escape key\r\n          this.close();\r\n          break;\r\n        case 13: //enter key\r\n          this.click(this.activeItem);\r\n          this.close();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  start(prepend = false, setActive = true) {\r\n    this.closed = false;\r\n\r\n    this.started = true;\r\n    this.focus();\r\n\r\n    menuWrangler.pushMenu(this);\r\n\r\n    let dokey = (key) => {\r\n      let val = this.getDefault(key);\r\n      if (typeof val === \"number\") {\r\n        val = \"\" + val + \"px\";\r\n      }\r\n\r\n      if (val !== undefined) {\r\n        this.dom.style[key] = val;\r\n      }\r\n    }\r\n\r\n    dokey(\"padding\");\r\n    dokey(\"padding-top\");\r\n    dokey(\"padding-left\");\r\n    dokey(\"padding-right\");\r\n    dokey(\"padding-bottom\");\r\n\r\n    if (this.items.length > 15 && this.autoSearchMode) {\r\n      return this.start_fancy(prepend, setActive);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.container.prepend(this.dom);\r\n    } else {\r\n      this.container.appendChild(this.dom);\r\n    }\r\n\r\n    if (!setActive)\r\n      return;\r\n\r\n    this.setCSS();\r\n    this.flushUpdate();\r\n\r\n    window.setTimeout(() => {\r\n      this.flushUpdate();\r\n\r\n      //select first child\r\n      //TODO: cache last child entry\r\n\r\n      if (this.activeItem === undefined) {\r\n        this.activeItem = this.dom.childNodes[0];\r\n      }\r\n\r\n      if (this.activeItem === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.activeItem.focus();\r\n    }, 0);\r\n  }\r\n\r\n  addItemExtra(text, id = undefined, hotkey, icon = -1, add = true, tooltip = undefined) {\r\n    let dom = document.createElement(\"span\");\r\n\r\n    dom.style[\"display\"] = \"inline-flex\";\r\n\r\n    dom.hotkey = hotkey;\r\n    dom.icon = icon;\r\n\r\n    let icon_div;\r\n\r\n    if (1) { //icon >= 0) {\r\n      icon_div = ui_base.makeIconDiv(icon, IconSheets.SMALL);\r\n    } else {\r\n      let tilesize = ui_base.iconmanager.getTileSize(IconSheets.SMALL);\r\n\r\n      //tilesize *= window.devicePixelRatio;\r\n\r\n      icon_div = document.createElement(\"span\");\r\n      icon_div.style[\"padding\"] = icon_div.style[\"margin\"] = \"0px\";\r\n      icon_div.style[\"width\"] = tilesize + \"px\";\r\n      icon_div.style[\"height\"] = tilesize + \"px\";\r\n    }\r\n\r\n    icon_div.style[\"display\"] = \"inline-flex\";\r\n    icon_div.style[\"margin-right\"] = \"1px\";\r\n    icon_div.style[\"align\"] = \"left\";\r\n\r\n    let span = document.createElement(\"span\");\r\n\r\n    //stupid css doesn't get width right. . .\r\n    span.style[\"font\"] = ui_base.getFont(this, undefined, \"MenuText\");\r\n\r\n    let dpi = this.getDPI();\r\n    let tsize = this.getDefault(\"MenuText\").size;\r\n    //XXX proportional font fail\r\n\r\n    //XXX stupid!\r\n    let canvas = document.createElement(\"canvas\");\r\n    let g = canvas.getContext(\"2d\");\r\n\r\n    g.font = span.style[\"font\"];\r\n\r\n    let rect = span.getClientRects();\r\n\r\n    let twid = Math.ceil(g.measureText(text).width);\r\n    let hwid;\r\n    if (hotkey) {\r\n      dom.hotkey = hotkey;\r\n      g.font = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hwid = Math.ceil(g.measureText(hotkey).width/UIBase.getDPI());\r\n      twid += hwid + 8;\r\n    }\r\n\r\n    //let twid = Math.ceil(text.trim().length * tsize / dpi);\r\n\r\n    span.innerText = text;\r\n\r\n    span.style[\"word-wrap\"] = \"none\";\r\n    span.style[\"white-space\"] = \"pre\";\r\n    span.style[\"overflow\"] = \"hidden\";\r\n    span.style[\"text-overflow\"] = \"clip\";\r\n\r\n    span.style[\"width\"] = ~~(twid) + \"px\";\r\n    span.style[\"padding\"] = \"0px\";\r\n    span.style[\"margin\"] = \"0px\";\r\n\r\n    dom.style[\"width\"] = \"100%\";\r\n\r\n    dom.appendChild(icon_div);\r\n    dom.appendChild(span);\r\n\r\n    if (hotkey) {\r\n      let hotkey_span = document.createElement(\"span\");\r\n      hotkey_span.innerText = hotkey;\r\n      hotkey_span.style[\"display\"] = \"inline-flex\";\r\n\r\n      hotkey_span.style[\"margin\"] = \"0px\";\r\n      hotkey_span.style[\"margin-left\"] = \"auto\";\r\n      hotkey_span.style[\"margin-right\"] = \"0px\";\r\n      hotkey_span.style[\"padding\"] = \"0px\";\r\n\r\n      hotkey_span.style[\"font\"] = ui_base.getFont(this, undefined, \"HotkeyText\");\r\n      hotkey_span.style[\"color\"] = this.getDefault(\"HotkeyTextColor\");\r\n\r\n      //hotkey_span.style[\"width\"] = ~~((hwid + 7)) + \"px\";\r\n      hotkey_span.style[\"width\"] = \"max-content\";\r\n\r\n      //hotkey_span.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n\r\n      hotkey_span.style[\"text-align\"] = \"right\";\r\n      hotkey_span.style[\"justify-content\"] = \"right\";\r\n      hotkey_span[\"flex-wrap\"] = \"nowrap\";\r\n      hotkey_span[\"text-wrap\"] = \"nowrap\";\r\n\r\n      //hotkey_span.style[\"border\"] = \"1px solid red\";\r\n\r\n      //hotkey_span.style[\"display\"] = \"inline\";\r\n      //hotkey_span.style[\"float\"] = \"right\";\r\n\r\n      dom.appendChild(hotkey_span);\r\n    }\r\n\r\n    let ret = this.addItem(dom, id, add);\r\n\r\n    ret.hotkey = hotkey;\r\n    ret.icon = icon;\r\n    ret.label = text ? text : ret.innerText;\r\n\r\n    if (tooltip) {\r\n      ret.title = tooltip;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //item can be menu or text\r\n  addItem(item, id, add = true, tooltip = undefined) {\r\n    id = id === undefined ? item : id;\r\n    let text = item;\r\n\r\n    if (typeof item === \"string\" || item instanceof String) {\r\n      let dom = document.createElement(\"dom\");\r\n      dom.style[\"text-align\"] = \"left\";\r\n\r\n      dom.textContent = item;\r\n      item = dom;\r\n      //return this.addItemExtra(item, id);\r\n    } else {\r\n      text = item.textContent;\r\n    }\r\n\r\n    let li = document.createElement(\"li\");\r\n\r\n    li.setAttribute(\"tabindex\", this.itemindex++);\r\n    li.setAttribute(\"class\", \"menuitem\");\r\n\r\n    if (tooltip !== undefined) {\r\n      li.title = tooltip;\r\n    }\r\n\r\n    if (item instanceof Menu) {\r\n      //let dom = this.addItemExtra(\"\"+item.title, id, \"\", -1, false);\r\n      let dom = document.createElement(\"span\");\r\n      dom.innerHTML = \"\" + item.title;\r\n      dom._id = dom.id = id;\r\n      dom.setAttribute(\"class\", \"menu\")\r\n\r\n      //dom = document.createElement(\"div\");\r\n      //dom.innerText = \"\"+item.title;\r\n\r\n      //dom.style[\"display\"] = \"inline-block\";\r\n      li.style[\"width\"] = \"100%\"\r\n      li.appendChild(dom);\r\n\r\n      li._isMenu = true;\r\n      li._menu = item;\r\n      item.parentMenu = this;\r\n\r\n      item.hidden = false;\r\n      item.container = this.container;\r\n    } else {\r\n      li._isMenu = false;\r\n      li.appendChild(item);\r\n    }\r\n\r\n    li._id = id;\r\n\r\n    this.items.push(li);\r\n\r\n    li.label = text ? text : li.innerText.trim();\r\n\r\n    if (add) {\r\n      li.addEventListener(\"blur\", (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        if (this.activeItem && !this.activeItem._isMenu) {\r\n          this.setActive(undefined, false);\r\n        }\r\n      });\r\n\r\n      let onfocus = (e) => {\r\n        if (this._ignoreFocusEvents) {\r\n          return;\r\n        }\r\n\r\n        let active = this.activeItem;\r\n\r\n        if (this._submenu) {\r\n          this._submenu.close();\r\n          this._submenu = undefined;\r\n        }\r\n\r\n        if (li._isMenu) {\r\n          li._menu.onselect = (item) => {\r\n            this.onselect(item);\r\n            li._menu.close();\r\n            this.close();\r\n          };\r\n\r\n          li._menu.start(false, false);\r\n          this._submenu = li._menu;\r\n        }\r\n\r\n        this.setActive(li, false);\r\n      };\r\n\r\n      let onclick = (e) => {\r\n        onfocus(e);\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (this.activeItem !== undefined && this.activeItem._isMenu) {\r\n          //ignore\r\n          return;\r\n        }\r\n\r\n        this.click();\r\n      }\r\n\r\n      li.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n      this.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n\r\n      li.addEventListener(\"pointerup\", onclick, {capture: true});\r\n      li.addEventListener(\"click\", onclick, {capture: true});\r\n      li.addEventListener(\"pointerdown\", onclick, {capture: true});\r\n\r\n      li.addEventListener(\"focus\", (e) => {\r\n        onfocus(e);\r\n        onfocus(e);\r\n      })\r\n\r\n      li.addEventListener(\"pointermove\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n      li.addEventListener(\"mouseenter\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      li.addEventListener(\"pointerover\", (e) => {\r\n        onfocus(e);\r\n        li.focus();\r\n      });\r\n\r\n      this.dom.appendChild(li);\r\n    }\r\n\r\n    return li;\r\n  }\r\n\r\n  _getBorderStyle() {\r\n    let r = this.getDefault(\"border-width\");\r\n    let s = this.getDefault(\"border-style\");\r\n    let c = this.getDefault(\"border-color\");\r\n\r\n    return `${r}px ${s} ${c}`;\r\n  }\r\n\r\n  buildStyle() {\r\n    let pad1 = util.isMobile() ? 2 : 0;\r\n    pad1 += this.getDefault(\"MenuSpacing\");\r\n\r\n    let boxShadow = \"\";\r\n    if (this.hasDefault(\"box-shadow\")) {\r\n      boxShadow = \"box-shadow: \" + this.getDefault(\"box-shadow\") + ';';\r\n    }\r\n\r\n    let sepcss = this.getDefault(\"MenuSeparator\");\r\n    if (typeof sepcss === \"object\") {\r\n      let s = '';\r\n\r\n      for (let k in sepcss) {\r\n        let v = sepcss[k];\r\n\r\n        if (typeof v === \"number\") {\r\n          v = v.toFixed(4) + \"px\";\r\n        }\r\n\r\n        s += `    ${k}: ${v};\\n`;\r\n      }\r\n\r\n      sepcss = s;\r\n    }\r\n\r\n    let itemRadius = 0;\r\n\r\n    if (this.hasDefault(\"item-radius\")) {\r\n      itemRadius = this.getDefault(\"item-radius\");\r\n    } else {\r\n      itemRadius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    this.menustyle.textContent = `\r\n        .menucon {\r\n          position:fixed;\r\n          float:left;\r\n          \r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n\r\n          display: block;\r\n          -moz-user-focus: normal;\r\n          ${boxShadow}\r\n        }\r\n        \r\n        ul.menu {\r\n          display        : flex;\r\n          flex-direction : column;\r\n          flex-wrap      : nowrap;\r\n          width          : max-content;\r\n          \r\n          margin : 0px;\r\n          padding : 0px;\r\n          border : ${this._getBorderStyle()};\r\n          border-radius : ${this.getDefault(\"border-radius\")}px;\r\n          -moz-user-focus: normal;\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n        }\r\n        \r\n        .menuitem {\r\n          display : flex;\r\n          flex-wrap : nowrap;\r\n          flex-direction : row;          \r\n          \r\n          list-style-type:none;\r\n          -moz-user-focus: normal;\r\n          \r\n          margin : 0;\r\n          padding : 0px;\r\n          padding-right: 16px;\r\n          padding-left: 16px;\r\n          padding-top : ${pad1}px;\r\n          padding-bottom : ${pad1}px;\r\n          \r\n          border-radius : ${itemRadius}px;\r\n          \r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          font : ${this.getDefault(\"MenuText\").genCSS()};\r\n          background-color: ${this.getDefault(\"MenuBG\")};\r\n        }\r\n        \r\n        .menuseparator {\r\n          ${sepcss}\r\n        }\r\n        \r\n        .menuitem:focus {\r\n          display : flex;\r\n          text-align: left;\r\n          \r\n          border : none;\r\n          outline : none;\r\n          border-radius : ${itemRadius}px;\r\n          \r\n          background-color: ${this.getDefault(\"MenuHighlight\")};\r\n          color : ${this.getDefault(\"MenuText\").color};\r\n          -moz-user-focus: normal;\r\n        }\r\n      `;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.buildStyle();\r\n\r\n    this.container.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n    this.style[\"color\"] = this.getDefault(\"MenuText\").color;\r\n  }\r\n\r\n  seperator() {\r\n    let bar = document.createElement(\"div\");\r\n    bar.setAttribute(\"class\", \"menuseparator\");\r\n\r\n    this.dom.appendChild(bar);\r\n\r\n    return this;\r\n  }\r\n\r\n  menu(title) {\r\n    let ret = UIBase.createElement(\"menu-x\");\r\n\r\n    ret.setAttribute(\"name\", title);\r\n    this.addItem(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  calcSize() {\r\n\r\n  }\r\n}\r\n\r\nMenu.SEP = Symbol(\"menu seperator\");\r\nUIBase.internalRegister(Menu);\r\n\r\nexport class DropBox extends OldButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this.lockTimer = 0;\r\n\r\n    this._template = undefined;\r\n\r\n    this._searchMenuMode = false;\r\n    this.altKey = undefined;\r\n\r\n    this._value = 0;\r\n\r\n    this._last_datapath = undefined;\r\n\r\n    this.r = 5;\r\n    this._menu = undefined;\r\n    this._auto_depress = false;\r\n    //this.prop = new ui_base.EnumProperty(undefined, {}, \"\", \"\", 0);\r\n\r\n    this._onpress = this._onpress.bind(this);\r\n  }\r\n\r\n  get searchMenuMode() {\r\n    return this._searchMenuMode;\r\n  }\r\n\r\n  set searchMenuMode(v) {\r\n    this._searchMenuMode = v;\r\n  }\r\n\r\n  get template() {\r\n    return this._template;\r\n  }\r\n\r\n  set template(v) {\r\n    this._template = v;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(v) {\r\n    this.setValue(v);\r\n  }\r\n\r\n  get menu() {\r\n    return this._menu;\r\n  }\r\n\r\n  set menu(val) {\r\n    this._menu = val;\r\n\r\n    if (val !== undefined) {\r\n      this._name = val.title;\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"dropbox-x\",\r\n      style  : \"dropbox\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"menu-button\", \"true\");\r\n\r\n    this.updateWidth();\r\n  }\r\n\r\n  setCSS() {\r\n    //do not call parent classes's setCSS here\r\n\r\n    this.style[\"user-select\"] = \"none\";\r\n    this.dom.style[\"user-select\"] = \"none\";\r\n\r\n    let keys;\r\n    if (this.getAttribute(\"simple\")) {\r\n      keys = [\"margin-left\", \"margin-right\", \"padding-left\", \"padding-right\"];\r\n    } else {\r\n      keys = [\r\n        \"margin\", \"margin-left\", \"margin-right\",\r\n        \"margin-top\", \"margin-bottom\", \"padding\",\r\n        \"padding-left\", \"padding-right\", \"padding-top\",\r\n        \"padding-bottom\"];\r\n    }\r\n\r\n    let setDefault = (key) => {\r\n      if (this.hasDefault(key)) {\r\n        this.style[key] = this.getDefault(key, undefined, 0) + \"px\";\r\n      }\r\n    }\r\n\r\n    for (let k of keys) {\r\n      setDefault(k);\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let s = super._genLabel();\r\n    let ret = \"\";\r\n\r\n    if (s.length === 0) {\r\n      s = \"(error)\";\r\n    }\r\n\r\n    this.altKey = s[0].toUpperCase().charCodeAt(0);\r\n\r\n    for (let i = 0; i < s.length; i++) {\r\n      if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] !== \"&\") {\r\n        this.altKey = s[i + 1].toUpperCase().charCodeAt(0);\r\n      } else if (s[i] === \"&\" && i < s.length - 1 && s[i + 1] === \"&\") {\r\n        continue;\r\n      } else {\r\n        ret += s[i];\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  updateWidth() {\r\n    //let ret = super.updateWidth(10);\r\n    let dpi = this.getDPI();\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n    let tw = this.g.measureText(this._genLabel()).width/dpi;\r\n    //let tw = ui_base.measureText(this, this._genLabel(), undefined, undefined, ts).width + 8;\r\n    tw = ~~tw;\r\n\r\n    tw += 15;\r\n\r\n    if (!this.getAttribute(\"simple\")) {\r\n      tw += 35;\r\n    }\r\n\r\n    if (tw !== this._last_w) {\r\n      this._last_w = tw;\r\n      this.dom.style[\"width\"] = tw + \"px\";\r\n      this.style[\"width\"] = tw + \"px\";\r\n      this.width = tw;\r\n\r\n      this.overrideDefault(\"width\", tw);\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  updateBorders() {\r\n    //Do not apply border stlying to the child canvas\r\n    super.updateBorders(this)\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let wasError = false;\r\n    let prop, val;\r\n\r\n    try {\r\n      this.pushReportContext(this._reportCtxName);\r\n      prop = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\")).prop;\r\n      val = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      prop = prop && prop.prop ? prop.prop : prop;\r\n\r\n      this.popReportContext();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      wasError = true;\r\n    }\r\n\r\n    if (wasError) {\r\n      this.disabled = true;\r\n      this.setCSS();\r\n      this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      this.disabled = false;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop === undefined) {\r\n      this.prop = prop;\r\n    }\r\n\r\n    prop = this.prop;\r\n\r\n    let name = this.getAttribute(\"name\");\r\n    \r\n    if (prop.type & (PropTypes.ENUM | PropTypes.FLAG)) {\r\n      name = prop.ui_value_names[prop.keys[val]];\r\n    } else {\r\n      name = \"\" + val;\r\n    }\r\n\r\n    if (name !== this.getAttribute(\"name\")) {\r\n      this.setAttribute(\"name\", name);\r\n      this.updateName();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (path && path !== this._last_datapath) {\r\n      this._last_datapath = path;\r\n      this.prop = undefined;\r\n\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n\r\n    let key = this.getDefault(\"dropTextBG\");\r\n    if (key !== this._last_dbox_key) {\r\n      this._last_dbox_key = key;\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  _build_menu_template() {\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    let template = this._template;\r\n\r\n    if (typeof template === \"function\") {\r\n      template = template();\r\n    }\r\n\r\n    this._menu = createMenu(this.ctx, \"\", template);\r\n    return this._menu;\r\n  }\r\n\r\n  _build_menu() {\r\n    if (this._template) {\r\n      this._build_menu_template();\r\n      return;\r\n    }\r\n\r\n    let prop = this.prop;\r\n\r\n    if (this.prop === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n      this._menu.remove();\r\n    }\r\n\r\n    let menu = this._menu = UIBase.createElement(\"menu-x\");\r\n\r\n    //let name = \"\" + this.getAttribute(\"name\");\r\n    menu.setAttribute(\"name\", \"\");\r\n    menu._dropbox = this;\r\n\r\n    let valmap = {};\r\n    let enummap = prop.values;\r\n    let iconmap = prop.iconmap;\r\n    let uimap = prop.ui_value_names;\r\n    let desr = prop.descriptions || {};\r\n\r\n    for (let k in enummap) {\r\n      let uk = k;\r\n\r\n      valmap[enummap[k]] = k;\r\n\r\n      if (uimap !== undefined && k in uimap) {\r\n        uk = uimap[k];\r\n      }\r\n\r\n      let tooltip = desr[k];\r\n\r\n      //menu.addItem(k, enummap[k], \":\");\r\n      if (iconmap && iconmap[k]) {\r\n        menu.addItemExtra(uk, enummap[k], undefined, iconmap[k], undefined, tooltip);\r\n      } else {\r\n        menu.addItem(uk, enummap[k], undefined, tooltip);\r\n      }\r\n    }\r\n\r\n    menu.onselect = (id) => {\r\n      this._pressed = false;\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      this._menu = undefined;\r\n\r\n      //check if datapath system will be calling .prop.setValue instead of us\r\n      let callProp = true;\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n        let prop = rdef.dpath.data;\r\n\r\n        callProp = !rdef || !rdef.dpath || !(rdef.dpath.data instanceof ToolProperty);\r\n      }\r\n\r\n      this._value = this._convertVal(id);\r\n\r\n      if (callProp) {\r\n        this.prop.setValue(id);\r\n      }\r\n\r\n      this.setAttribute(\"name\", this.prop.ui_value_names[valmap[id]]);\r\n      if (this.onselect) {\r\n        this.onselect(id);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\") && this.ctx) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), id);\r\n      }\r\n    };\r\n  }\r\n\r\n  _onpress(e) {\r\n    this.abortToolTips(1000);\r\n\r\n    if (this._menu !== undefined) {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      this._menu = undefined;\r\n      menu.close();\r\n      return;\r\n    }\r\n\r\n    if (util.time_ms() - this.lockTimer < 200) {\r\n      return;\r\n    }\r\n\r\n    this._build_menu();\r\n\r\n    if (this._menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    this._menu.autoSearchMode = false;\r\n\r\n    this._menu._dropbox = this;\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    this._background = this.getDefault(\"BoxDepressed\");\r\n    this._redraw();\r\n    this._pressed = true;\r\n    this.setCSS();\r\n\r\n    let onclose = this._menu.onclose;\r\n    this._menu.onclose = () => {\r\n      this.lockTimer = util.time_ms();\r\n\r\n      this._pressed = false;\r\n      this._redraw();\r\n\r\n      let menu = this._menu;\r\n      if (menu) {\r\n        this._menu = undefined;\r\n        menu._dropbox = undefined;\r\n      }\r\n\r\n      if (onclose) {\r\n        onclose.call(menu);\r\n      }\r\n    }\r\n\r\n    let menu = this._menu;\r\n    let screen = this.getScreen();\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let x = e.x, y = e.y;\r\n    let rects = this.dom.getBoundingClientRect(); //getClientRects();\r\n\r\n    let rheight = rects.height;\r\n    x = rects.x - window.scrollX;\r\n    y = rects.y + rheight - window.scrollY; // + rects[0].height; // visualViewport.scale;\r\n\r\n    if (!window.haveElectron) {\r\n      //y -= 8;\r\n    }\r\n\r\n    /* need to figure out a better way to pop up a menu\r\n    *  above a given y position */\r\n    if (cconst.menusCanPopupAbove && y > screen.size[1]*0.5 && !this.searchMenuMode) {\r\n      let con = screen.popup(this, 500, 400, false, 0);\r\n\r\n      con.style[\"z-index\"] = \"-10000\";\r\n      con.style[\"position\"] = UIBase.PositionKey;\r\n      document.body.appendChild(con);\r\n\r\n      con.style[\"visibility\"] = \"hidden\";\r\n\r\n      con.add(menu);\r\n      menu.start();\r\n\r\n      let time = util.time_ms();\r\n\r\n      let timer = window.setInterval(() => {\r\n        if (util.time_ms() - time > 1500) {\r\n          window.clearInterval(timer);\r\n          return;\r\n        }\r\n\r\n        let r = menu.dom.getBoundingClientRect();\r\n\r\n        if (!r || r.height < 55) {\r\n          return;\r\n        }\r\n\r\n        window.clearInterval(timer);\r\n\r\n        y -= r.height + rheight;\r\n\r\n        menu.dom.remove();\r\n        con.remove();\r\n\r\n        let popup = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n        popup.noMarginsOrPadding();\r\n\r\n        //popup.shadow.appendChild(menu.dom);\r\n        popup.add(menu);\r\n        menu.start();\r\n\r\n        popup.style[\"left\"] = x + \"px\";\r\n        popup.style[\"top\"] = y + \"px\";\r\n        //menu.setCSS();\r\n      }, 1);\r\n\r\n      return;\r\n    }\r\n\r\n    /*\r\n    let w = document.createElement(\"div\");\r\n    w.style[\"width\"] = w.style[\"height\"] = \"15px\";\r\n    w.style[\"background-color\"] = \"red\";\r\n    w.style[\"z-index\"] = \"5000\";\r\n    w.style[\"position\"] = UIBase.PositionKey;\r\n    w.style[\"pointer-events\"] = \"none\";\r\n    w.style[\"left\"] = x + \"px\";\r\n    w.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(w);\r\n    //*/\r\n\r\n    let con = this._popup = menu._popup = screen.popup(this, x, y, false, 0);\r\n    con.noMarginsOrPadding();\r\n\r\n    con.add(menu);\r\n    if (this.searchMenuMode) {\r\n      menu.startFancy();\r\n    } else {\r\n      menu.start();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.getAttribute(\"simple\")) {\r\n      let color;\r\n\r\n      this.g.clearRect(0, 0, this.dom.width, this.dom.height);\r\n      \r\n      if (this._highlight) {\r\n        ui_base.drawRoundBox2(this, {canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\")});\r\n      }\r\n\r\n      if (this._focus) {\r\n        ui_base.drawRoundBox2(this, {\r\n          canvas: this.dom, g: this.g, color: this.getDefault(\"BoxHighlight\"), op: \"stroke\", no_clear: true\r\n        });\r\n        ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined, 2, \"stroke\");\r\n      }\r\n\r\n      this._draw_text();\r\n      return;\r\n    }\r\n\r\n    super._redraw(false);\r\n\r\n    let g = this.g;\r\n    let w = this.dom.width, h = this.dom.height;\r\n    let dpi = this.getDPI();\r\n\r\n    let p = 10*dpi;\r\n    let p2 = dpi;\r\n\r\n    //*\r\n    let bg = this.getDefault(\"dropTextBG\");\r\n    if (bg !== undefined) {\r\n      g.fillStyle = bg;\r\n\r\n      g.beginPath();\r\n      g.rect(p2, p2, this.dom.width - p2 - h, this.dom.height - p2*2);\r\n      g.fill();\r\n    }\r\n    //*/\r\n\r\n    g.fillStyle = \"rgba(50, 50, 50, 0.2)\";\r\n    g.strokeStyle = \"rgba(50, 50, 50, 0.8)\";\r\n    g.beginPath();\r\n    /*\r\n    g.moveTo(w-p, p);\r\n    g.lineTo(w-(p+h*0.25), h-p);\r\n    g.lineTo(w-(p+h*0.5), p);\r\n    g.closePath();\r\n    //*/\r\n\r\n    let sz = 0.3;\r\n    g.moveTo(w - h*0.5 - p, p);\r\n    g.lineTo(w - p, p);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h/3);\r\n    g.lineTo(w - p, p + sz*h/3);\r\n    g.moveTo(w - h*0.5 - p, p + sz*h*2/3);\r\n    g.lineTo(w - p, p + sz*h*2/3);\r\n\r\n    g.lineWidth = 1;\r\n    g.stroke();\r\n\r\n    this._draw_text();\r\n  }\r\n\r\n  _convertVal(val) {\r\n    if (typeof val === \"string\" && this.prop) {\r\n      if (val in this.prop.values) {\r\n        return this.prop.values[val];\r\n      } else if (val in this.prop.keys) {\r\n        return this.prop.keys[val];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  setValue(val, setLabelOnly = false) {\r\n    if (val === undefined || val === this._value) {\r\n      return;\r\n    }\r\n\r\n    val = this._convertVal(val);\r\n\r\n    if (val === undefined) {\r\n      console.warn(\"Bad val\", arguments[0]);\r\n      return;\r\n    }\r\n\r\n    this._value = val;\r\n\r\n    if (this.prop !== undefined && !setLabelOnly) {\r\n      this.prop.setValue(val);\r\n      let val2 = val;\r\n\r\n      if (val2 in this.prop.keys)\r\n        val2 = this.prop.keys[val2];\r\n      val2 = this.prop.ui_value_names[val2];\r\n\r\n      this.setAttribute(\"name\", \"\" + val2);\r\n      this._name = \"\" + val2;\r\n    } else {\r\n      this.setAttribute(\"name\", \"\" + val);\r\n      this._name = \"\" + val;\r\n    }\r\n\r\n    if (this.onchange && !setLabelOnly) {\r\n      this.onchange(val);\r\n    }\r\n\r\n    this.setCSS();\r\n    this.updateDataPath();\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(DropBox);\r\n\r\nexport class MenuWrangler {\r\n  constructor() {\r\n    this.screen = undefined;\r\n    this.menustack = [];\r\n\r\n    this.lastPickElemTime = util.time_ms();\r\n\r\n    this._closetimer = 0;\r\n    this.closeOnMouseUp = undefined;\r\n    this.closereq = undefined;\r\n\r\n    this.timer = undefined;\r\n  }\r\n\r\n  get closetimer() {\r\n    return this._closetimer;\r\n  }\r\n\r\n  set closetimer(v) {\r\n    debugmenu(\"set closertime\", v);\r\n    this._closetimer = v;\r\n  }\r\n\r\n  get menu() {\r\n    return this.menustack.length > 0 ? this.menustack[this.menustack.length - 1] : undefined;\r\n  }\r\n\r\n  pushMenu(menu) {\r\n    debugmenu(\"pushMenu\");\r\n\r\n    this.spawnreq = undefined;\r\n\r\n    if (this.menustack.length === 0 && menu.closeOnMouseUp) {\r\n      this.closeOnMouseUp = true;\r\n    }\r\n\r\n    this.menustack.push(menu);\r\n  }\r\n\r\n  popMenu(menu) {\r\n    debugmenu(\"popMenu\");\r\n\r\n    return this.menustack.pop();\r\n  }\r\n\r\n  endMenus() {\r\n    debugmenu(\"endMenus\");\r\n\r\n    for (let menu of this.menustack) {\r\n      menu.close();\r\n    }\r\n\r\n    this.menustack = [];\r\n  }\r\n\r\n  searchKeyDown(e) {\r\n    let menu = this.menu;\r\n\r\n    e.stopPropagation();\r\n    menu._ignoreFocusEvents = true;\r\n    menu.textbox.focus();\r\n    menu._ignoreFocusEvents = false;\r\n\r\n    //if (e.shiftKey || e.altKey || e.ctrlKey || e.commandKey) {\r\n    //  return;\r\n    //}\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]: //return key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case keymap[\"Escape\"]: //escape key\r\n        menu.close();\r\n        break;\r\n      case keymap[\"Up\"]:\r\n        menu.selectPrev(false);\r\n        break;\r\n      case keymap[\"Down\"]:\r\n        menu.selectNext(false);\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    window.menu = this.menu;\r\n\r\n    if (this.menu === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.menu.hasSearchBox) {\r\n      return this.searchKeyDown(e);\r\n    }\r\n\r\n    let menu = this.menu;\r\n\r\n    switch (e.keyCode) {\r\n      case keymap[\"Left\"]: //left\r\n      case keymap[\"Right\"]: //right\r\n        if (menu._dropbox) {\r\n          let dropbox = menu._dropbox;\r\n\r\n          if (e.keyCode === keymap[\"Left\"]) {\r\n            dropbox = dropbox.previousElementSibling;\r\n          } else {\r\n            dropbox = dropbox.nextElementSibling;\r\n          }\r\n\r\n          if (dropbox !== undefined && dropbox instanceof DropBox) {\r\n            this.endMenus();\r\n            dropbox._onpress(e);\r\n          }\r\n        }\r\n        break;\r\n      case keymap[\"Up\"]: //up\r\n        menu.selectPrev();\r\n        break;\r\n      case keymap[\"Down\"]: //down\r\n        menu.selectNext();\r\n        break;\r\n      /*\r\n      let item = menu.activeItem;\r\n      if (!item) {\r\n        item = menu.items[0];\r\n      }\r\n\r\n      if (!item) {\r\n        return;\r\n      }\r\n\r\n      let item2;\r\n      let i = menu.items.indexOf(item);\r\n\r\n      if (e.keyCode == 38) {\r\n        i = (i - 1 + menu.items.length) % menu.items.length;\r\n      } else {\r\n        i = (i + 1) % menu.items.length;\r\n      }\r\n\r\n      item2 = menu.items[i];\r\n\r\n      if (item2) {\r\n        menu.setActive(item2);\r\n      }\r\n      break;//*/\r\n      case 13: //return key\r\n      case 32: //space key\r\n        menu.click(menu.activeItem);\r\n        break;\r\n      case 27: //escape key\r\n        menu.close();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element !== undefined && (element instanceof DropBox || util.isMobile())) {\r\n      this.endMenus();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element = screen.pickElement(x, y, undefined, undefined, DropBox);\r\n    if (element !== undefined) {\r\n      this.closeOnMouseUp = false;\r\n    } else {\r\n      element = screen.pickElement(x, y, undefined, undefined, Menu);\r\n\r\n      //closeOnMouseUp\r\n      if (element && this.closeOnMouseUp) {\r\n        element.click();\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  findMenu(x, y) {\r\n    let screen = this.screen;\r\n\r\n    let element = screen.pickElement(x, y);\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      return element;\r\n    }\r\n\r\n    let w = element;\r\n\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        return w;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    if (this.menu && this.menu.hasSearchBox) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    if (this.menu === undefined || this.screen === undefined) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n\r\n    let screen = this.screen;\r\n    let x = e.pageX, y = e.pageY;\r\n\r\n    let element;\r\n    let menu = this.menu;\r\n\r\n    if (menu) {\r\n      let r = menu.getBoundingClientRect();\r\n      let pad = 15;\r\n\r\n      if (r && x >= r.x - pad && y >= r.y - pad && x <= r.x + r.width + pad*2 && y <= r.y + r.height + pad*2) {\r\n        element = menu;\r\n      }\r\n    }\r\n\r\n    if (!element && util.time_ms() - this.lastPickElemTime > 250) {\r\n      element = screen.pickElement(x, y);\r\n      this.lastPickElemTime = util.time_ms();\r\n    }\r\n\r\n    if (element === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (element instanceof Menu) {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n      return;\r\n    }\r\n    \r\n    let destroy = element.hasAttribute(\"menu-button\") && element.hasAttribute(\"simple\");\r\n    destroy = destroy && element.menu !== this.menu;\r\n\r\n    if (destroy) {\r\n      /* check that dropbox doesn't contain our parent menu either */\r\n\r\n      let menu2 = this.menu;\r\n      while (menu2 !== element.menu) {\r\n        menu2 = menu2.parentMenu;\r\n        destroy = destroy && (menu2 === undefined || menu2 !== element.menu);\r\n      }\r\n    }\r\n\r\n    if (destroy) {\r\n      //destroy entire menu stack\r\n      this.endMenus();\r\n\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n\r\n      //start new menu\r\n      element._onpress(e);\r\n      return;\r\n    }\r\n\r\n    let ok = false;\r\n\r\n    let w = element;\r\n    while (w) {\r\n      if (w instanceof Menu) {//w === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      if (w.hasAttribute(\"menu-button\") && w.menu === this.menu) {\r\n        ok = true;\r\n        break;\r\n      }\r\n\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (!ok) {\r\n      this.closereq = this.menu;\r\n    } else {\r\n      this.closetimer = util.time_ms();\r\n      this.closereq = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let closetime = cconst.menu_close_time;\r\n    closetime = closetime === undefined ? 50 : closetime;\r\n\r\n    let close = this.closereq && this.closereq === this.menu;\r\n    close = close && util.time_ms() - this.closetimer > closetime;\r\n\r\n    if (close) {\r\n      this.closereq = undefined;\r\n      this.endMenus();\r\n    }\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer) {\r\n      this.stopTimer();\r\n    }\r\n\r\n    this.timer = setInterval(() => {\r\n      debugmenu(\"start menu wrangler interval\");\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  stopTimer() {\r\n    if (this.timer) {\r\n      debugmenu(\"stop menu wrangler interval\");\r\n\r\n      clearInterval(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nexport let menuWrangler = window._menuWrangler = new MenuWrangler();\r\nlet wrangerStarted = false;\r\n\r\nexport function startMenuEventWrangling(screen) {\r\n  menuWrangler.screen = screen;\r\n\r\n  if (wrangerStarted) {\r\n    return;\r\n  }\r\n\r\n  wrangerStarted = true;\r\n\r\n  for (let k in DomEventTypes) {\r\n    if (menuWrangler[k] === undefined) {\r\n      continue;\r\n    }\r\n\r\n    let dom = k.search(\"key\") >= 0 ? window : document.body;\r\n    dom = window;\r\n    dom.addEventListener(DomEventTypes[k], menuWrangler[k].bind(menuWrangler), {passive: false, capture: true})\r\n  }\r\n\r\n  menuWrangler.screen = screen;\r\n  menuWrangler.startTimer();\r\n}\r\n\r\nwindow._startMenuEventWrangling = startMenuEventWrangling;\r\n\r\nexport function setWranglerScreen(screen) {\r\n  startMenuEventWrangling(screen);\r\n}\r\n\r\nexport function getWranglerScreen() {\r\n  return menuWrangler.screen;\r\n}\r\n\r\nexport function createMenu(ctx, title, templ) {\r\n  let menu = UIBase.createElement(\"menu-x\");\r\n  menu.ctx = ctx;\r\n  menu.setAttribute(\"name\", title);\r\n\r\n  let SEP = menu.constructor.SEP;\r\n  let id = 0;\r\n  let cbs = {};\r\n\r\n  let doItem = (item) => {\r\n    if (item !== undefined && item instanceof Menu) {\r\n      menu.addItem(item);\r\n    } else if (typeof item == \"string\") {\r\n      let def, hotkey;\r\n\r\n      try {\r\n        def = ctx.api.getToolDef(item);\r\n      } catch (error) {\r\n        menu.addItem(\"(tool path error)\", id++);\r\n        return;\r\n      }\r\n\r\n      //3Extra(text, id=undefined, hotkey, icon=-1, add=true) {\r\n      if (!def.hotkey) {\r\n        try {\r\n          hotkey = ctx.api.getToolPathHotkey(ctx, item);\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          console.warn(\"error getting hotkey for tool \" + item);\r\n          hotkey = undefined;\r\n        }\r\n      } else {\r\n        hotkey = def.hotkey;\r\n      }\r\n\r\n      menu.addItemExtra(def.uiname, id, hotkey, def.icon);\r\n\r\n      cbs[id] = (function (toolpath) {\r\n        return function () {\r\n          ctx.api.execTool(ctx, toolpath);\r\n        }\r\n      })(item);\r\n\r\n      id++;\r\n    } else if (item === SEP) {\r\n      menu.seperator();\r\n    } else if (typeof item === \"function\" || item instanceof Function) {\r\n      doItem(item());\r\n    } else if (item instanceof Array) { //old array-based api for custom entries\r\n      let hotkey = item.length > 2 ? item[2] : undefined;\r\n      let icon = item.length > 3 ? item[3] : undefined;\r\n      let tooltip = item.length > 4 ? item[4] : undefined;\r\n      let id2 = item.length > 5 ? item[5] : id++;\r\n\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(item[0], id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(item[1], id2);\r\n    } else if (typeof item === \"object\") { //new object-based api for custom entries\r\n      let {name, callback, hotkey, icon, tooltip} = item;\r\n\r\n      let id2 = item.id !== undefined ? item.id : id++;\r\n      if (hotkey !== undefined && hotkey instanceof HotKey) {\r\n        hotkey = hotkey.buildString();\r\n      }\r\n\r\n      menu.addItemExtra(name, id2, hotkey, icon, undefined, tooltip);\r\n\r\n      cbs[id2] = (function (cbfunc, arg) {\r\n        return function () {\r\n          cbfunc(arg);\r\n        }\r\n      })(callback, id2);\r\n    }\r\n  }\r\n\r\n  for (let item of templ) {\r\n    doItem(item);\r\n  }\r\n\r\n  menu.onselect = (id) => {\r\n    cbs[id]();\r\n  }\r\n\r\n  return menu;\r\n}\r\n\r\nexport function startMenu(menu, x, y, searchMenuMode = false, safetyDelay = 55) {\r\n  menuWrangler.endMenus();\r\n\r\n  let screen = menu.ctx.screen;\r\n  let con = menu._popup = screen.popup(undefined, x, y, false, safetyDelay);\r\n  con.noMarginsOrPadding();\r\n\r\n  con.add(menu);\r\n  if (searchMenuMode) {\r\n    menu.startFancy();\r\n  } else {\r\n    menu.start();\r\n  }\r\n\r\n  menu.flushUpdate();\r\n  menu.flushSetCSS();\r\n\r\n  menu._popup.flushUpdate();\r\n  menu._popup.flushSetCSS();\r\n}\r\n"],
  "mappings": "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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAAC;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAAC;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAAC;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": ["exports", "define", "undefined", "value", "a", "i", "key", "MobileDetect", "atob", "btoa", "cachering", "color2css", "console", "list", "set", "termColor", "termColorMap", "termPrint", "k", "i", "a", "list", "e", "set", "count", "func", "fract", "f", "tent", "sign", "key", "i", "k", "s", "tokdef", "tokens", "tk", "list", "ret", "token", "val", "lexer", "parser", "func", "line", "tok", "a", "p", "n", "num", "j", "code", "cls", "tab", "manager", "obj", "keywords", "key", "val2", "json", "f2", "i2", "test", "lex", "first", "parent", "structName", "obj2", "keys", "fmt_type", "f", "type", "st", "st2", "cls2", "code2", "toJSON", "json2", "unpack_field", "stt", "load", "consoleLogger", "fromJSON", "value", "btoa", "atob", "f", "i", "a", "value", "f", "a", "test", "colormap", "termColorMap", "k", "termColor", "termPrint", "i", "s", "tokdef", "tokens", "tk", "val", "ret", "console", "args", "h", "keys", "key", "cls", "list", "count", "obj", "btoa", "atob", "color2css", "cachering", "func", "set", "key2", "e", "seed", "hash", "map", "start", "end", "i2", "j", "line", "tab", "k2", "obj", "k", "i", "args", "k", "BaseVector", "Vector3", "Vector3", "s", "s2", "i", "cls", "keys", "k", "j", "sin", "cos", "abs", "log", "asin", "exp", "acos", "atan", "pow", "sqrt", "floor", "ceil", "min", "max", "PI", "E", "ret", "sign", "BaseVector", "f", "a", "structName", "structType", "Vector4", "q", "Vector2", "obj", "cachering", "ctx", "a2", "idgen", "key", "keys", "k", "e", "list", "ret", "cls", "obj", "screen", "e2", "k2", "func", "args", "func2", "i", "ctx", "set", "count", "cls", "i", "k", "ctx", "key", "ret", "list", "val", "cachering", "Vector3", "sqrt", "ret", "i", "a", "min", "max", "feps", "a2", "end", "min2", "max2", "j", "cls", "k", "inherit", "parent", "set", "f", "i2", "isect", "clip", "v1", "v2", "pi", "cos", "sin", "t1", "t2", "t3", "u2", "w2", "du", "dv", "dw", "color2css", "a", "cachering", "css2color", "ret", "i", "k", "args", "val", "obj", "keys", "s", "k2", "theme", "stop", "e", "ret", "func", "obj", "exclude", "k", "i", "key", "h", "cls", "obj", "ret", "i", "j", "parent", "a", "min", "max", "f2", "j2", "val", "min", "max", "value", "i", "k", "map", "json", "f", "cls", "value", "i", "j", "val", "test", "list", "PropSubTypes", "k", "ToolProperty", "cls", "i", "f", "value", "termColor", "j", "obj", "val", "ret", "min", "max", "json", "exp", "key", "uiname", "map", "Vector3", "set", "cachering", "ToolProperty", "Vector3", "ret", "set", "min", "max", "f", "func", "exp", "i", "api", "list", "key", "obj", "val", "filter", "cls", "cls", "parent", "ContextOverlay", "k", "p", "def", "ctx", "keys", "ctx2", "i", "ret", "key", "cls", "InheritFlag", "modalstack", "ctx", "key", "api", "tdef", "f", "obj", "i", "k", "def", "stop", "ret", "a", "args", "val", "structName", "parent", "size", "e", "line", "c", "on_modal_end", "start", "toolop", "Vector2", "obj", "key", "val", "cachering", "a", "i", "ret", "ctx", "e", "_udigest", "j", "f2", "j2", "k", "b", "start", "end", "e2", "icon", "Icons", "slider", "f", "tent", "mySafeJSONStringify", "obj", "key", "mySafeJSONParse", "val", "_udigest", "cb", "i", "json", "k", "Vector3", "ret", "a", "cls", "f", "h", "i", "manager", "obj", "key", "value", "list", "val", "args", "lexer", "parser", "tokdef", "token", "token", "val", "lexer", "parser", "tokdef", "func", "i", "ret", "k", "tok", "start", "j", "test_parser", "tk", "tokens", "func", "tokdef", "tokens", "t", "p", "args", "lexer", "parser", "ret", "cls", "ctx", "value", "val", "val2", "i", "rdef", "ToolProperty", "ret", "ctx", "val", "rdef", "value", "massSetPath", "i", "value2", "ret", "paths", "key", "_udigest", "a", "ret", "obj", "val", "f", "i", "j", "parent", "pow", "bez3", "a", "bez4", "key", "val", "_udigest", "k", "i", "ret", "obj", "e", "a2", "ToolProperty", "PUTLParseError", "func", "tokdef", "lexer", "parser", "i", "cls", "console", "callbacks", "k", "key", "ret", "api", "list", "val", "obj", "PropSubTypes", "set", "ToolProperty", "parent", "ctx", "massSetPath", "value", "obj2", "keys", "prop", "num", "keymap", "args", "cachering", "ret", "h", "Vector3", "k", "k", "a", "cls", "obj", "key", "p", "descr", "keys", "k", "i", "ret", "RecalcFlags", "RecalcFlags", "cls", "key", "k", "obj", "cls", "Vector4", "EnumProperty", "prefix", "k", "k2", "report", "key", "e", "manager", "i", "icon", "manager2", "a", "UIBase", "sheet", "ret", "Vector2", "Matrix4", "first", "_idgen", "_digest", "obj", "val", "json", "e2", "element", "tab", "keys", "min", "max", "value", "args", "sign", "j", "key2", "val2", "set", "start", "stop", "clip", "isMouseDown", "clip2", "func", "timer", "ctx", "rdef", "parent", "trace", "f", "inherit", "theme", "list", "h", "line", "paths", "pi", "keymap", "EnumProperty", "PropTypes", "UIBase", "PackFlags", "IconSheets", "parsepx", "e", "val", "h", "key", "h2", "BaseVector", "PropSubTypes", "ToolProperty", "Vector3", "func", "k", "i", "j", "idgen", "ret", "i", "set", "e", "args", "min", "max", "a2", "key", "size", "n1", "err", "j", "timer", "EnumProperty", "PropTypes", "UIBase", "PackFlags", "IconSheets", "i", "e", "key", "val", "ret", "item", "k", "keys", "rdef", "prop", "menu", "con", "timer", "h", "val2", "element", "ctx", "id", "key", "i", "f", "args", "k", "j", "ipcRenderer", "e", "menu", "manager", "iconsheet", "map", "ret", "filter"]
}
