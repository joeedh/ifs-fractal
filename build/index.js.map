{
  "version": 3,
  "sources": ["../scripts/path.ux/scripts/widgets/ui_textbox.js", "../scripts/path.ux/scripts/widgets/ui_widgets.js", "../scripts/path.ux/scripts/core/ui.js", "../scripts/path.ux/scripts/screen/ScreenArea.js", "../scripts/path.ux/scripts/widgets/ui_noteframe.js", "../scripts/path.ux/scripts/widgets/ui_richedit.js", "../scripts/path.ux/scripts/widgets/ui_widgets2.js", "../scripts/path.ux/scripts/screen/FrameManager_ops.js", "../scripts/path.ux/scripts/screen/FrameManager_mesh.js", "../scripts/path.ux/scripts/widgets/theme_editor.js", "../scripts/path.ux/scripts/widgets/ui_numsliders.js", "../scripts/path.ux/scripts/xmlpage/xmlpage.js", "../scripts/path.ux/scripts/path-controller/curve/curve1d_utils.js", "../scripts/path.ux/scripts/widgets/ui_curvewidget.js", "../scripts/path.ux/scripts/widgets/ui_panel.js", "../scripts/path.ux/scripts/widgets/ui_colorpicker2.js", "../scripts/path.ux/scripts/widgets/ui_tabs.js", "../scripts/path.ux/scripts/widgets/ui_table.js", "../scripts/path.ux/scripts/widgets/ui_listbox.js", "../scripts/path.ux/scripts/widgets/ui_progress.js", "../scripts/path.ux/scripts/widgets/ui_lasttool.js", "../scripts/path.ux/scripts/platforms/platform.js", "../scripts/path.ux/scripts/util/ScreenOverdraw.js", "../scripts/path.ux/scripts/widgets/ui_treeview.js", "../scripts/path.ux/scripts/widgets/dragbox.js", "../scripts/path.ux/scripts/screen/AreaDocker.js", "../scripts/path.ux/scripts/widgets/ui_dialog.js", "../scripts/path.ux/scripts/screen/FrameManager.js", "../scripts/path.ux/scripts/simple/simple.js", "../scripts/path.ux/scripts/simple/editor.js", "../scripts/path.ux/scripts/simple/iconsheet.js", "../scripts/path.ux/scripts/simple/icons.js", "../scripts/path.ux/scripts/simple/file.js", "../scripts/path.ux/scripts/simple/menubar.js", "../scripts/path.ux/scripts/simple/app_ops.js", "../scripts/path.ux/scripts/simple/app.js", "../scripts/path.ux/scripts/simple/context_class.js", "../scripts/path.ux/scripts/pathux.js", "../scripts/core/mesh_base.ts", "../scripts/config/config.js", "../scripts/toolmode/toolmode_base.ts", "../scripts/core/bezier.js", "../scripts/core/mesh.ts", "../scripts/core/workspace.ts", "../scripts/core/property_templ.ts", "../scripts/core/image_wrangler.js", "../scripts/core/mesh_utils.ts", "../scripts/core/transform_ops.js", "../scripts/core/mesh_ops.ts", "../scripts/core/mesh_selectops.ts", "../scripts/core/toolModeSet.ts", "../scripts/core/context.ts", "../assets/icon_enum.js", "../scripts/core/properties.ts", "../scripts/toolmode/toolmode_mesh.ts", "../scripts/toolmode/toolmode_pen.ts", "../scripts/core/app.ts", "../scripts/index.ts"],
  "sourcesContent": ["\"use strict\";\r\n\r\nimport * as units from '../core/units.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3, Vector4, Matrix4, Quat} from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button} from './ui_button.js';\r\nimport {_setTextboxClass} from '../core/ui_base.js';\r\n\r\nexport class TextBoxBase extends UIBase {\r\n  static define() {\r\n    return {\r\n      modalKeyEvents: true\r\n    }\r\n  }\r\n}\r\n\r\nexport class TextBox extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._editing = false;\r\n\r\n    this._width = this.getDefault(\"width\") + \"px\";\r\n    this._textBoxEvents = true;\r\n\r\n    let margin = Math.ceil(3*this.getDPI());\r\n\r\n    this._had_error = false;\r\n\r\n    this.decimalPlaces = undefined; //will inherit from property defaults\r\n\r\n    this.baseUnit = undefined; //will automatically use defaults\r\n    this.displayUnit = undefined; //will automatically use defaults\r\n\r\n    this.dom = document.createElement(\"input\");\r\n\r\n    this.dom.tabIndex = 0;\r\n    this.dom.setAttribute(\"tabindex\", 0);\r\n    this.dom.setAttribute(\"tab-index\", 0);\r\n    this.dom.style[\"margin\"] = margin + \"px\";\r\n\r\n    this.dom.setAttribute(\"type\", \"textbox\");\r\n    this.dom.onchange = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.radix = 16;\r\n\r\n    this.dom.oninput = (e) => {\r\n      this._change(this.dom.value);\r\n    }\r\n\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.dom.addEventListener(\"focus\", (e) => {\r\n      console.log(\"Textbox focus\", this.isModal);\r\n\r\n      this._focus = 1;\r\n\r\n      if (this.isModal) {\r\n        this._startModal();\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n    this.dom.addEventListener(\"blur\", (e) => {\r\n      console.log(\"Textbox blur\");\r\n\r\n      this._focus = 0;\r\n\r\n      if (this._modal) {\r\n        this._endModal(true);\r\n        this.setCSS();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  get startSelected() {\r\n    let b = (\"\" + this.getAttribute(\"start-selected\")).toLowerCase();\r\n\r\n    return b === \"yes\" || b === \"true\" || b === \"on\" || b === \"1\";\r\n  }\r\n\r\n  set startSelected(v) {\r\n    this.setAttribute(\"start-selected\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  /** realtime dom attribute getter, defaults to true in absence of attribute*/\r\n  get realtime() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return true;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set realtime(val) {\r\n    this.setAttribute('realtime', val ? 'true' : 'false');\r\n  }\r\n\r\n  get isModal() {\r\n    let ret = this.getAttribute(\"modal\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'yes' || ret === 'true' || ret === 'on';\r\n  }\r\n\r\n  set isModal(val) {\r\n    this.setAttribute('modal', val ? 'true' : 'false');\r\n  }\r\n\r\n  _startModal() {\r\n    if (this.startSelected) {\r\n      this.select();\r\n    }\r\n\r\n    console.warn(\"textbox modal\");\r\n\r\n    if (this._modal) {\r\n      this._endModal(true);\r\n    }\r\n\r\n    this._editing = true;\r\n\r\n    let ignore = 0;\r\n\r\n    let finish = (ok) => {\r\n      this._endModal(ok);\r\n    }\r\n\r\n    let keydown = (e) => {\r\n      e.stopPropagation();\r\n\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n          finish(true);\r\n          break;\r\n        case keymap.Escape:\r\n          finish(false);\r\n          break;\r\n      }\r\n\r\n      return;\r\n      if (ignore) return;\r\n\r\n      let e2 = new KeyboardEvent(e.type, e);\r\n\r\n      ignore = 1;\r\n      this.dom.dispatchEvent(e2);\r\n      ignore = 0;\r\n    };\r\n\r\n    this._modal = true;\r\n    this.pushModal({\r\n      on_mousemove: (e) => {\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_keydown : keydown,\r\n      on_keypress: keydown,\r\n      on_keyup   : keydown,\r\n\r\n      on_mousedown: (e) => {\r\n        e.stopPropagation();\r\n        console.log(\"mouse down\", e, e.x, e.y);\r\n      }\r\n    }, false)\r\n  }\r\n\r\n  _flash_focus() {\r\n    //don't focus on flash\r\n  }\r\n\r\n  get editing() {\r\n    return this._editing;\r\n  }\r\n\r\n  _endModal(ok) {\r\n    console.log(\"textbox end modal\");\r\n\r\n    this._editing = false;\r\n\r\n    this._modal = false;\r\n    this.popModal();\r\n\r\n    this.blur();\r\n\r\n    if (this.onend) {\r\n      this.onend(ok);\r\n    } else {\r\n      this._updatePathVal(this.dom.value);\r\n    }\r\n\r\n    this.blur();\r\n  }\r\n\r\n  get tabIndex() {\r\n    return this.dom.tabIndex;\r\n  }\r\n\r\n  set tabIndex(val) {\r\n    this.dom.tabIndex = val;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    //set isModal default\r\n    if (!this.hasAttribute('modal')) {\r\n      this.isModal = true;\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"width\"] = this._width;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  set width(val) {\r\n    if (typeof val === \"number\") {\r\n      val += \"px\";\r\n    }\r\n\r\n    this._width = val;\r\n    this.style[\"width\"] = val;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.overrideDefault(\"background-color\", this.getDefault(\"background-color\"));\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    if (this.getDefault(\"background-color\")) {\r\n      this.dom.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    this.dom.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    let bwid = this.getDefault(\"border-width\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n    let bstyle = this.getDefault(\"border-style\");\r\n    let border = `${bwid}px ${bstyle} ${bcolor}`\r\n\r\n    this.style[\"border\"] = border;\r\n    this.style[\"border-color\"] = bcolor;\r\n\r\n    if (this._focus) {\r\n      this.dom.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.dom.style[\"border\"] = border;\r\n      this.dom.style[\"border-color\"] = bcolor;\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.dom.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.dom.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n      this.dom.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n    this.dom.style[\"width\"] = \"100%\";\r\n    this.dom.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n    if (this._focus || this._flashtimer !== undefined || (this._had_error && this._focus)) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val === undefined || val === null) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let text = this.text;\r\n\r\n    if (!prop) {\r\n      console.error(\"datapath error \" + this.getAttribute(\"datapath\"), val);\r\n      return;\r\n    }\r\n\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (is_int && this.radix === 2) {\r\n        text = val.toString(this.radix);\r\n        text = \"0b\" + text;\r\n      } else if (is_int && this.radix === 16) {\r\n        text += \"h\";\r\n      } else {\r\n        text = units.buildString(val, baseUnit, decimalPlaces, displayUnit);\r\n      }\r\n    } else if (prop !== undefined && prop.type === PropTypes.STRING) {\r\n      text = val;\r\n    }\r\n\r\n    if (this.text !== text) {\r\n      this.text = text;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.dom.style[\"width\"] !== this.style[\"width\"]) {\r\n      this.dom.style[\"width\"] = this.style[\"width\"];\r\n    }\r\n    if (this.dom.style[\"height\"] !== this.style[\"height\"]) {\r\n      this.dom.style[\"height\"] = this.style[\"height\"];\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  select() {\r\n    this.dom.select();\r\n    //return this.dom.select.apply(this, arguments);\r\n  }\r\n\r\n  focus() {\r\n    return this.dom.focus();\r\n  }\r\n\r\n  blur() {\r\n    return this.dom.blur();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname       : \"textbox-x\",\r\n      style         : \"textbox\",\r\n      modalKeyEvents: true\r\n    };\r\n  }\r\n\r\n  get text() {\r\n    return this.dom.value;\r\n  }\r\n\r\n  set text(value) {\r\n    this.dom.value = value;\r\n  }\r\n\r\n  _prop_update(prop, text) {\r\n    let is_num = prop.type & (PropTypes.FLOAT | PropTypes.INT);\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (typeof val === \"number\" && (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4 | PropTypes.QUAT))) {\r\n      is_num = true;\r\n    }\r\n\r\n    if (is_num) {\r\n      let is_int = prop.type === PropTypes.INT;\r\n\r\n      this.radix = prop.radix;\r\n\r\n      let decimalPlaces = this.decimalPlaces !== undefined ? this.decimalPlaces : prop.decimalPlaces;\r\n      if (this.hasAttribute(\"decimalPlaces\")) {\r\n        decimalPlaces = parseInt(this.getAttribute(\"decimalPlaces\"));\r\n      }\r\n\r\n      let baseUnit = this.baseUnit ?? prop.baseUnit;\r\n      if (this.hasAttribute(\"baseUnit\")) {\r\n        baseUnit = this.getAttribute(\"baseUnit\");\r\n      }\r\n\r\n      let displayUnit = this.displayUnit ?? prop.displayUnit;\r\n      if (this.hasAttribute(\"displayUnit\")) {\r\n        displayUnit = this.getAttribute(\"displayUnit\");\r\n      }\r\n\r\n      if (!units.isNumber(text.trim())) {\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.focus();\r\n        this.dom.focus();\r\n        this._had_error = true;\r\n      } else {\r\n        let val = units.parseValue(text, baseUnit, displayUnit);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n        }\r\n\r\n        this._had_error = false;\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n      }\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      try {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.text);\r\n\r\n        if (this._had_error) {\r\n          this.flash(ui_base.ErrorColors.OK, this.dom, undefined, false);\r\n          this.dom.focus();\r\n        }\r\n\r\n        this._had_error = false;\r\n      } catch (error) {\r\n        console.log(error.stack);\r\n        console.log(error.message);\r\n        console.warn(\"textbox error!\");\r\n        //this._had_error = true;\r\n\r\n        this.flash(ui_base.ErrorColors.ERROR, this.dom, undefined, false);\r\n        this.dom.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  _updatePathVal(text) {\r\n    if (this.hasAttribute(\"datapath\") && this.ctx !== undefined) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n      console.log(prop);\r\n\r\n      if (prop) {\r\n        this._prop_update(prop, text);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  _change(text) {\r\n    if (this.realtime) {\r\n      this._updatePathVal(text);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(text);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TextBox);\r\n\r\n/**\r\n\r\n Returns false if it's safe to call preventDefault.\r\n\r\n Returns true if the element at position x,y is\r\n either a textbox or is draggable.\r\n */\r\nexport function checkForTextBox(screen, x, y) {\r\n  let p = screen.pickElement(x, y);\r\n  //console.log(p, x, y);\r\n\r\n  while (p) {\r\n    //don't prevent draggable elements from dragging\r\n    if (p.draggable) {\r\n      return true;\r\n    }\r\n\r\n    if (p instanceof UIBase) {\r\n      //check immediate children of p\r\n      for (let i = 0; i < 2; i++) {\r\n        let nodes = i ? p.childNodes : p.shadow.childNodes;\r\n\r\n        for (let child of nodes) {\r\n          if (child.draggable) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    let ok = p instanceof TextBoxBase;\r\n    ok = ok || p.constructor.define && p.constructor.define().modalKeyEvents;\r\n\r\n    if (ok) {\r\n      return true;\r\n    }\r\n\r\n    p = p.parentWidget ? p.parentWidget : p.parentNode;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nui_base._setTextboxClass(TextBox);\r\n", "\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport {DataPathError} from '../path-controller/controller/controller.js';\r\nimport {Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\nimport * as units from '../core/units.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nfunction myToFixed(s, n) {\r\n  s = s.toFixed(n);\r\n\r\n  while (s.endsWith('0')) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n  if (s.endsWith(\"\\.\")) {\r\n    s = s.slice(0, s.length - 1);\r\n  }\r\n\r\n  return s;\r\n}\r\n\r\nlet keymap = events.keymap;\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet parsepx = ui_base.parsepx;\r\n\r\nimport {Button, OldButton} from './ui_button.js';\r\nimport {eventWasTouch, popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport {Button} from './ui_button.js';\r\n\r\nexport class IconLabel extends UIBase {\r\n  constructor() {\r\n    super();\r\n    this._icon = -1;\r\n    this.iconsheet = 1;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(id) {\r\n    this._icon = id;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"icon-label-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n\r\n\r\n    ui_base.iconmanager.setCSS(this.icon, this);\r\n\r\n    this.style[\"width\"] = size + \"px\";\r\n    this.style[\"height\"] = size + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconLabel);\r\n\r\nexport class ValueButtonBase extends OldButton {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) return;\r\n    if (this.ctx === undefined) return;\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) this._redraw();\r\n\r\n      return;\r\n    } else {\r\n      let redraw = this.disabled;\r\n\r\n      this.internalDisabled = false;\r\n      if (redraw) this._redraw();\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      this._value = val;\r\n      this.updateWidth();\r\n      this._repos_canvas();\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateDataPath();\r\n\r\n    super.update();\r\n  }\r\n}\r\n\r\nexport class Check extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = false;\r\n    this._highlight = false;\r\n    this._focus = false;\r\n\r\n    let shadow = this.shadow;\r\n\r\n    //let form = document.createElement(\"form\");\r\n\r\n    let span = document.createElement(\"span\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n\r\n    span.style[\"display\"] = \"flex\";\r\n    span.style[\"flex-direction\"] = \"row\";\r\n    span.style[\"margin\"] = span.style[\"padding\"] = \"0px\";\r\n    //span.style[\"background\"] = ui_base.iconmanager.getCSS(1);\r\n\r\n    let sheet = 0;\r\n    let size = ui_base.iconmanager.getTileSize(0);\r\n\r\n    let check = this.canvas = document.createElement(\"canvas\");\r\n    this.g = check.getContext(\"2d\");\r\n\r\n    check.setAttribute(\"id\", check._id);\r\n    check.setAttribute(\"name\", check._id);\r\n\r\n    let mdown = (e) => {\r\n      this._highlight = false;\r\n      this.checked = !this.checked;\r\n    };\r\n\r\n    let mup = (e) => {\r\n      this._highlight = false;\r\n      this.blur();\r\n      this._redraw();\r\n    };\r\n\r\n    let mover = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    };\r\n\r\n    let mleave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    };\r\n\r\n    span.addEventListener(\"pointerover\", mover, {passive: true});\r\n    span.addEventListener(\"mousein\", mover, {passive: true});\r\n    span.addEventListener(\"mouseleave\", mleave, {passive: true});\r\n    span.addEventListener(\"pointerout\", mleave, {passive: true});\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = this._focus = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focusin\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"focus\", (e) => {\r\n      this._focus = true;\r\n      this._redraw();\r\n    });\r\n\r\n\r\n    span.addEventListener(\"pointerdown\", mdown, {passive: true});\r\n    span.addEventListener(\"pointerup\", mup, {passive: true});\r\n    span.addEventListener(\"pointercancel\", mup, {passive: true});\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          this._highlight = undefined;\r\n          this._redraw();\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          this.blur();\r\n          break;\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.checked = !this.checked;\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          break;\r\n      }\r\n    });\r\n    this.checkbox = check;\r\n\r\n    span.appendChild(check);\r\n\r\n    let label = this._label = document.createElement(\"label\");\r\n    label.setAttribute(\"class\", \"checkx\");\r\n    span.setAttribute(\"class\", \"checkx\");\r\n    label.style[\"align-self\"] = \"center\";\r\n\r\n    let side = this.getDefault(\"CheckSide\");\r\n    if (side === \"right\") {\r\n      span.prepend(label);\r\n    } else {\r\n      span.appendChild(label);\r\n    }\r\n\r\n    shadow.appendChild(span);\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return super.internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    if (!!this.internalDisabled === !!val) {\r\n      return;\r\n    }\r\n\r\n    super.internalDisabled = val;\r\n    this._redraw();\r\n  }\r\n\r\n  get value() {\r\n    return this.checked;\r\n  }\r\n\r\n  set value(v) {\r\n    this.checked = v;\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(v) {\r\n    v = !!v;\r\n\r\n    if (this._checked !== v) {\r\n      this._checked = v;\r\n\r\n      this.setCSS();\r\n\r\n      //this.dom.checked = v;\r\n      this._redraw();\r\n\r\n      if (this.onclick) {\r\n        this.onclick(v);\r\n      }\r\n      if (this.onchange) {\r\n        this.onchange(v);\r\n      }\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._checked);\r\n      }\r\n    }\r\n  }\r\n\r\n  get label() {\r\n    return this._label.textContent;\r\n  }\r\n\r\n  set label(l) {\r\n    this._label.textContent = l;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check-x\",\r\n      style      : \"checkbox\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"class\", \"checkx\");\r\n\r\n\r\n    let style = document.createElement(\"style\");\r\n    //let style = this.cssStyleTag();\r\n\r\n    let color = this.getDefault(\"focus-border-color\");\r\n\r\n    style.textContent = `\r\n      .checkx:focus {\r\n        outline : none;\r\n      }\r\n    `;\r\n\r\n    //document.body.prepend(style);\r\n    this.prepend(style);\r\n  }\r\n\r\n  setCSS() {\r\n    this._label.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this._label.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n\r\n    this._label.style['font'] = 'normal 14px poppins'; // TODO - Jordan - add to settings\r\n\r\n    super.setCSS();\r\n\r\n    //force clear background\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    let redraw = false;\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      redraw = this.internalDisabled;\r\n\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    redraw = redraw || !!this._checked !== !!val;\r\n\r\n    if (redraw) {\r\n      this._checked = val;\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n  }\r\n\r\n  _redraw() {\r\n    if (this.canvas === undefined) {\r\n      //flag update\r\n      this._updatekey = \"\";\r\n      return;\r\n    }\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n    let dpi = UIBase.getDPI();\r\n    let tilesize = ui_base.iconmanager.getTileSize(0);\r\n    let pad = this.getDefault(\"padding\");\r\n\r\n    let csize = tilesize + pad*2;\r\n\r\n    canvas.style[\"margin\"] = \"2px\";\r\n    canvas.style[\"width\"] = csize + \"px\";\r\n    canvas.style[\"height\"] = csize + \"px\";\r\n\r\n    csize = ~~(csize*dpi + 0.5);\r\n    tilesize = ~~(tilesize*dpi + 0.5);\r\n\r\n    canvas.width = csize;\r\n    canvas.height = csize;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fill();\r\n\r\n    let color;\r\n\r\n    if (!this._checked && this._highlight) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    }\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, undefined, color);\r\n    if (this._checked) {\r\n      //canvasDraw(elem, canvas, g, icon, x=0, y=0, sheet=0) {\r\n      let x = (csize - tilesize)*0.5, y = (csize - tilesize)*0.5;\r\n      ui_base.iconmanager.canvasDraw(this, canvas, g, ui_base.Icons.LARGE_CHECK, x, y);\r\n    }\r\n\r\n    if (this._focus) {\r\n      color = this.getDefault(\"focus-border-color\");\r\n      g.lineWidth *= dpi;\r\n      ui_base.drawRoundBox(this, canvas, g, undefined, undefined, undefined, \"stroke\", color);\r\n    }\r\n  }\r\n\r\n  updateDPI() {\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      this._last_dpi = dpi;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDPI();\r\n\r\n    let ready = ui_base.getIconManager().isReady(0);\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    let updatekey = this.getDefault(\"DefaultText\").hash();\r\n    updatekey += this._checked + \":\" + this._label.textContent;\r\n    updatekey += \":\" + ready;\r\n\r\n    if (updatekey !== this._updatekey) {\r\n      this._repos_canvas();\r\n      this.setCSS();\r\n\r\n      this._updatekey = updatekey;\r\n      this._redraw();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check);\r\n\r\nexport class IconButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._customIcon = undefined;\r\n\r\n    this._pressed = false;\r\n    this._highlight = false;\r\n    this._draw_pressed = true;\r\n\r\n    this._icon = -1;\r\n    this._icon_pressed = undefined;\r\n    this.iconsheet = 0;\r\n    this.drawButtonBG = true;\r\n\r\n    this._extraIcon = undefined; //draw another icon on top\r\n\r\n    this.extraDom = undefined;\r\n\r\n    //have to put icon in subdiv\r\n    this.dom = document.createElement(\"div\");\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this._last_iconsheet = undefined;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Enter\"]:\r\n        case keymap[\"Space\"]:\r\n          this.click();\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  click() {\r\n    if (this._onpress) {\r\n      let rect = this.getClientRects();\r\n      let x = rect.x + rect.width*0.5;\r\n      let y = rect.y + rect.height*0.5;\r\n\r\n      let e = {x : x, y : y, stopPropagation : () => {}, preventDefault : () => {}};\r\n\r\n      this._onpress(e);\r\n    }\r\n\r\n    super.click();\r\n  }\r\n\r\n  get customIcon() {\r\n    return this._customIcon;\r\n  }\r\n\r\n  set customIcon(domImage) {\r\n    this._customIcon = domImage;\r\n    this.setCSS();\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"iconbutton-x\",\r\n      style  : \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _on_press() {\r\n    this._pressed = true;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    this._pressed = false;\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let def;\r\n    let pstyle = this.getDefault(\"depressed\");\r\n    let hstyle = this.getDefault(\"highlight\");\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    if (this._pressed && this._draw_pressed) {\r\n      def = k => this.getSubDefault(\"depressed\", k);\r\n    } else if (this._highlight) {\r\n      def = k => this.getSubDefault(\"highlight\", k);\r\n    } else {\r\n      def = k => this.getDefault(k);\r\n    }\r\n\r\n    let loadstyle = (key, addpx) => {\r\n      let val = def(key);\r\n      if (addpx) {\r\n        val = (\"\" + val).trim();\r\n\r\n        if (!val.toLowerCase().endsWith(\"px\")) {\r\n          val += \"px\";\r\n        }\r\n      }\r\n\r\n      this.style[key] = val;\r\n    }\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-left\", \"margin-right\", \"margin-top\", \"margin-botton\",\r\n                \"padding-left\", \"padding-bottom\", \"padding-top\", \"padding-right\",\r\n                \"border-radius\"]\r\n\r\n    for (let k of keys) {\r\n      loadstyle(k, true);\r\n    }\r\n    loadstyle(\"background-color\", false);\r\n    loadstyle(\"color\", false);\r\n\r\n    let border = `${def(\"border-width\", true)} ${def(\"border-style\", false)} ${def(\"border-color\", false)}`\r\n    this.style[\"border\"] = border;\r\n\r\n    let w = this.getDefault(\"width\");\r\n\r\n    let size = ui_base.iconmanager.getTileSize(this.iconsheet);\r\n    w = size;\r\n\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = w + \"px\";\r\n\r\n    this.dom.style[\"width\"] = w + \"px\";\r\n    this.dom.style[\"height\"] = w + \"px\";\r\n    this.dom.style[\"margin\"] = this.dom.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (this._customIcon) {\r\n      this.dom.style[\"background-image\"] = `url(\"${this._customIcon.src}\")`\r\n      this.dom.style[\"background-size\"] = \"contain\";\r\n      this.dom.style[\"background-repeat\"] = \"no-repeat\";\r\n    } else {\r\n      let icon = this.icon;\r\n\r\n      if (this._pressed && this._icon_pressed !== undefined) {\r\n        icon = this._icon_pressed;\r\n      }\r\n\r\n      ui_base.iconmanager.setCSS(icon, this.dom, this.iconsheet);\r\n    }\r\n\r\n    if (this._extraIcon !== undefined) {\r\n      let dom;\r\n\r\n      if (!this.extraDom) {\r\n        this.extraDom = dom = document.createElement(\"div\");\r\n\r\n        this.shadow.appendChild(dom);\r\n      } else {\r\n        dom = this.extraDom;\r\n      }\r\n\r\n      dom.style[\"position\"] = \"absolute\";\r\n      dom.style[\"margin\"] = dom.style[\"padding\"] = \"0px\";\r\n      dom.style[\"pointer-events\"] = \"none\";\r\n      dom.style[\"width\"] = size + \"px\";\r\n      dom.style[\"height\"] = size + \"px\";\r\n\r\n      ui_base.iconmanager.setCSS(this._extraIcon, dom, this.iconsheet);\r\n    } else if (this.extraDom) {\r\n      this.extraDom.remove();\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let press = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      if (this.modalRunning) {\r\n        this.popModal();\r\n      }\r\n\r\n      if (!eventWasTouch(e) && e.button !== 0) {\r\n        return;\r\n      }\r\n\r\n      if (1) { //!eventWasTouch(e)) {\r\n        let this2 = this;\r\n\r\n        this.pushModal({\r\n          on_mouseup(e) {\r\n            //touch events aren't fireing onclick automatically the way mouse ones are\r\n\r\n            if (this2.onclick && eventWasTouch(e)) {\r\n              this2.onclick();\r\n            }\r\n            this.end();\r\n          },\r\n          on_touchcancel(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_touchend(e) {\r\n            this.on_mouseup(e);\r\n            this.end();\r\n          },\r\n          on_keydown(e) {\r\n            this.end();\r\n          },\r\n          end() {\r\n            if (this2.modalRunning) {\r\n              this2.popModal();\r\n              this2._on_depress(e)\r\n              this2.setCSS();\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      this._on_press(e);\r\n    }\r\n\r\n    let depress = (e) => {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      this._on_depress();\r\n      this.setCSS();\r\n    }\r\n\r\n    let high = (e) => {\r\n      this._highlight = true;\r\n      this.setCSS();\r\n    }\r\n\r\n    let unhigh = (e) => {\r\n      this._highlight = false;\r\n      this.setCSS();\r\n    }\r\n\r\n    this.tabIndex = 0;\r\n\r\n    this.addEventListener(\"mouseover\", high);\r\n    this.addEventListener(\"mouseexit\", unhigh);\r\n    this.addEventListener(\"mouseleave\", unhigh);\r\n    this.addEventListener(\"focus\", high);\r\n    this.addEventListener(\"blur\", unhigh);\r\n\r\n    this.addEventListener(\"mousedown\", press, {capture: true});\r\n    this.addEventListener(\"mouseup\", depress, {capture: true});\r\n    //this.addEventListener(\"touchstart\", press, {capture: true});\r\n    //this.addEventListener(\"touchcancel\", depress, {capture: true});\r\n    //this.addEventListener(\"touchend\", depress, {capture: true});\r\n    this.setCSS();\r\n\r\n    this.dom.style[\"pointer-events\"] = \"none\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.iconsheet !== this._last_iconsheet) {\r\n      this.setCSS();\r\n      this._last_iconsheet = this.iconsheet;\r\n    }\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconButton);\r\n\r\n\r\nexport class IconCheck extends IconButton {\r\n  constructor() {\r\n    super();\r\n\r\n    this._checked = undefined;\r\n    this._drawCheck = undefined;\r\n  }\r\n\r\n  get drawCheck() {\r\n    let ret = this._drawCheck;\r\n\r\n    ret = ret === undefined ? this.getDefault(\"drawCheck\") : ret;\r\n    ret = ret === undefined ? true : ret;\r\n\r\n    return ret;\r\n  }\r\n\r\n  set drawCheck(val) {\r\n    val = !!val;\r\n\r\n    if (val && (this.packflag & PackFlags.HIDE_CHECK_MARKS)) {\r\n      this.packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n\r\n    let old = !!this.drawCheck;\r\n    this._drawCheck = val;\r\n\r\n    if (val !== old) {\r\n      this.updateDrawCheck();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  click() {\r\n    super.click();\r\n    this.checked ^= true;\r\n  }\r\n\r\n  get icon() {\r\n    return this._icon;\r\n  }\r\n\r\n  set icon(val) {\r\n    this._icon = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  get checked() {\r\n    return this._checked;\r\n  }\r\n\r\n  set checked(val) {\r\n    if (!!val !== !!this._checked) {\r\n      this._checked = val\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(val);\r\n      }\r\n    }\r\n  }\r\n\r\n  get noEmboss() {\r\n    let ret = this.getAttribute(\"no-emboss\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'yes' || ret === 'on';\r\n  }\r\n\r\n  set noEmboss(val) {\r\n    this.setAttribute('no-emboss', val ? 'true' : 'false');\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"iconcheck-x\",\r\n      style      : \"iconcheck\",\r\n      parentStyle: \"iconbutton\"\r\n    };\r\n  }\r\n\r\n  _updatePressed(val) {\r\n    //don't set _pressed if we have a custom icon for press state\r\n    if (this._icon_pressed) {\r\n      this._draw_pressed = false;\r\n    }\r\n\r\n    this._pressed = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  _on_depress() {\r\n    return;\r\n  }\r\n\r\n  _on_press() {\r\n    this.checked ^= true;\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), !!this.checked);\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n\r\n  }\r\n\r\n  _calcUpdateKey() {\r\n    return super._calcUpdateKey() + \":\" + this._icon;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\") || !this.ctx) {\r\n      return;\r\n    }\r\n\r\n    if (this._icon < 0) {\r\n      let rdef;\r\n      try {\r\n        rdef = this.ctx.api.resolvePath(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (error instanceof DataPathError) {\r\n          return;\r\n        } else {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      if (rdef !== undefined && rdef.prop) {\r\n        let icon, icon2, title;\r\n\r\n        if (rdef.prop.flag & PropFlags.NO_UNDO) {\r\n          this.setUndo(false);\r\n        } else {\r\n          this.setUndo(true);\r\n        }\r\n\r\n        //console.log(\"SUBKEY\", rdef.subkey, rdef.prop.iconmap);\r\n\r\n        if (rdef.subkey && (rdef.prop.type === PropTypes.FLAG || rdef.prop.type === PropTypes.ENUM)) {\r\n          icon = rdef.prop.iconmap[rdef.subkey];\r\n          icon2 = rdef.prop.iconmap2[rdef.subkey];\r\n          title = rdef.prop.descriptions[rdef.subkey];\r\n\r\n          if (!title && rdef.subkey.length > 0) {\r\n            title = rdef.subkey;\r\n            title = title[0].toUpperCase() + title.slice(1, title.length).toLowerCase();\r\n          }\r\n        } else {\r\n          icon2 = rdef.prop.icon2;\r\n          icon = rdef.prop.icon;\r\n          title = rdef.prop.description;\r\n        }\r\n\r\n        if (icon2 !== undefined && icon2 !== -1) {\r\n          this._icon_pressed = icon;\r\n          icon = icon2;\r\n        }\r\n\r\n        if (icon !== undefined && icon !== this.icon)\r\n          this.icon = icon;\r\n        if (title)\r\n          this.description = title;\r\n      }\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    } else {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    val = !!val;\r\n\r\n    if (val !== !!this._checked) {\r\n      this._checked = val;\r\n      this._updatePressed(!!val);\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDrawCheck() {\r\n    if (this.drawCheck) {\r\n      this._extraIcon = this._checked ? ui_base.Icons.ENUM_CHECKED : ui_base.Icons.ENUM_UNCHECKED;\r\n    } else {\r\n      this._extraIcon = undefined;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this.packflag & PackFlags.HIDE_CHECK_MARKS) {\r\n      this.drawCheck = false;\r\n    }\r\n\r\n    this.updateDrawCheck();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _getsize() {\r\n    let margin = this.getDefault(\"padding\");\r\n    return ui_base.iconmanager.getTileSize(this.iconsheet) + margin*2;\r\n  }\r\n\r\n  setCSS() {\r\n    this.updateDrawCheck();\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(IconCheck);\r\n\r\nexport class Check1 extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this._namePad = 40;\r\n    this._value = undefined;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"check1-x\",\r\n      parentStyle: \"button\"\r\n    };\r\n  }\r\n\r\n  _redraw() {\r\n    //console.log(\"button draw\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let box = 40;\r\n    ui_base.drawRoundBox(this, this.dom, this.g, box);\r\n\r\n    let ts = this.getDefault(\"DefaultText\").size;\r\n\r\n    let text = this._genLabel();\r\n\r\n    //console.log(text, \"text\", this._name);\r\n\r\n    let tw = ui_base.measureText(this, text, this.dom, this.g).width;\r\n    let cx = this.dom.width/2 - tw/2;\r\n    let cy = this.dom.height/2;\r\n\r\n    ui_base.drawText(this, box, cy + ts/2, text, {\r\n      canvas: this.dom, g: this.g\r\n    });\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Check1);\r\n\r\nexport {checkForTextBox} from './ui_textbox.js';\r\n", "//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular \r\n//module refs, in such cases do not use these vars.\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as units from '../core/units.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from './ui_base.js';\r\nimport * as ui_widgets from '../widgets/ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {HotKey} from '../path-controller/util/simple_events.js';\r\nimport {CSSFont} from './ui_theme.js';\r\nimport {theme, iconSheetFromPackFlag} from './ui_base.js';\r\n\r\nimport {createMenu, startMenu} from \"../widgets/ui_menu.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\nimport {DataPathError} from '../path-controller/controller/controller_base.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class Label extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._label = \"\";\r\n\r\n    this._lastText = \"\";\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"_labelx\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      div._labelx::selection {\r\n        color: none;\r\n        background: none;\r\n         -webkit-user-select:none;\r\n         user-select:none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(this.dom);\r\n\r\n    this.font = \"LabelText\";\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  /**Set a font defined in ui_base.defaults\r\n   e.g. DefaultText*/\r\n  set font(fontDefaultName) {\r\n    if (typeof fontDefaultName === \"string\") {\r\n      this._font = this.getDefault(fontDefaultName);\r\n      if (!this._font) {\r\n        console.warn(\"Invalid font\", fontDefaultName);\r\n      }\r\n    } else if (typeof fontDefaultName === \"object\" && fontDefaultName instanceof CSSFont) {\r\n      this._font = fontDefaultName;\r\n    } else {\r\n      console.warn(\"Invalid font\", fontDefaultName);\r\n    }\r\n\r\n    this._updateFont();\r\n  }\r\n\r\n  get text() {\r\n    return this._label;\r\n    //return this.dom.innerText;\r\n  }\r\n\r\n  set text(text) {\r\n    this._label = text;\r\n\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      this.dom.innerText = text;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"label-x\",\r\n      style  : \"label\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    this.dom.style[\"width\"] = \"max-content\";\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n    this.setBoxCSS();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n    this._enabled_font = this.font;\r\n    this.font = \"DefaultText\";\r\n    this._updateFont();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n    this.font = this._enabled_font;\r\n    this._updateFont();\r\n  }\r\n\r\n  _updateFont() {\r\n    let font = this._font;\r\n    if (!font) return;\r\n\r\n    this.dom.style[\"font\"] = font.genCSS();\r\n    this.dom.style[\"color\"] = font.color;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (this.ctx === undefined) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      return;\r\n    }\r\n\r\n    //console.log(path);\r\n    if (prop.type & (PropTypes.INT | PropTypes.FLOAT)) {\r\n      val = units.buildString(val, prop.baseUnit, prop.decimalPlaces, prop.displayUnit);\r\n    }\r\n\r\n    val = \"\" + this._label + \" \" + val;\r\n\r\n    if (val !== this._lastText) {\r\n      this._lastText = val;\r\n      this.dom.innerText = val;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let key = \"\";\r\n\r\n    if (this._font !== undefined && this._font instanceof CSSFont) {\r\n      key += this._font.genKey();\r\n    }\r\n\r\n    if (key !== this._last_font) {\r\n      this._last_font = key;\r\n      this._updateFont();\r\n    }\r\n\r\n    this.dom.style[\"pointer-events\"] = this.style[\"pointer-events\"];\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(Label);\r\n\r\nexport class Container extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dataPrefix = '';\r\n    this.massSetPrefix = '';\r\n\r\n    this.inherit_packflag = 0;\r\n\r\n    let style = this.styletag = document.createElement(\"style\")\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.reversed = false;\r\n\r\n    this._prefixstack = [];\r\n    this._mass_prefixstack = [];\r\n  }\r\n\r\n  noUndo() {\r\n    this.setUndo(false);\r\n    return this;\r\n  }\r\n\r\n  set background(bg) {\r\n    this.__background = bg;\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${bg};\r\n      }\r\n    `;\r\n    this.style[\"background-color\"] = bg;\r\n  }\r\n\r\n  get children() {\r\n    let list = [];\r\n\r\n    this._forEachChildWidget((n) => {\r\n      list.push(n);\r\n    });\r\n\r\n    return list\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"container-x\"\r\n    };\r\n  }\r\n\r\n  /** recursively change path prefix for all children*/\r\n  changePathPrefix(newprefix) {\r\n    let prefix = this.dataPrefix.trim();\r\n    this.dataPrefix = newprefix;\r\n\r\n    if (prefix.length > 0) {\r\n      prefix += \".\";\r\n    }\r\n\r\n    let rec = (n, con) => {\r\n      if (n instanceof Container && n !== this) {\r\n        if (n.dataPrefix.startsWith(prefix)) {\r\n          n.dataPrefix = n.dataPath.slice(prefix.length, n.dataPrefix.length);\r\n          n.dataPrefix = con._joinPrefix(n.dataPrefix);\r\n          con = n;\r\n        }\r\n      }\r\n\r\n      if (n.hasAttribute(\"datapath\")) {\r\n        let path = n.getAttribute(\"datapath\");\r\n\r\n        if (path.startsWith(prefix)) {\r\n          path = path.slice(prefix.length, path.length);\r\n          path = con._joinPrefix(path);\r\n          n.setAttribute(\"datapath\", path);\r\n\r\n          //update helper tooltips\r\n          n.description = n.description;\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2, con);\r\n      });\r\n    }\r\n\r\n    rec(this, this);\r\n  }\r\n\r\n  reverse() {\r\n    this.reversed ^= true;\r\n    return this;\r\n  }\r\n\r\n  pushMassSetPrefix(val) {\r\n    this._mass_prefixstack.push(this.massSetPrefix);\r\n    this.massSetPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  pushDataPrefix(val) {\r\n    this._prefixstack.push(this.dataPrefix);\r\n    this.dataPrefix = val;\r\n    return this;\r\n  }\r\n\r\n  popDataPrefix() {\r\n    this.dataPrefix = this._prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  popMassSetPrefix() {\r\n    this.massSetPrefix = this._mass_prefixstack.pop();\r\n    return this;\r\n  }\r\n\r\n  saveData() {\r\n    if (this.scrollTop || this.scrollLeft) {\r\n      return {\r\n        scrollTop : this.scrollTop,\r\n        scrollLeft: this.scrollLeft\r\n      }\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj) return;\r\n\r\n    let x = obj.scrollLeft || 0;\r\n    let y = obj.scrollTop || 0;\r\n\r\n    this.doOnce(() => {\r\n      this.scrollTo(x, y);\r\n    }, 12);\r\n  }\r\n\r\n  init() {\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = this.reversed ? \"column-reverse\" : \"column\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-grow\"] = \"\" + this.getDefault(\"flex-grow\", undefined, \"1\");\r\n\r\n    this.setCSS();\r\n\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  /** Returns previous icon flags */\r\n  useIcons(enabled_or_sheet = true) {\r\n    let enabled = !!enabled_or_sheet;\r\n\r\n    let mask = PackFlags.USE_ICONS | PackFlags.SMALL_ICON | PackFlags.LARGE_ICON;\r\n    mask = mask | PackFlags.CUSTOM_ICON_SHEET;\r\n    mask = mask | (255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    let previous = this.packflag & mask;\r\n\r\n    if (!enabled) {\r\n      this.packflag &= ~PackFlags.USE_ICONS;\r\n      this.inherit_packflag &= ~PackFlags.USE_ICONS;\r\n\r\n      return previous;\r\n    }\r\n\r\n    let sheet = enabled_or_sheet;\r\n\r\n    if (sheet === true) {\r\n      sheet = PackFlags.SMALL_ICON;\r\n    } else if (sheet === 1) {\r\n      sheet = PackFlags.LARGE_ICON;\r\n    } else {\r\n      sheet = PackFlags.CUSTOM_ICON_SHEET | (sheet<<(PackFlags.CUSTOM_ICON_SHEET_START));\r\n    }\r\n\r\n    //clear any existing sizing flags\r\n    this.packflag &= ~(PackFlags.SMALL_ICON | PackFlags.LARGE_ICON | PackFlags.CUSTOM_ICON_SHEET);\r\n    this.packflag &= ~(255<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    this.packflag |= PackFlags.USE_ICONS | sheet;\r\n    this.inherit_packflag |= PackFlags.USE_ICONS | sheet;\r\n\r\n    return previous;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param mode: flexbox wrap mode, can be wrap, nowrap, or wrap-reverse\r\n   * @returns {Container}\r\n   */\r\n  wrap(mode = \"wrap\") {\r\n    this.style[\"flex-wrap\"] = mode;\r\n    return this;\r\n  }\r\n\r\n  noMarginsOrPadding() {\r\n    super.noMarginsOrPadding();\r\n\r\n    let keys = [\"margin\", \"padding\", \"margin-block-start\", \"margin-block-end\"];\r\n    keys = keys.concat([\"padding-block-start\", \"padding-block-end\"]);\r\n\r\n    for (let k of keys) {\r\n      this.style[k] = \"0px\";\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    let rest = '';\r\n\r\n    let add = (style) => {\r\n      if (!this.hasDefault(style)) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getDefault(style);\r\n\r\n      if (val !== undefined) {\r\n        rest += `  ${style} = ${val};\\n`;\r\n        this.style[style] = val;\r\n      }\r\n    }\r\n\r\n    add(\"border-radius\");\r\n    add(\"border-width\");\r\n    add(\"border-top\");\r\n    add(\"border-bottom\");\r\n    add(\"border-left\");\r\n    add(\"border-right\");\r\n\r\n    this.styletag.textContent = `div.containerx {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n        ${rest}\r\n      }\r\n      `;\r\n  }\r\n\r\n  overrideDefault(key, val) {\r\n    super.overrideDefault(key, val);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /*\r\n  * shorthand for:\r\n  *\r\n  * .row().noMarginsOrPadding().oneAxisPadding()\r\n  * */\r\n  strip(themeClass_or_obj = \"strip\", margin1 = this.getDefault(\"oneAxisPadding\"), margin2 = 1, horiz = undefined) {\r\n    let themeClass = themeClass_or_obj;\r\n\r\n    if (typeof themeClass_or_obj === \"object\") {\r\n      let obj = themeClass_or_obj;\r\n\r\n      themeClass = obj.themeClass ?? \"strip\";\r\n      margin1 = obj.margin1 ?? margin1;\r\n      margin2 = obj.margin2 ?? 1;\r\n      horiz = obj.horiz;\r\n    }\r\n\r\n    if (horiz === undefined) {\r\n      horiz = this instanceof RowFrame;\r\n      horiz = horiz || this.style[\"flex-direction\"] === \"row\";\r\n    }\r\n\r\n    let flag = horiz ? PackFlags.STRIP_HORIZ : PackFlags.STRIP_VERT;\r\n\r\n    let strip = (horiz ? this.row() : this.col());\r\n\r\n    if (typeof margin1 !== \"number\") {\r\n      throw new Error(\"margin1 was not a number\");\r\n    }\r\n    if (typeof margin2 !== \"number\") {\r\n      throw new Error(\"margin2 was not a number\");\r\n    }\r\n\r\n    strip.packflag |= flag;\r\n    strip.dataPrefix = this.dataPrefix;\r\n    strip.massSetPrefix = this.massSetPrefix;\r\n\r\n    if (themeClass in theme) {\r\n      strip.overrideClass(themeClass);\r\n      strip.background = strip.getDefault(\"background-color\");\r\n      strip.setCSS();\r\n      strip.overrideClass(themeClass);\r\n\r\n      let lastkey;\r\n\r\n      strip.update.after(function () {\r\n        let bradius = strip.getDefault(\"border-radius\");\r\n        let bline = strip.getDefault(\"border-width\");\r\n        let bstyle = strip.getDefault(\"border-style\") || 'solid';\r\n        let padding = strip.getDefault(\"padding\");\r\n        let bcolor = strip.getDefault(\"border-color\") || \"rgba(0,0,0,0)\";\r\n        let margin = strip.getDefault(\"margin\") || 0;\r\n\r\n        bline = bline === undefined ? 0 : bline;\r\n        bradius = bradius === undefined ? 0 : bradius;\r\n        padding = padding === undefined ? 5 : padding;\r\n\r\n        let bg = strip.getDefault(\"background-color\");\r\n\r\n        let key = \"\" + bradius + \":\" + bline + \":\" + bg + \":\" + padding + \":\";\r\n        key += bstyle + \":\" + padding + \":\" + bcolor + \":\" + margin;\r\n\r\n        if (key !== lastkey) {\r\n          lastkey = key;\r\n\r\n          strip.oneAxisPadding(margin1 + padding, margin2 + padding);\r\n          strip.setCSS();\r\n\r\n          strip.background = bg;\r\n\r\n          strip.style[\"margin\"] = \"\" + margin + \"px\";\r\n          strip.style[\"border\"] = `${bline}px ${bstyle} ${bcolor}`;\r\n          strip.style[\"border-radius\"] = \"\" + bradius + \"px\";\r\n        }\r\n      })\r\n    } else {\r\n      console.warn(this.constructor.name + \".strip(): unknown theme class \" + themeClass);\r\n    }\r\n\r\n    /*\r\n    let prev = strip.previousElementSibling;\r\n    if (prev !== undefined && (prev.packflag & flag)) {\r\n      if (horiz) {\r\n        prev.style[\"padding-right\"] = \"0px\";\r\n      } else {\r\n        prev.style[\"padding-top\"] = \"0px\";\r\n      }\r\n    }//*/\r\n\r\n    return strip;\r\n  }\r\n\r\n  /**\r\n   * tries to set margin along one axis only in smart manner\r\n   * */\r\n  oneAxisMargin(m = this.getDefault(\"oneAxisMargin\"), m2 = 0) {\r\n    this.style[\"margin-top\"] = this.style[\"margin-bottom\"] = \"\" + m + \"px\";\r\n    this.style[\"margin-left\"] = this.style[\"margin-right\"] = \"\" + m2 + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tries to set padding along one axis only in smart manner\r\n   * */\r\n  oneAxisPadding(axisPadding = this.getDefault(\"oneAxisPadding\"), otherPadding = 0) {\r\n    this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = \"\" + axisPadding + \"px\";\r\n    this.style[\"padding-left\"] = this.style[\"padding-right\"] = \"\" + otherPadding + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setMargin(m) {\r\n    this.style[\"margin\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setPadding(m) {\r\n    this.style[\"padding\"] = m + \"px\";\r\n\r\n    return this;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    if (width !== undefined) {\r\n      if (typeof width == \"number\")\r\n        this.style[\"width\"] = this.div.style[\"width\"] = ~~width + \"px\";\r\n      else\r\n        this.style[\"width\"] = this.div.style[\"width\"] = width;\r\n    }\r\n\r\n    if (height !== undefined) {\r\n      if (typeof height == \"number\")\r\n        this.style[\"height\"] = this.div.style[\"height\"] = ~~height + \"px\";\r\n      else\r\n        this.style[\"height\"] = this.div.style[\"height\"] = height;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  save() {\r\n  }\r\n\r\n  load() {\r\n  }\r\n\r\n  saveVisibility() {\r\n    localStorage[this.storagePrefix + \"_settings\"] = JSON.stringify(this);\r\n    return this;\r\n  }\r\n\r\n  loadVisibility() {\r\n    let key = this.storagePrefix + \"_settings\";\r\n    let ok = true;\r\n\r\n    if (key in localStorage) {\r\n      console.log(\"loading UI visibility state. . .\");\r\n\r\n      try {\r\n        this.loadJSON(JSON.parse(localStorage[key]));\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        ok = false;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      opened: !this.closed\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  _ondestroy() {\r\n    this._forEachChildWidget((n) => {\r\n      n._ondestroy();\r\n    });\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    //console.error(\"ui.js:Container.loadJSON: implement me!\");\r\n\r\n    return this;\r\n  }\r\n\r\n  redrawCurves() {\r\n    throw new Error(\"Implement me (properly!)\");\r\n\r\n    if (this.closed)\r\n      return;\r\n\r\n    for (let cw of this.curve_widgets) {\r\n      cw.draw();\r\n    }\r\n  }\r\n\r\n  listen() {\r\n    window.setInterval(() => {\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n      this.shadow.appendChild(child);\r\n\r\n      if (child.onadd) {\r\n        child.onadd();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    return super.appendChild(child);\r\n  }\r\n\r\n  clear(trigger_on_destroy = true) {\r\n    for (let child of this.children) {\r\n      if (child instanceof ui_base.UIBase) {\r\n        child.remove(trigger_on_destroy);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeChild(child, trigger_on_destroy = true) {\r\n    let ret = super.removeChild(child);\r\n\r\n    if (child.on_remove) {\r\n      child.on_remove();\r\n    }\r\n\r\n    if (trigger_on_destroy && child.on_destroy) {\r\n      child.on_destroy();\r\n    }\r\n\r\n    child.parentWidget = undefined;\r\n\r\n    return ret;\r\n  }\r\n\r\n  prepend(child) {\r\n    if (child instanceof UIBase) {\r\n      this._prepend(child);\r\n    } else {\r\n      super.prepend(child);\r\n    }\r\n  }\r\n\r\n  //*\r\n  _prepend(child) {\r\n    return this._add(child, true);\r\n  }//*/\r\n\r\n  add(child) {\r\n    return this._add(child);\r\n  }\r\n\r\n  insert(i, ch) {\r\n    ch.parentWidget = this;\r\n    ch.ctx = this;\r\n\r\n    if (i >= this.shadow.childNodes.length) {\r\n      this.add(ch);\r\n    } else {\r\n      this.shadow.insertBefore(ch, util.list(this.children)[i]);\r\n    }\r\n\r\n    if (ch.onadd) {\r\n      ch.onadd();\r\n    }\r\n  }\r\n\r\n  _add(child, prepend = false) {\r\n    //paranoia check for if we accidentally got a DOM NodeList\r\n    if (child instanceof NodeList) {\r\n      throw new Error(\"eek!\");\r\n    }\r\n\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    child._useDataPathUndo = this._useDataPathUndo;\r\n\r\n    if (!child._themeOverride && this._themeOverride) {\r\n      child.overrideTheme(this._themeOverride);\r\n    }\r\n\r\n    if (prepend) {\r\n      this.shadow.prepend(child);\r\n    } else {\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    /*\r\n    if (child._ctx) {\r\n      child._init();\r\n    }//*/\r\n\r\n    if (child.onadd)\r\n      child.onadd();\r\n\r\n    return child;\r\n  }\r\n\r\n  //TODO: make sure this works on Electron?\r\n  dynamicMenu(title, list, packflag = 0) {\r\n    //actually, .menu works for now\r\n    return this.menu(title, list, packflag);\r\n  }\r\n\r\n  /**example usage:\r\n\r\n   .menu([\r\n   \"some_tool_path.tool()|CustomLabel\",\r\n   ui_widgets.Menu.SEP,\r\n   \"some_tool_path.another_tool()\",\r\n   \"some_tool_path.another_tool()|CustomLabel::Custom Hotkey String\",\r\n   [\"Name\", () => {console.log(\"do something\")}]\r\n   ])\r\n\r\n   **/\r\n  menu(title, list, packflag = 0) {\r\n    let dbox = UIBase.createElement(\"dropbox-x\");\r\n\r\n    dbox._name = title;\r\n    dbox.setAttribute(\"simple\", true);\r\n    dbox.setAttribute(\"name\", title);\r\n\r\n    if (list instanceof HTMLElement && list.constructor.name === \"Menu\") {\r\n      dbox._build_menu = function () {\r\n        if (this._menu !== undefined && this._menu.parentNode !== undefined) {\r\n          this._menu.remove();\r\n        }\r\n\r\n        this._menu = createMenu(this.ctx, title, list);\r\n        return this._menu;\r\n      }\r\n    } else if (list) {\r\n      dbox.template = list;\r\n    }\r\n\r\n    this._container_inherit(dbox, packflag);\r\n\r\n    this._add(dbox);\r\n    return dbox;\r\n  }\r\n\r\n  toolPanel(path_or_cls, args = {}) {\r\n    let tdef;\r\n    let cls;\r\n\r\n    if (typeof path_or_cls === \"string\") {\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    tdef = cls._getFinalToolDef();\r\n\r\n    let packflag = args.packflag || 0;\r\n    let label = args.label || tdef.uiname;\r\n    let createCb = args.createCb || args.create_cb;\r\n    let container = args.container || this.panel(label);\r\n    let defaultsPath = args.defaultsPath || \"toolDefaults\";\r\n\r\n    if (defaultsPath.length > 0 && !defaultsPath.endsWith(\".\")) {\r\n      defaultsPath += \".\";\r\n    }\r\n\r\n    let path = defaultsPath + tdef.toolpath;\r\n\r\n    container.useIcons(false);\r\n\r\n    let inputs = tdef.inputs || {};\r\n    for (let k in inputs) {\r\n      let prop = inputs[k];\r\n\r\n      if (prop.flag & PropFlags.PRIVATE) {\r\n        continue;\r\n      }\r\n\r\n      let apiname = prop.apiname || k;\r\n      let path2 = path + \".\" + apiname;\r\n\r\n      container.prop(path2);\r\n    }\r\n\r\n    container.tool(path_or_cls, packflag, createCb, label);\r\n\r\n    return container;\r\n  }\r\n\r\n  tool(path_or_cls, packflag_or_args = {}, createCb = undefined, label = undefined) {\r\n    let cls;\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag;\r\n      createCb = args.createCb;\r\n      label = args.label;\r\n    } else {\r\n      packflag = packflag_or_args || 0;\r\n    }\r\n\r\n    if (typeof path_or_cls == \"string\") {\r\n      if (path_or_cls.search(/\\|/) >= 0) {\r\n        path_or_cls = path_or_cls.split(\"|\");\r\n\r\n        if (label === undefined && path_or_cls.length > 1) {\r\n          label = path_or_cls[1].trim();\r\n        }\r\n\r\n        path_or_cls = path_or_cls[0].trim();\r\n      }\r\n\r\n      if (this.ctx === undefined) {\r\n        console.warn(\"this.ctx was undefined in tool()\");\r\n        return;\r\n      }\r\n\r\n      cls = this.ctx.api.parseToolPath(path_or_cls);\r\n\r\n      if (cls === undefined) {\r\n        console.warn(\"Unknown tool for toolpath \\\"\" + path_or_cls + \"\\\"\");\r\n        return;\r\n      }\r\n    } else {\r\n      cls = path_or_cls;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let hotkey;\r\n\r\n    if (createCb === undefined) {\r\n      createCb = (cls) => {\r\n        return this.ctx.api.createTool(this.ctx, path_or_cls);\r\n      }\r\n    }\r\n\r\n    let cb = () => {\r\n      console.log(\"tool run\");\r\n\r\n      let toolob = createCb(cls);\r\n      this.ctx.api.execTool(this.ctx, toolob);\r\n    }\r\n\r\n    let def = typeof path_or_cls === \"string\" ? this.ctx.api.getToolDef(path_or_cls) : cls.tooldef();\r\n    let tooltip = def.description === undefined ? def.uiname : def.description;\r\n\r\n    //is there a hotkey hardcoded in the class?\r\n    if (def.hotkey !== undefined) {\r\n      tooltip += \"\\n\\t\" + def.hotkey;\r\n      hotkey = def.hotkey;\r\n    } else { //if not, use getToolPathHotkey api\r\n      let path = path_or_cls;\r\n\r\n      if (typeof path != \"string\") {\r\n        path = def.toolpath;\r\n      }\r\n\r\n      let hotkey = this.ctx.api.getToolPathHotkey(this.ctx, path);\r\n      if (hotkey) {\r\n        tooltip += \"\\n\\tHotkey: \" + hotkey;\r\n      }\r\n    }\r\n\r\n    let ret;\r\n\r\n    if (def.icon !== undefined && (packflag & PackFlags.USE_ICONS)) {\r\n      label = label === undefined ? tooltip : label;\r\n\r\n      ret = this.iconbutton(def.icon, label, cb);\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n      ret.packflag |= packflag;\r\n      ret.description = tooltip;\r\n    } else {\r\n      label = label === undefined ? def.uiname : label;\r\n\r\n      ret = this.button(label, cb);\r\n      ret.description = tooltip;\r\n      ret.packflag |= packflag;\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  //supports number types\r\n  textbox(inpath, text, cb = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    this._add(ret);\r\n\r\n    ret.setCSS();\r\n    ret.update();\r\n\r\n    ret.packflag |= packflag;\r\n    ret.onchange = cb;\r\n    ret.text = text;\r\n\r\n    return ret;\r\n  }\r\n\r\n  pathlabel(inpath, label = undefined, packflag = 0) {\r\n    let path;\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"label-x\");\r\n\r\n    if (label === undefined && inpath) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n      if (rdef) {\r\n        label = rdef.prop.uiname ?? rdef.dpath.apiname;\r\n      } else {\r\n        label = \"(error)\";\r\n      }\r\n    }\r\n\r\n    ret.text = label;\r\n    ret.packflag = packflag;\r\n    ret.setAttribute(\"datapath\", path);\r\n\r\n    this._add(ret);\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  label(text) {\r\n    let ret = UIBase.createElement(\"label-x\");\r\n    ret.text = text;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * makes a button for a help picker tool\r\n   * to view tooltips on mobile devices\r\n   * */\r\n  helppicker() {\r\n    let ret = this.iconbutton(ui_base.Icons.HELP, \"Help Picker\", () => {\r\n      this.getScreen().hintPickerTool();\r\n    })\r\n\r\n    if (util.isMobile()) {\r\n      //ret.iconsheet = 2;\r\n      //XXX look up in mobile theme properly\r\n    }\r\n\r\n    if (ret.ctx) {\r\n      ret._init();\r\n      ret.setCSS();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  iconbutton(icon, description, cb, thisvar, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"iconbutton-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"icon\", icon);\r\n    ret.description = description;\r\n    ret.icon = icon;\r\n\r\n    ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(label, cb, thisvar, id, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let ret = UIBase.createElement(\"button-x\")\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    ret.setAttribute(\"name\", label);\r\n    ret.setAttribute(\"buttonid\", id); //XXX no longer used?\r\n    ret.onclick = cb;\r\n\r\n    this._add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _joinPrefix(path, prefix = this.dataPrefix.trim()) {\r\n    if (path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    path = path.trim();\r\n    if (path[0] === \"/\") {\r\n      return path;\r\n    }\r\n\r\n    if (prefix.length > 0 && path.length > 0 && !prefix.endsWith(\".\") && !path.startsWith(\".\")) {\r\n      path = \".\" + path;\r\n    }\r\n\r\n    return prefix + path;\r\n  }\r\n\r\n  colorbutton(inpath, packflag, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"color-picker-button-x\");\r\n\r\n    if (inpath !== undefined) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  noteframe(packflag = 0) {\r\n    let ret = UIBase.createElement(\"noteframe-x\");\r\n\r\n    ret.packflag |= (this.inherit_packflag & ~PackFlags.NO_UPDATE) | packflag;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  curve1d(inpath, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"curve-widget-x\");\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.packflag |= packflag;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  vecpopup(inpath, packflag = 0, mass_set_path = undefined) {\r\n    let button = UIBase.createElement(\"vector-popup-button-x\");\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let name = \"vector\";\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      button.setAttribute(\"datapath\", inpath);\r\n      if (mass_set_path) {\r\n        button.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath);\r\n      if (rdef && rdef.prop) {\r\n        name = rdef.prop.uiname || rdef.prop.name;\r\n      }\r\n    }\r\n\r\n    button.setAttribute(\"name\", name);\r\n    button.packflag |= packflag;\r\n\r\n    this.add(button);\r\n    return button;\r\n  }\r\n\r\n  _getMassPath(ctx, inpath, mass_set_path) {\r\n    if (mass_set_path === undefined && this.massSetPrefix.length > 0) {\r\n      mass_set_path = ctx.api.getPropName(ctx, inpath);\r\n    }\r\n\r\n    if (mass_set_path === undefined) {\r\n      return undefined;\r\n    }\r\n\r\n    return this._joinPrefix(mass_set_path, this.massSetPrefix);\r\n  }\r\n\r\n  prop(inpath, packflag = 0, mass_set_path = undefined) {\r\n    if (!this.ctx) {\r\n      console.warn(this.id + \".ctx was undefined\");\r\n      let p = this.parentWidget;\r\n\r\n      while (p) {\r\n        if (p.ctx) {\r\n          console.warn(\"Fetched this.ctx from parent\");\r\n          this.ctx = p.ctx;\r\n          break;\r\n        }\r\n\r\n        p = p.parentWidget;\r\n      }\r\n\r\n      if (!this.ctx) {\r\n        throw new Error(\"ui.Container.prototype.prop(): this.ctx was undefined\");\r\n      }\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let rdef = this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true);\r\n\r\n    if (rdef === undefined || rdef.prop === undefined) {\r\n      console.warn(\"Unknown property at path\", this._joinPrefix(inpath), this.ctx.api.resolvePath(this.ctx, this._joinPrefix(inpath), true));\r\n      return;\r\n    }\r\n    //slider(path, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag=0) {\r\n    let prop = rdef.prop;\r\n\r\n    let useDataPathUndo = this.useDataPathUndo && !(prop.flag & PropFlags.NO_UNDO);\r\n\r\n    //console.log(prop, PropTypes, PropSubTypes);\r\n\r\n    function makeUIName(name) {\r\n      if (typeof name === \"number\" && isNaN(name)) {\r\n        console.warn(\"Subkey error in data api\", inpath);\r\n        return \"\" + name;\r\n      }\r\n\r\n      name = \"\" + name;\r\n      name = name[0].toUpperCase() + name.slice(1, name.length).toLowerCase();\r\n      name = name.replace(/_/g, \" \");\r\n      return name;\r\n    }\r\n\r\n    if (prop.type === PropTypes.REPORT) {\r\n      return this.pathlabel(inpath, prop.uiname);\r\n    } else if (prop.type === PropTypes.STRING) {\r\n      let ret;\r\n\r\n      if (prop.flag & PropFlags.READ_ONLY) {\r\n        ret = this.pathlabel(inpath, prop.uiname);\r\n      } else if (prop.multiLine) {\r\n        ret = this.textarea(inpath, rdef.value, packflag, mass_set_path);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n      } else {\r\n        let strip = this.strip();\r\n\r\n        let uiname = prop.uiname !== undefined ? prop.uiname : ToolProperty.makeUIName(prop.apiname);\r\n\r\n        strip.label(prop.uiname);\r\n\r\n        ret = strip.textbox(inpath);\r\n        ret.useDataPathUndo = useDataPathUndo;\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n      }\r\n\r\n      ret.packflag |= packflag;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.CURVE) {\r\n      let ret = this.curve1d(inpath, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.INT || prop.type === PropTypes.FLOAT) {\r\n      let ret;\r\n      if (packflag & PackFlags.SIMPLE_NUMSLIDERS) {\r\n        ret = this.simpleslider(inpath, {packflag: packflag});\r\n      } else {\r\n        ret = this.slider(inpath, {packflag: packflag});\r\n      }\r\n\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      ret.packflag |= packflag;\r\n\r\n      if (mass_set_path) {\r\n        ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n      }\r\n\r\n      return ret;\r\n    } else if (prop.type === PropTypes.BOOL) {\r\n      let ret = this.check(inpath, prop.uiname, packflag, mass_set_path);\r\n      ret.useDataPathUndo = useDataPathUndo;\r\n      return ret;\r\n    } else if (prop.type === PropTypes.ENUM) {\r\n      if (rdef.subkey !== undefined) {\r\n        let subkey = rdef.subkey;\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (name === undefined) {\r\n          name = makeUIName(rdef.subkey);\r\n        }\r\n\r\n        let check = this.check(inpath, name, packflag, mass_set_path);\r\n        let tooltip = rdef.prop.descriptions[subkey];\r\n\r\n        check.useDataPathUndo = useDataPathUndo;\r\n\r\n        check.description = tooltip === undefined ? rdef.prop.ui_value_names[subkey] : tooltip;\r\n        check.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        return check;\r\n      }\r\n\r\n      if (!(packflag & PackFlags.USE_ICONS) && !(prop.flag & (PropFlags.USE_ICONS | PropFlags.FORCE_ENUM_CHECKBOXES))) {\r\n        return this.listenum(inpath, {packflag, mass_set_path}).setUndo(useDataPathUndo);\r\n      } else {\r\n        if (prop.flag & PropFlags.USE_ICONS) {\r\n          packflag |= PackFlags.USE_ICONS;\r\n        } else if (prop.flag & PropFlags.FORCE_ENUM_CHECKBOXES) {\r\n          packflag &= ~PackFlags.USE_ICONS;\r\n        }\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          let strip = this.strip();\r\n          strip.label(prop.uiname);\r\n\r\n          return strip.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        } else {\r\n          return this.checkenum(inpath, undefined, packflag).setUndo(useDataPathUndo);\r\n        }\r\n      }\r\n    } else if (prop.type & (PropTypes.VEC2 | PropTypes.VEC3 | PropTypes.VEC4)) {\r\n      if (rdef.subkey !== undefined) {\r\n        let ret;\r\n\r\n        if (packflag & PackFlags.SIMPLE_NUMSLIDERS)\r\n          ret = this.simpleslider(inpath, {packflag: packflag});\r\n        else\r\n          ret = this.slider(inpath, {packflag: packflag});\r\n\r\n        ret.packflag |= packflag;\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else if (prop.subtype === PropSubTypes.COLOR) {\r\n        return this.colorbutton(inpath, packflag, mass_set_path).setUndo(useDataPathUndo);\r\n        //return this.colorPicker(inpath, packflag, mass_set_path);\r\n      } else {\r\n        let ret = UIBase.createElement(\"vector-panel-x\");\r\n\r\n        mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n        ret.packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n        ret.inherit_packflag |= packflag | (this.inherit_packflag & ~PackFlags.NO_UPDATE);\r\n\r\n        if (inpath) {\r\n          ret.setAttribute(\"datapath\", this._joinPrefix(inpath));\r\n        }\r\n\r\n        if (mass_set_path) {\r\n          ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n        }\r\n\r\n        this.add(ret);\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      }\r\n    } else if (prop.type === PropTypes.FLAG) {\r\n      if (rdef.subkey !== undefined) {\r\n        let tooltip = rdef.prop.descriptions[rdef.subkey];\r\n        let name = rdef.prop.ui_value_names[rdef.subkey];\r\n\r\n        if (typeof rdef.subkey === \"number\") {\r\n          name = rdef.prop.keys[rdef.subkey];\r\n          if (name && name in rdef.prop.ui_value_names) {\r\n            name = rdef.prop.ui_value_names[name];\r\n          } else {\r\n            name = makeUIName(name ? name : \"(error)\");\r\n          }\r\n        }\r\n\r\n        if (name === undefined) {\r\n          name = \"(error)\";\r\n        }\r\n\r\n        let ret = this.check(inpath, name, packflag, mass_set_path);\r\n\r\n        ret.icon = rdef.prop.iconmap[rdef.subkey];\r\n\r\n        if (tooltip) {\r\n          ret.description = tooltip;\r\n        }\r\n\r\n        return ret.setUndo(useDataPathUndo);\r\n      } else {\r\n        let con = this;\r\n\r\n        if (packflag & PackFlags.FORCE_PROP_LABELS) {\r\n          con = this.strip();\r\n          con.label(prop.uiname);\r\n        }\r\n\r\n        if (packflag & PackFlags.PUT_FLAG_CHECKS_IN_COLUMNS) {\r\n          let i = 0;\r\n          let row = con.row();\r\n          let col1 = row.col();\r\n          let col2 = row.col();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let con2 = i & 1 ? col1 : col2;\r\n            let check = con2.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n\r\n            i++;\r\n          }\r\n\r\n          return row;\r\n        }\r\n\r\n        if (packflag & PackFlags.WRAP_CHECKBOXES) {\r\n          let isrow = this.style[\"flex-direction\"] === \"row\";\r\n          isrow = isrow || this.style[\"flex-direction\"] === \"row-reverse\";\r\n\r\n          let wrapChars;\r\n\r\n          let strip, con;\r\n\r\n          if (isrow) {\r\n            wrapChars = this.getDefault(\"checkRowWrapLimit\", undefined, 24);\r\n            strip = this.col().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.row();\r\n          } else {\r\n            wrapChars = this.getDefault(\"checkColWrapLimit\", undefined, 5);\r\n            strip = this.row().strip();\r\n            strip.packflag |= packflag;\r\n            strip.inherit_packflag |= packflag;\r\n\r\n            con = strip.col();\r\n          }\r\n\r\n          let x = 0;\r\n          let y = 0;\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            x += name.length;\r\n            y += 1;\r\n\r\n            if (isrow && x > wrapChars) {\r\n              x = 0;\r\n              con = strip.row();\r\n            } else if (!isrow && y > wrapChars) {\r\n              y = 0;\r\n              con = strip.col();\r\n            }\r\n          }\r\n\r\n          return strip;\r\n        }\r\n\r\n        if (con === this) {\r\n          con = this.strip();\r\n        }\r\n\r\n        let rebuild = () => {\r\n          con.clear();\r\n\r\n          for (let k in prop.values) {\r\n            let name = prop.ui_value_names[k];\r\n            let tooltip = prop.descriptions[k];\r\n\r\n            if (name === undefined) {\r\n              name = makeUIName(k);\r\n            }\r\n\r\n            let check = con.check(`${inpath}[${k}]`, name, packflag, mass_set_path);\r\n            check.useDataPathUndo = useDataPathUndo;\r\n\r\n            if (tooltip) {\r\n              check.description = tooltip;\r\n            }\r\n\r\n            check.setUndo(useDataPathUndo);\r\n          }\r\n        }\r\n\r\n        rebuild();\r\n        let last_hash = prop.calcHash();\r\n\r\n        con.update.after(() => {\r\n          let hash = prop.calcHash();\r\n\r\n          if (last_hash !== hash) {\r\n            last_hash = hash;\r\n            console.error(\"Property definition update\");\r\n            rebuild();\r\n          }\r\n        });\r\n\r\n        return con;\r\n      }\r\n    }\r\n  }\r\n\r\n  iconcheck(inpath, icon, name, mass_set_path) {\r\n    let ret = UIBase.createElement(\"iconcheck-x\");\r\n    ret.icon = icon;\r\n    ret.description = name;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  check(inpath, name, packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = inpath !== undefined ? this._joinPrefix(inpath) : undefined;\r\n\r\n    //let prop = this.ctx.getProp(path);\r\n    let ret;\r\n    if (packflag & PackFlags.USE_ICONS) {\r\n      ret = UIBase.createElement(\"iconcheck-x\");\r\n\r\n      ret.iconsheet = iconSheetFromPackFlag(packflag);\r\n    } else {\r\n      ret = UIBase.createElement(\"check-x\");\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    ret.packflag |= packflag;\r\n    ret.label = name;\r\n    ret.noMarginsOrPadding();\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /*\r\n  *\r\n  * new (optional) form: checkenum(inpath, args)\r\n  * */\r\n  checkenum(inpath, name, packflag, enummap, defaultval, callback, iconmap, mass_set_path) {\r\n    if (typeof name === \"object\" && name !== null) {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      packflag = args.packflag;\r\n      enummap = args.enummap;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n\r\n    let has_path = path !== undefined;\r\n    let prop;\r\n    let frame;\r\n\r\n    if (path !== undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.strip();\r\n      frame.oneAxisPadding();\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \"[\" + key + \"]\", \"\", packflag);\r\n\r\n          check.packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(`${inpath}[${key}]`, prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  checkenum_panel(inpath, name, packflag = 0, callback = undefined, mass_set_path = undefined, prop = undefined) {\r\n    packflag = packflag === undefined ? 0 : packflag;\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    let path = this._joinPrefix(inpath);\r\n    let frame;\r\n\r\n    let has_path = path !== undefined;\r\n\r\n    if (path !== undefined && prop === undefined) {\r\n      prop = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (prop !== undefined)\r\n        prop = prop.prop;\r\n    }\r\n\r\n    if (!name && prop) {\r\n      name = prop.uiname;\r\n    }\r\n\r\n    if (path !== undefined) {\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad path in checkenum\", path);\r\n        return;\r\n      }\r\n\r\n      frame = this.panel(name, name, packflag);\r\n\r\n      frame.oneAxisPadding();\r\n      frame.setCSS.after(frame.background = this.getDefault(\"BoxSub2BG\"));\r\n\r\n      if (packflag & PackFlags.USE_ICONS) {\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" == \" + prop.values[key], \"\", packflag);\r\n\r\n          check.icon = prop.iconmap[key];\r\n          check.drawCheck = false;\r\n\r\n          check.style[\"padding\"] = \"0px\";\r\n          check.style[\"margin\"] = \"0px\";\r\n\r\n          check.dom.style[\"padding\"] = \"0px\";\r\n          check.dom.style[\"margin\"] = \"0px\";\r\n\r\n          check.description = prop.descriptions[key];\r\n          //console.log(check.description, key, prop.keys[key], prop.descriptions, prop.keys);\r\n        }\r\n      } else {\r\n        if (name === undefined) {\r\n          name = prop.uiname;\r\n        }\r\n\r\n        frame.label(name).font = \"TitleText\";\r\n\r\n        let checks = {};\r\n\r\n        let ignorecb = false;\r\n\r\n        function makecb(key) {\r\n          return () => {\r\n            if (ignorecb) return;\r\n\r\n            ignorecb = true;\r\n            for (let k in checks) {\r\n              if (k !== key) {\r\n                checks[k].checked = false;\r\n              }\r\n            }\r\n            ignorecb = false;\r\n\r\n            if (callback) {\r\n              callback(key);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (let key in prop.values) {\r\n          let check = frame.check(inpath + \" = \" + prop.values[key], prop.ui_value_names[key]);\r\n          checks[key] = check;\r\n\r\n          if (mass_set_path) {\r\n            check.setAttribute(\"mass_set_path\", mass_set_path);\r\n          }\r\n\r\n\r\n          check.description = prop.descriptions[prop.keys[key]];\r\n          if (!check.description) {\r\n            check.description = \"\" + prop.ui_value_names[key];\r\n          }\r\n          check.onchange = makecb(key);\r\n          //console.log(\"PATH\", path);\r\n        }\r\n      }\r\n    }\r\n\r\n    return frame;\r\n  }\r\n\r\n  /*\r\n    enummap is an object that maps\r\n    ui names to keys, e.g.:\r\n\r\n    ui.listenum(\"color\", \"Color\", {\r\n      RED   : 0,\r\n      GREEN : 1,\r\n      BLUE  : 2\r\n    });\r\n\r\n    path can be undefined, in which case, use callback,\r\n    which gets the current enum as an argument\r\n\r\n    defaultval cannot be undefined\r\n  */\r\n  listenum(inpath, name, enumDef, defaultval, callback, iconmap, packflag = 0) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let mass_set_path;\r\n\r\n    if (name && typeof name === \"object\") {\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      enumDef = args.enumDef;\r\n      defaultval = args.defaultval;\r\n      callback = args.callback;\r\n      iconmap = args.iconmap;\r\n      packflag = args.packflag || 0;\r\n      mass_set_path = args.mass_set_path;\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n\r\n    let path;\r\n    let label = name;\r\n\r\n    if (inpath !== undefined) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"dropbox-x\")\r\n\r\n    if (enumDef !== undefined) {\r\n      if (enumDef instanceof toolprop.EnumProperty) {\r\n        ret.prop = enumDef;\r\n        label ||= enumDef.uiname || toolprop.ToolProperty.makeUIName(enumDef.apiname);\r\n      } else {\r\n        ret.prop = new toolprop.EnumProperty(defaultval, enumDef, path, name);\r\n      }\r\n\r\n      if (iconmap !== undefined) {\r\n        ret.prop.addIcons(iconmap)\r\n      }\r\n    } else {\r\n      let res = this.ctx.api.resolvePath(this.ctx, path, true);\r\n\r\n      if (res !== undefined) {\r\n        ret.prop = res.prop;\r\n\r\n        name ||= res.prop.uiname;\r\n        label ||= name;\r\n      }\r\n    }\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, inpath, mass_set_path);\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n    if (mass_set_path !== undefined) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    ret.setAttribute(\"name\", name);\r\n\r\n    if (defaultval) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    ret.onchange = callback;\r\n    ret.onselect = callback;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (label && packflag & PackFlags.FORCE_PROP_LABELS) {\r\n      const container = this.row();\r\n      let l;\r\n\r\n      if (packflag & PackFlags.LABEL_ON_RIGHT) {\r\n        container._add(ret);\r\n        l = container.label(label);\r\n\r\n        if (!l.style[\"margin-left\"] || l.style[\"margin-left\"] === \"unset\") {\r\n          l.style[\"margin-left\"] = \"5px\";\r\n        }\r\n      } else {\r\n        l = container.label(label);\r\n        container._add(ret);\r\n      }\r\n    } else {\r\n      this._add(ret);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  getroot() {\r\n    let p = this;\r\n\r\n    while (p.parent !== undefined) {\r\n      p = p.parent;\r\n    }\r\n\r\n    return p;\r\n  }\r\n\r\n  simpleslider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      let args = Object.assign({}, name);\r\n\r\n      args.packflag = (args.packflag || 0) | PackFlags.SIMPLE_NUMSLIDERS;\r\n      return this.slider(inpath, args);\r\n      //new-style api call\r\n    } else {\r\n      return this.slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag | PackFlags.SIMPLE_NUMSLIDERS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * usage: .slider(inpath, {\r\n   *  name : bleh,\r\n   *  defaultval : number,\r\n   *  etc...\r\n   * });\r\n   * */\r\n  slider(inpath, name, defaultval, min, max, step, is_int, do_redraw, callback, packflag = 0) {\r\n    if (arguments.length === 2 || typeof name === \"object\") {\r\n      //new-style api call\r\n\r\n      let args = name;\r\n\r\n      name = args.name;\r\n      defaultval = args.defaultval;\r\n      min = args.min;\r\n      max = args.max;\r\n      step = args.step;\r\n      is_int = args.is_int || args.isInt;\r\n      do_redraw = args.do_redraw;\r\n      callback = args.callback;\r\n      packflag = args.packflag || 0;\r\n    }\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n    let ret;\r\n\r\n    if (inpath) {\r\n      inpath = this._joinPrefix(inpath);\r\n\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, inpath, true);\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      }\r\n      if (rdef && rdef.prop && (rdef.prop.flag & PropFlags.FORCE_ROLLER_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n    }\r\n\r\n    let simple = (packflag & PackFlags.SIMPLE_NUMSLIDERS) || cconst.simpleNumSliders;\r\n    simple = simple && !(packflag & PackFlags.FORCE_ROLLER_SLIDER);\r\n\r\n    let extraTextBox = cconst.useNumSliderTextboxes && !(packflag & PackFlags.NO_NUMSLIDER_TEXTBOX);\r\n\r\n    if (extraTextBox) {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-textbox-x\");\r\n      }\r\n    } else {\r\n      if (simple) {\r\n        ret = UIBase.createElement(\"numslider-simple-x\");\r\n      } else {\r\n        ret = UIBase.createElement(\"numslider-x\");\r\n      }\r\n    }\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    let decimals;\r\n\r\n    if (inpath) {\r\n      ret.setAttribute(\"datapath\", inpath);\r\n    }\r\n\r\n    if (name) {\r\n      ret.setAttribute(\"name\", name);\r\n    }\r\n\r\n    if (min !== undefined) {\r\n      ret.setAttribute(\"min\", min);\r\n    }\r\n    if (max !== undefined) {\r\n      ret.setAttribute(\"max\", max);\r\n    }\r\n\r\n    if (defaultval !== undefined) {\r\n      ret.setValue(defaultval);\r\n    }\r\n\r\n    if (is_int) {\r\n      ret.setAttribute(\"integer\", is_int);\r\n    }\r\n\r\n    if (decimals !== undefined) {\r\n      ret.decimalPlaces = decimals;\r\n    }\r\n\r\n    if (callback) {\r\n      ret.onchange = callback;\r\n    }\r\n\r\n    this._add(ret);\r\n\r\n    if (this.ctx) {\r\n      ret.setCSS();\r\n      ret.update();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  _container_inherit(elem, packflag = 0) {\r\n    //don't inherit NO_UPDATE\r\n\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    elem.packflag |= packflag;\r\n    elem.inherit_packflag |= packflag;\r\n    elem.dataPrefix = this.dataPrefix;\r\n    elem.massSetPrefix = this.massSetPrefix;\r\n  }\r\n\r\n  treeview() {\r\n    let ret = UIBase.createElement(\"tree-view-x\");\r\n    ret.ctx = this.ctx;\r\n    this.add(ret);\r\n\r\n    this._container_inherit(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  panel(name, id, packflag = 0, tooltip = undefined) {\r\n    id = id === undefined ? name : id;\r\n\r\n    let ret = UIBase.createElement(\"panelframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    if (tooltip) {\r\n      ret.setHeaderToolTip(tooltip);\r\n    }\r\n\r\n    ret.setAttribute(\"label\", name);\r\n    ret.setAttribute(\"id\", id);\r\n\r\n    this._add(ret);\r\n\r\n\r\n    if (this.ctx) {//check init was called\r\n      ret.ctx = this.ctx;\r\n      ret._init();\r\n      //ret.headerLabel = name;\r\n\r\n      ret.contents.ctx = ret.ctx;\r\n    }\r\n\r\n    ret.contents.dataPrefix = this.dataPrefix;\r\n    ret.contents.massSetPrefix = this.massSetPrefix;\r\n\r\n    return ret;\r\n  }\r\n\r\n  row(packflag = 0) {\r\n    let ret = UIBase.createElement(\"rowframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n    this._add(ret);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    return ret;\r\n  }\r\n\r\n  listbox(packflag = 0) {\r\n    let ret = UIBase.createElement(\"listbox-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  table(packflag = 0) {\r\n    let ret = UIBase.createElement(\"tableframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  twocol(parentDepth = 1, packflag = 0) {\r\n    let ret = UIBase.createElement(\"two-column-x\");\r\n\r\n    ret.parentDepth = parentDepth;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  col(packflag = 0) {\r\n    let ret = UIBase.createElement(\"colframe-x\");\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  colorPicker(inpath, packflag_or_args = 0, mass_set_path = undefined, themeOverride = undefined) {\r\n    let packflag;\r\n\r\n    if (typeof packflag_or_args === \"object\") {\r\n      let args = packflag_or_args;\r\n\r\n      packflag = args.packflag !== undefined ? args.packflag : 0;\r\n      mass_set_path = args.massSetPath;\r\n      themeOverride = args.themeOverride;\r\n    }\r\n\r\n    let path;\r\n\r\n    if (inpath) {\r\n      path = this._joinPrefix(inpath);\r\n    }\r\n\r\n    let ret = UIBase.createElement(\"colorpicker-x\");\r\n\r\n    if (themeOverride) {\r\n      ret.overrideClass(themeOverride);\r\n    }\r\n\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n    ret.packflag |= packflag;\r\n    ret.inherit_packflag |= packflag;\r\n    ret.constructor.setDefault(ret);\r\n\r\n    if (path !== undefined) {\r\n      ret.setAttribute(\"datapath\", path);\r\n    }\r\n\r\n    console.warn(\"mass_set_path\", mass_set_path);\r\n    if (mass_set_path) {\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path);\r\n    }\r\n\r\n    //XXX\r\n    window.colorpicker = ret;\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  textarea(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"rich-text-editor-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * html5 viewer\r\n   * */\r\n  viewer(datapath = undefined, value = \"\", packflag = 0, mass_set_path = undefined) {\r\n    packflag |= this.inherit_packflag & ~PackFlags.NO_UPDATE;\r\n\r\n    mass_set_path = this._getMassPath(this.ctx, datapath, mass_set_path);\r\n\r\n    let ret = UIBase.createElement(\"html-viewer-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.packflag |= packflag;\r\n\r\n    if (value !== undefined) {\r\n      ret.value = value;\r\n    }\r\n\r\n    if (datapath)\r\n      ret.setAttribute(\"datapath\", datapath)\r\n    if (mass_set_path)\r\n      ret.setAttribute(\"mass_set_path\", mass_set_path)\r\n\r\n    this.add(ret);\r\n    return ret;\r\n  }\r\n\r\n  //\r\n  tabs(position = \"top\", packflag = 0) {\r\n\r\n    let ret = UIBase.createElement(\"tabcontainer-x\");\r\n\r\n    ret.constructor.setDefault(ret);\r\n    ret.setAttribute(\"bar_pos\", position);\r\n\r\n    this._container_inherit(ret, packflag);\r\n\r\n    this._add(ret);\r\n    return ret;\r\n  }\r\n\r\n  asDialogFooter() {\r\n    this.style['margin-top'] = '15px';\r\n    this.style['justify-content'] = 'flex-end';\r\n\r\n    return this;\r\n  }\r\n\r\n};\r\n\r\nui_base.UIBase.internalRegister(Container, \"div\");\r\n\r\n\r\nexport class RowFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: 'rowframe-x'\r\n    };\r\n  }\r\n\r\n  //try to set styling as early as possible\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style['display'] = 'flex';\r\n    this.style['flex-direction'] = this.reversed ? 'row-reverse' : 'row';\r\n\r\n    if (!this.style['align-items'] || this.style['align-items'] == '') {\r\n      this.style['align-items'] = 'center';\r\n    }\r\n\r\n    if (this.getDefault(\"slider-style\") === \"simple\") {\r\n      this.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      this.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n    }\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-left'] = this.style['margin-right'] = m + 'px';\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m + 'px';\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(RowFrame);\r\n\r\nexport class ColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colframe-x\"\r\n    };\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n    this.style[\"justify-content\"] = \"right\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  oneAxisMargin(m = this.getDefault('oneAxisMargin'), m2 = 0) {\r\n    this.style['margin-top'] = this.style['margin-bottom'] = '' + m + 'px';\r\n    this.style['margin-left'] = this.style['margin-right'] = m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n\r\n  oneAxisPadding(m = this.getDefault('oneAxisPadding'), m2 = 0) {\r\n    this.style['padding-top'] = this.style['padding-bottom'] = '' + m + 'px';\r\n    this.style['padding-left'] = this.style['padding-right'] = '' + m2 + 'px';\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColumnFrame);\r\n\r\n\r\nexport class TwoColumnFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._colWidth = 256;\r\n    this.parentDepth = 1;\r\n  }\r\n\r\n  get colWidth() {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      return parsepx(this.getAttribute(\"colWidth\"));\r\n    }\r\n\r\n    return this._colWidth;\r\n  }\r\n\r\n  set colWidth(v) {\r\n    if (this.hasAttribute(\"colWidth\")) {\r\n      this.setAttribute(\"colWidth\", \"\" + v);\r\n    } else {\r\n      this._colWidth = v;\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"two-column-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let p = this;\r\n\r\n    for (let i = 0; i < this.parentDepth; i++) {\r\n      p = p.parentWidget ? p.parentWidget : p;\r\n    }\r\n\r\n    if (!p) {\r\n      return;\r\n    }\r\n\r\n    let r = p.getBoundingClientRect();\r\n\r\n    if (!r) {\r\n      return;\r\n    }\r\n\r\n    let style = r.width > this.colWidth*2.0 ? 'row' : 'column';\r\n\r\n    if (this.style[\"flex-direction\"] !== style) {\r\n      this.style[\"flex-direction\"] = style;\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TwoColumnFrame);\r\n", "let _ScreenArea = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\nimport {haveModal} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\n\r\nimport nstructjs from '../path-controller/util/struct.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nimport {EnumProperty} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nlet Vector2 = vectormath.Vector2;\r\nlet Screen = undefined;\r\n\r\nimport {AreaFlags, BORDER_ZINDEX_BASE, ScreenBorder, snap, snapi} from './FrameManager_mesh.js';\r\n\r\nexport {AreaFlags};\r\n\r\nexport * from './area_wrangler.js';\r\nimport {getAreaIntName, setAreaTypes, contextWrangler, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nexport {contextWrangler};\r\n\r\nwindow._contextWrangler = contextWrangler;\r\n\r\nexport const BorderMask = {\r\n  LEFT  : 1,\r\n  BOTTOM: 2,\r\n  RIGHT : 4,\r\n  TOP   : 8,\r\n  ALL   : 1 | 2 | 4 | 8\r\n};\r\n\r\nexport const BorderSides = {\r\n  LEFT  : 0,\r\n  BOTTOM: 1,\r\n  RIGHT : 2,\r\n  TOP   : 3\r\n};\r\n\r\n/**\r\n * Base class for all editors\r\n **/\r\nexport class Area extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    /**\r\n     * -----b4----\r\n     *\r\n     * b1       b3\r\n     *\r\n     * -----b2----\r\n     *\r\n     * */\r\n\r\n    let def = this.constructor.define();\r\n\r\n    //set bits in mask to keep\r\n    //borders from moving\r\n    this.borderLock = def.borderLock || 0;\r\n    this.flag = def.flag || 0;\r\n\r\n    this.inactive = true;\r\n    this.areaDragToolEnabled = true;\r\n\r\n    this.owning_sarea = undefined;\r\n    this._area_id = contextWrangler.idgen++;\r\n\r\n    this.pos = undefined; //set by screenarea parent\r\n    this.size = undefined; //set by screenarea parent\r\n    this.minSize = [5, 5];\r\n    this.maxSize = [undefined, undefined];\r\n\r\n    let appendChild = this.shadow.appendChild;\r\n    this.shadow.appendChild = (child) => {\r\n      appendChild.call(this.shadow, child);\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    }\r\n\r\n    let prepend = this.shadow.prepend;\r\n    this.shadow.prepend = (child) => {\r\n      prepend.call(this.shadow, child);\r\n\r\n      if (child instanceof UIBase) {\r\n        child.parentWidget = this;\r\n      }\r\n    };\r\n  }\r\n\r\n  get floating() {\r\n    return ~~(this.flag & AreaFlags.FLOATING);\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get active area as defined by push_ctx_active and pop_ctx_active.\r\n   *\r\n   * Type should be an Area subclass, if undefined the last accessed area\r\n   * will be returned.\r\n   * */\r\n  static getActiveArea(type) {\r\n    return contextWrangler.getLastArea(type);\r\n  }\r\n\r\n  static unregister(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    if (def.areaname in areaclasses) {\r\n      delete areaclasses[def.areaname];\r\n    }\r\n  }\r\n\r\n  /*\r\n  addEventListener(type, cb, options) {\r\n    let cb2 = (e) => {\r\n      let x, y;\r\n      let screen = this.getScreen();\r\n\r\n      if (!screen) {\r\n        console.warn(\"no screen!\");\r\n        return cb(elem);\r\n      }\r\n\r\n      if (type.startsWith(\"mouse\")) {\r\n        x = e.x; y = e.y;\r\n      } else if (type.startsWith(\"touch\") && e.touches && e.touches.length > 0) {\r\n        x = e.touches[0].pageX; y = e.touches[0].pageY;\r\n      } else if (type.startsWith(\"pointer\")) {\r\n        x = e.x; y = e.y;\r\n      } else {\r\n        if (screen) {\r\n          x = screen.mpos[0];\r\n          y = screen.mpos[1];\r\n        } else {\r\n          x = y = -100;\r\n        }\r\n      }\r\n\r\n      let elem = screen.pickElement(x, y);\r\n      console.log(elem ? elem.tagName : undefined);\r\n\r\n      if (elem === this || elem === this.owning_sarea) {\r\n        return cb(elem);\r\n      }\r\n    };\r\n\r\n    cb.__cb2 = cb2;\r\n    return super.addEventListener(type, cb2, options);\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    super.removeEventListener(type, cb.__cb2, options);\r\n  }\r\n  //*/\r\n\r\n  static register(cls) {\r\n    let def = cls.define();\r\n\r\n    if (!def.areaname) {\r\n      throw new Error(\"Missing areaname key in define()\");\r\n    }\r\n\r\n    areaclasses[def.areaname] = cls;\r\n\r\n    ui_base.UIBase.internalRegister(cls);\r\n  }\r\n\r\n  static makeAreasEnum() {\r\n    let areas = {};\r\n    let icons = {};\r\n    let i = 0;\r\n\r\n    for (let k in areaclasses) {\r\n      let cls = areaclasses[k];\r\n      let def = cls.define();\r\n\r\n      if (def.flag & AreaFlags.HIDDEN)\r\n        continue;\r\n\r\n      let uiname = def.uiname;\r\n\r\n      if (uiname === undefined) {\r\n        uiname = k.replace(\"_\", \" \").toLowerCase();\r\n        uiname = uiname[0].toUpperCase() + uiname.slice(1, uiname.length);\r\n      }\r\n\r\n      areas[uiname] = k;\r\n      icons[uiname] = def.icon !== undefined ? def.icon : -1;\r\n    }\r\n\r\n    let prop = new EnumProperty(undefined, areas);\r\n    prop.addIcons(icons);\r\n\r\n    return prop;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"pathux-editor-x\", // tag name, e.g. editor-x\r\n      areaname: undefined, //api name for area type\r\n      flag    : 0, //see AreaFlags\r\n      uiname  : undefined,\r\n      icon    : undefined //icon representing area in MakeHeader's area switching menu. Integer.\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.noMarginsOrPadding();\r\n\r\n    let onover = (e) => {\r\n      //console.log(this._area_id, this.ctx.workspace._area_id);\r\n\r\n      //try to trigger correct entry in context area stacks\r\n      this.push_ctx_active();\r\n      this.pop_ctx_active();\r\n    };\r\n\r\n    //*\r\n    super.addEventListener(\"mouseover\", onover, {passive: true});\r\n    super.addEventListener(\"mousemove\", onover, {passive: true});\r\n    super.addEventListener(\"mousein\", onover, {passive: true});\r\n    super.addEventListener(\"mouseenter\", onover, {passive: true});\r\n    super.addEventListener(\"touchstart\", onover, {passive: true});\r\n    super.addEventListener(\"focusin\", onover, {passive: true});\r\n    super.addEventListener(\"focus\", onover, {passive: true});\r\n    //*/\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    if (this.flag & AreaFlags.INDEPENDENT) {\r\n      return this._id;\r\n    } else {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return a list of keymaps used by this editor\r\n   * @returns {Array<KeyMap>}\r\n   */\r\n  getKeyMaps() {\r\n    return this.keymap !== undefined ? [this.keymap] : [];\r\n  }\r\n\r\n  on_fileload(isActiveEditor) {\r\n    contextWrangler.reset();\r\n  }\r\n\r\n  buildDataPath() {\r\n    let p = this;\r\n\r\n    let sarea = this.owning_sarea;\r\n\r\n    if (sarea === undefined || sarea.screen === undefined) {\r\n      console.warn(\"Area.buildDataPath(): Failed to build data path\");\r\n      return \"\";\r\n    }\r\n\r\n    let screen = sarea.screen;\r\n\r\n    let idx1 = screen.sareas.indexOf(sarea);\r\n    let idx2 = sarea.editors.indexOf(this);\r\n\r\n    if (idx1 < 0 || idx2 < 0) {\r\n      throw new Error(\"malformed area data\");\r\n    }\r\n\r\n    let ret = `screen.sareas[${idx1}].editors[${idx2}]`;\r\n    return ret;\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      _area_id: this._area_id,\r\n      areaName: this.areaName\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    let id = obj._area_id;\r\n\r\n    if (id !== undefined && id !== null) {\r\n      this._area_id = id;\r\n    }\r\n  }\r\n\r\n  draw() {\r\n  }\r\n\r\n  copy() {\r\n    console.warn(\"You might want to implement this, Area.prototype.copy based method called\");\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    return ret;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n  }\r\n\r\n  on_area_focus() {\r\n\r\n  }\r\n\r\n  on_area_blur() {\r\n\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_active() {\r\n  }\r\n\r\n  /** called when editors are swapped with another editor type*/\r\n  on_area_inactive() {\r\n  }\r\n\r\n  /*\r\n  * This is needed so UI controls can know what their parent area is.\r\n  * For example, a slider with data path \"view2d.zoomfac\" needs to know where\r\n  * to find view2d.\r\n  *\r\n  * Typically this works by adding a field to a ContextOverlay:\r\n  *\r\n  * class ContextOverlay {\r\n  *   get view3d() {\r\n  *     return Area.getActiveArea(View3D);\r\n  *   }\r\n  * }\r\n  *\r\n  * Make sure to wrap event callbacks in push_ctx_active and pop_ctx_active.\r\n  * */\r\n  push_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.updateLastRef(this.constructor, this);\r\n    contextWrangler.push(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  /**\r\n   * see push_ctx_active\r\n   * */\r\n  pop_ctx_active(dontSetLastRef = false) {\r\n    contextWrangler.pop(this.constructor, this, !dontSetLastRef);\r\n  }\r\n\r\n  getScreen() {\r\n    //XXX\r\n    //return _appstate.screen;\r\n    throw new Error(\"replace me in Area.prototype\");\r\n  }\r\n\r\n  toJSON() {\r\n    return Object.assign(super.toJSON(), {\r\n      areaname: this.constructor.define().areaname,\r\n      _area_id: this._area_id\r\n    });\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    super.loadJSON(obj);\r\n    this._area_id = obj._area_id;\r\n\r\n    return this;\r\n  }\r\n\r\n  getBarHeight() {\r\n    return this.header.getClientRects()[0].height;\r\n  }\r\n\r\n  makeAreaSwitcher(container) {\r\n    if (cconst.useAreaTabSwitcher) {\r\n      let ret = UIBase.createElement(\"area-docker-x\");\r\n      container.add(ret);\r\n      return ret;\r\n    }\r\n\r\n    let prop = Area.makeAreasEnum();\r\n\r\n    let dropbox = container.listenum(undefined, {\r\n      name    : this.constructor.define().uiname,\r\n      enumDef : prop,\r\n      callback: (id) => {\r\n        let cls = areaclasses[id];\r\n        this.owning_sarea.switch_editor(cls);\r\n      }\r\n    });\r\n\r\n    dropbox.update.after(() => {\r\n      let name = this.constructor.define().uiname;\r\n      let val = prop.values[name];\r\n\r\n      if (dropbox.value !== val && val in prop.keys) {\r\n        val = prop.keys[val];\r\n      }\r\n\r\n      if (dropbox.value !== val) {\r\n        dropbox.setValue(prop.values[name], true);\r\n      }\r\n    });\r\n\r\n    return dropbox;\r\n  }\r\n\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    let switcherRow;\r\n    let row;\r\n    let helpRow;\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER) && cconst.useAreaTabSwitcher) {\r\n      let col = this.header = container.col();\r\n\r\n      switcherRow = helpRow = col.row();\r\n      row = col.row();\r\n    } else {\r\n      row = helpRow = this.header = container.row();\r\n    }\r\n\r\n    if (!(this.flag & AreaFlags.NO_HEADER_CONTEXT_MENU)) {\r\n      let callmenu = ScreenBorder.bindBorderMenu(this.header, true);\r\n\r\n      this.addEventListener(\"mousedown\", e => {\r\n        if (e.button !== 2 || this.header.pickElement(e.x, e.y) !== this.header) {\r\n          return;\r\n        }\r\n\r\n        callmenu(e);\r\n      });\r\n    }\r\n\r\n    this.header.remove();\r\n    container._prepend(this.header);\r\n\r\n    row.setCSS.after(() => row.background = this.getDefault(\"AreaHeaderBG\"));\r\n\r\n    let rh = ~~(16*this.getDPI());\r\n\r\n    //container.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n    //row.setSize(undefined, rh);\r\n\r\n    container.noMarginsOrPadding();\r\n    row.noMarginsOrPadding();\r\n\r\n    row.style[\"width\"] = \"100%\";\r\n    row.style[\"margin\"] = \"0px\";\r\n    row.style[\"padding\"] = \"0px\";\r\n\r\n    if (!(this.flag & AreaFlags.NO_SWITCHER)) {\r\n      if (this.switcher) {\r\n        //add back same switcher\r\n        switcherRow.add(this.switcher);\r\n      } else {\r\n        this.switcher = this.makeAreaSwitcher(cconst.useAreaTabSwitcher ? switcherRow : row);\r\n      }\r\n    }\r\n\r\n    if (util.isMobile() || cconst.addHelpPickers) {\r\n      if (this.helppicker) {\r\n        this.helppicker.remove();\r\n      }\r\n\r\n      this.helppicker = helpRow.helppicker();\r\n      this.helppicker.iconsheet = 0;\r\n    }\r\n\r\n    if (add_note_area) {\r\n      let notef = UIBase.createElement(\"noteframe-x\");\r\n      notef.ctx = this.ctx;\r\n      row._add(notef);\r\n    }\r\n\r\n    /* don't do normal dragging for tab switchers */\r\n    if (cconst.useAreaTabSwitcher) {\r\n      return row;\r\n    }\r\n\r\n    let eventdom = this.header;\r\n\r\n    let mdown = false;\r\n    let mpos = new Vector2();\r\n\r\n    let mpre = (e, pageX, pageY) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      pageX = pageX === undefined ? e.x : pageX;\r\n      pageY = pageY === undefined ? e.y : pageY;\r\n\r\n      let node = this.getScreen().pickElement(pageX, pageY);\r\n\r\n      /*\r\n      while (node) {\r\n        if (node === row) {\r\n          break;\r\n        }\r\n        node = node.parentWidget;\r\n      }//*/\r\n\r\n      //console.log(node === row, node ? node._id : undefined, row._id)\r\n\r\n      if (node !== row) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    eventdom.addEventListener(\"pointerout\", (e) => {\r\n      //console.log(\"pointerout\", e);\r\n      mdown = false;\r\n    });\r\n    eventdom.addEventListener(\"pointerleave\", (e) => {\r\n      mdown = false;\r\n      //console.log(\"pointerleave\", e);\r\n    });\r\n\r\n    eventdom.addEventListener(\"pointerdown\", (e) => {\r\n      //console.log(\"pointerdown\", e, mpre(e));\r\n\r\n      if (!mpre(e)) return;\r\n\r\n      mpos[0] = e.pageX;\r\n      mpos[1] = e.pageY;\r\n      mdown = true;\r\n    });\r\n\r\n    let last_time = util.time_ms();\r\n\r\n    let do_mousemove = (e, pageX, pageY) => {\r\n      if (haveModal() || !make_draggable) {\r\n        return;\r\n      }\r\n\r\n      let mdown2 = e.buttons !== 0 || (e.touches && e.touches.length > 0);\r\n      mdown2 = mdown2 && mdown;\r\n\r\n      //console.log(\"area drag?\", e, mdown2, e.pageX, e.pageY, mpre(e, pageX, pageY), e.was_touch);\r\n\r\n      //calls to pickElement in mpre are expensive\r\n      if (util.time_ms() - last_time < 250) {\r\n        return;\r\n      }\r\n\r\n      last_time = util.time_ms;\r\n\r\n      if (!mdown2 || !mpre(e, pageX, pageY)) return;\r\n\r\n\r\n      if (e.type === \"mousemove\" && e.was_touch) {\r\n        //okay how are patched events getting here?\r\n        //avoid double call. . .\r\n        return;\r\n      }\r\n\r\n      //console.log(mdown);\r\n      let dx = pageX - mpos[0];\r\n      let dy = pageY - mpos[1];\r\n\r\n      let dis = dx*dx + dy*dy;\r\n      let limit = 7;\r\n\r\n      if (dis > limit*limit) {\r\n        let sarea = this.owning_sarea;\r\n        if (sarea === undefined) {\r\n          console.warn(\"Error: missing sarea ref\");\r\n          return;\r\n        }\r\n\r\n        let screen = sarea.screen;\r\n        if (screen === undefined) {\r\n          console.log(\"Error: missing screen ref\");\r\n          return;\r\n        }\r\n\r\n        if (!this.areaDragToolEnabled) {\r\n          return;\r\n        }\r\n        mdown = false;\r\n        console.log(\"area drag tool!\", e.type, e);\r\n        screen.areaDragTool(this.owning_sarea);\r\n      }\r\n    };\r\n\r\n    //not working on mobile\r\n    //row.setAttribute(\"draggable\", true);\r\n    //row.draggable = true;\r\n    /*\r\n    eventdom.addEventListener(\"dragstart\", (e) => {\r\n      return;\r\n      console.log(\"drag start!\", e);\r\n      e.dataTransfer.setData(\"text/json\", \"SplitAreaDrag\");\r\n\r\n      let canvas = document.createElement(\"canvas\");\r\n      let g = canvas.g;\r\n\r\n      canvas.width = 32;\r\n      canvas.height = 32;\r\n\r\n      e.dataTransfer.setDragImage(canvas, 0, 0);\r\n\r\n      mdown = false;\r\n      console.log(\"area drag tool!\");\r\n      this.getScreen().areaDragTool(this.owning_sarea);\r\n    });\r\n\r\n    eventdom.addEventListener(\"drag\", (e) => {\r\n      console.log(\"drag!\", e);\r\n    });*/\r\n\r\n    eventdom.addEventListener(\"pointermove\", (e) => {\r\n      return do_mousemove(e, e.pageX, e.pageY);\r\n    }, false);\r\n    eventdom.addEventListener(\"pointerup\", (e) => {\r\n      console.log(\"pointerup\", e);\r\n      mdown = false;\r\n    }, false);\r\n    eventdom.addEventListener(\"pointercancel\", (e) => {\r\n      console.log(\"pointercancel\", e);\r\n      mdown = false;\r\n    }, false);\r\n\r\n    return row;\r\n  }\r\n\r\n  setCSS() {\r\n    if (this.size !== undefined) {\r\n      this.style[\"position\"] = UIBase.PositionKey;\r\n      //this.style[\"left\"] = this.pos[0] + \"px\";\r\n      //this.style[\"top\"] = this.pos[1] + \"px\";\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n  }\r\n\r\n  update() {\r\n    //don't update non-active editors\r\n    if (this.owning_sarea === undefined || this !== this.owning_sarea.area) {\r\n      return;\r\n    }\r\n\r\n    super.update();\r\n\r\n    //see FrameManager.js, we use a single update\r\n    //function for everything now\r\n    //this._forEachChildWidget((n) => {\r\n    //  n.update();\r\n    //});\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  //called by owning ScreenArea on file load\r\n  afterSTRUCT() {\r\n    let f = () => {\r\n      if (this._isDead()) {\r\n        return;\r\n      }\r\n      if (!this.ctx) {\r\n        this.doOnce(f);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        ui_base.loadUIData(this, this.saved_uidata);\r\n        this.saved_uidata = undefined;\r\n      } catch (error) {\r\n        console.log(\"failed to load ui data\");\r\n        util.print_stack(error);\r\n      }\r\n    };\r\n\r\n    this.doOnce(f);\r\n  }\r\n\r\n  _getSavedUIData() {\r\n    return ui_base.saveUIData(this, \"area\");\r\n  }\r\n}\r\n\r\nArea.STRUCT = `\r\npathux.Area { \r\n  flag : int;\r\n  saved_uidata : string | obj._getSavedUIData();\r\n}\r\n`\r\n\r\nnstructjs.register(Area, \"pathux.Area\");\r\nui_base.UIBase.internalRegister(Area);\r\n\r\nexport class ScreenArea extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._flag = undefined;\r\n\r\n    this.flag = 0; /** holds AreaFlags.FLOATING and AreaFlags.INDEPENDENT */\r\n\r\n    this._borders = [];\r\n    this._verts = [];\r\n    this.dead = false;\r\n\r\n    this._sarea_id = contextWrangler.idgen++;\r\n\r\n    this._pos = new Vector2();\r\n    this._size = new Vector2([512, 512]);\r\n\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      let wrapVector = (name, axis) => {\r\n        Object.defineProperty(this[name], axis, {\r\n          get: function () {\r\n            return this[\"_\" + axis];\r\n          },\r\n\r\n          set: function (val) {\r\n            console.warn(`ScreenArea.${name}[${axis}] set:`, val);\r\n            this[\"_\" + axis] = val;\r\n          }\r\n        });\r\n      };\r\n\r\n      wrapVector(\"size\", 0);\r\n      wrapVector(\"size\", 1);\r\n      wrapVector(\"pos\", 0);\r\n      wrapVector(\"pos\", 1);\r\n    }\r\n\r\n    this.area = undefined;\r\n    this.editors = [];\r\n    this.editormap = {};\r\n\r\n    this.addEventListener(\"mouseover\", (e) => {\r\n      if (haveModal()) {\r\n        return;\r\n      }\r\n\r\n      //console.log(\"screen area mouseover\");\r\n      let screen = this.getScreen();\r\n      if (screen.sareas.active !== this && screen.sareas.active && screen.sareas.active.area) {\r\n        screen.sareas.active.area.on_area_blur();\r\n      }\r\n\r\n      if (this.area && screen.sareas.active !== this) {\r\n        this.area.on_area_focus();\r\n      }\r\n\r\n      screen.sareas.active = this;\r\n    });\r\n\r\n    //this.addEventListener(\"mouseleave\", (e) => {\r\n    //console.log(\"screen area mouseleave\");\r\n    //});\r\n  }\r\n\r\n  /*\r\n  saveData() {\r\n    return {\r\n      _sarea_id : this._sarea_id,\r\n      pos       : this.pos,\r\n      size      : this.size,\r\n    };\r\n  }\r\n  loadData(obj) {\r\n    super.loadData(obj);\r\n\r\n    let id = obj._sarea_id;\r\n    \r\n    let type = obj.areatype;\r\n    \r\n    if (id !== undefined && id !== null) {\r\n      this._sarea_id = id;\r\n    }\r\n    \r\n    for (let area of this.editors) {\r\n      if (area.areaType == type) {\r\n        console.log(\"             found saved area type\");\r\n        \r\n        this.switch_editor(area.constructor);\r\n      }\r\n    }\r\n    \r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n  }//*/\r\n\r\n  get floating() {\r\n    return this.flag & AreaFlags.FLOATING;\r\n  }\r\n\r\n  set floating(val) {\r\n    if (val) {\r\n      this.flag |= AreaFlags.FLOATING;\r\n    } else {\r\n      this.flag &= ~AreaFlags.FLOATING;\r\n    }\r\n  }\r\n\r\n  get flag() {\r\n    let flag = this._flag & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      flag |= this.area.flag;\r\n    }\r\n\r\n    return flag;\r\n  }\r\n\r\n  set flag(v) {\r\n    this._flag &= ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    this._flag |= v & (AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n\r\n    if (this.area) {\r\n      this.area.flag |= v & ~(AreaFlags.FLOATING | AreaFlags.INDEPENDENT);\r\n    }\r\n  }\r\n\r\n  get borderLock() {\r\n    return this.area !== undefined ? this.area.borderLock : 0;\r\n  }\r\n\r\n  get minSize() {\r\n    return this.area !== undefined ? this.area.minSize : this.size;\r\n  }\r\n\r\n  get maxSize() {\r\n    return this.area !== undefined ? this.area.maxSize : this.size;\r\n  }\r\n\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set pos(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set pos\", val);\r\n    }\r\n    this._pos.load(val);\r\n  }\r\n\r\n  get size() {\r\n    return this._size;\r\n  }\r\n\r\n  set size(val) {\r\n    if (cconst.DEBUG.screenAreaPosSizeAccesses) {\r\n      console.log(\"ScreenArea set size\", val);\r\n    }\r\n    this._size.load(val);\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(\"screenarea-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenarea-x\"\r\n    };\r\n  }\r\n\r\n  _get_v_suffix() {\r\n    return this.area ? this.area._get_v_suffix() : \"\";\r\n  }\r\n\r\n  bringToFront() {\r\n    let screen = this.getScreen();\r\n\r\n    HTMLElement.prototype.remove.call(this);\r\n    screen.sareas.remove(this);\r\n\r\n    screen.appendChild(this);\r\n\r\n    let zindex = BORDER_ZINDEX_BASE + 1;\r\n\r\n    if (screen.style[\"z-index\"]) {\r\n      zindex = parseInt(screen.style[\"z-index\"]) + 1;\r\n    }\r\n\r\n    for (let sarea of screen.sareas) {\r\n      let zindex = sarea.style[\"z-index\"];\r\n      if (sarea.style[\"z-index\"]) {\r\n        zindex = Math.max(zindex, parseInt(sarea.style[\"z-index\"]) + 1);\r\n      }\r\n    }\r\n\r\n    this.style[\"z-index\"] = zindex;\r\n  }\r\n\r\n  _side(border) {\r\n    let ret = this._borders.indexOf(border);\r\n    if (ret < 0) {\r\n      throw new Error(\"border not in screen area\");\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n  }\r\n\r\n  draw() {\r\n    if (this.area && this.area.draw) {\r\n      this.area.push_ctx_active();\r\n      this.area.draw();\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  _isDead() {\r\n    if (this.dead) {\r\n      return true;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n\r\n    if (screen === undefined)\r\n      return true;\r\n\r\n    if (screen.parentNode === undefined)\r\n      return true;\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      editors  : this.editors,\r\n      _sarea_id: this._sarea_id,\r\n      area     : this.area.constructor.define().areaname,\r\n      pos      : this.pos,\r\n      size     : this.size\r\n    };\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (this.area.on_keydown) {\r\n      this.area.push_ctx_active();\r\n      this.area.on_keydown(e);\r\n      this.area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadJSON(obj) {\r\n    if (obj === undefined) {\r\n      console.warn(\"undefined in loadJSON\");\r\n      return;\r\n    }\r\n\r\n    super.loadJSON(obj);\r\n\r\n    this.pos.load(obj.pos);\r\n    this.size.load(obj.size);\r\n\r\n    for (let editor of obj.editors) {\r\n      let areaname = editor.areaname;\r\n\r\n      //console.log(editor);\r\n\r\n      let tagname = areaclasses[areaname].define().tagname;\r\n      let area = UIBase.createElement(tagname);\r\n\r\n      area.owning_sarea = this;\r\n      this.editormap[areaname] = area;\r\n      this.editors.push(this.editormap[areaname]);\r\n\r\n      area.pos = new Vector2(obj.pos);\r\n      area.size = new Vector2(obj.size);\r\n      area.ctx = this.ctx;\r\n\r\n      area.inactive = true;\r\n      area.loadJSON(editor);\r\n      area.owning_sarea = undefined;\r\n\r\n      if (areaname === obj.area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.ctx = this.ctx;\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n      this.area.on_area_active();\r\n      this.area.onadd();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  _ondestroy() {\r\n    super._ondestroy();\r\n\r\n    this.dead = true;\r\n\r\n    for (let editor of this.editors) {\r\n      if (editor === this.area) continue;\r\n\r\n      editor._ondestroy();\r\n    }\r\n  }\r\n\r\n  getScreen() {\r\n    if (this.screen !== undefined) {\r\n      return this.screen;\r\n    }\r\n\r\n    //try to walk up graph, if possible\r\n    let p = this.parentNode;\r\n    let _i = 0;\r\n\r\n    while (p && !(p instanceof Screen) && p !== p.parentNode) {\r\n      p = this.parentNode;\r\n\r\n      if (_i++ > 1000) {\r\n        console.warn(\"infinite loop detected in ScreenArea.prototype.getScreen()\");\r\n        return undefined;\r\n      }\r\n    }\r\n\r\n    return p && p instanceof Screen ? p : undefined;\r\n  }\r\n\r\n  copy(screen) {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n\r\n    ret.screen = screen;\r\n    ret.ctx = this.ctx;\r\n\r\n    ret.pos[0] = this.pos[0];\r\n    ret.pos[1] = this.pos[1];\r\n\r\n    ret.size[0] = this.size[0];\r\n    ret.size[1] = this.size[1];\r\n\r\n    for (let area of this.editors) {\r\n      let cpy = area.copy();\r\n\r\n      cpy.ctx = this.ctx;\r\n\r\n      cpy.parentWidget = ret;\r\n      ret.editors.push(cpy);\r\n      ret.editormap[cpy.constructor.define().areaname] = cpy;\r\n\r\n      if (area === this.area) {\r\n        ret.area = cpy;\r\n      }\r\n    }\r\n\r\n    //console.trace(\"RET.AREA\", this.area, ret.area);\r\n\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.area !== undefined) {\r\n      ret.area.ctx = this.ctx;\r\n\r\n      ret.area.pos = ret.pos;\r\n      ret.area.size = ret.size;\r\n      ret.area.owning_sarea = ret;\r\n      ret.area.parentWidget = ret;\r\n\r\n      ret.shadow.appendChild(ret.area);\r\n      //ret.area.onadd();\r\n\r\n      if (ret.area._init_done) {\r\n        ret.area.push_ctx_active();\r\n        ret.area.on_area_active();\r\n        ret.area.pop_ctx_active();\r\n      } else {\r\n        ret.doOnce(() => {\r\n          if (this.dead) {\r\n            return;\r\n          }\r\n          ret._init();\r\n          ret.area._init();\r\n          ret.area.push_ctx_active();\r\n          ret.area.on_area_active();\r\n          ret.area.pop_ctx_active();\r\n        });\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  snapToScreenSize() {\r\n    let screen = this.getScreen();\r\n    let co = new Vector2();\r\n    let changed = 0;\r\n\r\n    for (let v of this._verts) {\r\n      co.load(v);\r\n\r\n      v[0] = Math.min(Math.max(v[0], 0), screen.size[0]);\r\n      v[1] = Math.min(Math.max(v[1], 0), screen.size[1]);\r\n\r\n      if (co.vectorDistance(v) > 0.1) {\r\n        changed = 1;\r\n      }\r\n    }\r\n\r\n    if (changed) {\r\n      this.loadFromVerts();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets screen verts from pos/size\r\n   * */\r\n  loadFromPosSize() {\r\n    if (this.floating && this._verts.length > 0) {\r\n      let p = this.pos, s = this.size;\r\n\r\n      this._verts[0].loadXY(p[0], p[1]);\r\n      this._verts[1].loadXY(p[0], p[1] + s[1]);\r\n      this._verts[2].loadXY(p[0] + s[0], p[1] + s[1]);\r\n      this._verts[3].loadXY(p[0] + s[0], p[1]);\r\n\r\n      for (let border of this._borders) {\r\n        border.setCSS();\r\n      }\r\n\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let screen = this.getScreen();\r\n    if (!screen) return;\r\n\r\n    for (let b of this._borders) {\r\n      screen.freeBorder(b);\r\n    }\r\n\r\n    this.makeBorders(screen);\r\n    this.setCSS();\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Sets pos/size from screen verts\r\n   * */\r\n  loadFromVerts() {\r\n    if (this._verts.length == 0) {\r\n      return;\r\n    }\r\n\r\n    let min = new Vector2([1e17, 1e17]);\r\n    let max = new Vector2([-1e17, -1e17]);\r\n\r\n    for (let v of this._verts) {\r\n      min.min(v);\r\n      max.max(v);\r\n    }\r\n\r\n    this.pos[0] = min[0];\r\n    this.pos[1] = min[1];\r\n\r\n    this.size[0] = max[0] - min[0];\r\n    this.size[1] = max[1] - min[1];\r\n\r\n    this.setCSS();\r\n    return this;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.on_resize(size, oldsize);\r\n    }\r\n  }\r\n\r\n  makeBorders(screen) {\r\n    this._borders.length = 0;\r\n    this._verts.length = 0;\r\n\r\n    let p = this.pos, s = this.size;\r\n\r\n    //s = snapi(new Vector2(s));\r\n\r\n    let vs = [\r\n      new Vector2([p[0], p[1]]),\r\n      new Vector2([p[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1] + s[1]]),\r\n      new Vector2([p[0] + s[0], p[1]])\r\n    ];\r\n\r\n    let floating = this.floating;\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      vs[i] = snap(vs[i]);\r\n      vs[i] = screen.getScreenVert(vs[i], i, floating);\r\n      this._verts.push(vs[i]);\r\n    }\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i], v2 = vs[(i + 1)%vs.length];\r\n\r\n      let b = screen.getScreenBorder(this, v1, v2, i);\r\n\r\n\r\n      for (let j = 0; j < 2; j++) {\r\n        let v = j ? b.v2 : b.v1;\r\n\r\n        if (v.sareas.indexOf(this) < 0) {\r\n          v.sareas.push(this);\r\n        }\r\n      }\r\n\r\n      if (b.sareas.indexOf(this) < 0) {\r\n        b.sareas.push(this);\r\n      }\r\n\r\n      this._borders.push(b);\r\n\r\n      b.movable = screen.isBorderMovable(b);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n\r\n    this.style[\"width\"] = this.size[0] + \"px\";\r\n    this.style[\"height\"] = this.size[1] + \"px\";\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n    this.style[\"contain\"] = \"layout\"; //ensure we have a new positioning stack\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.setCSS();\r\n    }\r\n  }\r\n\r\n  appendChild(child) {\r\n    if (child instanceof Area) {\r\n      let def = child.constructor.define();\r\n      let existing = this.editormap[def.areaname];\r\n\r\n      if (existing && existing !== child) {\r\n        console.warn(\"Warning, replacing an exising editor instance\", child, existing);\r\n\r\n        if (this.area === existing) {\r\n          this.area = child;\r\n        }\r\n\r\n        existing.remove();\r\n        this.editors.remove(existing, true);\r\n        this.editormap[def.areaname] = child;\r\n      }\r\n\r\n      child.ctx = this.ctx;\r\n      child.pos = this.pos;\r\n      child.size = this.size;\r\n\r\n      if (this.editors.indexOf(child) < 0) {\r\n        this.editors.push(child);\r\n      }\r\n\r\n      child.owning_sarea = undefined;\r\n      if (this.area === undefined) {\r\n        this.area = child;\r\n      }\r\n    }\r\n\r\n    super.appendChild(child);\r\n\r\n    if (child instanceof ui_base.UIBase) {\r\n      child.parentWidget = this;\r\n      child.onadd();\r\n    }\r\n  }\r\n\r\n  switch_editor(cls) {\r\n    return this.switchEditor(cls);\r\n  }\r\n\r\n  switchEditor(cls) {\r\n    let def = cls.define();\r\n    let name = def.areaname;\r\n\r\n    //areaclasses[name]\r\n    if (!(name in this.editormap)) {\r\n      this.editormap[name] = UIBase.createElement(def.tagname);\r\n      this.editormap[name].ctx = this.ctx;\r\n      this.editormap[name].parentWidget = this;\r\n      this.editormap[name].owning_sarea = this;\r\n      this.editormap[name].inactive = false;\r\n\r\n      this.editors.push(this.editormap[name]);\r\n    }\r\n\r\n    //var finish = () => {\r\n    if (this.area) {\r\n      //break direct pos/size references for old active area\r\n      this.area.pos = new Vector2(this.area.pos);\r\n      this.area.size = new Vector2(this.area.size);\r\n\r\n      this.area.owning_sarea = undefined;\r\n      this.area.inactive = true;\r\n      this.area.push_ctx_active();\r\n      this.area._init(); //check that init was called\r\n      this.area.on_area_inactive();\r\n      this.area.pop_ctx_active();\r\n\r\n      this.area.remove();\r\n    } else {\r\n      this.area = undefined;\r\n    }\r\n\r\n    this.area = this.editormap[name];\r\n\r\n    this.area.inactive = false;\r\n    this.area.parentWidget = this;\r\n\r\n    //. . .and set references to pos/size\r\n    this.area.pos = this.pos;\r\n    this.area.size = this.size;\r\n    this.area.owning_sarea = this;\r\n    this.area.ctx = this.ctx;\r\n\r\n    this.area.packflag |= this.packflag;\r\n\r\n    this.shadow.appendChild(this.area);\r\n\r\n    this.area.style[\"width\"] = \"100%\";\r\n    this.area.style[\"height\"] = \"100%\";\r\n\r\n    //propegate new size\r\n    this.area.push_ctx_active();\r\n    this.area._init(); //check that init was called\r\n    this.area.on_resize(this.size, this.size);\r\n    this.area.pop_ctx_active();\r\n\r\n    this.area.push_ctx_active();\r\n    this.area.on_area_active();\r\n    this.area.pop_ctx_active();\r\n\r\n    this.regenTabOrder();\r\n    //}\r\n  }\r\n\r\n  _checkWrangler() {\r\n    if (this.ctx)\r\n      contextWrangler._checkWrangler(this.ctx);\r\n  }\r\n\r\n  update() {\r\n    this._checkWrangler();\r\n\r\n    super.update();\r\n\r\n    //flag client controller implementation that\r\n    //this area is active for its type\r\n    if (this.area !== undefined) {\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n      this.area.size = this.size;\r\n      this.area.pos = this.pos;\r\n\r\n      let screen = this.getScreen();\r\n      let oldsize = [this.size[0], this.size[1]];\r\n\r\n      let moved = screen ? screen.checkAreaConstraint(this, true) : 0;\r\n      //*\r\n      if (moved) {\r\n        if (cconst.DEBUG.areaConstraintSolver) {\r\n          console.log(\"screen constraint solve\", moved, this.area.minSize, this.area.maxSize, this.area.tagName, this.size);\r\n        }\r\n\r\n        screen.solveAreaConstraints();\r\n        screen.regenBorders();\r\n        this.on_resize(oldsize);\r\n      }//*/\r\n\r\n      this.area.push_ctx_active(true);\r\n    }\r\n\r\n    this._forEachChildWidget((n) => {\r\n      n.update();\r\n    });\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.pop_ctx_active(true);\r\n    }\r\n  }\r\n\r\n  removeChild(ch) {\r\n    if (ch instanceof Area) {\r\n      ch.owining_sarea = undefined;\r\n      ch.pos = undefined;\r\n      ch.size = undefined;\r\n\r\n      if (this.area === ch && this.editors.length > 1) {\r\n        let i = (this.editors.indexOf(ch) + 1)%this.editors.length;\r\n        this.switchEditor(this.editors[i].constructor);\r\n      } else if (this.area === ch) {\r\n        this.editors = [];\r\n        this.editormap = {};\r\n        this.area = undefined;\r\n\r\n        ch.remove();\r\n        return;\r\n      }\r\n\r\n      let areaname = ch.constructor.define().areaname;\r\n\r\n      this.editors.remove(ch);\r\n      delete this.editormap[areaname];\r\n\r\n      ch.parentWidget = undefined;\r\n    } else {\r\n      return super.removeChild(ch);\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let area of this.editors) {\r\n      area.pos = this.pos;\r\n      area.size = this.size;\r\n      area.owning_sarea = this;\r\n\r\n      area.push_ctx_active();\r\n      area._ctx = this.ctx;\r\n      area.afterSTRUCT();\r\n      area.pop_ctx_active();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n\r\n    this.pos = new Vector2(this.pos);\r\n    this.size = new Vector2(this.size);\r\n\r\n    //find active editor\r\n\r\n    let editors = [];\r\n\r\n    for (let area of this.editors) {\r\n      if (!area.constructor || !area.constructor.define || area.constructor === Area) {\r\n        //failed to load this area\r\n        continue;\r\n      }\r\n\r\n      /*\r\n      if (area.constructor === undefined || area.constructor.define === undefined) {\r\n        console.warn(\"Missing class for area\", area, \"maybe buggy loadSTRUCT()?\");\r\n        continue;\r\n      }\r\n      //*/\r\n\r\n      let areaname = area.constructor.define().areaname;\r\n\r\n      area.inactive = true;\r\n      area.owning_sarea = undefined;\r\n      this.editormap[areaname] = area;\r\n\r\n      if (areaname === this.area) {\r\n        this.area = area;\r\n      }\r\n\r\n      /*\r\n      * originally inactive areas weren't supposed to have\r\n      * a reference to their owning ScreenAreas.\r\n      *\r\n      * Unfortunately this will cause isDead() to return true,\r\n      * which might lead to nasty problems.\r\n      * */\r\n      area.parentWidget = this;\r\n\r\n      editors.push(area);\r\n    }\r\n    this.editors = editors;\r\n\r\n    if (typeof this.area !== \"object\") {\r\n      let area = this.editors[0];\r\n\r\n      console.warn(\"Failed to find active area!\", this.area);\r\n\r\n      if (typeof area !== \"object\") {\r\n        for (let k in areaclasses) {\r\n          area = areaclasses[k].define().tagname;\r\n          area = UIBase.createElement(area);\r\n          let areaname = area.constructor.define().areaname;\r\n\r\n          this.editors.push(area);\r\n          this.editormap[areaname] = area;\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (area) {\r\n        this.area = area;\r\n      }\r\n    }\r\n\r\n    if (this.area !== undefined) {\r\n      this.area.style[\"width\"] = \"100%\";\r\n      this.area.style[\"height\"] = \"100%\";\r\n      this.area.owning_sarea = this;\r\n      this.area.parentWidget = this;\r\n\r\n      this.area.pos = this.pos;\r\n      this.area.size = this.size;\r\n\r\n      this.area.inactive = false;\r\n      this.shadow.appendChild(this.area);\r\n\r\n      let f = () => {\r\n        if (this._isDead()) {\r\n          return;\r\n        }\r\n\r\n        if (!this.ctx && this.parentNode) {\r\n          console.log(\"waiting to start. . .\");\r\n          this.doOnce(f);\r\n          return;\r\n        }\r\n\r\n        this.area.ctx = this.ctx;\r\n        this.area._init(); //ensure init has been called already\r\n        this.area.on_area_active();\r\n        this.area.onadd();\r\n      };\r\n\r\n      this.doOnce(f);\r\n    }\r\n\r\n  }\r\n}\r\n\r\nScreenArea.STRUCT = `\r\npathux.ScreenArea { \r\n  pos      : vec2;\r\n  size     : vec2;\r\n  type     : string;\r\n  hidden   : bool;\r\n  editors  : array(abstract(pathux.Area));\r\n  area     : string | this.area ? this.area.constructor.define().areaname : \"\";\r\n}\r\n`;\r\n\r\nnstructjs.register(ScreenArea, \"pathux.ScreenArea\");\r\nui_base.UIBase.internalRegister(ScreenArea);\r\n\r\nui_base._setAreaClass(Area);\r\n\r\nexport function setScreenClass(cls) {\r\n  Screen = cls;\r\n}\r\n", "import * as util from '../path-controller/util/util.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport {Icons, css2color, color2css} from '../core/ui_base.js';\r\n\r\nlet UIBase = ui_base.UIBase;\r\n\r\nexport class Note extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n\r\n    this._noteid = undefined;\r\n    this.height = 20;\r\n\r\n    this.showExclMark = true;\r\n\r\n    style.textContent = `\r\n    .notex {\r\n      display : flex;\r\n      flex-direction : row;\r\n      flex-wrap : nowrap;\r\n      height : {this.height}px;\r\n      padding : 0px;\r\n      margin : 0px;\r\n    }\r\n    `;\r\n\r\n    this.dom = document.createElement(\"div\");\r\n    this.dom.setAttribute(\"class\", \"notex\");\r\n    this.color = \"red\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.append(this.dom);\r\n    this.setLabel(\"\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setLabel(s) {\r\n    let color = this.color;\r\n    if (this.showExclMark && this.mark === undefined) {\r\n      this.mark = document.createElement(\"div\");\r\n      this.mark.style[\"display\"] = \"flex\";\r\n      this.mark.style[\"flex-direction\"] = \"row\";\r\n      this.mark.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      //this.mark.style[\"width\"]\r\n      let sheet = 0;\r\n\r\n      let size = ui_base.iconmanager.getTileSize(sheet);\r\n\r\n      this.mark.style[\"width\"] = \"\" + size + \"px\";\r\n      this.mark.style[\"height\"] = \"\" + size + \"px\";\r\n\r\n      this.dom.appendChild(this.mark);\r\n\r\n      this.ntext = document.createElement(\"div\");\r\n      this.ntext.style[\"display\"] = \"inline-flex\";\r\n      this.ntext.style[\"flex-wrap\"] = \"nowrap\";\r\n\r\n      this.dom.appendChild(this.ntext);\r\n\r\n      ui_base.iconmanager.setCSS(Icons.NOTE_EXCL, this.mark, sheet);\r\n\r\n      //this.mark.style[\"margin\"] = this.ntext.style[\"margin\"] = \"0px\"\r\n      //this.mark.style[\"padding\"] = this.ntext.style[\"padding\"] = \"0px\"\r\n      //this.mark.style[\"background-color\"] = color;\r\n    } else if (!this.showExclMark && this.mark) {\r\n      this.mark.remove();\r\n      this.mark = undefined;\r\n    }\r\n\r\n    let ntext = this.ntext;\r\n    //mark.innerText = \"!\";\r\n    ntext.innerText = \" \" + s;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"notex\");\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-wrap\"] = \"nowrap\";\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"border-radius\"] = \"7px\";\r\n    this.style[\"padding\"] = \"2px\";\r\n\r\n    this.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    let clr = css2color(this.color);\r\n    clr = color2css([clr[0], clr[1], clr[2], 0.25]);\r\n\r\n    this.style[\"background-color\"] = clr;\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Note);\r\n\r\nexport class ProgBarNote extends Note {\r\n  constructor() {\r\n    super();\r\n\r\n    this._percent = 0.0;\r\n    this.barWidth = 100;\r\n\r\n    let bar = this.bar = document.createElement(\"div\");\r\n    bar.style[\"display\"] = \"flex\";\r\n    bar.style[\"flex-direction\"] = \"row\";\r\n    bar.style[\"width\"] = this.barWidth + \"px\";\r\n    bar.style[\"height\"] = this.height + \"px\";\r\n    bar.style[\"background-color\"] = this.getDefault(\"ProgressBarBG\");\r\n    bar.style[\"border-radius\"] = \"12px\";\r\n    bar.style[\"align-items\"] = \"center\";\r\n    bar.style[\"padding\"] = bar.style[\"margin\"] = \"0px\";\r\n\r\n    let bar2 = this.bar2 = document.createElement(\"div\");\r\n    let w = 50.0;\r\n\r\n    bar2.style[\"display\"] = \"flex\";\r\n    bar2.style[\"flex-direction\"] = \"row\";\r\n    bar2.style[\"height\"] = this.height + \"px\";\r\n    bar2.style[\"background-color\"] = this.getDefault(\"ProgressBar\");\r\n    bar2.style[\"border-radius\"] = \"12px\";\r\n    bar2.style[\"align-items\"] = \"center\";\r\n    bar2.style[\"padding\"] = bar2.style[\"margin\"] = \"0px\";\r\n\r\n    this.bar.appendChild(bar2);\r\n    this.dom.appendChild(this.bar);\r\n  }\r\n\r\n  get percent() {\r\n    return this._percent;\r\n  }\r\n\r\n  set percent(val) {\r\n    this._percent = val;\r\n    this.setCSS();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"note-progress-x\",\r\n      style  : 'notification',\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = ~~(this.percent*this.barWidth + 0.5);\r\n\r\n    this.bar2.style[\"width\"] = w + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ProgBarNote);\r\n\r\nexport class NoteFrame extends ui.RowFrame {\r\n  constructor() {\r\n    super();\r\n    this._h = 20;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"noteframe-x\",\r\n      style  : 'noteframe',\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    noteframes.push(this);\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style['flex-grow'] = 'unset';\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = this._h + \"px\";\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (noteframes.indexOf(this) >= 0) {\r\n      noteframes.remove(this)\r\n    }\r\n\r\n    super._ondestroy();\r\n  }\r\n\r\n  progbarNote(msg, percent, color = \"rgba(255,0,0,0.2)\", timeout = 700, id = msg) {\r\n    let note;\r\n\r\n    for (let child of this.children) {\r\n      if (child._noteid === id) {\r\n        note = child;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let f = (100.0*Math.min(percent, 1.0)).toFixed(1);\r\n\r\n    if (note === undefined) {\r\n      note = this.addNote(msg, color, -1, \"note-progress-x\");\r\n      note._noteid = id;\r\n    }\r\n\r\n    //note.setLabel(msg + \" \" + f + \"%\");\r\n    note.percent = percent;\r\n\r\n    if (percent >= 1.0) {\r\n      //note.setLabel(msg + \" \" + f + \"%\");\r\n\r\n      window.setTimeout(() => {\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    return note;\r\n  }\r\n\r\n  addNote(msg, color = \"rgba(255,0,0,0.2)\", timeout = 1200, tagname = \"note-x\", showExclMark=true) {\r\n    //let note = UIBase.createElement(\"note-x\");\r\n\r\n    //note.ctx = this.ctx;\r\n    //note.background = \"red\";\r\n    //note.dom.innerText = msg;\r\n\r\n    //this._add(note);\r\n\r\n    let note = UIBase.createElement(tagname);\r\n\r\n    note.color = color;\r\n    note.setLabel(msg);\r\n\r\n    note.style[\"text-align\"] = \"center\";\r\n\r\n    note.style[\"font\"] = ui_base.getFont(note, \"DefaultText\");\r\n    note.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    note.showExclMark = showExclMark;\r\n\r\n    this.add(note);\r\n\r\n    this.noMarginsOrPadding();\r\n    note.noMarginsOrPadding();\r\n\r\n    //this.dom.style[\"position\"] = UIBase.PositionKey;\r\n    //this.style[\"position\"] = UIBase.PositionKey;\r\n    //note.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    note.style[\"height\"] = this._h + \"px\";\r\n    note.height = this._h;\r\n\r\n    if (timeout !== -1) {\r\n      window.setTimeout(() => {\r\n        //console.log(\"remove!\");\r\n        note.remove();\r\n      }, timeout);\r\n    }\r\n\r\n    //this.appendChild(note);\r\n    return note;\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NoteFrame);\r\n\r\nexport function getNoteFrames(screen) {\r\n  let ret = [];\r\n\r\n  let rec = (n) => {\r\n\r\n    if (n instanceof NoteFrame) {\r\n      ret.push(n);\r\n    }\r\n\r\n    if (n.childNodes !== undefined) {\r\n      for (let node of n.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n\r\n    if (n instanceof ui_base.UIBase && n.shadow !== undefined && n.shadow.childNodes) {\r\n      for (let node of n.shadow.childNodes) {\r\n        rec(node);\r\n      }\r\n    }\r\n  }\r\n\r\n  rec(screen);\r\n  return ret;\r\n}\r\n\r\nexport let noteframes = [];\r\n\r\nexport function sendNote(screen, msg, color, timeout = 3000, showExclMark=true) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.addNote(msg, color, timeout, undefined, showExclMark);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n\r\nwindow._sendNote = sendNote;\r\n\r\nexport function error(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([1.0, 0.0, 0.0, 1.0]), timeout);\r\n}\r\n\r\nexport function warning(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.78, 0.78, 0.2, 1.0]), timeout);\r\n}\r\n\r\nexport function message(screen, msg, timeout) {\r\n  return sendNote(screen, msg, ui_base.color2css([0.2, 0.9, 0.1, 1.0]), timeout, false);\r\n}\r\n\r\n\r\nexport function progbarNote(screen, msg, percent, color, timeout) {\r\n  noteframes = getNoteFrames(screen);\r\n\r\n  for (let frame of noteframes) {\r\n    try {\r\n      frame.progbarNote(msg, percent, color, timeout);\r\n    } catch (error) {\r\n      print_stack(error);\r\n      console.log(error.stack, error.message);\r\n      console.log(\"bad notification frame\");\r\n    }\r\n  }\r\n}\r\n", "import * as ui_base from '../core/ui_base.js'\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\nlet UIBase = ui_base.UIBase, Icons = ui_base.Icons;\r\nimport {TextBoxBase} from './ui_textbox.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport class RichEditor extends TextBoxBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._internalDisabled = false;\r\n    this._value = \"\";\r\n\r\n    this.textOnlyMode = false;\r\n\r\n    this.styletag = document.createElement(\"style\");\r\n    this.styletag.textContent = `\r\n      div.rich-text-editor-x {\r\n        width        :   100%;\r\n        height       :   100%;\r\n        min-height   :   150px;\r\n        overflow     :   scroll;\r\n        padding      :   5px;\r\n        white-space  :   pre-wrap;\r\n      }\r\n      \r\n      rich-text-editor-x {\r\n        display        : flex;\r\n        flex-direction : column;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(this.styletag);\r\n\r\n    let controls = this.controls = UIBase.createElement(\"rowframe-x\");\r\n\r\n\r\n    let makeicon = (icon, description, cb) => {\r\n      icon = controls.iconbutton(icon, description, cb);\r\n      icon.iconsheet = 1; //use second smallest icon size\r\n      icon.overrideDefault(\"padding\", 3);\r\n\r\n      return icon;\r\n    };\r\n\r\n    makeicon(Icons.BOLD, \"Bold\", () => {\r\n      document.execCommand(\"bold\");\r\n    });\r\n    makeicon(Icons.ITALIC, \"Italic\", () => {\r\n      document.execCommand(\"italic\");\r\n    });\r\n    makeicon(Icons.UNDERLINE, \"Underline\", () => {\r\n      document.execCommand(\"underline\");\r\n    });\r\n    makeicon(Icons.STRIKETHRU, \"Strikethrough\", () => {\r\n      document.execCommand(\"strikeThrough\");\r\n    });\r\n\r\n    controls.background = this.getDefault(\"background-color\");\r\n\r\n    this.shadow.appendChild(controls);\r\n\r\n    this.textarea = document.createElement(\"div\");\r\n    this.textarea.contentEditable = true;\r\n    this.textarea.setAttribute(\"class\", \"rich-text-editor-x\");\r\n\r\n    this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    this.textarea.setAttribute(\"white-space\", \"pre-wrap\");\r\n\r\n    this.textarea.addEventListener(\"keydown\", (e) => {\r\n      if (e.keyCode === keymap[\"S\"] && e.shiftKey && (e.ctrlKey || e.commandKey)) {\r\n        this.toggleStrikeThru();\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n\r\n    this.textarea.addEventListener(\"focus\", (e) => {\r\n      this._focus = 1;\r\n      this.setCSS();\r\n    });\r\n    this.textarea.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.setCSS();\r\n    });\r\n\r\n    document.execCommand(\"styleWithCSS\", true);\r\n\r\n    window.ta = this;\r\n\r\n    this.textarea.addEventListener(\"selectionchange\", (e) => {\r\n      console.log(\"sel1\");\r\n    });\r\n\r\n    document.addEventListener(\"selectionchange\", (e, b) => {\r\n      console.log(\"sel2\", document.getSelection().startNode, b);\r\n    });\r\n\r\n    this.textarea.addEventListener(\"input\", (e) => {\r\n      if (this.internalDisabled) {\r\n        return;\r\n      }\r\n\r\n      console.log(\"text input\", e);\r\n\r\n      let text;\r\n\r\n      if (this.textOnlyMode) {\r\n        text = this.textarea.innerText;\r\n      } else {\r\n        text = this.textarea.innerHTML;\r\n      }\r\n\r\n      if (this.textOnlyMode && text === this._value) {\r\n        //formatting changed?\r\n        console.log(\"detected formatting change\");\r\n        return;\r\n      }\r\n\r\n      //console.log(\"text changed\", ...arguments);\r\n      let sel = document.getSelection();\r\n      let range = sel.getRangeAt(0);\r\n      //console.log(range.startOffset, range.endOffset, range.startContainer);\r\n\r\n      let node = sel.anchorNode;\r\n      let off = sel.anchorOffset;\r\n\r\n      this._value = text;\r\n\r\n      //sel.collapse(node, off);\r\n\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this._value);\r\n      }\r\n      if (this.oninput) {\r\n        this.oninput(this._value);\r\n      }\r\n\r\n      this.dispatchEvent(new InputEvent(this));\r\n      this.dispatchEvent(new CustomEvent('change'));\r\n    });\r\n\r\n    this.shadow.appendChild(this.textarea);\r\n  }\r\n\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n  */\r\n  formatStart() {\r\n  }\r\n\r\n  /**\r\n  * Only available in textOnlyMode.  Formats html-formated line.\r\n   *\r\n   * @param line : line to format\r\n   * @parem text : whole text\r\n  * */\r\n  formatLine(line, text) {\r\n    return line;\r\n  }\r\n\r\n  toggleStrikeThru() {\r\n    console.log(\"strike thru!\");\r\n    document.execCommand(\"strikeThrough\");\r\n  }\r\n  /**\r\n   * Only available in textOnlyMode.  Called when starting text formatting\r\n   */\r\n  formatEnd() {\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    window.rc = this;\r\n\r\n    document.execCommand(\"defaultParagraphSeparator\", false, \"div\");\r\n\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get internalDisabled() {\r\n    return this._internalDisabled;\r\n  }\r\n\r\n  set internalDisabled(val) {\r\n    let changed = !!this._internalDisabled !== !!val;\r\n\r\n    if (changed || 1) {\r\n      this._internalDisabled = !!val;\r\n      super.internalDisabled = val;\r\n\r\n      this.textarea.internalDisabled = val;\r\n      this.textarea.contentEditable = !val;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    if (this.textOnlyMode) {\r\n      let val2 = \"\";\r\n      for (let l of val.split(\"\\n\")) {\r\n        val2 += l + \"<br>\";\r\n      }\r\n      val = val2;\r\n    }\r\n\r\n    this.textarea.innerHTML = val;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.controls.background = this.getDefault(\"background-color\");\r\n\r\n    if (this._focus) {\r\n      this.textarea.style[\"border\"] = `2px dashed ${this.getDefault('focus-border-color')}`;\r\n    } else {\r\n      this.textarea.style[\"border\"] = \"none\";\r\n    }\r\n\r\n    if (this.style[\"font\"]) {\r\n      this.textarea.style[\"font\"] = this.style[\"font\"];\r\n    } else {\r\n      this.textarea.style[\"font\"] = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (this.style[\"color\"]) {\r\n      this.textarea.style[\"color\"] = this.style[\"color\"];\r\n    }  else {\r\n      this.textarea.style[\"color\"] = this.getDefault(\"DefaultText\").color;\r\n    }\r\n\r\n\r\n    if (this.disabled) {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"DisabledBG\");\r\n    } else {\r\n      this.textarea.style[\"background-color\"] = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this._value) {\r\n      console.log(\"text change\");\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"rich-text-editor-x\",\r\n    style   : \"richtext\",\r\n    modalKeyEvents : true\r\n  }}\r\n}\r\nUIBase.internalRegister(RichEditor);\r\n\r\nexport class RichViewer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.contents = document.createElement(\"div\");\r\n    this.contents.style[\"padding\"] = \"10px\";\r\n    this.contents.style[\"margin\"] = \"10px\";\r\n    this.contents.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.shadow.appendChild(this.contents);\r\n    this._value = \"\";\r\n  }\r\n\r\n  hideScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"hidden\"\r\n  }\r\n\r\n  showScrollBars() {\r\n    this.contents.style[\"overflow\"] = \"scroll\"\r\n  }\r\n\r\n  //transforms text into final html form\r\n  //note that client code is allowed to override this directly\r\n  textTransform(text) {\r\n    return text;\r\n  }\r\n  set value(val) {\r\n    this._value = val;\r\n\r\n    this.contents.innerHTML = this.textTransform(val);\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if (prop === undefined) {\r\n      console.warn(\"invalid datapath \" + path);\r\n\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n    let value = this.getPathValue(this.ctx, path);\r\n\r\n    if (value !== this.value) {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"html-viewer-x\",\r\n    style   : \"html_viewer\"\r\n  }}\r\n}\r\nUIBase.internalRegister(RichViewer);\r\n", "\"use strict\";\r\nimport './ui_richedit.js';\r\n\r\nimport * as util from '../util/util.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport {Vector2, Vector3, Vector4, Quat, Matrix4} from '../path-controller/util/vectormath.js';\r\nimport {RowFrame, ColumnFrame} from \"../core/ui.js\";\r\nimport {isNumber, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport './ui_widgets.js';\r\n\r\nlet keymap = events.keymap;\r\n\r\nimport {EnumProperty, PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {UIBase, PackFlags, IconSheets, parsepx} from '../core/ui_base.js';\r\n\r\nimport * as units from '../core/units.js';\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\nimport {Button} from \"./ui_button.js\";\r\n\r\nexport class VectorPopupButton extends Button {\r\n  constructor() {\r\n    super();\r\n\r\n    this.value = new Vector4();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-popup-button-x\",\r\n    style : \"vecPopupButton\"\r\n  }}\r\n\r\n  _onpress(e) {\r\n    if (e.button && e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let panel = UIBase.createElement(\"vector-panel-x\");\r\n    let screen = this.ctx.screen;\r\n\r\n    let popup = screen.popup(this, this);\r\n\r\n    popup.add(panel);\r\n    popup.button(\"ok\", () => {\r\n      popup.end();\r\n    })\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      panel.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      panel.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n\r\n    popup.flushUpdate();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let value = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!value) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    if (this.internalDisabled) {\r\n      this.internalDisabled = false;\r\n    }\r\n\r\n    if (this.value.length !== value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2();\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3();\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4();\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (this.value.vectorDistance(value) > 0.0001) {\r\n      this.value.load(value);\r\n      console.log(\"updated vector popup button value\");\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    this.updateDataPath();\r\n  }\r\n\r\n}\r\nUIBase.internalRegister(VectorPopupButton);\r\n\r\nexport class VectorPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.range = [-1e17, 1e17];\r\n\r\n    this.name = \"\";\r\n\r\n    this.axes = \"XYZW\";\r\n    this.value = new Vector3();\r\n    this.sliders = [];\r\n    this.hasUniformSlider = false;\r\n\r\n    this.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n    let makeParam = (key) => {\r\n      Object.defineProperty(this, key, {\r\n        get : function() {\r\n          return this._getNumParam(key);\r\n        },\r\n\r\n        set : function(val) {\r\n          this._setNumParam(key, val);\r\n        }\r\n      });\r\n    };\r\n\r\n    this.__range = [-1e17, 1e17];\r\n    this._range = new Array(2);\r\n\r\n    Object.defineProperty(this._range, 0, {\r\n      get : () => this.__range[0],\r\n      set : (val) => this.__range[0] = val\r\n    });\r\n    Object.defineProperty(this._range, 1, {\r\n      get : () => this.__range[1],\r\n      set : (val) => this.__range[1] = val\r\n    });\r\n\r\n    makeParam(\"isInt\");\r\n    makeParam(\"radix\");\r\n    makeParam(\"decimalPlaces\");\r\n    makeParam(\"baseUnit\");\r\n    makeParam(\"displayUnit\");\r\n    makeParam(\"step\");\r\n    makeParam(\"slideSpeed\");\r\n    makeParam(\"expRate\");\r\n    makeParam(\"stepIsRelative\");\r\n\r\n    window.vp = this;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.rebuild();\r\n    this.setCSS();\r\n\r\n    this.background = this.getDefault(\"InnerPanelBG\");\r\n  }\r\n\r\n  _getNumParam(key) {\r\n    return this[\"_\"+key];\r\n  }\r\n\r\n  _setNumParam(key, val) {\r\n    if (key === \"range\") {\r\n      this.__range[0] = val[0];\r\n      this.__range[1] = val[1];\r\n\r\n      return;\r\n    }\r\n\r\n    this[\"_\"+key] = val;\r\n\r\n    for (let slider of this.sliders) {\r\n      slider[key] = val;\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    this.clear();\r\n\r\n    if (this.name) {\r\n      this.label(this.name);\r\n    }\r\n\r\n    let frame, row;\r\n\r\n    if (this.hasUniformSlider) {\r\n      row = this.row();\r\n      frame = row.col();\r\n    } else {\r\n      frame = this;\r\n    }\r\n\r\n    this.sliders = [];\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      let slider = frame.slider(undefined, {\r\n        name       : this.axes[i],\r\n        defaultval : this.value[i],\r\n        min        : this.range[0],\r\n        max        : this.range[1],\r\n        step       : this.step || 0.001,\r\n        is_int     : this.isInt,\r\n        packflag   : this.packflag\r\n      });\r\n\r\n      slider.addLabel = false;\r\n      slider.labelOnTop = false;\r\n\r\n      //let slider = frame.slider(undefined, this.axes[i], this.value[i], this.range[0], this.range[1], 0.001, this.isInt);\r\n      slider.axis = i;\r\n      let this2 = this;\r\n\r\n      slider.baseUnit = this.baseUnit;\r\n      slider.slideSpeed = this.slideSpeed;\r\n      slider.decimalPlaces = this.decimalPlaces;\r\n      slider.displayUnit = this.displayUnit;\r\n      slider.isInt = this.isInt;\r\n      slider.range = this.__range;\r\n      slider.radix = this.radix;\r\n      slider.step = this.step;\r\n      slider.expRate = this.expRate;\r\n      slider.stepIsRelative= this.stepIsRelative;\r\n\r\n      if (this.stepIsRelative) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, this.value[i]);\r\n      }\r\n\r\n      slider.onchange = function(e) {\r\n        this2.value[this.axis] = this.value;\r\n\r\n        if (this2.hasAttribute(\"datapath\")) {\r\n          this2.setPathValue(this2.ctx, this2.getAttribute(\"datapath\"), this2.value);\r\n        }\r\n\r\n        if (this2.uslider) {\r\n          this2.uslider.setValue(this2.uniformValue, false);\r\n        }\r\n\r\n        if (this2.onchange) {\r\n          this2.onchange(this2.value);\r\n        }\r\n      }\r\n\r\n      this.sliders.push(slider);\r\n    }\r\n\r\n    if (this.hasUniformSlider) {\r\n      let uslider = this.uslider = UIBase.createElement(\"numslider-x\");\r\n      row._prepend(uslider);\r\n\r\n      uslider.range = this.range;\r\n      uslider.baseUnit = this.baseUnit;\r\n      uslider.slideSpeed = this.slideSpeed;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.displayUnit = this.displayUnit;\r\n      uslider.expRate = this.expRate;\r\n      uslider.step = this.step;\r\n      uslider.expRate = this.expRate;\r\n      uslider.isInt = this.isInt;\r\n      uslider.radix = this.radix;\r\n      uslider.decimalPlaces = this.decimalPlaces;\r\n      uslider.stepIsRelative= this.stepIsRelative;\r\n\r\n      uslider.vertical = true;\r\n      uslider.setValue(this.uniformValue, false);\r\n\r\n      this.sliders.push(uslider);\r\n\r\n      uslider.onchange = () => {\r\n        this.uniformValue = uslider.value;\r\n      }\r\n    } else {\r\n      this.uslider = undefined;\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get uniformValue() {\r\n    let sum = 0.0;\r\n\r\n    for (let i=0; i<this.value.length; i++) {\r\n      sum += isNaN(this.value[i]) ? 0.0 : this.value[i];\r\n    }\r\n\r\n    return sum / this.value.length;\r\n  }\r\n\r\n  set uniformValue(val) {\r\n    let old = this.uniformValue;\r\n    let doupdate = false;\r\n\r\n    if (old === 0.0 || val === 0.0) {\r\n      doupdate = this.value.dot(this.value) !== 0.0\r\n\r\n      this.value.zero();\r\n    } else {\r\n      let ratio = val / old;\r\n      for (let i = 0; i < this.value.length; i++) {\r\n        this.value[i] *= ratio;\r\n      }\r\n\r\n      doupdate = true;\r\n    }\r\n\r\n    if (doupdate) {\r\n      if (this.hasAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.value);\r\n      }\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.value);\r\n      }\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(this.value[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n\r\n      if (this.uslider) {\r\n        this.uslider.setValue(val, false);\r\n        this.uslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  setValue(value) {\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    if (value.length !== this.value.length) {\r\n      switch (value.length) {\r\n        case 2:\r\n          this.value = new Vector2(value);\r\n          break;\r\n        case 3:\r\n          this.value = new Vector3(value);\r\n          break;\r\n        case 4:\r\n          this.value = new Vector4(value);\r\n          break;\r\n        default:\r\n          throw new Error(\"invalid vector size \" + value.length);\r\n      }\r\n\r\n      this.rebuild();\r\n    } else {\r\n      this.value.load(value);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n    if (val === undefined) {\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n\r\n    let meta = this.getPathMeta(this.ctx, path);\r\n    let name = meta.uiname !== undefined ? meta.uiname : meta.name;\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    }\r\n\r\n    if (name && name !== this.name) {\r\n      this.name = name;\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    let loadNumParam = (k, do_rebuild=false) => {\r\n      if (meta && meta[k] !== undefined && this[k] === undefined) {\r\n        this[k] = meta[k];\r\n\r\n        if (this[k] !== meta[k] && do_rebuild) {\r\n          this.doOnce(this.rebuild);\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"baseUnit\");\r\n    loadNumParam(\"slideSpeed\");\r\n    loadNumParam(\"displayUnit\");\r\n    loadNumParam(\"decimalPlaces\");\r\n    loadNumParam(\"isInt\");\r\n    loadNumParam(\"radix\");\r\n    loadNumParam(\"step\");\r\n    loadNumParam(\"expRate\");\r\n    loadNumParam(\"stepIsRelative\");\r\n\r\n    if (meta && meta.hasUniformSlider !== undefined && meta.hasUniformSlider !== this.hasUniformSlider) {\r\n      this.hasUniformSlider = meta.hasUniformSlider;\r\n      this.doOnce(this.rebuild);\r\n    }\r\n\r\n    if (meta && meta.range) {\r\n      let update = this.range[0] !== meta.range[0];\r\n      update= update || this.range[1] !== meta.range[1];\r\n\r\n      this.range[0] = meta.range[0];\r\n      this.range[1] = meta.range[1];\r\n\r\n      if (update) {\r\n        this.doOnce(this.rebuild);\r\n      }\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    let length = val.length;\r\n\r\n    if (meta && (meta.flag & PropFlags.USE_CUSTOM_GETSET)) {\r\n      let rdef = this.ctx.api.resolvePath(this.ctx, path);\r\n\r\n      meta.ctx = this.ctx;\r\n      meta.dataref = rdef.obj;\r\n      meta.datapath = path;\r\n\r\n      length = meta.getValue().length;\r\n\r\n      meta.dataref = undefined;\r\n    }\r\n\r\n    if (this.value.length !== length) {\r\n      switch (length) {\r\n        case 2:\r\n          val = new Vector2(val);\r\n          break;\r\n        case 3:\r\n          val = new Vector3(val);\r\n          break;\r\n        case 4:\r\n          val = new Vector4(val);\r\n          break;\r\n        default:\r\n          val = meta.getValue().copy().load(val);\r\n          break;\r\n      }\r\n\r\n      this.value = val;\r\n      this.rebuild();\r\n\r\n      for (let i=0; i<this.value.length; i++) {\r\n        this.sliders[i].setValue(val[i], false);\r\n        this.sliders[i]._redraw();\r\n      }\r\n    } else {\r\n      if (this.value.vectorDistance(val) > 0) {\r\n        this.value.load(val);\r\n\r\n        if (this.uslider) {\r\n          this.uslider.setValue(this.uniformValue, false);\r\n        }\r\n\r\n        for (let i=0; i<this.value.length; i++) {\r\n          this.sliders[i].setValue(val[i], false);\r\n          this.sliders[i]._redraw();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n\r\n    if (this.stepIsRelative) {\r\n      for (let slider of this.sliders) {\r\n        slider.step = ToolProperty.calcRelativeStep(this.step, slider.value);\r\n      }\r\n    }\r\n\r\n    if (this.uslider) {\r\n      this.uslider.step = this.step;\r\n      if (this.stepIsRelative) {\r\n        this.uslider.step = ToolProperty.calcRelativeStep(this.step, this.uniformValue);\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"vector-panel-x\"\r\n  }}\r\n}\r\nUIBase.internalRegister(VectorPanel);\r\n\r\n\r\nexport class ToolTip extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n    this.div = document.createElement(\"div\");\r\n\r\n    this.shadow.appendChild(this.div);\r\n    this._start_time = undefined;\r\n    this.timeout = undefined;\r\n  }\r\n\r\n  static show(message, screen, x, y) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n\r\n    ret._start_time = util.time_ms();\r\n    ret.timeout = ret.getDefault(\"timeout\");\r\n\r\n    ret.text = message;\r\n    let size = ret._estimateSize();\r\n\r\n    let pad = 5;\r\n    size = [size[0] + pad, size[1] + pad];\r\n\r\n    console.log(size);\r\n    x = Math.min(Math.max(x, 0), screen.size[0] - size[0]);\r\n    y = Math.min(Math.max(y, 0), screen.size[1] - size[1]);\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    x += 10/dpi;\r\n    y += 15/dpi;\r\n\r\n    ret._popup = screen.popup(ret, x, y);\r\n    ret._popup.background = \"rgba(0,0,0,0)\";\r\n    ret._popup.style[\"border\"] = \"none\";\r\n    ret.div.style[\"padding\"] = \"15px\";\r\n\r\n    ret._popup.add(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  end() {\r\n    this._popup.end();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.setCSS();\r\n  }\r\n\r\n  set text(val) {\r\n    this.div.innerHTML = val.replace(/[\\n]/g, \"<br>\\n\");\r\n  }\r\n\r\n  get text() {\r\n    return this.div.innerHTML;\r\n  }\r\n\r\n  _estimateSize() {\r\n    let text = this.div.textContent;\r\n    let block = ui_base.measureTextBlock(this, text, undefined, undefined, undefined, this.getDefault(\"ToolTipText\"));\r\n\r\n    return [block.width+50, block.height+30];\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (util.time_ms() - this._start_time > this.timeout) {\r\n      this.end();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let bcolor = this.getDefault(\"border-color\");\r\n\r\n    this.background = color;\r\n\r\n    let radius = this.getDefault(\"border-radius\", undefined, 5);\r\n    let bstyle = this.getDefault(\"border-style\", undefined, \"solid\");\r\n    let bwidth = this.getDefault(\"border-width\", undefined, 1);\r\n    let padding = this.getDefault(\"padding\", undefined, 15);\r\n\r\n    this.noMarginsOrPadding();\r\n\r\n    this.div.style[\"padding\"] = padding + \"px\";\r\n\r\n    this.div.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this.div.style[\"border\"] = `${bwidth}px ${bstyle} ${bcolor}`;\r\n    this.div.style[\"border-radius\"] = radius + \"px\";\r\n    this.style[\"border-radius\"] = radius + \"px\";\r\n\r\n    let font = this.getDefault(\"ToolTipText\");\r\n    this.div.style[\"color\"] = font.color;\r\n    this.div.style[\"font\"] = font.genCSS();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tool-tip-x\",\r\n    style   : \"tooltip\"\r\n  }}\r\n};\r\nUIBase.internalRegister(ToolTip);\r\n\r\nwindow._ToolTip = ToolTip;\r\n", "\"use strict\";\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolTip} from \"../widgets/ui_widgets2.js\";\r\n\r\n/*\r\nwhy am I using a toolstack here at all?  time to remove!\r\n*/\r\n\r\nlet toolstack_getter = function () {\r\n  throw new Error(\"must pass a toolstack getter to registerToolStackGetter\")\r\n}\r\n\r\nexport function registerToolStackGetter(func) {\r\n  toolstack_getter = func;\r\n}\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    Vector3   = vectormath.Vector3,\r\n    UndoFlags = simple_toolsys.UndoFlags,\r\n    ToolFlags = simple_toolsys.ToolFlags;\r\n\r\nimport {pushModalLight, popModalLight, keymap, pushPointerModal} from \"../util/simple_events.js\";\r\n\r\n//import {keymap} from './events';\r\n\r\nexport class ToolBase extends simple_toolsys.ToolOp {\r\n  constructor(screen) {\r\n    super();\r\n    this.screen = screen;\r\n    //super();\r\n\r\n    this._finished = false;\r\n  }\r\n\r\n  start(elem, pointerId) {\r\n    //toolstack_getter().execTool(this);\r\n    this.modalStart(undefined, elem, pointerId);\r\n  }\r\n\r\n  cancel() {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    this._finished = true;\r\n    this.popModal(this.screen);\r\n  }\r\n\r\n  popModal() {\r\n    this.overdraw.end();\r\n    popModalLight(this.modaldata);\r\n    this.modaldata = undefined;\r\n  }\r\n\r\n  modalStart(ctx, elem, pointerId) {\r\n    this.ctx = ctx;\r\n\r\n    if (this.modaldata !== undefined) {\r\n      console.log(\"Error, modaldata was not undefined\");\r\n      popModalLight(this.modaldata);\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    let handlers = {};\r\n    let keys = Object.getOwnPropertyNames(this);\r\n    for (let k in this.__proto__) {\r\n      keys.push(k);\r\n    }\r\n    for (let k of Object.getOwnPropertyNames(this.__proto__)) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k in this) {\r\n      keys.push(k);\r\n    }\r\n\r\n    for (let k of keys) {\r\n      if (k.startsWith(\"on\")) {\r\n        handlers[k] = this[k].bind(this);\r\n      }\r\n    }\r\n\r\n    //window.setTimeout(() => {\r\n    if (pointerId !== undefined) {\r\n      handlers.on_pointerdown = handlers.on_pointerdown ?? handlers.on_mousedown;\r\n      handlers.on_pointermove = handlers.on_pointermove ?? handlers.on_mousemove;\r\n      handlers.on_pointerup = handlers.on_pointerup ?? handlers.on_mouseup;\r\n      handlers.on_pointercancel = handlers.on_pointercancel ?? handlers.on_pointerup ?? handlers.on_mouseup;\r\n\r\n      this.modaldata = pushPointerModal(handlers, elem, pointerId);\r\n    } else {\r\n      this.modaldata = pushModalLight(handlers);\r\n    }\r\n    //console.log(\"HANDLERS\", this.modaldata.handlers);\r\n\r\n    //}, 100);\r\n\r\n    //window.addEventListener(\"touchmove\", (e) => {\r\n    //  console.log(\"touchmove\");\r\n    //}, {passive : false});\r\n  }\r\n\r\n  on_pointermove(e) {\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class AreaResizeTool extends ToolBase {\r\n  constructor(screen, border, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.start_mpos = new Vector2(mpos);\r\n\r\n    this.sarea = border.sareas[0];\r\n    if (!this.sarea || border.dead) {\r\n      console.log(border.dead, border);\r\n      throw new Error(\"border corruption\");\r\n    }\r\n\r\n    this.screen = screen;\r\n\r\n    this.side = this.sarea._side(border);\r\n  }\r\n\r\n  get border() {\r\n    return this.sarea._borders[this.side];\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Resize Area\",\r\n      toolpath   : \"screen.area.resize\",\r\n      icon       : ui_base.Icons.RESIZE,\r\n      description: \"change size of area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  getBorders() {\r\n    let horiz = this.border.horiz;\r\n\r\n    let ret = [];\r\n    let visit = new Set();\r\n\r\n    let rec = (v) => {\r\n      if (visit.has(v._id)) {\r\n        return;\r\n      }\r\n\r\n      visit.add(v._id);\r\n\r\n      for (let border of v.borders) {\r\n        if (border.horiz == horiz && !visit.has(border._id)) {\r\n          visit.add(border._id);\r\n          ret.push(border);\r\n\r\n          rec(border.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(this.border.v1);\r\n    rec(this.border.v2);\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.snapScreenVerts();\r\n    this.screen.regenBorders();\r\n    this.screen.snapScreenVerts();\r\n    this.screen.loadFromVerts();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    mpos.sub(this.start_mpos);\r\n\r\n    let axis = this.border.horiz ? 1 : 0;\r\n\r\n    //console.log(this.border.horiz);\r\n\r\n    this.overdraw.clear();\r\n\r\n    let visit = new Set();\r\n    let borders = this.getBorders();\r\n\r\n    let color = cconst.DEBUG.screenborders ? \"rgba(1.0, 0.5, 0.0, 0.1)\" : \"rgba(1.0, 0.5, 0.0, 1.0)\";\r\n\r\n    let bad = false;\r\n\r\n    for (let border of borders) {\r\n      bad = bad || !this.screen.isBorderMovable(border);\r\n\r\n      border.oldv1 = new Vector2(border.v1);\r\n      border.oldv2 = new Vector2(border.v2);\r\n    }\r\n\r\n    if (bad) {\r\n      console.log(\"border is not movable\");\r\n      return;\r\n    }\r\n\r\n    let check = () => {\r\n      let count = 0;\r\n\r\n      for (let sarea of this.screen.sareas) {\r\n        if (sarea.size[0] < 15 || sarea.size[1] < 15) {\r\n          count++;\r\n        }\r\n      }\r\n\r\n      return count;\r\n    };\r\n\r\n    let badcount = check();\r\n\r\n\r\n    let snapMode = true;\r\n\r\n    let df = mpos[axis];\r\n    let border = this.border;\r\n\r\n    this.screen.moveBorder(border, df, false);\r\n\r\n    for (let border of borders) {\r\n      //if false, stead of forcing areas to fit within screen bounds\r\n      //in snapScreenVerts the screen bounds will be modified instead.\r\n\r\n      if (border.outer) {\r\n        snapMode = false;\r\n      }\r\n\r\n      this.overdraw.line(border.v1, border.v2, color);\r\n    }\r\n\r\n    this.start_mpos[0] = e.x;\r\n    this.start_mpos[1] = e.y;\r\n    this.screen.loadFromVerts();\r\n    this.screen.setCSS();\r\n\r\n    if (check() != badcount) {\r\n      console.log(\"bad\");\r\n\r\n      for (let border of borders) {\r\n        border.v1.load(border.oldv1);\r\n        border.v2.load(border.oldv2);\r\n      }\r\n    }\r\n\r\n\r\n    this.screen.snapScreenVerts(snapMode);\r\n    this.screen.loadFromVerts();\r\n    this.screen.solveAreaConstraints(snapMode);\r\n    this.screen.setCSS();\r\n    this.screen.updateDebugBoxes();\r\n    this.screen._fireResizeCB();\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaResizeTool);\r\n\r\nexport class SplitTool extends ToolBase {\r\n  constructor(screen) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Split Area\",\r\n      toolpath   : \"screen.area.split\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"split an area in two\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    screen.splitArea(sarea, t, this.horiz);\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      //x -= sarea.pos[0];\r\n      //y -= sarea.pos[1];\r\n      x = (x - sarea.pos[0])/(sarea.size[0]);\r\n      y = (y - sarea.pos[1])/(sarea.size[1]);\r\n\r\n      let dx = 1.0 - Math.abs(x - 0.5);\r\n      let dy = 1.0 - Math.abs(y - 0.5);\r\n\r\n      this.sarea = sarea;\r\n      let horiz = this.horiz = dx < dy;\r\n\r\n      if (horiz) {\r\n        this.t = y;\r\n        this.overdraw.line([sarea.pos[0], e.y], [sarea.pos[0] + sarea.size[0], e.y]);\r\n      } else {\r\n        this.t = x;\r\n        this.overdraw.line([e.x, sarea.pos[1]], [e.x, sarea.pos[1] + sarea.size[1]]);\r\n      }\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class RemoveAreaTool extends ToolBase {\r\n  constructor(screen, border) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.border = border;\r\n\r\n    this.done = false;\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n    this.sarea = undefined;\r\n    this.t = undefined;\r\n\r\n    this.started = false;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Remove Area\",\r\n      toolpath   : \"screen.area.pick_remove\",\r\n      icon       : ui_base.Icons.SMALL_PLUS,\r\n      description: \"Collapse a window\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    if (this.started) {\r\n      console.trace(\"double call to modalStart()\");\r\n      return;\r\n    }\r\n\r\n    this.overdraw = ui_base.UIBase.createElement(\"overdraw-x\");\r\n    this.overdraw.start(this.screen);\r\n\r\n    super.modalStart(ctx);\r\n  }\r\n\r\n  cancel() {\r\n    return this.finish(true);\r\n  }\r\n\r\n  finish(canceled = false) {\r\n    if (this.done) {\r\n      return;\r\n    }\r\n\r\n    this.done = true;\r\n    this.overdraw.end();\r\n\r\n    this.popModal(this.screen);\r\n\r\n    if (canceled || !this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.sarea, screen = this.screen;\r\n    let t = this.t;\r\n\r\n    if (sarea) {\r\n      screen.collapseArea(sarea, this.border);\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let screen = this.screen;\r\n\r\n    let sarea = screen.findScreenArea(x, y);\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (sarea !== undefined) {\r\n      this.sarea = sarea;\r\n      this.overdraw.rect(sarea.pos, sarea.size, \"rgba(0,0,0,0.1)\");\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n\r\n    if (e.button) {\r\n      this.stopPropagation();\r\n      this.preventDefault();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    console.log(\"s\", e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //esc\r\n        this.cancel();\r\n        break;\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //return\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n//controller.registerTool(SplitTool);\r\n\r\n\r\nexport class AreaDragTool extends ToolBase {\r\n  constructor(screen, sarea, mpos) {\r\n    if (screen === undefined) screen = _appstate.screen; //XXX hackish!\r\n\r\n    super(screen);\r\n\r\n    this.dropArea = false;\r\n    this.excludeAreas = new Set();\r\n    this.cursorbox = undefined;\r\n    this.boxes = [];\r\n    this.boxes.active = undefined;\r\n\r\n    this.sarea = sarea;\r\n    this.start_mpos = new Vector2(mpos);\r\n    this.screen = screen;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Drag Area\",\r\n      toolpath   : \"screen.area.drag\",\r\n      icon       : ui_base.Icons.TRANSLATE,\r\n      description: \"move or duplicate area\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n\r\n    this.screen.regenBorders();\r\n    this.screen.solveAreaConstraints();\r\n    this.screen.snapScreenVerts();\r\n    this.screen._recalcAABB();\r\n  }\r\n\r\n  getBoxRect(b) {\r\n    let sa = b.sarea;\r\n    let pos, size;\r\n\r\n    if (b.horiz == -1) {\r\n      //replacement mode\r\n      pos = sa.pos;\r\n      size = sa.size;\r\n    } else if (b.horiz) {\r\n      if (b.side == 'b') {\r\n        pos = [sa.pos[0], sa.pos[1] + sa.size[1]*b.t]\r\n        size = [sa.size[0], sa.size[1]*(1.0 - b.t)]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0], sa.size[1]*b.t]\r\n      }\r\n    } else {\r\n      if (b.side == 'r') {\r\n        pos = [sa.pos[0] + sa.size[0]*b.t, sa.pos[1]]\r\n        size = [sa.size[0]*(1.0 - b.t), sa.size[1]]\r\n      } else {\r\n        pos = [sa.pos[0], sa.pos[1]];\r\n        size = [sa.size[0]*b.t, sa.size[1]]\r\n      }\r\n    }\r\n\r\n    let color = \"rgba(100, 100, 100, 0.2)\";\r\n\r\n    let ret = this.overdraw.rect(pos, size, color);\r\n    ret.style[\"pointer-events\"] = \"none\";\r\n\r\n    return ret;\r\n  }\r\n\r\n  doSplit(b) {\r\n    if (this.sarea) {\r\n      return this.doSplitDrop(b);\r\n    }\r\n\r\n    let src = this.sarea, dst = b.sarea;\r\n    let screen = this.screen;\r\n\r\n    let t = b.t;\r\n\r\n    screen.splitArea(dst, t, b.horiz);\r\n\r\n    screen._internalRegenAll();\r\n  }\r\n\r\n  doSplitDrop(b) {\r\n    //first check if there was no change\r\n    if (b.horiz === -1 && b.sarea === this.sarea) {\r\n      return;\r\n    }\r\n\r\n    let can_rip = false;\r\n    let sa = this.sarea;\r\n    let screen = this.screen;\r\n\r\n    //rip conditions\r\n    can_rip = sa.size[0] === screen.size[0] || sa.size[1] === screen.size[1];\r\n    can_rip = can_rip || this.sarea.floating;\r\n    can_rip = can_rip && b.sarea !== sa;\r\n    can_rip = can_rip && (b.horiz === -1 || !screen.areasBorder(sa, b.sarea));\r\n\r\n    let expand = b.horiz === -1 && b.sarea !== sa && screen.areasBorder(b.sarea, sa);\r\n\r\n    can_rip = can_rip || expand;\r\n\r\n    console.log(\"can_rip:\", can_rip, expand);\r\n\r\n    if (can_rip) {\r\n      screen.removeArea(sa);\r\n      screen.snapScreenVerts();\r\n    }\r\n\r\n    if (b.horiz === -1) {\r\n      //replacement\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      if (can_rip && src !== dst) {\r\n        let mm;\r\n\r\n        //handle case of one area \"consuming\" another\r\n        if (expand) {\r\n          mm = screen.minmaxArea(src);\r\n          screen.minmaxArea(dst, mm);\r\n        }\r\n\r\n        console.log(\"replacing. . .\", expand);\r\n\r\n        if (src.floating) {\r\n          let old = dst.editors;\r\n\r\n          dst.editors = [];\r\n          dst.editormap = {};\r\n\r\n          if (dst.area && !(dst.area.constructor.define().areaname in src.editormap)) {\r\n            dst.area.push_ctx_active();\r\n            dst.area.on_area_inactive();\r\n            dst.area.remove();\r\n            dst.area.pop_ctx_active();\r\n          }\r\n\r\n          for (let editor of old) {\r\n            let def = editor.constructor.define();\r\n\r\n            let bad = false;\r\n            //bad = !(def.areaname in src.editormap);\r\n\r\n            for (let editor2 of src.editors) {\r\n              if (editor.constructor === editor2.constructor) {\r\n                bad = true;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!bad) {\r\n              dst.editors.push(editor);\r\n              dst.editormap[def.areaname] = editor;\r\n            }\r\n          }\r\n\r\n          for (let editor of src.editors) {\r\n            let def = editor.constructor.define();\r\n\r\n            dst.editormap[def.areaname] = editor;\r\n            dst.editors.push(editor);\r\n\r\n            if (editor.owning_sarea) {\r\n              editor.owning_sarea = dst;\r\n            }\r\n\r\n            if (editor.parentWidget) {\r\n              editor.parentWidget = dst;\r\n            }\r\n          }\r\n\r\n          if (cconst.useAreaTabSwitcher) {\r\n            for (let editor of dst.editors) {\r\n              if (editor.switcher) {\r\n                editor.switcher.flagUpdate();\r\n              }\r\n            }\r\n          }\r\n\r\n          dst.area = src.area;\r\n          dst.shadow.appendChild(src.area);\r\n\r\n          src.area = undefined;\r\n          src.editors = [];\r\n          src.editormap = {};\r\n\r\n          dst.on_resize(dst.size, dst.size);\r\n\r\n          dst.flushSetCSS();\r\n          dst.flushUpdate();\r\n\r\n          screen.removeArea(src);\r\n          screen.snapScreenVerts();\r\n\r\n          return;\r\n        } else {\r\n          screen.replaceArea(dst, src);\r\n        }\r\n\r\n        if (expand) {\r\n          console.log(\"\\nEXPANDING:\", src.size[0], src.size[1]);\r\n\r\n          src.pos[0] = mm.min[0];\r\n          src.pos[1] = mm.min[1];\r\n\r\n          src.size[0] = mm.max[0] - mm.min[0];\r\n          src.size[1] = mm.max[1] - mm.min[1];\r\n\r\n          src.loadFromPosSize();\r\n\r\n          screen._internalRegenAll();\r\n        }\r\n      } else {\r\n        //console.log(\"copying. . .\");\r\n        screen.replaceArea(dst, src.copy());\r\n        screen._internalRegenAll();\r\n      }\r\n    } else {\r\n      let src = this.sarea, dst = b.sarea;\r\n\r\n      let t = b.t;\r\n\r\n      let nsa = screen.splitArea(dst, t, b.horiz);\r\n\r\n      if (b.side === 'l' || b.side === 't') {\r\n        nsa = dst;\r\n      }\r\n\r\n      if (can_rip) {\r\n        //console.log(\"replacing\");\r\n        screen.replaceArea(nsa, src);\r\n      } else {\r\n        //console.log(\"copying\");\r\n        screen.replaceArea(nsa, src.copy());\r\n      }\r\n\r\n      screen._internalRegenAll();\r\n    }\r\n  }\r\n\r\n  makeBoxes(sa) {\r\n    let sz = util.isMobile() ? 100 : 40;\r\n    let cx = sa.pos[0] + sa.size[0]*0.5;\r\n    let cy = sa.pos[1] + sa.size[1]*0.5;\r\n\r\n    let color = this.color = \"rgba(200, 200, 200, 0.55)\";\r\n    let hcolor = this.hcolor = \"rgba(230, 230, 230, 0.75)\";\r\n    let idgen = 0;\r\n    let boxes = this.boxes;\r\n\r\n    let box = (x, y, sz, horiz, t, side) => {\r\n      //console.log(x, y, sz);\r\n\r\n      let b = this.overdraw.rect([x - sz[0]*0.5, y - sz[1]*0.5], sz, color);\r\n      b.style[\"border-radius\"] = \"14px\";\r\n\r\n      boxes.push(b);\r\n\r\n      b.sarea = sa;\r\n\r\n      let style = document.createElement(\"style\")\r\n      let cls = `mybox_${idgen++}`;\r\n\r\n      b.horiz = horiz;\r\n      b.t = t;\r\n      b.side = side;\r\n      b.setAttribute(\"class\", cls);\r\n      b.setAttribute(\"is_box\", true);\r\n\r\n      b.addEventListener(\"pointermove\", this.on_pointermove.bind(this));\r\n\r\n      let onclick = b.onclick = (e) => {\r\n        let type = e.type.toLowerCase();\r\n\r\n        if ((e.type === \"pointerdown\" || e.type === \"pointerup\") && e.button !== 0) {\r\n          return; //another handler will cancel\r\n        }\r\n\r\n        console.log(\"split click\");\r\n\r\n        if (!this._finished) {\r\n          this.finish();\r\n          this.doSplit(b);\r\n\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n      }\r\n\r\n      b.addEventListener(\"click\", onclick);\r\n      b.addEventListener(\"pointerdown\", onclick);\r\n      b.addEventListener(\"pointerup\", onclick);\r\n\r\n      b.addEventListener(\"pointerenter\", (e) => {\r\n        if (this.curbox !== undefined) {\r\n          if (this.curbox.rect) {\r\n            this.curbox.rect.remove()\r\n            this.curbox.rect = undefined;\r\n          }\r\n        }\r\n\r\n        if (b.rect !== undefined) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        b.rect = this.getBoxRect(b);\r\n        this.curbox = b;\r\n\r\n        b.setColor(hcolor);\r\n        //b.style[\"background-color\"] = hcolor;\r\n      })\r\n\r\n      b.addEventListener(\"pointerleave\", (e) => {\r\n        if (b.rect) {\r\n          b.rect.remove();\r\n          b.rect = undefined;\r\n        }\r\n\r\n        if (this.curbox === b) {\r\n          this.curbox = undefined;\r\n        }\r\n\r\n        b.setColor(color);\r\n        //b.style[\"background-color\"] = color;\r\n      })\r\n\r\n      style.textContent = `\r\n        .${cls}:hover {\r\n          background-color : orange;\r\n          fill:orange;stroke-width:2\r\n        }\r\n      `\r\n      //console.log(style.textContent);\r\n      b.appendChild(style);\r\n      b.setAttribute(\"class\", cls);\r\n\r\n      return b;\r\n    }\r\n\r\n    let pad = 5;\r\n\r\n    if (this.sarea) {\r\n      box(cx, cy, [sz, sz], -1, -1, -1);\r\n    }\r\n\r\n    box(cx - sz*0.75 - pad, cy, [sz*0.5, sz], false, 0.5, 'l');\r\n    box(cx - sz*1.2 - pad, cy, [sz*0.25, sz], false, 0.3, 'l');\r\n\r\n    box(cx + sz*0.75 + pad, cy, [sz*0.5, sz], false, 0.5, 'r');\r\n    box(cx + sz*1.2 + pad, cy, [sz*0.25, sz], false, 0.7, 'r');\r\n\r\n    box(cx, cy - sz*0.75 - pad, [sz, sz*0.5], true, 0.5, 't');\r\n    box(cx, cy - sz*1.2 - pad, [sz, sz*0.25], true, 0.3, 't');\r\n\r\n    box(cx, cy + sz*0.75 + pad, [sz, sz*0.5], true, 0.5, 'b');\r\n    box(cx, cy + sz*1.2 + pad, [sz, sz*0.25], true, 0.7, 'b');\r\n  }\r\n\r\n  getActiveBox(x, y) {\r\n    for (let n of this.boxes) {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        //console.log(rect.x, rect.y);\r\n        if (x >= rect.x && y >= rect.y && x < rect.x + rect.width && y < rect.y + rect.height) {\r\n          //console.log(\"found rect\");\r\n          return n;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  on_drag(e) {\r\n    this.on_pointermove(e);\r\n  }\r\n\r\n  on_dragend(e) {\r\n    this.on_pointerup(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let wid = 55;\r\n    let color = \"rgb(200, 200, 200, 0.7)\";\r\n\r\n    //console.trace(\"pointer move!\", e.x, e.y, this.sarea);\r\n\r\n    /*\r\n     manually feed events to boxes so as to work right\r\n     with touch events; note that pushModalLight routes\r\n     touch to pointer events (if no touch handlers are present).\r\n     */\r\n    let n = this.getActiveBox(e.x, e.y);\r\n\r\n    if (n !== undefined) {\r\n      n.setColor(this.hcolor); //\"rgba(250, 250, 250, 0.75)\");\r\n    }\r\n    //console.log(\"pointer move\", n);\r\n\r\n    if (this.boxes.active !== undefined && this.boxes.active !== n) {\r\n      this.boxes.active.setColor(this.color);\r\n      this.boxes.active.dispatchEvent(new PointerEvent(\"pointerleave\", e));\r\n    }\r\n\r\n    if (n !== undefined) {\r\n      n.dispatchEvent(new PointerEvent(\"pointerenter\", e));\r\n    }\r\n\r\n    this.boxes.active = n;\r\n    /*\r\n    let rec = (n) => {\r\n      if (n.hasAttribute && n.hasAttribute(\"is_box\")) {\r\n        let rect = n.getClientRects()[0];\r\n\r\n        console.log(rect.x, rect.y);\r\n        if (x >= rect.x && x >= rect.y && x < rect.x+rect.width && y < rect.y+rect.height) {\r\n          console.log(\"found rect\");\r\n          n.dispatchEvent(\"pointerenter\", new PointerEvent(\"pointerenter\", e));\r\n        }\r\n      }\r\n      if (n === undefined || n.childNodes === undefined) {\r\n        return;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    };\r\n\r\n    rec(this.overdraw);\r\n    //*/\r\n    if (this.sarea === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.cursorbox === undefined) {\r\n      wid = 25;\r\n      this.cursorbox = this.overdraw.rect([e.x - wid*0.5, e.y - wid*0.5], [wid, wid], color);\r\n      this.cursorbox.style[\"pointer-events\"] = \"none\";\r\n    } else {\r\n      this.cursorbox.style[\"x\"] = (e.x - wid*0.5) + \"px\";\r\n      this.cursorbox.style[\"y\"] = (e.y - wid*0.5) + \"px\";\r\n    }\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    console.log(\"e.button\", e.button, e, e.x, e.y, this.getActiveBox(e.x, e.y));\r\n\r\n    if (e.button) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    } else {\r\n      let box = this.getActiveBox(e.x, e.y);\r\n\r\n      if (box !== undefined) {\r\n        box.onclick(e);\r\n      }\r\n    }\r\n\r\n    this.finish();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(...arguments);\r\n\r\n    let screen = this.screen;\r\n\r\n    this.overdraw.clear();\r\n\r\n    if (this.sarea && !this.excludeAreas.has(this.sarea)) {\r\n      let sa = this.sarea;\r\n      let box = this.overdraw.rect(sa.pos, sa.size, \"rgba(100, 100, 100, 0.5)\");\r\n\r\n      box.style[\"pointer-events\"] = \"none\";\r\n    }\r\n\r\n    for (let sa of screen.sareas) {\r\n      if (this.excludeAreas.has(sa)) {\r\n        continue;\r\n      }\r\n\r\n      this.makeBoxes(sa);\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport class AreaMoveAttachTool extends AreaDragTool {\r\n  constructor(screen, sarea, mpos) {\r\n    super(screen, sarea, mpos);\r\n\r\n    this.excludeAreas = new Set([sarea]);\r\n\r\n    this.dropArea = true;\r\n    this.first = true;\r\n    this.sarea = sarea;\r\n    this.mpos = new Vector2(mpos);\r\n    this.start_mpos2 = new Vector2(mpos);\r\n    this.start_pos = new Vector2(sarea.pos);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let dx = e.x - this.start_mpos2[0];\r\n    let dy = e.y - this.start_mpos2[1];\r\n\r\n    let sarea = this.sarea;\r\n\r\n    if (this.first) {\r\n      this.start_mpos2 = new Vector2([e.x, e.y]);\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n\r\n    sarea.pos[0] = this.start_pos[0] + dx;\r\n    sarea.pos[1] = this.start_pos[1] + dy;\r\n\r\n    sarea.loadFromPosSize();\r\n\r\n    this.mpos.loadXY(e.x, e.y);\r\n    super.on_pointermove(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    super.on_pointerup(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    super.on_pointerdown(e);\r\n  }\r\n\r\n  on_keydown(e) {\r\n    super.on_keydown(e);\r\n  }\r\n}\r\n\r\n//controller.registerTool(AreaDragTool);\r\n\r\nexport class ToolTipViewer extends ToolBase {\r\n  constructor(screen) {\r\n    super(screen);\r\n\r\n    this.tooltip = undefined;\r\n    this.element = undefined;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname     : \"Help Tool\",\r\n      toolpath   : \"screen.help_picker\",\r\n      icon       : ui_base.Icons.HELP,\r\n      description: \"view tooltips\",\r\n      is_modal   : true,\r\n      undoflag   : UndoFlags.NO_UNDO,\r\n      flag       : 0,\r\n      inputs     : {}, //tool properties\r\n      outputs    : {}  //tool properties\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.pick(e);\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  finish() {\r\n    super.finish();\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap.Escape:\r\n      case keymap.Enter:\r\n      case Keymap.Space:\r\n        if (this.tooltip) {\r\n          this.tooltip.end();\r\n        }\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n\r\n  pick(e) {\r\n    let x = e.x, y = e.y;\r\n\r\n    let ele = this.screen.pickElement(x, y);\r\n    console.log(ele ? ele.tagName : ele);\r\n\r\n    if (ele !== undefined && ele !== this.element && ele.title) {\r\n      if (this.tooltip) {\r\n        this.tooltip.end();\r\n      }\r\n\r\n      this.element = ele;\r\n      let tip = ele.title;\r\n\r\n      this.tooltip = ToolTip.show(tip, this.screen, x, y);\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n}\r\n\r\n", "import nstructjs from '../path-controller/util/struct.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as FrameManager_ops from \"./FrameManager_ops.js\";\r\nimport cconst from \"../config/const.js\";\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {createMenu, Menu} from '../widgets/ui_menu.js';\r\nimport {popModalLight, pushModalLight} from '../path-controller/util/simple_events.js';\r\n\r\nexport const AreaFlags = {\r\n  HIDDEN                : 1,\r\n  FLOATING              : 2,\r\n  INDEPENDENT           : 4, //area is indpendent of the screen mesh\r\n  NO_SWITCHER           : 8,\r\n  NO_HEADER_CONTEXT_MENU: 16,\r\n  NO_COLLAPSE           : 32,\r\n};\r\n\r\nexport let SnapLimit = 1;\r\n\r\nexport const BORDER_ZINDEX_BASE = 25\r\n\r\nexport function snap(c, snap_limit = SnapLimit) {\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.floor(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.floor(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport function snapi(c, snap_limit = SnapLimit) {\r\n  //return snap(c, snap_limit);\r\n\r\n  if (Array.isArray(c)) {\r\n    for (let i = 0; i < c.length; i++) {\r\n      c[i] = Math.ceil(c[i]/snap_limit)*snap_limit;\r\n    }\r\n  } else {\r\n    c = Math.ceil(c/snap_limit)*snap_limit;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport class ScreenVert extends Vector2 {\r\n  constructor(pos, id, added_id) {\r\n    super(pos);\r\n\r\n    this.added_id = added_id;\r\n    this.sareas = [];\r\n    this.borders = [];\r\n\r\n    this._id = id;\r\n  }\r\n\r\n  static hash(pos, added_id, limit) {\r\n    let x = snap(pos[0], limit);\r\n    let y = snap(pos[1], limit);\r\n\r\n    return \"\" + x + \":\" + y + \": + added_id\";\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenVert.hash(this, this.added_id);\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n}\r\n\r\nScreenVert.STRUCT = `\r\npathux.ScreenVert {\r\n  0 : float;\r\n  1 : float;\r\n}\r\n`;\r\nnstructjs.register(ScreenVert);\r\n\r\nexport class ScreenHalfEdge {\r\n  constructor(border, sarea) {\r\n    this.sarea = sarea;\r\n    this.border = border;\r\n    this.side = sarea._side(border);\r\n  }\r\n\r\n  get v1() {\r\n    return this.border.v1;\r\n  }\r\n\r\n  get v2() {\r\n    return this.border.v2;\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this.sarea._id + \":\" + this.border._id;\r\n  }\r\n\r\n}\r\n\r\nexport class ScreenBorder extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.v1 = undefined;\r\n    this.v2 = undefined;\r\n    this._id = undefined;\r\n\r\n    this._hash = undefined;\r\n\r\n    this.outer = undefined;\r\n\r\n    this.halfedges = []; //all bordering borders, including ones with nonshared verts\r\n    this.sareas = [];\r\n\r\n    this._innerstyle = document.createElement(\"style\");\r\n    this._style = undefined;\r\n\r\n    this.shadow.appendChild(this._innerstyle);\r\n\r\n    this.inner = document.createElement(\"div\");\r\n    //this.inner.innerText = \"sdfsdfsdf\";\r\n    this.shadow.appendChild(this.inner);\r\n\r\n    let call_menu = ScreenBorder.bindBorderMenu(this);\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      let ok = this.movable;\r\n\r\n      if (e.button === 2) {\r\n        call_menu(e);\r\n        return;\r\n      }\r\n\r\n      if (!ok) {\r\n        console.log(\"border is not movable\");\r\n        return;\r\n      }\r\n\r\n      let tool = new FrameManager_ops.AreaResizeTool(this.screen, this, [e.x, e.y]);\r\n\r\n      tool.start();\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {capture: true});\r\n  }\r\n\r\n  static bindBorderMenu(elem, usePickElement = false) {\r\n    let on_dblclick = (e) => {\r\n      if (usePickElement && elem.pickElement(e.x, e.y) !== elem) {\r\n        return;\r\n      }\r\n\r\n      let menu = [\r\n        [\"Split Area\", () => {\r\n          elem.ctx.screen.splitTool();\r\n        }],\r\n        Menu.SEP,\r\n        [\"Collapse Area\", () => {\r\n          console.log(\"Collapse Area!\");\r\n          elem.ctx.screen.removeAreaTool(elem instanceof ScreenBorder ? elem : undefined);\r\n        }],\r\n      ];\r\n\r\n      menu = createMenu(elem.ctx, \"\", menu);\r\n      //if (e.button === 2) {\r\n      menu.ignoreFirstClick = 2;\r\n      //}\r\n\r\n      elem.ctx.screen.popupMenu(menu, e.x - 15, e.y - 15);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n\r\n    elem.addEventListener(\"contextmenu\", (e) => e.preventDefault());\r\n    elem.addEventListener(\"dblclick\", on_dblclick, {capture: true});\r\n\r\n    return on_dblclick;\r\n  }\r\n\r\n  getOtherSarea(sarea) {\r\n    console.log(this.halfedges, this.halfedges.length);\r\n\r\n    for (let he of this.halfedges) {\r\n      console.log(he);\r\n\r\n      let ok = he.sarea !== sarea;\r\n      ok = ok && he.sarea._verts.indexOf(this.v1) >= 0;\r\n      ok = ok && he.sarea._verts.indexOf(this.v2) >= 0;\r\n\r\n      if (ok) {\r\n        return he.sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  get locked() {\r\n    for (let sarea of this.sareas) {\r\n      let mask = 1<<sarea._borders.indexOf(this);\r\n      let lock = sarea.borderLock & mask;\r\n\r\n      if (lock || (sarea.flag & AreaFlags.NO_COLLAPSE)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  get dead() {\r\n    return !this.parentNode;\r\n  }\r\n\r\n  get side() {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  set side(val) {\r\n    throw new Error(\"side accedd\");\r\n  }\r\n\r\n  get valence() {\r\n    let ret = 0; //this.sareas.length;\r\n    let horiz = this.horiz;\r\n\r\n    let visit = {};\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let sv = i ? this.v2 : this.v1;\r\n      //console.log(sv);\r\n\r\n      for (let sa of sv.borders) {\r\n        if (sa.horiz != this.horiz)\r\n          continue;\r\n        if (sa._id in visit)\r\n          continue;\r\n\r\n        visit[sa._id] = 1;\r\n\r\n        let a0x = Math.min(this.v1[0], this.v2[0]);\r\n        let a0y = Math.min(this.v1[1], this.v2[1]);\r\n        let a1x = Math.max(this.v1[0], this.v2[0]);\r\n        let a1y = Math.max(this.v1[1], this.v2[1]);\r\n\r\n        let b0x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b0y = Math.min(sa.v1[1], sa.v2[1]);\r\n        let b1x = Math.min(sa.v1[0], sa.v2[0]);\r\n        let b1y = Math.min(sa.v1[1], sa.v2[1]);\r\n\r\n        let ok;\r\n\r\n        let eps = 0.001;\r\n        if (horiz) {\r\n          ok = (a0y <= b1y + eps && a1y >= a0y - eps);\r\n        } else {\r\n          ok = (a0x <= b1x + eps && a1x >= a0x - eps);\r\n        }\r\n\r\n        if (ok) {\r\n          //console.log(\"found\");\r\n          ret += sa.sareas.length;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get horiz() {\r\n    let dx = this.v2[0] - this.v1[0];\r\n    let dy = this.v2[1] - this.v1[1];\r\n\r\n    return Math.abs(dx) > Math.abs(dy);\r\n  }\r\n\r\n  static hash(v1, v2) {\r\n    return Math.min(v1._id, v2._id) + \":\" + Math.max(v1._id, v2._id);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"screenborder-x\",\r\n      style  : \"screenborder\"\r\n    };\r\n  }\r\n\r\n  otherVertex(v) {\r\n    if (v === this.v1)\r\n      return this.v2;\r\n    else\r\n      return this.v1;\r\n  }\r\n\r\n  setCSS() {\r\n    this.style[\"pointer-events\"] = this.movable ? \"auto\" : \"none\";\r\n\r\n    if (this._style === undefined) {\r\n      this._style = document.createElement(\"style\");\r\n      this.appendChild(this._style);\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let pad = this.getDefault(\"mouse-threshold\")/dpi;\r\n    let wid = this.getDefault(\"border-width\");\r\n\r\n    let v1 = this.v1, v2 = this.v2;\r\n    let vec = new Vector2(v2).sub(v1);\r\n\r\n    let x = Math.min(v1[0], v2[0]), y = Math.min(v1[1], v2[1]);\r\n    let w, h;\r\n    let cursor, bstyle;\r\n\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"display\"] = this.horiz ? \"row\" : \"column\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"align-items\"] = \"center\";\r\n\r\n    if (!this.horiz) {\r\n      this.style[\"padding-left\"] = this.style[\"padding-right\"] = pad + \"px\";\r\n      x -= wid*0.5 + pad;\r\n\r\n      w = wid*2;\r\n      h = Math.abs(vec[1]);\r\n\r\n      cursor = 'e-resize';\r\n      bstyle = \"border-left-style : solid;\\n    border-right-style : solid;\\n\";\r\n      bstyle = \"border-top-style : none;\\n    border-bottom-style : none;\\n\";\r\n    } else {\r\n      this.style[\"padding-top\"] = this.style[\"padding-bottom\"] = pad + \"px\";\r\n      y -= wid*0.5 + pad;\r\n\r\n      w = Math.abs(vec[0]);\r\n      h = wid;\r\n\r\n      cursor = 'n-resize';\r\n      bstyle = \"border-top-style : solid;\\n    border-bottom-style : solid;\\n\";\r\n    }\r\n\r\n\r\n    let color = this.getDefault(\"border-outer\");\r\n    let debug = cconst.DEBUG.screenborders;\r\n\r\n    if (debug) {\r\n      wid = 4;\r\n      let alpha = 1.0;\r\n      let c = this.sareas.length*75;\r\n\r\n      let r = 0, g = 0, b = 0;\r\n\r\n      if (this.movable) {\r\n        b = 255;\r\n      }\r\n      if (this.halfedges.length > 1) {\r\n        g = 255;\r\n      }\r\n      if (this.outer) {\r\n        r = 255;\r\n      }\r\n      color = `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    }\r\n\r\n\r\n    let innerbuf = `\r\n        .screenborder_inner_${this._id} {\r\n          ${bstyle}\r\n          ${this.horiz ? 'height' : 'width'} : ${wid}px;\r\n          ${!this.horiz ? 'height' : 'width'} : 100%;\r\n          margin : 0px;\r\n          padding : 0px;\r\n          \r\n          background-color : ${this.getDefault(\"border-inner\")};\r\n          border-color : ${color};\r\n          border-width : ${wid*0.5}px;\r\n          border-style : ${debug && this.outer ? \"dashed\" : \"solid\"};\r\n          pointer-events : none;\r\n        }`;\r\n\r\n    let sbuf = `\r\n        .screenborder_${this._id} {\r\n        }\r\n    `;\r\n\r\n    let ok = this.movable;\r\n    if (!this.outer) {\r\n      for (let sarea of this.sareas) {\r\n        ok = ok || sarea.floating;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      sbuf += `\r\n        .screenborder_${this._id}:hover {\r\n          cursor : ${cursor};\r\n        }\r\n      `;\r\n    }\r\n\r\n    this._style.textContent = sbuf;\r\n    this._innerstyle.textContent = innerbuf;\r\n\r\n    this.setAttribute(\"class\", \"screenborder_\" + this._id);\r\n    this.inner.setAttribute(\"class\", \"screenborder_inner_\" + this._id);\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"\" + BORDER_ZINDEX_BASE;\r\n  }\r\n\r\n  valueOf() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return ScreenBorder.hash(this.v1, this.v2);\r\n  }\r\n}\r\n\r\nui_base.UIBase.internalRegister(ScreenBorder);\r\n", "import {Area} from '../screen/ScreenArea.js';\r\nimport * as nstructjs from '../path-controller/util/struct.js';\r\nimport {UIBase, theme, flagThemeUpdate, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {validateCSSColor, color2css, css2color, CSSFont} from '../core/ui_theme.js';\r\n\r\nexport class ThemeEditor extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.categoryMap = {};\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"theme-editor-x\",\r\n      style  : \"theme-editor\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.build();\r\n  }\r\n\r\n  doFolder(catkey, obj, container = this, panel = undefined, path=undefined) {\r\n    let key = catkey.key;\r\n\r\n    if (!path) {\r\n      path = [key];\r\n    }\r\n\r\n    if (!panel) {\r\n      panel = container.panel(key, undefined, undefined, catkey.help);\r\n      panel.style[\"margin-left\"] = \"15px\";\r\n    }\r\n\r\n    let row2 = panel.row();\r\n    let textbox = row2.textbox(undefined, \"\");\r\n\r\n    let callback = (id) => {\r\n      console.log(\"ID\", id, obj, catkey);\r\n      console.log(textbox, textbox.text, textbox.value);\r\n\r\n      let propkey = (textbox.text || \"\").trim();\r\n\r\n      if (!propkey) {\r\n        console.error(\"Cannot have empty theme property name\");\r\n        return;\r\n      }\r\n\r\n      if (id === \"FLOAT\") {\r\n        obj[propkey] = 0.0;\r\n      } else if (id === \"SUBFOLDER\") {\r\n        obj[propkey] = {test : 0};\r\n      } else if (id === \"COLOR\") {\r\n        obj[propkey] = \"grey\";\r\n      } else if (id === \"FONT\") {\r\n        obj[propkey] = new CSSFont();\r\n      } else if (id === \"STRING\") {\r\n        obj[propkey] = \"\";\r\n      }\r\n\r\n      let uidata = saveUIData(panel, \"theme-panel\");\r\n\r\n      panel.clear();\r\n      this.doFolder(catkey, obj, container, panel, path);\r\n\r\n      loadUIData(panel, uidata);\r\n      panel.flushUpdate();\r\n      panel.flushSetCSS();\r\n\r\n      //doFolder(catkey, obj, container = this, panel=undefined) {\r\n      //this.build();\r\n      if (this.onchange) {\r\n        this.onchange(key, propkey, obj);\r\n      }\r\n    }\r\n\r\n    let menu = row2.menu(\"+\", [\r\n      {name: \"Float\", callback: () => callback(\"FLOAT\")},\r\n      {name: \"Color\", callback: () => callback(\"COLOR\")},\r\n      {name: \"Subfolder\", callback: () => callback(\"SUBFOLDER\")},\r\n      {name: \"Font\", callback: () => callback(\"FONT\")},\r\n      {name: \"String\", callback: () => callback(\"STRING\")},\r\n    ]);\r\n\r\n    let row = panel.row();\r\n    let col1 = row.col();\r\n    let col2 = row.col();\r\n\r\n    let do_onchange = (key, k, obj) => {\r\n      flagThemeUpdate();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(key, k, obj);\r\n      }\r\n\r\n      this.ctx.screen.completeSetCSS();\r\n      this.ctx.screen.completeUpdate();\r\n    };\r\n\r\n    let getpath = (path) => {\r\n      let obj = theme;\r\n\r\n      for (let i = 0; i < path.length; i++) {\r\n        obj = obj[path[i]];\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    let ok = false;\r\n    let _i = 0;\r\n\r\n    let dokey = (k, v, path) => {\r\n      let col = _i%2 === 0 ? col1 : col2;\r\n\r\n      if (k.toLowerCase().search(\"flag\") >= 0) {\r\n        return; //don't do flags\r\n      }\r\n\r\n      if (typeof v === \"string\") {\r\n        let v2 = v.toLowerCase().trim();\r\n\r\n        let iscolor = validateCSSColor(v2);\r\n\r\n        if (iscolor) {\r\n          let cw = col.colorbutton();\r\n          ok = true;\r\n          _i++;\r\n\r\n          let color = css2color(v2);\r\n          if (color.length < 3) {\r\n            color = [color[0], color[1], color[2], 1.0];\r\n          }\r\n\r\n          try {\r\n            cw.setRGBA(color);\r\n          } catch (error) {\r\n            console.warn(\"Failed to set color \" + k, v2);\r\n          }\r\n\r\n          cw.onchange = () => {\r\n            console.log(\"setting '\" + k + \"' to \" + color2css(cw.rgba), key);\r\n            getpath(path)[k] = color2css(cw.rgba);\r\n\r\n            do_onchange(key, k);\r\n          }\r\n          cw.label = k;\r\n        } else {\r\n          col.label(k);\r\n\r\n          let box = col.textbox();\r\n          box.onchange = () => {\r\n            getpath(path)[k] = box.text;\r\n            do_onchange(key, k);\r\n          }\r\n          box.text = v;\r\n        }\r\n      } else if (typeof v === \"number\") {\r\n        let slider = col.slider(undefined, k, v, 0, 256, 0.01, false);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        ok = true;\r\n        _i++;\r\n\r\n        slider.onchange = () => {\r\n          getpath(path)[k] = slider.value;\r\n\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"boolean\") {\r\n        let check = col.check(undefined, k);\r\n\r\n        check.value = getpath(path)[k];\r\n\r\n        check.onchange = () => {\r\n          getpath(path)[k] = !!check.value;\r\n          do_onchange(key, k);\r\n        }\r\n      } else if (typeof v === \"object\" && v instanceof CSSFont) {\r\n        let panel2 = col.panel(k);\r\n        ok = true;\r\n        _i++;\r\n\r\n        let textbox = (key) => {\r\n          panel2.label(key);\r\n          let tbox = panel2.textbox(undefined, v[key]);\r\n\r\n          tbox.width = tbox.getDefault(\"width\");\r\n\r\n          tbox.onchange = function () {\r\n            v[key] = this.text;\r\n            do_onchange(key, k);\r\n          }\r\n        }\r\n\r\n        textbox(\"font\");\r\n        textbox(\"variant\");\r\n        textbox(\"weight\");\r\n        textbox(\"style\");\r\n\r\n        let cw = panel2.colorbutton();\r\n        cw.label = \"color\";\r\n        cw.setRGBA(css2color(v.color));\r\n        cw.onchange = () => {\r\n          v.color = color2css(cw.rgba);\r\n          do_onchange(key, k);\r\n        }\r\n\r\n        let slider = panel2.slider(undefined, \"size\", v.size);\r\n        slider.onchange = () => {\r\n          v.size = slider.value;\r\n          do_onchange(key, k);\r\n        }\r\n        slider.setAttribute(\"min\", 1);\r\n        slider.setAttribute(\"max\", 100);\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        panel2.closed = true;\r\n      } else if (typeof v === \"object\") {\r\n        /*\r\n          let old = {\r\n            panel, row, col1, col2\r\n          };\r\n\r\n          let path2 = path.slice(0, path.length);\r\n          path2.push(k);\r\n\r\n          panel = panel.panel(k);\r\n          row = panel.row();\r\n          col1 = row.col();\r\n          col2 = row.col();\r\n          for (let k2 in v) {\r\n            let v2 = v[k2];\r\n\r\n            dokey(k2, v2, path2);\r\n          }\r\n\r\n          panel = old.panel;\r\n          row = old.row;\r\n          col1 = old.col1;\r\n          col2 = old.col2;\r\n        */\r\n\r\n        let catkey2 = Object.assign({}, catkey);\r\n        catkey2.key = k;\r\n\r\n        let path2 = path.concat(k);\r\n\r\n        this.doFolder(catkey2, v, panel, undefined, path2);\r\n      }\r\n    };\r\n\r\n    for (let k in obj) {\r\n      let v = obj[k];\r\n\r\n      dokey(k, v, path);\r\n    }\r\n\r\n    if (!ok) {\r\n      panel.remove();\r\n    } else {\r\n      panel.closed = true;\r\n    }\r\n\r\n  }\r\n\r\n  build() {\r\n    let uidata = saveUIData(this, \"theme\");\r\n\r\n    this.clear();\r\n\r\n    let categories = {};\r\n\r\n    for (let k of Object.keys(theme)) {\r\n      let catkey;\r\n\r\n      if (k in this.categoryMap) {\r\n        let cat = this.categoryMap[k];\r\n\r\n        if (typeof cat === \"string\") {\r\n          cat = {\r\n            category: cat,\r\n            help    : \"\",\r\n            key     : k\r\n          }\r\n        }\r\n\r\n        catkey = cat;\r\n      } else {\r\n        catkey = {category: k, help: '', key: k};\r\n      }\r\n\r\n      if (!catkey.key) {\r\n        catkey.key = k;\r\n      }\r\n\r\n      if (!(catkey.category in categories)) {\r\n        categories[catkey.category] = [];\r\n      }\r\n\r\n      categories[catkey.category].push(catkey);\r\n    }\r\n\r\n    function strcmp(a, b) {\r\n      a = a.trim().toLowerCase();\r\n      b = b.trim().toLowerCase();\r\n      return a < b ? -1 : (a === b ? 0 : 1);\r\n    }\r\n\r\n    let keys = Object.keys(categories);\r\n    keys.sort(strcmp);\r\n\r\n    for (let k of keys) {\r\n      let list = categories[k];\r\n      list.sort((a, b) => strcmp(a.key, b.key));\r\n\r\n      let panel = this;\r\n\r\n      if (list.length > 1) {\r\n        panel = this.panel(k);\r\n      }\r\n\r\n      for (let cat of list) {\r\n        let k2 = cat.key;\r\n        let v = theme[k2];\r\n\r\n        if (typeof v === \"object\") {\r\n          this.doFolder(cat, v, panel);\r\n        }\r\n      }\r\n\r\n      if (list.length > 1) {\r\n        panel.closed = true;\r\n      }\r\n    }\r\n\r\n    loadUIData(this, uidata);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (this.ctx && this.ctx.screen) {\r\n      /* Fix panel spacing bug. */\r\n      window.setTimeout(() => {\r\n        this.ctx.screen.completeSetCSS();\r\n      }, 100);\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ThemeEditor);\r\n", "import {UIBase, drawText} from \"../core/ui_base.js\";\r\nimport {ValueButtonBase} from \"./ui_widgets.js\";\r\nimport cconst from '../config/const.js';\r\nimport * as ui_base from \"../core/ui_base.js\";\r\nimport * as units from \"../core/units.js\";\r\nimport {Vector2} from \"../path-controller/util/vectormath.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport * as util from \"../path-controller/util/util.js\";\r\nimport {\r\n  PropTypes, isNumber, PropSubTypes, PropFlags, NumberConstraints, IntProperty\r\n} from \"../path-controller/toolsys/toolprop.js\";\r\nimport {eventWasTouch} from \"../path-controller/util/simple_events.js\";\r\nimport {KeyMap, keymap} from \"../path-controller/util/simple_events.js\";\r\nimport {color2css, css2color} from \"../core/ui_theme.js\";\r\nimport {ThemeEditor} from \"./theme_editor.js\";\r\nimport {Unit} from '../core/units.js';\r\n\r\nexport const sliderDomAttributes = new Set([\r\n  \"min\", \"max\", \"integer\", \"displayUnit\", \"baseUnit\", \"labelOnTop\",\r\n  \"radix\", \"step\", \"expRate\", \"stepIsRelative\", \"decimalPlaces\",\r\n  \"slideSpeed\", \"sliderDisplayExp\"\r\n]);\r\n\r\nfunction updateSliderFromDom(dom, slider = dom) {\r\n  slider.loadNumConstraints(undefined, dom);\r\n}\r\n\r\nexport const SliderDefaults = {\r\n  stepIsRelative  : false,\r\n  expRate         : 1.0 + 1.0/3.0,\r\n  radix           : 10,\r\n  decimalPlaces   : 4,\r\n  baseUnit        : \"none\",\r\n  displayUnit     : \"none\",\r\n  slideSpeed      : 1.0,\r\n  step            : 0.1,\r\n  sliderDisplayExp: 1.0\r\n}\r\n\r\nexport function NumberSliderBase(cls = UIBase, skip = new Set(), defaults = SliderDefaults) {\r\n  skip = new Set(skip);\r\n\r\n  return class NumberSliderBase extends cls {\r\n    constructor() {\r\n      super();\r\n\r\n      for (let key of NumberConstraints) {\r\n        if (skip.has(key)) {\r\n          continue;\r\n        }\r\n\r\n        if (key in defaults) {\r\n          this[key] = defaults[key];\r\n        } else {\r\n          this[key] = undefined;\r\n        }\r\n      }\r\n    }\r\n\r\n    loadNumConstraints(prop, dom) {\r\n      return super.loadNumConstraints(prop, dom, this._redraw);\r\n    }\r\n  }\r\n}\r\n\r\n//use .setAttribute(\"linear\") to disable nonlinear sliding\r\nexport class NumSlider extends NumberSliderBase(ValueButtonBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = undefined;\r\n    this._last_label = undefined;\r\n\r\n    this.mdown = false;\r\n    this.ma = undefined;\r\n\r\n    this.mpos = new Vector2();\r\n    this.start_mpos = new Vector2();\r\n\r\n    this._last_overarrow = false;\r\n\r\n    this._name = \"\";\r\n    this._value = 0.0;\r\n    this.expRate = SliderDefaults.expRate;\r\n\r\n    this.vertical = false;\r\n    this._last_disabled = false;\r\n\r\n    this.range = [-1e17, 1e17];\r\n    this.isInt = false;\r\n    this.editAsBaseUnit = undefined;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  get name() {\r\n    return this.getAttribute(\"name\") || this._name;\r\n  }\r\n\r\n  /** Current name label.  If set to null label will\r\n   * be pulled from the datapath api.*/\r\n  set name(name) {\r\n    if (name === undefined || name === null) {\r\n      this.removeAttribute(\"name\");\r\n    } else {\r\n      this.setAttribute(\"name\", name);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"numslider-x\",\r\n      style            : \"numslider\",\r\n      parentStyle      : \"button\",\r\n      havePickClipboard: true,\r\n    };\r\n  }\r\n\r\n\r\n  updateWidth(force = false) {\r\n    let dpi = UIBase.getDPI();\r\n    let wid = ~~(this.getDefault(\"width\")*dpi);\r\n\r\n    if (force || wid !== this._last_width) {\r\n      this._last_width = wid;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let name;\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      name = this.getAttribute(\"name\");\r\n    } else {\r\n      name = \"\" + prop.uiname;\r\n    }\r\n\r\n    //lazily load constraints, since there's so much\r\n    //accessing of DOM attributes\r\n    let updateConstraints = false;\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n      updateConstraints = true;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val !== this._value) {\r\n      updateConstraints = true;\r\n      /* Note that super.updateDataPath will update .value for us*/\r\n    }\r\n\r\n    if (updateConstraints) {\r\n      this.loadNumConstraints(prop);\r\n    }\r\n\r\n    super.updateDataPath();\r\n  }\r\n\r\n  update() {\r\n    if (!!this._last_disabled !== !!this.disabled) {\r\n      this._last_disabled = !!this.disabled;\r\n      this._redraw();\r\n      this.setCSS();\r\n    }\r\n\r\n    this.updateWidth();\r\n    super.update(); //calls this.updateDataPath\r\n\r\n    updateSliderFromDom(this);\r\n  }\r\n\r\n  clipboardCopy() {\r\n    console.log(\"Copy\", \"\" + this.value);\r\n    cconst.setClipboardData(\"value\", \"text/plain\", \"\" + this.value);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    let data = cconst.getClipboardData(\"text/plain\");\r\n    console.log(\"Paste\", data);\r\n\r\n    if (typeof data == \"object\") {\r\n      data = data.data;\r\n    }\r\n\r\n    let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n    let val = units.parseValue(data, this.baseUnit, displayUnit);\r\n\r\n    if (typeof val === \"number\" && !isNaN(val)) {\r\n      this.setValue(val);\r\n    }\r\n  }\r\n\r\n  swapWithTextbox() {\r\n    let tbox = UIBase.createElement(\"textbox-x\");\r\n\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n\r\n    this.mdown = false;\r\n    this._pressed = false;\r\n\r\n    tbox.ctx = this.ctx;\r\n    tbox._init();\r\n\r\n    tbox.decimalPlaces = this.decimalPlaces;\r\n    tbox.isInt = this.isInt;\r\n    tbox.editAsBaseUnit = this.editAsBaseUnit;\r\n\r\n    if (this.isInt && this.radix != 10) {\r\n      let text = this.value.toString(this.radix);\r\n      if (this.radix === 2)\r\n        text = \"0b\" + text;\r\n      else if (this.radix === 16)\r\n        text += \"h\";\r\n\r\n      tbox.text = text;\r\n    } else {\r\n      tbox.text = units.buildString(this.value, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n    }\r\n\r\n    this.parentNode.insertBefore(tbox, this);\r\n    //this.remove();\r\n    this.hidden = true;\r\n    //this.dom.hidden = true;\r\n\r\n    let finish = (ok) => {\r\n      tbox.remove();\r\n      this.hidden = false;\r\n\r\n      if (ok) {\r\n        let val = tbox.text.trim();\r\n\r\n        if (this.isInt && this.radix !== 10) {\r\n          val = parseInt(val);\r\n        } else {\r\n          let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n          val = units.parseValue(val, this.baseUnit, displayUnit);\r\n        }\r\n\r\n        if (isNaN(val)) {\r\n          console.log(\"Text input error\", val, tbox.text.trim(), this.isInt);\r\n          this.flash(ui_base.ErrorColors.ERROR);\r\n        } else {\r\n          this.setValue(val);\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tbox.onend = finish;\r\n    tbox.focus();\r\n    tbox.select();\r\n\r\n    //this.shadow.appendChild(tbox);\r\n    return;\r\n  }\r\n\r\n  bindEvents() {\r\n    let dir = this.range && this.range[0] > this.range[1] ? -1 : 1;\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Down\"]:\r\n          this.setValue(this.value - dir*5*this.step);\r\n          break;\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Right\"]:\r\n          this.setValue(this.value + dir*5*this.step);\r\n          break;\r\n      }\r\n    });\r\n\r\n    let onmousedown = (e) => {\r\n      e.preventDefault();\r\n\r\n      if (this.disabled) {\r\n        this.mdown = false;\r\n        this._pressed = false;\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      if (e.button) {\r\n        return;\r\n      }\r\n\r\n      this.mdown = true;\r\n      this._pressed = true;\r\n      this._redraw();\r\n\r\n      if (this.overArrow(e.x, e.y)) {\r\n        this._on_click(e);\r\n      } else {\r\n        this.dragStart(e);\r\n        e.stopPropagation();\r\n      }\r\n    }\r\n\r\n    this._on_click = (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      let step;\r\n\r\n      if (step = this.overArrow(e.x, e.y)) {\r\n        if (e.shiftKey) {\r\n          step *= 0.1;\r\n        }\r\n\r\n        this.setValue(this.value + step);\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.mdown && !this._modaldata && this.mpos.vectorDistance(this.start_mpos) > 13) {\r\n        this.dragStart(e);\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"dblclick\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n\r\n      if (this.disabled || this.overArrow(e.x, e.y)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        return;\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      this.swapWithTextbox();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.setMpos(e);\r\n\r\n      if (this.disabled) return;\r\n      onmousedown(e);\r\n    }, {capture: true});\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.mdown = false;\r\n      this._pressed = false;\r\n      this._redraw();\r\n    })\r\n    /*\r\n    this.addEventListener(\"touchstart\", (e) => {\r\n      if (this.disabled) return;\r\n\r\n      e.x = e.touches[0].screenX;\r\n      e.y = e.touches[0].screenY;\r\n\r\n      this.dragStart(e);\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }, {passive : false});\r\n    //*/\r\n\r\n    //this.addEventListener(\"pointerup\", (e) => {\r\n    //  return onmouseup(e);\r\n    //});\r\n\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      if (!this._highlight) {\r\n        this._highlight = true;\r\n        this._repos_canvas();\r\n        this._redraw();\r\n      }\r\n    })\r\n\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._highlight = false;\r\n      this.mdown = false;\r\n    });\r\n\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.setMpos(e);\r\n      if (this.disabled) return;\r\n\r\n      this._highlight = false;\r\n\r\n      this.dom._background = this.getDefault(\"background-color\");\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    })\r\n  }\r\n\r\n  overArrow(x, y) {\r\n    let r = this.getBoundingClientRect();\r\n    let rwidth, rx;\r\n\r\n    if (this.vertical) {\r\n      rwidth = r.height;\r\n      rx = r.y;\r\n      x = y;\r\n    } else {\r\n      rwidth = r.width;\r\n      rx = r.x;\r\n    }\r\n\r\n    x -= rx;\r\n    let sz = this._getArrowSize();\r\n\r\n    let szmargin = sz + cconst.numSliderArrowLimit;\r\n\r\n    let step = this.step || 0.01;\r\n\r\n    if (this.isInt) {\r\n      step = Math.max(step, 1);\r\n    }\r\n\r\n    if (isNaN(step)) {\r\n      console.error(\"NaN step size\", \"step:\", this.step, \"numslider:\", this._id);\r\n      this.flash(\"red\");\r\n      step = this.isInt ? 1 : 0.1;\r\n    }\r\n\r\n    if (x < szmargin) {\r\n      return -step;\r\n    } else if (x > rwidth - szmargin) {\r\n      return step;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  doRange() {\r\n    console.warn(\"Deprecated: NumSlider.prototype.doRange, use loadNumConstraints instead!\");\r\n    this.loadNumConstraints();\r\n  }\r\n\r\n  setValue(value, fire_onchange = true, setDataPath = true, checkConstraints = true) {\r\n    value = Math.min(Math.max(value, this.range[0]), this.range[1]);\r\n\r\n    this._value = value;\r\n\r\n    if (this.hasAttribute(\"integer\")) {\r\n      this.isInt = true;\r\n    }\r\n\r\n    if (this.isInt) {\r\n      this._value = Math.floor(this._value);\r\n    }\r\n\r\n    if (checkConstraints) {\r\n      this.loadNumConstraints();\r\n    }\r\n\r\n    if (setDataPath && this.ctx && this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this._value);\r\n    }\r\n\r\n    if (fire_onchange && this.onchange) {\r\n      this.onchange(this.value);\r\n    }\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  setMpos(e) {\r\n    this.mpos[0] = e.x;\r\n    this.mpos[1] = e.y;\r\n\r\n    if (!this.mdown) {\r\n      this.start_mpos[0] = e.x;\r\n      this.start_mpos[1] = e.y;\r\n    }\r\n\r\n    let over = this.overArrow(e.x, e.y);\r\n\r\n    if (over !== this._last_overarrow) {\r\n      this._last_overarrow = over;\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  dragStart(e) {\r\n    this.mdown = false;\r\n    this._pressed = true;\r\n\r\n    if (this.disabled) return;\r\n\r\n    if (this.modalRunning) {\r\n      console.log(\"modal already running for numslider\", this);\r\n      return;\r\n    }\r\n\r\n    this.last_time = util.time_ms();\r\n\r\n    let last_background = this.dom._background;\r\n    let cancel;\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 8 : 2);\r\n\r\n    let startvalue = this.value;\r\n    let value = startvalue;\r\n\r\n    let startx = this.vertical ? e.y : e.x, starty = this.vertical ? e.x : e.y;\r\n    let sumdelta = 0;\r\n\r\n    this.dom._background = this.getDefault(\"BoxDepressed\");\r\n    let fire = () => {\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    let handlers = {\r\n      on_keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case 27: //escape key\r\n            cancel(true);\r\n          case 13: //enter key\r\n            cancel(false);\r\n            break;\r\n        }\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointermove: (e) => {\r\n        if (this.disabled) return;\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        let x = this.ma.add(this.vertical ? e.y : e.x);\r\n        let dx = x - startx;\r\n        startx = x;\r\n\r\n        if (util.time_ms() - this.last_time < 35) {\r\n          return;\r\n        }\r\n        this.last_time = util.time_ms();\r\n\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n        }\r\n\r\n        dx *= this.vertical ? -1 : 1;\r\n\r\n        sumdelta += Math.abs(dx);\r\n\r\n        value += dx*this.step*0.1*this.slideSpeed;\r\n\r\n        let dvalue = value - startvalue;\r\n        let dsign = Math.sign(dvalue);\r\n\r\n        let expRate = this.expRate;\r\n\r\n        //if (eventWasTouch(e)) {\r\n        //  expRate = (1 + expRate)*0.5;\r\n        //}\r\n\r\n        if (!this.hasAttribute(\"linear\")) {\r\n          dvalue = Math.pow(Math.abs(dvalue), expRate)*dsign;\r\n        }\r\n\r\n        this.value = startvalue + dvalue;\r\n\r\n        /*\r\n        if (e.shiftKey) {\r\n          dx *= 0.1;\r\n          this.value = startvalue2 + dx*0.1*this.step*this.slideSpeed;\r\n          startvalue3 = this.value;\r\n        } else {\r\n          startvalue2 = this.value;\r\n          this.value = startvalue3 + dx*0.1*this.step*this.slideSpeed;\r\n        }*/\r\n\r\n        this.updateWidth();\r\n        this._redraw();\r\n        fire();\r\n      },\r\n\r\n      on_pointerup: (e) => {\r\n        this.setMpos(e);\r\n\r\n        this.undoBreakPoint();\r\n        cancel(false);\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerout: (e) => {\r\n        last_background = this.getDefault(\"background-color\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerover: (e) => {\r\n        last_background = this.getDefault(\"BoxHighlight\");\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      },\r\n\r\n      on_pointerdown: (e) => {\r\n        this.popModal();\r\n      },\r\n    };\r\n\r\n    //events.pushModal(this.getScreen(), handlers);\r\n    this.pushModal(handlers);\r\n\r\n    cancel = (restore_value) => {\r\n      this._pressed = false;\r\n\r\n      if (restore_value) {\r\n        this.value = startvalue;\r\n        this.updateWidth();\r\n        fire();\r\n      }\r\n\r\n      this.dom._background = last_background; //ui_base.getDefault(\"background-color\");\r\n      this._redraw();\r\n\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  get _pressed() {\r\n    return this.__pressed;\r\n  }\r\n\r\n  set _pressed(v) {\r\n    /* Try to improve usability on pen/touch displays\r\n     * by forcing pressed state to last at least 100ms.\r\n     */\r\n    if (!v) {\r\n      window.setTimeout(() => {\r\n        let redraw = this.__pressed;\r\n\r\n        this.__pressed = false;\r\n        if (redraw) {\r\n          this._redraw();\r\n        }\r\n      }, 100);\r\n    } else {\r\n      this.__pressed = v;\r\n    }\r\n  }\r\n\r\n  setCSS(unused_setBG, fromRedraw) {\r\n    /* Do not call parent class implementation. */\r\n\r\n    let dpi = this.getDPI();\r\n    let ts = this.getDefault(\"DefaultText\").size*UIBase.getDPI();\r\n    let label = this._genLabel();\r\n\r\n    let tw = ui_base.measureText(this, label, {\r\n      size: ts,\r\n      font: this.getDefault(\"DefaultText\")\r\n    }).width/dpi;\r\n\r\n    /* Enforce a minimum size based on final text. */\r\n    tw = Math.max(tw + this._getArrowSize()*1, this.getDefault(\"width\"));\r\n\r\n    tw += ts;\r\n    tw = ~~tw;\r\n\r\n    let w, h;\r\n\r\n    if (this.vertical) {\r\n      w = this.getDefault(\"height\");\r\n      h = tw;\r\n    } else {\r\n      h = this.getDefault(\"height\");\r\n      w = tw;\r\n    }\r\n\r\n    w = ~~(w*dpi);\r\n    h = ~~(h*dpi);\r\n\r\n    this.style[\"width\"] = this.dom.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.style[\"height\"] = this.dom.style[\"height\"] = (h/dpi) + \"px\";\r\n    this.dom.width = w;\r\n    this.dom.height = h;\r\n\r\n    if (!fromRedraw) {\r\n      this._repos_canvas();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _repos_canvas() {\r\n    //super._repos_canvas();\r\n  }\r\n\r\n  updateDefaultSize() {\r\n    /* Do nothing, don't invoke parent class method. */\r\n  }\r\n\r\n  updateName(force) {\r\n    if (!this.hasAttribute(\"name\")) {\r\n      return;\r\n    }\r\n\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (force || name !== this._name) {\r\n      this._name = name;\r\n      this.setCSS();\r\n    }\r\n\r\n    let label = this._genLabel();\r\n    if (label !== this._last_label) {\r\n      this._last_label = label;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  _genLabel() {\r\n    let val = this.value;\r\n    let text;\r\n\r\n    if (val === undefined) {\r\n      text = \"error\";\r\n    } else {\r\n      val = val === undefined ? 0.0 : val;\r\n\r\n      if (this.isInt) {\r\n        val = Math.floor(val);\r\n      }\r\n\r\n      val = units.buildString(val, this.baseUnit, this.decimalPlaces, this.displayUnit);\r\n\r\n      text = val;\r\n      if (this._name) {\r\n        text = this._name + \": \" + text;\r\n      } else if (this.hasAttribute(\"name\")) {\r\n        text = \"\" + this.getAttribute(\"name\") + \": \" + text;\r\n      }\r\n    }\r\n\r\n    return text;\r\n  }\r\n\r\n  _redraw(fromCSS) {\r\n    if (!fromCSS) {\r\n      this.setCSS(undefined, true);\r\n    }\r\n\r\n    let g = this.g;\r\n    let canvas = this.dom;\r\n\r\n    let dpi = this.getDPI();\r\n    let disabled = this.disabled;\r\n\r\n    /* Fallback on BoxHighlight for backwards compatibility with\r\n     * old themes. */\r\n\r\n    let over = !this._modaldata && this.overArrow(this.mpos[0], this.mpos[1]);\r\n\r\n    let subkey = undefined;\r\n    let pressed = this._pressed && !over;\r\n\r\n    if (this._highlight && pressed) {\r\n      subkey = \"highlight-pressed\";\r\n    } else if (this._highlight) {\r\n      subkey = \"highlight\";\r\n    } else if (pressed) {\r\n      subkey = \"pressed\";\r\n    }\r\n\r\n    let getDefault = (key, backupval = undefined, subkey2 = subkey) => {\r\n      /* Have highlight-pressed fall back to pressed. */\r\n      if (subkey2 === \"highlight-pressed\" && !this.hasClassSubDefault(subkey2, key, false)) {\r\n        return this.getSubDefault(\"pressed\", key, undefined, backupval);\r\n      }\r\n\r\n      if (!subkey2) {\r\n        return this.getDefault(key, undefined, backupval);\r\n      } else {\r\n        return this.getSubDefault(subkey2, key, undefined, backupval);\r\n      }\r\n    }\r\n\r\n    let r = getDefault(\"border-radius\");\r\n    if (this.isInt) {\r\n      r *= 0.25;\r\n    }\r\n\r\n    let boxbg = getDefault(\"background-color\");\r\n\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"fill\", disabled ? getDefault(\"DisabledBG\") : boxbg);\r\n    ui_base.drawRoundBox(this, this.dom, this.g, undefined, undefined,\r\n      r, \"stroke\", disabled ? getDefault(\"DisabledBG\") : getDefault(\"border-color\"));\r\n\r\n    let ts = getDefault(\"DefaultText\").size;\r\n    let text = this._genLabel();\r\n\r\n    let cx = ts + this._getArrowSize();\r\n    let cy = this.dom.height/2;\r\n\r\n    this.dom.font = undefined;\r\n\r\n    g.save();\r\n\r\n    let th = Math.PI*0.5;\r\n\r\n    if (this.vertical) {\r\n      g.rotate(th);\r\n\r\n      ui_base.drawText(this, cx, -ts*0.5, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n      g.restore();\r\n    } else {\r\n      ui_base.drawText(this, cx, cy + ts/2, text, {\r\n        canvas: this.dom,\r\n        g     : this.g,\r\n        size  : ts,\r\n        font  : getDefault(\"DefaultText\"),\r\n      });\r\n    }\r\n\r\n    let parseArrowColor = (arrowcolor) => {\r\n      arrowcolor = arrowcolor.trim();\r\n      if (arrowcolor.endsWith(\"%\")) {\r\n        arrowcolor = arrowcolor.slice(0, arrowcolor.length - 1).trim();\r\n\r\n        let perc = parseFloat(arrowcolor)/100.0;\r\n        let c = css2color(this.getDefault(\"background-color\"));\r\n\r\n        let f = (c[0] + c[1] + c[2])*perc;\r\n\r\n        f = ~~(f*255);\r\n        arrowcolor = `rgba(${f},${f},${f},0.95)`;\r\n\r\n      }\r\n      return arrowcolor;\r\n    }\r\n\r\n    let arrowcolor_base;\r\n    let arrowcolor;\r\n\r\n    arrowcolor_base = this.getDefault(\"arrow-color\");\r\n    arrowcolor_base = parseArrowColor(arrowcolor_base);\r\n\r\n    if (this._pressed && this._highlight) {\r\n      arrowcolor = this.getSubDefault(\"highlight-pressed\", \"arrow-color\", null, undefined, false);\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n      }\r\n\r\n      if (!arrowcolor) {\r\n        arrowcolor = \"33%\";\r\n      }\r\n    } else if (this._pressed) {\r\n      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\", \"arrow-color\", \"33%\");\r\n    } else if (this._highlight) {\r\n      if (!this.hasClassSubDefault(\"highlight\", \"arrow-color\", false)) {\r\n        if (this.hasClassSubDefault(\"highlight\", \"background-color\", false)) {\r\n          arrowcolor = this.getSubDefault(\"highlight\", \"background-color\");\r\n        } else {\r\n          arrowcolor = this.getDefault(\"BoxHighlight\");\r\n        }\r\n\r\n        arrowcolor = css2color(arrowcolor);\r\n        let base = this.getSubDefault(\"pressed\", \"arrow-color\", undefined, \"33%\");\r\n        base = css2color(base);\r\n\r\n        arrowcolor.interp(base, 0.25);\r\n        arrowcolor = color2css(arrowcolor);\r\n      } else {\r\n        arrowcolor = this.getSubDefault(\"highlight\", \"arrow-color\");\r\n      }\r\n    } else {\r\n      arrowcolor = getDefault(\"arrow-color\", \"33%\");\r\n    }\r\n\r\n    if (this._pressed) {\r\n//      arrowcolor = this.getSubDefault(\"pressed\", \"arrow-color\");\r\n    }\r\n\r\n    arrowcolor = parseArrowColor(arrowcolor);\r\n\r\n\r\n    let d = 7, w = canvas.width, h = canvas.height;\r\n    let sz = this._getArrowSize();\r\n\r\n    if (this.vertical) {\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, d);\r\n      g.lineTo(w*0.5 + sz*0.5, d + sz);\r\n      g.lineTo(w*0.5 - sz*0.5, d + sz);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w*0.5, h - d);\r\n      g.lineTo(w*0.5 + sz*0.5, h - sz - d);\r\n      g.lineTo(w*0.5 - sz*0.5, h - sz - d);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    } else {\r\n      g.beginPath();\r\n      g.moveTo(d, h*0.5);\r\n      g.lineTo(d + sz, h*0.5 + sz*0.5);\r\n      g.lineTo(d + sz, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over < 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n\r\n      g.beginPath();\r\n      g.moveTo(w - d, h*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 + sz*0.5);\r\n      g.lineTo(w - sz - d, h*0.5 - sz*0.5);\r\n\r\n      g.fillStyle = over > 0 ? arrowcolor : arrowcolor_base;\r\n      g.fill();\r\n    }\r\n\r\n    g.fill();\r\n  }\r\n\r\n  _getArrowSize() {\r\n    return UIBase.getDPI()*10;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSlider);\r\n\r\n\r\nexport class NumSliderSimpleBase extends NumberSliderBase(UIBase) {\r\n  constructor() {\r\n    super();\r\n\r\n    this.baseUnit = undefined;\r\n    this.displayUnit = undefined;\r\n    this.editAsBaseUnit = undefined;\r\n    this.sliderDisplayExp = undefined;\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.highlight = false;\r\n    this.isInt = false;\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.range = [0, 1];\r\n\r\n    /** if not undefined defines subrange of visible slider */\r\n    this.uiRange = undefined;\r\n\r\n    this.step = 0.1;\r\n    this._value = 0.5;\r\n    this.ma = undefined;\r\n    this._focus = false;\r\n\r\n    this.modal = undefined;\r\n\r\n    this._last_slider_key = '';\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname    : \"numslider-simple-base-x\",\r\n      style      : \"numslider_simple\",\r\n      parentStyle: \"button\"\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true, setDataPath = true) {\r\n    val = Math.min(Math.max(val, this.range[0]), this.range[1]);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (this._value !== val) {\r\n      this._value = val;\r\n      this._redraw();\r\n\r\n      if (this.onchange && fire_onchange) {\r\n        this.onchange(val);\r\n      }\r\n\r\n      if (setDataPath && this.getAttribute(\"datapath\")) {\r\n        let path = this.getAttribute(\"datapath\");\r\n        this.setPathValue(this.ctx, path, this._value);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n\r\n    if (!path || path === \"null\" || path === \"undefined\") {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this.isInt) {\r\n      val = Math.floor(val);\r\n    }\r\n\r\n    if (val !== this._value) {\r\n      let prop = this.getPathMeta(this.ctx, path);\r\n      if (!prop) {\r\n        return;\r\n      }\r\n\r\n      this.loadNumConstraints(prop);\r\n      this.setValue(val, true, false);\r\n    }\r\n  }\r\n\r\n  _setFromMouse(e) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let x = e.x - rect.left;\r\n    let dpi = UIBase.getDPI();\r\n    let co = this._getButtonPos();\r\n\r\n    let val = this._invertButtonX(x*dpi);\r\n    this.value = val;\r\n  }\r\n\r\n  _startModal(e) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    if (e !== undefined) {\r\n      this._setFromMouse(e);\r\n    }\r\n    let dom = window;\r\n    let evtargs = {capture: false};\r\n\r\n    if (this.modal) {\r\n      console.warn(\"Double call to _startModal!\");\r\n      return;\r\n    }\r\n\r\n    this.ma = new util.MovingAvg(eventWasTouch(e) ? 4 : 2);\r\n    let handlers;\r\n\r\n    let end = () => {\r\n      if (handlers === undefined) {\r\n        return;\r\n      }\r\n\r\n      this.popModal();\r\n      handlers = undefined;\r\n    };\r\n\r\n    handlers = {\r\n      pointermove: (e) => {\r\n        let x = e.x, y = e.y;\r\n\r\n        x = this.ma.add(x);\r\n\r\n        let e2 = new MouseEvent(e, {\r\n          x, y\r\n        });\r\n        this._setFromMouse(e);\r\n      },\r\n\r\n      pointerover : (e) => {\r\n      },\r\n      pointerout  : (e) => {\r\n      },\r\n      pointerleave: (e) => {\r\n      },\r\n      pointerenter: (e) => {\r\n      },\r\n      blur        : (e) => {\r\n      },\r\n      focus       : (e) => {\r\n      },\r\n\r\n      pointerup: (e) => {\r\n        this.undoBreakPoint();\r\n        end();\r\n      },\r\n\r\n      keydown: (e) => {\r\n        switch (e.keyCode) {\r\n          case keymap[\"Enter\"]:\r\n          case keymap[\"Space\"]:\r\n          case keymap[\"Escape\"]:\r\n            end();\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      return (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        return f(e);\r\n      }\r\n    }\r\n\r\n    for (let k in handlers) {\r\n      handlers[k] = makefunc(handlers[k]);\r\n    }\r\n\r\n    this.pushModal(handlers);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (!this.hasAttribute(\"tab-index\")) {\r\n      this.setAttribute(\"tab-index\", 0);\r\n    }\r\n\r\n    this.updateSize();\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      let dt = this.range[1] > this.range[0] ? 1 : -1;\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let fac = this.step;\r\n\r\n          if (e.shiftKey) {\r\n            fac *= 0.1;\r\n          }\r\n\r\n          if (this.isInt) {\r\n            fac = Math.max(fac, 1);\r\n          }\r\n\r\n          this.value += e.keyCode === keymap[\"Left\"] ? -dt*fac : dt*fac;\r\n\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"focusin\", () => {\r\n      if (this.disabled) return;\r\n\r\n      this._focus = 1;\r\n      this._redraw();\r\n      this.focus();\r\n    });\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      if (this.disabled) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n      this._startModal(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerin\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerout\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerover\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.setHighlight(e);\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"pointerleave\", (e) => {\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n    this.addEventListener(\"blur\", (e) => {\r\n      this._focus = 0;\r\n      this.highlight = false;\r\n      this._redraw();\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setHighlight(e) {\r\n    this.highlight = this.isOverButton(e) ? 2 : 1;\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let w = canvas.width, h = canvas.height;\r\n    let dpi = UIBase.getDPI();\r\n\r\n    let color = this.getDefault(\"background-color\");\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    g.fillStyle = color;\r\n\r\n    let y = (h - sh)*0.5;\r\n\r\n    let r = this.getDefault(\"border-radius\");\r\n\r\n    g.translate(0, y);\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"fill\", color, undefined, true);\r\n\r\n    let bcolor = this.getDefault('border-color');\r\n    ui_base.drawRoundBox(this, this.canvas, g, w, sh, r, \"stroke\", bcolor, undefined, true);\r\n    g.translate(0, -y);\r\n\r\n    if (this.sliderDisplayExp && this.sliderDisplayExp !== 1.0) {\r\n      g.strokeStyle = this.getDefault(\"SliderDivColor\")\r\n        || this.getDefault(\"border-color\")\r\n        || \"grey\";\r\n\r\n      let steps = 8;\r\n      let t = 0.0, dt = 1.0/(steps - 1);\r\n\r\n      g.beginPath();\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        let t2 = Math.pow(t, this.sliderDisplayExp);\r\n\r\n        let x = t2*w;\r\n        g.moveTo(x, y);\r\n        g.lineTo(x, h - y);\r\n      }\r\n      g.stroke();\r\n    }\r\n\r\n    if (this.highlight === 1) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    //g.strokeStyle = color;\r\n    //g.stroke();\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    g.beginPath();\r\n\r\n    if (this.highlight === 2) {\r\n      color = this.getDefault(\"BoxHighlight\");\r\n    } else {\r\n      color = this.getDefault(\"border-color\");\r\n    }\r\n\r\n    g.arc(co[0], co[1], Math.abs(co[2]), -Math.PI, Math.PI);\r\n    g.fill();\r\n\r\n    g.strokeStyle = color;\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.setLineDash([4, 4]);\r\n\r\n    if (this._focus) {\r\n      g.strokeStyle = this.getDefault(\"BoxHighlight\");\r\n      g.arc(co[0], co[1], co[2] - 4, -Math.PI, Math.PI);\r\n      g.stroke();\r\n    }\r\n\r\n    g.setLineDash([]);\r\n  }\r\n\r\n  isOverButton(e) {\r\n    let x = e.x, y = e.y;\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (!rect) {\r\n      return false;\r\n    }\r\n\r\n    x -= rect.left;\r\n    y -= rect.top;\r\n\r\n    let co = this._getButtonPos();\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let dv = new Vector2([co[0]/dpi - x, co[1]/dpi - y]);\r\n    let dis = dv.vectorLength();\r\n\r\n    return dis < co[2]/dpi;\r\n  }\r\n\r\n  _invertButtonX(x) {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - boxw*0.5)/w2;\r\n    if (this.sliderDisplayExp) {\r\n      x = Math.max(x, 0.0);\r\n      x = Math.pow(x, 1.0/this.sliderDisplayExp);\r\n    }\r\n    x = x*(range[1] - range[0]) + range[0];\r\n\r\n    return x;\r\n  }\r\n\r\n  _getButtonPos() {\r\n    let w = this.canvas.width;\r\n    let dpi = UIBase.getDPI();\r\n    let sh = ~~(this.getDefault(\"SlideHeight\")*dpi + 0.5);\r\n    let x = this._value;\r\n\r\n    let range = this.uiRange || this.range;\r\n\r\n    x = (x - range[0])/(range[1] - range[0]);\r\n\r\n    if (this.sliderDisplayExp) {\r\n      x = Math.pow(x, this.sliderDisplayExp);\r\n    }\r\n\r\n    let boxw = this.canvas.height - 4;\r\n    let w2 = w - boxw;\r\n\r\n    x = x*w2 + boxw*0.5;\r\n\r\n    return [x, boxw*0.5, boxw*0.5];\r\n  }\r\n\r\n  setCSS() {\r\n    //UIBase.setCSS does annoying things with background-color\r\n    //super.setCSS();\r\n\r\n    const dpi = UIBase.getDPI();\r\n    this.style[\"min-width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n\r\n    this.canvas.style[\"width\"] = \"\" + (this.canvas.width/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = \"\" + (this.canvas.height/dpi) + \"px`\";\r\n\r\n    this.canvas.height = this.getDefault(\"height\")*UIBase.getDPI();\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    let rect = this.getClientRects()[0];\r\n\r\n    if (rect === undefined) {\r\n      return;\r\n    }\r\n\r\n    let dpi = UIBase.getDPI();\r\n    let canvas = this.canvas;\r\n    let w = ~~(rect.width*dpi), h = ~~(rect.height*dpi);\r\n\r\n    if (w !== canvas.width || h !== canvas.height) {\r\n      this.canvas.width = w;\r\n      this.canvas.height = h;\r\n\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (this.modalRunning) {\r\n      this.popModal();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    /*\r\n    if (this.checkThemeUpdate()) {\r\n      this._redraw();\r\n    }\r\n    */\r\n\r\n    let key = \"\" + this.getDefault(\"width\") + \":\" + this.getDefault(\"height\") + \":\" + this.getDefault(\"SlideHeight\");\r\n\r\n    if (key !== this._last_slider_key) {\r\n      this._last_slider_key = key;\r\n\r\n      this.flushUpdate();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n\r\n    if (this.getAttribute(\"tab-index\") !== this.tabIndex) {\r\n      this.tabIndex = this.getAttribute(\"tab-index\");\r\n    }\r\n\r\n    this.updateSize();\r\n    this.updateDataPath();\r\n    updateSliderFromDom(this);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimpleBase);\r\n\r\nexport class SliderWithTextbox extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._value = 0;\r\n    this._name = undefined;\r\n    this._lock_textbox = false;\r\n    this._labelOnTop = undefined;\r\n\r\n    this._last_label_on_top = undefined;\r\n\r\n    this.container = this;\r\n\r\n    this.textbox = UIBase.createElement(\"textbox-x\");\r\n    this.textbox.width = 55;\r\n    this._numslider = undefined;\r\n\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n    this.textbox.setAttribute(\"class\", \"numslider_simple_textbox\");\r\n    this.textbox.startSelected = true;\r\n\r\n    this._last_value = undefined;\r\n  }\r\n\r\n  get addLabel() {\r\n    if (this.hasAttribute(\"add-label\")) {\r\n      let val = (\"\" + this.getAttribute(\"add-label\")).toLowerCase();\r\n      return val === \"true\" || val === \"yes\";\r\n    }\r\n\r\n    return this.getDefault(\"addLabel\");\r\n  }\r\n\r\n  set addLabel(v) {\r\n    this.setAttribute(\"add-label\", v ? \"true\" : \"false\");\r\n\r\n    if (this.addLabel && !this.l) {\r\n      this.doOnce(this.rebuild);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * whether to put label on top or to the left of sliders\r\n   *\r\n   * If undefined value will be either this.getAtttribute(\"labelOnTop\"),\r\n   * if \"labelOnTop\" attribute exists, or it will be this.getDefault(\"labelOnTop\")\r\n   * (theme default)\r\n   **/\r\n  get labelOnTop() {\r\n    let ret = this._labelOnTop;\r\n\r\n    if (ret === undefined && this.hasAttribute(\"labelOnTop\")) {\r\n      let val = this.getAttribute(\"labelOnTop\");\r\n      if (typeof val === \"string\") {\r\n        val = val.toLowerCase();\r\n        ret = val === \"true\" || val === \"yes\";\r\n      } else {\r\n        ret = !!val;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      ret = this.getDefault(\"labelOnTop\");\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  set labelOnTop(v) {\r\n    this._labelOnTop = v;\r\n  }\r\n\r\n  get numslider() {\r\n    return this._numslider;\r\n  }\r\n\r\n  //child classes set this in their constructors\r\n  set numslider(v) {\r\n    this._numslider = v;\r\n    this.textbox.range = this._numslider.range;\r\n  }\r\n\r\n  get editAsBaseUnit() {\r\n    return this.numslider.editAsBaseUnit;\r\n  }\r\n\r\n  set editAsBaseUnit(v) {\r\n    this.numslider.editAsBaseUnit = v;\r\n  }\r\n\r\n  get range() {\r\n    return this.numslider.range;\r\n  }\r\n\r\n  set range(v) {\r\n    this.numslider.range = v;\r\n  }\r\n\r\n  get step() {\r\n    return this.numslider.step;\r\n  }\r\n\r\n  set step(v) {\r\n    this.numslider.step = v;\r\n  }\r\n\r\n  get expRate() {\r\n    return this.numslider.expRate;\r\n  }\r\n\r\n  set expRate(v) {\r\n    this.numslider.expRate = v;\r\n  }\r\n\r\n  get decimalPlaces() {\r\n    return this.numslider.decimalPlaces;\r\n  }\r\n\r\n  set decimalPlaces(v) {\r\n    this.numslider.decimalPlaces = v;\r\n  }\r\n\r\n  get isInt() {\r\n    return this.numslider.isInt;\r\n  }\r\n\r\n  set isInt(v) {\r\n    this.numslider.isInt = v;\r\n  }\r\n\r\n  get slideSpeed() {\r\n    return this.numslider.slideSpeed;\r\n  }\r\n\r\n  set slideSpeed(v) {\r\n    this.numslider.slideSpeed = v;\r\n  }\r\n\r\n  get sliderDisplayExp() {\r\n    return this.numslider.sliderDisplayExp;\r\n  }\r\n\r\n  set sliderDisplayExp(v) {\r\n    this.numslider.sliderDisplayExp = v;\r\n  }\r\n\r\n  get radix() {\r\n    return this.numslider.radix;\r\n  }\r\n\r\n  set radix(v) {\r\n    this.numslider.radix = v;\r\n  }\r\n\r\n  get stepIsRelative() {\r\n    return this.numslider.stepIsRelative;\r\n  }\r\n\r\n  set stepIsRelative(v) {\r\n    this.numslider.stepIsRelative = v;\r\n  }\r\n\r\n  get displayUnit() {\r\n    return this.numslider.displayUnit;\r\n  }\r\n\r\n  set displayUnit(val) {\r\n    let update = val !== this.displayUnit;\r\n\r\n    this.numslider.displayUnit = this.textbox.displayUnit = val;\r\n\r\n    if (update) {\r\n      //this.numslider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get baseUnit() {\r\n    return this.textbox.baseUnit;\r\n  }\r\n\r\n  set baseUnit(val) {\r\n    let update = val !== this.baseUnit;\r\n\r\n    this.numslider.baseUnit = this.textbox.baseUnit = val;\r\n\r\n    if (update) {\r\n      //this.slider._redraw();\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  get realTimeTextBox() {\r\n    let ret = this.getAttribute(\"realtime\");\r\n\r\n    if (!ret) {\r\n      return false;\r\n    }\r\n\r\n    ret = ret.toLowerCase().trim();\r\n\r\n    return ret === 'true' || ret === 'on' || ret === 'yes';\r\n  }\r\n\r\n  set realTimeTextBox(val) {\r\n    this.setAttribute(\"realtime\", val ? \"true\" : \"false\");\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this.setValue(val);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.rebuild();\r\n    window.setTimeout(() => this.updateTextBox(), 500);\r\n  }\r\n\r\n  rebuild() {\r\n    this._last_label_on_top = this.labelOnTop;\r\n\r\n    this.container.clear();\r\n\r\n    if (!this.labelOnTop) {\r\n      this.container = this.row();\r\n    } else {\r\n      this.container = this;\r\n    }\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      this._name = this.getAttribute(\"name\");\r\n    } else {\r\n      this._name = \"slider\";\r\n    }\r\n\r\n\r\n    if (this.addLabel) {\r\n      this.l = this.container.label(this._name);\r\n      this.l.overrideClass(\"numslider_textbox\");\r\n      this.l.font = \"TitleText\";\r\n      this.l.style[\"display\"] = \"float\";\r\n      this.l.style[\"position\"] = \"relative\";\r\n    }\r\n\r\n    let strip = this.container.row();\r\n    //strip.style['justify-content'] = 'space-between';\r\n    strip.add(this.numslider);\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let textbox = this.textbox;\r\n    this.textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    let apply_textbox = () => {\r\n      let text = textbox.text;\r\n\r\n      if (!units.isNumber(text)) {\r\n        textbox.flash(\"red\");\r\n        return;\r\n      } else {\r\n        textbox.flash(\"green\");\r\n\r\n        let displayUnit = this.editAsBaseUnit ? undefined : this.displayUnit;\r\n\r\n        let f = units.parseValue(text, this.baseUnit, displayUnit);\r\n\r\n        if (isNaN(f)) {\r\n          this.flash(\"red\");\r\n          return;\r\n        }\r\n\r\n        if (this.isInt) {\r\n          f = Math.floor(f);\r\n        }\r\n\r\n        this._lock_textbox = 1;\r\n        this.setValue(f);\r\n        this._lock_textbox = 0;\r\n\r\n      }\r\n    };\r\n\r\n    if (this.realTimeTextBox) {\r\n      textbox.onchange = apply_textbox;\r\n    }\r\n\r\n    textbox.onend = apply_textbox;\r\n\r\n    textbox.ctx = this.ctx;\r\n    textbox.packflag |= this.inherit_packflag;\r\n    textbox.overrideDefault(\"width\", this.getDefault(\"TextBoxWidth\"));\r\n\r\n    textbox.style[\"height\"] = (this.getDefault(\"height\") - 2) + \"px\";\r\n    textbox._init();\r\n\r\n    strip.add(textbox);\r\n\r\n    textbox.setCSS();\r\n    this.linkTextBox();\r\n\r\n    let in_onchange = 0;\r\n\r\n    this.numslider.onchange = (val) => {\r\n      this._value = this.numslider.value;\r\n      this.updateTextBox();\r\n\r\n      if (in_onchange) {\r\n        return;\r\n      }\r\n\r\n      if (this.onchange !== undefined) {\r\n        in_onchange++;\r\n        try {\r\n          if (this.onchange) {\r\n            this.onchange(this);\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n        }\r\n      }\r\n\r\n      in_onchange--;\r\n    }\r\n  }\r\n\r\n  updateTextBox() {\r\n    if (!this._init_done) {\r\n      return;\r\n    }\r\n\r\n    if (this._lock_textbox > 0 || this.textbox.editing)\r\n      return;\r\n\r\n    this.textbox.text = this.formatNumber(this._value);\r\n    this.textbox.update();\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n  }\r\n\r\n  linkTextBox() {\r\n    this.updateTextBox();\r\n\r\n    let onchange = this.numslider.onchange;\r\n    this.numslider.onchange = (e) => {\r\n      this._value = e.value;\r\n      this.updateTextBox();\r\n\r\n      onchange(e);\r\n    }\r\n  }\r\n\r\n  setValue(val, fire_onchange = true) {\r\n    this._value = val;\r\n    this.numslider.setValue(val, fire_onchange);\r\n    this.updateTextBox();\r\n  }\r\n\r\n  updateName() {\r\n    let name = this.getAttribute(\"name\");\r\n\r\n    if (!name && this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop) {\r\n        name = prop.uiname;\r\n      }\r\n    }\r\n\r\n    if (!name) {\r\n      name = \"[error]\";\r\n    }\r\n\r\n    if (name !== this._name) {\r\n      this._name = name;\r\n      if (this.l) {\r\n        this.l.text = name;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateLabelOnTop() {\r\n    if (this.labelOnTop !== this._last_label_on_top) {\r\n      this._last_label_on_top = this.labelOnTop;\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.ctx || !this.getAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"))\r\n\r\n    if (!prop) {\r\n      return;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n    if (val !== this._last_value) {\r\n      this._last_value = this._value = val;\r\n      this.updateTextBox();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateLabelOnTop();\r\n    super.update();\r\n\r\n    this.updateDataPath();\r\n    let redraw = false;\r\n\r\n    updateSliderFromDom(this, this.numslider);\r\n    updateSliderFromDom(this, this.textbox);\r\n\r\n    if (redraw) {\r\n      this.setCSS();\r\n      this.numslider.setCSS();\r\n      this.numslider._redraw();\r\n    }\r\n\r\n    this.updateName();\r\n\r\n    this.numslider.description = this.description;\r\n    this.textbox.description = this.title; //get full, transformed toolip\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.numslider.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n      this.textbox.setAttribute(\"datapath\", this.getAttribute(\"datapath\"));\r\n    }\r\n\r\n    if (this.hasAttribute(\"mass_set_path\")) {\r\n      this.numslider.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"))\r\n      this.textbox.setAttribute(\"mass_set_path\", this.getAttribute(\"mass_set_path\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n    this.textbox.setCSS();\r\n    //textbox.style[\"margin\"] = \"5px\";\r\n\r\n  }\r\n}\r\n\r\nexport class NumSliderSimple extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-simple-base-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-simple-x\",\r\n      style  : \"numslider_simple\"\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderSimple);\r\n\r\nexport class NumSliderWithTextBox extends SliderWithTextbox {\r\n  constructor() {\r\n    super();\r\n\r\n    this.numslider = UIBase.createElement(\"numslider-x\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"numslider-textbox-x\",\r\n      style  : \"numslider_textbox\"\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.hasAttribute(\"name\")) {\r\n      let name = this.getAttribute(\"name\");\r\n\r\n      if (name !== this.numslider.name) {\r\n        this.numslider.setAttribute(\"name\", name);\r\n        this.numslider._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    this.numslider._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(NumSliderWithTextBox);\r\n\r\n", "//stores xml sources\r\nimport {isNumber} from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet pagecache = new Map()\r\nimport {PackFlags, UIBase} from '../core/ui_base.js';\r\nimport {sliderDomAttributes} from '../widgets/ui_numsliders.js';\r\nimport * as util from '../util/util.js';\r\nimport {Menu} from '../widgets/ui_menu.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\n\r\nexport var domTransferAttrs = new Set([\"id\", \"title\", \"tab-index\"]);\r\nexport var domEventAttrs = new Set([\"click\", \"mousedown\", \"mouseup\", \"mousemove\", \"keydown\", \"keypress\"]);\r\n\r\nexport function parseXML(xml) {\r\n  let parser = new DOMParser()\r\n  xml = `<root>${xml}</root>`;\r\n  return parser.parseFromString(xml.trim(), \"application/xml\");\r\n}\r\n\r\nlet num_re = /[0-9]+$/;\r\n\r\nfunction getIconFlag(elem) {\r\n  if (!elem.hasAttribute(\"useIcons\")) {\r\n    return 0;\r\n  }\r\n\r\n  let attr = elem.getAttribute(\"useIcons\");\r\n\r\n  if (typeof attr === \"string\") {\r\n    attr = attr.toLowerCase().trim();\r\n  }\r\n\r\n  if (attr === \"false\" || attr === \"no\") {\r\n    return 0;\r\n  }\r\n\r\n  if (attr === \"true\" || attr === \"yes\") {\r\n    return PackFlags.USE_ICONS;\r\n  } else if (attr === \"small\") {\r\n    return PackFlags.SMALL_ICON | PackFlags.USE_ICONS;\r\n  } else if (attr === \"large\") {\r\n    return PackFlags.LARGE_ICON | PackFlags.USE_ICONS;\r\n  } else {\r\n    let isnum = typeof attr === \"number\";\r\n    let sheet = attr;\r\n\r\n    if (typeof sheet === \"string\" && sheet.search(num_re) === 0) {\r\n      sheet = parseInt(sheet);\r\n      isnum = true;\r\n    }\r\n\r\n    if (!isnum) {\r\n      return PackFlags.USE_ICONS;\r\n    }\r\n\r\n    let flag = PackFlags.USE_ICONS | PackFlags.CUSTOM_ICON_SHEET;\r\n    flag |= ((sheet - 1)<<PackFlags.CUSTOM_ICON_SHEET_START);\r\n\r\n    return flag;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nfunction getPackFlag(elem) {\r\n  let packflag = getIconFlag(elem);\r\n\r\n  if (elem.hasAttribute(\"drawChecks\")) {\r\n    if (!getbool(elem, \"drawChecks\")) {\r\n      packflag |= PackFlags.HIDE_CHECK_MARKS;\r\n    } else {\r\n      packflag &= ~PackFlags.HIDE_CHECK_MARKS;\r\n    }\r\n  }\r\n\r\n  if (getbool(elem, \"simpleSlider\")) {\r\n    packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n  }\r\n  if (getbool(elem, \"rollarSlider\")) {\r\n    packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n  }\r\n\r\n  return packflag;\r\n}\r\n\r\nfunction myParseFloat(s) {\r\n  s = '' + s;\r\n  s = s.trim().toLowerCase();\r\n\r\n  if (s.endsWith(\"px\")) {\r\n    s = s.slice(0, s.length - 2);\r\n  }\r\n\r\n  return parseFloat(s);\r\n}\r\n\r\nfunction getbool(elem, attr) {\r\n  let ret = elem.getAttribute(attr);\r\n  if (!ret) {\r\n    return false;\r\n  }\r\n\r\n  ret = ret.toLowerCase();\r\n  return ret === \"1\" || ret === \"true\" || ret === \"yes\";\r\n}\r\n\r\nfunction getfloat(elem, attr, defaultval) {\r\n  if (!elem.hasAttribute(attr)) {\r\n    return defaultval;\r\n  }\r\n\r\n  return myParseFloat(elem.getAttribute(attr));\r\n}\r\n\r\n/*\r\n**\r\n*\r\n* a customHandler can be a callback, or the string \"default\", e.g.\r\n*\r\n* xmlpage.customHandlers[\"homegig-element-x\"] = \"default\".\r\n*\r\n* The default case simply suppresses the warning that would otherwise\r\n* be printed to the console.\r\n* */\r\nexport const customHandlers = {};\r\n\r\nclass Handler {\r\n  constructor(ctx, container) {\r\n    this.container = container;\r\n    this.stack = [];\r\n    this.ctx = ctx;\r\n    this.codefuncs = {};\r\n\r\n    this.templateVars = {};\r\n\r\n    let attrs = util.list(sliderDomAttributes);\r\n\r\n    //note that useIcons, showLabel and sliderMode are PackFlag bits and are inherited through that system\r\n\r\n    this.inheritDomAttrs = {};\r\n    this.inheritDomAttrKeys = new Set(attrs);\r\n  }\r\n\r\n  push() {\r\n    this.stack.push(this.container);\r\n    this.stack.push(new Set(this.inheritDomAttrKeys));\r\n    this.stack.push(Object.assign({}, this.inheritDomAttrs));\r\n  }\r\n\r\n  pop() {\r\n    this.inheritDomAttrs = this.stack.pop();\r\n    this.inheritDomAttrKeys = this.stack.pop();\r\n    this.container = this.stack.pop();\r\n  }\r\n\r\n  handle(elem) {\r\n    if (elem.constructor === XMLDocument || elem.nodeName === 'root') {\r\n      for (let child of elem.childNodes) {\r\n        this.handle(child);\r\n      }\r\n\r\n      window.tree = elem\r\n      return;\r\n    } else if (elem.constructor === Text || elem.constructor === Comment) {\r\n      return;\r\n    }\r\n\r\n    let tagname = \"\" + elem.tagName;\r\n\r\n    if (tagname in customHandlers) {\r\n      customHandlers[tagname](this, elem);\r\n    } else if (this[tagname]) {\r\n      this[tagname](elem);\r\n    } else {\r\n      let elem2 = UIBase.createElement(tagname.toLowerCase());\r\n\r\n      window.__elem = elem;\r\n      //transfer DOM attributes\r\n      for (let k of elem.getAttributeNames()) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n\r\n      if (elem2 instanceof UIBase) {\r\n        if (!elem2.hasAttribute(\"datapath\") && elem2.hasAttribute(\"path\")) {\r\n          elem2.setAttribute(\"datapath\", elem2.getAttribute(\"path\"));\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"datapath\")) {\r\n          let path = elem2.getAttribute(\"datapath\");\r\n          path = this.container._joinPrefix(path);\r\n          elem2.setAttribute(\"datapath\", path);\r\n        }\r\n\r\n        if (elem2.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n          let massSetPath = \"\";\r\n\r\n          if (elem2.hasAttribute(\"massSetPath\")) {\r\n            massSetPath = elem2.getAttribute(\"massSetPath\");\r\n          }\r\n\r\n          let path = elem2.getAttribute(\"datapath\");\r\n\r\n          path = this.container._getMassPath(this.container.ctx, path, massSetPath);\r\n          elem2.setAttribute(\"massSetPath\", path);\r\n          elem2.setAttribute(\"mass_set_path\", path);\r\n        }\r\n\r\n        this.container.add(elem2);\r\n        this._style(elem, elem2);\r\n\r\n        if (elem2 instanceof Container) {\r\n          this.push();\r\n\r\n          this.container = elem2;\r\n          this._container(elem, elem2, true);\r\n          this.visit(elem);\r\n\r\n          this.pop();\r\n\r\n          return;\r\n        }\r\n      } else {\r\n        console.warn(\"Unknown element \" + elem.tagName + \" (\" + elem.constructor.name + \")\");\r\n        let elem2 = document.createElement(elem.tagName.toLowerCase());\r\n\r\n        for (let attr of elem.getAttributeNames()) {\r\n          elem2.setAttribute(attr, elem.getAttribute(attr));\r\n        }\r\n\r\n        this._basic(elem, elem2);\r\n\r\n        this.container.shadow.appendChild(elem2);\r\n\r\n        if (!(elem2 instanceof UIBase)) {\r\n          elem2.pathux_ctx = this.container.ctx;\r\n        } else {\r\n          elem2.ctx = this.container.ctx;\r\n        }\r\n      }\r\n\r\n      this.visit(elem);\r\n    }\r\n  }\r\n\r\n  _style(elem, elem2) {\r\n    let style = {};\r\n\r\n    //try to handle class attribute, at least somewhat\r\n\r\n    if (elem.hasAttribute(\"class\")) {\r\n      elem2.setAttribute(\"class\", elem.getAttribute(\"class\"));\r\n\r\n      let cls = elem2.getAttribute(\"class\").trim();\r\n      let keys = [\r\n        cls,\r\n        (elem2.tagName.toLowerCase() + \".\" + cls).trim(),\r\n        \"#\" + elem.getAttribute(\"id\").trim()\r\n      ];\r\n\r\n      for (let sheet of document.styleSheets) {\r\n        for (let rule of sheet.rules) {\r\n          for (let k of keys) {\r\n            if (rule.selectorText.trim() === k) {\r\n              for (let k2 of rule.styleMap.keys()) {\r\n                let val = rule.style[k2]\r\n\r\n                style[k2] = val;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"style\")) {\r\n      let stylecode = elem.getAttribute(\"style\");\r\n\r\n      stylecode = stylecode.split(\";\");\r\n\r\n      for (let row of stylecode) {\r\n        row = row.trim();\r\n\r\n        let i = row.search(/\\:/);\r\n        if (i >= 0) {\r\n          let key = row.slice(0, i).trim();\r\n          let val = row.slice(i + 1, row.length).trim();\r\n\r\n          style[key] = val;\r\n        }\r\n      }\r\n    }\r\n\r\n    let keys = Object.keys(style);\r\n    if (keys.length === 0) {\r\n      return;\r\n    }\r\n\r\n    function setStyle() {\r\n      for (let k of keys) {\r\n        elem2.style[k] = style[k];\r\n      }\r\n    }\r\n\r\n    if (elem2 instanceof UIBase) {\r\n      elem2.setCSS.after(() => {\r\n        setStyle();\r\n      });\r\n    }\r\n\r\n    setStyle();\r\n  }\r\n\r\n  visit(node) {\r\n    for (let child of node.childNodes) {\r\n      this.handle(child)\r\n    }\r\n  }\r\n\r\n  _getattr(elem, k) {\r\n    let val = elem.getAttribute(k);\r\n\r\n    if (!val) {\r\n      return val;\r\n    }\r\n\r\n    if (val.startsWith(\"##\")) {\r\n      val = val.slice(2, val.length).trim();\r\n\r\n      if (!(val in this.templateVars)) {\r\n        console.error(`unknown template variable '${val}'`);\r\n        val = '';\r\n      } else {\r\n        val = this.templateVars[val];\r\n      }\r\n    }\r\n\r\n    return val;\r\n  }\r\n\r\n  _basic(elem, elem2) {\r\n    this._style(elem, elem2);\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      if (k.startsWith(\"custom\")) {\r\n        elem2.setAttribute(k, this._getattr(elem, k));\r\n      }\r\n    }\r\n\r\n    let codeattrs = [];\r\n\r\n    for (let k of elem.getAttributeNames()) {\r\n      let val = \"\"+elem.getAttribute(k);\r\n\r\n      if (val.startsWith('ng[')) {\r\n        val = val.slice(3, val.endsWith(\"]\") ? val.length-1 : val.length);\r\n\r\n        codeattrs.push([k, \"ng\", val]);\r\n      }\r\n    }\r\n\r\n    for (let k of domEventAttrs) {\r\n      let k2 = 'on' + k;\r\n\r\n      if (elem.hasAttribute(k2)) {\r\n        codeattrs.push([k, \"dom\", elem.getAttribute(k2)]);\r\n      }\r\n    }\r\n\r\n    for (let [k, eventType, id] of codeattrs) {\r\n      if (!(id in this.codefuncs)) {\r\n        console.error(\"Unknown code fragment \" + id);\r\n        continue;\r\n      }\r\n\r\n      if (eventType === \"dom\") {\r\n        //click events usually don't go through normal\r\n        //dom event system\r\n        if (k === 'click') {\r\n          let onclick = elem2.onclick;\r\n          let func = this.codefuncs[id];\r\n\r\n          elem2.onclick = function () {\r\n            if (onclick) {\r\n              onclick.apply(this, arguments);\r\n            }\r\n\r\n            return func.apply(this, arguments);\r\n          }\r\n        } else {\r\n          elem2.addEventListener(k, this.codefuncs[id]);\r\n        }\r\n      } else if (eventType === \"ng\") {\r\n        elem2.addEventListener(k, this.codefuncs[id]);\r\n      }\r\n    }\r\n\r\n\r\n    for (let k of domTransferAttrs) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    for (let k in this.inheritDomAttrs) {\r\n      if (!elem.hasAttribute(k)) {\r\n        elem.setAttribute(k, this.inheritDomAttrs[k]);\r\n      }\r\n    }\r\n\r\n    for (let k of sliderDomAttributes) {\r\n      if (elem.hasAttribute(k)) {\r\n        elem2.setAttribute(k, elem.getAttribute(k));\r\n      }\r\n    }\r\n\r\n    if (!(elem2 instanceof UIBase)) {\r\n      return;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"theme-class\")) {\r\n      elem2.overrideClass(elem.getAttribute(\"theme-class\"));\r\n\r\n      if (elem2._init_done) {\r\n        elem2.setCSS();\r\n        elem2.flushUpdate();\r\n      }\r\n    }\r\n\r\n    if (elem.hasAttribute(\"useIcons\") && typeof elem2.useIcons === \"function\") {\r\n      let val = elem.getAttribute(\"useIcons\").trim().toLowerCase();\r\n\r\n      if (val === \"small\" || val === \"true\" || val === \"yes\") {\r\n        val = true;\r\n      } else if (val === \"large\") {\r\n        val = 1;\r\n      } else if (val === \"false\" || val === \"no\") {\r\n        val = false;\r\n      } else {\r\n        val = parseInt(val) - 1;\r\n      }\r\n\r\n      elem2.useIcons(val);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderTextBox\")) {\r\n      let textbox = getbool(elem, \"sliderTextBox\");\r\n\r\n      if (textbox) {\r\n        elem2.packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag &= ~PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      } else {\r\n        elem2.packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n        elem2.inherit_packflag |= PackFlags.NO_NUMSLIDER_TEXTBOX;\r\n      }\r\n\r\n      //console.error(\"textBox\", textbox, elem2, elem.getAttribute(\"sliderTextBox\"), elem2.packflag);\r\n    }\r\n\r\n    if (elem.hasAttribute(\"sliderMode\")) {\r\n      let sliderMode = elem.getAttribute(\"sliderMode\");\r\n\r\n      if (sliderMode === \"slider\") {\r\n        elem2.packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.SIMPLE_NUMSLIDERS;\r\n      } else if (sliderMode === \"roller\") {\r\n        elem2.packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n\r\n        elem2.inherit_packflag &= ~PackFlags.SIMPLE_NUMSLIDERS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      //console.error(\"sliderMode\", sliderMode, elem2, elem2.packflag & (PackFlags.SIMPLE_NUMSLIDERS | PackFlags.FORCE_ROLLER_SLIDER));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"showLabel\")) {\r\n      let state = getbool(elem, \"showLabel\");\r\n\r\n      if (state) {\r\n        elem2.packflag |= PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag |= PackFlags.FORCE_PROP_LABELS;\r\n      } else {\r\n        elem2.packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n        elem2.inherit_packflag &= ~PackFlags.FORCE_PROP_LABELS;\r\n      }\r\n    }\r\n\r\n    function doBox(key) {\r\n      if (elem.hasAttribute(key)) {\r\n        let val = elem.getAttribute(key).toLowerCase().trim();\r\n\r\n        if (val.endsWith(\"px\")) {\r\n          val = val.slice(0, val.length - 2).trim();\r\n        }\r\n\r\n        if (val.endsWith(\"%\")) {\r\n          //eek! don't support at all?\r\n          //or use aspect overlay?\r\n\r\n          console.warn(`Relative styling of '${key}' may be unstable for this element`, elem);\r\n\r\n          elem.setCSS.after(function () {\r\n            this.style[key] = val;\r\n          });\r\n        } else {\r\n          val = parseFloat(val);\r\n\r\n          if (isNaN(val) || typeof val !== \"number\") {\r\n            console.error(`Invalid style ${key}:${elem.getAttribute(key)}`);\r\n            return;\r\n          }\r\n\r\n          elem2.overrideDefault(key, val);\r\n          elem2.setCSS();\r\n          elem2.style[key] = \"\" + val + \"px\";\r\n        }\r\n      }\r\n    }\r\n\r\n    doBox(\"width\");\r\n    doBox(\"height\");\r\n    doBox(\"margin\");\r\n    doBox(\"padding\");\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      let key = i ? \"margin\" : \"padding\";\r\n\r\n      doBox(key + \"-bottom\");\r\n      doBox(key + \"-top\");\r\n      doBox(key + \"-left\");\r\n      doBox(key + \"-right\");\r\n    }\r\n  }\r\n\r\n  _handlePathPrefix(elem, con) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      let prefix = con.dataPrefix;\r\n      let path = elem.getAttribute(\"path\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.dataPrefix = prefix;\r\n    }\r\n\r\n    if (elem.hasAttribute(\"massSetPath\")) {\r\n      let prefix = con.massSetPrefix;\r\n      let path = elem.getAttribute(\"massSetPath\").trim();\r\n\r\n      if (prefix.length > 0) {\r\n        prefix += \".\";\r\n      }\r\n\r\n      prefix += path;\r\n      con.massSetPrefix = prefix;\r\n    }\r\n  }\r\n\r\n  _container(elem, con, ignorePathPrefix=false) {\r\n    for (let k of this.inheritDomAttrKeys) {\r\n      if (elem.hasAttribute(k)) {\r\n        this.inheritDomAttrs[k] = elem.getAttribute(k);\r\n      }\r\n    }\r\n\r\n    let packflag = getPackFlag(elem);\r\n\r\n    con.packflag |= packflag;\r\n    con.inherit_packflag |= packflag;\r\n\r\n    this._basic(elem, con);\r\n\r\n    if (!ignorePathPrefix) {\r\n      this._handlePathPrefix(elem, con);\r\n    }\r\n  }\r\n  noteframe(elem) {\r\n    let ret = this.container.noteframe();\r\n\r\n    if (ret) {\r\n      this._basic(elem, ret);\r\n    }\r\n  }\r\n\r\n  cell(elem) {\r\n    this.push();\r\n    this.container = this.container.cell();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  table(elem) {\r\n    this.push();\r\n    this.container = this.container.table();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  panel(elem) {\r\n    let title = \"\" + elem.getAttribute(\"label\")\r\n    let closed = getbool(elem, \"closed\")\r\n\r\n    this.push()\r\n    this.container = this.container.panel(title);\r\n    this.container.closed = closed;\r\n\r\n    this._container(elem, this.container);\r\n\r\n    this.visit(elem)\r\n\r\n    this.pop();\r\n  }\r\n\r\n  pathlabel(elem) {\r\n    this._prop(elem, \"pathlabel\")\r\n  }\r\n\r\n  /**\r\n   handle a code element, which are wrapped in functions\r\n   */\r\n  code(elem) {\r\n    window._codelem = elem;\r\n\r\n    let buf = '';\r\n\r\n    for (let elem2 of elem.childNodes) {\r\n      if (elem2.nodeName === \"#text\") {\r\n        buf += elem2.textContent + '\\n';\r\n      }\r\n    }\r\n\r\n    var func, $scope = this.templateScope;\r\n\r\n    buf = `\r\nfunc = function() {\r\n  ${buf};\r\n}\r\n    `;\r\n\r\n    eval(buf);\r\n\r\n    let id = \"\" + elem.getAttribute(\"id\");\r\n\r\n    this.codefuncs[id] = func;\r\n  }\r\n\r\n  textbox(elem) {\r\n    if (elem.hasAttribute(\"path\")) {\r\n      this._prop(elem, 'textbox');\r\n    } else {\r\n      //let elem2 = this.container.textbox();\r\n      //this._basic(elem, elem2);\r\n    }\r\n  }\r\n\r\n  label(elem) {\r\n    let elem2 = this.container.label(elem.innerHTML);\r\n    this._basic(elem, elem2);\r\n  }\r\n\r\n  colorfield(elem) {\r\n    this._prop(elem, \"colorfield\");\r\n  }\r\n\r\n  /** simpleSliders=true enables simple sliders */\r\n  prop(elem) {\r\n    this._prop(elem, \"prop\")\r\n  }\r\n\r\n  _prop(elem, key) {\r\n    let packflag = getPackFlag(elem);\r\n    let path = elem.getAttribute(\"path\");\r\n\r\n    let elem2;\r\n    if (key === 'pathlabel') {\r\n      elem2 = this.container.pathlabel(path, elem.innerHTML, packflag);\r\n    } else if (key === 'textbox') {\r\n      elem2 = this.container.textbox(path, undefined, undefined, packflag);\r\n\r\n      elem2.update();\r\n\r\n      //make textboxes non-modal by default\r\n      if (elem.hasAttribute(\"modal\")) {\r\n        elem2.setAttribute(\"modal\", elem.getAttribute(\"modal\"));\r\n      }\r\n\r\n      if (elem.hasAttribute(\"realtime\")) {\r\n        elem2.setAttribute(\"realtime\", elem.getAttribute(\"realtime\"));\r\n      }\r\n    } else if (key === \"colorfield\") {\r\n      elem2 = this.container.colorPicker(path, {\r\n        packflag,\r\n        themeOverride: elem.hasAttribute(\"theme-class\") ? elem.getAttribute(\"theme-class\") : undefined\r\n      });\r\n    } else {\r\n      elem2 = this.container[key](path, packflag);\r\n    }\r\n\r\n    if (!elem2) {\r\n      elem2 = document.createElement(\"span\");\r\n      elem2.innerHTML = \"error\";\r\n      this.container.shadow.appendChild(elem2);\r\n    } else {\r\n      this._basic(elem, elem2);\r\n\r\n      if (elem.hasAttribute(\"massSetPath\") || this.container.massSetPrefix) {\r\n        let mpath = elem.getAttribute(\"massSetPath\");\r\n        if (!mpath) {\r\n          mpath = elem.getAttribute(\"path\");\r\n        }\r\n\r\n        mpath = this.container._getMassPath(this.container.ctx, path, mpath);\r\n\r\n        elem2.setAttribute(\"mass_set_path\", mpath);\r\n      }\r\n    }\r\n  }\r\n\r\n  strip(elem) {\r\n    this.push();\r\n\r\n    let dir;\r\n    if (elem.hasAttribute(\"mode\")) {\r\n      dir = elem.getAttribute(\"mode\").toLowerCase().trim();\r\n      dir = dir === \"horizontal\";\r\n    }\r\n\r\n    let margin1 = getfloat(elem, \"margin1\", undefined);\r\n    let margin2 = getfloat(elem, \"margin2\", undefined);\r\n\r\n    this.container = this.container.strip(undefined, margin1, margin2, dir);\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  column(elem) {\r\n    this.push();\r\n    this.container = this.container.col();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  row(elem) {\r\n    this.push();\r\n    this.container = this.container.row();\r\n    this._container(elem, this.container);\r\n    this.visit(elem);\r\n    this.pop();\r\n  }\r\n\r\n  toolPanel(elem) {\r\n    this.tool(elem, \"toolPanel\");\r\n  }\r\n\r\n  tool(elem, key = \"tool\") {\r\n    let path = elem.getAttribute(\"path\");\r\n    let packflag = getPackFlag(elem);\r\n\r\n    let noIcons = false, iconflags;\r\n\r\n    if (getbool(elem, \"useIcons\")) {\r\n      packflag |= PackFlags.USE_ICONS;\r\n    } else if (elem.hasAttribute(\"useIcons\")) {\r\n      packflag &= ~PackFlags.USE_ICONS;\r\n      noIcons = true;\r\n    }\r\n\r\n    let label = (\"\" + elem.textContent).trim()\r\n    if (label.length > 0) {\r\n      path += \"|\" + label;\r\n    }\r\n\r\n    if (noIcons) {\r\n      iconflags = this.container.useIcons(false);\r\n    }\r\n\r\n    let elem2 = this.container[key](path, packflag);\r\n\r\n    if (elem2) {\r\n      this._basic(elem, elem2);\r\n    } else {\r\n      elem2 = document.createElement(\"strip\")\r\n      elem2.innerHTML = \"error\"\r\n      this.container.shadow.appendChild(elem2);\r\n      this._basic(elem, elem2);\r\n    }\r\n\r\n    if (noIcons) {\r\n      this.container.inherit_packflag |= iconflags;\r\n      this.container.packflag |= iconflags;\r\n    }\r\n  }\r\n\r\n  dropbox(elem) {\r\n    return this.menu(elem, true);\r\n  }\r\n\r\n  menu(elem, isDropBox = false) {\r\n    let packflag = getPackFlag(elem);\r\n    let title = elem.getAttribute(\"name\")\r\n\r\n    let list = [];\r\n\r\n    for (let child of elem.childNodes) {\r\n      if (child.tagName === \"tool\") {\r\n        let path = child.getAttribute(\"path\");\r\n        let label = child.innerHTML.trim();\r\n\r\n        if (label.length > 0) {\r\n          path += \"|\" + label;\r\n        }\r\n\r\n        list.push(path);\r\n      } else if (child.tagName === \"sep\") {\r\n        list.push(Menu.SEP);\r\n      } else if (child.tagName === \"item\") {\r\n        let id, icon, hotkey, description;\r\n\r\n        if (child.hasAttribute(\"id\")) {\r\n          id = child.getAttribute(\"id\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"icon\")) {\r\n          icon = child.getAttribute(\"icon\").toUpperCase().trim();\r\n          icon = Icons[icon];\r\n        }\r\n\r\n        if (child.hasAttribute(\"hotkey\")) {\r\n          hotkey = child.getAttribute(\"hotkey\");\r\n        }\r\n\r\n        if (child.hasAttribute(\"description\")) {\r\n          description = child.getAttribute(\"description\");\r\n        }\r\n\r\n        list.push({\r\n          name: child.innerHTML.trim(),\r\n          id, icon, hotkey, description\r\n        });\r\n      }\r\n    }\r\n\r\n    let ret = this.container.menu(title, list, packflag);\r\n    if (isDropBox) {\r\n      ret.removeAttribute(\"simple\");\r\n    }\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  button(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let ret = this.container.button(title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  iconbutton(elem) {\r\n    let title = elem.innerHTML.trim();\r\n\r\n    let icon = elem.getAttribute(\"icon\");\r\n    if (icon) {\r\n      icon = UIBase.getIconEnum()[icon];\r\n    }\r\n    let ret = this.container.iconbutton(icon, title);\r\n\r\n    if (elem.hasAttribute(\"id\")) {\r\n      ret.setAttribute(\"id\", elem.getAttribute(\"id\"));\r\n    }\r\n\r\n    this._basic(elem, ret);\r\n  }\r\n\r\n  tab(elem) {\r\n    this.push();\r\n\r\n    let title = \"\" + elem.getAttribute(\"label\");\r\n\r\n    let tabs = this.container;\r\n\r\n    this.container = this.container.tab(title);\r\n\r\n    if (elem.hasAttribute(\"overflow\")) {\r\n      this.container.setAttribute(\"overflow\", elem.getAttribute(\"overflow\"));\r\n    }\r\n\r\n    if (elem.hasAttribute(\"overflow-y\")) {\r\n      this.container.setAttribute(\"overflow-y\", elem.getAttribute(\"overflow-y\"));\r\n    }\r\n\r\n    this._container(elem, this.container)\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n\r\n  tabs(elem) {\r\n    let pos = elem.getAttribute(\"pos\") || \"left\"\r\n\r\n    this.push();\r\n\r\n    let tabs = this.container.tabs(pos)\r\n    this.container = tabs;\r\n\r\n    if (elem.hasAttribute(\"movable-tabs\")) {\r\n      tabs.setAttribute(\"movable-tabs\", elem.getAttribute(\"movable-tabs\"));\r\n    }\r\n\r\n    this._container(elem, tabs);\r\n    this.visit(elem);\r\n\r\n    this.pop();\r\n  }\r\n}\r\n\r\nexport function initPage(ctx, xml, parentContainer = undefined, templateVars = {}, templateScope = {}) {\r\n  let tree = parseXML(xml);\r\n  let container = UIBase.createElement(\"container-x\");\r\n\r\n  container.ctx = ctx;\r\n  if (ctx) {\r\n    container._init();\r\n  }\r\n\r\n  if (parentContainer) {\r\n    parentContainer.add(container);\r\n  }\r\n\r\n  let handler = new Handler(ctx, container);\r\n\r\n  handler.templateVars = Object.assign({}, templateVars);\r\n  handler.templateScope = templateScope;\r\n\r\n  handler.handle(tree);\r\n\r\n  return container;\r\n\r\n}\r\n\r\nexport function loadPage(ctx, url, parentContainer_or_args = undefined, loadSourceOnly = false,\r\n                         modifySourceCB, templateVars, templateScope) {\r\n  let source;\r\n  let parentContainer;\r\n\r\n  if (parentContainer_or_args !== undefined && !(parentContainer_or_args instanceof HTMLElement)) {\r\n    let args = parentContainer_or_args;\r\n\r\n    parentContainer = args.parentContainer;\r\n    loadSourceOnly = args.loadSourceOnly;\r\n    modifySourceCB = args.modifySourceCB;\r\n    templateVars = args.templateVars;\r\n    templateScope = args.templateScope;\r\n  } else {\r\n    parentContainer = parentContainer_or_args;\r\n  }\r\n\r\n  if (pagecache.has(url)) {\r\n    source = pagecache.get(url);\r\n\r\n    if (modifySourceCB) {\r\n      source = modifySourceCB(source);\r\n    }\r\n\r\n    return new Promise((accept, reject) => {\r\n      if (loadSourceOnly) {\r\n        accept(source);\r\n      } else {\r\n        accept(initPage(ctx, source, parentContainer, templateVars, templateScope));\r\n      }\r\n    });\r\n  } else {\r\n    return new Promise((accept, reject) => {\r\n      fetch(url).then(res => res.text()).then(data => {\r\n        pagecache.set(url, data);\r\n\r\n        if (modifySourceCB) {\r\n          data = modifySourceCB(data);\r\n        }\r\n\r\n        if (loadSourceOnly) {\r\n          accept(data);\r\n        } else {\r\n          accept(initPage(ctx, data, parentContainer, templateVars, templateScope));\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n", "import {CurveConstructors} from \"./curve1d_base.js\";\r\nimport {EnumProperty} from \"../toolsys/toolprop.js\";\r\n\r\nexport function makeGenEnum() {\r\n  let enumdef = {};\r\n  let uinames = {};\r\n  let icons = {};\r\n\r\n  for (let cls of CurveConstructors) {\r\n    let def = cls.define();\r\n\r\n    let uiname = def.uiname;\r\n    uiname = uiname === undefined ? def.name : uiname;\r\n\r\n    enumdef[def.name] = cls.name;\r\n    uinames[def.name] = uiname;\r\n    icons[def.name] = def.icon !== undefined ? def.icon : -1;\r\n  }\r\n\r\n  //return enumdef;\r\n  return new EnumProperty(undefined, enumdef).addUINames(uinames).addIcons(icons);\r\n}\r\n", "import {UIBase, Icons, saveUIData, loadUIData} from '../core/ui_base.js';\r\nimport {ColumnFrame, RowFrame} from \"../core/ui.js\";\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {Vector2, Vector3} from \"../path-controller/util/vectormath.js\";\r\nimport {Curve1D, mySafeJSONStringify} from \"../path-controller/curve/curve1d.js\";\r\nimport {makeGenEnum} from '../path-controller/curve/curve1d_utils.js';\r\n\r\nexport class Curve1DWidget extends ColumnFrame {\r\n  #in_onchange = false;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.useDataPathUndo = false;\r\n\r\n    this._on_draw = this._on_draw.bind(this);\r\n    this.drawTransform = [1.0, [0, 0]];\r\n\r\n    this._value = new Curve1D();\r\n    this.checkCurve1dEvents();\r\n\r\n    this.#in_onchange = 0;\r\n\r\n    this._value._on_change = (msg) => {\r\n      if (this.#in_onchange) {\r\n        return;\r\n      }\r\n\r\n      /* Prevent infinite recursion. */\r\n      this.#in_onchange++;\r\n\r\n      try {\r\n        if (this.hasAttribute(\"datapath\")) {\r\n          let path = this.getAttribute(\"datapath\");\r\n          if (this._value !== undefined) {\r\n            let val = this.getPathValue(this.ctx, path);\r\n\r\n            if (val) {\r\n              val.load(this._value);\r\n              this.setPathValue(this.ctx, path, val);\r\n            } else {\r\n              val = this._value.copy();\r\n              this.setPathValue(this.ctx, path, val);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (this.onchange) {\r\n          this.onchange(this._value);\r\n        }\r\n      } catch (error) {\r\n        if (window.DEBUG && window.DEBUG.datapath) {\r\n          console.error(error.stack);\r\n          console.error(error.message);\r\n        }\r\n      }\r\n\r\n      this.#in_onchange--;\r\n\r\n      if (this.#in_onchange < 0) {\r\n        console.warn(\"this.#in_onchange was negative\");\r\n        this.#in_onchange = 0;\r\n      }\r\n    };\r\n\r\n    this._gen_type = undefined;\r\n    this._lastGen = undefined;\r\n\r\n    this._last_dpi = undefined;\r\n    this.canvas = document.createElement(\"canvas\");\r\n\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.canvas.g = this.g;\r\n\r\n    window.cw = this;\r\n    this.shadow.appendChild(this.canvas);\r\n  }\r\n\r\n  /**\r\n   * Checks if a curve1d instance exists at dom attribute \"datapath\"\r\n   * and if it does adds curve1d event handlers to it.\r\n   *\r\n   * Note: it's impossible to know for sure that a widget is truly dead,\r\n   * e.g. it could be hidden in a panel or something.  Curve1d's event\r\n   * handling system takes a callback that checks if a callback should\r\n   * be removed, which we provide by testing this.isConnected.\r\n   *\r\n   * Since this is not robust we have to check regularly if we need to add\r\n   * Curve1D event handlers, which is why this function exists.\r\n   */\r\n  checkCurve1dEvents() {\r\n    if (!this._value.subscribed(\"draw\", this)) {\r\n      this._value.on(\"draw\", this._on_draw, this, () => !this.isConnected);\r\n    }\r\n\r\n    if (this.ctx && this.hasAttribute(\"datapath\")) {\r\n      let curve1d;\r\n\r\n      try {\r\n        curve1d = this.ctx.api.getValue(this.ctx, this.getAttribute(\"datapath\"));\r\n      } catch (error) {\r\n        if (window.DEBUG && window.DEBUG.datapath) {\r\n          console.error(error.stack);\r\n          console.error(error.message);\r\n        }\r\n      }\r\n\r\n      if (!curve1d) {\r\n        this.disabled = true;\r\n        return;\r\n      }\r\n\r\n      if (this.disabled) {\r\n        this.disabled = false;\r\n      }\r\n\r\n      if (!curve1d.subscribed(undefined, this)) {\r\n        curve1d.on(\"select\", (bspline1) => {\r\n          let bspline2 = this._value.getGenerator(\"BSplineCurve\");\r\n\r\n          for (let i = 0; i < bspline1.points.length; i++) {\r\n            if (i >= bspline2.length) {\r\n              break;\r\n            }\r\n            bspline2.points[i].flag = bspline1.points[i].flag;\r\n          }\r\n\r\n          bspline2.redraw();\r\n        });\r\n\r\n        curve1d.on(\"transform\", (bspline1) => {\r\n          let bspline2 = this._value.getGenerator(\"BSplineCurve\");\r\n\r\n          for (let i = 0; i < bspline1.points.length; i++) {\r\n            if (i >= bspline2.length) {\r\n              break;\r\n            }\r\n            bspline2.points[i].co.load(bspline1.points[i].co);\r\n          }\r\n\r\n          bspline2.update();\r\n          bspline2.updateKnots();\r\n          bspline2.redraw();\r\n        });\r\n\r\n        curve1d.on(\"update\", () => {\r\n          console.log(\"datapath curve1d update!\");\r\n          this._value.load(curve1d);\r\n          this.rebuild();\r\n        }, this, () => !this.isConnected);\r\n      }\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  _on_draw(e) {\r\n    let curve = e.data;\r\n\r\n    //console.log(\"draw\");\r\n    this._redraw();\r\n  }\r\n\r\n  set value(val) {\r\n    this._value.load(val);\r\n    this.update();\r\n    this._redraw();\r\n  }\r\n\r\n  _on_change() {\r\n    if (this.onchange) {\r\n      this.onchange(this);\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    let row = this.row();\r\n\r\n    let prop = makeGenEnum();\r\n\r\n    prop.setValue(this.value.generatorType);\r\n\r\n    this.dropbox = row.listenum(undefined, \"Type\", prop, this.value.generatorType, (id) => {\r\n      console.warn(\"SELECT\", id, prop.keys[id]);\r\n\r\n      this.value.setGenerator(id);\r\n      this.value._on_change(\"curve type change\");\r\n    });\r\n    this.dropbox._init();\r\n\r\n    row.iconbutton(Icons.ZOOM_OUT, \"Zoom Out\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 0.9;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n    }).iconsheet = 0;\r\n    row.iconbutton(Icons.ZOOM_IN, \"Zoom In\", () => {\r\n      let curve = this._value;\r\n      if (!curve) return;\r\n      //if (isNaN(curve.uiZoom))\r\n      //  curve.uiZoom = 1.0;\r\n\r\n      curve.uiZoom *= 1.1;\r\n      if (this.getAttribute(\"datapath\")) {\r\n        this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), curve);\r\n      }\r\n\r\n      this._redraw();\r\n\r\n    }).iconsheet = 0;\r\n\r\n    this.container = this.col();\r\n\r\n    let panel = this.panel(\"Range\");\r\n\r\n    let clipCheck = panel.check(undefined, \"Clip To Range\");\r\n    clipCheck.onchange = (val) => {\r\n      this._value.clipToRange = val;\r\n      this._on_change();\r\n      this._redraw();\r\n    }\r\n    clipCheck.checked = this._value.clipToRange;\r\n\r\n    let xmin = panel.slider(undefined, \"X Min\", this._value.xRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let xmax = panel.slider(undefined, \"X Max\", this._value.xRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.xRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymin = panel.slider(undefined, \"Y Min\", this._value.yRange[0], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[0] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let ymax = panel.slider(undefined, \"Y Max\", this._value.yRange[1], -10, 10, 0.1, false, undefined, (val) => {\r\n      this._value.yRange[1] = val.value;\r\n      this._on_change();\r\n      this._redraw();\r\n    });\r\n\r\n    let last_update_key = \"\";\r\n    this.container.update.after(() => {\r\n      const xRange = this._value.xRange;\r\n      const yRange = this._value.yRange;\r\n      let key = \"\" + xRange[0] + \":\" + xRange[1]\r\n        + \":\" + yRange[0] + \":\" + yRange[1] + \":\" + this._value.clipToRange;\r\n\r\n      clipCheck.checked = this._value.clipToRange;\r\n\r\n      if (key !== last_update_key) {\r\n        last_update_key = key;\r\n\r\n        xmin.setValue(xRange[0]);\r\n        xmax.setValue(xRange[1]);\r\n\r\n        ymin.setValue(yRange[0]);\r\n        ymax.setValue(yRange[1]);\r\n      }\r\n    });\r\n\r\n    xmin.displayUnit = xmin.baseUnit = \"none\";\r\n    ymin.displayUnit = ymin.baseUnit = \"none\";\r\n    xmax.displayUnit = xmax.baseUnit = \"none\";\r\n    ymax.displayUnit = ymax.baseUnit = \"none\";\r\n\r\n    panel.closed = false;\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"width\"] = \"min-contents\";\r\n    this.style[\"height\"] = \"min-contents\";\r\n    this.updateSize();\r\n  }\r\n\r\n  updateSize() {\r\n    let dpi = UIBase.getDPI();\r\n    let w = ~~(this.getDefault(\"CanvasWidth\")*dpi);\r\n    let h = ~~(this.getDefault(\"CanvasHeight\")*dpi);\r\n\r\n    let bad = w !== this.canvas.width || h !== this.canvas.height;\r\n    bad = bad || dpi !== this._last_dpi;\r\n\r\n    if (!bad) {\r\n      return;\r\n    }\r\n\r\n    this._last_dpi = dpi;\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.canvas.style[\"width\"] = (w/dpi) + \"px\";\r\n    this.canvas.style[\"height\"] = (h/dpi) + \"px\";\r\n\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    //forcibly clear canvas, works better then clearRect\r\n    this.canvas.width = this.canvas.width;\r\n    this.canvas.height = this.canvas.height;\r\n\r\n    let canvas = this.canvas, g = this.g;\r\n\r\n    //g.clearRect(0, 0, canvas.width, canvas.height);\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = this.getDefault(\"CanvasBG\");\r\n    g.fill();\r\n\r\n    g.save();\r\n\r\n    let zoom = this._value.uiZoom;\r\n    let scale = Math.max(canvas.width, canvas.height);\r\n\r\n    g.lineWidth /= scale;\r\n\r\n    this.drawTransform[0] = scale*zoom;\r\n    this.drawTransform[1][0] = 0.0;\r\n    this.drawTransform[1][1] = -1.0;\r\n\r\n    this.drawTransform[1][0] -= 0.5 - 0.5/zoom;\r\n    this.drawTransform[1][1] += 0.5 - 0.5/zoom;\r\n\r\n    //g.scale(scale, scale);\r\n\r\n    g.scale(this.drawTransform[0], -this.drawTransform[0]);\r\n    g.translate(this.drawTransform[1][0], this.drawTransform[1][1]);\r\n\r\n    g.lineWidth /= zoom;\r\n\r\n    this._value.draw(this.canvas, this.g, this.drawTransform);\r\n    g.restore();\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined || this.container === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.checkCurve1dEvents();\r\n\r\n    let uidata = saveUIData(this.container, \"curve1d\");\r\n\r\n    this._gen_type = this.value.generatorType;\r\n    let col = this.container;\r\n\r\n    if (this._lastGen !== undefined) {\r\n      this._lastGen.killGUI(col, this.canvas);\r\n    }\r\n\r\n    let onchange = this.dropbox.onchange;\r\n    this.dropbox.onchange = undefined\r\n    this.dropbox.setValue(this.value.generatorType);\r\n    this.dropbox.onchange = onchange;\r\n\r\n    col.clear();\r\n\r\n    let onSourceUpdate = () => {\r\n      if (!this.hasAttribute(\"datapath\")) {\r\n        return;\r\n      }\r\n\r\n      let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n      this._value.load(val);\r\n      this.rebuild();\r\n    };\r\n\r\n    let dpath = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n    let gen = this.value.generators.active;\r\n\r\n    /* Turn off data path callbacks. */\r\n    this.#in_onchange++;\r\n    try {\r\n      gen.makeGUI(col, this.canvas, this.drawTransform, dpath, onSourceUpdate);\r\n\r\n      loadUIData(this.container, uidata);\r\n      for (let i = 0; i < 4; i++) {\r\n        col.flushUpdate();\r\n      }\r\n    } catch (error) {\r\n      console.warn(error.stack);\r\n      console.warn(error.message);\r\n    }\r\n\r\n    this.#in_onchange--;\r\n\r\n    this._lastGen = gen;\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (this._lastu === undefined) {\r\n      this._lastu = 0;\r\n    }\r\n\r\n    if (val && !val.equals(this._value) && util.time_ms() - this._lastu > 200) {\r\n      this._lastu = util.time_ms();\r\n\r\n      this._value.load(val);\r\n      this.update();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateGenUI() {\r\n    let bad = this._lastGen !== this.value.generators.active;\r\n\r\n    if (bad) {\r\n      this.rebuild();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.checkCurve1dEvents();\r\n    this.updateDataPath();\r\n    this.updateSize();\r\n    this.updateGenUI();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"curve-widget-x\",\r\n      style  : \"curvewidget\"\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(Curve1DWidget);\r\n", "//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {CSSFont} from \"../core/ui_base.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\nimport '../path-controller/util/html5_fileapi.js';\r\nimport {ColumnFrame, RowFrame, Container} from \"../core/ui.js\";\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2   = vectormath.Vector2,\r\n    UIBase    = ui_base.UIBase,\r\n    PackFlags = ui_base.PackFlags,\r\n    PropTypes = toolprop.PropTypes;\r\n\r\n\r\n//methods to forward to this.contents\r\nlet forward_keys = new Set([\r\n  \"row\", \"col\", \"strip\", \"noteframe\", \"helppicker\", \"vecpopup\",\r\n  \"tabs\", \"table\", \"menu\", \"listbox\", \"panel\",\r\n  \"pathlabel\", \"label\", \"listenum\", \"check\", \"iconcheck\",\r\n  \"button\", \"iconbutton\", \"colorPicker\", \"twocol\",\r\n  \"treeview\", \"slider\", \"simpleslider\", \"curve1d\",\r\n  \"noteframe\", \"vecpopup\",\r\n  \"prop\", \"tool\", \"toolPanel\", \"textbox\", \"dynamicMenu\",\r\n  \"add\", \"prepend\", \"useIcons\", \"noMarginsOrPadding\", \"wrap\"\r\n]);\r\n\r\nexport class PanelFrame extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.titleframe = super.row();\r\n\r\n    this.contents = super.col();\r\n    this.contents._remove = this.contents.remove;\r\n    this.contents.remove = () => {\r\n      this.remove();\r\n    };\r\n\r\n    this._panel = this; //compatibility alias\r\n\r\n    this.contents._panel = this;\r\n    this.iconcheck = UIBase.createElement(\"iconcheck-x\");\r\n    this.iconcheck.noEmboss = true;\r\n\r\n    Object.defineProperty(this.contents, \"closed\", {\r\n      get: () => {\r\n        return this.closed;\r\n      },\r\n\r\n      set: (v) => {\r\n        this.closed = v;\r\n      }\r\n    })\r\n\r\n    Object.defineProperty(this.contents, \"title\", {\r\n      get: () => this.titleframe.getAttribute(\"title\"),\r\n      set: (v) => this.setHeaderToolTip(v)\r\n    });\r\n\r\n    this.packflag = this.inherit_packflag = 0;\r\n\r\n    this._closed = false;\r\n\r\n    this.makeHeader();\r\n  }\r\n\r\n  get inherit_packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.inherit_packflag;\r\n  }\r\n\r\n  set inherit_packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.inherit_packflag = val;\r\n  }\r\n\r\n  get packflag() {\r\n    if (!this.contents) return;\r\n    return this.contents.packflag;\r\n  }\r\n\r\n  set packflag(val) {\r\n    if (!this.contents) return;\r\n    this.contents.packflag = val;\r\n  }\r\n\r\n  appendChild(child) {\r\n    return this.contents.shadow.appendChild(child);\r\n  }\r\n\r\n  get headerLabel() {\r\n    return this.__label.text;\r\n  }\r\n\r\n  set headerLabel(v) {\r\n    this.__label.text = v;\r\n    this.__label._updateFont();\r\n\r\n    if (this.hasAttribute(\"label\")) {\r\n      this.setAttribute(\"label\", v);\r\n    }\r\n\r\n    if (this.ctx) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  get dataPrefix() {\r\n    return this.contents ? this.contents.dataPrefix : \"\";\r\n  }\r\n\r\n  set dataPrefix(v) {\r\n    if (this.contents) {\r\n      this.contents.dataPrefix = v;\r\n    }\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    let update = !!val !== !!this.closed;\r\n    this._closed = val;\r\n\r\n    //console.log(\"closed set\", update);\r\n    if (update) {\r\n      this._updateClosed(true);\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"panelframe-x\",\r\n      style              : \"panel\",\r\n      subclassChecksTheme: true\r\n    };\r\n  }\r\n\r\n  setHeaderToolTip(tooltip) {\r\n    this.titleframe.setAttribute(\"title\", tooltip);\r\n\r\n    this.titleframe._forEachChildWidget((child) => {\r\n      child.setAttribute(\"title\", tooltip);\r\n    });\r\n  }\r\n\r\n  saveData() {\r\n    let ret = {\r\n      closed: this._closed\r\n    };\r\n\r\n    return Object.assign(super.saveData(), ret);\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!(\"closed\" in obj)) {\r\n      this.closed = obj._closed;\r\n    } else {\r\n      this.closed = obj.closed;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.contents.clear();\r\n    return this;\r\n  }\r\n\r\n  makeHeader() {\r\n    let row = this.titleframe;\r\n\r\n    let iconcheck = this.iconcheck;\r\n\r\n    if (!iconcheck) {\r\n      return;\r\n    }\r\n\r\n    iconcheck.overrideDefault(\"padding\", 0);\r\n\r\n    iconcheck.noMarginsOrPadding();\r\n\r\n    iconcheck.overrideDefault(\"highlight\", {\r\n      \"background-color\" : iconcheck.getSubDefault(\"highlight\", \"background-color\")\r\n    });\r\n\r\n    iconcheck.overrideDefault(\"background-color\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"BoxDepressed\", \"rgba(0,0,0,0)\");\r\n    iconcheck.overrideDefault(\"border-color\", \"rgba(0,0,0,0)\");\r\n\r\n    iconcheck.ctx = this.ctx;\r\n    iconcheck._icon_pressed = ui_base.Icons.UI_EXPAND;\r\n    iconcheck._icon = ui_base.Icons.UI_COLLAPSE;\r\n    iconcheck.drawCheck = false;\r\n    iconcheck.iconsheet = ui_base.IconSheets.SMALL;\r\n    iconcheck.checked = this._closed;\r\n\r\n    this.iconcheck.onchange = (e) => {\r\n      this.closed = this.iconcheck.checked;\r\n    };\r\n\r\n    row._add(iconcheck);\r\n\r\n    //stupid css, let's just hackishly put \" \" to create spacing2\r\n\r\n    let onclick = (e) => {\r\n      iconcheck.checked = !iconcheck.checked;\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n    };\r\n\r\n    let label = this.__label = row.label(this.getAttribute(\"label\"));\r\n\r\n    this.__label.font = \"TitleText\";\r\n\r\n    label._updateFont();\r\n\r\n    label.noMarginsOrPadding();\r\n    label.addEventListener(\"mousedown\", onclick);\r\n    label.addEventListener(\"touchdown\", onclick);\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    row.background = this.getDefault(\"TitleBackground\");\r\n    row.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n    row.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n\r\n    row.style[\"padding-right\"] = \"20px\";\r\n    row.style[\"padding-left\"] = \"5px\";\r\n    row.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    row.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this.style[\"width\"] = \"100%\";\r\n\r\n    this.contents.ctx = this.ctx;\r\n    if (!this._closed) {\r\n      super.add(this.contents);\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.dataPrefix = this.dataPrefix;\r\n\r\n    //con.style[\"margin-left\"] = \"5px\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    if (!this.titleframe || !this.__label) {\r\n      return;\r\n    }\r\n\r\n    let getDefault = (key, defval) => {\r\n      let val = this.getDefault(key);\r\n      return val !== undefined ? val : defval;\r\n    };\r\n\r\n    let bs = this.getDefault(\"border-style\");\r\n\r\n    let header_radius = this.getDefault(\"HeaderRadius\");\r\n    if (header_radius === undefined) {\r\n      header_radius = this.getDefault(\"border-radius\");\r\n    }\r\n\r\n    let boxmargin = getDefault(\"padding\", 0);\r\n\r\n    let paddingleft = getDefault(\"padding-left\", 0);\r\n    let paddingright = getDefault(\"padding-right\", 0);\r\n\r\n    paddingleft += boxmargin;\r\n    paddingright += boxmargin;\r\n\r\n    this.titleframe.background = this.getDefault(\"TitleBackground\");\r\n    this.titleframe.style[\"border-radius\"] = header_radius + \"px\";\r\n    this.titleframe.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"TitleBorder\")}`;\r\n    this.style[\"border\"] = `${this.getDefault(\"border-width\")}px ${bs} ${this.getDefault(\"border-color\")}`;\r\n    this.style[\"border-radius\"] = this.getDefault(\"border-radius\") + \"px\";\r\n\r\n    this.titleframe.style[\"padding-top\"] = this.getDefault(\"padding-top\") + \"px\";\r\n    this.titleframe.style[\"padding-bottom\"] = this.getDefault(\"padding-bottom\") + \"px\";\r\n    this.titleframe.style[\"padding-left\"] = paddingleft + \"px\";\r\n    this.titleframe.style[\"padding-right\"] = paddingright + \"px\";\r\n    this.titleframe.style[\"margin-bottom\"] = \"0px\";\r\n    this.titleframe.style[\"margin-top\"] = \"0px\";\r\n\r\n    this.__label.style[\"border\"] = \"unset\";\r\n    this.__label.style[\"border-radius\"] = \"unset\";\r\n\r\n    let bg = this.getDefault(\"background-color\");\r\n\r\n    this.background = bg;\r\n    this.contents.background = bg;\r\n    this.contents.parentWidget = this;\r\n    this.contents.style[\"background-color\"] = bg;\r\n    this.style[\"background-color\"] = bg;\r\n\r\n    let margintop, marginbottom;\r\n\r\n    if (this._closed) {\r\n      margintop = getDefault('margin-top-closed', 0);\r\n      marginbottom = getDefault('margin-bottom-closed', 5);\r\n    } else {\r\n      margintop = getDefault('margin-top', 0);\r\n      marginbottom = getDefault('margin-bottom', 0);\r\n    }\r\n\r\n    let marginleft = getDefault('margin-left', 0);\r\n    let marginright = getDefault('margin-right', 0);\r\n\r\n    this.style['margin-left'] = marginleft + \"px\";\r\n    this.style['margin-right'] = marginright + \"px\";\r\n\r\n    this.style['margin-top'] = margintop + \"px\";\r\n    this.style['margin-bottom'] = marginbottom + \"px\";\r\n\r\n    //this.style[\"padding-left\"] = paddingleft + \"px\";\r\n    //this.style[\"padding-right\"] = paddingright + \"px\";\r\n\r\n    this.__label._updateFont();\r\n  }\r\n\r\n  on_disabled() {\r\n    super.on_disabled();\r\n\r\n    this.__label._updateFont();\r\n    this.setCSS();\r\n  }\r\n\r\n  on_enabled() {\r\n    super.on_enabled();\r\n\r\n    this.__label.setCSS();\r\n    this.__label.style[\"color\"] = this.style[\"color\"];\r\n    this.setCSS();\r\n  }\r\n\r\n  update() {\r\n    let text = this.getAttribute(\"label\");\r\n\r\n    let update = text !== this.__label.text;\r\n\r\n    if (this.checkThemeUpdate()) {\r\n      update = true;\r\n      this._setVisible(this.closed, true);\r\n      this.setCSS();\r\n      this.flushSetCSS();\r\n    }\r\n\r\n    if (update) {\r\n      this.headerLabel = this.getAttribute(\"label\")\r\n\r\n      this.__label._updateFont();\r\n      this.setCSS();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _onchange(isClosed) {\r\n    if (this.onchange) {\r\n      this.onchange(isClosed);\r\n    }\r\n\r\n    if (this.contents.onchange) {\r\n      this.contents.onchange(isClosed);\r\n    }\r\n  }\r\n\r\n  //catch setAttribute so we can detect label update\r\n  //even if close and updates disabled\r\n  setAttribute(key, value) {\r\n    let ret = super.setAttribute(key, value);\r\n\r\n    if (this.ctx) {\r\n      this.update();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  get noUpdateClosedContents() {\r\n    if (!this.hasAttribute(\"update-closed-contents\")) {\r\n      return false;\r\n    }\r\n\r\n    let ret = this.getAttribute(\"update-closed-contents\");\r\n    return ret === \"true\" || ret === \"on\";\r\n  }\r\n\r\n  set noUpdateClosedContents(v) {\r\n    this.setAttribute(\"update-closed-contents\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  _setVisible(isClosed, changed) {\r\n    changed = changed || !!isClosed !== !!this._closed;\r\n\r\n    this._state = isClosed;\r\n\r\n    if (isClosed) {\r\n      this.contents.style.display = \"none\";\r\n\r\n      //this.contents._remove();\r\n      //this.contents.hide(true);\r\n      if (!this.noUpdateClosedContents) {\r\n        this.contents.packflag |= PackFlags.NO_UPDATE;\r\n      }\r\n    } else {\r\n      //this.contents.hide(false);\r\n      this.contents.style.display = \"flex\";\r\n      this.contents.packflag &= ~PackFlags.NO_UPDATE;\r\n      this.contents.flushUpdate();\r\n    }\r\n\r\n    this.contents.hidden = isClosed;\r\n\r\n    if (this.parentWidget) {\r\n      this.parentWidget.flushUpdate();\r\n    } else {\r\n      this.flushUpdate();\r\n    }\r\n\r\n    if (changed) {\r\n      this._onchange(isClosed);\r\n    }\r\n\r\n    /*\r\n    for (let c of this.shadow.childNodes) {\r\n      if (c !== this.titleframe) {\r\n        c.hidden = state;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  _updateClosed(changed) {\r\n    this._setVisible(this._closed, changed);\r\n\r\n    if (this.iconcheck) {\r\n      this.iconcheck.checked = this._closed;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nlet makeForward = (k) => {\r\n  return function() {\r\n    return this.contents[k](...arguments);\r\n  }\r\n};\r\n\r\nfor (let k of forward_keys) {\r\n  PanelFrame.prototype[k] = makeForward(k);\r\n}\r\n\r\nUIBase.internalRegister(PanelFrame);\r\n", "\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {PropTypes} from '../path-controller/toolsys/toolprop.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\nimport cconst from '../config/const.js';\r\nimport {color2web, web2color, validateWebColor} from \"../core/ui_base.js\";\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n    Vector3 = vectormath.Vector3,\r\n    Vector4 = vectormath.Vector4,\r\n    Matrix4 = vectormath.Matrix4;\r\n\r\nexport {rgb_to_hsv, hsv_to_rgb} from \"../path-controller/util/colorutils.js\";\r\nimport {rgb_to_hsv, hsv_to_rgb, cmyk_to_rgb, rgb_to_cmyk} from \"../path-controller/util/colorutils.js\";\r\nimport {contextWrangler} from '../screen/area_wrangler.js';\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nlet UPW = 1.25, VPW = 0.75;\r\n\r\n//*\r\nlet sample_rets = new util.cachering(() => [0, 0], 64);\r\n\r\nexport function inv_sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, UPW);\r\n  ret[1] = Math.pow(v, VPW);\r\n\r\n  return ret;\r\n}\r\n\r\nexport function sample(u, v) {\r\n  let ret = sample_rets.next();\r\n\r\n  ret[0] = Math.pow(u, 1.0/UPW);\r\n  ret[1] = Math.pow(v, 1.0/VPW);\r\n\r\n  return ret;\r\n}\r\n\r\n//*/\r\n\r\n/* shared methods for clipboard handling */\r\nfunction colorClipboardCopy() {\r\n  let rgba = this.getRGBA();\r\n\r\n  let r = rgba[0]*255;\r\n  let g = rgba[1]*255;\r\n  let b = rgba[2]*255;\r\n  let a = rgba[3];\r\n\r\n  let data = `rgba(${r.toFixed(4)}, ${g.toFixed(4)}, ${b.toFixed(4)}, ${a.toFixed(4)})`;\r\n  //cconst.setClipboardData(\"color\", \"text/css\", data);\r\n\r\n  cconst.setClipboardData(\"color\", \"text/plain\", data);\r\n}\r\n\r\nfunction colorClipboardPaste() {\r\n  let data = cconst.getClipboardData(\"text/plain\");\r\n\r\n  if (!data || !validateCSSColor(\"\" + data.data)) {// || data.mime !== \"text/css\") {\r\n    return;\r\n  }\r\n\r\n  let color;\r\n\r\n  try {\r\n    color = css2color(data.data);\r\n  } catch (error) {\r\n    //not a color\r\n    console.log(error.stack);\r\n    console.log(error.message);\r\n  }\r\n\r\n  if (color) {\r\n    if (color.length < 4) {\r\n      color.push(1.0);\r\n    }\r\n\r\n    this.setRGBA(color);\r\n  }\r\n}\r\n\r\nlet fieldrand = new util.MersenneRandom(0);\r\n\r\nlet huefields = {};\r\n\r\nexport function getHueField(width, height, dpi) {\r\n  let key = width + \":\" + height + \":\" + dpi.toFixed(4);\r\n\r\n  if (key in huefields) {\r\n    return huefields[key];\r\n  }\r\n\r\n  let field = new ImageData(width, height);\r\n  let idata = field.data;\r\n\r\n  for (let i = 0; i < width*height; i++) {\r\n    let ix = i%width, iy = ~~(i/width);\r\n    let idx = i*4;\r\n\r\n    let rgb = hsv_to_rgb(ix/width, 1, 1);\r\n\r\n    idata[idx] = rgb[0]*255;\r\n    idata[idx + 1] = rgb[1]*255;\r\n    idata[idx + 2] = rgb[2]*255;\r\n    idata[idx + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let canvas = document.createElement(\"canvas\");\r\n  canvas.width = field.width;\r\n  canvas.height = field.height;\r\n  let g = canvas.getContext(\"2d\");\r\n  g.putImageData(field, 0, 0);\r\n  field = canvas;\r\n  //*/\r\n\r\n  huefields[key] = field;\r\n  return field;\r\n}\r\n\r\nlet fields = {};\r\n\r\nexport function getFieldImage(fieldsize, width, height, hsva) {\r\n  fieldrand.seed(0);\r\n\r\n  /* render field at half res and upscale via canvas2d */\r\n  let width2 = width>>1;\r\n  let height2 = height>>1;\r\n  let fieldsize2 = fieldsize>>1;\r\n\r\n  let hue = hsva[0];\r\n  let hue_rgb = hsv_to_rgb(hue, 1.0, 1.0);\r\n  let key = fieldsize + \":\" + width2 + \":\" + height2 + \":\" + hue.toFixed(5);\r\n\r\n  if (key in fields)\r\n    return fields[key];\r\n\r\n  let size2 = fieldsize2;\r\n  let valpow = 0.75;\r\n\r\n  let image = {\r\n    width : width,\r\n    height: height,\r\n    image : new ImageData(fieldsize2, fieldsize2),\r\n\r\n    x2sat: (x) => {\r\n      return Math.min(Math.max(x/width, 0), 1);\r\n    },\r\n    y2val: (y) => {\r\n      y = 1.0 - Math.min(Math.max(y/height, 0), 1);\r\n\r\n      return y === 0.0 ? 0.0 : y**valpow;\r\n    },\r\n    sat2x: (s) => {\r\n      return s*width;\r\n    },\r\n    val2y: (v) => {\r\n      if (v === 0)\r\n        return height;\r\n\r\n      v = v**(1.0/valpow);\r\n      return (1.0 - v)*height;\r\n    }\r\n  };\r\n\r\n  image.params = {\r\n    box: {\r\n      x     : 0,\r\n      y     : 0,\r\n      width : width,\r\n      height: height\r\n    }\r\n  };\r\n\r\n  let idata = image.image.data;\r\n  for (let i = 0; i < idata.length; i += 4) {\r\n    let i2 = i/4;\r\n    let x = i2%size2, y = ~~(i2/size2);\r\n\r\n    let v = 1.0 - (y/size2);\r\n    let s = (x/size2);\r\n\r\n    let rgb = hsv_to_rgb(hsva[0], s, v**valpow);\r\n\r\n    idata[i] = rgb[0]*255;\r\n    idata[i + 1] = rgb[1]*255;\r\n    idata[i + 2] = rgb[2]*255;\r\n    idata[i + 3] = 255;\r\n  }\r\n\r\n  //*\r\n  let image2 = document.createElement(\"canvas\");\r\n  image2.width = size2;\r\n  image2.height = size2;\r\n  let g = image2.getContext(\"2d\");\r\n  g.putImageData(image.image, 0, 0);\r\n  //*/\r\n  image.canvas = image2;\r\n  image.scale = width/size2;\r\n\r\n  fields[key] = image;\r\n  return image;\r\n}\r\n\r\n\r\nlet _update_temp = new Vector4();\r\n\r\nexport class SimpleBox {\r\n  constructor(pos = [0, 0], size = [1, 1]) {\r\n    this.pos = new Vector2(pos);\r\n    this.size = new Vector2(size);\r\n    this.r = 0;\r\n  }\r\n}\r\n\r\nexport class HueField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    let setFromXY = (x, y) => {\r\n      let dpi = this.getDPI();\r\n      let pad = this._getPad();\r\n\r\n      let w = this.canvas.width/dpi - pad*2.0;\r\n      x -= pad;\r\n\r\n      let h = x/w;\r\n      h = Math.min(Math.max(h, 0.0), 1.0);\r\n\r\n      this.hsva[0] = h;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]:\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[0] = Math.min(Math.max(this.hsva[0] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"huefield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getPad() {\r\n    return Math.max(this.getDefault(\"circleSize\"), 15);\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"hueHeight\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n\r\n    /* create horizontal padding to make selection of\r\n     *  endpoint hue easier */\r\n\r\n    let rselector = ~~(this._getPad()*dpi); //~~(this.getDefault(\"circleSize\")*dpi);\r\n    let r_circle = this.getDefault(\"circleSize\")*dpi;\r\n\r\n    let w2 = canvas.width, h2 = canvas.height;\r\n\r\n    w2 -= rselector*2.0;\r\n\r\n    //g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector*2, 0, w2, h2);\r\n    g.drawImage(getHueField(w2, h2, dpi), 0, 0, w2, h2, rselector, 0, w2, h2);\r\n\r\n    let x = this.hsva[0]*w2 + rselector;\r\n    let y = canvas.height*0.5;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r_circle, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\"\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(HueField);\r\n\r\nexport class SatValField extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = [0, 0, 0, 1];\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n    this.shadow.appendChild(this.canvas);\r\n\r\n    this.onchange = undefined;\r\n\r\n    let setFromXY = (x, y) => {\r\n      let field = this._getField();\r\n      let r = ~~(this.getDefault(\"circleSize\")*this.getDPI());\r\n\r\n      let sat = field.x2sat(x - r);\r\n      let val = field.y2val(y - r);\r\n\r\n      this.hsva[1] = sat;\r\n      this.hsva[2] = val;\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.hsva);\r\n      }\r\n\r\n      this._redraw();\r\n    };\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Left\"]:\r\n        case keymap[\"Right\"]: {\r\n          let sign = e.keyCode === keymap[\"Left\"] ? -1 : 1;\r\n\r\n          this.hsva[1] = Math.min(Math.max(this.hsva[1] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]: {\r\n          let sign = e.keyCode === keymap[\"Down\"] ? -1 : 1;\r\n\r\n          this.hsva[2] = Math.min(Math.max(this.hsva[2] + 0.05*sign, 0.0), 1.0);\r\n          this._redraw();\r\n\r\n          if (this.onchange) {\r\n            this.onchange(this.hsva);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener(\"mousedown\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_pointermove(e) {\r\n          this.on_mousemove(e);\r\n        },\r\n        on_mousemove: (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          if (rect === undefined) {\r\n            return;\r\n          }\r\n\r\n          let x = e.clientX - rect.x, y = e.clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown  : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.canvas.addEventListener(\"touchstart\", (e) => {\r\n      if (this.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      let rect = this.canvas.getClientRects()[0];\r\n      let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n      setFromXY(x, y);\r\n\r\n      this.pushModal({\r\n        on_mousemove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x, y;\r\n\r\n          if (e.touches && e.touches.length) {\r\n            x = e.touches[0].clientX - rect.x;\r\n            y = e.touches[0].clientY - rect.y;\r\n          } else {\r\n            x = e.x;\r\n            y = e.y;\r\n          }\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_touchmove  : (e) => {\r\n          let rect = this.canvas.getClientRects()[0];\r\n          let x = e.touches[0].clientX - rect.x, y = e.touches[0].clientY - rect.y;\r\n\r\n          setFromXY(x, y);\r\n        },\r\n        on_mousedown  : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchcancel: (e) => {\r\n          this.popModal();\r\n        },\r\n        on_touchend   : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_mouseup    : (e) => {\r\n          this.popModal();\r\n        },\r\n        on_keydown    : (e) => {\r\n          if (e.keyCode === keymap[\"Enter\"] || e.keyCode === keymap[\"Escape\"] || e.keyCode === keymap[\"Space\"]) {\r\n            this.popModal();\r\n          }\r\n        }\r\n      });\r\n    })\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"satvalfield-x\",\r\n      style            : \"colorfield\",\r\n      havePickClipboard: true\r\n    };\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(rgba) {\r\n    let hsv = rgb_to_hsv(rgba[0], rgba[1], rgba[2]);\r\n    this.hsva.loadXYZW(hsv[0], hsv[1], hsv[2], rgba[3]);\r\n\r\n    this.update(true);\r\n    this._redraw();\r\n\r\n    if (this.onchange) {\r\n      this.onchange(this.hsva);\r\n    }\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  _getField() {\r\n    let dpi = this.getDPI();\r\n    let canvas = this.canvas;\r\n    let r = this.getDefault(\"circleSize\");\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    //r = ~~(r*dpi);\r\n\r\n    return getFieldImage(this.getDefault(\"fieldSize\"), w - r*2, h - r*2, this.hsva);\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    if (force_update) {\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g, canvas = this.canvas;\r\n    let dpi = this.getDPI();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    //SatValField\r\n\r\n    let rselector = ~~(this.getDefault(\"circleSize\")*dpi);\r\n\r\n    let field = this._getField()\r\n    let image = field.canvas;\r\n\r\n    g.globalAlpha = 1.0;\r\n    g.beginPath();\r\n    g.rect(0, 0, canvas.width, canvas.height);\r\n    g.fillStyle = \"rgb(200, 200, 200)\";\r\n    g.fill();\r\n\r\n    g.beginPath();\r\n\r\n    let steps = 17;\r\n    let dx = canvas.width/steps;\r\n    let dy = canvas.height/steps;\r\n\r\n    for (let i = 0; i < steps*steps; i++) {\r\n      let x = (i%steps)*dx, y = (~~(i/steps))*dy;\r\n\r\n      if (i%2 === 0) {\r\n        continue;\r\n      }\r\n      g.rect(x, y, dx, dy);\r\n    }\r\n\r\n    g.fillStyle = \"rgb(110, 110, 110)\";\r\n    g.fill();\r\n\r\n    g.globalAlpha = this.hsva[3];\r\n    g.drawImage(image, 0, 0, image.width, image.height, rselector, rselector, canvas.width - rselector*2, canvas.height - rselector*2);\r\n\r\n    let hsva = this.hsva;\r\n\r\n    let x = field.sat2x(hsva[1])*dpi + rselector;\r\n    let y = field.val2y(hsva[2])*dpi + rselector;\r\n    let r = rselector;\r\n\r\n    g.beginPath();\r\n    g.arc(x, y, r, -Math.PI, Math.PI);\r\n    g.closePath();\r\n\r\n    g.strokeStyle = \"white\";\r\n    g.lineWidth = 3*dpi;\r\n    g.stroke();\r\n\r\n    g.strokeStyle = \"grey\";\r\n    g.lineWidth = 1*dpi;\r\n    g.stroke();\r\n\r\n    if (this.disabled) {\r\n      g.beginPath();\r\n      g.fillStyle = \"rgba(25,25,25,0.75)\";\r\n      g.rect(0, 0, this.canvas.width, this.canvas.height);\r\n      g.fill();\r\n    }\r\n  }\r\n\r\n  on_disabled() {\r\n    this._redraw();\r\n  }\r\n\r\n  on_enabled() {\r\n    this._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(SatValField);\r\n\r\nexport class ColorField extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.hsva = new Vector4([0.05, 0.6, 0.15, 1.0]);\r\n    this.rgba = new Vector4([0, 0, 0, 0]);\r\n\r\n    this._recalcRGBA();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n\r\n    /*\r\n    this.hbox = new SimpleBox();\r\n    this.svbox = new SimpleBox();\r\n    //*/\r\n\r\n    this._last_dpi = undefined;\r\n\r\n    let satvalfield = this.satvalfield = UIBase.createElement(\"satvalfield-x\");\r\n    satvalfield.hsva = this.hsva;\r\n\r\n    let huefield = this.huefield = UIBase.createElement(\"huefield-x\");\r\n    huefield.hsva = this.hsva;\r\n\r\n    huefield.onchange = (e) => {\r\n      this.satvalfield._redraw();\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    satvalfield.onchange = (e) => {\r\n      this._recalcRGBA();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.rgba);\r\n      }\r\n    };\r\n\r\n    this._add(satvalfield);\r\n    this._add(huefield);\r\n    //this.shadow.appendChild(canvas);\r\n    //this.shadow.appendChild(huecanvas);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"colorfield-x\",\r\n      style  : \"colorfield\"\r\n    };\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    let rgb = cmyk_to_rgb(c, m, y, k);\r\n    let hsv = rgb_to_hsv(rgb[0], rgb[1], rgb[2]);\r\n\r\n    this.setHSVA(hsv[0], hsv[1], hsv[2], this.hsva[3]);\r\n  }\r\n\r\n  getCMYK() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return rgb_to_cmyk(rgb[0], rgb[1], rgb[2]);\r\n  }\r\n\r\n  setHSVA(h, s, v, a = 1.0, fire_onchange = true) {\r\n    this.hsva[0] = h;\r\n    this.hsva[1] = s;\r\n    this.hsva[2] = v;\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  _recalcRGBA() {\r\n    let ret = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n\r\n    this.rgba[0] = ret[0];\r\n    this.rgba[1] = ret[1];\r\n    this.rgba[2] = ret[2];\r\n    this.rgba[3] = this.hsva[3];\r\n\r\n    return this;\r\n  }\r\n\r\n  updateDPI(force_update = false, _in_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    let update = force_update;\r\n    update = update || dpi != this._last_dpi;\r\n\r\n    if (update) {\r\n      this._last_dpi = dpi;\r\n\r\n      if (!_in_update)\r\n        this._redraw();\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getRGBA() {\r\n    let rgb = hsv_to_rgb(this.hsva[0], this.hsva[1], this.hsva[2]);\r\n    return new Vector4().loadXYZW(rgb[0], rgb[1], rgb[2], this.hsva[3]);\r\n  }\r\n\r\n  setRGBA(r, g, b, a = 1.0, fire_onchange = true) {\r\n    if (typeof r === \"object\") {\r\n      g = r[1];\r\n      b = r[2];\r\n      a = r[3];\r\n      r = r[0];\r\n    }\r\n\r\n    let hsv = rgb_to_hsv(r, g, b);\r\n\r\n    this.hsva[0] = hsv[0];\r\n    this.hsva[1] = hsv[1];\r\n    this.hsva[2] = hsv[2];\r\n    this.hsva[3] = a;\r\n\r\n    this._recalcRGBA();\r\n    this.update(true);\r\n\r\n    if (this.onchange && fire_onchange) {\r\n      this.onchange(this.hsva, this.rgba);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.huefield.overrideClass(theme);\r\n    this.satvalfield.overrideClass(theme);\r\n\r\n    for (let i=0; i<3; i++) {\r\n      this.flushSetCSS();\r\n      this.flushUpdate();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  update(force_update = false) {\r\n    super.update();\r\n\r\n    this.updateThemeOverride();\r\n\r\n    let redraw = this.updateDPI(force_update, true);\r\n    redraw = redraw || force_update;\r\n\r\n    if (redraw) {\r\n      this.satvalfield.update(true);\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"flex-grow\"] = this.getDefault(\"flex-grow\");\r\n  }\r\n\r\n  _redraw() {\r\n    this.satvalfield._redraw();\r\n    this.huefield._redraw();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorField);\r\n\r\nexport class ColorPicker extends ui.ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this._lastThemeStyle = this.constructor.define().style;\r\n  }\r\n\r\n  //*\r\n  get hsva() {\r\n    return this.field.hsva;\r\n  }\r\n\r\n  get rgba() {\r\n    return this.field.rgba;\r\n  }//*/\r\n\r\n  set description(val) {\r\n    //do not allow setting description of the colorpicker container\r\n  }\r\n\r\n  static setDefault(node) {\r\n    let tabs, colorsPanel = node;\r\n\r\n    if (node.getClassDefault(\"usePanels\")) {\r\n      let panel = colorsPanel = node.panel(\"Color\");\r\n      tabs = panel.tabs();\r\n      panel.closed = true;\r\n\r\n      panel.style[\"flex-grow\"] = \"unset\";\r\n\r\n      /* force compactness */\r\n      panel.titleframe.style[\"flex-grow\"] = \"unset\";\r\n      //panel.titleframe.style[\"align-items\"] = \"unset\";\r\n    } else {\r\n      tabs = node.tabs();\r\n    }\r\n\r\n    node.cssText = node.textbox();\r\n    node.cssText.onchange = (val) => {\r\n      let ok = validateWebColor(val);\r\n      if (!ok) {\r\n        node.cssText.flash(\"red\");\r\n        return;\r\n      } else {\r\n        node.cssText.flash(\"green\");\r\n      }\r\n\r\n      val = val.trim();\r\n\r\n      let color = web2color(val);\r\n\r\n      node._no_update_textbox = true;\r\n      node.field.setRGBA(color[0], color[1], color[2], color[3]);\r\n      node._setSliders();\r\n\r\n      node._no_update_textbox = false;\r\n    };\r\n\r\n    //tabs.overrideDefault(\"background-color\", node.getDefault(\"background-color\"));\r\n\r\n    let tab = tabs.tab(\"HSV\");\r\n\r\n    node.h = tab.slider(undefined, \"Hue\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(e.value, hsva[1], hsva[2], hsva[3]);\r\n    });\r\n\r\n    node.s = tab.slider(undefined, \"Saturation\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], e.value, hsva[2], hsva[3]);\r\n    });\r\n    node.v = tab.slider(undefined, \"Value\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], e.value, hsva[3]);\r\n    });\r\n    node.a = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let hsva = node.hsva;\r\n      node.setHSVA(hsva[0], hsva[1], hsva[2], e.value);\r\n    });\r\n\r\n    node.h.baseUnit = node.h.displayUnit = \"none\";\r\n    node.s.baseUnit = node.s.displayUnit = \"none\";\r\n    node.v.baseUnit = node.v.displayUnit = \"none\";\r\n    node.a.baseUnit = node.a.displayUnit = \"none\";\r\n\r\n    tab = tabs.tab(\"RGB\");\r\n\r\n    node.r = tab.slider(undefined, \"R\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(e.value, rgba[1], rgba[2], rgba[3]);\r\n    });\r\n    node.g = tab.slider(undefined, \"G\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], e.value, rgba[2], rgba[3]);\r\n    });\r\n    node.b = tab.slider(undefined, \"B\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], e.value, rgba[3]);\r\n    });\r\n    node.a2 = tab.slider(undefined, \"Alpha\", 0.0, 0.0, 1.0, 0.001, false, true, (e) => {\r\n      let rgba = node.rgba;\r\n      node.setRGBA(rgba[0], rgba[1], rgba[2], e.value);\r\n    });\r\n\r\n    node.r.baseUnit = node.r.displayUnit = \"none\";\r\n    node.g.baseUnit = node.g.displayUnit = \"none\";\r\n    node.b.baseUnit = node.b.displayUnit = \"none\";\r\n    node.a2.baseUnit = node.a2.displayUnit = \"none\";\r\n\r\n    if (!node.getDefault(\"noCMYK\")) {\r\n      tab = tabs.tab(\"CMYK\")\r\n      let cmyk = node.getCMYK();\r\n\r\n      let makeCMYKSlider = (label, idx) => {\r\n        let slider = tab.slider(undefined, {\r\n          name      : label,\r\n          min       : 0.0,\r\n          max       : 1.0,\r\n          is_int    : false,\r\n          defaultval: cmyk[idx],\r\n          callback  : (e) => {\r\n            let cmyk = node.getCMYK();\r\n            cmyk[idx] = e.value;\r\n            node.setCMYK(cmyk[0], cmyk[1], cmyk[2], cmyk[3]);\r\n          },\r\n          step      : 0.001\r\n        });\r\n\r\n        slider.baseUnit = slider.displayUnit = \"none\";\r\n\r\n        return slider;\r\n      }\r\n\r\n      node.cmyk = [\r\n        makeCMYKSlider(\"C\", 0),\r\n        makeCMYKSlider(\"M\", 1),\r\n        makeCMYKSlider(\"Y\", 2),\r\n        makeCMYKSlider(\"K\", 3),\r\n      ];\r\n    }\r\n\r\n    node._setSliders();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname            : \"colorpicker-x\",\r\n      style              : \"colorfield\",\r\n      havePickClipboard  : true,\r\n      copyForAllChildren : true,\r\n      pasteForAllChildren: true,\r\n    };\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.field = UIBase.createElement(\"colorfield-x\");\r\n    this.field.setAttribute(\"class\", \"colorpicker\");\r\n\r\n    this.field.packflag |= this.inherit_packflag;\r\n    this.field.packflag |= this.packflag;\r\n\r\n    this.field.onchange = () => {\r\n      this._setDataPath();\r\n      this._setSliders();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this.field.rgba);\r\n      }\r\n    };\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .colorpicker {\r\n        background-color : ${this.getDefault(\"background-color\")};\r\n      }\r\n    `;\r\n\r\n    this._style = style;\r\n\r\n    let cb = this.colorbox = document.createElement(\"div\");\r\n    cb.style[\"width\"] = \"100%\";\r\n    cb.style[\"height\"] = this.getDefault(\"colorBoxHeight\") + \"px\";\r\n    cb.style[\"background-color\"] = \"black\";\r\n\r\n    this.shadow.appendChild(style);\r\n    this.field.ctx = this.ctx;\r\n\r\n    this.add(this.colorbox);\r\n    this.add(this.field);\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n  }\r\n\r\n  updateColorBox() {\r\n    let r = this.field.rgba[0], g = this.field.rgba[1], b = this.field.rgba[2];\r\n    //let a = this.field.rgba[3];\r\n\r\n    r = ~~(r*255);\r\n    g = ~~(g*255);\r\n    b = ~~(b*255);\r\n\r\n    let css = `rgb(${r},${g},${b})`;\r\n    this.colorbox.style[\"background-color\"] = css;\r\n  }\r\n\r\n  _setSliders() {\r\n    if (this.h === undefined) {\r\n      //setDefault() wasn't called\r\n      console.warn(\"colorpicker ERROR\");\r\n      return;\r\n    }\r\n\r\n    let hsva = this.field.hsva;\r\n    this.h.setValue(hsva[0], false);\r\n    this.s.setValue(hsva[1], false);\r\n    this.v.setValue(hsva[2], false);\r\n    this.a.setValue(hsva[3], false);\r\n\r\n    let rgba = this.field.rgba;\r\n\r\n    this.r.setValue(rgba[0], false);\r\n    this.g.setValue(rgba[1], false);\r\n    this.b.setValue(rgba[2], false);\r\n    this.a2.setValue(rgba[3], false);\r\n\r\n    if (this.cmyk) {\r\n      let cmyk = this.field.getCMYK();\r\n\r\n      for (let i = 0; i < 4; i++) {\r\n        this.cmyk[i].setValue(cmyk[i], false);\r\n      }\r\n    }\r\n\r\n    this.updateColorBox();\r\n\r\n    if (!this._no_update_textbox) {\r\n      this.cssText.text = color2web(this.field.rgba);\r\n    }\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!this.hasAttribute(\"datapath\")) {\r\n      return;\r\n    }\r\n\r\n    let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n    let val = this.getPathValue(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n    if (val === undefined) {\r\n      //console.warn(\"Bad datapath\", this.getAttribute(\"datapath\"));\r\n      this.internalDisabled = true;\r\n      return;\r\n    }\r\n\r\n    this.internalDisabled = false;\r\n\r\n    _update_temp.load(val);\r\n\r\n    if (prop.type === PropTypes.VEC3) {\r\n      _update_temp[3] = 1.0;\r\n    }\r\n\r\n    if (_update_temp.vectorDistance(this.field.rgba) > 0.01) {\r\n      this.field.setRGBA(_update_temp[0], _update_temp[1], _update_temp[2], _update_temp[3], false);\r\n      this._setSliders();\r\n      this.field.update(true);\r\n    }\r\n  }\r\n\r\n  updateThemeOverride() {\r\n    let theme = this.getStyleClass();\r\n    if (theme === this._lastThemeStyle) {\r\n      return false;\r\n    }\r\n\r\n    this._lastThemeStyle = theme;\r\n    this.field.overrideClass(theme);\r\n\r\n    this.flushSetCSS();\r\n    this.flushUpdate();\r\n\r\n    return true;\r\n  }\r\n\r\n  update() {\r\n    this.updateThemeOverride();\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n\r\n    super.update();\r\n  }\r\n\r\n  _setDataPath() {\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      let prop = this.getPathMeta(this.ctx, this.getAttribute(\"datapath\"));\r\n\r\n      if (prop === undefined) {\r\n        console.warn(\"Bad data path for color field:\", this.getAttribute(\"datapath\"));\r\n      }\r\n\r\n      let val = this.field.rgba;\r\n      if (prop !== undefined && prop.type === PropTypes.VEC3) {\r\n        val = new Vector3();\r\n        val.load(this.field.rgba);\r\n      }\r\n\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), val);\r\n    }\r\n  }\r\n\r\n  getCMYK() {\r\n    return this.field.getCMYK();\r\n  }\r\n\r\n  setCMYK(c, m, y, k) {\r\n    this.field.setCMYK(c, m, y, k);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  setHSVA(h, s, v, a) {\r\n    this.field.setHSVA(h, s, v, a);\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.field.getRGBA();\r\n  }\r\n\r\n  setRGBA(r, g, b, a) {\r\n    this.field.setRGBA(r, g, b, a)\r\n    this._setSliders();\r\n    this._setDataPath();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ColorPicker);\r\n\r\n\r\nexport class ColorPickerButton extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._highlight = false;\r\n    this._depress = false;\r\n    this._label = \"error\";\r\n\r\n    this.customLabel = undefined;\r\n\r\n    this.rgba = new Vector4([1, 1, 1, 1]);\r\n\r\n    this.labelDom = document.createElement(\"span\");\r\n    this.labelDom.textContent = this._label;\r\n    this.dom = document.createElement(\"canvas\");\r\n    this.g = this.dom.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.labelDom);\r\n    this.shadow.appendChild(this.dom);\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  set label(val) {\r\n    this._label = val;\r\n    this.labelDom.textContent = val;\r\n  }\r\n\r\n  get font() {\r\n    return this._font;\r\n  }\r\n\r\n  set font(val) {\r\n    this._font = val;\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  get noLabel() {\r\n    let ret = \"\" + this.getAttribute(\"no-label\");\r\n    ret = ret.toLowerCase();\r\n\r\n    return ret === \"true\" || ret === \"yes\" || ret === \"on\";\r\n  }\r\n\r\n  set noLabel(v) {\r\n    if (this.labelDom) {\r\n      this.labelDom.hidden = true; //will be deleted later\r\n    }\r\n\r\n    this.setAttribute(\"no-label\", v ? \"true\" : \"false\");\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname          : \"color-picker-button-x\",\r\n      style            : \"colorpickerbutton\",\r\n      havePickClipboard: true\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this._font = \"DefaultText\"; //this.getDefault(\"defaultFont\");\r\n\r\n    let enter = (e) => {\r\n      this._highlight = true;\r\n      this._redraw();\r\n    }\r\n\r\n    let leave = (e) => {\r\n      this._highlight = false;\r\n      this._redraw();\r\n    }\r\n\r\n    this.addEventListener(\"pointerover\", enter, {capture: true, passive: true});\r\n    this.addEventListener(\"pointerout\", leave, {capture: true, passive: true});\r\n    this.addEventListener(\"focus\", leave, {capture: true, passive: true});\r\n\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n      this.click(e);\r\n    });\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  clipboardCopy() {\r\n    colorClipboardCopy.apply(this, arguments);\r\n  }\r\n\r\n  clipboardPaste() {\r\n    colorClipboardPaste.apply(this, arguments);\r\n  }\r\n\r\n  getRGBA() {\r\n    return this.rgba;\r\n  }\r\n\r\n  click(e) {\r\n    this.abortToolTips(4000);\r\n    console.warn(\"CLICK COLORPICKER\");\r\n    this.blur();\r\n\r\n    if (this.onclick) {\r\n      this.onclick(e);\r\n    }\r\n\r\n    let colorpicker = this.ctx.screen.popup(this, this);\r\n    let ctx = contextWrangler.makeSafeContext(this.ctx);\r\n\r\n    colorpicker.ctx = ctx;\r\n    colorpicker.useDataPathUndo = this.useDataPathUndo;\r\n\r\n    let path = this.hasAttribute(\"datapath\") ? this.getAttribute(\"datapath\") : undefined;\r\n\r\n    let widget = colorpicker.colorPicker(path, undefined, this.getAttribute(\"mass_set_path\"));\r\n\r\n    widget.ctx = ctx;\r\n    widget._init();\r\n    widget.setRGBA(this.rgba[0], this.rgba[1], this.rgba[2], this.rgba[3]);\r\n\r\n    widget.style[\"padding\"] = \"20px\";\r\n\r\n    let onchange = () => {\r\n      this.rgba.load(widget.rgba);\r\n      this.redraw();\r\n\r\n      if (this.onchange) {\r\n        this.onchange(this);\r\n      }\r\n    }\r\n\r\n    widget.onchange = onchange;\r\n\r\n    colorpicker.style[\"background-color\"] = widget.getDefault(\"background-color\");\r\n    //colorpicker.style[\"border-radius\"] = \"25px\";\r\n    colorpicker.style[\"border-width\"] = widget.getDefault(\"border-width\");\r\n  }\r\n\r\n  setRGBA(val) {\r\n    let a = this.rgba[3];\r\n\r\n    let old = new Vector4(this.rgba);\r\n\r\n    this.rgba.load(val);\r\n\r\n    if (val.length < 4) {\r\n      this.rgba[3] = a;\r\n    }\r\n\r\n    if (this.rgba.vectorDistance(old) < 0.001) {\r\n      return;\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.setPathValue(this.ctx, this.getAttribute(\"datapath\"), this.rgba);\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange();\r\n    }\r\n\r\n    this._redraw();\r\n    return this;\r\n  }\r\n\r\n  on_disabled() {\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  _redraw() {\r\n    let canvas = this.dom, g = this.g;\r\n\r\n    g.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (this.disabled) {\r\n      let color = \"rgb(55, 55, 55)\";\r\n\r\n      g.save();\r\n\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n      let steps = 5;\r\n      let dt = canvas.width/steps, t = 0;\r\n\r\n      g.beginPath();\r\n      g.lineWidth = 2;\r\n      g.strokeStyle = \"black\";\r\n\r\n      for (let i = 0; i < steps; i++, t += dt) {\r\n        g.moveTo(t, 0);\r\n        g.lineTo(t + dt, canvas.height);\r\n        g.moveTo(t + dt, 0);\r\n        g.lineTo(t, canvas.height);\r\n      }\r\n\r\n      g.stroke();\r\n      g.restore();\r\n      return;\r\n    }\r\n\r\n    //do checker pattern for alpha\r\n    g.save();\r\n\r\n    let grid1 = \"rgb(100, 100, 100)\";\r\n    let grid2 = \"rgb(175, 175, 175)\";\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\");\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", grid1);\r\n\r\n    let cellsize = 10;\r\n    let totx = Math.ceil(canvas.width/cellsize), toty = Math.ceil(canvas.height/cellsize);\r\n\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"clip\", undefined, undefined, true);\r\n    g.clip();\r\n\r\n    g.beginPath();\r\n    for (let x = 0; x < totx; x++) {\r\n      for (let y = 0; y < toty; y++) {\r\n        if ((x + y) & 1) {\r\n          continue;\r\n        }\r\n\r\n        g.rect(x*cellsize, y*cellsize, cellsize, cellsize);\r\n      }\r\n    }\r\n\r\n    g.fillStyle = grid2;\r\n    g.fill();\r\n\r\n    //g.fillStyle = \"orange\";\r\n    //g.beginPath();\r\n    //g.rect(0, 0, canvas.width, canvas.height);\r\n    //g.fill();\r\n\r\n    let color = color2css(this.rgba);\r\n    ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color, undefined, true);\r\n    //drawRoundBox(elem, canvas, g, width, height, r=undefined, op=\"fill\", color=undefined, pad=undefined) {\r\n\r\n    if (this._highlight) {\r\n      //let color = \"rgba(200, 200, 255, 0.5)\";\r\n      let color = this.getDefault(\"BoxHighlight\");\r\n      ui_base.drawRoundBox(this, canvas, g, canvas.width, canvas.height, undefined, \"fill\", color);\r\n    }\r\n\r\n    g.restore();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    let w = this.getDefault(\"width\");\r\n    let h = this.getDefault(\"height\");\r\n    let dpi = this.getDPI();\r\n\r\n    this.style[\"width\"] = \"min-contents\" + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n\r\n    this.style[\"flex-direction\"] = \"row\";\r\n    this.style[\"display\"] = \"flex\";\r\n\r\n    this.labelDom.style[\"color\"] = this.getDefault(this._font).color;\r\n    this.labelDom.style[\"font\"] = ui_base.getFont(this, undefined, this._font, false);\r\n\r\n    let canvas = this.dom;\r\n\r\n    canvas.style[\"width\"] = w + \"px\";\r\n    canvas.style[\"height\"] = h + \"px\";\r\n    canvas.width = ~~(w*dpi);\r\n    canvas.height = ~~(h*dpi);\r\n\r\n    this.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n    this._redraw();\r\n  }\r\n\r\n  updateDataPath() {\r\n    if (!(this.hasAttribute(\"datapath\"))) {\r\n      return;\r\n    }\r\n\r\n    let path = this.getAttribute(\"datapath\");\r\n    let prop = this.getPathMeta(this.ctx, path);\r\n\r\n    if ((prop === undefined || prop.data === undefined) && cconst.DEBUG.verboseDataPath) {\r\n      console.log(\"bad path\", path);\r\n      return;\r\n    } else if (prop === undefined) {\r\n      let redraw = !this.disabled;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n      return;\r\n    }\r\n\r\n    let redraw = this.disabled;\r\n\r\n    this.internalDisabled = false;\r\n\r\n    if (this.customLabel === undefined && prop.uiname !== this._label) {\r\n      this.label = prop.uiname;\r\n    }\r\n\r\n    let val = this.getPathValue(this.ctx, path);\r\n\r\n    if (val === undefined) {\r\n      redraw = redraw || this.disabled !== true;\r\n\r\n      this.internalDisabled = true;\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n\r\n    } else {\r\n      this.internalDisabled = false;\r\n\r\n      let dis;\r\n\r\n      if (val.length === 3) {\r\n        dis = Vector3.prototype.vectorDistance.call(val, this.rgba);\r\n      } else {\r\n        dis = this.rgba.vectorDistance(val);\r\n      }\r\n\r\n      if (dis > 0.0001) {\r\n        if (prop.type === PropTypes.VEC3) {\r\n          this.rgba.load(val);\r\n          this.rgba[3] = 1.0;\r\n        } else {\r\n          this.rgba.load(val);\r\n        }\r\n\r\n        redraw = true;\r\n      }\r\n\r\n      if (redraw) {\r\n        this._redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    if (this.noLabel && this.labelDom.isConnected) {\r\n      this.labelDom.remove();\r\n    }\r\n\r\n    if (this.customLabel !== undefined && this.customLabel !== this._label) {\r\n      this.label = this.customLabel;\r\n    }\r\n\r\n    for (let i = 0; i < this.rgba.length; i++) {\r\n      if (this.rgba[i] === undefined) {\r\n        console.warn(\"corrupted color or alpha detected\", this.rgba);\r\n        this.rgba[i] = 1.0;\r\n      }\r\n    }\r\n\r\n    let key = \"\" + this.rgba[0].toFixed(4) + \" \" + this.rgba[1].toFixed(4) + \" \" + this.rgba[2].toFixed(4) + \" \" + this.rgba[3].toFixed(4);\r\n    key += this.disabled;\r\n\r\n    if (key !== this._last_key) {\r\n      this._last_key = key;\r\n      this.redraw();\r\n    }\r\n\r\n    if (this.hasAttribute(\"datapath\")) {\r\n      this.updateDataPath();\r\n    }\r\n  }\r\n\r\n  redraw() {\r\n    this._redraw();\r\n  }\r\n};\r\nUIBase.internalRegister(ColorPickerButton);\r\n", "\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as ui from '../core/ui.js';\r\nimport {loadUIData, saveUIData} from '../core/ui_base.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet UIBase      = ui_base.UIBase,\r\n    PackFlags   = ui_base.PackFlags,\r\n    IconSheets  = ui_base.IconSheets,\r\n    iconmanager = ui_base.iconmanager;\r\n\r\nexport let tab_idgen = 1;\r\nlet debug = false;\r\nlet Vector2 = vectormath.Vector2;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nlet FAKE_TAB_ID = Symbol(\"fake_tab_id\");\r\n\r\n\r\nclass TabDragEvent extends PointerEvent {\r\n}\r\n\r\n\r\n/* subclass HTMLElement so tabs can be used as the .target\r\n*  member of events*/\r\nexport class TabItem extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.name = name;\r\n    this.icon = undefined;\r\n    this.tooltip = \"\";\r\n    this.movable = true;\r\n    this.tbar = undefined;\r\n\r\n    this.ontabclick = null;\r\n    this.ontabdragstart = null;\r\n    this.ontabdragmove = null;\r\n    this.ontabdragend = null;\r\n\r\n    let helper = (key) => {\r\n      let key2 = \"on\" + key;\r\n\r\n      this.addEventListener(key, (e) => {\r\n        if (this[key2]) {\r\n          return this[key2](e);\r\n        }\r\n      });\r\n    }\r\n\r\n    helper(\"tabclick\");\r\n    helper(\"tabdragstart\");\r\n    helper(\"tabdragmove\");\r\n    helper(\"tabdragend\");\r\n\r\n    this.dom = undefined;\r\n    this.extra = undefined;\r\n    this.extraSize = undefined;\r\n\r\n    this.size = new Vector2();\r\n    this.pos = new Vector2();\r\n\r\n    this.abssize = new Vector2();\r\n    this.abspos = new Vector2();\r\n\r\n\r\n    this.addEventListener(\"pointerdown\", (e) => {\r\n      this.parentWidget.on_pointerdown(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.parentWidget.on_pointermove(e);\r\n    });\r\n\r\n    this.addEventListener(\"pointerup\", (e) => {\r\n      this.parentWidget.on_pointerup(e);\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap.Enter:\r\n        case keymap.Space:\r\n          this.parentWidget.setActive(this, e);\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  init() {\r\n    this.tabIndex = 1;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tab-item-x\"\r\n    }\r\n  }\r\n\r\n  sendEvent(type, forwardEvent) {\r\n    let cls;\r\n\r\n    if (type === \"tabdragstart\" || type === \"tabdragend\") {\r\n      cls = TabDragEvent;\r\n    } else if (forwardEvent && forwardEvent instanceof Event) {\r\n      cls = forwardEvent.constructor;\r\n    } else {\r\n      cls = PointerEvent;\r\n    }\r\n\r\n    let e2 = {};\r\n\r\n    if (forwardEvent) {\r\n      for (let k in forwardEvent) {\r\n        if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n          continue;\r\n        }\r\n\r\n        e2[k] = forwardEvent[k];\r\n      }\r\n    }\r\n\r\n    e2.target = this;\r\n\r\n    e2 = new cls(type, e2);\r\n\r\n    this.dispatchEvent(e2);\r\n    return e2;\r\n  }\r\n\r\n  getClientRects() {\r\n    let r = this.tbar.getClientRects()[0];\r\n\r\n    let s = this.abssize, p = this.abspos;\r\n\r\n    s.load(this.size);\r\n    p.load(this.pos);\r\n\r\n    if (r) {\r\n      p[0] += r.x;\r\n      p[1] += r.y;\r\n    }\r\n\r\n    return [{\r\n      x  : p[0], y: p[1], width: s[0], height: s[1], left: p[0],\r\n      top: p[1], right: p[0] + s[0], bottom: p[1] + s[1]\r\n    }];\r\n  }\r\n\r\n  setCSS() {\r\n    let dpi = UIBase.getDPI();\r\n    let x = this.pos[0]/dpi;\r\n    let y = this.pos[1]/dpi;\r\n    let w = this.size[0]/dpi;\r\n    let h = this.size[1]/dpi;\r\n\r\n    if (this == this.parentWidget.tabs.active) {\r\n      this.style[\"focus-border-width\"] = \"0px\";\r\n    } else {\r\n      this.style[\"focus-border-width\"] = \"2px\";\r\n    }\r\n\r\n    this.style[\"background-color\"] = \"transparent\";\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"pointer-events\"] = \"auto\";\r\n\r\n    this.style[\"left\"] = x + \"px\";\r\n    this.style[\"top\"] = y + \"px\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabItem);\r\n\r\nexport class ModalTabMove extends events.EventHandler {\r\n  constructor(tab, tbar, dom) {\r\n    super();\r\n\r\n    this.dom = dom;\r\n    this.tab = tab;\r\n    this.tbar = tbar;\r\n    this.first = true;\r\n\r\n    this.droptarget = undefined;\r\n    this.start_mpos = new Vector2();\r\n    this.mpos = undefined;\r\n\r\n    this.dragtab = undefined;\r\n    this.dragstate = false;\r\n    this.finished = false;\r\n  }\r\n\r\n  finish() {\r\n    if (debug) if (debug) console.log(\"finish\");\r\n\r\n    if (this.finished) {\r\n      return;\r\n    }\r\n\r\n    this.finished = true;\r\n\r\n    if (this.tbar.tool === this) {\r\n      this.tbar.tool = undefined;\r\n    }\r\n\r\n    this.popModal(this.dom);\r\n    this.tbar.update(true);\r\n  }\r\n\r\n  popModal() {\r\n    if (this.dragcanvas !== undefined) {\r\n      this.dragcanvas.remove();\r\n    }\r\n    let ret = super.popModal(...arguments);\r\n\r\n    this.tab.sendEvent(\"tabdragend\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  on_pointerenter(e) {\r\n  }\r\n\r\n  on_pointerleave(e) {\r\n  }\r\n\r\n  on_pointerstart(e) {\r\n  }\r\n\r\n  on_pointerend(e) {\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointercancel(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.finish();\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    return this._on_move(e, e.x, e.y);\r\n  }\r\n\r\n  _dragstate(e, x, y) {\r\n    this.dragcanvas.style[\"left\"] = x + \"px\";\r\n    this.dragcanvas.style[\"top\"] = y + \"px\";\r\n\r\n    let ctx = this.tbar.ctx;\r\n    let screen = ctx.screen;\r\n    let elem = screen.pickElement(x, y);\r\n\r\n    let e2 = new DragEvent(\"dragenter\", this.dragevent);\r\n    if (elem !== this.droptarget) {\r\n      let e2 = new DragEvent(\"dragexit\", this.dragevent);\r\n      if (this.droptarget) {\r\n        this.droptarget.dispatchEvent(e2);\r\n      }\r\n\r\n      e2 = new DragEvent(\"dragover\", this.dragevent);\r\n      this.droptarget = elem;\r\n      if (elem) {\r\n        elem.dispatchEvent(e2);\r\n      }\r\n    }\r\n    //console.log(elem);\r\n  }\r\n\r\n  _on_move(e, x, y) {\r\n    let r = this.tbar.getClientRects()[0];\r\n    let dpi = UIBase.getDPI();\r\n\r\n    if (r === undefined) {\r\n      //element was removed during/before move\r\n      this.finish();\r\n      return;\r\n    }\r\n\r\n    if (this.dragstate) {\r\n      this._dragstate(e, x, y);\r\n      return;\r\n    }\r\n\r\n    x -= r.x;\r\n    y -= r.y;\r\n\r\n    let dx, dy;\r\n\r\n    x *= dpi;\r\n    y *= dpi;\r\n\r\n    if (this.first) {\r\n      this.first = false;\r\n      this.start_mpos[0] = x;\r\n      this.start_mpos[1] = y;\r\n    }\r\n    if (this.mpos === undefined) {\r\n      this.mpos = [0, 0];\r\n      dx = dy = 0;\r\n    } else {\r\n      dx = x - this.mpos[0];\r\n      dy = y - this.mpos[1];\r\n    }\r\n\r\n    if (debug) console.log(x, y, dx, dy);\r\n\r\n    let tab = this.tab, tbar = this.tbar;\r\n    let axis = tbar.horiz ? 0 : 1;\r\n    let distx, disty;\r\n\r\n    if (tbar.horiz) {\r\n      tab.pos[0] += dx;\r\n      disty = Math.abs(y - this.start_mpos[1]);\r\n    } else {\r\n      tab.pos[1] += dy;\r\n      disty = Math.abs(x - this.start_mpos[0]);\r\n    }\r\n\r\n    let limit = 50;\r\n    let csize = tbar.horiz ? this.tbar.canvas.width : this.tbar.canvas.height;\r\n\r\n    let dragok = tab.pos[axis] + tab.size[axis] < -limit || tab.pos[axis] >= csize + limit;\r\n    dragok = dragok || disty > limit*1.5;\r\n    dragok = dragok && (this.tbar.draggable || this.tbar.getAttribute(\"draggable\"));\r\n\r\n    //console.log(dragok, disty, this.tbar.draggable);\r\n\r\n    if (dragok) {\r\n      this.dragstate = true;\r\n      this.dragevent = new DragEvent(\"dragstart\", {\r\n        dataTransfer: new DataTransfer()\r\n      });\r\n\r\n      this.dragtab = tab;\r\n      let g = this.tbar.g;\r\n      this.dragimg = g.getImageData(~~tab.pos[0], ~~tab.pos[1], ~~tab.size[0], ~~tab.size[1]);\r\n      this.dragcanvas = document.createElement(\"canvas\");\r\n      let g2 = this.drag_g = this.dragcanvas.getContext(\"2d\");\r\n\r\n      this.dragcanvas.visibleToPick = false;\r\n      this.dragcanvas.width = ~~tab.size[0];\r\n      this.dragcanvas.height = ~~tab.size[1];\r\n      this.dragcanvas.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n      this.dragcanvas.style[\"position\"] = UIBase.PositionKey;\r\n      this.dragcanvas.style[\"left\"] = e.x + \"px\";\r\n      this.dragcanvas.style[\"top\"] = e.y + \"px\";\r\n      this.dragcanvas.style[\"z-index\"] = \"500\";\r\n      document.body.appendChild(this.dragcanvas);\r\n      g2.putImageData(this.dragimg, 0, 0);\r\n\r\n\r\n      this.tbar.dispatchEvent(this.dragevent);\r\n\r\n      return;\r\n    }\r\n\r\n    let ti = tbar.tabs.indexOf(tab);\r\n    let next = ti < tbar.tabs.length - 1 ? tbar.tabs[ti + 1] : undefined;\r\n    let prev = ti > 0 ? tbar.tabs[ti - 1] : undefined;\r\n\r\n    if (next !== undefined && next.movable && tab.pos[axis] > next.pos[axis]) {\r\n      tbar.swapTabs(tab, next);\r\n    } else if (prev !== undefined && prev.movable && tab.pos[axis] < prev.pos[axis] + prev.size[axis]*0.5) {\r\n      tbar.swapTabs(tab, prev);\r\n    }\r\n\r\n    tbar.update(true);\r\n\r\n    this.mpos[0] = x;\r\n    this.mpos[1] = y;\r\n\r\n    let e2 = tab.sendEvent(\"tabdragmove\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      this.finish();\r\n    }\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (debug) console.log(e.keyCode);\r\n\r\n    switch (e.keyCode) {\r\n      case keymap.Escape: //escape\r\n      case keymap.Space: //space\r\n      case keymap.Enter: //enter\r\n      case keymap.Tab: //tab\r\n        this.finish();\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nexport class TabBar extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    let style = document.createElement(\"style\");\r\n    let canvas = document.createElement(\"canvas\");\r\n\r\n    this.iconsheet = 0;\r\n    this.movableTabs = true;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tabs = [];\r\n    this.tabs.active = undefined;\r\n    this.tabs.highlight = undefined;\r\n\r\n    this._last_style_key = undefined;\r\n\r\n    canvas.style[\"width\"] = \"145px\";\r\n    canvas.style[\"height\"] = \"45px\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    this.canvas = canvas;\r\n    this.g = canvas.getContext(\"2d\");\r\n\r\n    this.canvas.style[\"touch-action\"] = \"none\";\r\n\r\n    style.textContent = `\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n    this.shadow.appendChild(canvas);\r\n\r\n    this._last_dpi = undefined;\r\n    this._last_pos = undefined;\r\n\r\n    this.horiz = true;\r\n    this.onchange = null;\r\n    this.onselect = null; //onselect is like onchange, but fires even if tab hasn't changed\r\n\r\n    let mx, my;\r\n\r\n    this.canvas.addEventListener(\"pointermove\", (e) => {\r\n      this.on_pointermove(e);\r\n    }, false);\r\n\r\n\r\n    this.canvas.addEventListener(\"pointerdown\", (e) => {\r\n      this.on_pointerdown(e);\r\n    });\r\n  }\r\n\r\n  _doelement(e, mx, my) {\r\n    for (let tab of this.tabs) {\r\n      let ok;\r\n\r\n      if (this.horiz) {\r\n        ok = mx >= tab.pos[0] && mx <= tab.pos[0] + tab.size[0];\r\n      } else {\r\n        ok = my >= tab.pos[1] && my <= tab.pos[1] + tab.size[1];\r\n      }\r\n\r\n      if (ok && this.tabs.highlight !== tab) {\r\n        this.tabs.highlight = tab;\r\n        this.update(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  _domouse(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n\r\n    let mx = e.x - r.x;\r\n    let my = e.y - r.y;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    mx *= dpi;\r\n    my *= dpi;\r\n\r\n    this._doelement(e, mx, my);\r\n\r\n    const is_mdown = e.type === \"mousedown\" || e.type == \"pointerdown\";\r\n    if (is_mdown && this.onselect && this._fireOnSelect().defaultPrevented) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  _doclick(e) {\r\n    this._domouse(e);\r\n\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (debug) console.log(\"mdown\");\r\n\r\n    if (e.button !== 0) {\r\n      return;\r\n    }\r\n\r\n    let ht = this.tabs.highlight;\r\n\r\n    let acte = {};\r\n    for (let k in e) {\r\n      if (k === \"defaultPrevented\" || k === \"cancelBubble\") {\r\n        continue;\r\n      }\r\n\r\n      acte[k] = e[k];\r\n    }\r\n\r\n    acte.target = ht;\r\n    acte.pointerId = e.pointerId;\r\n\r\n    acte = new PointerEvent(\"tabactive\", acte);\r\n\r\n    let e2 = ht.sendEvent(\"tabclick\", e);\r\n\r\n    if (e2.defaultPrevented) {\r\n      acte.preventDefault();\r\n    }\r\n\r\n    if (ht !== undefined && this.tool === undefined) {\r\n      this.setActive(ht, acte);\r\n\r\n      if (this.movableTabs && !acte.defaultPrevented) {\r\n        this._startMove(ht, e);\r\n      }\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  on_pointerdown(e) {\r\n    this._doclick(e);\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let r = this.canvas.getClientRects()[0];\r\n    this._domouse(e);\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n\r\n  }\r\n\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n    e.updatePos(true);\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabbar-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    if (this.tool) {\r\n      this.tool.finish();\r\n      this.tool = undefined;\r\n    }\r\n  }\r\n\r\n  get tool() {\r\n    return this._tool;\r\n  }\r\n\r\n  set tool(v) {\r\n    //console.warn(\"SET TOOL\", v, this._id);\r\n    this._tool = v;\r\n  }\r\n\r\n  _startMove(tab = this.tabs.active, event, pointerId = event ? event.pointerId : undefined, pointerElem = tab) {\r\n    if (this.movableTabs) {\r\n      let e2 = tab.sendEvent(\"tabdragstart\", event);\r\n\r\n      if (e2.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      if (this.tool) {\r\n        this.tool.finish();\r\n      }\r\n\r\n      let edom = this.getScreen();\r\n      let tool = this.tool = new ModalTabMove(tab, this, edom);\r\n\r\n      if (event && pointerElem && pointerId !== undefined) {\r\n        tool.pushPointerModal(pointerElem, pointerId);\r\n      } else {\r\n        tool.pushModal(edom, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  _fireOnSelect() {\r\n    let e = this._makeOnSelectEvt();\r\n\r\n    if (this.onselect) {\r\n      this.onselect(e);\r\n    }\r\n\r\n    return e;\r\n  }\r\n\r\n  _makeOnSelectEvt() {\r\n    return {\r\n      tab             : this.tabs.highlight,\r\n      defaultPrevented: false,\r\n      preventDefault() {\r\n        this.defaultPrevented = true;\r\n      }\r\n    }\r\n    /*\r\n      return new MouseEvent(\"mousedown\", {\r\n        target : [this.tabs.highlight],\r\n        tab : \"sdfdsf\"\r\n      });\r\n\r\n   */\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    for (let tab of this.tabs) {\r\n      if (tab.id === name_or_id || tab.name === name_or_id)\r\n        return tab;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  clear() {\r\n    for (let t of this.tabs) {\r\n      if (t.dom) {\r\n        t.dom.remove();\r\n      }\r\n\r\n      t.remove();\r\n    }\r\n\r\n    this.tabs = [];\r\n    this.setCSS();\r\n    this._redraw();\r\n  }\r\n\r\n  saveData() {\r\n    let taborder = [];\r\n\r\n    for (let tab of this.tabs) {\r\n      taborder.push(tab.name);\r\n    }\r\n\r\n    let act = this.tabs.active !== undefined ? this.tabs.active.name : \"null\";\r\n\r\n    return {\r\n      taborder: taborder,\r\n      active  : act\r\n    };\r\n  }\r\n\r\n  loadData(obj) {\r\n    if (!obj.taborder) {\r\n      return;\r\n    }\r\n\r\n    let tabs = this.tabs;\r\n    let active = undefined;\r\n    let ntabs = [];\r\n\r\n    ntabs.active = undefined;\r\n    ntabs.highlight = undefined;\r\n\r\n    for (let tname of obj.taborder) {\r\n      let tab = this.getTab(tname);\r\n\r\n      if (tab === undefined) {\r\n        continue;\r\n      }\r\n\r\n      if (tab.name === obj.active) {\r\n        active = tab;\r\n      }\r\n\r\n      ntabs.push(tab);\r\n    }\r\n\r\n    for (let tab of tabs) {\r\n      if (ntabs.indexOf(tab) < 0) {\r\n        ntabs.push(tab);\r\n      }\r\n    }\r\n\r\n    this.tabs = ntabs;\r\n\r\n    try {\r\n      if (active !== undefined) {\r\n        this.setActive(active);\r\n      } else if (this.tabs.length > 0) {\r\n        this.setActive(this.tabs[0]);\r\n      }\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n\r\n    this.update(true);\r\n\r\n    return this;\r\n  }\r\n\r\n  swapTabs(a, b) {\r\n    let tabs = this.tabs;\r\n\r\n    let ai = tabs.indexOf(a);\r\n    let bi = tabs.indexOf(b);\r\n\r\n    tabs[ai] = b;\r\n    tabs[bi] = a;\r\n\r\n    this.update(true);\r\n  }\r\n\r\n  addIconTab(icon, id, tooltip, movable = true) {\r\n    let tab = this.addTab(\"\", id, tooltip, movable);\r\n    tab.icon = icon;\r\n\r\n    return tab;\r\n  }\r\n\r\n  addTab(name, id, tooltip = \"\", movable) {\r\n    let tab = UIBase.createElement(\"tab-item-x\", true);\r\n\r\n    this.shadow.appendChild(tab);\r\n    tab.parentWidget = this;\r\n\r\n\r\n    tab.name = name;\r\n    tab.id = id;\r\n    tab.tooltip = tooltip;\r\n    tab.movable = movable;\r\n    tab.tbar = this;\r\n\r\n    this.tabs.push(tab);\r\n    this.update(true);\r\n\r\n    if (this.tabs.length === 1) {\r\n      this.setActive(this.tabs[0]);\r\n    }\r\n\r\n    return tab;\r\n  }\r\n\r\n  updatePos(force_update = false) {\r\n    let pos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (pos !== this._last_pos || force_update) {\r\n      this._last_pos = pos;\r\n\r\n      this.horiz = pos === \"top\" || pos === \"bottom\";\r\n      if (debug) console.log(\"tab bar position update\", this.horiz);\r\n\r\n      if (this.horiz) {\r\n        this.style[\"width\"] = \"100%\";\r\n        delete this.style[\"height\"];\r\n      } else {\r\n        this.style[\"height\"] = \"100%\";\r\n        delete this.style[\"width\"];\r\n      }\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  updateDPI(force_update = false) {\r\n    let dpi = this.getDPI();\r\n\r\n    if (dpi !== this._last_dpi) {\r\n      if (debug) console.log(\"DPI update!\");\r\n      this._last_dpi = dpi;\r\n\r\n      this.updateCanvas(true);\r\n    }\r\n  }\r\n\r\n  updateCanvas(force_update = false) {\r\n    let canvas = this.canvas;\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let rwidth = getpx(this.canvas.style[\"width\"]);\r\n    let rheight = getpx(this.canvas.style[\"height\"]);\r\n\r\n    let width = ~~(rwidth*dpi);\r\n    let height = ~~(rheight*dpi);\r\n\r\n    let update = force_update;\r\n    update = update || canvas.width !== width || canvas.height !== height;\r\n\r\n    if (update) {\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  _getFont(tsize) {\r\n    let font = this.getDefault(\"TabText\");\r\n\r\n    if (this.tabFontScale !== 1.0) {\r\n      font = font.copy();\r\n      font.size *= this.tabFontScale;\r\n    }\r\n\r\n    return font;\r\n  }\r\n\r\n  _layout() {\r\n    if ((!this.ctx || !this.ctx.screen) && !this.isDead()) {\r\n      this.doOnce(this._layout);\r\n    }\r\n\r\n    let g = this.g;\r\n\r\n    if (debug) console.log(\"tab layout\");\r\n\r\n    let dpi = this.getDPI();\r\n\r\n    let font = this._getFont();\r\n    let tsize = (font.size*dpi);\r\n\r\n    g.font = font.genCSS(tsize);\r\n\r\n    let axis = this.horiz ? 0 : 1;\r\n\r\n    let pad = 4*dpi + Math.ceil(tsize*0.25);\r\n    let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n\r\n    let x = pad;\r\n    let y = 0.0;\r\n\r\n    let h = tsize + Math.ceil(tsize*0.5) + hpad;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n    let have_icons = false;\r\n\r\n    for (let tab of this.tabs) {\r\n      if (tab.icon !== undefined) {\r\n        have_icons = true;\r\n        h = Math.max(h, iconsize + 4);\r\n        break;\r\n      }\r\n    }\r\n\r\n    let r1 = this.parentWidget ? this.parentWidget.getClientRects()[0] : undefined;\r\n    let r2 = this.canvas.getClientRects()[0];\r\n\r\n    let rx = 0, ry = 0;\r\n    if (r2) {\r\n      rx = r2.x;//r2.x - r1.x;\r\n      ry = r2.y; //r2.y - r1.y;\r\n    }\r\n\r\n    let ti = -1;\r\n\r\n    let makeTabWatcher = (tab) => {\r\n      if (tab.watcher) {\r\n        clearInterval(tab.watcher.timer);\r\n      }\r\n\r\n      let watcher = () => {\r\n        let dead = this.tabs.indexOf(tab) < 0;\r\n        dead = dead || this.isDead();\r\n\r\n        if (dead) {\r\n          if (tab.dom)\r\n            tab.dom.remove();\r\n          tab.dom = undefined;\r\n\r\n          if (tab.watcher.timer)\r\n            clearInterval(tab.watcher.timer);\r\n        }\r\n      };\r\n\r\n      tab.watcher = watcher;\r\n      tab.watcher.timer = window.setInterval(watcher, 750);\r\n\r\n      return tab.watcher.timer;\r\n    };\r\n\r\n    let haveTabDom = false;\r\n    for (let tab of this.tabs) {\r\n      if (tab.extra) {\r\n        haveTabDom = true;\r\n      }\r\n    }\r\n\r\n    if (haveTabDom && this.ctx && this.ctx.screen && !this._size_cb) {\r\n      this._size_cb = () => {\r\n        if (this.isDead()) {\r\n          this.ctx.screen.removeEventListener(\"resize\", this._size_cb);\r\n          this._size_cb = undefined;\r\n          return;\r\n        }\r\n        if (!this.ctx) return;\r\n\r\n        this._layout();\r\n        this._redraw();\r\n      };\r\n\r\n      this.ctx.screen.addEventListener(\"resize\", this._size_cb);\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab.extra && !tab.dom) {\r\n\r\n        tab.dom = document.createElement(\"div\");\r\n        tab.dom.style[\"margin\"] = tab.dom.style[\"padding\"] = \"0px\";\r\n\r\n        //XXX breaks mobile\r\n        //let z = this.calcZ();\r\n        //tab.dom.style[\"z-index\"] = z - 1 - ti;\r\n\r\n        document.body.appendChild(tab.dom);\r\n        tab.dom.style[\"position\"] = UIBase.PositionKey;\r\n        tab.dom.style[\"display\"] = \"flex\";\r\n        tab.dom.style[\"flex-direction\"] = this.horiz ? \"row\" : \"column\";\r\n\r\n        tab.dom.style[\"pointer-events\"] = \"none\";\r\n\r\n        if (!this.horiz) {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        } else {\r\n          tab.dom.style[\"width\"] = (tab.size[0]/dpi) + \"px\";\r\n          tab.dom.style[\"height\"] = (tab.size[1]/dpi) + \"px\";\r\n          tab.dom.style[\"left\"] = (rx + tab.pos[0]/dpi) + \"px\";\r\n          tab.dom.style[\"top\"] = (ry + tab.pos[1]/dpi) + \"px\";\r\n        }\r\n\r\n        let font = this._getFont();\r\n        tab.dom.style[\"font\"] = font.genCSS();\r\n        tab.dom.style[\"color\"] = font.color;\r\n\r\n        tab.dom.appendChild(tab.extra);\r\n\r\n        //tab.dom.style[\"background-color\"] = \"red\";\r\n\r\n        makeTabWatcher(tab);\r\n      }\r\n\r\n      let w = g.measureText(tab.name).width;\r\n\r\n      if (tab.extra) {\r\n        w += tab.extraSize || tab.extra.getClientRects()[0].width;\r\n\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        w += iconsize;\r\n      }\r\n\r\n      //don't interfere with tab dragging\r\n      let bad = this.tool !== undefined && tab === this.tabs.active;\r\n\r\n      if (!bad) {\r\n        tab.pos[axis] = x;\r\n        tab.pos[axis ^ 1] = y;\r\n      }\r\n\r\n      //tab.size = [0, 0];\r\n      tab.size[axis] = w + pad*2;\r\n      tab.size[axis ^ 1] = h;\r\n\r\n      x += w + pad*2;\r\n    }\r\n\r\n    x = (~~(x + pad))/dpi;\r\n    h = (~~h)/dpi;\r\n\r\n\r\n    if (this.horiz) {\r\n      this.canvas.style[\"width\"] = x + \"px\";\r\n      this.canvas.style[\"height\"] = h + \"px\";\r\n    } else {\r\n      this.canvas.style[\"height\"] = x + \"px\";\r\n      this.canvas.style[\"width\"] = h + \"px\";\r\n    }\r\n\r\n    for (let tab of this.tabs) {\r\n      tab.setCSS();\r\n    }\r\n\r\n    //this.canvas.width = x;\r\n  }\r\n\r\n  /** tab is a TabItem instance */\r\n  setActive(tab, event) {\r\n    if (tab.noSwitch) {\r\n      return;\r\n    }\r\n\r\n    let update = tab !== this.tabs.active;\r\n    this.tabs.active = tab;\r\n\r\n    if (update) {\r\n      if (!util.isMobile() && this.getDefault(\"focus-on-tab-click\")) {\r\n        tab.focus({preventScroll: true, focusVisible: false});\r\n      }\r\n\r\n      if (this.onchange)\r\n        this.onchange(tab, event);\r\n\r\n      this.update(true);\r\n    }\r\n  }\r\n\r\n  _redraw() {\r\n    let g = this.g;\r\n\r\n    let activecolor = this.getDefault(\"TabActive\") || \"rgba(0,0,0,0)\";\r\n\r\n    if (debug) console.log(\"tab draw\");\r\n\r\n    g.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    let dpi = this.getDPI();\r\n    let font = this._getFont();\r\n\r\n    let tsize = font.size;\r\n    let iconsize = iconmanager.getTileSize(this.iconsheet);\r\n\r\n    tsize = (tsize*dpi);\r\n    g.font = font.genCSS(tsize);\r\n\r\n    g.lineWidth = 2;\r\n    g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n\r\n    let r = this.r*dpi;\r\n    this._layout();\r\n    let tab;\r\n\r\n    const draw_text = (name, x2, y2) => {\r\n      let hpad = this.getDefault(\"TabPadding\", undefined, 0.0);\r\n      if (this.horiz) {\r\n        y2 += hpad*0.5;\r\n      } else {\r\n        y2 -= hpad*0.5;\r\n      }\r\n\r\n      g.fillText(tab.name, x2, y2);\r\n    };\r\n\r\n    let ti = -1;\r\n    for (tab of this.tabs) {\r\n      ti++;\r\n\r\n      if (tab === this.tabs.active)\r\n        continue;\r\n\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.highlight) {\r\n        let p = 2;\r\n\r\n        g.beginPath();\r\n        g.rect(x + p, y + p, w - p*2, h - p*2);\r\n        g.fillStyle = this.getDefault(\"TabHighlight\");\r\n        g.fill();\r\n      }\r\n\r\n      g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n      if (!this.horiz) {\r\n        let x3 = 0, y3 = y2;\r\n\r\n        g.save();\r\n        g.translate(x3, y3);\r\n        g.rotate(Math.PI/2);\r\n        g.translate(x3 - tsize, -y3 - tsize*0.5);\r\n      }\r\n\r\n      if (tab.icon !== undefined) {\r\n        iconmanager.canvasDraw(this, this.canvas, g, tab.icon, x, y, this.iconsheet);\r\n        x2 += iconsize + 4;\r\n      }\r\n\r\n      draw_text(tab.name, x2, y2);\r\n\r\n      if (!this.horiz) {\r\n        g.restore();\r\n      }\r\n\r\n      let prev = this.tabs[Math.max(ti - 1 + this.tabs.length, 0)];\r\n      let next = this.tabs[Math.min(ti + 1, this.tabs.length - 1)];\r\n\r\n      if (tab !== this.tabs[this.tabs.length - 1] && prev !== this.tabs.active && next !== this.tabs.active) {\r\n        g.beginPath();\r\n        if (this.horiz) {\r\n          g.moveTo(x + w, h - 5);\r\n          g.lineTo(x + w, 5);\r\n        } else {\r\n          g.moveTo(w - 5, y + h);\r\n          g.lineTo(5, y + h);\r\n        }\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle1\");\r\n        g.stroke();\r\n      }\r\n    }\r\n\r\n    let th = tsize;\r\n\r\n    //draw active tab\r\n    tab = this.tabs.active;\r\n    if (tab) {\r\n      let x = tab.pos[0], y = tab.pos[1];\r\n      let w = tab.size[0], h = tab.size[1];\r\n      //let tw = g.measureText(tab.name).width;\r\n      let tw = ui_base.measureText(this, tab.name, this.canvas, g, tsize, font).width;\r\n\r\n      if (this.horiz) {\r\n        h += 2;\r\n      } else {\r\n        w += 2;\r\n      }\r\n\r\n      let x2 = x + (tab.size[this.horiz ^ 1] - tw)*0.5;\r\n      let y2 = y + tsize;\r\n\r\n      if (tab === this.tabs.active) {\r\n        /*\r\n        let x = !this.horiz ? tab.y : tab.x;\r\n        let y = !this.horiz ? tab.x : tab.y;\r\n        let w = !this.horiz ? tab.size[1] : tab.size[0];\r\n        let h = !this.horiz ? tab.size[0] : tab.size[1];\r\n\r\n        if (!this.horiz) {\r\n          //g.save();\r\n          //g.translate(0, y);\r\n          //g.rotate(Math.PI/16);\r\n          //g.translate(0, -y);\r\n        }//*/\r\n\r\n        g.beginPath();\r\n        //g.lineWidth *= 5;\r\n        let ypad = 2;\r\n\r\n        g.strokeStyle = this.getDefault(\"TabStrokeStyle2\");\r\n        g.fillStyle = activecolor;\r\n        let r2 = r*1.5;\r\n\r\n        if (this.horiz) {\r\n          g.moveTo(x - r, h);\r\n          g.quadraticCurveTo(x, h, x, h - r);\r\n          g.lineTo(x, r2);\r\n          g.quadraticCurveTo(x, ypad, x + r2, ypad)\r\n          g.lineTo(x + w - r2, ypad);\r\n          g.quadraticCurveTo(x + w, 0, x + w, r2);\r\n          g.lineTo(x + w, h - r2);\r\n          g.quadraticCurveTo(x + w, h, x + w + r, h);\r\n\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        } else {\r\n          g.moveTo(w, y - r);\r\n          g.quadraticCurveTo(w, y, w - r, y);\r\n          ///*\r\n          g.lineTo(r2, y);\r\n          g.quadraticCurveTo(ypad, y, ypad, y + r2);\r\n          g.lineTo(ypad, y + h - r2);\r\n          g.quadraticCurveTo(0, y + h, r2, y + h);\r\n          g.lineTo(w - r2, y + h);\r\n          g.quadraticCurveTo(w, y + h, w, y + h + r);\r\n          //*/\r\n          g.stroke()\r\n          //\r\n          g.closePath()\r\n        }\r\n\r\n        let cw = this.horiz ? this.canvas.width : this.canvas.height;\r\n\r\n        let worig = g.lineWidth;\r\n\r\n        g.lineWidth *= 0.5;\r\n\r\n        g.fill();\r\n        //g.stroke();\r\n\r\n        g.lineWidth = worig;\r\n\r\n        if (!this.horiz) {\r\n          let x3 = 0, y3 = y2;\r\n\r\n          g.save();\r\n          g.translate(x3, y3);\r\n          g.rotate(Math.PI/2);\r\n          g.translate(-x3 - tsize, -y3 - tsize*0.5);\r\n        }\r\n\r\n        g.fillStyle = this.getDefault(\"TabText\").color;\r\n\r\n        draw_text(tab.name, x2, y2);\r\n\r\n        if (!this.horiz) {\r\n          g.restore();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeTab(tab) {\r\n    this.tabs.remove(tab);\r\n    if (tab === this.tabs.active) {\r\n      this.tabs.active = this.tabs[0];\r\n    }\r\n\r\n    this._layout();\r\n    this._redraw();\r\n    this.setCSS();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS(false);\r\n\r\n    /* create a no stacking context */\r\n    this.style[\"contain\"] = \"layout\";\r\n\r\n    this.r = this.getDefault(\"TabBarRadius\", undefined, 8);\r\n\r\n    let r = this.r !== undefined ? this.r : 3;\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.canvas.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n    this.canvas.style[\"border-radius\"] = r + \"px\";\r\n    //this.style[\"background-color\"] = this.getDefault(\"TabInactive\");\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n    key += this.getDefault(\"TabActive\");\r\n    key += this.getDefault(\"TabInactive\");\r\n    key += this.getDefault(\"TabBarRadius\");\r\n    key += this.getDefault(\"TabStrokeStyle1\");\r\n    key += this.getDefault(\"TabStrokeStyle2\");\r\n    key += this.getDefault(\"TabHighlight\");\r\n    key += JSON.stringify(this.getDefault(\"TabText\"));\r\n    key += this.tabFontScale;\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n\r\n      this._layout();\r\n      this.setCSS();\r\n      this._redraw();\r\n    }\r\n  }\r\n\r\n  update(force_update = false) {\r\n    let rect = this.getClientRects()[0];\r\n    if (rect) {\r\n      let key = Math.floor(rect.x*4.0) + \":\" + Math.floor(rect.y*4.0);\r\n      if (key !== this._last_p_key) {\r\n        this._last_p_key = key;\r\n\r\n        //console.log(\"tab bar autobuild\");\r\n        this._layout();\r\n      }\r\n    }\r\n    super.update();\r\n\r\n    this.updateStyle();\r\n    this.updatePos(force_update);\r\n    this.updateDPI(force_update);\r\n    this.updateCanvas(force_update);\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabBar);\r\n\r\nexport class TabContainer extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_style_key = \"\";\r\n\r\n    this.dataPrefix = \"\";\r\n\r\n    this.inherit_packflag = 0;\r\n    this.packflag = 0;\r\n\r\n    this.tabFontScale = 1.0;\r\n\r\n    this.tbar = UIBase.createElement(\"tabbar-x\");\r\n    this.tbar.parentWidget = this;\r\n    this.tbar.setAttribute(\"class\", \"_tbar_\" + this._id);\r\n    this.tbar.constructor.setDefault(this.tbar);\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this._remakeStyle();\r\n\r\n    this.tabs = {};\r\n\r\n    this._last_horiz = undefined;\r\n    this._last_bar_pos = undefined;\r\n    this._tab = undefined;\r\n\r\n    let div = document.createElement(\"div\");\r\n    div.setAttribute(\"class\", `_tab_${this._id}`);\r\n    div.appendChild(this.tbar);\r\n    this.shadow.appendChild(div);\r\n\r\n    this.tbar.parentWidget = this;\r\n\r\n    this.tbar.onselect = (e) => {\r\n      if (this.onselect) {\r\n        this.onselect(e);\r\n      }\r\n    };\r\n\r\n    this.tbar.onchange = (tab, event) => {\r\n      if (this._tab) {\r\n        HTMLElement.prototype.remove.call(this._tab);\r\n      }\r\n\r\n      this._tab = this.tabs[tab.id];\r\n      //this._tab = document.createElement(\"div\");\r\n      //this._tab.innerText = \"SDfdsfsdyay\";\r\n\r\n      this._tab.parentWidget = this;\r\n\r\n      //ensure we get full update convergence when switching\r\n      //tabs\r\n      for (let i = 0; i < 2; i++) {\r\n        this._tab.flushUpdate();\r\n      }\r\n\r\n      let div = document.createElement(\"div\");\r\n\r\n      this.tbar.setCSS.once(() => div.style[\"background-color\"] = this.getDefault(\"background-color\"), div);\r\n\r\n      div.setAttribute(\"class\", `_tab_${this._id}`);\r\n      div.appendChild(this._tab);\r\n\r\n      this.shadow.appendChild(div);\r\n\r\n      if (this.onchange) {\r\n        this.onchange(tab, event);\r\n      }\r\n    }\r\n  }\r\n\r\n  get movableTabs() {\r\n    let attr;\r\n\r\n    if (!this.hasAttribute(\"movable-tabs\")) {\r\n      attr = this.getDefault(\"movable-tabs\");\r\n\r\n      if (attr === undefined || attr === null) {\r\n        attr = \"true\";\r\n      }\r\n\r\n      if (typeof attr === \"boolean\" || typeof attr === \"number\") {\r\n        attr = attr ? \"true\" : \"false\";\r\n      }\r\n    } else {\r\n      attr = \"\" + this.getAttribute(\"movable-tabs\");\r\n    }\r\n\r\n    attr = attr.toLowerCase();\r\n\r\n    return attr === \"true\";\r\n  }\r\n\r\n  set movableTabs(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"movable-tabs\", val ? \"true\" : \"false\");\r\n    this.tbar.movableTabs = this.movableTabs;\r\n  }\r\n\r\n  get hideScrollBars() {\r\n    let attr = (\"\" + this.getAttribute(\"hide-scrollbars\")).toLowerCase();\r\n    return attr === \"true\" || attr === \"yes\";\r\n  }\r\n\r\n  set hideScrollBars(val) {\r\n    val = !!val;\r\n\r\n    this.setAttribute(\"hide-scrollbars\", \"\" + val);\r\n  }\r\n\r\n  static setDefault(e) {\r\n    e.setAttribute(\"bar_pos\", \"top\");\r\n\r\n    return e;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"tabcontainer-x\",\r\n      style  : \"tabs\"\r\n    };\r\n  }\r\n\r\n  _startMove(tab = this.tbar.tabs.active, event) {\r\n    return this.tbar._startMove(tab, event);\r\n  }\r\n\r\n  _ensureNoModal() {\r\n    return this.tbar._ensureNoModal();\r\n  }\r\n\r\n  saveData() {\r\n    let json = super.saveData() || {};\r\n    json.tabs = {};\r\n\r\n    for (let k in this.tabs) {\r\n      let tab = this.tabs[k];\r\n\r\n      if (k === this.tbar.tabs.active.id) {\r\n        //no need to save active tab here\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        json.tabs[tab.id] = JSON.parse(saveUIData(tab, \"tab\"));\r\n      } catch (error) {\r\n        console.error(\"Failed to save tab UI layout\", tab.id);\r\n      }\r\n    }\r\n\r\n    return json;\r\n  }\r\n\r\n  loadData(json) {\r\n    if (!json.tabs) {\r\n      return;\r\n    }\r\n\r\n    for (let k in json.tabs) {\r\n      if (!(k in this.tabs)) {\r\n        continue;\r\n      }\r\n\r\n      let uidata = JSON.stringify(json.tabs[k]);\r\n      loadUIData(this.tabs[k], uidata);\r\n    }\r\n  }\r\n\r\n  enableDrag() {\r\n    this.tbar.draggable = this.draggable = true;\r\n    this.tbar.addEventListener(\"dragstart\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragstart\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragover\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragover\", e));\r\n    });\r\n    this.tbar.addEventListener(\"dragexit\", (e) => {\r\n      this.dispatchEvent(new DragEvent(\"dragexit\", e));\r\n    });\r\n    /*\r\n    let doms = [this, this.tbar, this.tbar.canvas];\r\n    for (let dom of doms) {\r\n      dom.setAttribute(\"draggable\", \"true\");\r\n      dom.draggable = true;\r\n\r\n      dom.addEventListener(\"dragstart\", (e) => {\r\n        console.log(\"drag start\", e);\r\n      });\r\n\r\n      dom.addEventListener(\"drag\", (e) => {\r\n        console.log(\"drag\", e);\r\n      });\r\n    }*/\r\n  }\r\n\r\n  clear() {\r\n    this.tbar.clear();\r\n    if (this._tab !== undefined) {\r\n      HTMLElement.prototype.remove.call(this._tab);\r\n      this._tab = undefined;\r\n    }\r\n\r\n    this.tabs = {};\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n    this._remakeStyle();\r\n  }\r\n\r\n  _remakeStyle() {\r\n    let horiz = this.tbar.horiz;\r\n    let display = \"flex\";\r\n    let flexDir = !horiz ? \"row\" : \"column\";\r\n    let bgcolor = this.__background; //this.getDefault(\"background-color\");\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      ._tab_${this._id} {\r\n        display : ${display};\r\n        flex-direction : ${flexDir};\r\n        margin : 0px;\r\n        padding : 0px;\r\n        align-self : flex-start;\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n      \r\n      ._tbar_${this._id} {\r\n        list-style-type : none;\r\n        align-self : flex-start;\r\n        background-color : ${bgcolor};\r\n        flex-direction : ${flexDir};\r\n        ${!horiz ? \"vertical-align : top;\" : \"\"}\r\n      }\r\n    `;\r\n\r\n    if (this._style)\r\n      this._style.remove();\r\n    this._style = style;\r\n\r\n    this.shadow.prepend(style);\r\n  }\r\n\r\n  icontab(icon, id, tooltip) {\r\n    let t = this.tab(\"\", id, tooltip);\r\n    t._tab.icon = icon;\r\n\r\n    return t;\r\n  }\r\n\r\n  removeTab(tab) {\r\n    let tab2 = tab._tab;\r\n    this.tbar.removeTab(tab2);\r\n    tab.remove();\r\n  }\r\n\r\n  tab(name, id = undefined, tooltip = undefined, movable = true) {\r\n    if (id === undefined) {\r\n      id = tab_idgen++;\r\n    }\r\n\r\n    let col = UIBase.createElement(\"colframe-x\");\r\n\r\n    this.tabs[id] = col;\r\n\r\n    col.dataPrefix = this.dataPrefix;\r\n\r\n    col.ctx = this.ctx;\r\n    col._tab = this.tbar.addTab(name, id, tooltip, movable);\r\n\r\n    col.inherit_packflag |= this.inherit_packflag;\r\n    col.packflag |= this.packflag;\r\n\r\n    //let cls = this.tbar.horiz ? ui.ColumnFrame : ui.RowFrame;\r\n\r\n    col.parentWidget = this;\r\n\r\n    if (col.ctx) {\r\n      col._init();\r\n    }\r\n\r\n    col.setCSS();\r\n\r\n    if (this._tab === undefined) {\r\n      this.setActive(col);\r\n    }\r\n\r\n    col.noSwitch = function () {\r\n      this._tab.noSwitch = true;\r\n      return this;\r\n    }\r\n\r\n    function defineTabEvent(key) {\r\n      key = \"on\" + key;\r\n\r\n      Object.defineProperty(col, key, {\r\n        get() {\r\n          return this._tab[key];\r\n        },\r\n        set(v) {\r\n          this._tab[key] = v;\r\n        }\r\n      });\r\n    }\r\n\r\n    defineTabEvent(\"tabclick\");\r\n    defineTabEvent(\"tabdragmove\");\r\n    defineTabEvent(\"tabdragstart\");\r\n    defineTabEvent(\"tabdragend\");\r\n\r\n    return col;\r\n  }\r\n\r\n  setActive(tab) {\r\n    if (typeof tab === \"string\") {\r\n      tab = this.getTab(tab);\r\n    }\r\n\r\n    if (!tab) {\r\n      return;\r\n    }\r\n\r\n    if (tab._tab !== this.tbar.tabs.active) {\r\n      this.tbar.setActive(tab._tab);\r\n    }\r\n  }\r\n\r\n  getTabCount() {\r\n    return this.tbar.tabs.length;\r\n  }\r\n\r\n  moveTab(tab, i) {\r\n    tab = tab._tab;\r\n\r\n    let tab2 = this.tbar.tabs[i];\r\n\r\n    if (tab !== tab2) {\r\n      this.tbar.swapTabs(tab, tab2);\r\n    }\r\n\r\n    this.tbar.setCSS();\r\n    this.tbar._layout();\r\n    this.tbar._redraw();\r\n  }\r\n\r\n  getTab(name_or_id) {\r\n    if (name_or_id in this.tabs) {\r\n      return this.tabs[name_or_id];\r\n    }\r\n\r\n    for (let k in this.tabs) {\r\n      let t = this.tabs[k];\r\n\r\n      if (t.name === name_or_id) {\r\n        return t;\r\n      }\r\n    }\r\n\r\n    throw new Error(\"Unknown tab \" + name_or_id);\r\n  }\r\n\r\n  updateBarPos() {\r\n    let barpos = this.getAttribute(\"bar_pos\");\r\n\r\n    if (barpos !== this._last_bar_pos) {\r\n      this.horiz = barpos === \"top\" || barpos === \"bottom\";\r\n      this._last_bar_pos = barpos;\r\n\r\n      this.tbar.setAttribute(\"bar_pos\", barpos);\r\n      this.tbar.update(true);\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  updateHoriz() {\r\n    let horiz = this.tbar.horiz;\r\n\r\n    if (this._last_horiz !== horiz) {\r\n      this._last_horiz = horiz;\r\n      this._remakeStyle();\r\n    }\r\n  }\r\n\r\n  updateStyle() {\r\n    let key = \"\" + this.getDefault(\"background-color\");\r\n\r\n    if (key !== this._last_style_key) {\r\n      this._last_style_key = key;\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  getActive() {\r\n    return this.tbar.tabs.active;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.tbar.movableTabs = this.movableTabs;\r\n\r\n    if (this._tab !== undefined) {\r\n      this._tab.update();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = !this.horiz ? \"row\" : \"column\";\r\n\r\n    this.tbar.tabFontScale = this.tabFontScale;\r\n\r\n    this.updateStyle();\r\n    this.updateHoriz();\r\n    this.updateBarPos();\r\n    this.tbar.update();\r\n\r\n    let act = this.tbar.tabs.active;\r\n\r\n    if (act && !this.hideScrollBars) {\r\n      let container = this.tabs[act.id];\r\n\r\n      //propegate overflow-y to tab container as a whole\r\n\r\n      if (container.hasAttribute(\"overflow-y\") && this.style[\"overflow-y\"] !== container.getAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = container.getAttribute(\"overflow-y\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow-y\")) {\r\n        this.style[\"overflow-y\"] = this.getDefault(\"overflow-y\") || \"unset\";\r\n      }\r\n\r\n      if (container.hasAttribute(\"overflow\") && this.style[\"overflow\"] !== container.getAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = container.getAttribute(\"overflow\");\r\n        //container.style[\"overflow-y\"] = \"unset\";\r\n      } else if (!container.hasAttribute(\"overflow\")) {\r\n        this.style[\"overflow\"] = this.getDefault(\"overflow\") || \"unset\";\r\n      }\r\n    } else if (this.hideScrollBars) {\r\n      this.style[\"overflow\"] = this.style[\"overflow-y\"] = \"unset\";\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(TabContainer);\r\n", "//bind module to global var to get at it in console.\r\n//\r\n//note that require has an api for handling circular\r\n//module refs, in such cases do not use these vars.\r\n\r\nimport {Container} from \"../core/ui.js\";\r\n\r\nvar _ui = undefined;\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_curvewidget from './ui_curvewidget.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui_widgets from './ui_widgets.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nlet PropFlags = toolprop.PropFlags;\r\nlet PropSubTypes = toolprop.PropSubTypes;\r\n\r\nlet EnumProperty = toolprop.EnumProperty;\r\n\r\nlet Vector2 = vectormath.Vector2,\r\n  UIBase = ui_base.UIBase,\r\n  PackFlags = ui_base.PackFlags,\r\n  PropTypes = toolprop.PropTypes;\r\n\r\n\r\nconst list = util.list;\r\n\r\nexport class TableRow extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom.remove();\r\n    this.dom = document.createElement(\"tr\");\r\n\r\n    //kind of dumb, but this.dom doesn't live within this element itself, bleh\r\n    //this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tablerow-x\"\r\n  };}\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n\r\n    let td = document.createElement(\"td\");\r\n    td.appendChild(child);\r\n\r\n    this.dom.appendChild(td);\r\n    child.onadd();\r\n  }\r\n};\r\nUIBase.internalRegister(TableRow);\r\n\r\nexport class TableFrame extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.dom = document.createElement(\"table\");\r\n    this.shadow.appendChild(this.dom);\r\n    this.dom.setAttribute(\"class\", \"containerx\");\r\n\r\n    //this.dom.style[\"display\"] = \"block\";\r\n  }\r\n\r\n  update() {\r\n    //this.style[\"display\"] = \"inline-block\";\r\n    super.update();\r\n  }\r\n\r\n  _add(child) {\r\n    child.ctx = this.ctx;\r\n    child.parentWidget = this;\r\n    this.dom.appendChild(child);\r\n    child.onadd();\r\n  }\r\n\r\n  add(child) {\r\n    this._add(child);\r\n  }\r\n\r\n  row() {\r\n    let tr = document.createElement(\"tr\");\r\n    let cls = \"table-tr\";\r\n\r\n    tr.setAttribute(\"class\", cls);\r\n    this.dom.appendChild(tr);\r\n    let this2 = this;\r\n\r\n    function maketd() {\r\n      let td = document.createElement(\"td\");\r\n      tr.appendChild(td);\r\n\r\n      td.style[\"margin\"] = tr.style[\"margin\"];\r\n      td.style[\"padding\"] = tr.style[\"padding\"];\r\n\r\n      let container = UIBase.createElement(\"rowframe-x\");\r\n\r\n      container.ctx = this2.ctx;\r\n      container.parentWidget = this2;\r\n      container.setAttribute(\"class\", cls);\r\n\r\n      td.setAttribute(\"class\", cls);\r\n      td.appendChild(container);\r\n\r\n      return container;\r\n    }\r\n\r\n    //hrm wish I could subclass html elements easier\r\n    let ret = {\r\n      _tr : tr,\r\n\r\n      style : tr.style,\r\n\r\n      focus : function(args) {\r\n        tr.focus(args);\r\n      },\r\n\r\n      blur : function(args) {\r\n        tr.blur(args);\r\n      },\r\n\r\n      remove : () => {\r\n        tr.remove();\r\n      },\r\n\r\n      addEventListener : function(type, cb, arg) {\r\n        tr.addEventListener(type, cb, arg);\r\n      },\r\n\r\n      removeEventListener : function(type, cb, arg) {\r\n        tr.removeEventListener(type, cb, arg);\r\n      },\r\n\r\n      setAttribute : function(attr, val) {\r\n        if (attr == \"class\") {\r\n          cls = val;\r\n        }\r\n\r\n        tr.setAttribute(attr, val);\r\n      },\r\n\r\n      scrollTo : function() {\r\n        return this._tr.scrollTo(...arguments);\r\n      },\r\n\r\n      scrollIntoView : function() {\r\n        return this._tr.scrollIntoView(...arguments);\r\n      },\r\n\r\n      clear : function() {\r\n        for (let node of list(tr.childNodes)) {\r\n          tr.removeChild(node);\r\n        }\r\n      }\r\n    };\r\n\r\n    function makefunc(f) {\r\n      ret[f] = function() {\r\n        let container = maketd();\r\n\r\n        container.background = tr.style[\"background-color\"]; //\"rgba(0,0,0,0)\";\r\n        return container[f].apply(container, arguments);\r\n      }\r\n    }\r\n\r\n    let _bg = \"\";\r\n\r\n    //need to implement proper proxy here!\r\n    Object.defineProperty(ret, \"tabIndex\", {\r\n      set : function(f) {\r\n        tr.tabIndex = f;\r\n      },\r\n\r\n      get : function(f) {\r\n        return tr.tabIndex;\r\n      }\r\n    });\r\n\r\n    Object.defineProperty(ret, \"background\", {\r\n      set : function(bg) {\r\n        _bg = bg;\r\n        tr.style[\"background-color\"] = bg;\r\n\r\n        for (let node of tr.childNodes) {\r\n          if (node.childNodes.length > 0) {\r\n            node.childNodes[0].background = bg;\r\n            node.style[\"background-color\"] = bg;\r\n          }\r\n        }\r\n      }, get : function() {\r\n        return _bg;\r\n      }\r\n    });\r\n\r\n    /*\r\n    Object.defineProperty(ret, \"class\", {\r\n      set(bg) {\r\n        tr.class = bg;\r\n      }\r\n    });//*/\r\n\r\n    ret.cell = () => {\r\n      let container = maketd();\r\n      container.background = tr.style[\"background-color\"];\r\n      return container;\r\n    };\r\n    \r\n    //makefunc(\"cell\");\r\n    makefunc(\"label\");\r\n    makefunc(\"tool\");\r\n    makefunc(\"prop\");\r\n    makefunc(\"pathlabel\");\r\n    makefunc(\"button\");\r\n    makefunc(\"iconbutton\");\r\n    makefunc(\"textbox\");\r\n    makefunc(\"col\");\r\n    makefunc(\"row\");\r\n    makefunc(\"table\");\r\n    makefunc(\"listenum\");\r\n    makefunc(\"check\");\r\n\r\n    return ret;\r\n  }\r\n\r\n  clear() {\r\n    super.clear();\r\n    for (let child of list(this.dom.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tableframe-x\"\r\n  };}\r\n}\r\nUIBase.internalRegister(TableFrame);\r\n\r\n", "\"use strict\";\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as events from '../path-controller/util/events.js';\r\nimport * as simple_toolsys from '../path-controller/toolsys/toolsys.js';\r\nimport * as toolprop from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {TableFrame} from './ui_table.js';\r\nimport {Container, ColumnFrame, RowFrame} from '../core/ui.js';\r\nimport {keymap} from '../path-controller/util/events.js';\r\n\r\nlet EnumProperty = toolprop.EnumProperty,\r\n    PropTypes    = toolprop.PropTypes;\r\n\r\nlet UIBase     = ui_base.UIBase,\r\n    PackFlags  = ui_base.PackFlags,\r\n    IconSheets = ui_base.IconSheets;\r\n\r\nfunction getpx(css) {\r\n  return parseFloat(css.trim().replace(\"px\", \"\"))\r\n}\r\n\r\nclass ListItem extends RowFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    let highlight = () => {\r\n      //console.log(\"listitem mouseover\");\r\n      this.highlight = true;\r\n      this.setBackground();\r\n    };\r\n\r\n    let unhighlight = () => {\r\n      //console.log(\"listitem mouseleave\");\r\n      this.highlight = false;\r\n      this.setBackground();\r\n    };\r\n\r\n    this.addEventListener(\"mouseover\", highlight);\r\n    this.addEventListener(\"mousein\", highlight);\r\n\r\n    this.addEventListener(\"mouseleave\", unhighlight);\r\n    this.addEventListener(\"mouseout\", unhighlight);\r\n    this.addEventListener(\"blur\", unhighlight);\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listitem {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n\r\n    this.shadowRoot.prepend(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listitem-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setAttribute(\"class\", \"listitem\");\r\n\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = this.getDefault(\"ItemHeight\") + \"px\";\r\n    this.style[\"flex-grow\"] = \"unset\";\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  setBackground() {\r\n    if (this.highlight && this.is_active) {\r\n      this.background = this.getDefault(\"ListActiveHighlight\");\r\n    } else if (this.highlight) {\r\n      this.background = this.getDefault(\"ListHighlight\");\r\n    } else if (this.is_active) {\r\n      this.background = this.getDefault(\"ListActive\");\r\n    } else {\r\n      this.background = this.getDefault(\"background-color\");\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.setBackground();\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListItem);\r\n\r\nclass ListBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.idmap = {};\r\n    this.items.active = undefined;\r\n    this.highlight = false;\r\n    this.is_active = false;\r\n\r\n    let style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      .listbox {\r\n        -moz-user-focus: normal;\r\n        moz-user-focus: normal;\r\n        user-focus: normal;\r\n      }\r\n    `;\r\n    this.shadow.prepend(style);\r\n\r\n    this.onkeydown = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Up\"]:\r\n        case keymap[\"Down\"]:\r\n          if (this.items.length == 0)\r\n            return;\r\n\r\n          if (this.items.active === undefined) {\r\n            this.setActive(this.items[0]);\r\n            return;\r\n          }\r\n\r\n          let i = this.items.indexOf(this.items.active);\r\n          let dir = e.keyCode == keymap[\"Up\"] ? -1 : 1;\r\n\r\n          i = Math.max(Math.min(i + dir, this.items.length - 1), 0);\r\n          this.setActive(this.items[i]);\r\n\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.addEventListener(\"keydown\", on_keydown);\r\n\r\n    //this._table =  this.table();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"listbox-x\",\r\n      style  : \"listbox\"\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.setCSS();\r\n\r\n    this.style[\"width\"] = this.getDefault(\"width\") + \"px\";\r\n    this.style[\"height\"] = this.getDefault(\"height\") + \"px\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    //this.setAttribute(\"class\", \"listbox\");\r\n    //this.setAttribute(\"tabindex\", 0);\r\n    //this.tabIndex = 0;\r\n  }\r\n\r\n  addItem(name, id) {\r\n    let item = UIBase.createElement(\"listitem-x\");\r\n\r\n    item._id = id === undefined ? this.items.length : id;\r\n    this.idmap[item._id] = item;\r\n\r\n    //item.addEventListener(\"keydown\", this.onkeydown);\r\n    this.tabIndex = 1;\r\n    this.setAttribute(\"tabindex\", 1);\r\n\r\n    this.add(item);\r\n    this.items.push(item);\r\n\r\n    item.label(name);\r\n    let this2 = this;\r\n\r\n    item.onclick = function () {\r\n      this2.setActive(this);\r\n      this.setBackground();\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  removeItem(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    item.remove();\r\n    delete this.idmap[item._id];\r\n    this.items.remove(item);\r\n  }\r\n\r\n  setActive(item) {\r\n    if (typeof item == \"number\") {\r\n      item = this.idmap[item];\r\n    }\r\n\r\n    //console.log(\"set active!\");\r\n\r\n    if (item === this.items.active) {\r\n      return;\r\n    }\r\n\r\n    if (this.items.active !== undefined) {\r\n      this.items.active.highlight = false;\r\n      this.items.active.is_active = false;\r\n      this.items.active.setBackground();\r\n    }\r\n\r\n    this.items.active = item;\r\n\r\n    if (item) {\r\n      item.is_active = true;\r\n\r\n      item.setBackground();\r\n      item.scrollIntoViewIfNeeded();\r\n    }\r\n\r\n    if (this.onchange) {\r\n      this.onchange(item ? item._id : undefined, item);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(ListBox);\r\n", "import {UIBase} from '../core/ui_base.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport {keymap} from '../path-controller/util/simple_events.js';\r\n\r\nexport class ProgressCircle extends UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.shadow.appendChild(this.canvas);\r\n    this.size = 150;\r\n    this.animreq = undefined;\r\n    this._value = 0.0;\r\n    this.startTime = util.time_ms();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n    this.flagRedraw();\r\n    this.update();\r\n\r\n    //enable keyboard focus\r\n    this.tabIndex = 0;\r\n    this.setAttribute(\"tab-index\", 0);\r\n    this.setAttribute(\"tabindex\", 0);\r\n\r\n    let onkey = (e) => {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          if (this.oncancel) {\r\n            this.oncancel(this);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.addEventListener(\"keydown\", onkey);\r\n    this.canvas.addEventListener(\"keydown\", onkey);\r\n  }\r\n\r\n  flagRedraw() {\r\n    if (this.animreq !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.animreq = requestAnimationFrame(() => {\r\n      this.animreq = undefined;\r\n      this.draw();\r\n    })\r\n  }\r\n\r\n  draw() {\r\n    let c = this.canvas, g = this.g;\r\n\r\n    let clr1 = \"rgb(68,69,83)\";\r\n    let clr2 = \"rgb(141,154,196)\";\r\n    let clr3 = \"rgb(214,110,54)\";\r\n\r\n    let t = (util.time_ms() - this.startTime) / 1000.0;\r\n\r\n    g.save();\r\n    g.clearRect(0, 0, c.width, c.height);\r\n\r\n    g.lineWidth /= c.width*0.5;\r\n    g.scale(c.width, c.height);\r\n    g.translate(0.5, 0.5);\r\n\r\n    g.fillStyle = clr2;\r\n    g.strokeStyle = clr1;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.45, -Math.PI, Math.PI);\r\n    g.fill();\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n    g.arc(0, 0, 0.2, Math.PI, -Math.PI);\r\n    g.stroke();\r\n\r\n    g.beginPath();\r\n\r\n    let th = this._value*Math.PI*2.0;\r\n\r\n    let steps = 12;\r\n    let dth = (Math.PI*2.0) / steps;\r\n    let lwid = g.lineWidth;\r\n    g.lineWidth *= 3;\r\n\r\n    for (let i=0; i<steps; i++) {\r\n      let th1 = i * dth;\r\n      th1 += t;\r\n\r\n      let r1 = 0.2;\r\n      let r2 = 0.45;\r\n      let th2 = th1 + dth*0.5;\r\n\r\n      g.beginPath();\r\n      g.moveTo(Math.cos(th1)*r1, Math.sin(th1)*r1);\r\n      g.lineTo(Math.cos(th2)*r2, Math.sin(th2)*r2);\r\n      g.strokeStyle = \"rgba(255,255,255,0.5)\";\r\n      g.stroke();\r\n    }\r\n\r\n    g.lineWidth = lwid;\r\n\r\n    g.beginPath();\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.4, Math.PI, -Math.PI);\r\n    //g.closePath()\r\n\r\n    g.clip(\"evenodd\");\r\n\r\n    g.beginPath();\r\n    g.fillStyle = clr3;\r\n    g.moveTo(0, 0);\r\n    g.arc(0, 0, 0.45, 0, th);\r\n    g.lineTo(0, 0);\r\n    g.fill();\r\n\r\n    g.strokeStyle = \"rgb(141,154,196)\";\r\n    g.stroke();\r\n\r\n    g.restore();\r\n  }\r\n\r\n  set value(percent) {\r\n    this._value = percent;\r\n    this.flagRedraw();\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  startTimer() {\r\n    if (this.timer !== undefined) {\r\n      return;\r\n    }\r\n\r\n    this.focus();\r\n\r\n    window.setInterval(() => {\r\n      if (!this.isConnected) {\r\n        this.endTimer();\r\n        return;\r\n      }\r\n\r\n      this.flagRedraw();\r\n    }, 50);\r\n  }\r\n\r\n  endTimer() {\r\n    if (this.timer !== undefined) {\r\n      window.clearInterval(this.timer);\r\n    }\r\n    this.timer = undefined;\r\n  }\r\n\r\n  update() {\r\n    if (!this.isConnected && this.timer) {\r\n      this.endTimer();\r\n    }\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (size !== this.canvas.width) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    let c = this.canvas;\r\n\r\n    let size = ~~(this.size*UIBase.getDPI());\r\n\r\n    if (c.width !== size) {\r\n      c.width = c.height = size;\r\n\r\n      size /= UIBase.getDPI();\r\n      c.style[\"width\"] = size + \"px\";\r\n      c.style[\"height\"] = size + \"px\";\r\n\r\n      c.style[\"display\"] = \"flex\";\r\n\r\n      this.style[\"width\"] = size + \"px\";\r\n      this.style[\"height\"] = size + \"px\";\r\n\r\n      //forcibly redraw in this case, do not queue with flagRedraw\r\n      this.draw();\r\n    }\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"align-items\"] = \"center\";\r\n    this.style[\"justify-content\"] = \"center\";\r\n    this.style[\"width\"] = \"100%\";\r\n    this.style[\"height\"] = \"100%\";\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"progress-circle-x\"\r\n    }\r\n  }\r\n}\r\nUIBase.register(ProgressCircle);\r\n", "import {PackFlags, UIBase} from \"../core/ui_base.js\";\r\nimport {ColumnFrame} from \"../core/ui.js\";\r\nimport {PropTypes, PropFlags} from \"../path-controller/toolsys/toolprop.js\";\r\n\r\nimport {UndoFlags, ToolFlags} from \"../path-controller/toolsys/toolsys.js\";\r\nimport {DataPath, DataTypes} from \"../path-controller/controller/controller.js\";\r\n\r\nimport {ToolProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport * as util from '../path-controller/util/util.js';\r\nimport cconst from '../config/const.js';\r\n\r\nconst LastKey = Symbol(\"LastToolPanelId\");\r\nlet tool_idgen = 0;\r\n\r\nexport function getLastToolStruct(ctx) {\r\n  let ret = ctx.state._last_tool;\r\n\r\n  if (!ret) {\r\n    ret = ctx.toolstack.head;\r\n  } else {\r\n    let msg = \"Passing the last tool to last-tool-panel via appstate._last_tool is deprecated;\";\r\n    msg += \"\\nctx.toolstack.head is now used instead.\";\r\n\r\n    console.warn(msg);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nconst last_tool_eventmap = [];\r\n//window.last_tool_eventmap = last_tool_eventmap;\r\n\r\n/* Try to avoid memory leaks when last tool panels are hidden. */\r\nwindow.setInterval(() => {\r\n  for (const entry of last_tool_eventmap) {\r\n    const panel = entry.panel;\r\n    if (!panel.isConnected || panel.hidden) {\r\n      if (window.DEBUG && window.DEBUG.lastToolPanel) {\r\n        console.log(\"Disconnecting last tool panel from toolstack.\");\r\n      }\r\n\r\n      panel.unlinkEvents();\r\n      panel.needsRebuild = true;\r\n      break;\r\n    }\r\n  }\r\n}, 500);\r\n\r\n/*\r\n*\r\n* This panel shows the most recently executed ToolOp's\r\n* settings.  It assumes that recent toolops are accessible\r\n* in ctx.last_tool.\r\n* */\r\nexport class LastToolPanel extends ColumnFrame {\r\n  constructor() {\r\n    super();\r\n\r\n    this.ignoreOnChange = false;\r\n    this.on_change = null;\r\n    this._tool_id = undefined;\r\n    this.useDataPathUndo = false;\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.useDataPathUndo = false;\r\n    this.rebuild();\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  getToolStackHead(ctx) {\r\n    //don't process the root toolop\r\n    let bad = ctx.toolstack.length === 0 || ctx.toolstack.cur >= ctx.toolstack.length;\r\n    bad = bad || ctx.toolstack.cur < 0;\r\n    bad = bad || ctx.toolstack[ctx.toolstack.cur].undoflag & UndoFlags.IS_UNDO_ROOT;\r\n\r\n    if (bad) {\r\n      return undefined;\r\n    }\r\n\r\n    return ctx.toolstack[ctx.toolstack.cur];\r\n  }\r\n\r\n  rebuild() {\r\n    let ctx = this.ctx;\r\n    if (ctx === undefined) {\r\n      this._tool_id = -1; //wait for .ctx\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n\r\n    this.clear();\r\n\r\n    this.label(\"Recent Command Settings\");\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    if (!tool) {\r\n      this.setCSS();\r\n      return;\r\n    }\r\n\r\n    let def = tool.constructor.tooldef();\r\n    let name = def.uiname !== undefined ? def.uiname : def.name;\r\n\r\n    let panel = this.panel(def.uiname);\r\n\r\n    this.on_change = () => {\r\n      if (this.ignoreOnChange) {\r\n        return;\r\n      }\r\n\r\n      if (tool.modalRunning) {\r\n        return;\r\n      }\r\n\r\n      if (tool === ctx.toolstack.head) {\r\n        this.ignoreOnChange = true;\r\n        ctx.toolstack.rerun(tool);\r\n        this.ignoreOnChange = false;\r\n      } else {\r\n        this.unlinkEvents();\r\n      }\r\n    };\r\n\r\n    this.buildTool(ctx, tool, panel);\r\n    this.flushUpdate();\r\n    this.flushUpdate();\r\n  }\r\n\r\n  unlinkEvents() {\r\n    for (const entry of Array.from(last_tool_eventmap)) {\r\n      if (entry.panel === this || !entry.panel.isConnected) {\r\n        entry.prop.off(\"change\", entry.cb);\r\n        last_tool_eventmap.remove(entry);\r\n\r\n        if (entry.panel !== this) {\r\n          entry.panel.needsRebuild = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /** client code can subclass and override this method */\r\n  buildTool(ctx, tool, panel) {\r\n    if (tool.flag & ToolFlags.PRIVATE) {\r\n      return;\r\n    }\r\n\r\n    this.unlinkEvents();\r\n    this.last_tool = tool;\r\n\r\n    panel.useDataPathUndo = false;\r\n    for (let k in tool.inputs) {\r\n      let prop = tool.inputs[k];\r\n\r\n      if (prop.flag & (PropFlags.PRIVATE | PropFlags.READ_ONLY)) {\r\n        continue;\r\n      }\r\n\r\n      prop.on(\"change\", this.on_change);\r\n      last_tool_eventmap.push({\r\n        panel: this,\r\n        cb   : this.on_change,\r\n        prop\r\n      })\r\n\r\n      let path = `last_tool.${k}`;\r\n      let uiname = prop.uiname ?? ToolProperty.makeUIName(k);\r\n\r\n      panel.label(uiname);\r\n      let packflag = 0;\r\n\r\n      /* Default to roller number sliders. */\r\n      if (!(prop.flag & PropFlags.SIMPLE_SLIDER)) {\r\n        packflag |= PackFlags.FORCE_ROLLER_SLIDER;\r\n      }\r\n\r\n      let ret = panel.prop(path, packflag);\r\n\r\n      if (ret) {\r\n        //ret.onchange = function() {\r\n        //ctx.toolstack.rerun(tool);\r\n        //}\r\n      }\r\n    }\r\n    this.setCSS();\r\n\r\n    //console.log(\"Building last tool settings\");\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    let ctx = this.ctx;\r\n\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    let tool = this.getToolStackHead(ctx);\r\n\r\n    this.needsRebuild |= tool && (!(LastKey in tool) || tool[LastKey] !== this._tool_id);\r\n\r\n    if (this.needsRebuild) {\r\n      tool[LastKey] = tool_idgen++;\r\n      this._tool_id = tool[LastKey];\r\n\r\n      this.rebuild();\r\n    }\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"last-tool-panel-x\"\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(LastToolPanel);\r\n", "let promise;\r\n\r\nif (window.haveElectron) {\r\n  promise = import('./electron/electron_api.js');\r\n} else {\r\n  promise = import('./web/web_api.js');\r\n}\r\n\r\nexport var platform;\r\n\r\npromise.then((module) => {\r\n  platform = module.platform;\r\n  promise = undefined;\r\n});\r\n\r\nexport function getPlatformAsync() {\r\n  if (promise) {\r\n    return new Promise((accept, reject) => {\r\n      promise.then(mod => {\r\n        accept(mod.platform);\r\n      });\r\n    });\r\n  }\r\n\r\n  return new Promise((accept, reject) => {\r\n    accept(platform);\r\n  })\r\n}\r\n", "\"use strict\";\r\nexport const SVG_URL = 'http://www.w3.org/2000/svg';\r\n\r\nimport * as util from './util.js';\r\nimport * as vectormath from './vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ui from '../core/ui.js';\r\nimport * as math from './math.js';\r\n\r\nconst Vector2 = vectormath.Vector2;\r\n\r\nexport class CanvasOverdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.shadow.appendChild(this.canvas);\r\n    this.g = this.canvas.getContext(\"2d\");\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : 'screen-overdraw-canvas-x'\r\n    }\r\n  }\r\n\r\n  startNode(node, screen) {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n}\r\n\r\nexport class Overdraw extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.visibleToPick = false;\r\n\r\n    this.screen = undefined;\r\n    this.shapes = [];\r\n    this.otherChildren = []; //non-svg elements\r\n    this.font = undefined;\r\n\r\n    let style = document.createElement(\"style\")\r\n    style.textContent = `\r\n      .overdrawx {\r\n        pointer-events : none;\r\n      }\r\n    `;\r\n\r\n    this.shadow.appendChild(style);\r\n\r\n    this.zindex_base = 1000;\r\n  }\r\n\r\n  startNode(node, screen, cssPosition=\"relative\") {\r\n    if (screen) {\r\n      this.screen = screen;\r\n      this.ctx = screen.ctx;\r\n    }\r\n\r\n    if (!this.parentNode) {\r\n      node.appendChild(this);\r\n    }\r\n\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = cssPosition;\r\n\r\n    //this.style[\"left\"] = \"0px\";\r\n    //this.style[\"top\"] = \"0px\";\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = \"100%\" //screen.size[0] + \"px\";\r\n    this.style[\"height\"] = \"100%\" //screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.svg.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  start(screen) {\r\n    this.screen = screen;\r\n    this.ctx = screen.ctx;\r\n\r\n    screen.parentNode.appendChild(this);\r\n\r\n    this.style[\"display\"] = \"float\";\r\n    this.style[\"z-index\"] = this.zindex_base;\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"left\"] = \"0px\";\r\n    this.style[\"top\"] = \"0px\";\r\n\r\n    this.style[\"width\"] = screen.size[0] + \"px\";\r\n    this.style[\"height\"] = screen.size[1] + \"px\";\r\n\r\n    this.style[\"pointer-events\"] = \"none\";\r\n\r\n    this.svg = document.createElementNS(SVG_URL, \"svg\");\r\n    this.svg.style[\"width\"] = \"100%\";\r\n    this.svg.style[\"height\"] = \"100%\";\r\n\r\n    this.shadow.appendChild(this.svg);\r\n\r\n    //this.style[\"background-color\"] = \"green\";\r\n  }\r\n\r\n  clear() {\r\n    for (let child of util.list(this.svg.childNodes)) {\r\n      child.remove();\r\n    }\r\n\r\n    for (let child of this.otherChildren) {\r\n      child.remove();\r\n    }\r\n\r\n    this.otherChildren.length = 0;\r\n  }\r\n\r\n  drawTextBubbles(texts, cos, colors) {\r\n    let boxes = [];\r\n    let elems = [];\r\n\r\n    let cent = new Vector2();\r\n\r\n    for (let i=0; i<texts.length; i++) {\r\n      let co = cos[i];\r\n      let text = texts[i];\r\n      let color;\r\n\r\n      if (colors !== undefined) {\r\n        color = colors[i];\r\n      }\r\n\r\n      cent.add(co);\r\n      let box = this.text(texts[i], co[0], co[1], {color : color});\r\n\r\n      boxes.push(box);\r\n      let font = box.style[\"font\"];\r\n      let pat = /[0-9]+px/;\r\n      let size = font.match(pat)[0];\r\n\r\n      //console.log(\"size\", size);\r\n\r\n      if (size === undefined) {\r\n        size = this.getDefault(\"DefaultText\").size;\r\n      } else {\r\n        size = ui_base.parsepx(size);\r\n      }\r\n\r\n      //console.log(size);\r\n      let tsize = ui_base.measureTextBlock(this, text, undefined, undefined, size, font);\r\n\r\n      box.minsize = [\r\n        ~~tsize.width,\r\n        ~~tsize.height\r\n      ];\r\n\r\n      let pad = ui_base.parsepx(box.style[\"padding\"]);\r\n\r\n      box.minsize[0] += pad*2;\r\n      box.minsize[1] += pad*2;\r\n\r\n      let x = ui_base.parsepx(box.style[\"left\"]);\r\n      let y = ui_base.parsepx(box.style[\"top\"]);\r\n\r\n      box.grads = new Array(4);\r\n      box.params = [x, y, box.minsize[0], box.minsize[1]];\r\n      box.startpos = new Vector2([x, y]);\r\n\r\n      box.setCSS = function() {\r\n        this.style[\"padding\"] = \"0px\";\r\n        this.style[\"margin\"] = \"0px\";\r\n        this.style[\"left\"] = ~~this.params[0] + \"px\";\r\n        this.style[\"top\"] = ~~this.params[1] + \"px\";\r\n        this.style[\"width\"] = ~~this.params[2] + \"px\";\r\n        this.style[\"height\"] = ~~this.params[3] + \"px\";\r\n      };\r\n\r\n      box.setCSS();\r\n      //console.log(box.params);\r\n      elems.push(box);\r\n    }\r\n\r\n    if (boxes.length === 0) {\r\n      return;\r\n    }\r\n\r\n    cent.mulScalar(1.0 / boxes.length);\r\n\r\n    function error() {\r\n      let p1 = [0, 0], p2 = [0, 0];\r\n      let s1 = [0, 0], s2 = [0, 0];\r\n\r\n      let ret = 0.0;\r\n\r\n      for (let box1 of boxes) {\r\n        for (let box2 of boxes) {\r\n          if (box2 === box1) {\r\n            continue;\r\n          }\r\n\r\n          s1[0] = box1.params[2];\r\n          s1[1] = box1.params[3];\r\n          s2[0] = box2.params[2];\r\n          s2[1] = box2.params[3];\r\n\r\n          let overlap = math.aabb_overlap_area(box1.params, s1, box2.params, s2);\r\n          ret += overlap;\r\n        }\r\n\r\n        ret += box1.startpos.vectorDistance(box1.params)*0.25;\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    function solve() {\r\n      //console.log(\"ERROR\", error());\r\n      let r1 = error();\r\n      if (r1 === 0.0) {\r\n        return;\r\n      }\r\n\r\n      let df = 0.0001;\r\n      let totgs = 0.0;\r\n\r\n      for (let box of boxes) {\r\n        for (let i=0; i<box.params.length; i++) {\r\n          let orig = box.params[i];\r\n          box.params[i] += df;\r\n          let r2 = error();\r\n          box.params[i] = orig;\r\n\r\n          box.grads[i] = (r2 - r1) / df;\r\n          totgs += box.grads[i]**2;\r\n        }\r\n      }\r\n\r\n      if (totgs === 0.0) {\r\n        return;\r\n      }\r\n\r\n      r1 /= totgs;\r\n      let k = 0.4;\r\n\r\n      for (let box of boxes) {\r\n        for (let i = 0; i < box.params.length; i++) {\r\n          box.params[i] += -r1*box.grads[i]*k;\r\n        }\r\n\r\n        box.params[2] = Math.max(box.params[2], box.minsize[0]);\r\n        box.params[3] = Math.max(box.params[3], box.minsize[1]);\r\n\r\n        box.setCSS();\r\n      }\r\n    }\r\n\r\n    for (let i=0; i<15; i++) {\r\n      solve();\r\n    }\r\n\r\n    for (let box of boxes) {\r\n      elems.push(this.line(box.startpos, box.params));\r\n    }\r\n\r\n    return elems;\r\n  }\r\n\r\n  text(text, x, y, args={}) {\r\n    args = Object.assign({}, args);\r\n\r\n    if (args.font === undefined) {\r\n      if (this.font !== undefined)\r\n        args.font = this.font;\r\n      else\r\n        args.font = this.getDefault(\"DefaultText\").genCSS();\r\n    }\r\n\r\n    if (!args[\"background-color\"]) {\r\n      args[\"background-color\"] = \"rgba(75, 75, 75, 0.75)\";\r\n    }\r\n\r\n    args.color = args.color ? args.color : \"white\";\r\n    if (typeof args.color === \"object\") {\r\n      args.color = ui_base.color2css(args.color);\r\n    }\r\n\r\n    args[\"padding\"] = args[\"padding\"] === undefined ? \"5px\" : args[\"padding\"];\r\n    args[\"border-color\"] = args[\"border-color\"] ? args[\"border-color\"] : \"grey\";\r\n    args[\"border-radius\"] = args[\"border-radius\"] ? args[\"border-radius\"] : \"25px\";\r\n    args[\"border-width\"] = args[\"border-width\"] !== undefined ? args[\"border-width\"] : \"2px\";\r\n\r\n    if (typeof args[\"border-width\"] === \"number\") {\r\n      args[\"border-width\"] = \"\" + args[\"border-width\"] + \"px\";\r\n    }\r\n    if (typeof args[\"border-radius\"] === \"number\") {\r\n      args[\"border-radius\"] = \"\" + args[\"border-radius\"] + \"px\";\r\n    }\r\n\r\n    //not sure I need SVG for this. . .\r\n    let box = document.createElement(\"div\")\r\n\r\n    box.setAttribute(\"class\", \"overdrawx\");\r\n\r\n    box.style[\"position\"] = \"fixed\";\r\n    box.style[\"width\"] = \"min-contents\";\r\n    box.style[\"height\"] = \"min-contents\";\r\n    box.style[\"border-width\"] = args[\"border-width\"]\r\n    box.style[\"border-radius\"] = \"25px\";\r\n    box.style[\"pointer-events\"] = \"none\";\r\n    box.style[\"z-index\"] = this.zindex_base + 1;\r\n    box.style[\"background-color\"] = args[\"background-color\"];\r\n    box.style[\"padding\"] = args[\"padding\"];\r\n\r\n    box.style[\"left\"] = x + \"px\";\r\n    box.style[\"top\"] = y + \"px\";\r\n\r\n    box.style[\"display\"] = \"flex\";\r\n    box.style[\"justify-content\"] = \"center\";\r\n    box.style[\"align-items\"] = \"center\";\r\n\r\n    box.innerText = text;\r\n    box.style[\"font\"] = args.font;\r\n    box.style[\"color\"] = args.color;\r\n\r\n    this.otherChildren.push(box);\r\n    this.shadow.appendChild(box);\r\n\r\n    return box;\r\n  }\r\n\r\n  circle(p, r, stroke=\"black\", fill=\"none\") {\r\n    let circle = document.createElementNS(SVG_URL, \"circle\");\r\n    circle.setAttribute(\"cx\", p[0]);\r\n    circle.setAttribute(\"cy\", p[1]);\r\n    circle.setAttribute(\"r\", r);\r\n\r\n    if (fill) {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2;fill:${fill}`);\r\n    } else {\r\n      circle.setAttribute(\"style\", `stroke:${stroke};stroke-width:2`);\r\n    }\r\n\r\n    this.svg.appendChild(circle);\r\n\r\n    return circle;\r\n  }\r\n\r\n  line(v1, v2, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"line\");\r\n    line.setAttribute(\"x1\", v1[0]);\r\n    line.setAttribute(\"y1\", v1[1]);\r\n    line.setAttribute(\"x2\", v2[0]);\r\n    line.setAttribute(\"y2\", v2[1]);\r\n    line.setAttribute(\"style\", `stroke:${color};stroke-width:2`);\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  rect(p, size, color=\"black\") {\r\n    let line = document.createElementNS(SVG_URL, \"rect\");\r\n    line.setAttribute(\"x\", p[0]);\r\n    line.setAttribute(\"y\", p[1]);\r\n    line.setAttribute(\"width\", size[0]);\r\n    line.setAttribute(\"height\", size[1]);\r\n    line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n\r\n    line.setColor = (color) => {\r\n      line.setAttribute(\"style\", `fill:${color};stroke-width:2`);\r\n    };\r\n\r\n    this.svg.appendChild(line);\r\n    return line;\r\n  }\r\n\r\n  end() {\r\n    this.clear();\r\n    this.remove();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"overdraw-x\",\r\n    style   : \"overdraw\"\r\n  };}\r\n}\r\n\r\nui_base.UIBase.internalRegister(Overdraw);\r\n", "import '../util/ScreenOverdraw.js';\r\nimport {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport * as math from '../path-controller/util/math.js';\r\n\r\nexport class TreeItem extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.treeParent = undefined;\r\n    this.treeChildren = [];\r\n    this.treeView = undefined;\r\n    this.treeDepth = 0;\r\n\r\n    this.header = this.row();\r\n\r\n    this._icon1 = this.header.iconbutton(Icons.TREE_COLLAPSE);\r\n    this._icon1.iconsheet = 0;\r\n    this._icon1.drawButtonBG = false;\r\n\r\n    this._icon2 = undefined;\r\n\r\n    this._icon1.onclick = () => {\r\n      if (this.opened) {\r\n        this.close();\r\n      }  else {\r\n        this.open();\r\n      }\r\n    }\r\n\r\n    this.opened = true;\r\n\r\n    this._label = this.header.label(\"unlabeled\");\r\n    this._labelText = \"unlabeled\";\r\n  }\r\n\r\n  set icon(id) {\r\n    if (this._icon2) {\r\n      this._icon2 = id;\r\n    } else {\r\n      this._icon2 = UIBase.createElement(\"icon-label-x\");\r\n      this._icon2.icon = id;\r\n      this._icon2.iconsheet = 0;\r\n\r\n\r\n      this.header.insert(1, this._icon2);\r\n    }\r\n  }\r\n\r\n  get icon() {\r\n    if (this._icon2)\r\n      return this._icon2.icon;\r\n    else\r\n      return -1;\r\n  }\r\n\r\n  open() {\r\n    this._icon1.icon = Icons.TREE_COLLAPSE;\r\n    this.opened = true;\r\n    this.treeView._open(this);\r\n  }\r\n\r\n  close() {\r\n    this._icon1.icon = Icons.TREE_EXPAND;\r\n    this.opened = false;\r\n    this.treeView._close(this);\r\n  }\r\n\r\n  set text(b) {\r\n    if (typeof b === \"string\") {\r\n      this._label.text = b;\r\n      this._labelText = b;\r\n    } else if (b instanceof HTMLElement) {\r\n      this._label.remove();\r\n      this.header.add(b);\r\n\r\n      this._label = b;\r\n      this._labelText = b;\r\n    }\r\n  }\r\n\r\n  get text() {\r\n    return this._labelText;\r\n  }\r\n\r\n\r\n  item(name, args={}) {\r\n    args.treeParent = this;\r\n    return this.parentWidget.item(name, args);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-item-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeItem);\r\n\r\nexport class TreeView extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.items = [];\r\n    this.strokes = [];\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"display\"] = \"flex\";\r\n    this.style[\"flex-direction\"] = \"column\";\r\n\r\n    //this.shadow.appendChild(this.overdraw);\r\n\r\n    this.overdraw = UIBase.createElement(\"overdraw-x\");\r\n    console.log(this.overdraw.startNode);\r\n    this.overdraw.startNode(this);\r\n\r\n    this.style[\"margin\"] = this.style[\"padding\"] = \"0px\";\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  _forAllChildren(item, cb) {\r\n    let visit = (n) => {\r\n      cb(n);\r\n\r\n      for (let c of n.treeChildren) {\r\n        visit(c);\r\n      }\r\n    }\r\n\r\n    for (let c of item.treeChildren) {\r\n      visit(c);\r\n    }\r\n  }\r\n\r\n  _open(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      if (c.opened) {\r\n        c.unhide();\r\n      }\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _close(item) {\r\n    this._forAllChildren(item, (c) => {\r\n      c.hide();\r\n    })\r\n\r\n    this._makeStrokes();\r\n  }\r\n\r\n  _makeStrokes() {\r\n    if (!this.overdraw) {\r\n      //this.doOnce(this._makeStrokes);\r\n      return;\r\n    }\r\n\r\n    for (let elem of this.strokes) {\r\n      elem.remove();\r\n    }\r\n    this.strokes.length = 0;\r\n\r\n    let hidden = (item) => {\r\n      return item.hidden;\r\n      let p = item;\r\n\r\n      while (p) {\r\n        if (!p.opened)\r\n          return true;\r\n        p = p.treeParent;\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    let items = this.items;\r\n    if (items.length == 0) {\r\n      return;\r\n    }\r\n\r\n    this.overdraw.clear();\r\n\r\n    let next = (i) => {\r\n      i++;\r\n\r\n      while (i < items.length && hidden(items[i])) {\r\n        i++;\r\n        continue;\r\n      }\r\n\r\n      return i;\r\n    }\r\n\r\n    let i = 0;\r\n    if (hidden(items[i]))\r\n      i = next(i);\r\n\r\n    let origin = this.overdraw.getBoundingClientRect();\r\n    let overdraw = this.overdraw;\r\n\r\n    let line = function(x1, y1, x2, y2) {\r\n      let ox = origin.x, oy = origin.y;\r\n\r\n      x1 -= ox; y1 -= oy;\r\n      x2 -= ox; y2 -= oy;\r\n\r\n      overdraw.line([x1, y1], [x2, y2]);\r\n    }\r\n\r\n    console.log(\"making lines\", i);\r\n\r\n    let indent = this.getDefault(\"itemIndent\");\r\n    let rowh = this.getDefault(\"rowHeight\");\r\n\r\n    let getx = (depth) => {\r\n      return (depth+2.2)*indent + origin.x;\r\n    }\r\n\r\n    this.overdraw.style[\"z-index\"] = \"0\";\r\n\r\n    let prev = undefined;\r\n\r\n    for (; i<items.length; i = next(i)) {\r\n      let item = this.items[i];\r\n      let item2 = next(i);\r\n      item2 = item2 < items.length ? items[item2] : undefined;\r\n\r\n      let r = item._icon1.getBoundingClientRect();\r\n\r\n      if (!r) continue;\r\n\r\n      let x1 = getx(item.treeDepth);\r\n      let y1 = origin.y + (i+1)*rowh - rowh*0.25;\r\n\r\n\r\n      if (item2 && item2.treeDepth > item.treeDepth) {//} && (!prev || prev.treeDepth !== item.treeDepth)) {\r\n        let y2 = y1 + rowh*0.75;\r\n\r\n        line(x1, y1, x1, y2)\r\n        line(x1, y2, getx(item2.treeDepth)-3, y2);\r\n\r\n      } else if (item2 && item2.treeDepth === item.treeDepth) {\r\n        line(x1, y1, x1, y1+rowh*0.5)\r\n      }\r\n\r\n      prev = item;\r\n    }\r\n  }\r\n\r\n  updateOverdraw() {\r\n    let mm = new math.MinMax(2);\r\n    let ok = false;\r\n\r\n    for (let item of this.items) {\r\n      if (item.hidden) {\r\n        //continue;\r\n      }\r\n\r\n      for (let r of item.getClientRects()) {\r\n        //console.log(r.y);\r\n        mm.minmax([r.x, r.y]);\r\n        mm.minmax([r.x+r.width, r.y+r.height]);\r\n        ok = true;\r\n      }\r\n    }\r\n\r\n    if (!ok) {\r\n      return;\r\n    }\r\n\r\n    let r = this.getClientRects()[0];\r\n    if (!r) return;\r\n\r\n    let x = r.left;\r\n    let y = r.top;// - r.y;\r\n\r\n    let od = this.overdraw;\r\n    let w = mm.max[0] - mm.min[0];\r\n    let h = mm.max[1] - mm.min[1];\r\n\r\n    od.style[\"margin\"] = \"0px\";\r\n    od.style[\"padding\"] = \"0px\";\r\n    od.svg.style[\"margin\"] = \"0px\";\r\n\r\n    od.style[\"position\"] = UIBase.PositionKey;\r\n\r\n    od.style[\"width\"] = (r.width-1) + \"px\";\r\n    od.style[\"height\"] = (r.height-1) + \"px\";\r\n\r\n    od.style[\"left\"] = x + \"px\";\r\n    od.style[\"top\"] =  y + \"px\";\r\n\r\n    //od.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n    //od.svg.style[\"background-color\"] = \"rgba(50, 50, 50, 0.25)\";\r\n\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this.updateOverdraw();\r\n  }\r\n\r\n  item(name, args={icon : undefined}) {\r\n    let ret = UIBase.createElement(\"tree-item-x\");\r\n    this.add(ret);\r\n    ret._init();\r\n\r\n    ret.text = name;\r\n\r\n    if (args.icon) {\r\n      ret.icon = args.icon;\r\n    }\r\n\r\n    ret.treeParent = args.treeParent;\r\n    ret.treeView = this;\r\n\r\n    //ret.style[\"margin-bottom\"] = ret.style[\"margin-top\"] = \"0px\";\r\n    //ret.style[\"padding-bottom\"] = ret.style[\"padding-top\"] = \"0px\";\r\n    ret.style[\"max-height\"] = this.getDefault(\"rowHeight\") + \"px\";\r\n\r\n    if (ret.treeParent) {\r\n      ret.treeParent.treeChildren.push(ret);\r\n      ret.treeDepth = ret.treeParent.treeDepth + 1;\r\n    }\r\n\r\n    let p = ret.treeParent;\r\n    let i = 1;\r\n    while (p) {\r\n      p = p.treeParent;\r\n      i++;\r\n    }\r\n\r\n    ret.style[\"margin-left\"] = (i*this.getDefault(\"itemIndent\")) + \"px\";\r\n    this.items.push(ret);\r\n\r\n    this.doOnce(() => {\r\n      this._makeStrokes();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"tree-view-x\",\r\n    style   : \"treeview\"\r\n  }}\r\n}\r\nUIBase.internalRegister(TreeView);\r\n\r\n", "import {UIBase, Icons} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {pushModalLight, popModalLight, keymap} from '../path-controller/util/simple_events.js';\r\nimport {parsepx} from '../core/ui_theme.js';\r\n\r\nfunction startDrag(box) {\r\n  if (box._modal) {\r\n    popModalLight(box._modal);\r\n    box._modal = undefined;\r\n    return;\r\n  }\r\n\r\n  let first = true;\r\n  let lastx = 0;\r\n  let lasty = 0;\r\n\r\n  let handlers = {\r\n    on_mousemove(e) {\r\n      let x = e.x, y = e.y;\r\n\r\n      if (first) {\r\n        lastx = x;\r\n        lasty = y;\r\n        first = false;\r\n\r\n        return;\r\n      }\r\n\r\n      let dx = x - lastx;\r\n      let dy = y - lasty;\r\n\r\n      let hx = parsepx(box.style[\"left\"]);\r\n      let hy = parsepx(box.style[\"top\"]);\r\n\r\n      hx += dx;\r\n      hy += dy;\r\n\r\n      console.log(hx, hy);\r\n\r\n      box.style[\"left\"] = hx + \"px\";\r\n      box.style[\"top\"] = hy + \"px\";\r\n\r\n      lastx = x;\r\n      lasty = y;\r\n    },\r\n\r\n    end() {\r\n      if (box._modal) {\r\n        popModalLight(box._modal);\r\n        box._modal = undefined;\r\n      }\r\n    },\r\n\r\n    on_mouseup(e) {\r\n      this.end();\r\n    },\r\n\r\n    on_keydown(e) {\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n        case keymap[\"Return\"]:\r\n          this.end();\r\n          break;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  box._modal = pushModalLight(handlers);\r\n}\r\n\r\nexport class DragBox extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._done = false;\r\n    this.header = UIBase.createElement(\"rowframe-x\");\r\n    this.contents = UIBase.createElement(\"container-x\");\r\n\r\n    this.header.style[\"border-radius\"] = \"20px\";\r\n\r\n    this.header.parentWidget = this;\r\n    this.contents.parentWidget = this;\r\n\r\n    this.shadow.appendChild(this.header);\r\n    this.shadow.appendChild(this.contents);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let header = this.header;\r\n\r\n    header.ctx = this.ctx;\r\n    this.contents.ctx = this.ctx;\r\n    header._init();\r\n    this.contents._init();\r\n\r\n    this.style[\"min-width\"] = \"350px\";\r\n    header.style[\"height\"] = \"35px\";\r\n\r\n    let icon = header.iconbutton(Icons.DELETE, \"Hide\", () => {\r\n      this.end();\r\n    });\r\n    icon.iconsheet = 0; //use small icons\r\n\r\n    this.addEventListener(\"mousedown\", (e) => {\r\n      console.log(\"start drag\");\r\n      startDrag(this);\r\n\r\n      /* ensure browser doesn't spawn its own (incompatible)\r\n         touch->mouse emulation events}; */\r\n      e.preventDefault();\r\n\r\n    }, {capture : false})\r\n\r\n    header.background = this.getDefault(\"background-color\");\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  add() {\r\n    return this.contents.add(...arguments);\r\n  }\r\n\r\n  prepend(n) {\r\n    return this.contents.prepend(n);\r\n  }\r\n\r\n  appendChild(n) {\r\n    return this.contents.appendChild(n);\r\n  }\r\n  col() {\r\n    return this.contents.col(...arguments);\r\n  }\r\n\r\n  row() {\r\n    return this.contents.row(...arguments);\r\n  }\r\n\r\n  strip() {\r\n    return this.contents.strip(...arguments);\r\n  }\r\n  button() {\r\n    return this.contents.button(...arguments);\r\n  }\r\n  iconbutton() {\r\n    return this.contents.iconbutton(...arguments);\r\n  }\r\n  iconcheck() {\r\n    return this.contents.iconcheck(...arguments);\r\n  }\r\n  tool() {\r\n    return this.contents.tool(...arguments);\r\n  }\r\n  menu() {\r\n    return this.contents.menu(...arguments);\r\n  }\r\n  prop() {\r\n    return this.contents.prop(...arguments);\r\n  }\r\n  listenum() {\r\n    return this.contents.listenum(...arguments);\r\n  }\r\n  check() {\r\n    return this.contents.check(...arguments);\r\n  }\r\n  iconenum() {\r\n    return this.contents.iconenum(...arguments);\r\n  }\r\n  slider() {\r\n    return this.contents.slider(...arguments);\r\n  }\r\n  simpleslider() {\r\n    return this.contents.simpleslider(...arguments);\r\n  }\r\n  curve() {\r\n    return this.contents.curve(...arguments);\r\n  }\r\n  textbox() {\r\n    return this.contents.textbox(...arguments);\r\n  }\r\n  textarea() {\r\n    return this.contents.textarea(...arguments);\r\n  }\r\n  viewer() {\r\n    return this.contents.viewer(...arguments);\r\n  }\r\n  panel() {\r\n    return this.contents.panel(...arguments);\r\n  }\r\n  tabs() {\r\n    return this.contents.tabs(...arguments);\r\n  }\r\n  table() {\r\n    return this.contents.table(...arguments);\r\n  }\r\n\r\n\r\n  end() {\r\n    if (this._done) {\r\n      return;\r\n    }\r\n    this.remove();\r\n\r\n    if (this._onend) {\r\n      this._onend();\r\n    }\r\n\r\n    if (this.onend) {\r\n      this.onend();\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.background = this.getDefault(\"background-color\");\r\n  }\r\n\r\n  static define() {return {\r\n    tagname : \"drag-box-x\",\r\n    style   : \"panel\"\r\n  }}\r\n}\r\nUIBase.internalRegister(DragBox);\r\n", "import {UIBase, saveUIData, loadUIData} from '../core/ui_base.js';\r\n\r\nimport * as util from \"../path-controller/util/util.js\"\r\nimport cconst from \"../config/const.js\";\r\nimport * as nstructjs from \"../path-controller/util/struct.js\";\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\nimport {Container} from \"../core/ui.js\";\r\nimport {Area} from \"./ScreenArea.js\";\r\nimport {Icons} from \"../core/ui_base.js\";\r\n\r\nimport {startMenu} from \"../widgets/ui_menu.js\";\r\nimport {getAreaIntName, setAreaTypes, AreaWrangler, areaclasses} from './area_wrangler.js';\r\n\r\nlet ignore = 0;\r\n\r\nfunction dockerdebug() {\r\n  if (cconst.DEBUG.areadocker) {\r\n    console.warn(...arguments);\r\n  }\r\n}\r\n\r\nwindow.testSnapScreenVerts = function (arg) {\r\n  let screen = CTX.screen;\r\n\r\n  screen.unlisten();\r\n  screen.on_resize([screen.size[0] - 75, screen.size[1]], screen.size);\r\n  screen.on_resize = screen.updateSize = () => {\r\n  };\r\n\r\n  let p = CTX.propsbar;\r\n  p.pos[0] += 50;\r\n  p.owning_sarea.loadFromPosSize();\r\n  screen.regenBorders();\r\n\r\n  screen.size[0] = window.innerWidth - 5;\r\n\r\n  screen.snapScreenVerts(arg);\r\n}\r\n\r\nexport class AreaDocker extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this._last_update_key = undefined;\r\n    this.mpos = new Vector2();\r\n    this.needsRebuild = true;\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"area-docker-x\",\r\n      style  : \"areadocker\"\r\n    }\r\n  }\r\n\r\n  rebuild() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let sarea = this.getArea().parentWidget;\r\n    if (!sarea) {\r\n      this.needsRebuild = true;\r\n      return;\r\n    }\r\n\r\n    this.needsRebuild = false;\r\n    this.ignoreChange++;\r\n\r\n    dockerdebug(\"Rebuild\", this.getArea());\r\n\r\n    let uidata = sarea.switcherData = saveUIData(this, \"switcherTabs\");\r\n\r\n    this.clear();\r\n\r\n    let tabs = this.tbar = this.tabs()\r\n    tabs.onchange = this.tab_onchange.bind(this);\r\n\r\n    let tab;\r\n\r\n    dockerdebug(sarea._id, sarea.area ? sarea.area._id : \"(no active area)\", sarea.editors)\r\n\r\n    sarea.switcherData = uidata;\r\n\r\n    for (let editor of sarea.editors) {\r\n      let def = editor.constructor.define();\r\n      let name = def.uiname;\r\n\r\n      if (!name) {\r\n        name = def.areaname || def.tagname.replace(/-x/, '');\r\n        name = ToolProperty.makeUIName(name);\r\n      }\r\n\r\n      let tab = tabs.tab(name, editor._id);\r\n\r\n      let start_mpos = new Vector2();\r\n      let mpos = new Vector2();\r\n\r\n      tab._tab.addEventListener(\"tabdragstart\", (e) => {\r\n        if (e.x !== 0 && e.y !== 0) {\r\n          start_mpos.loadXY(e.x, e.y);\r\n          this.mpos.loadXY(e.x, e.y);\r\n        } else {\r\n          start_mpos.load(this.mpos);\r\n        }\r\n\r\n        dockerdebug(\"tab drag start!\", start_mpos, e);\r\n      });\r\n      tab._tab.addEventListener(\"tabdragmove\", (e) => {\r\n        this.mpos.loadXY(e.x, e.y);\r\n\r\n        let rect = this.tbar.tbar.canvas.getBoundingClientRect();\r\n\r\n        let x = e.x, y = e.y;\r\n\r\n        let m = 8;\r\n        if (x < rect.x - m || x > rect.x + rect.width + m || y < rect.y - m || y >= rect.y + rect.height + m) {\r\n          dockerdebug(\"tab detach!\");\r\n          e.preventDefault(); //end dragging\r\n          this.detach(e);\r\n        }\r\n      });\r\n      tab._tab.addEventListener(\"tabdragend\", (e) => {\r\n\r\n        this.mpos.loadXY(e.x, e.y);\r\n        dockerdebug(\"tab drag end!\", e);\r\n      });\r\n    }\r\n\r\n    tab = this.tbar.icontab(Icons.SMALL_PLUS, \"add\", \"Add Editor\", false).noSwitch();\r\n    dockerdebug(\"Add Menu Tab\", tab);\r\n\r\n    let icon = this.addicon = tab._tab;\r\n\r\n    icon.ontabclick = e => this.on_addclick(e);\r\n    icon.setAttribute(\"menu-button\", \"true\");\r\n    icon.setAttribute(\"simple\", \"true\");\r\n\r\n    this.loadTabData(uidata);\r\n\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  detach(event) {\r\n    this.tbar._ensureNoModal();\r\n\r\n    let area = this.getArea();\r\n    let sarea = this.ctx.screen.floatArea(area);\r\n\r\n    sarea.size.min([300, 300]);\r\n    sarea.loadFromPosSize();\r\n\r\n    let mpos = event ? new Vector2([event.x, event.y]) : this.mpos;\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && event instanceof PointerEvent) {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos, document.body, event.pointerId);\r\n    } else {\r\n      this.ctx.screen.moveAttachTool(sarea, mpos);\r\n    }\r\n  }\r\n\r\n  loadTabData(uidata) {\r\n    this.ignoreChange++;\r\n    loadUIData(this, uidata);\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  on_addclick(e) {\r\n    let mpos = new Vector2([e.x, e.y]);\r\n\r\n    if (this.addicon.menu && !this.addicon.menu.closed) {\r\n      this.addicon.menu.close();\r\n    } else {\r\n      this.addTabMenu(e.target, mpos);\r\n    }\r\n  }\r\n\r\n  tab_onchange(tab, event) {\r\n    if (this.ignoreChange) {\r\n      return;\r\n    }\r\n\r\n    dockerdebug(\"EVENT\", event);\r\n\r\n    if (event && (!(event instanceof PointerEvent) || event.pointerType === \"mouse\")) {\r\n      //event.preventDefault(); //prevent tab dragging\r\n    }\r\n\r\n    this.select(tab.id, event);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.style[\"touch-action\"] = \"none\";\r\n\r\n    this.addEventListener(\"pointermove\", (e) => {\r\n      this.mpos.loadXY(e.x, e.y);\r\n    });\r\n\r\n    this.rebuild();\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n\r\n  getArea() {\r\n    let p = this.parentWidget;\r\n    let lastp = p;\r\n\r\n    let name = UIBase.getInternalName(\"screenarea-x\");\r\n    while (p && p.tagName.toLowerCase() !== name) {\r\n      lastp = p;\r\n      p = p.parentWidget;\r\n    }\r\n\r\n    return lastp\r\n  }\r\n\r\n  flagUpdate() {\r\n    this.needsRebuild = true;\r\n    return this;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    let active = this.tbar.getActive();\r\n    let area = this.getArea();\r\n\r\n    let key = this.parentWidget._id;\r\n    for (let area2 of area.parentWidget.editors) {\r\n      key += area2._id + \":\";\r\n    }\r\n\r\n    if (key !== this._last_update_key) {\r\n      this._last_update_key = key;\r\n      this.needsRebuild = true;\r\n    }\r\n\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n      return;\r\n    }\r\n\r\n    if (this.addicon) {\r\n      let tabs = this.tbar.tbar.tabs;\r\n      let idx = tabs.indexOf(this.addicon);\r\n      if (idx !== tabs.length - 1) {\r\n        this.tbar.tbar.swapTabs(this.addicon, tabs[tabs.length - 1]);\r\n\r\n      }\r\n    }\r\n\r\n    if (!active || active._id !== area._id) {\r\n      this.ignoreChange++;\r\n\r\n      try {\r\n        this.tbar.setActive(area._id);\r\n      } catch (error) {\r\n        util.print_stack(error);\r\n        this.needsRebuild = true;\r\n      }\r\n\r\n      this.ignoreChange--;\r\n    }\r\n\r\n    window.tabs = this.tbar;\r\n\r\n    this.ignoreChange = 0;\r\n  }\r\n\r\n  select(areaId, event) {\r\n    dockerdebug(\"Tab Select!\", areaId);\r\n\r\n    this.ignoreChange++;\r\n\r\n    let area = this.getArea();\r\n    let sarea = area.parentWidget;\r\n\r\n    let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n    let newarea;\r\n\r\n    for (let area2 of sarea.editors) {\r\n      if (area2._id === areaId) {\r\n        newarea = area2;\r\n        sarea.switchEditor(area2.constructor);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (newarea === area || !newarea.switcher) {\r\n      return;\r\n    }\r\n\r\n    //this.ctx.screen.completeSetCSS();\r\n    //this.ctx.screen.completeUpdate();\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    newarea = sarea.area;\r\n\r\n    /* unswap switchers to avoid a bug in Chrome where\r\n    *  touch-action appears to not be respected due to our\r\n    *  swapping elements */\r\n\r\n    let parentw = area.switcher.parentWidget;\r\n    let newparentw = newarea.switcher.parentWidget;\r\n\r\n    let parent = area.switcher.parentNode;\r\n    let newparent = newarea.switcher.parentNode;\r\n\r\n    area.switcher = newarea.switcher;\r\n    newarea.switcher = this;\r\n\r\n    HTMLElement.prototype.remove.call(area.switcher);\r\n    HTMLElement.prototype.remove.call(newarea.switcher);\r\n\r\n    if (parent instanceof UIBase) {\r\n      parent.shadow.appendChild(area.switcher);\r\n    } else {\r\n      parent.appendChild(area.switcher);\r\n    }\r\n\r\n    if (newparent instanceof UIBase) {\r\n      newparent.shadow.prepend(newarea.switcher);\r\n    } else {\r\n      newparent.prepend(newarea.switcher);\r\n    }\r\n\r\n    area.switcher.parentWidget = parentw;\r\n    newarea.switcher.parentWidget = newparentw;\r\n\r\n    area.switcher.tbar._ensureNoModal();\r\n    newarea.switcher.tbar._ensureNoModal();\r\n\r\n    newarea.switcher.loadTabData(uidata);\r\n    area.switcher.loadTabData(uidata);\r\n\r\n    newarea.switcher.setCSS();\r\n    newarea.switcher.update();\r\n\r\n    if (event && (event instanceof PointerEvent || event instanceof MouseEvent || event instanceof TouchEvent)) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      newarea.switcher.tbar._startMove(undefined, event);\r\n    }\r\n\r\n    //console.log(this._id);\r\n\r\n    sarea.switcherData = uidata;\r\n    this.ignoreChange--;\r\n  }\r\n\r\n  addTabMenu(tab, mpos) {\r\n    let rect = tab.getClientRects()[0];\r\n\r\n    dockerdebug(tab, tab.getClientRects());\r\n\r\n    if (!mpos) {\r\n      mpos = this.ctx.screen.mpos;\r\n    }\r\n\r\n    let menu = UIBase.createElement(\"menu-x\");\r\n\r\n    menu.closeOnMouseUp = false;\r\n    menu.ctx = this.ctx;\r\n    menu._init();\r\n\r\n    let prop = Area.makeAreasEnum();\r\n    let sarea = this.getArea().parentWidget;\r\n\r\n    if (!sarea) {\r\n      return;\r\n    }\r\n\r\n    for (let k in Object.assign({}, prop.values)) {\r\n      let ok = true;\r\n      for (let area of sarea.editors) {\r\n        if (area.constructor.define().uiname === k) {\r\n          ok = false;\r\n        }\r\n      }\r\n\r\n      if (!ok) {\r\n        continue;\r\n      }\r\n\r\n      let icon = prop.iconmap[k];\r\n      menu.addItemExtra(k, prop.values[k], undefined, icon);\r\n    }\r\n\r\n    if (!rect) {\r\n      console.warn(\"no rect!\");\r\n      return;\r\n    }\r\n\r\n    dockerdebug(mpos[0], mpos[1], rect.x, rect.y);\r\n\r\n    menu.onselect = (val) => {\r\n      dockerdebug(\"menu select\", val, this.getArea().parentWidget);\r\n\r\n      this.addicon.menu = undefined;\r\n\r\n      let sarea = this.getArea().parentWidget;\r\n      if (sarea) {\r\n        let cls = areaclasses[val];\r\n\r\n        this.ignoreChange++;\r\n        let area, ud;\r\n\r\n        try {\r\n          let uidata = saveUIData(this.tbar, \"switcherTabs\");\r\n          sarea.switchEditor(cls);\r\n\r\n          dockerdebug(\"switching\", cls);\r\n          area = sarea.area;\r\n          area._init();\r\n\r\n          if (area.switcher) {\r\n            area.switcher.rebuild();\r\n            area.switcher.loadTabData(uidata);\r\n            sarea.switcherData = uidata;\r\n          }\r\n        } catch (error) {\r\n          util.print_stack(error);\r\n          throw error;\r\n        } finally {\r\n          this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n        }\r\n\r\n        dockerdebug(\"AREA\", area.switcher, area);\r\n\r\n        if (area.switcher) {\r\n          this.ignoreChange++;\r\n\r\n          try {\r\n            area.parentWidget = sarea;\r\n            area.owning_sarea = sarea;\r\n            area.switcher.parentWidget = area;\r\n            area.switcher.ctx = area.ctx;\r\n            area.switcher._init();\r\n            area.switcher.update();\r\n\r\n            dockerdebug(\"loading data\", ud);\r\n            area.switcher.loadTabData(ud);\r\n\r\n            area.switcher.rebuild(); //make sure plus tab is at end\r\n            area.flushUpdate();\r\n          } catch (error) {\r\n            throw error;\r\n          } finally {\r\n            this.ignoreChange = Math.max(this.ignoreChange - 1, 0);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.addicon.menu = menu;\r\n\r\n    startMenu(menu, mpos[0] - 35, rect.y + rect.height, false, 0);\r\n    return menu;\r\n  }\r\n}\r\n\r\nUIBase.internalRegister(AreaDocker);\r\n", "import {AreaFlags} from \"../screen/ScreenArea.js\";\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nexport function makePopupArea(area_class, screen, args={}) {\r\n  let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n  let width = args.width || (screen.size[0]*0.7);\r\n  let height = args.height || (screen.size[1]*0.7);\r\n  let addEscapeKeyHandler = args.addEscapeKeyHandler !== undefined ? args.addEscapeKeyHandler : true;\r\n\r\n  sarea.ctx = screen.ctx;\r\n  sarea.size[0] = width;\r\n  sarea.size[1] = height;\r\n  sarea.pos[0] = 100;\r\n  sarea.pos[1] = 100;\r\n\r\n  sarea.pos[0] = Math.min(sarea.pos[0], screen.size[0] - sarea.size[0] - 2);\r\n  sarea.pos[1] = Math.min(sarea.pos[1], screen.size[1] - sarea.size[1] - 2);\r\n\r\n  sarea.switch_editor(area_class);\r\n\r\n  sarea.overrideClass(\"popup\");\r\n  sarea.style[\"background-color\"] = sarea.getDefault(\"background-color\");\r\n  sarea.style[\"border-radius\"] = sarea.getDefault(\"border-radius\") + \"px\";\r\n  sarea.style[\"border-color\"] = sarea.getDefault(\"border-color\");\r\n  sarea.style[\"border-style\"] = sarea.getDefault(\"border-style\");\r\n  sarea.style[\"border-width\"] = sarea.getDefault(\"border-width\") + \"px\";\r\n\r\n  sarea.flag |= AreaFlags.FLOATING | AreaFlags.INDEPENDENT;\r\n\r\n  screen.appendChild(sarea);\r\n  sarea.setCSS();\r\n\r\n  if (addEscapeKeyHandler) {\r\n    sarea.on_keydown = (e) => {\r\n      if (e.keyCode === keymap.Escape) {\r\n        screen.removeArea(sarea);\r\n      }\r\n    }\r\n  }\r\n\r\n  sarea.bringToFront();\r\n\r\n  return sarea;\r\n}", "import {ToolTipViewer} from \"./FrameManager_ops.js\";\r\n\r\nlet _FrameManager = undefined;\r\nimport '../widgets/dragbox.js';\r\nimport '../widgets/ui_widgets2.js';\r\nimport '../widgets/ui_panel.js';\r\nimport '../widgets/ui_treeview.js';\r\n\r\nimport {DataPathError, nstructjs} from '../path-controller/controller.js';\r\n\r\nimport '../util/ScreenOverdraw.js';\r\nimport cconst from '../config/const.js';\r\nimport {haveModal, pushModalLight, popModalLight, _setScreenClass} from '../path-controller/util/simple_events.js';\r\nimport * as util from '../path-controller/util/util.js';\r\nimport '../widgets/ui_curvewidget.js';\r\nimport * as vectormath from '../path-controller/util/vectormath.js';\r\nimport * as ui_base from '../core/ui_base.js';\r\nimport * as ScreenArea from './ScreenArea.js';\r\nimport * as FrameManager_ops from './FrameManager_ops.js';\r\nimport * as math from '../path-controller/util/math.js';\r\nimport * as ui_menu from '../widgets/ui_menu.js';\r\nimport '../path-controller/util/struct.js';\r\nimport {KeyMap, HotKey} from '../path-controller/util/simple_events.js';\r\nimport {keymap} from \"../path-controller/util/simple_events.js\";\r\n\r\nimport {AreaDocker} from './AreaDocker.js';\r\n\r\nimport {snap, snapi, ScreenBorder, ScreenVert, ScreenHalfEdge, SnapLimit} from \"./FrameManager_mesh.js\";\r\n\r\nexport {ScreenBorder, ScreenVert, ScreenHalfEdge} from \"./FrameManager_mesh.js\";\r\nimport {theme, PackFlags} from '../core/ui_base.js';\r\nimport * as FrameManager_mesh from './FrameManager_mesh.js';\r\nimport {makePopupArea} from \"../widgets/ui_dialog.js\";\r\n\r\nlet Area = ScreenArea.Area;\r\n\r\nimport '../widgets/ui_widgets.js';\r\nimport '../widgets/ui_tabs.js';\r\nimport '../widgets/ui_colorpicker2.js';\r\nimport '../widgets/ui_noteframe.js';\r\nimport '../widgets/ui_listbox.js';\r\nimport '../widgets/ui_table.js';\r\nimport {AreaFlags, setScreenClass} from \"./ScreenArea.js\";\r\nimport {checkForTextBox} from '../widgets/ui_textbox.js';\r\nimport {startMenu} from '../widgets/ui_menu.js';\r\n\r\nfunction list(iter) {\r\n  let ret = [];\r\n\r\n  for (let item of iter) {\r\n    ret.push(item);\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nui_menu.startMenuEventWrangling();\r\n\r\nlet _events_started = false;\r\n\r\nexport function registerToolStackGetter(func) {\r\n  FrameManager_ops.registerToolStackGetter(func);\r\n}\r\n\r\nlet Vector2         = vectormath.Vector2,\r\n    UIBase          = ui_base.UIBase,\r\n    styleScrollBars = ui_base.styleScrollBars;\r\n\r\nlet update_stack = new Array(8192);\r\nupdate_stack.cur = 0;\r\n\r\nlet screen_idgen = 0;\r\n\r\nexport function purgeUpdateStack() {\r\n  for (let i = 0; i < update_stack.length; i++) {\r\n    update_stack[i] = undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Base class for app workspaces\r\n *\r\n attributes:\r\n\r\n inherit-scale : don't resize to fit whole screen, use cssbox scaling\r\n\r\n */\r\nexport class Screen extends ui_base.UIBase {\r\n  constructor() {\r\n    super();\r\n\r\n    this.snapLimit = 1;\r\n    this.fullScreen = true;\r\n\r\n    //all widget shadow DOMs reference this style tag,\r\n    //or rather they copy it\r\n    this.globalCSS = document.createElement(\"style\");\r\n    this.shadow.prepend(this.globalCSS);\r\n\r\n    this._do_updateSize = true;\r\n    this._resize_callbacks = [];\r\n\r\n    this.allBordersMovable = cconst.DEBUG.allBordersMovable;\r\n    this.needsBorderRegen = true;\r\n\r\n    this._popup_safe = 0;\r\n\r\n    //if true, will test all areas for keymaps on keypress,\r\n    //not just the active one\r\n    this.testAllKeyMaps = false;\r\n\r\n    this.needsTabRecalc = true;\r\n    this._screen_id = screen_idgen++;\r\n\r\n    this._popups = [];\r\n\r\n    this._ctx = undefined;\r\n\r\n    this.keymap = new KeyMap();\r\n\r\n    this.size = new Vector2([window.innerWidth, window.innerHeight]);\r\n    this.pos = new Vector2();\r\n    this.oldpos = new Vector2();\r\n\r\n    this.idgen = 0;\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n    this.mpos = [0, 0];\r\n\r\n    this.screenborders = [];\r\n    this.screenverts = [];\r\n    this._vertmap = {};\r\n    this._edgemap = {};\r\n    this._idmap = {};\r\n\r\n    //effective bounds of screen\r\n    this._aabb = [new Vector2(), new Vector2()];\r\n\r\n    let on_mousemove = (e, x, y) => {\r\n      //let elem = this.pickElement(x, y, 1, 1, ScreenArea.ScreenArea);\r\n      let dragging = e.type === \"mousemove\" || e.type === \"touchmove\" || e.type === \"pointermove\";\r\n      dragging = dragging && (e.buttons || (e.touches && e.touches.length > 0));\r\n\r\n      /*\r\n      make sure active area is up to date.\r\n      but don't call pickElement too often as it's slow\r\n      */\r\n      if (!dragging && Math.random() > 0.9) {\r\n        let elem = this.pickElement(x, y, {\r\n          sx        : 1,\r\n          sy        : 1,\r\n          nodeclass : ScreenArea.ScreenArea,\r\n          mouseEvent: e\r\n        });\r\n\r\n        if (0) {\r\n          let elem2 = this.pickElement(x, y, 1, 1);\r\n          console.log(\"\" + this.sareas.active, elem2 ? elem2.tagName : undefined, elem !== undefined);\r\n        }\r\n\r\n        if (elem !== undefined) {\r\n          if (elem.area) {\r\n            //make sure context area stacks are up to date\r\n            elem.area.push_ctx_active();\r\n            elem.area.pop_ctx_active();\r\n          }\r\n\r\n          this.sareas.active = elem;\r\n        }\r\n      }\r\n\r\n      this.mpos[0] = x;\r\n      this.mpos[1] = y;\r\n    }\r\n    this.shadow.addEventListener(\"mousemove\", (e) => {\r\n      return on_mousemove(e, e.x, e.y);\r\n    }, {passive: true});\r\n\r\n    /*UIBase forwards touch events already\r\n    this.shadow.addEventListener(\"touchmove\", (e) => {\r\n      if (e.touches.length === 0) {\r\n        return;\r\n      }\r\n\r\n      return on_mousemove(e, e.touches[0].pageX, e.touches[0].pagesY);\r\n    }, {passive : true});\r\n    */\r\n  }\r\n\r\n  get borders() {\r\n    let this2 = this;\r\n\r\n    return (function* () {\r\n      for (let k in this2._edgemap) {\r\n        yield this2._edgemap[k];\r\n      }\r\n    })();\r\n  }\r\n\r\n  get listening() {\r\n    return this.listen_timer !== undefined;\r\n  }\r\n\r\n  get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  set ctx(val) {\r\n    this._ctx = val;\r\n\r\n    //fully recurse tree\r\n    let rec = (n) => {\r\n      if (n instanceof UIBase) {\r\n        n.ctx = val;\r\n      }\r\n\r\n      for (let n2 of n.childNodes) {\r\n        rec(n2);\r\n      }\r\n\r\n      if (n.shadow) {\r\n        for (let n2 of n.shadow.childNodes) {\r\n          rec(n2);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let n of this.childNodes) {\r\n      rec(n);\r\n    }\r\n\r\n    for (let n of this.shadow.childNodes) {\r\n      rec(n);\r\n    }\r\n  }\r\n\r\n  static fromJSON(obj, schedule_resize = false) {\r\n    let ret = UIBase.createElement(this.define().tagname);\r\n    return ret.loadJSON(obj, schedule_resize);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"pathux-screen-x\"\r\n    };\r\n  }\r\n\r\n  static newSTRUCT() {\r\n    return UIBase.createElement(this.define().tagname);\r\n  }\r\n\r\n  setPosSize(x, y, w, h) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setSize(w, h) {\r\n    this.size[0] = w;\r\n    this.size[1] = h;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  setPos(x, y) {\r\n    this.pos[0] = x;\r\n    this.pos[1] = y;\r\n\r\n    this.setCSS();\r\n    this._internalRegenAll();\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    if (this.hasAttribute(\"listen\")) {\r\n      this.listen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} style May be a string, a CSSStyleSheet instance, or a style tag\r\n   * @returns Promise fulfilled when style has been merged\r\n   */\r\n  mergeGlobalCSS(style) {\r\n    return new Promise((accept, reject) => {\r\n      let sheet;\r\n\r\n      let finish = () => {\r\n        let sheet2 = this.globalCSS.sheet;\r\n        if (!sheet2) {\r\n          this.doOnce(finish);\r\n          return;\r\n        }\r\n\r\n        let map = {};\r\n        for (let rule of sheet2.rules) {\r\n          map[rule.selectorText] = rule;\r\n        }\r\n\r\n        for (let rule of sheet.rules) {\r\n          let k = rule.selectorText;\r\n          if (k in map) {\r\n            let rule2 = map[k];\r\n\r\n            if (!rule.styleMap) { //handle firefox\r\n              for (let k in rule.style) {\r\n                let desc = Object.getOwnPropertyDescriptor(rule.style, k);\r\n\r\n                if (!desc || !desc.writable) {\r\n                  continue;\r\n                }\r\n                let v = rule.style[k];\r\n\r\n                if (v) {\r\n                  rule2.style[k] = rule.style[k];\r\n                }\r\n              }\r\n              continue;\r\n            }\r\n            for (let [key, val] of list(rule.styleMap.entries())) {\r\n              if (1 || rule2.styleMap.has(key)) {\r\n                //rule2.styleMap.delete(key);\r\n                let sval = \"\";\r\n\r\n                if (Array.isArray(val)) {\r\n                  for (let item of val) {\r\n                    sval += \" \" + val;\r\n                  }\r\n                  sval = sval.trim();\r\n                } else {\r\n                  sval = (\"\" + val).trim();\r\n                }\r\n\r\n                rule2.style[key] = sval;\r\n                rule2.styleMap.set(key, val);\r\n              } else {\r\n                rule2.styleMap.append(key, val);\r\n              }\r\n            }\r\n          } else {\r\n            sheet2.insertRule(rule.cssText);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (typeof style === \"string\") {\r\n        try { //stupid firefox\r\n          sheet = new CSSStyleSheet();\r\n        } catch (error) {\r\n          sheet = undefined;\r\n        }\r\n\r\n        if (sheet && sheet.replaceSync) {\r\n          sheet.replaceSync(style);\r\n          finish();\r\n        } else {\r\n          let tag = document.createElement(\"style\");\r\n          tag.textContent = style;\r\n          document.body.appendChild(tag);\r\n\r\n          let cb = () => {\r\n            if (!tag.sheet) {\r\n              this.doOnce(cb);\r\n              return;\r\n            }\r\n\r\n            sheet = tag.sheet;\r\n            finish();\r\n            tag.remove();\r\n          };\r\n\r\n          this.doOnce(cb)\r\n        }\r\n      } else if (!(style instanceof CSSStyleSheet)) {\r\n        sheet = style.sheet;\r\n        finish();\r\n      } else {\r\n        sheet = style;\r\n        finish();\r\n      }\r\n    });\r\n  }\r\n\r\n  newScreenArea() {\r\n    let ret = UIBase.createElement(\"screenarea-x\");\r\n    ret.ctx = this.ctx;\r\n\r\n    if (ret.ctx) {\r\n      ret.init();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  copy() {\r\n    let ret = UIBase.createElement(this.constructor.define().tagname);\r\n    ret.ctx = this.ctx;\r\n    ret._init();\r\n\r\n    for (let sarea of this.sareas) {\r\n      let sarea2 = sarea.copy(ret);\r\n\r\n      sarea2._ctx = this.ctx;\r\n      sarea2.screen = ret;\r\n      sarea2.parentWidget = ret;\r\n\r\n      ret.appendChild(sarea2);\r\n    }\r\n\r\n    for (let sarea of ret.sareas) {\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n\r\n      sarea.area.push_ctx_active();\r\n      sarea._init();\r\n      sarea.area._init();\r\n      sarea.area.pop_ctx_active();\r\n\r\n      for (let area of sarea.editors) {\r\n        area.ctx = this.ctx;\r\n\r\n        area.push_ctx_active();\r\n        area._init();\r\n        area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    ret.update();\r\n    ret.regenBorders();\r\n    ret.setCSS();\r\n\r\n    return ret;\r\n  }\r\n\r\n  findScreenArea(x, y) {\r\n    for (let i = this.sareas.length - 1; i >= 0; i--) {\r\n      let sarea = this.sareas[i];\r\n\r\n      let ok = x >= sarea.pos[0] && x <= sarea.pos[0] + sarea.size[0];\r\n      ok = ok && (y >= sarea.pos[1] && y <= sarea.pos[1] + sarea.size[1]);\r\n\r\n      if (ok) {\r\n        return sarea;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param x\r\n   * @param y\r\n   * @param args arguments : {sx, sy, nodeclass, excluded_classes}\r\n   */\r\n  pickElement(x, y, args, marginy, nodeclass, excluded_classes) {\r\n    let marginx;\r\n\r\n    if (typeof args === \"object\") {\r\n      nodeclass = args.nodeclass;\r\n      excluded_classes = args.excluded_classes;\r\n    } else {\r\n      args = {\r\n        nodeclass,\r\n        excluded_classes\r\n      };\r\n    }\r\n\r\n    if (!this.ctx) {\r\n      console.warn(\"no ctx in screen\");\r\n      return;\r\n    }\r\n\r\n    let ret;\r\n    for (let i = this._popups.length - 1; i >= 0; i--) {\r\n      let popup = this._popups[i];\r\n      ret = ret || popup.pickElement(x, y, args);\r\n    }\r\n    ret = ret || super.pickElement(x, y, args);\r\n\r\n    return ret;\r\n  }\r\n\r\n  _enterPopupSafe() {\r\n    if (this._popup_safe === undefined) {\r\n      this._popup_safe = 0;\r\n    }\r\n\r\n    this._popup_safe++;\r\n  }\r\n\r\n  * _allAreas() {\r\n    for (let sarea of this.sareas) {\r\n      for (let area of sarea.editors) {\r\n        yield [area, area._area_id, sarea];\r\n      }\r\n    }\r\n  }\r\n\r\n  _exitPopupSafe() {\r\n    this._popup_safe = Math.max(this._popup_safe - 1, 0);\r\n  }\r\n\r\n  popupMenu(menu, x, y) {\r\n    startMenu(menu, x, y);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      menu.flushSetCSS();\r\n      menu.flushUpdate();\r\n    }\r\n\r\n    return menu;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param popupDelay : if non-zero, wait for popup to layout for popupDelay miliseconds,\r\n   *                     then move the popup so it's fully inside the window (if it's outsize).\r\n   *\r\n   * */\r\n  popup(owning_node, elem_or_x, y, closeOnMouseOut = true, popupDelay = 5) {\r\n    let ret = this._popup(...arguments);\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    if (popupDelay === 0) {\r\n      return ret;\r\n    }\r\n\r\n    let z = ret.style[\"z-index\"];\r\n\r\n    ret.style[\"z-index\"] = \"-10\";\r\n\r\n    let cb = () => {\r\n      let rect = ret.getClientRects()[0];\r\n      let size = this.size;\r\n\r\n      if (!rect) {\r\n        this.doOnce(cb);\r\n        return;\r\n      }\r\n\r\n      //console.log(\"rect\", rect);\r\n\r\n      if (rect.bottom > size[1]) {\r\n        ret.style[\"top\"] = (size[1] - rect.height - 10) + \"px\";\r\n      } else if (rect.top < 0) {\r\n        ret.style[\"top\"] = \"10px\";\r\n      }\r\n      if (rect.right > size[0]) {\r\n        ret.style[\"left\"] = (size[0] - rect.width - 10) + \"px\";\r\n      } else if (rect.left < 0) {\r\n        ret.style[\"left\"] = \"10px\";\r\n      }\r\n\r\n\r\n      ret.style[\"z-index\"] = z;\r\n\r\n      ret.flushUpdate();\r\n      ret.flushSetCSS();\r\n    }\r\n\r\n    setTimeout(cb, popupDelay);\r\n    //this.doOnce(cb);\r\n\r\n    return ret;\r\n  }\r\n\r\n  draggablePopup(x, y) {\r\n    let ret = UIBase.createElement(\"drag-box-x\");\r\n    ret.ctx = this.ctx;\r\n    ret.parentWidget = this;\r\n    ret._init();\r\n\r\n    this._popups.push(ret);\r\n\r\n    ret._onend = () => {\r\n      if (this._popups.indexOf(ret) >= 0) {\r\n        this._popups.remove(ret);\r\n      }\r\n    }\r\n\r\n    ret.style[\"z-index\"] = 205;\r\n    ret.style[\"position\"] = UIBase.PositionKey;\r\n    ret.style[\"left\"] = x + \"px\";\r\n    ret.style[\"top\"] = y + \"px\";\r\n\r\n    document.body.appendChild(ret);\r\n\r\n    return ret;\r\n  }\r\n\r\n  /** makes a popup at x,y and returns a new container-x for it */\r\n  _popup(owning_node, elem_or_x, y, closeOnMouseOut = true) {\r\n    let x;\r\n\r\n    let sarea = this.sareas.active;\r\n\r\n    let w = owning_node;\r\n    while (w) {\r\n      if (w instanceof ScreenArea.ScreenArea) {\r\n        sarea = w;\r\n        break;\r\n      }\r\n      w = w.parentWidget;\r\n    }\r\n\r\n    if (typeof elem_or_x === \"object\") {\r\n      let r = elem_or_x.getClientRects()[0];\r\n\r\n      x = r.x;\r\n      y = r.y;\r\n    } else {\r\n      x = elem_or_x;\r\n    }\r\n\r\n    x += window.scrollX;\r\n    y += window.scrollY;\r\n\r\n    let container = UIBase.createElement(\"container-x\");\r\n\r\n    container.ctx = this.ctx;\r\n    container._init();\r\n\r\n    let remove = container.remove;\r\n    container.remove = () => {\r\n      if (this._popups.indexOf(container) >= 0) {\r\n        this._popups.remove(container);\r\n      }\r\n\r\n      return remove.apply(container, arguments);\r\n    };\r\n\r\n    container.overrideClass(\"popup\");\r\n\r\n    container.background = container.getDefault(\"background-color\");\r\n    container.style[\"border-radius\"] = container.getDefault(\"border-radius\") + \"px\";\r\n    container.style[\"border-color\"] = container.getDefault(\"border-color\");\r\n    container.style[\"border-style\"] = container.getDefault(\"border-style\");\r\n    container.style[\"border-width\"] = container.getDefault(\"border-width\") + \"px\";\r\n    container.style[\"box-shadow\"] = container.getDefault(\"box-shadow\");\r\n\r\n    container.style[\"position\"] = UIBase.PositionKey;\r\n    container.style[\"z-index\"] = \"2205\";\r\n    container.style[\"left\"] = x + \"px\";\r\n    container.style[\"top\"] = y + \"px\";\r\n    container.style[\"margin\"] = \"0px\";\r\n\r\n    container.parentWidget = this;\r\n\r\n    let mm = new math.MinMax(2);\r\n    let p = new Vector2();\r\n\r\n    let _update = container.update;\r\n    container.update.after(() => {\r\n      container.style[\"z-index\"] = \"2205\";\r\n    });\r\n\r\n    /*causes weird bugs\r\n    container.update = () => {\r\n      _update.call(container);\r\n\r\n      let rects = container.getClientRects();\r\n      mm.reset();\r\n\r\n      for (let r of rects) {\r\n        p[0] = r.x;\r\n        p[1] = r.y;\r\n        mm.minmax(p);\r\n\r\n        p[0] += r.width;\r\n        p[1] += r.height;\r\n        mm.minmax(p);\r\n      }\r\n\r\n      let x = mm.min[0], y = mm.min[1];\r\n\r\n      x = Math.min(x, this.size[0]-(mm.max[0]-mm.min[0]));\r\n      y = Math.min(y, this.size[1]-(mm.max[1]-mm.min[1]));\r\n\r\n      container.style[\"left\"] = x + \"px\";\r\n      container.style[\"top\"] = y + \"px\";\r\n    }//*/\r\n\r\n    document.body.appendChild(container);\r\n    //this.shadow.appendChild(container);\r\n    this.setCSS();\r\n\r\n    this._popups.push(container);\r\n\r\n    let touchpick, mousepick, keydown;\r\n\r\n    let done = false;\r\n    let end = () => {\r\n      if (this._popup_safe) {\r\n        return;\r\n      }\r\n\r\n      if (done) return;\r\n\r\n      //this.ctx.screen.removeEventListener(\"touchstart\", touchpick, true);\r\n      //this.ctx.screen.removeEventListener(\"touchmove\", touchpick, true);\r\n      this.ctx.screen.removeEventListener(\"mousedown\", mousepick, true);\r\n      this.ctx.screen.removeEventListener(\"mousemove\", mousepick, {passive: true});\r\n      this.ctx.screen.removeEventListener(\"mouseup\", mousepick, true);\r\n      window.removeEventListener(\"keydown\", keydown);\r\n\r\n      done = true;\r\n      container.remove();\r\n    };\r\n\r\n    container.end = end;\r\n\r\n    let _remove = container.remove;\r\n    container.remove = function () {\r\n      if (arguments.length == 0) {\r\n        end();\r\n      }\r\n      _remove.apply(this, arguments);\r\n    };\r\n\r\n    container._ondestroy = () => {\r\n      end();\r\n    };\r\n\r\n    let bad_time = util.time_ms();\r\n    let last_pick_time = util.time_ms();\r\n\r\n    mousepick = (e, x, y, do_timeout = true) => {\r\n      if (!container.isConnected) {\r\n        end();\r\n        return;\r\n      }\r\n\r\n      if (sarea && sarea.area) {\r\n        sarea.area.push_ctx_active();\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n      //console.log(\"=======================================================popup touch start\");\r\n      //console.log(e);\r\n\r\n      if (util.time_ms() - last_pick_time < 350) {\r\n        return;\r\n      }\r\n      last_pick_time = util.time_ms();\r\n\r\n      x = x === undefined ? e.x : x;\r\n      y = y === undefined ? e.y : y;\r\n\r\n      //let elem = this.pickElement(x, y, 2, 2, undefined, [ScreenBorder]);\r\n      let elem = this.pickElement(x, y, {\r\n        sx              : 2,\r\n        sy              : 2,\r\n        excluded_classes: [ScreenBorder],\r\n        mouseEvent      : e\r\n      });\r\n\r\n      let startelem = elem;\r\n\r\n      if (elem === undefined) {\r\n        if (closeOnMouseOut) {\r\n          end();\r\n        }\r\n        return;\r\n      }\r\n\r\n      let ok = false;\r\n      let elem2 = elem;\r\n\r\n      while (elem) {\r\n        if (elem === container) {\r\n          ok = true;\r\n          break;\r\n        }\r\n        elem = elem.parentWidget;\r\n      }\r\n\r\n      if (!ok) {\r\n        do_timeout = !do_timeout || (util.time_ms() - bad_time > 100);\r\n\r\n        if (closeOnMouseOut && do_timeout) {\r\n          end();\r\n        }\r\n      } else {\r\n        bad_time = util.time_ms();\r\n      }\r\n    };\r\n\r\n    touchpick = (e) => {\r\n      let x = e.touches[0].pageX, y = e.touches[0].pageY;\r\n\r\n      return mousepick(e, x, y, false);\r\n    };\r\n\r\n    keydown = (e) => {\r\n      if (!container.isConnected) {\r\n        window.removeEventListener(\"keydown\", keydown);\r\n        return;\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case keymap[\"Escape\"]:\r\n          end();\r\n          break;\r\n      }\r\n    };\r\n\r\n    //this.ctx.screen.addEventListener(\"touchstart\", touchpick, true);\r\n    //this.ctx.screen.addEventListener(\"touchmove\", touchpick, true);\r\n    this.ctx.screen.addEventListener(\"mousedown\", mousepick, true);\r\n    this.ctx.screen.addEventListener(\"mousemove\", mousepick, {passive: true});\r\n    this.ctx.screen.addEventListener(\"mouseup\", mousepick, true);\r\n    window.addEventListener(\"keydown\", keydown);\r\n\r\n    /*\r\n    container.addEventListener(\"mouseleave\", (e) => {\r\n      console.log(\"popup mouse leave\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    container.addEventListener(\"mouseout\", (e) => {\r\n      console.log(\"popup mouse out\");\r\n      if (closeOnMouseOut)\r\n        end();\r\n    });\r\n    //*/\r\n\r\n    this.calcTabOrder();\r\n\r\n    return container;\r\n  }\r\n\r\n  _recalcAABB(save = true) {\r\n    let mm = new math.MinMax(2);\r\n\r\n    for (let v of this.screenverts) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    if (save) {\r\n      this._aabb[0].load(mm.min);\r\n      this._aabb[1].load(mm.max);\r\n    }\r\n\r\n    return [new Vector2(mm.min), new Vector2(mm.max)];\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  load() {\r\n  }\r\n\r\n  //XXX look at if this is referenced anywhere\r\n  save() {\r\n  }\r\n\r\n  popupArea(area_class) {\r\n    return makePopupArea(area_class, this);\r\n  }\r\n\r\n  remove(trigger_destroy = true) {\r\n    this.unlisten();\r\n\r\n    if (trigger_destroy) {\r\n      return super.remove();\r\n    } else {\r\n      HTMLElement.prototype.remove.call(this);\r\n    }\r\n  }\r\n\r\n  unlisten() {\r\n    if (this.listen_timer !== undefined) {\r\n      window.clearInterval(this.listen_timer);\r\n      this.listen_timer = undefined;\r\n    }\r\n  }\r\n\r\n  checkCSSSize() {\r\n    let w = this.style.width.toLowerCase().trim();\r\n    let h = this.style.height.toLowerCase().trim();\r\n\r\n    if (w.endsWith(\"px\") && h.endsWith(\"px\")) {\r\n      w = parseFloat(w.slice(0, w.length - 2).trim());\r\n      h = parseFloat(h.slice(0, h.length - 2).trim());\r\n\r\n      if (w !== this.size[0] || h !== this.size[1]) {\r\n        this.on_resize([this.size[0], this.size[1]], [w, h]);\r\n        this.size[0] = w;\r\n        this.size[1] = h;\r\n      }\r\n    }\r\n  }\r\n\r\n  getBoolAttribute(attr, defaultval = false) {\r\n    if (!this.hasAttribute(attr)) {\r\n      return defaultval;\r\n    }\r\n\r\n    let ret = this.getAttribute(attr);\r\n\r\n    if (typeof ret === \"number\") {\r\n      return !!ret;\r\n    } else if (typeof ret === \"string\") {\r\n      ret = ret.toLowerCase().trim();\r\n      ret = ret === \"true\" || ret === \"1\" || ret === \"yes\";\r\n    }\r\n\r\n    return !!ret;\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.getBoolAttribute(\"inherit-scale\") || !this.fullScreen || !cconst.autoSizeUpdate) {\r\n      this.checkCSSSize();\r\n      return;\r\n    }\r\n\r\n    let width = window.innerWidth;\r\n    let height = window.innerHeight;\r\n\r\n    let ratio = window.outerHeight/window.innerHeight;\r\n    let scale = visualViewport.scale;\r\n\r\n    let pad = 4;\r\n    width = visualViewport.width*scale - pad;\r\n    height = visualViewport.height*scale - pad;\r\n\r\n    let ox = visualViewport.offsetLeft;\r\n    let oy = visualViewport.offsetTop;\r\n\r\n    if (cconst.DEBUG.customWindowSize) {\r\n      let s = cconst.DEBUG.customWindowSize;\r\n      width = s.width;\r\n      height = s.height;\r\n      ox = 0;\r\n      oy = 0;\r\n      window._DEBUG = cconst.DEBUG;\r\n    }\r\n\r\n    let key = this._calcSizeKey(width, height, ox, oy, devicePixelRatio, scale);\r\n\r\n    /* CSS IS EVIL! WHY DOES BODY HAVE A MARGIN? */\r\n    document.body.style.margin = document.body.style.padding = \"0px\";\r\n    document.body.style[\"transform-origin\"] = \"top left\";\r\n    document.body.style[\"transform\"] = `translate(${ox}px,${oy}px) scale(${1.0/scale})`;\r\n\r\n    //document.body.style[\"transform\"] = `scale(${1.0 / scale}, ${1.0 / scale})`; // translate(${ox*scale2}px, ${oy*scale2}px)`;\r\n\r\n    if (key !== this._last_ckey1) {\r\n      //console.log(\"resizing\", key, this._last_ckey1);\r\n      this._last_ckey1 = key;\r\n\r\n      this.on_resize(this.size, [width, height], false);\r\n      this.on_resize(this.size, this.size, false);\r\n\r\n      let scale = visualViewport.scale;\r\n\r\n\r\n      this.regenBorders();\r\n\r\n      this.setCSS();\r\n      this.completeUpdate();\r\n    }\r\n  }\r\n\r\n  listen(args = {updateSize: true}) {\r\n    ui_menu.setWranglerScreen(this);\r\n\r\n    let ctx = this.ctx;\r\n    startEvents(() => ctx.screen);\r\n\r\n    if (this.listen_timer !== undefined) {\r\n      return; //already listening\r\n    }\r\n\r\n    this._do_updateSize = args.updateSize !== undefined ? args.updateSize : true;\r\n\r\n    this.listen_timer = window.setInterval(() => {\r\n      if (this.isDead()) {\r\n        console.log(\"dead screen\");\r\n        this.unlisten();\r\n        return;\r\n      }\r\n\r\n      this.update();\r\n    }, 150);\r\n  }\r\n\r\n  _calcSizeKey(w, h, x, y, dpi, scale) {\r\n    if (arguments.length !== 6) {\r\n      throw new Error(\"eek\");\r\n    }\r\n\r\n    let s = \"\";\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      s += arguments[i].toFixed(0) + \":\";\r\n    }\r\n\r\n    return s;\r\n  }\r\n\r\n  _ondestroy() {\r\n    if (ui_menu.getWranglerScreen() === this) {\r\n      //ui_menu.setWranglerScreen(undefined);\r\n    }\r\n\r\n    this.unlisten();\r\n\r\n    //unlike other ondestroy functions, this one physically dismantles the DOM tree\r\n    let recurse = (n, second_pass, parent) => {\r\n      if (n.__pass === second_pass) {\r\n        console.warn(\"CYCLE IN DOM TREE!\", n, parent);\r\n        return;\r\n      }\r\n\r\n      n.__pass = second_pass;\r\n\r\n      n._forEachChildWidget(n2 => {\r\n        if (n === n2)\r\n          return;\r\n        recurse(n2, second_pass, n);\r\n\r\n        try {\r\n          if (!second_pass && !n2.__destroyed) {\r\n            n2.__destroyed = true;\r\n            n2._ondestroy();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to exectue an ondestroy callback\");\r\n        }\r\n\r\n        n2.__destroyed = true;\r\n\r\n        try {\r\n          if (second_pass) {\r\n            n2.remove();\r\n          }\r\n        } catch (error) {\r\n          print_stack(error);\r\n          console.log(\"failed to remove element after ondestroy callback\");\r\n        }\r\n      });\r\n    };\r\n\r\n    let id = ~~(Math.random()*1024*1024);\r\n\r\n    recurse(this, id);\r\n    recurse(this, id + 1);\r\n  }\r\n\r\n  destroy() {\r\n    this._ondestroy();\r\n  }\r\n\r\n  clear() {\r\n    this._ondestroy();\r\n\r\n    this.sareas = [];\r\n    this.sareas.active = undefined;\r\n\r\n    for (let child of list(this.childNodes)) {\r\n      child.remove();\r\n    }\r\n    for (let child of list(this.shadow.childNodes)) {\r\n      child.remove();\r\n    }\r\n  }\r\n\r\n  _test_save() {\r\n    let obj = JSON.parse(JSON.stringify(this));\r\n    console.log(JSON.stringify(this));\r\n\r\n    this.loadJSON(obj);\r\n  }\r\n\r\n  loadJSON(obj, schedule_resize = false) {\r\n    this.clear();\r\n    super.loadJSON();\r\n\r\n    for (let sarea of obj.sareas) {\r\n      let sarea2 = UIBase.createElement(\"screenarea-x\");\r\n\r\n      sarea2.ctx = this.ctx;\r\n      sarea2.screen = this;\r\n\r\n      this.appendChild(sarea2);\r\n\r\n      sarea2.loadJSON(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    if (schedule_resize) {\r\n      window.setTimeout(() => {\r\n        this.on_resize(this.size, [window.innerWidth, window.innerHeight]);\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    let ret = {\r\n      sareas: this.sareas\r\n    };\r\n\r\n    ret.size = this.size;\r\n    ret.idgen = this.idgen;\r\n\r\n    return Object.assign(super.toJSON(), ret);\r\n  }\r\n\r\n  getHotKey(toolpath) {\r\n    let test = (keymap) => {\r\n      for (let hk of keymap) {\r\n        if (typeof hk.action != \"string\")\r\n          continue;\r\n\r\n        if (hk.action.trim().startsWith(toolpath.trim())) {\r\n          return hk;\r\n        }\r\n      }\r\n    };\r\n\r\n    let ret = test(this.keymap);\r\n    if (ret)\r\n      return ret;\r\n\r\n    if (this.sareas.active && this.sareas.active.keymap) {\r\n      let area = this.sareas.active.area;\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        ret = test(keymap);\r\n\r\n        if (ret)\r\n          return ret;\r\n      }\r\n    }\r\n\r\n    if (ret === undefined) {\r\n      //just to be safe, check all areas in case the\r\n      //context is confused as to which area is currently \"active\"\r\n\r\n      for (let sarea of this.sareas) {\r\n        let area = sarea.area;\r\n\r\n        for (let keymap of area.getKeyMaps()) {\r\n          ret = test(keymap);\r\n\r\n          if (ret) {\r\n            return ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  addEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      this._resize_callbacks.push(cb);\r\n    } else {\r\n      return super.addEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  removeEventListener(type, cb, options) {\r\n    if (type === \"resize\") {\r\n      if (this._resize_callbacks.indexOf(cb) >= 0)\r\n        this._resize_callbacks.remove(cb);\r\n    } else {\r\n      return super.removeEventListener(type, cb, options);\r\n    }\r\n  }\r\n\r\n  execKeyMap(e) {\r\n    let handled = false;\r\n\r\n    if (window.DEBUG && window.DEBUG.keymap) {\r\n      console.warn(\"execKeyMap called\", e.keyCode, document.activeElement.tagName);\r\n    }\r\n\r\n    if (this.sareas.active) {\r\n      let area = this.sareas.active.area;\r\n\r\n      if (!area) {\r\n        return;\r\n      }\r\n\r\n      area.push_ctx_active();\r\n\r\n      for (let keymap of area.getKeyMaps()) {\r\n        if (keymap === undefined) {\r\n          continue;\r\n        }\r\n\r\n        if (keymap.handle(area.ctx, e)) {\r\n          handled = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      area.pop_ctx_active();\r\n    }\r\n\r\n    handled = handled || this.keymap.handle(this.ctx, e);\r\n\r\n    if (!handled && this.testAllKeyMaps) {\r\n      for (let sarea of this.sareas) {\r\n        if (handled) {\r\n          break;\r\n        }\r\n\r\n        sarea.area.push_ctx_active();\r\n\r\n        for (let keymap of sarea.area.getKeyMaps()) {\r\n          if (keymap.handle(sarea.area.ctx, e)) {\r\n            handled = true;\r\n            break;\r\n          }\r\n        }\r\n\r\n        sarea.area.pop_ctx_active();\r\n      }\r\n    }\r\n\r\n    return handled;\r\n  }\r\n\r\n  calcTabOrder() {\r\n    let nodes = [];\r\n    let visit = {};\r\n\r\n    let rec = (n) => {\r\n      let bad = n.tabIndex < 0 || n.tabIndex === undefined || n.tabIndex === null;\r\n      bad = bad || !(n instanceof UIBase);\r\n\r\n      if (n._id in visit || n.hidden) {\r\n        return;\r\n      }\r\n\r\n      visit[n._id] = 1;\r\n\r\n      if (!bad) {\r\n        n.__pos = n.getClientRects()[0];\r\n        if (n.__pos) {\r\n          nodes.push(n);\r\n        }\r\n      }\r\n\r\n      n._forEachChildWidget((n2) => {\r\n        rec(n2);\r\n      });\r\n    };\r\n\r\n    for (let sarea of this.sareas) {\r\n      rec(sarea);\r\n    }\r\n\r\n    for (let popup of this._popups) {\r\n      rec(popup);\r\n    }\r\n\r\n    //console.log(\"nodes2\", nodes2);\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      let n = nodes[i];\r\n\r\n      n.tabIndex = i + 1;\r\n      //console.log(n.tabIndex);\r\n    }\r\n  }\r\n\r\n  drawUpdate() {\r\n    if (window.redraw_all !== undefined) {\r\n      window.redraw_all();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    let move = [];\r\n    for (let child of this.childNodes) {\r\n      if (child instanceof ScreenArea) {\r\n        move.push(child);\r\n      }\r\n    }\r\n\r\n    for (let child of move) {\r\n      console.warn(\"moved screen area to shadow\");\r\n\r\n      HTMLElement.prototype.remove.call(child);\r\n      this.shadow.appendChild(child);\r\n    }\r\n\r\n    if (this._do_updateSize) {\r\n      this.updateSize();\r\n    }\r\n\r\n    if (this.needsTabRecalc) {\r\n      this.needsTabRecalc = false;\r\n      this.calcTabOrder();\r\n    }\r\n\r\n    outer: for (let sarea of this.sareas) {\r\n      for (let b of sarea._borders) {\r\n        let movable = this.isBorderMovable(b);\r\n\r\n        if (movable !== b.movable) {\r\n          console.log(\"detected change in movable borders\");\r\n          this.regenBorders();\r\n          break outer;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this._update_gen) {\r\n      let ret;\r\n\r\n      /*\r\n      if (cconst.DEBUG.debugUIUpdatePerf) {\r\n          for (ret = this._update_gen.next(); !ret.done; ret = this._update_gen.next()) {}\r\n\r\n        this._update_gen = this.update_intern();\r\n        return;\r\n      }\r\n      //*/\r\n\r\n      try {\r\n        ret = this._update_gen.next();\r\n      } catch (error) {\r\n        if (!(error instanceof DataPathError)) {\r\n          util.print_stack(error);\r\n          console.log(\"error in update_intern tasklet\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (ret !== undefined && ret.done) {\r\n        this._update_gen = undefined;\r\n      }\r\n    } else {\r\n      this._update_gen = this.update_intern();\r\n    }\r\n  }\r\n\r\n  purgeUpdateStack() {\r\n    this._update_gen = undefined;\r\n    purgeUpdateStack();\r\n  }\r\n\r\n  completeSetCSS() {\r\n    let rec = (n) => {\r\n      n.setCSS();\r\n\r\n      if (n.packflag & PackFlags.NO_UPDATE) {\r\n        return;\r\n      }\r\n\r\n      n._forEachChildWidget((c) => {\r\n        rec(c);\r\n      })\r\n    }\r\n\r\n    rec(this);\r\n  }\r\n\r\n  completeUpdate() {\r\n    for (let step of this.update_intern()) {\r\n    }\r\n  }\r\n\r\n  updateScrollStyling() {\r\n    let s = theme.scrollbars;\r\n\r\n    if (!s || !s.color) return;\r\n\r\n    let key = \"\" + s.color + \":\" + s.color2 + \":\" + s.border + \":\" + s.contrast + \":\" + s.width;\r\n\r\n    if (key !== this._last_scrollstyle_key) {\r\n      this._last_scrollstyle_key = key;\r\n\r\n      //console.log(\"updating scrollbar styling\");\r\n\r\n      this.mergeGlobalCSS(styleScrollBars(s.color, s.color2, s.contrast, s.width, s.border, \"*\"));\r\n    }\r\n  }\r\n\r\n  //XXX race condition warning\r\n  update_intern() {\r\n    this.updateScrollStyling();\r\n\r\n    let popups = this._popups;\r\n\r\n    let cssText = \"\";\r\n    let sheet = this.globalCSS.sheet;\r\n    if (sheet) {\r\n      for (let rule of sheet.rules) {\r\n        cssText += rule.cssText + \"\\n\";\r\n      }\r\n\r\n      window.cssText = cssText\r\n    }\r\n    let cssTextHash = util.strhash(cssText);\r\n\r\n    if (this.needsBorderRegen) {\r\n      this.needsBorderRegen = false;\r\n      this.regenBorders();\r\n    }\r\n\r\n    super.update();\r\n    let this2 = this;\r\n\r\n    //ensure each area has proper ctx set\r\n    for (let sarea of this.sareas) {\r\n      if (!sarea.ctx) {\r\n        sarea.ctx = this.ctx;\r\n      }\r\n    }\r\n\r\n    return (function* () {\r\n      let stack = update_stack;\r\n      stack.cur = 0;\r\n\r\n      let lastn = this2;\r\n\r\n      function push(n) {\r\n        stack[stack.cur++] = n;\r\n      }\r\n\r\n      function pop(n) {\r\n        if (stack.cur < 0) {\r\n          throw new Error(\"Screen.update(): stack overflow!\");\r\n        }\r\n\r\n        return stack[--stack.cur];\r\n      }\r\n\r\n      let ctx = this2.ctx;\r\n\r\n      let SCOPE_POP = Symbol(\"pop\");\r\n      let AREA_CTX_POP = Symbol(\"pop2\");\r\n\r\n      let scopestack = [];\r\n      let areastack = [];\r\n\r\n      let t = util.time_ms();\r\n      push(this2);\r\n\r\n      for (let p of popups) {\r\n        push(p);\r\n      }\r\n\r\n      while (stack.cur > 0) {\r\n        let n = pop();\r\n\r\n        if (n === undefined) {\r\n          //console.log(\"eek!\", stack.length);\r\n          continue;\r\n        } else if (n === SCOPE_POP) {\r\n          scopestack.pop();\r\n          continue;\r\n        } else if (n === AREA_CTX_POP) {\r\n          //console.log(\"POP\", areastack[areastack.length-1].constructor.name);\r\n          areastack.pop().pop_ctx_active(ctx, true);\r\n          continue;\r\n        }\r\n\r\n        if (n instanceof Area) {\r\n          //console.log(\"PUSH\", n.constructor.name);\r\n          areastack.push(n);\r\n          n.push_ctx_active(ctx, true);\r\n          push(AREA_CTX_POP);\r\n        }\r\n\r\n        if (!n.hidden && n !== this2 && n instanceof UIBase) {\r\n          if (!n._ctx) {\r\n            n._ctx = ctx;\r\n          }\r\n\r\n          if (n._screenStyleUpdateHash !== cssTextHash) {\r\n            n._screenStyleTag.textContent = cssText;\r\n            n._screenStyleUpdateHash = cssTextHash;\r\n          }\r\n\r\n          if (scopestack.length > 0 && scopestack[scopestack.length - 1]) {\r\n            n.parentWidget = scopestack[scopestack.length - 1];\r\n\r\n            //if (n.parentWidget && n._useDataPathUndo === undefined && n.parentWidget._useDataPathUndo !== undefined) {\r\n            //  n._useDataPathUndo = n.parentWidget._useDataPathUndo;\r\n            //}\r\n          }\r\n\r\n          n.update();\r\n        }\r\n\r\n        if (util.time_ms() - t > 20) {\r\n          yield;\r\n          t = util.time_ms();\r\n        }\r\n\r\n        for (let n2 of n.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n.shadow === undefined) {\r\n          continue;\r\n        }\r\n\r\n        for (let n2 of n.shadow.childNodes) {\r\n          if (!(n2 instanceof UIBase) || !(n2.packflag & PackFlags.NO_UPDATE)) {\r\n            push(n2);\r\n          }\r\n        }\r\n\r\n        if (n instanceof UIBase) {\r\n          if (!(n.packflag & PackFlags.NO_UPDATE)) {\r\n            scopestack.push(n);\r\n            push(SCOPE_POP);\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  //load pos/size from screenverts\r\n  loadFromVerts() {\r\n    let old = [0, 0];\r\n    for (let sarea of this.sareas) {\r\n      old[0] = sarea.size[0];\r\n      old[1] = sarea.size[1];\r\n\r\n      sarea.loadFromVerts();\r\n      sarea.on_resize(old);\r\n      sarea.setCSS();\r\n    }\r\n\r\n    this.setCSS();\r\n  }\r\n\r\n  /** merges sarea into the screen area opposite to sarea*/\r\n  collapseArea(sarea, border) {\r\n    let sarea2;\r\n\r\n    if (!border) {\r\n      for (let b of sarea._borders) {\r\n        let sarea2 = b.getOtherSarea(sarea);\r\n\r\n        if (sarea2 && !b.locked) {\r\n          border = b;\r\n          break;\r\n        }\r\n      }\r\n    } else if (border.locked) {\r\n      console.warn(\"Cannot remove screen border\");\r\n    }\r\n\r\n    console.warn(\"SAREA2\", border, sarea2, sarea2 !== sarea);\r\n\r\n    if (border) {\r\n      sarea2 = border.getOtherSarea(sarea);\r\n\r\n      if (!sarea2) {\r\n        console.error(\"Error merging sarea\");\r\n        return;\r\n      }\r\n\r\n      let size1 = new Vector2(sarea.pos).add(sarea.size);\r\n      let size2 = new Vector2(sarea2.pos).add(sarea2.size);\r\n\r\n      sarea2.pos.min(sarea.pos);\r\n      sarea2.size.load(size1).max(size2).sub(sarea2.pos);\r\n\r\n      sarea2.loadFromPosSize();\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this._internalRegenAll();\r\n\r\n    return this;\r\n  }\r\n\r\n  splitArea(sarea, t = 0.5, horiz = true) {\r\n    let w = sarea.size[0], h = sarea.size[1];\r\n    let x = sarea.pos[0], y = sarea.size[1];\r\n    let s1, s2;\r\n\r\n    if (!horiz) {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[0] *= t;\r\n      s2.size[0] *= (1.0 - t);\r\n\r\n      s2.pos[0] += w*t;\r\n    } else {\r\n      s1 = sarea;\r\n      if (s1.ctx === undefined) {\r\n        s1.ctx = this.ctx;\r\n      }\r\n      s2 = s1.copy(this);\r\n\r\n      s1.size[1] *= t;\r\n      s2.size[1] *= (1.0 - t);\r\n\r\n      s2.pos[1] += h*t;\r\n    }\r\n\r\n    s2.ctx = this.ctx;\r\n    this.appendChild(s2);\r\n\r\n    s1.on_resize(s1.size);\r\n    s2.on_resize(s2.size);\r\n\r\n    this.regenBorders();\r\n    this.solveAreaConstraints();\r\n\r\n    s1.setCSS();\r\n    s2.setCSS();\r\n\r\n    this.setCSS();\r\n\r\n    //XXX not sure if this is right place to do this or really necassary\r\n    if (s2.area !== undefined)\r\n      s2.area.onadd();\r\n\r\n    return s2;\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.getBoolAttribute(\"inherit-scale\")) {\r\n      this.style[\"width\"] = this.size[0] + \"px\";\r\n      this.style[\"height\"] = this.size[1] + \"px\";\r\n    }\r\n\r\n    this.style[\"overflow\"] = \"hidden\";\r\n\r\n    //call setCSS on borders\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n  }\r\n\r\n  regenScreenMesh(snapLimit = SnapLimit) {\r\n    this.snapLimit = snapLimit;\r\n\r\n    this.regenBorders();\r\n  }\r\n\r\n  regenBorders_stage2() {\r\n    for (let b of this.screenborders) {\r\n      b.halfedges = []\r\n    }\r\n\r\n    function hashHalfEdge(border, sarea) {\r\n      return border._id + \":\" + sarea._id;\r\n    }\r\n\r\n    function has_he(border, border2, sarea) {\r\n      for (let he of border.halfedges) {\r\n        if (border2 === he.border && sarea === he.sarea) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    for (let b1 of this.screenborders) {\r\n      for (let sarea of b1.sareas) {\r\n        let he = new ScreenHalfEdge(b1, sarea);\r\n        b1.halfedges.push(he);\r\n      }\r\n\r\n      let axis = b1.horiz ? 1 : 0;\r\n\r\n      let min = Math.min(b1.v1[axis], b1.v2[axis]);\r\n      let max = Math.max(b1.v1[axis], b1.v2[axis]);\r\n\r\n      for (let b2 of this.walkBorderLine(b1)) {\r\n        if (b1 === b2) {\r\n          continue;\r\n        }\r\n\r\n        let ok = b2.v1[axis] >= min && b2.v1[axis] <= max;\r\n        ok = ok || (b2.v2[axis] >= min && b2.v2[axis] <= max);\r\n\r\n        for (let sarea of b2.sareas) {\r\n          let ok2 = ok && !has_he(b2, b1, sarea);\r\n          if (ok2) {\r\n            let he2 = new ScreenHalfEdge(b2, sarea);\r\n            b1.halfedges.push(he2);\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n    for (let b of this.screenborders) {\r\n      let movable = true;\r\n\r\n      for (let sarea of b.sareas) {\r\n        movable = movable && this.isBorderMovable(b);\r\n      }\r\n\r\n      b.movable = movable;\r\n    }\r\n  }\r\n\r\n  hasBorder(b) {\r\n    return b._id in this._idmap;\r\n  }\r\n\r\n  killScreenVertex(v) {\r\n    this.screenverts.remove(v);\r\n\r\n    delete this._edgemap[ScreenVert.hash(v, undefined, this.snapLimit)];\r\n    delete this._idmap[v._id];\r\n\r\n    return this;\r\n  }\r\n\r\n  freeBorder(b, sarea) {\r\n    if (b.sareas.indexOf(sarea) >= 0) {\r\n      b.sareas.remove(sarea);\r\n    }\r\n\r\n    let dels = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea === sarea) {\r\n        dels.push([b, he]);\r\n      }\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2 === he)\r\n          continue;\r\n\r\n        if (he2.sarea === sarea) {\r\n          dels.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of dels) {\r\n      if (d[0].halfedges.indexOf(d[1]) < 0) {\r\n        console.warn(\"Double remove detected; use util.set?\");\r\n        continue;\r\n      }\r\n\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    if (b.sareas.length === 0) {\r\n      this.killBorder(b);\r\n    }\r\n  }\r\n\r\n  killBorder(b) {\r\n    console.log(\"killing border\", b._id, b);\r\n\r\n    if (this.screenborders.indexOf(b) < 0) {\r\n      console.log(\"unknown border\", b);\r\n      b.remove();\r\n      return;\r\n    }\r\n\r\n    this.screenborders.remove(b);\r\n\r\n    let del = [];\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he === he2)\r\n        continue;\r\n\r\n      for (let he2 of he.border.halfedges) {\r\n        if (he2.border === b) {\r\n          del.push([he.border, he2]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let d of del) {\r\n      d[0].halfedges.remove(d[1]);\r\n    }\r\n\r\n    delete this._edgemap[ScreenBorder.hash(b.v1, b.v2)];\r\n    delete this._idmap[b._id];\r\n\r\n    b.v1.borders.remove(b);\r\n    b.v2.borders.remove(b);\r\n\r\n    if (b.v1.borders.length === 0) {\r\n      this.killScreenVertex(b.v1);\r\n    }\r\n    if (b.v2.borders.length === 0) {\r\n      this.killScreenVertex(b.v2);\r\n    }\r\n\r\n    b.remove();\r\n\r\n    return this;\r\n  }\r\n\r\n  //XXX rename to regenScreenMesh\r\n  regenBorders() {\r\n    for (let b of this.screenborders) {\r\n      b.remove();\r\n    }\r\n\r\n    this._idmap = {};\r\n    this.screenborders = [];\r\n    this._edgemap = {};\r\n    this._vertmap = {};\r\n    this.screenverts = []\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      sarea.makeBorders(this);\r\n    }\r\n\r\n    for (let key in this._edgemap) {\r\n      let b = this._edgemap[key];\r\n\r\n      b.setCSS();\r\n    }\r\n\r\n    this.regenBorders_stage2();\r\n    this._recalcAABB();\r\n\r\n    for (let b of this.screenborders) {\r\n      b.outer = this.isBorderOuter(b);\r\n      b.movable = this.isBorderMovable(b);\r\n      b.setCSS();\r\n    }\r\n\r\n    this.updateDebugBoxes();\r\n  }\r\n\r\n  _get_debug_overlay() {\r\n    if (!this._debug_overlay) {\r\n      this._debug_overlay = UIBase.createElement(\"overdraw-x\");\r\n      let s = this._debug_overlay;\r\n\r\n      s.startNode(this, this);\r\n    }\r\n\r\n    return this._debug_overlay;\r\n  }\r\n\r\n  updateDebugBoxes() {\r\n    if (cconst.DEBUG.screenborders) {\r\n      let overlay = this._get_debug_overlay();\r\n      overlay.clear();\r\n\r\n      for (let b of this.screenborders) {\r\n        overlay.line(b.v1, b.v2, \"red\");\r\n      }\r\n      let del = [];\r\n      for (let child of document.body.childNodes) {\r\n        if (child.getAttribute && child.getAttribute(\"class\") === \"__debug\") {\r\n          del.push(child);\r\n        }\r\n      }\r\n      for (let n of del) {\r\n        n.remove();\r\n      }\r\n\r\n      let box = (x, y, s, text, color = \"red\") => {\r\n        x -= s*0.5;\r\n        y -= s*0.5;\r\n\r\n        x = Math.min(Math.max(x, 0.0), this.size[0] - s);\r\n        y = Math.min(Math.max(y, 0.0), this.size[1] - s);\r\n\r\n        let ret = UIBase.createElement(\"div\");\r\n        ret.setAttribute(\"class\", \"__debug\");\r\n\r\n\r\n        ret.style[\"position\"] = UIBase.PositionKey;\r\n        ret.style[\"left\"] = x + \"px\";\r\n        ret.style[\"top\"] = y + \"px\";\r\n        ret.style[\"height\"] = s + \"px\";\r\n        ret.style[\"width\"] = s + \"px\";//\"200px\";\r\n        ret.style[\"z-index\"] = \"1000\";\r\n        ret.style[\"pointer-events\"] = \"none\";\r\n        ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n        ret.style['display'] = \"float\";\r\n        ret.style[\"background-color\"] = color;\r\n        document.body.appendChild(ret);\r\n\r\n        let colors = [\r\n          \"orange\",\r\n          \"black\",\r\n          \"white\",\r\n        ];\r\n\r\n        for (let i = 2; i >= 0; i--) {\r\n          ret = UIBase.createElement(\"div\");\r\n\r\n          ret.setAttribute(\"class\", \"__debug\");\r\n\r\n          ret.style[\"position\"] = UIBase.PositionKey;\r\n          ret.style[\"left\"] = x + \"px\";\r\n          ret.style[\"top\"] = y + \"px\";\r\n          ret.style[\"height\"] = s + \"px\";\r\n          ret.style[\"width\"] = \"250px\";//\"200px\";\r\n          ret.style[\"z-index\"] = \"\" + (1005 - i - 1);\r\n          ret.style[\"pointer-events\"] = \"none\";\r\n          ret.style[\"color\"] = colors[i];\r\n\r\n          let w = (i)*2;\r\n          ret.style[\"-webkit-text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"-webkit-text-stroke-color\"] = colors[i];\r\n          ret.style[\"text-stroke-width\"] = w + \"px\";\r\n          ret.style[\"text-stroke-color\"] = colors[i];\r\n\r\n          ret.style[\"padding\"] = ret.style[\"margin\"] = \"0px\";\r\n          ret.style['display'] = \"float\";\r\n          ret.style[\"background-color\"] = \"rgba(0,0,0,0)\";\r\n          ret.innerText = \"\" + text;\r\n          document.body.appendChild(ret);\r\n        }\r\n\r\n      };\r\n\r\n      for (let v of this.screenverts) {\r\n        box(v[0], v[1], 10*v.borders.length, \"\" + v.borders.length, \"rgba(255,0,0,0.5)\");\r\n      }\r\n\r\n      for (let b of this.screenborders) {\r\n        for (let he of b.halfedges) {\r\n          let txt = `${he.side}, ${b.sareas.length}, ${b.halfedges.length}`;\r\n          let p = new Vector2(b.v1).add(b.v2).mulScalar(0.5);\r\n          let size = 10*b.halfedges.length;\r\n\r\n          let wadd = 25 + size*0.5;\r\n          let axis = b.horiz & 1;\r\n\r\n          if (p[axis] > he.sarea.pos[axis]) {\r\n            p[axis] -= wadd;\r\n          } else {\r\n            p[axis] += wadd;\r\n          }\r\n          box(p[0], p[1], size, txt, \"rgba(155,255,75,0.5)\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  checkAreaConstraint(sarea, checkOnly = false) {\r\n    let min = sarea.minSize, max = sarea.maxSize;\r\n    let vs = sarea._verts;\r\n    let chg = 0.0;\r\n    let mask = 0;\r\n\r\n    let moveBorder = (sidea, sideb, dh) => {\r\n      let b1 = sarea._borders[sidea];\r\n      let b2 = sarea._borders[sideb];\r\n      let bad = 0;\r\n\r\n      for (let i = 0; i < 2; i++) {\r\n        let b = i ? b2 : b1;\r\n        let bad2 = sarea.borderLock & (1<<sidea);\r\n\r\n        bad2 = bad2 || !b.movable;\r\n        bad2 = bad2 || this.isBorderOuter(b);\r\n\r\n        if (bad2)\r\n          bad |= 1<<i;\r\n      }\r\n\r\n      if (bad === 0) {\r\n        this.moveBorder(b1, dh*0.5);\r\n        this.moveBorder(b2, -dh*0.5);\r\n      } else if (bad === 1) {\r\n        this.moveBorder(b2, -dh);\r\n      } else if (bad === 2) {\r\n        this.moveBorder(b1, dh);\r\n      } else if (bad === 3) {\r\n        //both borders are bad, yet we need to move anyway. . .\r\n        //console.warn(\"got case of two borders being bad\");\r\n\r\n        if (!this.isBorderOuter(b1)) {\r\n          this.moveBorder(b1, dh);\r\n        } else if (!this.isBorderOuter(b2)) {\r\n          this.moveBorder(b2, -dh);\r\n        } else {\r\n          this.moveBorder(b1, dh*0.5);\r\n          this.moveBorder(b2, -dh*0.5);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (max[0] !== undefined && sarea.size[0] > max[0]) {\r\n      let dh = (sarea.size[0] - max[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 1;\r\n\r\n      moveBorder(0, 2, dh);\r\n    }\r\n\r\n    if (min[0] !== undefined && sarea.size[0] < min[0]) {\r\n      let dh = (min[0] - sarea.size[0]);\r\n      chg += Math.abs(dh);\r\n      mask |= 2;\r\n\r\n      moveBorder(2, 0, dh);\r\n    }\r\n\r\n\r\n    if (max[1] !== undefined && sarea.size[1] > max[1]) {\r\n      let dh = (sarea.size[1] - max[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 4;\r\n\r\n      moveBorder(3, 1, dh);\r\n    }\r\n\r\n    if (min[1] !== undefined && sarea.size[1] < min[1]) {\r\n      let dh = (min[1] - sarea.size[1]);\r\n      chg += Math.abs(dh);\r\n      mask |= 8;\r\n\r\n      moveBorder(1, 3, dh);\r\n    }\r\n\r\n    if (sarea.pos[0] + sarea.size[0] > this.size[0]) {\r\n      mask |= 16;\r\n      let dh = ((this.size[0] - sarea.size[0]) - sarea.pos[0]);\r\n\r\n      chg += Math.abs(dh);\r\n\r\n      if (sarea.floating) {\r\n        sarea.pos[0] = this.size[0] - sarea.size[0];\r\n        sarea.loadFromPosSize();\r\n      } else {\r\n        this.moveBorder(sarea._borders[0], dh);\r\n        this.moveBorder(sarea._borders[2], dh);\r\n      }\r\n    }\r\n\r\n    if (chg === 0.0) {\r\n      return false;\r\n    }\r\n\r\n    return mask;\r\n  }\r\n\r\n  walkBorderLine(b) {\r\n    let visit = new util.set();\r\n    let ret = [b];\r\n    visit.add(b);\r\n\r\n    let rec = (b, v) => {\r\n      for (let b2 of v.borders) {\r\n        if (b2 === b) {\r\n          continue;\r\n        }\r\n\r\n        if (b2.horiz === b.horiz && !visit.has(b2)) {\r\n          visit.add(b2);\r\n          ret.push(b2);\r\n          rec(b2, b2.otherVertex(v));\r\n        }\r\n      }\r\n    }\r\n\r\n    rec(b, b.v1);\r\n    let ret2 = ret;\r\n    ret = [];\r\n\r\n    rec(b, b.v2);\r\n    ret2.reverse();\r\n\r\n    return ret2.concat(ret);\r\n  }\r\n\r\n  moveBorderWithoutVerts(halfedge, df) {\r\n    let side = halfedge.side;\r\n    let sarea = halfedge.sarea;\r\n\r\n    switch (side) {\r\n      case 0:\r\n        sarea.pos[0] += df;\r\n        sarea.size[0] -= df;\r\n        break;\r\n      case 1:\r\n        sarea.size[1] += df;\r\n        break;\r\n      case 2:\r\n        sarea.size[0] += df;\r\n        break;\r\n      case 3:\r\n        sarea.pos[1] += df;\r\n        sarea.size[1] -= df;\r\n        break;\r\n    }\r\n  }\r\n\r\n  moveBorder(b, df, strict = true) {\r\n    return this.moveBorderSimple(b, df, strict);\r\n  }\r\n\r\n  moveBorderSimple(b, df, strict = true) {\r\n    let axis = b.horiz & 1;\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let vs = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (strict && !test(b2.v1) && !test(b2.v2)) {\r\n        return false;\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let v of vs) {\r\n      v[axis] += df;\r\n    }\r\n\r\n    for (let v of vs) {\r\n      for (let b of v.borders) {\r\n        for (let sarea of b.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  moveBorderUnused(b, df, strict = true) {\r\n    if (!b) {\r\n      console.warn(\"missing border\");\r\n      return false;\r\n    }\r\n\r\n    let axis = b.horiz & 1;\r\n\r\n    let vs = new util.set();\r\n\r\n    let visit = new util.set();\r\n\r\n    let axis2 = axis ^ 1;\r\n\r\n    let min = Math.min(b.v1[axis2], b.v2[axis2]);\r\n    let max = Math.max(b.v1[axis2], b.v2[axis2]);\r\n\r\n    let test = (v) => {\r\n      return v[axis2] >= min && v[axis2] <= max;\r\n    };\r\n\r\n    let first = true;\r\n    let found = false;\r\n    let halfedges = new util.set();\r\n    let borders = new util.set();\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      /*\r\n      if (first) {\r\n        first = false;\r\n        df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit) * Math.sign(df);\r\n      }\r\n      found = true;\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n      continue;\r\n      //*/\r\n\r\n      if (!strict) {\r\n        vs.add(b2.v1);\r\n        vs.add(b2.v2);\r\n        continue;\r\n      }\r\n\r\n\r\n      let t1 = test(b2.v1), t2 = test(b2.v2);\r\n\r\n      if (!t1 || !t2) {\r\n        found = true;\r\n\r\n        if (first) {\r\n          first = false;\r\n          df = Math.max(Math.abs(df), FrameManager_mesh.SnapLimit)*Math.sign(df);\r\n        }\r\n      }\r\n      if (!t1 && !t2) {\r\n        continue;\r\n      }\r\n\r\n      borders.add(b2);\r\n\r\n      //make dummy half edges to keep track of border/sarea pairs\r\n      //and especailly what the border side is\r\n      for (let sarea of b2.sareas) {\r\n        halfedges.add(new ScreenHalfEdge(b2, sarea))\r\n      }\r\n\r\n      vs.add(b2.v1);\r\n      vs.add(b2.v2);\r\n    }\r\n\r\n    for (let b2 of this.walkBorderLine(b)) {\r\n      if (borders.has(b2)) {\r\n        continue;\r\n      }\r\n\r\n      for (let he of b2.halfedges) {\r\n        borders.remove(he.border);\r\n        if (halfedges.has(he)) {\r\n          halfedges.remove(he);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let v of vs) {\r\n      let ok = v[axis2] >= min && v[axis2] <= max;\r\n\r\n      if (!ok && strict) {\r\n        //   return false;\r\n      }\r\n    }\r\n\r\n    if (!found || !strict) {\r\n      for (let v of vs) {\r\n        v[axis] += df;\r\n      }\r\n    } else {\r\n      let borders = new util.set();\r\n\r\n      for (let he of halfedges) {\r\n        borders.add(he.border);\r\n        this.moveBorderWithoutVerts(he, df);\r\n      }\r\n\r\n      for (let he of halfedges) {\r\n        he.sarea.loadFromPosSize();\r\n      }\r\n\r\n      for (let b of borders) {\r\n        let sareas = b.sareas.slice(0, b.sareas.length);\r\n\r\n        this.killBorder(b);\r\n        for (let sarea of sareas) {\r\n          sarea.loadFromPosSize();\r\n        }\r\n      }\r\n\r\n      return halfedges.length > 0;\r\n    }\r\n\r\n\r\n    for (let sarea of b.sareas) {\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    for (let he of b.halfedges) {\r\n      he.sarea.loadFromVerts();\r\n\r\n      for (let sarea of he.border.sareas) {\r\n        sarea.loadFromVerts();\r\n        for (let b2 of sarea._borders) {\r\n          b2.setCSS();\r\n        }\r\n      }\r\n    }\r\n\r\n    b.setCSS();\r\n\r\n    return true;\r\n  }\r\n\r\n  solveAreaConstraints(snapArgument = true) {\r\n    let repeat = false;\r\n    let found = false;\r\n\r\n    let time = util.time_ms();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n      repeat = false;\r\n\r\n      for (let sarea of this.sareas) {\r\n        if (sarea.hidden) continue;\r\n\r\n        repeat = repeat || this.checkAreaConstraint(sarea);\r\n      }\r\n\r\n      found = found || repeat;\r\n\r\n      if (repeat) {\r\n        for (let sarea of this.sareas) {\r\n          sarea.loadFromVerts();\r\n        }\r\n\r\n        this.snapScreenVerts(snapArgument);\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      this.snapScreenVerts(snapArgument);\r\n      if (cconst.DEBUG.areaConstraintSolver) {\r\n        time = util.time_ms() - time;\r\n\r\n        console.log(`enforced area constraint ${time.toFixed(2)}ms`);\r\n      }\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  snapScreenVerts(fitToSize = true) {\r\n    let this2 = this;\r\n\r\n    function* screenverts() {\r\n      for (let v of this2.screenverts) {\r\n        let ok = 0;\r\n\r\n        for (let sarea of v.sareas) {\r\n          if (!(sarea.flag & AreaFlags.INDEPENDENT)) {\r\n            ok = 1;\r\n          }\r\n        }\r\n\r\n        if (ok) {\r\n          yield v;\r\n        }\r\n      }\r\n    }\r\n\r\n    let mm = new math.MinMax(2);\r\n    for (let v of screenverts()) {\r\n      mm.minmax(v);\r\n    }\r\n\r\n    let min = mm.min, max = mm.max;\r\n\r\n    //snap(min);\r\n    //snapi(max);\r\n\r\n    if (fitToSize) {\r\n      //fit entire screen to, well, the entire screen (size)\r\n      let vec = new Vector2(max).sub(min);\r\n      let sz = new Vector2(this.size);\r\n\r\n      sz.div(vec);\r\n\r\n      for (let v of screenverts()) {\r\n        v.sub(min).mul(sz);\r\n        //snap(v.sub(min).mul(sz));//.add(this.pos);\r\n      }\r\n\r\n      for (let v of screenverts()) {\r\n        v[0] += this.pos[0];\r\n        v[1] += this.pos[1];\r\n      }\r\n\r\n      //this.pos.zero();\r\n    } else {\r\n      for (let v of screenverts()) {\r\n        //snap(v);\r\n      }\r\n\r\n      [min, max] = this._recalcAABB();\r\n\r\n      //snap(min);\r\n      //snapi(max);\r\n\r\n      this.size.load(max).sub(min);\r\n      //this.pos.zero();\r\n      //this.pos.load(min);\r\n    }\r\n\r\n    let found = 1;\r\n\r\n    for (let sarea of this.sareas) {\r\n      if (sarea.hidden) continue;\r\n\r\n      let old = new Vector2(sarea.size);\r\n      let oldpos = new Vector2(sarea.pos);\r\n\r\n      sarea.loadFromVerts();\r\n\r\n      found = found || old.vectorDistance(sarea.size) > 1;\r\n      found = found || oldpos.vectorDistance(sarea.pos) > 1;\r\n\r\n      sarea.on_resize(old);\r\n    }\r\n\r\n    if (found) {\r\n      //this.regenBorders();\r\n      this._recalcAABB();\r\n      this.setCSS();\r\n    }\r\n  }\r\n\r\n  on_resize(oldsize, newsize = this.size, _set_key = true) {\r\n    //console.warn(\"resizing\");\r\n\r\n    if (_set_key) {\r\n      this._last_ckey1 = this._calcSizeKey(newsize[0], newsize[1], this.pos[0], this.pos[1], devicePixelRatio, visualViewport.scale);\r\n    }\r\n\r\n    let ratio = [newsize[0]/oldsize[0], newsize[1]/oldsize[1]];\r\n\r\n    let offx = this.pos[0] - this.oldpos[0];\r\n    let offy = this.pos[1] - this.oldpos[1];\r\n\r\n    this.oldpos.load(this.pos);\r\n\r\n    //console.log(\"resize!\", ratio);\r\n\r\n    for (let v of this.screenverts) {\r\n      v[0] *= ratio[0];\r\n      v[1] *= ratio[1];\r\n      v[0] += offx;\r\n      v[1] += offy;\r\n    }\r\n\r\n    let min = [1e17, 1e17], max = [-1e17, -1e17];\r\n    let olds = [];\r\n\r\n    for (let sarea of this.sareas) {\r\n      olds.push([sarea.size[0], sarea.size[1]]);\r\n\r\n      sarea.loadFromVerts();\r\n    }\r\n\r\n    this.size[0] = newsize[0];\r\n    this.size[1] = newsize[1];\r\n\r\n    this.snapScreenVerts();\r\n    this.solveAreaConstraints();\r\n    this._recalcAABB();\r\n\r\n\r\n    let i = 0;\r\n    for (let sarea of this.sareas) {\r\n      sarea.on_resize(sarea.size, olds[i]);\r\n      sarea.setCSS();\r\n      i++;\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n    this.calcTabOrder();\r\n\r\n    this._fireResizeCB(oldsize);\r\n  }\r\n\r\n  _fireResizeCB(oldsize = this.size) {\r\n    for (let cb of this._resize_callbacks) {\r\n      cb(oldsize);\r\n    }\r\n  }\r\n\r\n  getScreenVert(pos, added_id = \"\", floating = false) {\r\n    let key = ScreenVert.hash(pos, added_id, this.snapLimit);\r\n\r\n    if (floating || !(key in this._vertmap)) {\r\n      let v = new ScreenVert(pos, this.idgen++, added_id);\r\n\r\n      this._vertmap[key] = v;\r\n      this._idmap[v._id] = v;\r\n\r\n      this.screenverts.push(v);\r\n    }\r\n\r\n    return this._vertmap[key];\r\n  }\r\n\r\n  isBorderOuter(border) {\r\n    let sides = 0;\r\n\r\n    for (let he of border.halfedges) {\r\n      sides |= 1<<he.side;\r\n    }\r\n\r\n    let bits = 0;\r\n    for (let i = 0; i < 4; i++) {\r\n      bits += (sides & (1<<i)) ? 1 : 0;\r\n    }\r\n\r\n    let ret = bits < 2;\r\n    let floating = false;\r\n\r\n    for (let sarea of border.sareas) {\r\n      floating = floating || sarea.floating;\r\n    }\r\n\r\n    if (floating) {\r\n      //check if border is on screen limits\r\n      let axis = border.horiz ? 1 : 0;\r\n\r\n      ret = Math.abs(border.v1[axis] - this.pos[axis]) < 4;\r\n      ret = ret || Math.abs(border.v1[axis] - this.pos[axis] - this.size[axis]) < 4;\r\n    }\r\n\r\n    border.outer = ret;\r\n    return ret;\r\n  }\r\n\r\n  isBorderMovable(b, limit = 5) {\r\n    if (this.allBordersMovable)\r\n      return true;\r\n\r\n    for (let he of b.halfedges) {\r\n      if (he.sarea.borderLock & (1<<he.side)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    let ok = !this.isBorderOuter(b);\r\n\r\n    for (let sarea of b.sareas) {\r\n      if (sarea.floating) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return ok;\r\n  }\r\n\r\n  getScreenBorder(sarea, v1, v2, side) {\r\n    let suffix = sarea._get_v_suffix();\r\n\r\n    if (!(v1 instanceof ScreenVert)) {\r\n      v1 = this.getScreenVert(v1, suffix);\r\n    }\r\n\r\n    if (!(v2 instanceof ScreenVert)) {\r\n      v2 = this.getScreenVert(v2, suffix);\r\n    }\r\n\r\n    let hash = ScreenBorder.hash(v1, v2);\r\n\r\n    if (!(hash in this._edgemap)) {\r\n      let sb = this._edgemap[hash] = UIBase.createElement(\"screenborder-x\");\r\n\r\n      sb._hash = hash;\r\n      sb.screen = this;\r\n      sb.v1 = v1;\r\n      sb.v2 = v2;\r\n      sb._id = this.idgen++;\r\n\r\n      v1.borders.push(sb);\r\n      v2.borders.push(sb);\r\n\r\n      sb.ctx = this.ctx;\r\n\r\n      this.screenborders.push(sb);\r\n      this.appendChild(sb);\r\n\r\n      sb.setCSS();\r\n\r\n      this._edgemap[hash] = sb;\r\n      this._idmap[sb._id] = sb;\r\n    }\r\n\r\n    return this._edgemap[hash];\r\n  }\r\n\r\n  minmaxArea(sarea, mm = undefined) {\r\n    if (mm === undefined) {\r\n      mm = new math.MinMax(2);\r\n    }\r\n\r\n    for (let b of sarea._borders) {\r\n      mm.minmax(b.v1);\r\n      mm.minmax(b.v2);\r\n    }\r\n\r\n    return mm;\r\n  }\r\n\r\n  //does sarea1 border sarea2?\r\n  areasBorder(sarea1, sarea2) {\r\n    for (let b of sarea1._borders) {\r\n      for (let sa of b.sareas) {\r\n        if (sa === sarea2)\r\n          return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  //regenerates borders, sets css and calls this.update\r\n\r\n  replaceArea(dst, src) {\r\n    if (dst === src)\r\n      return;\r\n\r\n    src.pos[0] = dst.pos[0];\r\n    src.pos[1] = dst.pos[1];\r\n    src.size[0] = dst.size[0];\r\n    src.size[1] = dst.size[1];\r\n\r\n    src.floating = dst.floating;\r\n    src._borders = dst._borders;\r\n    src._verts = dst._verts;\r\n\r\n    if (this.sareas.indexOf(src) < 0) {\r\n      this.sareas.push(src);\r\n      this.shadow.appendChild(src);\r\n    }\r\n\r\n    if (this.sareas.active === dst) {\r\n      this.sareas.active = src;\r\n    }\r\n\r\n    //this.sareas.remove(dst);\r\n    //dst.remove();\r\n\r\n    this.sareas.remove(dst);\r\n    dst.remove();\r\n\r\n    this.regenScreenMesh();\r\n    this.snapScreenVerts();\r\n    this._updateAll();\r\n  }\r\n\r\n  _internalRegenAll() {\r\n    this.snapScreenVerts();\r\n    this._recalcAABB();\r\n    this.calcTabOrder();\r\n    this.setCSS();\r\n\r\n    this.completeUpdate();\r\n    this.completeSetCSS();\r\n    this.completeUpdate();\r\n  }\r\n\r\n  _updateAll() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.setCSS();\r\n    }\r\n    this.setCSS();\r\n    this.update();\r\n  }\r\n\r\n  removeArea(sarea) {\r\n    if (this.sareas.indexOf(sarea) < 0) {\r\n      console.warn(sarea, \"<- Warning: tried to remove unknown area\");\r\n      return;\r\n    }\r\n\r\n    this.sareas.remove(sarea);\r\n    sarea.remove();\r\n\r\n    for (let i = 0; i < 2; i++) {\r\n      this.snapScreenVerts();\r\n      this.regenScreenMesh();\r\n    }\r\n\r\n    this._updateAll();\r\n    this.drawUpdate();\r\n  }\r\n\r\n  appendChild(child) {\r\n    /*\r\n    if (child instanceof UIBase) {\r\n      if (child._useDataPathUndo === undefined) {\r\n        child.useDataPathUndo = this.useDataPathUndo;\r\n      }\r\n    }*/\r\n\r\n    if (child instanceof ScreenArea.ScreenArea) {\r\n      child.screen = this;\r\n      child.ctx = this.ctx;\r\n      child.parentWidget = this;\r\n\r\n      this.sareas.push(child);\r\n\r\n      if (child.size.dot(child.size) === 0) {\r\n        child.size[0] = this.size[0];\r\n        child.size[1] = this.size[1];\r\n      }\r\n\r\n      if (!child._has_evts) {\r\n        child._has_evts = true;\r\n\r\n        let onfocus = (e) => {\r\n          this.sareas.active = child;\r\n        }\r\n\r\n        let onblur = (e) => {\r\n          //XXX this is causing bugs\r\n\r\n          //if (this.sareas.active === child) {\r\n          //  this.sareas.active = undefined;\r\n          //}\r\n        }\r\n\r\n        child.addEventListener(\"focus\", onfocus);\r\n        child.addEventListener(\"mouseenter\", onfocus);\r\n        child.addEventListener(\"blur\", onblur);\r\n        child.addEventListener(\"mouseleave\", onblur);\r\n      }\r\n\r\n      this.regenBorders();\r\n      child.setCSS();\r\n      this.drawUpdate();\r\n      child._init();\r\n    }\r\n\r\n    return this.shadow.appendChild(child);\r\n    //return super.appendChild(child);\r\n  }\r\n\r\n  add(child) {\r\n    return this.appendChild(child);\r\n  }\r\n\r\n  hintPickerTool() {\r\n    (new FrameManager_ops.ToolTipViewer(this)).start();\r\n  }\r\n\r\n  removeAreaTool(border) {\r\n    let tool = new FrameManager_ops.RemoveAreaTool(this, border);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  moveAttachTool(sarea, mpos = this.mpos, elem, pointerId) {\r\n    let tool = new FrameManager_ops.AreaMoveAttachTool(this, sarea, mpos);\r\n    tool.start(elem, pointerId);\r\n  }\r\n\r\n  splitTool() {\r\n    let tool = new FrameManager_ops.SplitTool(this);\r\n    //let tool = new FrameManager_ops.AreaDragTool(this, undefined, this.mpos);\r\n    tool.start();\r\n  }\r\n\r\n  areaDragTool(sarea = this.sareas.active) {\r\n    if (sarea === undefined) {\r\n      console.warn(\"no active screen area\");\r\n      return;\r\n    }\r\n\r\n    let mpos = this.mpos;\r\n    let tool = new FrameManager_ops.AreaDragTool(this, this.sareas.active, mpos);\r\n\r\n    tool.start();\r\n  }\r\n\r\n  makeBorders() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.makeBorders(this);\r\n    }\r\n  }\r\n\r\n  cleanupBorders() {\r\n    let del = new Set();\r\n\r\n    for (let b of this.screenborders) {\r\n      if (b.halfedges.length === 0) {\r\n        del.add(b);\r\n      }\r\n    }\r\n\r\n    for (let b of del) {\r\n      delete this._edgemap[b._hash];\r\n      HTMLElement.prototype.remove.call(b);\r\n    }\r\n  }\r\n\r\n  mergeBlankAreas() {\r\n    for (let b of this.screenborders) {\r\n      if (b.locked) {\r\n        continue;\r\n      }\r\n\r\n      let blank, sarea;\r\n\r\n      for (let he of b.halfedges) {\r\n        if (!he.sarea.area) {\r\n          blank = he.sarea;\r\n          sarea = b.getOtherSarea(blank);\r\n\r\n          let axis = b.horiz ^ 1;\r\n\r\n          if (blank && sarea && blank.size[axis] !== sarea.size[axis]) {\r\n            blank = sarea = undefined;\r\n          }\r\n\r\n          if (blank && sarea) {\r\n            break;\r\n          } else {\r\n            blank = undefined;\r\n            sarea = undefined;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (blank && sarea && blank !== sarea) {\r\n        this.collapseArea(blank, b);\r\n      }\r\n    }\r\n\r\n    this.cleanupBorders();\r\n  }\r\n\r\n  floatArea(area) {\r\n    let sarea = area.parentWidget;\r\n\r\n    /* already floating? */\r\n    if (sarea.floating) {\r\n      return sarea;\r\n    }\r\n\r\n    sarea.editors.remove(area);\r\n    delete sarea.editormap[area.constructor.define().areaname];\r\n    sarea.area = undefined;\r\n\r\n    HTMLElement.prototype.remove.call(area);\r\n\r\n    let sarea2 = UIBase.createElement(\"screenarea-x\", true);\r\n    sarea2.floating = true;\r\n\r\n    sarea2.pos = new Vector2(sarea.pos);\r\n    sarea2.pos.addScalar(5);\r\n\r\n    sarea2.size = new Vector2(sarea.size);\r\n\r\n    sarea2.editors.push(area);\r\n    sarea2.editormap[area.constructor.define().areaname] = area;\r\n\r\n    sarea2.shadow.appendChild(area);\r\n    sarea2.area = area;\r\n\r\n    area.push_ctx_active();\r\n    area.pop_ctx_active();\r\n\r\n    area.pos = sarea2.pos;\r\n    area.size = sarea2.size;\r\n    area.parentWidget = sarea2;\r\n    area.owning_sarea = sarea2;\r\n\r\n    sarea.flushSetCSS();\r\n    sarea.flushUpdate();\r\n\r\n    sarea2.flushSetCSS();\r\n    sarea2.flushUpdate();\r\n\r\n    this.appendChild(sarea2);\r\n\r\n    if (sarea.editors.length > 0) {\r\n      let area2 = sarea.editors[0];\r\n      sarea.switch_editor(area2.constructor);\r\n\r\n      sarea.flushSetCSS();\r\n      sarea.flushUpdate();\r\n    }\r\n\r\n    sarea2.loadFromPosSize();\r\n    sarea2.bringToFront();\r\n\r\n    this.mergeBlankAreas();\r\n    this.cleanupBorders();\r\n\r\n    return sarea2;\r\n  }\r\n\r\n  on_keydown(e) {\r\n    if (checkForTextBox(this, this.mpos[0], this.mpos[1])) {\r\n      console.log(\"textbox detected\");\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.execKeyMap(e)) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keydown) {\r\n      let area = this.sareas.active;\r\n      return this.sareas.active.on_keydown(e);\r\n    }\r\n  }\r\n\r\n  on_keyup(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keyup) {\r\n      return this.sareas.active.on_keyup(e);\r\n    }\r\n  }\r\n\r\n  on_keypress(e) {\r\n    if (!haveModal() && this.sareas.active !== undefined && this.sareas.active.on_keypress) {\r\n      return this.sareas.active.on_keypress(e);\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    for (let sarea of this.sareas) {\r\n      sarea.draw();\r\n    }\r\n  }\r\n\r\n  afterSTRUCT() {\r\n    for (let sarea of this.sareas) {\r\n      sarea._ctx = this.ctx;\r\n      sarea.afterSTRUCT();\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    this.clear();\r\n\r\n    reader(this);\r\n\r\n    //handle old files that might have saved as simple arrays\r\n    this.size = new Vector2(this.size);\r\n\r\n    let sareas = this.sareas;\r\n    this.sareas = [];\r\n\r\n    /*\r\n    let push = this.sareas.push;\r\n\r\n    this.sareas.push = function(item) {\r\n      console.error(\"this.sareas.push\", item);\r\n      push.call(this, item);\r\n    }\r\n    */\r\n\r\n    for (let sarea of sareas) {\r\n      sarea.screen = this;\r\n      sarea.parentWidget = this;\r\n\r\n      this.appendChild(sarea);\r\n    }\r\n\r\n    this.regenBorders();\r\n    this.setCSS();\r\n\r\n    this.doOnce(() => {\r\n      this.loadUIData(this.uidata);\r\n      this.uidata = undefined;\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  test_struct(appstate = _appstate) {\r\n    let data = [];\r\n    //let scripts = nstructjs.write_scripts();\r\n    nstructjs.manager.write_object(data, this);\r\n    data = new DataView(new Uint8Array(data).buffer);\r\n\r\n    let screen2 = nstructjs.manager.read_object(data, this.constructor);\r\n    screen2.ctx = this.ctx;\r\n\r\n    for (let sarea of screen2.sareas) {\r\n      sarea.screen = screen2;\r\n      sarea.ctx = this.ctx;\r\n      sarea.area.ctx = this.ctx;\r\n    }\r\n\r\n    let parent = this.parentElement;\r\n    this.remove();\r\n\r\n    appstate.screen = screen2;\r\n\r\n    parent.appendChild(screen2);\r\n\r\n    //for (let \r\n    screen2.regenBorders();\r\n    screen2.update();\r\n    screen2.listen();\r\n\r\n    screen2.doOnce(() => {\r\n      screen2.on_resize(screen2.size, [window.innerWidth, window.innerHeight]);\r\n    });\r\n\r\n    console.log(data)\r\n    return screen2;\r\n  }\r\n\r\n  saveUIData() {\r\n    try {\r\n      return ui_base.saveUIData(this, \"screen\");\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to save UI state data\");\r\n    }\r\n  }\r\n\r\n  loadUIData(str) {\r\n    try {\r\n      ui_base.loadUIData(this, str);\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n      console.log(\"Failed to load UI state data\");\r\n    }\r\n  }\r\n}\r\n\r\nScreen.STRUCT = `\r\npathux.Screen { \r\n  size  : vec2;\r\n  pos   : vec2;\r\n  sareas : array(pathux.ScreenArea);\r\n  idgen : int;\r\n  uidata : string | obj.saveUIData();\r\n}\r\n`;\r\n\r\nnstructjs.register(Screen);\r\nui_base.UIBase.internalRegister(Screen);\r\n\r\nScreenArea.setScreenClass(Screen);\r\n_setScreenClass(Screen);\r\n\r\nlet get_screen_cb;\r\nlet _on_keydown;\r\n\r\nlet start_cbs = [];\r\nlet stop_cbs = [];\r\nlet keyboardDom = window;\r\n\r\nlet key_event_opts;\r\n\r\nexport function startEvents(getScreenFunc) {\r\n  get_screen_cb = getScreenFunc;\r\n\r\n  if (_events_started) {\r\n    return;\r\n  }\r\n\r\n  _events_started = true;\r\n\r\n  _on_keydown = (e) => {\r\n    /* Prevent browser from unfocuing the page with the alt key.\r\n     * Happens during touch/pen event handing in Chrome (Oct2023).\r\n     */\r\n    if (e.keyCode === keymap[\"Alt\"]) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let screen = get_screen_cb();\r\n\r\n    return screen.on_keydown(e);\r\n  };\r\n\r\n  window.addEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n\r\n  for (let cb of start_cbs) {\r\n    cb();\r\n  }\r\n}\r\n\r\nexport function stopEvents() {\r\n  window.removeEventListener(\"keydown\", _on_keydown, key_event_opts);\r\n  _on_keydown = undefined;\r\n  _events_started = false;\r\n\r\n  for (let cb of stop_cbs) {\r\n    try {\r\n      cb();\r\n    } catch (error) {\r\n      util.print_stack(error);\r\n    }\r\n  }\r\n\r\n  return get_screen_cb;\r\n}\r\n\r\nexport function setKeyboardDom(dom) {\r\n  let started = _events_started;\r\n  if (started) {\r\n    stopEvents();\r\n  }\r\n\r\n  keyboardDom = dom;\r\n\r\n  if (started) {\r\n    startEvents(get_screen_cb);\r\n  }\r\n}\r\n\r\n/** Sets options passed to addEventListener() for on_keydown hotkey handler */\r\nexport function setKeyboardOpts(opts) {\r\n  key_event_opts = opts;\r\n}\r\n\r\nexport function _onEventsStart(cb) {\r\n  start_cbs.push(cb);\r\n}\r\n\r\nexport function _onEventsStop(cb) {\r\n  stop_cbs.push(cb);\r\n}\r\n\r\n/*\r\ndocument.addEventListener(\"touchstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"touchmove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"scroll\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"resize\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerdown\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointerstart\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\ndocument.addEventListener(\"pointermove\", (e) => {\r\n  e.preventDefault();\r\n}, {capture : true});\r\n*/\r\n", "import * as app from './app.js';\r\nimport * as editor from './editor.js';\r\n\r\nexport * from './app.js';\r\nexport * from './editor.js';\r\nexport * from './setup.js';\r\nexport * from './icons.js';\r\nexport * from './iconsheet.js';\r\nexport * from './file.js';\r\nexport * from './context_class.js';\r\nexport * from './menubar.js';\r\nexport {Menu} from '../widgets/ui_menu.js';\r\n", "import {Area, contextWrangler} from '../screen/ScreenArea.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {Container} from '../core/ui.js';\r\nimport {parsepx} from '../core/ui_base.js';\r\nimport {Icons} from '../core/ui_base.js';\r\nimport * as util from '../util/util.js';\r\n\r\nlet sidebar_hash = new util.HashDigest();\r\n\r\nexport class SideBar extends Container {\r\n  constructor() {\r\n    super();\r\n\r\n    this.header = this.row();\r\n    this.header.style[\"height\"] = \"45px\";\r\n\r\n    this._last_resize_key = undefined;\r\n\r\n    this._closed = false;\r\n\r\n    this.closeIcon = this.header.iconbutton(Icons.RIGHT_ARROW, \"Close/Open sidebar\", () => {\r\n      console.log(\"click!\");\r\n      this.closed = !this._closed;\r\n    });\r\n\r\n    this._openWidth = undefined;\r\n    this.needsSetCSS = true;\r\n    this.tabbar = this.tabs(\"left\");\r\n    //this.tabbar.style[\"flex-grow\"] = \"8\";\r\n  }\r\n\r\n  saveData() {\r\n    return {\r\n      closed : this.closed\r\n    }\r\n  }\r\n\r\n  loadData(obj) {\r\n    this.closed = obj.closed;\r\n  }\r\n\r\n  set closed(val) {\r\n    if (!!this._closed === !!val) {\r\n      return;\r\n    }\r\n\r\n    if (this._openWidth === undefined && !this._closed && val) {\r\n      this._openWidth = this.width;\r\n    }\r\n\r\n    console.log(\"animate!\");\r\n    let w = val ? 50 : this._openWidth;\r\n    this.animate().goto(\"width\", w, 500);\r\n\r\n\r\n    if (val) {\r\n      this.closeIcon.icon = Icons.LEFT_ARROW;\r\n    } else {\r\n      this.closeIcon.icon = Icons.RIGHT_ARROW;\r\n    }\r\n\r\n    this._closed = val;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n\r\n  get width() {\r\n    return parsepx(\"\" + this.getAttribute(\"width\"));\r\n  }\r\n\r\n  set width(val) {\r\n    this.setAttribute(\"width\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  get height() {\r\n    return parsepx(\"\" + this.getAttribute(\"height\"));\r\n  }\r\n\r\n  set height(val) {\r\n    this.setAttribute(\"height\", \"\" + val + \"px\");\r\n    this.update();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"sidebar-base-x\",\r\n      style  : \"sidebar\"\r\n    }\r\n  }\r\n\r\n  tab(name) {\r\n    return this.tabbar.tab(name);\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    let closed = this._closed;\r\n    this._closed = false;\r\n\r\n    if (!this.getAttribute(\"width\")) {\r\n      this.width = 300;\r\n    }\r\n    if (!this.getAttribute(\"height\")) {\r\n      this.height = 700;\r\n    }\r\n\r\n    this.setCSS();\r\n\r\n    if (closed) {\r\n      this.closed = true;\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    if (!this.parentWidget) {\r\n      return;\r\n    }\r\n\r\n    let editor = this.parentWidget;\r\n\r\n    //happens when editors are inactive\r\n    if (!editor.pos || !editor.size) {\r\n      return;\r\n    }\r\n\r\n    this.needsSetCSS = false;\r\n\r\n    let w = this.width, h = this.height;\r\n\r\n    w = isNaN(w) ? 500 : w;\r\n    h = isNaN(h) ? 500 : h;\r\n\r\n    h = Math.min(h, editor.size[1]-25);\r\n\r\n    this.style[\"position\"] = \"absolute\";\r\n    this.style[\"width\"] = w + \"px\";\r\n    this.style[\"height\"] = h + \"px\";\r\n    this.style[\"z-index\"] = \"100\";\r\n    this.style[\"overflow\"] = \"scroll\";\r\n\r\n    this.style[\"background-color\"] = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.tabbar.style[\"height\"] = (h - 45) + \"px\";\r\n    this.style[\"left\"] = (editor.size[0] - w) + \"px\";\r\n  }\r\n\r\n  update() {\r\n    sidebar_hash.reset();\r\n    sidebar_hash.add(this.width);\r\n    sidebar_hash.add(this.height);\r\n\r\n    let key = sidebar_hash.get();\r\n    if (key !== this._last_resize_key) {\r\n      this._last_resize_key = key;\r\n      this.needsSetCSS = true;\r\n    }\r\n\r\n    if (this.needsSetCSS) {\r\n      this.setCSS();\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(SideBar);\r\n\r\nexport class Editor extends Area {\r\n  constructor() {\r\n    super();\r\n\r\n    this.container = UIBase.createElement(\"container-x\");\r\n    this.container.parentWidget = this;\r\n    this.shadow.appendChild(this.container);\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      areaname: \"areaname\",\r\n      tagname : \"tagname-x\"\r\n    }\r\n  }\r\n\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** \\param makeMenuBar function(ctx, container, menuBarEditor)\r\n   *\r\n   * example:\r\n   *\r\n   * function makeMenuBar(ctx, container, menuBarEditor) {\r\n   *\r\n   *  container.menu(\"File\", [\r\n   *    \"app.new()\",\r\n   *    simple.Menu.SEP,\r\n   *    \"app.save()\",\r\n   *    \"app.save(forceDialog=true)|Save As\",\r\n   *    \"app.open\"\r\n   *  ]);\r\n   * }\r\n   * */\r\n  static registerAppMenu(makeMenuBar) {\r\n    if (this !== Editor) {\r\n      throw new Error(\"must call registerAppMenu from simple.Editor base class\");\r\n    }\r\n\r\n    this.makeMenuBar = makeMenuBar;\r\n  }\r\n\r\n  /** Registers class with Area system\r\n   *  and nstructjs.  Uses nstructjs.inlineRegister\r\n   *  to handle inheritance.\r\n   **/\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"define\")) {\r\n      throw new Error(\"missing define() method\");\r\n    }\r\n\r\n    if (!cls.hasOwnProperty(\"STRUCT\")) {\r\n      cls.STRUCT = nstructjs.inherit(cls, this) + `\\n}`;\r\n      nstructjs.register(cls);\r\n    } else {\r\n      /* inlineRegister handles inheritance. */\r\n      cls.STRUCT = nstructjs.inlineRegister(cls, cls.STRUCT);\r\n    }\r\n\r\n    super.register(cls);\r\n  }\r\n\r\n  makeSideBar() {\r\n    if (this.sidebar) {\r\n      this.sidebar.remove();\r\n    }\r\n\r\n    let sidebar = this.sidebar = UIBase.createElement(\"sidebar-base-x\");\r\n    sidebar.parentWidget = this;\r\n    sidebar.ctx = this.ctx;\r\n    this.shadow.appendChild(sidebar);\r\n\r\n    if (this.ctx) {\r\n      sidebar._init();\r\n\r\n      this.sidebar.flushSetCSS();\r\n      this.sidebar.flushUpdate();\r\n    }\r\n\r\n\r\n    return this.sidebar;\r\n  }\r\n\r\n  on_resize(size, oldsize) {\r\n    super.on_resize(size, oldsize);\r\n\r\n    if (this.sidebar) {\r\n      if (this.ctx && this.pos) {\r\n        this.sidebar.setCSS();\r\n      } else {\r\n        this.sidebar.needsSetCSS = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  static findEditor(cls) {\r\n    return contextWrangler.getLastArea(cls);\r\n  }\r\n  \r\n  getScreen() {\r\n    return this.ctx.screen;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.makeHeader(this.container);\r\n  }\r\n\r\n  /** creates default header and puts it in this.header */\r\n  makeHeader(container, add_note_area = true, make_draggable = true) {\r\n    return super.makeHeader(container, add_note_area, make_draggable);\r\n  }\r\n\r\n  /** called regularly */\r\n  update() {\r\n    super.update();\r\n  }\r\n\r\n  /** */\r\n  setCSS() {\r\n    super.setCSS();\r\n  }\r\n}\r\n\r\n", "let text = `\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   width=\"512\"\r\n   height=\"512\"\r\n   id=\"svg16099\"\r\n   version=\"1.1\"\r\n   inkscape:version=\"1.0 (4035a4fb49, 2020-05-01)\"\r\n   sodipodi:docname=\"iconsheet.svg\"\r\n   inkscape:export-filename=\"C:\\dev\\allshape\\src\\datafiles\\iconsheet16.png\"\r\n   inkscape:export-xdpi=\"45\"\r\n   inkscape:export-ydpi=\"45\">\r\n  <defs\r\n     id=\"defs16101\">\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1307\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1303\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1299\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1295\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1291\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1231\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1186\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1182\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4974\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481\">\r\n      <stop\r\n         id=\"stop4865\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#e66700;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f47712;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop4867\" />\r\n      <stop\r\n         id=\"stop4869\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6\">\r\n      <stop\r\n         id=\"stop4860\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4862\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116\">\r\n      <stop\r\n         id=\"stop4853\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\" />\r\n      <stop\r\n         id=\"stop4855\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4290\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4286\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4118\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5012\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5008\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3264\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect5465\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4613\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4609\"\r\n       is_visible=\"true\" />\r\n    <linearGradient\r\n       id=\"linearGradient5609\">\r\n      <stop\r\n         id=\"stop5611\"\r\n         offset=\"0\"\r\n         style=\"stop-color:#0089e6;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#1280f4;stop-opacity:1;\"\r\n         offset=\"0.52777779\"\r\n         id=\"stop5613\" />\r\n      <stop\r\n         id=\"stop5615\"\r\n         offset=\"1\"\r\n         style=\"stop-color:#d4eefc;stop-opacity:1;\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient5481-8\">\r\n      <stop\r\n         style=\"stop-color:#ffc700;stop-opacity:1\"\r\n         offset=\"0\"\r\n         id=\"stop5483\" />\r\n      <stop\r\n         id=\"stop5491\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#ffc700;stop-opacity:1\" />\r\n      <stop\r\n         style=\"stop-color:#ffa41c;stop-opacity:1\"\r\n         offset=\"1\"\r\n         id=\"stop5485\" />\r\n    </linearGradient>\r\n    <inkscape:perspective\r\n       sodipodi:type=\"inkscape:persp3d\"\r\n       inkscape:vp_x=\"-108.10967 : 516.24314 : 1\"\r\n       inkscape:vp_y=\"0 : 323.31882 : 0\"\r\n       inkscape:vp_z=\"57.429562 : 516.24314 : 1\"\r\n       inkscape:persp3d-origin=\"-25.340056 : 488.65327 : 1\"\r\n       id=\"perspective18342\" />\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17173\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.3) rotate(180) translate(-2.3,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Mend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Mend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17167\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(0.6) rotate(180) translate(0,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow1Send\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow1Send\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17155\"\r\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\r\n         style=\"fill-rule:evenodd;stroke:#000000;stroke-width:1.0pt;\"\r\n         transform=\"scale(0.2) rotate(180) translate(6,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Lend\"\r\n       orient=\"auto\"\r\n       refY=\"0.0\"\r\n       refX=\"0.0\"\r\n       id=\"Arrow2Lend\"\r\n       style=\"overflow:visible;\">\r\n      <path\r\n         id=\"path17161\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.62500000;stroke-linejoin:round;\"\r\n         d=\"M 8.7185878,4.0337352 L -2.2072895,0.016013256 L 8.7185884,-4.0017078 C 6.9730900,-1.6296469 6.9831476,1.6157441 8.7185878,4.0337352 z \"\r\n         transform=\"scale(1.1) rotate(180) translate(1,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       id=\"linearGradient17126\">\r\n      <stop\r\n         style=\"stop-color:#008080;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17128\" />\r\n      <stop\r\n         style=\"stop-color:#00b3b3;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17130\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       id=\"linearGradient17116-6-9\">\r\n      <stop\r\n         style=\"stop-color:#b3a500;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop17118\" />\r\n      <stop\r\n         style=\"stop-color:#eaa500;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop17120\" />\r\n    </linearGradient>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-2\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-2\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-6\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-8\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-7\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-6\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-8\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-9\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-79\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-5\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-3\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-1\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-33\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-4\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <marker\r\n       inkscape:stockid=\"Arrow2Send\"\r\n       orient=\"auto\"\r\n       refY=\"0\"\r\n       refX=\"0\"\r\n       id=\"Arrow2Send-1\"\r\n       style=\"overflow:visible\">\r\n      <path\r\n         inkscape:connector-curvature=\"0\"\r\n         id=\"path17173-3\"\r\n         style=\"fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round\"\r\n         d=\"M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z\"\r\n         transform=\"matrix(-0.3,0,0,-0.3,0.69,0)\" />\r\n    </marker>\r\n    <linearGradient\r\n       inkscape:collect=\"always\"\r\n       xlink:href=\"#linearGradient5481-5\"\r\n       id=\"linearGradient5489-4\"\r\n       x1=\"355.89935\"\r\n       y1=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y2=\"17.125025\"\r\n       gradientUnits=\"userSpaceOnUse\" />\r\n    <linearGradient\r\n       id=\"linearGradient5481-5\">\r\n      <stop\r\n         style=\"stop-color:#e66700;stop-opacity:1;\"\r\n         offset=\"0\"\r\n         id=\"stop5483-2\" />\r\n      <stop\r\n         id=\"stop5491-9\"\r\n         offset=\"0.52777779\"\r\n         style=\"stop-color:#f47712;stop-opacity:1;\" />\r\n      <stop\r\n         style=\"stop-color:#f8bb8a;stop-opacity:1;\"\r\n         offset=\"1\"\r\n         id=\"stop5485-9\" />\r\n    </linearGradient>\r\n    <linearGradient\r\n       y2=\"17.125025\"\r\n       x2=\"380.47559\"\r\n       y1=\"17.125025\"\r\n       x1=\"355.89935\"\r\n       gradientUnits=\"userSpaceOnUse\"\r\n       id=\"linearGradient5588\"\r\n       xlink:href=\"#linearGradient5609\"\r\n       inkscape:collect=\"always\"\r\n       gradientTransform=\"matrix(1.2151103,0,0,1.1804992,-207.06775,536.98221)\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4108-9\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-1\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect3225-4\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-2\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4122-7\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect1587-6\"\r\n       is_visible=\"true\" />\r\n    <inkscape:path-effect\r\n       effect=\"spiro\"\r\n       id=\"path-effect4194-5\"\r\n       is_visible=\"true\" />\r\n  </defs>\r\n  <sodipodi:namedview\r\n     id=\"base\"\r\n     pagecolor=\"#9c9c9c\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1.0\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:zoom=\"3.8325453\"\r\n     inkscape:cx=\"144.17961\"\r\n     inkscape:cy=\"49.96269\"\r\n     inkscape:document-units=\"px\"\r\n     inkscape:current-layer=\"layer1\"\r\n     showgrid=\"true\"\r\n     inkscape:window-width=\"1606\"\r\n     inkscape:window-height=\"962\"\r\n     inkscape:window-x=\"177\"\r\n     inkscape:window-y=\"71\"\r\n     inkscape:window-maximized=\"0\"\r\n     inkscape:snap-global=\"false\"\r\n     inkscape:pagecheckerboard=\"true\"\r\n     inkscape:document-rotation=\"0\">\r\n    <inkscape:grid\r\n       type=\"xygrid\"\r\n       id=\"grid16107\"\r\n       empspacing=\"1\"\r\n       visible=\"true\"\r\n       enabled=\"true\"\r\n       snapvisiblegridlinesonly=\"false\"\r\n       spacingx=\"32\"\r\n       spacingy=\"32\"\r\n       dotted=\"false\"\r\n       originx=\"0\"\r\n       originy=\"0\" />\r\n  </sodipodi:namedview>\r\n  <metadata\r\n     id=\"metadata16104\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n        <dc:title />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <g\r\n     inkscape:label=\"Layer 1\"\r\n     inkscape:groupmode=\"layer\"\r\n     id=\"layer1\"\r\n     transform=\"translate(0,-540.36218)\">\r\n    <ellipse\r\n       style=\"opacity:0.79203539;fill:url(#linearGradient5588);fill-opacity:1;stroke:#3c3c3c;stroke-width:1.1393038;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1\"\r\n       id=\"path3171-8\"\r\n       cx=\"240.32063\"\r\n       cy=\"557.19836\"\r\n       rx=\"14.353489\"\r\n       ry=\"14.165989\" />\r\n    <flowRoot\r\n       xml:space=\"preserve\"\r\n       id=\"flowRoot5564\"\r\n       style=\"font-style:normal;font-weight:normal;line-height:0.01%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none\"\r\n       transform=\"matrix(0.64571833,0,0,0.61432912,8.6966653,558.72048)\"><flowRegion\r\n         id=\"flowRegion5566\"\r\n         style=\"font-family:sans-serif\"><rect\r\n           id=\"rect5568\"\r\n           width=\"78.749992\"\r\n           height=\"72.5\"\r\n           x=\"346.24997\"\r\n           y=\"-21.999973\"\r\n           style=\"font-family:sans-serif\" /></flowRegion><flowPara\r\n         id=\"flowPara5570\"\r\n         style=\"font-weight:bold;font-size:40px;line-height:1.25;font-family:sans-serif;-inkscape-font-specification:'Sans Bold'\">?</flowPara></flowRoot>\r\n    <path\r\n       style=\"fill:none;stroke:#ec6900;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 187.1235,559.26606 c -3.71166,-5.87882 -12.04056,-10.0009 -18.86169,0.34701\"\r\n       id=\"path4144-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#ec6900;fill-opacity:1;stroke:none;stroke-width:0.001;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 170.01417,560.40163 2.05175,2.63036 -9.89352,4.33226 2.83717,-13.08504 z\"\r\n       id=\"path5370-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:none;stroke:#1f9000;stroke-width:4.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-mid:none;marker-end:none\"\r\n       d=\"m 197.1805,559.70121 c 3.69186,-5.88365 11.97631,-10.00911 18.76103,0.3473\"\r\n       id=\"path4144-1-9\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:#1f9000;fill-opacity:1;stroke:none\"\r\n       d=\"m 213.95021,560.59037 -2.0408,2.63252 9.84072,4.33582 -2.82203,-13.09579 z\"\r\n       id=\"path5370-7-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect3224\"\r\n       width=\"23.641272\"\r\n       height=\"8.4057856\"\r\n       x=\"487.73776\"\r\n       y=\"552.41565\" />\r\n    <path\r\n       style=\"fill:none;stroke:#000000;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"M 498.18023,567.81152 484.7754,556.20378 498.93081,545.77569\"\r\n       id=\"path4074\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccc\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 17.866009,585.82436 -0.09,-4.53232 -14.5167501,7.49748 14.5683701,7.84238 z\"\r\n       id=\"path5370-5-0-6-5\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:none\"\r\n       d=\"m 46.366429,592.31275 0.0109,4.6129 14.90287,-7.37024 -14.68289,-8.23782 z\"\r\n       id=\"path5370-5-1-2\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-3-3\"\r\n       width=\"10.726034\"\r\n       height=\"5.6689787\"\r\n       x=\"-3.0812507\"\r\n       y=\"587.85645\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <rect\r\n       style=\"opacity:0.94690265;fill:#000000;fill-opacity:1;stroke:none\"\r\n       id=\"rect5558-1\"\r\n       width=\"10.540748\"\r\n       height=\"5.5710502\"\r\n       x=\"-22.93788\"\r\n       y=\"587.9295\"\r\n       transform=\"matrix(1,0,0.06880209,0.99763033,0,0)\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 71.46269,592.27473 0.01481,6.27371 20.268436,-10.02379 -19.969263,-11.20374 z\"\r\n       id=\"path5370-5-1-2-1\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#2e2e2e;fill-opacity:1;stroke:none;stroke-width:0.685581\"\r\n       d=\"m 108.87703,578.56977 -6.27262,0.11779 10.35514,20.10117 10.87444,-20.15049 z\"\r\n       id=\"path5370-5-1-2-1-7\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 69.769603,567.95981 5.60449,-5.39601\"\r\n       id=\"path5452-5-5-1-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.061478\"\r\n       inkscape:transform-center-y=\"-0.63275351\" />\r\n    <path\r\n       style=\"fill:#000000;fill-opacity:1;stroke:#363636;stroke-width:2.23946524;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 75.172083,567.8747 -5.47097,-5.53134\"\r\n       id=\"path5452-5-5-1-7-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.196728\"\r\n       inkscape:transform-center-y=\"-0.78552851\" />\r\n    <path\r\n       style=\"fill:#ffe87e;fill-opacity:1;stroke:#a58000;stroke-width:1.02573335px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       id=\"path4607\"\r\n       inkscape:path-effect=\"#path-effect4609\"\r\n       inkscape:original-d=\"m 36.512525,599.08328 -0.0847,-15.30469 14.76623,-0.079 1.13455,-5.3121 h 6.7663 l 0.52197,5.56549 h 2.38874 l -0.0349,15.41642 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#dfc449;fill-opacity:1;stroke:#a58000;stroke-width:1.04236829px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       id=\"path5463\"\r\n       inkscape:path-effect=\"#path-effect5465\"\r\n       inkscape:original-d=\"m 38.651325,583.64804 2.27904,-5.34039 8.11475,0.19058 1.53729,4.93611 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccc\"\r\n       transform=\"translate(-33.065965,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#d7f0fb;fill-opacity:1;stroke:#4f4f4f;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none\"\r\n       d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       id=\"path3262\"\r\n       inkscape:path-effect=\"#path-effect3264\"\r\n       inkscape:original-d=\"m 71.789265,599.90744 0.17512,-24.69199 h 15.41061 l 4.378,4.90337 0.17513,19.96374 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccc\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       id=\"path4106\"\r\n       inkscape:path-effect=\"#path-effect4108\"\r\n       inkscape:original-d=\"m 73.190225,596.58015 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       id=\"path4106-7\"\r\n       inkscape:path-effect=\"#path-effect4108-1\"\r\n       inkscape:original-d=\"m 73.540465,591.50166 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       id=\"path4106-0\"\r\n       inkscape:path-effect=\"#path-effect4108-4\"\r\n       inkscape:original-d=\"m 73.365345,586.59829 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       id=\"path4106-4\"\r\n       inkscape:path-effect=\"#path-effect4108-9\"\r\n       inkscape:original-d=\"m 73.365345,582.22027 16.81157,-0.35024\"\r\n       inkscape:connector-curvature=\"0\"\r\n       transform=\"translate(-33.561281,-31.819347)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 103.19489,558.19446 16.18158,0.0627\"\r\n       id=\"path5452-5-5-1-7-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6534509\"\r\n       inkscape:transform-center-y=\"-5.3788766\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f4f4f4;stroke-width:4.65793133;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 111.38254,565.89244 -0.15492,-16.18101\"\r\n       id=\"path5452-5-5-1-7-4-4\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.6340509\"\r\n       inkscape:transform-center-y=\"-5.8027516\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#f1f1f1;stroke-width:4.54087734;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 135.53124,558.66024 15.77493,0.0612\"\r\n       id=\"path5452-5-5-1-7-7-1\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cc\"\r\n       inkscape:transform-center-x=\"3.561639\"\r\n       inkscape:transform-center-y=\"-5.2436726\" />\r\n    <path\r\n       style=\"fill:#bfbfbf;fill-opacity:1;stroke:#ffffff;stroke-width:1.39999998;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 273.79736,565.92624 4.84986,4.15066 7.44379,-12.0346 -3.26109,-1.20718 -4.82074,8.91974 -2.46038,-2.39761 z\"\r\n       id=\"path1157\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ff9d00;fill-opacity:1;stroke:#808080;stroke-width:0.78749156px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 306.19903,566.65065 4.84985,4.15066 7.4438,-12.0346 -3.26109,-1.20718 -4.82075,8.91974 -2.46037,-2.39761 z\"\r\n       id=\"path1157-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(0.82348572,0,0,0.82348572,75.604975,111.95505)\" />\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:4.85740042;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 419.41366,537.85807 12.87326,7.64338 12.79438,-7.33068\"\r\n       id=\"path1585-6\"\r\n       inkscape:connector-curvature=\"0\"\r\n       inkscape:path-effect=\"#path-effect1587-6\"\r\n       inkscape:original-d=\"m 419.41366,537.85807 12.87326,7.64338 c 4.40656,-2.37267 3.01422,-8.5404 12.79438,-7.33068\"\r\n       sodipodi:nodetypes=\"ccc\"\r\n       transform=\"matrix(-0.82326686,0.01898429,-0.01898429,-0.82326686,829.82733,995.45395)\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#ffffff;stroke-width:1.4972775px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 325.7796,560.88703 9.22114,7.89176 14.15308,-22.88169 -6.20039,-2.29524 -9.16581,16.95932 -4.67796,-4.55863 z\"\r\n       id=\"path1157-6-7\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"ccccccc\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:none\"\r\n       d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 4.98485,11.66133 z\"\r\n       id=\"path4192-0\"\r\n       inkscape:path-effect=\"#path-effect4194-5\"\r\n       inkscape:original-d=\"m 338.27455,603.35315 -4.55847,-12.13972 -4.42325,4.14941 0.29119,-21.42993 14.0532,13.84869 -5.29334,1.40046 c 11.73953,18.68506 2.52594,6.89719 4.98485,11.66133 z\"\r\n       inkscape:connector-curvature=\"0\"\r\n       sodipodi:nodetypes=\"cccccccc\"\r\n       transform=\"rotate(-9.319008,159.52768,371.93318)\" />\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:17.712px;line-height:0%;font-family:'MV Boli';-inkscape-font-specification:'MV Boli';letter-spacing:0px;word-spacing:0px;fill:#ffdc00;fill-opacity:1;stroke:none;stroke-width:1.476\"\r\n       x=\"179.14906\"\r\n       y=\"751.84772\"\r\n       id=\"text3255-0\"\r\n       transform=\"matrix(1.2141217,-0.1513943,0.23126622,0.79480305,0,0)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan3257-0\"\r\n         x=\"179.14906\"\r\n         y=\"751.84772\"\r\n         style=\"font-size:44.4154px;line-height:1.25;stroke-width:1.476\">!</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:32.4516px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.81129\"\r\n       x=\"131.62856\"\r\n       y=\"599.63672\"\r\n       id=\"text1309\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307\"\r\n         x=\"131.62856\"\r\n         y=\"599.63672\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.81129\">B</tspan></text>\r\n    <text\r\n       id=\"text1309-2\"\r\n       y=\"658.43152\"\r\n       x=\"153.61592\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:41.6588px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.04147\"\r\n       xml:space=\"preserve\"\r\n       transform=\"scale(1.0962314,0.91221617)\"><tspan\r\n         style=\"font-style:italic;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:serif;-inkscape-font-specification:'serif Bold Italic';stroke-width:1.04147\"\r\n         y=\"658.43152\"\r\n         x=\"153.61592\"\r\n         id=\"tspan1307-4\"\r\n         sodipodi:role=\"line\">i</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:38.431px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.960773\"\r\n       x=\"264.23669\"\r\n       y=\"522.23657\"\r\n       id=\"text1309-0-9\"\r\n       transform=\"scale(0.87011438,1.1492742)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-4\"\r\n         x=\"264.23669\"\r\n         y=\"522.23657\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.960773\"><tspan\r\n           style=\"font-weight:normal;stroke-width:0.960773\"\r\n           id=\"tspan1365\">s</tspan></tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-weight:normal;font-size:31.7797px;line-height:1.25;font-family:sans-serif;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.794494\"\r\n       x=\"195.07664\"\r\n       y=\"596.5979\"\r\n       id=\"text1309-0-2\"\r\n       transform=\"scale(0.99519471,1.0048285)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan1307-3-1\"\r\n         x=\"195.07664\"\r\n         y=\"596.5979\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold';stroke-width:0.794494\">U</tspan></text>\r\n    <path\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.47724;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 194.05959,600.03363 25.702,0.14808\"\r\n       id=\"path1375\" />\r\n    <path\r\n       id=\"path1375-2\"\r\n       d=\"m 227.04774,587.38832 25.63991,0.14772\"\r\n       style=\"fill:none;stroke:#ffffff;stroke-width:3.46884;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       inkscape:transform-center-x=\"1.1856386\"\r\n       inkscape:transform-center-y=\"-0.33875464\" />\r\n    <path\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 262.93706,592.38036 0.0134,5.70131 18.41916,-9.10923 -18.14729,-10.18151 z\"\r\n       id=\"path5370-5-1-2-1-4\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <path\r\n       inkscape:connector-curvature=\"0\"\r\n       id=\"path5370-5-1-2-1-4-0\"\r\n       d=\"m 301.44451,581.20782 -5.70129,0.0197 9.12976,18.40899 10.16128,-18.15862 z\"\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:#484848;stroke-width:1.623;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <ellipse\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.80047;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\"\r\n       id=\"path1040\"\r\n       ry=\"8.7032747\"\r\n       rx=\"8.4312963\"\r\n       cy=\"583.49023\"\r\n       cx=\"331.71524\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 336.4644,589.47097 10.10632,10.66173\"\r\n       id=\"path1042\"\r\n       sodipodi:nodetypes=\"cc\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 325.36075,583.26941 12.63506,0.34484\"\r\n       id=\"path1044\" />\r\n    <ellipse\r\n       cx=\"364.00839\"\r\n       cy=\"584.36328\"\r\n       rx=\"9.6165609\"\r\n       ry=\"9.9267731\"\r\n       id=\"path1040-0\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:3.19416;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:20;stroke-opacity:1\" />\r\n    <path\r\n       sodipodi:nodetypes=\"cc\"\r\n       id=\"path1042-6\"\r\n       d=\"m 369.73697,590.7899 10.89694,10.89694\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       id=\"path1044-4\"\r\n       d=\"m 357.64269,584.09303 12.63506,0.34484\"\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       style=\"fill:none;stroke:#242424;stroke-width:2.17621;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\r\n       d=\"m 363.94156,590.78154 0.20796,-12.63806\"\r\n       id=\"path1044-4-9\" />\r\n  </g>\r\n</svg>\r\n`.trim();\r\n\r\ntext = btoa(text);\r\nexport let iconSvg = `data:image/svg+xml;base64,` + text;", "\"use strict\";\r\n\r\nimport {iconSvg} from './iconsheet.js';\r\n\r\nexport const Icons = {\r\n  FOLDER        : 0, //file folder\r\n  FILE          : 1,\r\n  TINY_X        : 2, //'x' in bottom left corner\r\n  SMALL_PLUS    : 3,\r\n  SMALL_MINUS   : 4,\r\n  UNDO          : 5,\r\n  REDO          : 6,\r\n  HELP          : 7,\r\n  ENUM_UNCHECKED: 8, //overlaid on icon checkboxes when unchecked\r\n  ENUM_CHECKED  : 9, //overlaid on icon checkboxes when checked\r\n  LARGE_CHECK   : 10, //default check mark for non-icon checkboxes\r\n  CURSOR_ARROW  : 11,\r\n  NOTE_EXCL     : 12, //notification exclamation mark\r\n  SCROLL_DOWN   : 13,\r\n  SCROLL_UP     : 14,\r\n  BACKSPACE     : 15,\r\n  LEFT_ARROW    : 16,\r\n  RIGHT_ARROW   : 17,\r\n  UI_EXPAND     : 18, //triangle\r\n  UI_COLLAPSE   : 19, //triangle\r\n  BOLD          : 20,\r\n  ITALIC        : 21,\r\n  UNDERLINE     : 22,\r\n  STRIKETHRU    : 23,\r\n  TREE_EXPAND   : 24,\r\n  TREE_COLLAPSE : 25,\r\n  ZOOM_OUT      : 26,\r\n  ZOOM_IN       : 27\r\n};\r\n\r\nexport function loadDefaultIconSheet() {\r\n  let iconSheet = document.createElement(\"img\");\r\n  iconSheet.src = iconSvg;\r\n\r\n  return iconSheet;\r\n}\r\n\r\n\r\n", "import nstructjs from '../path-controller/util/struct.js';\r\n\r\nimport {UIBase} from '../core/ui_base.js';\r\n\r\nexport class FileHeader {\r\n  constructor(version, magic, flags) {\r\n    this.magic = magic;\r\n    this.flags = flags;\r\n    this.version_major = version ? version[0] : 0;\r\n    this.version_minor = version ? version[1] : 0;\r\n    this.version_micro = version ? version[2] : 0;\r\n    this.schema = nstructjs.write_scripts();\r\n  }\r\n}\r\n\r\nFileHeader.STRUCT = `\r\nsimple.FileHeader {\r\n  magic         : static_string[4];\r\n  version_major : short;\r\n  version_minor : short;\r\n  version_micro : short;\r\n  flags         : short;\r\n  schema        : string; \r\n}\r\n`;\r\nnstructjs.register(FileHeader);\r\n\r\nexport class FileFull extends FileHeader {\r\n  constructor(version, magic, flags) {\r\n    super(version, magic, flags);\r\n    this.objects = [];\r\n  }\r\n}\r\n\r\nFileFull.STRUCT = nstructjs.inherit(FileFull, FileHeader) + `\r\n  objects : array(abstract(Object));\r\n  screen  : abstract(Object);\r\n}\r\n`;\r\nnstructjs.register(FileFull);\r\n\r\n\r\nexport class FileArgs {\r\n  constructor(args = {}) {\r\n    this.ext = args.ext || \".data\";\r\n    this.magic = args.magic || \"STRT\";\r\n    this.doScreen = args.doScreen !== undefined ? args.doScreen : true;\r\n    this.resetOnLoad = args.resetOnLoad !== undefined ? args.resetOnLoad : true;\r\n    this.useJSON = args.useJSON !== undefined ? args.useJSON : false;\r\n    this.version = args.version !== undefined ? args.version : 0;\r\n    this.fileFlags = args.fileFlags !== undefined ? args.fileFlags : 0;\r\n    this.fromFileOp = false; /* SimpleSaveOp and SimpleOpenOp set this to true */\r\n  }\r\n}\r\n\r\nexport class EmptyStruct {\r\n\r\n}\r\nEmptyStruct.STRUCT = `\r\nEmptyStruct {\r\n}\r\n`;\r\nnstructjs.register(EmptyStruct);\r\n\r\nexport function saveFile(appstate, args, objects) {\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  let version = args.version;\r\n  if (typeof version === \"number\") {\r\n    if (version === Math.floor(version)) {\r\n      version = [version, 0, 0];\r\n    } else {\r\n      let major = ~~version;\r\n      let minor = ~~(Math.fract(version)*10.0);\r\n      let micro = (Math.fract(version) - minor) * 100.0;\r\n\r\n      version = [major, minor, micro];\r\n    }\r\n  }\r\n\r\n  let file = new FileFull(version, args.magic, args.fileFlags);\r\n\r\n  if (args.doScreen) {\r\n    file.screen = appstate.screen;\r\n  } else {\r\n    file.screen = new EmptyStruct();\r\n  }\r\n\r\n  for (let ob of objects) {\r\n    file.objects.push(ob);\r\n  }\r\n\r\n  if (args.useJSON) {\r\n    return nstructjs.writeJSON(file);\r\n  } else {\r\n    let data = [];\r\n    nstructjs.writeObject(data, file);\r\n    return (new Uint8Array(data)).buffer;\r\n  }\r\n}\r\n\r\nexport function loadFile(appstate, args, data) {\r\n  let header;\r\n\r\n  if (args.useJSON === undefined) {\r\n    args.useJSON = appstate.saveFilesInJSON;\r\n  }\r\n\r\n  args = new FileArgs(args);\r\n\r\n  if (!args.useJSON) {\r\n    if (data instanceof Array) {\r\n      data = (new Uint8Array(data)).buffer;\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n      data = data.buffer;\r\n    }\r\n\r\n    if (data instanceof ArrayBuffer) {\r\n      data = new DataView(data);\r\n    }\r\n\r\n    header = nstructjs.readObject(data, FileHeader);\r\n  } else {\r\n    if (typeof data === \"string\") {\r\n      data = JSON.parse(data);\r\n    }\r\n\r\n    header = nstructjs.readJSON(data, FileHeader);\r\n  }\r\n\r\n  if (header.magic !== args.magic) {\r\n    throw new Error(\"invalid file\");\r\n  }\r\n\r\n  let istruct = new nstructjs.STRUCT();\r\n  istruct.parse_structs(header.schema);\r\n\r\n  let ret;\r\n\r\n  if (!args.useJSON) {\r\n    ret = istruct.readObject(data, FileFull);\r\n  } else {\r\n    ret = istruct.readJSON(data, FileFull);\r\n  }\r\n\r\n  if (args.resetOnLoad) {\r\n    appstate.reset();\r\n  }\r\n\r\n  if (args.doScreen) {\r\n    if (appstate.screen) {\r\n      appstate.screen.unlisten();\r\n      appstate.screen.remove();\r\n    }\r\n\r\n    ret.screen.ctx = appstate.ctx;\r\n\r\n    if (!(ret.screen instanceof appstate.screenClass)) {\r\n      let screen = UIBase.createElement(appstate.screenClass.define().tagname);\r\n      screen.ctx = appstate.ctx;\r\n\r\n      for (let sarea of ret.screen.sareas) {\r\n        screen.appendChild(sarea);\r\n\r\n        sarea.area.afterSTRUCT();\r\n        sarea.area.on_fileload();\r\n      }\r\n\r\n      ret.screen = screen;\r\n    }\r\n\r\n    appstate.screen = ret.screen;\r\n\r\n    document.body.appendChild(appstate.screen);\r\n    appstate.screen.listen();\r\n  }\r\n\r\n  return ret;\r\n}", "import {Editor} from './editor.js';\r\nimport {UIBase} from '../core/ui_base.js';\r\nimport {nstructjs} from '../path-controller/controller.js';\r\nimport {AreaFlags} from '../screen/ScreenArea.js';\r\n\r\n/** see ./editor.js:Editor.registerAppMenu */\r\n\r\nexport class MenuBarEditor extends Editor {\r\n  constructor() {\r\n    super();\r\n\r\n    this.updateHeight();\r\n    this.borderLock = 1 | 2 | 4 | 8;\r\n    this.areaDragToolEnabled = false;\r\n\r\n    this._height = 25;\r\n\r\n    this.needsRebuild = false;\r\n  }\r\n\r\n  get height() {\r\n    return this._height;\r\n  }\r\n\r\n  set height(v) {\r\n    this._height = v;\r\n    this.updateHeight();\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : \"simple-menu-editor-x\",\r\n      areaname: \"menu\",\r\n      uiname  : \"Menu Bar\",\r\n      icon    : -1,\r\n      //hide in editor list\r\n      flag    : AreaFlags.HIDDEN | AreaFlags.NO_HEADER_CONTEXT_MENU | AreaFlags.NO_COLLAPSE | AreaFlags.NO_SWITCHER\r\n    }\r\n  }\r\n\r\n  updateHeight(force = false) {\r\n    if (!this.header)\r\n      return;\r\n\r\n    if (window.haveElectron) {\r\n      this.maxSize[1] = this.minSize[1] = 1;\r\n      electron_api.initMenuBar(this);\r\n      return;\r\n    }\r\n\r\n    if (this._height === undefined) {\r\n      let rect = this.header.getClientRects()[0];\r\n\r\n      if (rect) {\r\n        this._height = rect.height;\r\n      }\r\n    }\r\n\r\n    let update = force || this._height !== this.minSize[1];\r\n    this.minSize[1] = this.maxSize[1] = this._height;\r\n\r\n    if (update && this.ctx && this.getScreen()) {\r\n      this.getScreen().solveAreaConstraints();\r\n    }\r\n  }\r\n\r\n  makeMenuBar(container) {\r\n    if (Editor.makeMenuBar) {\r\n      Editor.makeMenuBar(this.ctx, container, this);\r\n    }\r\n  }\r\n\r\n  flagRebuild() {\r\n    this.needsRebuild = true;\r\n  }\r\n\r\n  init() {\r\n    super.init();\r\n\r\n    this.background = this.getDefault(\"AreaHeaderBG\");\r\n\r\n    this.menuRow = this.header.row();\r\n    this.makeMenuBar(this.menuRow);\r\n\r\n    this.doOnce(() => {\r\n      if (window.haveElectron) {\r\n        this.height = 1;\r\n        electron_api.initMenuBar(this);\r\n      }\r\n    });\r\n\r\n    this.updateHeight(true);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  rebuild() {\r\n    this.needsRebuild = false;\r\n\r\n    this.menuRow.clear();\r\n    this.makeMenuBar(this.menuRow);\r\n    this.flushUpdate();\r\n  }\r\n\r\n  update() {\r\n    if (this.needsRebuild) {\r\n      this.rebuild();\r\n    }\r\n  }\r\n}\r\n\r\nMenuBarEditor.STRUCT = nstructjs.inherit(MenuBarEditor, Editor, \"MenuBarEditor\") + `\r\n}\r\n`;\r\n\r\nexport function registerMenuBarEditor() {\r\n  Editor.register(MenuBarEditor);\r\n}\r\n", "import * as platform from '../platforms/platform.js';\r\n\r\nimport {ToolOp, UndoFlags} from '../path-controller/toolsys/toolsys.js';\r\nimport {ToolProperty, BoolProperty, StringProperty} from '../path-controller/toolsys/toolprop.js';\r\n\r\nimport {sendNote, error, warning, message} from '../widgets/ui_noteframe.js';\r\n\r\nexport class SimpleAppNewOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"New\",\r\n      toolpath: \"app.new\",\r\n      inputs  : {},\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    _appstate.createNewFile();\r\n  }\r\n}\r\n\r\nexport class SimpleAppSaveOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Save\",\r\n      toolpath: \"app.save\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n\r\n    _appstate.saveFile({\r\n      doScreen  : true,\r\n      useJSON,\r\n      fromFileOp: true\r\n    }).then(data => {\r\n\r\n      function save() {\r\n        return data;\r\n      }\r\n\r\n      platform.platform.showSaveDialog(\"Save As\", save, {\r\n        multi          : false,\r\n        addToRecentList: true,\r\n        filters        : [{\r\n          name      : \"File\",\r\n          mime      : useJSON ? \"text/json\" : \"application/x-octet-stream\",\r\n          extensions: [\".\" + ext.toLowerCase()]\r\n        }]\r\n      }).then(path => {\r\n        _appstate.currentFileRef = path;\r\n        message(\"File saved\");\r\n      }).catch(err => {\r\n        if (typeof err === \"object\" && err.message) {\r\n          err = err.message;\r\n        }\r\n\r\n        error(\"Failed to save file \" + err);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport class SimpleAppOpenOp extends ToolOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Open\",\r\n      toolpath: \"app.open\",\r\n      inputs  : {\r\n        forceDialog: new BoolProperty()\r\n      },\r\n      undoflag: UndoFlags.NO_UNDO\r\n    }\r\n  }\r\n\r\n  exec(ctx) {\r\n    let ext = _appstate.fileExt;\r\n    let useJSON = _appstate.startArgs.saveFilesInJSON;\r\n    let mime = useJSON ? \"text/json\" : \"application/x-octet-stream\";\r\n\r\n    platform.platform.showOpenDialog(\"Open File\", {\r\n      multi          : false,\r\n      addToRecentList: true,\r\n      filters        : [{\r\n        name      : \"File\",\r\n        mime,\r\n        extensions: [\".\" + ext.toLowerCase()]\r\n      }]\r\n    }).then(paths => {\r\n      for (let path of paths) {\r\n        platform.platform.readFile(path, mime).then(data => {\r\n          console.log(\"got data!\", data);\r\n\r\n          _appstate.loadFile(data, {useJSON, doScreen: true, fromFileOp: true})\r\n            .catch(err => {\r\n              error(\"File error: \" + err.message);\r\n            });\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      ctx.error(error.message);\r\n    })\r\n  }\r\n}\r\n\r\nexport function register() {\r\n  ToolOp.register(SimpleAppSaveOp);\r\n  ToolOp.register(SimpleAppOpenOp);\r\n  ToolOp.register(SimpleAppNewOp);\r\n}\r\n", "import nstructjs from '../path-controller/util/struct.js';\r\nimport {Context, ContextOverlay, makeDerivedOverlay} from '../path-controller/controller/context.js';\r\n\r\nexport const DataModelClasses = [];\r\nimport {buildToolSysAPI, SavedToolDefaults, ToolStack} from '../path-controller/toolsys/toolsys.js';\r\nimport {DataAPI} from '../path-controller/controller/controller.js';\r\nimport {Screen} from '../screen/FrameManager.js';\r\nimport {areaclasses} from '../screen/area_wrangler.js';\r\nimport * as util from '../util/util.js';\r\nimport {Editor} from './editor.js';\r\n\r\nimport {Vector2} from '../path-controller/util/vectormath.js';\r\n\r\nimport cconst from '../config/const.js';\r\n\r\nexport class DataModel {\r\n  static defineAPI(api, strct) {\r\n    return strct;\r\n  }\r\n\r\n  /** Automatically registers cls with nstructjs\r\n   *  and handles STRUCT inheritance.\r\n   */\r\n  static register(cls) {\r\n    if (!cls.hasOwnProperty(\"defineAPI\")) {\r\n      //  throw new Error(cls.name + \"is missing a defineAPI method\");\r\n    }\r\n\r\n    DataModelClasses.push(cls);\r\n\r\n    if (cls.hasOwnProperty(\"STRUCT\") && !nstructjs.isRegistered(cls)) {\r\n      cls.STRUCT = nstructjs.inlineRegister(cls, cls.STRUCT);\r\n    }\r\n  }\r\n}\r\n\r\nclass EmptyContextClass extends Context {\r\n  static defineAPI(api, strct) {\r\n  }\r\n}\r\n\r\nimport * as ui_noteframe from '../widgets/ui_noteframe.js';\r\n\r\n/**\r\n * Extend the client-provided context class\r\n * with a few standard methods and properties\r\n *\r\n * */\r\nfunction GetContextClass(ctxClass) {\r\n  let ok = 0;\r\n  let cls = ctxClass;\r\n  while (cls) {\r\n    if (cls === Context) {\r\n      ok = 1;\r\n    } else if (cls === ContextOverlay) {\r\n      ok = 2;\r\n    }\r\n\r\n    cls = cls.__proto__;\r\n  }\r\n\r\n  if (ok === 1) {\r\n    return ctxClass;\r\n  }\r\n\r\n  let OverlayDerived;\r\n\r\n  if (ok === 2) {\r\n    OverlayDerived = ctxClass;\r\n  } else {\r\n    OverlayDerived = makeDerivedOverlay(ctxClass);\r\n  }\r\n\r\n  class Overlay extends OverlayDerived {\r\n    constructor(state) {\r\n      super(state);\r\n    }\r\n\r\n    get screen() {\r\n      return this.state.screen;\r\n    }\r\n\r\n    get api() {\r\n      return this.state.api;\r\n    }\r\n\r\n    get toolstack() {\r\n      return this.state.toolstack;\r\n    }\r\n\r\n    get toolDefaults() {\r\n      return SavedToolDefaults;\r\n    }\r\n\r\n    get last_tool() {\r\n      return this.toolstack.head;\r\n    }\r\n\r\n    message(msg, timeout = 2500) {\r\n      return ui_noteframe.message(this.screen, msg, timeout);\r\n    }\r\n\r\n    error(msg, timeout = 2500) {\r\n      return ui_noteframe.error(this.screen, msg, timeout);\r\n    }\r\n\r\n    warning(msg, timeout = 2500) {\r\n      return ui_noteframe.warning(this.screen, msg, timeout);\r\n    }\r\n\r\n    progressBar(msg, percent, color, timeout = 1000) {\r\n      return ui_noteframe.progbarNote(this.screen, msg, percent, color, timeout);\r\n    }\r\n  }\r\n\r\n  Context.register(Overlay);\r\n\r\n  return class ContextDerived extends Context {\r\n    constructor(state) {\r\n      super(state);\r\n\r\n      this.pushOverlay(new Overlay(state))\r\n    }\r\n\r\n    static defineAPI(api, st) {\r\n      return Overlay.defineAPI(api, st);\r\n    }\r\n  }\r\n}\r\n\r\nexport function makeAPI(ctxClass) {\r\n  let api = new DataAPI();\r\n\r\n  for (let cls of DataModelClasses) {\r\n    if (cls.defineAPI) {\r\n      cls.defineAPI(api, api.mapStruct(cls, true));\r\n    }\r\n  }\r\n\r\n  for (let k in areaclasses) {\r\n    areaclasses[k].defineAPI(api, api.mapStruct(areaclasses[k], true));\r\n  }\r\n\r\n  if (ctxClass.defineAPI) {\r\n    ctxClass.defineAPI(api, api.mapStruct(ctxClass, true));\r\n  } else {\r\n    throw new Error(\"Context class should have a defineAPI static method\");\r\n  }\r\n\r\n  api.rootContextStruct = api.mapStruct(ctxClass, api.mapStruct(ctxClass, true));\r\n\r\n  buildToolSysAPI(api, false, api.rootContextStruct, ctxClass, true);\r\n\r\n  return api;\r\n}\r\n\r\nimport {Icons, loadDefaultIconSheet} from './icons.js';\r\nimport {IconManager, setIconManager, setIconMap, setTheme, UIBase} from '../core/ui_base.js';\r\nimport {FileArgs, loadFile, saveFile} from './file.js';\r\nimport {HotKey, KeyMap} from '../path-controller/util/simple_events.js';\r\nimport {initSplineTemplates} from '../path-controller/curve/curve1d_bspline.js';\r\nimport {MenuBarEditor, registerMenuBarEditor} from './menubar.js';\r\nimport {register} from './app_ops.js';\r\n\r\nexport class StartArgs {\r\n  constructor() {\r\n    this.singlePage = true;\r\n\r\n    this.DEBUG = {}\r\n    this.icons = Icons;\r\n    this.iconsheet = undefined; //will default to loadDefaultIconSheet();\r\n    this.iconSizes = [16, 24, 32, 48];\r\n    this.iconTileSize = 32;\r\n    this.iconsPerRow = 16;\r\n    this.theme = undefined; //see scripts/core/theme.js\r\n\r\n    this.registerSaveOpenOps = true;\r\n\r\n    this.autoLoadSplineTemplates = true;\r\n    this.showPathsInToolTips = true;\r\n    this.enableThemeAutoUpdate = false;\r\n    this.addHelpPickers = false;\r\n    this.useNumSliderTextboxes = true;\r\n    this.numSliderArrowLimit = cconst.numSliderArrowLimit;\r\n    this.simpleNumSliders = cconst.simpleNumSliders;\r\n  }\r\n}\r\n\r\nexport class SimpleScreen extends Screen {\r\n  constructor() {\r\n    super();\r\n\r\n    this.keymap = new KeyMap([\r\n      new HotKey(\"Z\", [\"CTRL\"], () => {\r\n        this.ctx.toolstack.undo(this.ctx);\r\n      }),\r\n      new HotKey(\"Z\", [\"CTRL\", \"SHIFT\"], () => {\r\n        this.ctx.toolstack.redo(this.ctx);\r\n      }),\r\n    ])\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: \"simple-screen-x\"\r\n    }\r\n  }\r\n\r\n  init() {\r\n    if (this.ctx.state.startArgs.registerSaveOpenOps) {\r\n      this.keymap.add(new HotKey(\"S\", [\"CTRL\"], \"app.save()\"));\r\n      this.keymap.add(new HotKey(\"O\", [\"CTRL\"], \"app.open()\"));\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    super.setCSS();\r\n\r\n    this.style[\"position\"] = UIBase.PositionKey;\r\n    this.style[\"left\"] = this.pos[0] + \"px\";\r\n    this.style[\"top\"] = this.pos[1] + \"px\";\r\n  }\r\n}\r\n\r\nUIBase.register(SimpleScreen);\r\n\r\nexport class AppState {\r\n  /** ctxClass is the context class.  It can be either a simple class\r\n   *  or a subclass of the more complex path.ux Context class.  Note that\r\n   *  using Context will avoid subtle undo stack errors caused by the context\r\n   *  changing after a tool is run (this is why Context has a serialization\r\n   *  mechanism).\r\n   *\r\n   *  Path.ux will actually subclass ctxClass and add a few standard methods\r\n   *  and properties, see GetContextClass.*/\r\n  constructor(ctxClass, screenClass = SimpleScreen) {\r\n    this._ctxClass = ctxClass;\r\n\r\n    ctxClass = GetContextClass(ctxClass);\r\n\r\n    this.startArgs = undefined;\r\n    this.currentFileRef = undefined; //current file path/ref\r\n\r\n    this.api = makeAPI(ctxClass);\r\n    this.ctx = new ctxClass(this);\r\n    this.ctx._state = this;\r\n    this.toolstack = new ToolStack();\r\n    this.screenClass = screenClass;\r\n    this.screen = undefined;\r\n\r\n    this.fileMagic = \"STRT\";\r\n    this.fileVersion = [0, 0, 1];\r\n    this._fileExt = \"data\";\r\n    this._fileExtSet = false;\r\n    this.saveFilesInJSON = false; /* save files in nstructjs-json */\r\n\r\n    this.defaultEditorClass = undefined; //if undefined, the first non-menubar editor will be used\r\n  }\r\n\r\n\r\n  get fileExt() {\r\n    return this._fileExt;\r\n  }\r\n\r\n  set fileExt(ext) {\r\n    this._fileExt = ext;\r\n    this._fileExtSet = true;\r\n  }\r\n\r\n  /** resets the undo stack */\r\n  reset() {\r\n    this.toolstack.reset();\r\n  }\r\n\r\n  /** Create a new file. See this.makeScreen() if you wish\r\n   *  to create a new screen at this time, and this.reset()\r\n   *  if you wish to reset the undo stack*/\r\n  createNewFile() {\r\n    console.warn(\"appstate.createNewFile: implement me, using default hack\");\r\n    let state = new this.constructor(this.ctx._ctxClass);\r\n\r\n    state.api = this.api;\r\n    state.ctx = this.ctx;\r\n    state.startArgs = this.startArgs;\r\n    state.saveFilesInJSON = this.saveFilesInJSON;\r\n\r\n    state.toolstack = this.toolstack;\r\n    state.toolstack.reset();\r\n\r\n    this.screen.unlisten();\r\n    this.screen.remove();\r\n\r\n    for (let k in state) {\r\n      this[k] = state[k];\r\n    }\r\n\r\n    this.makeScreen();\r\n  }\r\n\r\n  saveFileSync(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return saveFile(this, args, objects);\r\n  }\r\n\r\n  /** Serialize the application state. Takes\r\n   *  a list of objects to save (with nstructjs);\r\n   *  Subclasses should override this, like so:\r\n   *\r\n   *  saveFile(args={}) {\r\n   *    let objects = app state;\r\n   *    return super.saveFile(objects, args);\r\n   *  }\r\n   **/\r\n  saveFile(objects, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    return new Promise((accept, reject) => {\r\n      accept(this.saveFileSync(objects, args));\r\n    });\r\n  }\r\n\r\n  loadFileSync(data, args = {}) {\r\n    args = new FileArgs(Object.assign({\r\n      magic  : this.fileMagic,\r\n      version: this.fileVersion,\r\n      ext    : this.fileExt\r\n    }, args));\r\n\r\n    let ret = loadFile(this, args, data);\r\n\r\n    if (args.doScreen) {\r\n      try {\r\n        this.ensureMenuBar();\r\n      } catch (error) {\r\n        console.error(error.stack);\r\n        console.error(error.message);\r\n        console.error(\"Failed to add menu bar\");\r\n      }\r\n\r\n      this.screen.completeSetCSS();\r\n      this.screen.completeUpdate();\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   *  Loads a new file. The default behavior is a\r\n   *  complete state reset (you can control this\r\n   *  with args.reset_toolstack, args.reset_context\r\n   *  and args.doScreen).\r\n   *\r\n   *  As the base class cannot know just what to do\r\n   *  with the loaded data (the objects parameter\r\n   *  passed to saveFile) it is recommended you\r\n   *  override this function like so:\r\n   *\r\n   *  loadFile(data, args) {\r\n   *    return super.loadFile(data, args).then(fileData) => {\r\n   *      // load fileData.objects into appropriate properties\r\n   *      // this is the same objects array originally passed\r\n   *      // to this.saveFile\r\n   *      this.data = fileData.objects;\r\n   *    });\r\n   *  }\r\n   *\r\n   *  @param {ArrayBuffer|JSON|DataView} data\r\n   *  @param {FileArgs} args\r\n   *  */\r\n  loadFile(data, args = {}) {\r\n    return new Promise((accept, reject) => {\r\n      accept(this.loadFileSync(data, args));\r\n    });\r\n  }\r\n\r\n  ensureMenuBar() {\r\n    let screen = this.screen;\r\n    let ok = false;\r\n\r\n    for (let sarea of screen.sareas) {\r\n      if (sarea.area instanceof MenuBarEditor) {\r\n        ok = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (ok) {\r\n      return;\r\n    }\r\n\r\n    if (!Editor.makeMenuBar) {\r\n      /* don't make menu bar if Editor.registerAppMenu hasn't been called */\r\n      return;\r\n    }\r\n\r\n    /* ensure screen size is up to date */\r\n    screen.update();\r\n\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.appendChild(sarea);\r\n\r\n    let h = 55;\r\n    let min = new Vector2().addScalar(1e17);\r\n    let max = new Vector2().addScalar(-1e17);\r\n    let tmp = new Vector2();\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      min.min(sarea2.pos);\r\n      tmp.load(sarea2.pos).add(sarea2.size);\r\n      max.max(tmp);\r\n    }\r\n\r\n    let scale = (max[1] - min[1] - h)/(max[1] - min[1]);\r\n\r\n    for (let sarea2 of screen.sareas) {\r\n      if (sarea2 === sarea) {\r\n        continue;\r\n      }\r\n\r\n      sarea2.pos[1] *= scale;\r\n      sarea2.size[1] *= scale;\r\n      sarea2.pos[1] += h;\r\n    }\r\n\r\n    sarea.pos.zero();\r\n    sarea.size[0] = screen.size[0];\r\n    sarea.size[1] = h;\r\n\r\n    screen.regenScreenMesh();\r\n    screen.snapScreenVerts();\r\n\r\n    sarea.switch_editor(MenuBarEditor);\r\n\r\n    screen.solveAreaConstraints();\r\n\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n  }\r\n\r\n  makeScreen() {\r\n    if (this.screen) {\r\n      this.screen.unlisten();\r\n      this.screen.remove();\r\n    }\r\n\r\n    let screen = this.screen = UIBase.createElement(this.screenClass.define().tagname);\r\n    let sarea = UIBase.createElement(\"screenarea-x\");\r\n\r\n    screen.ctx = this.ctx;\r\n    sarea.ctx = this.ctx;\r\n\r\n    document.body.appendChild(screen);\r\n\r\n    let cls = this.defaultEditorClass;\r\n\r\n    if (!cls) {\r\n      for (let k in areaclasses) {\r\n        cls = areaclasses[k];\r\n\r\n        if (cls !== MenuBarEditor) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    sarea.switch_editor(cls);\r\n    screen.appendChild(sarea);\r\n\r\n    screen._init();\r\n    screen.listen();\r\n    screen.update();\r\n    screen.completeSetCSS();\r\n    screen.completeUpdate();\r\n\r\n    if (Editor.makeMenuBar) {\r\n      this.ensureMenuBar();\r\n    }\r\n  }\r\n\r\n  start(args = new StartArgs()) {\r\n    nstructjs.validateStructs();\r\n\r\n    let args2 = new StartArgs();\r\n\r\n    let methodsCheck = [\r\n      \"saveFile\", \"createNewFile\", \"loadFile\"\r\n    ];\r\n\r\n    for (let method of methodsCheck) {\r\n      let m1 = AppState.prototype[method];\r\n      let m2 = this[method];\r\n\r\n      if (m1 === m2) {\r\n        console.warn(`Warning: it is recommended to override .${method} when subclassing simple.AppState`);\r\n      }\r\n    }\r\n\r\n    document.body.style[\"touch-action\"] = \"none\";\r\n\r\n    registerMenuBarEditor();\r\n\r\n    for (let k in args2) {\r\n      if (args[k] === undefined) {\r\n        args[k] = args2[k];\r\n      }\r\n    }\r\n\r\n    if (args.registerSaveOpenOps) {\r\n      register();\r\n    }\r\n\r\n    if (!args.iconsheet) {\r\n      args.iconsheet = loadDefaultIconSheet();\r\n    }\r\n\r\n    this.startArgs = args;\r\n\r\n    cconst.loadConstants(args);\r\n\r\n    if (args.autoLoadSplineTemplates) {\r\n      initSplineTemplates();\r\n    }\r\n\r\n    let sizes = [];\r\n    let images = [];\r\n\r\n    for (let size of args.iconSizes) {\r\n      sizes.push([args.iconTileSize, size]);\r\n      images.push(args.iconsheet);\r\n    }\r\n\r\n    window.iconsheet = args.iconsheet;\r\n\r\n\r\n    let iconManager = new IconManager(images, sizes, args.iconsPerRow);\r\n    setIconManager(iconManager);\r\n    setIconMap(args.icons);\r\n\r\n    if (args.theme) {\r\n      setTheme(args.theme);\r\n    }\r\n\r\n    document.body.style[\"margin\"] = \"0px\";\r\n    document.body.style[\"padding\"] = \"0px\";\r\n\r\n    if (args.singlePage) {\r\n      document.body.style[\"overflow\"] = \"hidden\";\r\n    }\r\n\r\n    this.makeScreen();\r\n\r\n    Object.defineProperty(window, \"C\", {\r\n      get() {\r\n        return this._appstate.ctx;\r\n      }\r\n    });\r\n\r\n    nstructjs.validateStructs();\r\n\r\n    if (this.saveFilesInJSON && !this._fileExtSet) {\r\n      this._fileExt = \"json\";\r\n    }\r\n\r\n    if (this._fileExt.startsWith(\".\")) {\r\n      this._fileExt = this._fileExt.slice(1, this._fileExt.length).trim();\r\n    }\r\n  }\r\n}\r\n", "\r\nexport class SimpleContext {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static getContextClass() {\r\n    let props = {};\r\n\r\n    let rec = (cls) => {\r\n      let prototype = cls.prototype;\r\n\r\n      if (cls.__proto__ !== Object.__proto__) {\r\n        rec(cls);\r\n      }\r\n\r\n      for (let k in cls) {\r\n        let descr = Object.getOwnPropertyDescriptor(prototype, k);\r\n\r\n        if (descr) {\r\n          props[k] = descr;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(props);\r\n\r\n    for (let k in props) {\r\n      if (k.search(\"_save\") >= 0 || k.search(\"_load\") >= 0) {\r\n        continue;\r\n      }\r\n\r\n    }\r\n  }\r\n}", "import './path-controller/util/polyfill.js';\r\n\r\nexport * from './xmlpage/xmlpage.js';\r\n\r\nexport * from './core/ui_base.js';\r\nexport * from './core/ui.js';\r\nexport * from './widgets/ui_widgets.js';\r\nexport * from './widgets/ui_widgets2.js';\r\nexport * from './core/ui_theme.js';\r\nexport * from './core/units.js';\r\nexport * from './widgets/ui_button.js';\r\nexport * from './widgets/ui_richedit.js';\r\nexport * from './widgets/ui_curvewidget.js';\r\nexport * from './widgets/ui_panel.js';\r\nexport * from './widgets/ui_colorpicker2.js';\r\nexport * from './widgets/ui_tabs.js';\r\nexport * from './widgets/ui_listbox.js';\r\nexport * from './widgets/ui_menu.js';\r\nexport * from './widgets/ui_progress.js';\r\nexport * from './widgets/ui_table.js';\r\nexport * from './widgets/ui_noteframe.js';\r\nexport * from './widgets/ui_numsliders.js';\r\nexport * from './widgets/ui_lasttool.js';\r\nexport * from './widgets/ui_textbox.js';\r\nexport * from './path-controller/util/graphpack.js';\r\n//export * from './docbrowser/docbrowser.js';\r\n\r\nexport * from './path-controller/util/html5_fileapi.js';\r\nexport * from './path-controller/controller.js';\r\n\r\nimport * as controller from './path-controller/controller.js';\r\n\r\nexport {controller};\r\n\r\nimport * as ui_noteframe from './widgets/ui_noteframe.js';\r\n\r\ncontroller.setNotifier(ui_noteframe);\r\n\r\nexport {\r\n  PlatformAPI, getMime, isMimeText, mimeMap, textMimes, FileDialogArgs, FilePath\r\n} from './platforms/platform_base.js';\r\n\r\nimport * as platform from './platforms/platform.js';\r\n\r\nexport {platform};\r\n\r\nimport * as electron_api from './platforms/electron/electron_api.js';\r\n\r\nexport {electron_api};\r\n\r\nexport * from './widgets/theme_editor.js';\r\nexport * from './widgets/ui_treeview.js';\r\n\r\nexport * from './screen/FrameManager.js';\r\nexport * from './screen/ScreenArea.js';\r\nexport * from './util/ScreenOverdraw.js';\r\n\r\nimport cconst from './config/const.js';\r\n\r\nexport {cconst};\r\n\r\nimport * as simple from './simple/simple.js';\r\n\r\nexport {simple};\r\n", "\r\nexport enum MeshTypes {\r\n  VERTEX  = 1,\r\n  EDGE    = 2,\r\n  HANDLE  = 4,\r\n  LOOP    = 8,\r\n  LOOPLIST= 16,\r\n  FACE    = 32\r\n}\r\n\r\nexport enum MeshFlags {\r\n  NONE = 0,\r\n  SELECT= 1<<0,\r\n  HIDE  = 1<<1\r\n}\r\n\r\nexport enum MeshFeatures {\r\n  NONE = 0,\r\n  HANDLES = 1<<0\r\n}", "import {MeshTypes} from '../core/mesh_base.js';\r\n\r\nexport default {\r\n  MESH_HANDLES        : true,\r\n  SELECTMASK          : MeshTypes.VERTEX | MeshTypes.HANDLE | MeshTypes.EDGE | MeshTypes.FACE,\r\n  ENABLE_EXTRUDE      : true,\r\n  AUTOSAVE            : false,\r\n  AUTOSAVE_INTERVAL_MS: 1500,\r\n  DRAW_TEST_IMAGES    : false,\r\n};\r\n", "import {Context} from '../core/context.js'\r\nimport {Element} from '../core/mesh.js'\r\nimport {MeshTypes} from '../core/mesh_base.js'\r\nimport {\r\n  KeyMap,\r\n  nstructjs,\r\n  util,\r\n  simple,\r\n  EnumProperty,\r\n  ToolProperty,\r\n  DataAPI,\r\n  DataStruct,\r\n  Container,\r\n} from '../path.ux/pathux.js'\r\nimport {StructReader} from '../path.ux/scripts/path-controller/types/util/nstructjs.js'\r\n\r\nexport interface IToolModeDef {\r\n  uiName: string\r\n  typeName: string\r\n  icon?: number\r\n  description?: string\r\n}\r\nexport interface IToolModeConstructor<CLS extends ToolModeBase = ToolModeBase> {\r\n  new (ctx: Context): CLS\r\n  toolModeDef(): IToolModeDef\r\n}\r\n\r\nexport const ToolModeClasses = [] as IToolModeConstructor[]\r\n\r\nexport class ToolModeBase extends simple.DataModel<Context> {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nToolModeBase {\r\n  sideBarUIData : string;\r\n}\r\n  `\r\n  )\r\n\r\n  static toolModeDef(): IToolModeDef {\r\n    return {\r\n      uiName     : '',\r\n      typeName   : '',\r\n      icon       : -1,\r\n      description: '',\r\n    }\r\n  }\r\n\r\n  static getClass(name: string) {\r\n    for (let cls of ToolModeClasses) {\r\n      if (cls.toolModeDef().typeName === name) {\r\n        return name\r\n      }\r\n    }\r\n  }\r\n\r\n  static makeEnumProp() {\r\n    let enumdef = {} as any\r\n    let uinames = {} as any\r\n    let icons = {} as any\r\n    let descr = {} as any\r\n\r\n    let i = 0\r\n    for (let cls of ToolModeClasses) {\r\n      let def = cls.toolModeDef()\r\n      let key = def.typeName\r\n\r\n      enumdef[key] = i\r\n      uinames[key] = def.uiName ?? ToolProperty.makeUIName(key)\r\n      icons[key] = def.icon ?? -1\r\n      descr[key] = def.description ?? ''\r\n\r\n      i++\r\n    }\r\n\r\n    return new EnumProperty(0, enumdef).addUINames(uinames).addDescriptions(descr).addIcons(icons)\r\n  }\r\n\r\n  static register(cls: IToolModeConstructor) {\r\n    let def = cls.toolModeDef()\r\n\r\n    if (!cls.hasOwnProperty('toolModeDef')) {\r\n      throw new Error('Missing toolModeDef!')\r\n    }\r\n\r\n    if (!cls.hasOwnProperty('STRUCT')) {\r\n      throw new Error('Missing STRUCT script')\r\n    }\r\n\r\n    if (!def.typeName) {\r\n      throw new Error('missing typeName for toolmode')\r\n    }\r\n\r\n    simple.DataModel.register(cls)\r\n    ToolModeClasses.push(cls)\r\n  }\r\n\r\n  ['constructor']: IToolModeConstructor\r\n  \r\n  ctx: Context\r\n  keymap: KeyMap\r\n  sideBarUIData: string\r\n\r\n  constructor(ctx: Context) {\r\n    super()\r\n\r\n    this.ctx = ctx\r\n    this.keymap = new KeyMap()\r\n    this.sideBarUIData = ''\r\n  }\r\n\r\n  getEditMenu() {\r\n    let ret = []\r\n\r\n    for (let hk of this.keymap) {\r\n      if (typeof hk.action === 'string') {\r\n        ret.push(hk.action)\r\n      }\r\n    }\r\n\r\n    return ret\r\n  }\r\n\r\n  static defineAPI(api: DataAPI, st: DataStruct) {\r\n    return st\r\n  }\r\n\r\n  buildSideBar(container: Container) {}\r\n\r\n  on_mousedown(localX: number, localY: number, e: PointerEvent) {}\r\n\r\n  on_mousemove(localX: number, localY: number, e: PointerEvent) {}\r\n\r\n  on_mouseup(localX: number, localY: number, e: PointerEvent) {}\r\n\r\n  draw(ctx: Context, canvas: HTMLCanvasElement, g: CanvasRenderingContext2D) {\r\n    this.ctx = ctx\r\n  }\r\n\r\n  getKeymap() {\r\n    return this.keymap\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n  }\r\n}\r\n\r\nexport class PickData {\r\n  elem: Element\r\n  type: MeshTypes\r\n  dist: number\r\n\r\n  constructor(elem?: Element, type?: MeshTypes, dist?: number) {\r\n    if (elem !== undefined) {\r\n      this.elem = elem\r\n    }\r\n    if (type !== undefined) {\r\n      this.type = type\r\n    }\r\n    if (dist !== undefined) {\r\n      this.dist = dist\r\n    }\r\n  }\r\n\r\n  load(elem: Element, type: MeshTypes, dist: number) {\r\n    this.elem = elem\r\n    this.type = type\r\n    this.dist = dist\r\n\r\n    return this\r\n  }\r\n}\r\n", "import {util, math, Vector2, Vector3} from '../path.ux/scripts/pathux.js';\r\n\r\n/*\r\n\r\non factor;\r\noff period;\r\n\r\nprocedure bez(a1, b1);\r\na1 + (b1 - a1)*s;\r\n\r\nlin   := bez(k1, k2);\r\nquad  := bez(lin, sub(k2=k3, k1=k2, lin));\r\ncubic := bez(quad, sub(k3=k4,k2=k3,k1=k2, quad));\r\n\r\non fort;\r\ncubic;\r\ndcubic := df(cubic, s);\r\ndcubic2 := df(cubic, s, 2);\r\noff fort;\r\n\r\n%direct offset curve solve\r\nx1 := 0;\r\ny1 := 0;\r\n\r\npx := sub(k1=x1, k2=x2, k3=x3, k4=x4, cubic);\r\npy := sub(k1=y1, k2=y2, k3=y3, k4=y4, cubic);\r\n\r\nnx := df(py, s) / (df(px, s)**2 + df(py, s)**2);\r\nny := -df(px, s) / (df(px, s)**2 + df(py, s)**2);\r\n\r\noffx := px + nx*radius;\r\noffy := py + ny*radius;\r\ndf(offx, s);\r\ndf(offy, s);\r\n\r\n%symbolic offset method\r\non factor;\r\noff period;\r\noperator offx, offy, dx, dy, dx2, dy2;\r\n\r\nlet df(offx(s), s) = dx;\r\nlet df(dx, s) = dx2;\r\nlet df(offy(s), s) = dy;\r\nlet df(dy, s) = dy2;\r\n\r\nnx := df(offy(s), s) / sqrt(df(offx(s), s)**2 + df(offy(s), s)**2);\r\nny := -df(offx(s), s) / sqrt(df(offx(s), s)**2 + df(offy(s), s)**2);\r\n\r\npx := offx(s) + nx*radius;\r\npy := offy(s) + ny*radius;\r\n\r\non fort;\r\ndf(px, s);\r\ndf(py, s);\r\noff fort;\r\n\r\n*/\r\n\r\nexport function cubic(k1, k2, k3, k4, s) {\r\n  return -(k1*s**3 - 3*k1*s**2 + 3*k1*s - k1 - 3*k2*s**3 + 6*k2*s**2 - 3*k2*s + 3*\r\n    k3*s**3 - 3*k3*s**2 - k4*s**3);\r\n}\r\n\r\nexport function dcubic(k1, k2, k3, k4, s) {\r\n  return -3*((s - 1)**2*k1 - k4*s**2 + (3*s - 2)*k3*s - (3*s - 1)*(s - 1)*k2);\r\n}\r\n\r\nexport function d2cubic(k1, k2, k3, k4, s) {\r\n  return -6*(k1*s - k1 - 3*k2*s + 2*k2 + 3*k3*s - k3 - k4*s);\r\n}\r\n\r\nlet offsetdvs = util.cachering.fromConstructor(Vector3, 64);\r\n\r\nexport function cubicOffsetDv(a, b, c, d, s, radius) {\r\n  let dv = offsetdvs.next();\r\n  let dv2 = offsetdvs.next();\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    dv[i] = dcubic(a[i], b[i], c[i], d[i], s);\r\n    dv2[i] = d2cubic(a[i], b[i], c[i], d[i], s);\r\n  }\r\n\r\n  let [dx, dy] = dv;\r\n  let [dx2, dy2] = dv2;\r\n  let sqrt = Math.sqrt;\r\n\r\n  let ret = offsetdvs.next();\r\n\r\n  if (dx === 0.0 && dy === 0.0) {\r\n    return ret.load(d).sub(a);\r\n  }\r\n\r\n  const div = sqrt(dx**2 + dy**2)*(dx**2 + dy**2);\r\n\r\n  //console.log(\"dv\", dx, dy, dx2, dy2, radius, s);\r\n\r\n  ret[0] = ((sqrt(dx**2 + dy**2)*dx**2 + sqrt(dx**2 + dy**2)*dy**2 + dx*dy2*\r\n    radius - dx2*dy*radius)*dx)/div;\r\n  ret[1] = ((sqrt(dx**2 + dy**2)*dx**2 + sqrt(dx**2 + dy**2)*dy**2 + dx*dy2*\r\n    radius - dx2*dy*radius)*dy)/div;\r\n\r\n  return ret;\r\n}", "import {Vector3, Vector4, util, nstructjs, INumVector} from '../path.ux/pathux.js'\r\nimport config from '../config/config.js'\r\n;('use strict')\r\n\r\nexport * from './mesh_base.js'\r\nimport {MeshFlags, MeshFeatures, MeshTypes} from './mesh_base'\r\nimport {cubic, cubicOffsetDv, d2cubic, dcubic} from './bezier.js'\r\nimport {StructReader} from '../path.ux/scripts/path-controller/types/util/nstructjs.js'\r\nimport {IDGen} from '../path.ux/scripts/path-controller/types/util/util.js'\r\nimport './redraw_all.d.ts'\r\n\r\nexport const MeshVector = Vector3\r\nexport type MeshVector = Vector3\r\n\r\n/*\r\nexport class MeshVector {\r\n  #vec = [0, 0, 0]\r\n  length = 3\r\n\r\n  static STRUCT = nstructjs.inlineRegister(this, `\r\nMeshVector {\r\n  0 : float;\r\n  1 : float;\r\n  2 : float;\r\n}\r\n  `);\r\n\r\n  constructor(co : INumVector) {\r\n    for (let i=0; i<this.length; i++) {\r\n    Object.defineProperty(this, i, {\r\n      get() {\r\n        return this.#vec[i]\r\n      },\r\n      set(v) {\r\n        if (isNaN(v)) {\r\n          debugger;\r\n        }\r\n\r\n        this.#vec[i] = v;\r\n      }\r\n    });\r\n    }\r\n\r\n    if (co) {\r\n      this.load(co);\r\n    }\r\n  }\r\n}\r\nfor (let k of Reflect.ownKeys(BaseVector.prototype)) {\r\n  MeshVector.prototype[k] = BaseVector.prototype[k]\r\n}\r\nfor (let k of Reflect.ownKeys(Vector3.prototype)) {\r\n  MeshVector.prototype[k] = Vector3.prototype[k]\r\n}\r\n//*/\r\n\r\nconst sel = [1, 0.8, 0, 1]\r\nconst high = [1, 0.8, 0.7, 1]\r\nconst act = [0, 0.3, 0.8, 1]\r\nconst actsel = [0.5, 0.3, 0.8, 1]\r\n\r\nlet mix = (a: INumVector, b: INumVector, fac: number) =>\r\n  new Vector4(a as unknown as Vector4).interp(b as unknown as Vector4, fac)\r\n\r\nexport const ElemColors = [\r\n  [0, 0, 0, 1], //0    0\r\n  sel, //001  1 Select\r\n  act, //010  2 Active\r\n  mix(sel, actsel, 0.25), //011  3 Select+Active\r\n  high, //100  4 Highlight\r\n  mix(high, sel, 0.5), //101  5 Highlight+Select\r\n  mix(high, actsel, 0.5), //110  6 Highlight+Active\r\n  new Vector4(high)\r\n    .add(sel as unknown as Vector4)\r\n    .add(actsel as unknown as Vector4)\r\n    .mulScalar(0.3333), //111  7 Highlight+Select+Active\r\n].map(color => new Vector4(color))\r\n\r\nexport function getElemColor<E extends Element>(list: ElementArray<E>, e: E) {\r\n  let mask = 0\r\n\r\n  if (e.flag & MeshFlags.SELECT) {\r\n    mask |= 1\r\n  }\r\n\r\n  if (e === list.active) {\r\n    mask |= 2\r\n  }\r\n\r\n  if (e === list.highlight) {\r\n    mask |= 4\r\n  }\r\n\r\n  return ElemColors[mask]\r\n}\r\n\r\nexport class Element {\r\n  type: MeshTypes\r\n  flag: MeshFlags\r\n  index: number\r\n  _index: number\r\n  eid: number\r\n\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nmesh.Element {\r\n  type     : int;\r\n  flag     : int;\r\n  index    : int;\r\n  eid      : int;\r\n}`\r\n  )\r\n\r\n  constructor(type: MeshTypes) {\r\n    this.type = type\r\n    this.flag = this.index = 0\r\n    this.eid = -1\r\n    this._index = -1\r\n  }\r\n\r\n  [Symbol.keystr]() {\r\n    return this.eid\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type : this.type,\r\n      flag : this.flag,\r\n      index: this.index,\r\n      eid  : this.eid,\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n  }\r\n}\r\n\r\n//has Vector3 mixin\r\nexport class Vertex extends Element {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nmesh.Vertex {\r\n  co          : ${(MeshVector as any).structName};\r\n  edges       : array(e, int) | e.eid;\r\n}`\r\n  )\r\n\r\n  co: MeshVector\r\n  edges: Edge[]\r\n\r\n  constructor(co?: Vector3) {\r\n    super(MeshTypes.VERTEX)\r\n    this.co = new MeshVector(co)\r\n    this.edges = []\r\n  }\r\n\r\n  get 0(): number {\r\n    debugger\r\n    return NaN\r\n  }\r\n\r\n  get 1(): number {\r\n    debugger\r\n    return NaN\r\n  }\r\n\r\n  get 2(): number {\r\n    debugger\r\n    return NaN\r\n  }\r\n\r\n  otherEdge(e: Edge) {\r\n    if (this.edges.length !== 2) {\r\n      throw new Error('otherEdge only works on 2-valence vertices')\r\n    }\r\n\r\n    if (e === this.edges[0]) return this.edges[1]\r\n    else if (e === this.edges[1]) return this.edges[0]\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n    super.loadSTRUCT(reader)\r\n\r\n    // just in case we saved this.co with a different type of vector\r\n    this.co = new MeshVector(this.co)\r\n  }\r\n}\r\n\r\n//has Vector3 mixin\r\nexport class Handle extends Element {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nmesh.Handle {\r\n  co          : ${(MeshVector as any).structName};\r\n  owner       : int | this.owner ? this.owner.eid : -1;\r\n}`\r\n  )\r\n\r\n  co: Vector3\r\n  owner?: Edge\r\n\r\n  constructor(co: Vector3) {\r\n    super(MeshTypes.HANDLE)\r\n\r\n    this.co = new MeshVector()\r\n\r\n    if (co !== undefined) {\r\n      this.co.load(co)\r\n    }\r\n\r\n    this.owner = undefined\r\n  }\r\n\r\n  get 0() {\r\n    debugger\r\n    return NaN\r\n  }\r\n\r\n  get 1() {\r\n    debugger\r\n    return NaN\r\n  }\r\n\r\n  get 2() {\r\n    debugger\r\n    return NaN\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n    super.loadSTRUCT(reader)\r\n    this.co = new MeshVector(this.co)\r\n  }\r\n}\r\n\r\nconst _evaluate_vs = util.cachering.fromConstructor(MeshVector, 64)\r\nconst _offset_dvs = util.cachering.fromConstructor(MeshVector, 64)\r\nconst _derivative_vs = util.cachering.fromConstructor(MeshVector, 64)\r\nconst _derivative2_vs = util.cachering.fromConstructor(MeshVector, 64)\r\nconst _normal_vs = util.cachering.fromConstructor(MeshVector, 64)\r\n\r\nexport class Edge extends Element {\r\n  h1?: Handle\r\n  h2?: Handle\r\n  v1: Vertex\r\n  v2: Vertex\r\n  l?: Loop\r\n\r\n  constructor() {\r\n    super(MeshTypes.EDGE)\r\n\r\n    this.h1 = this.h2 = undefined\r\n    this.l = undefined\r\n  }\r\n\r\n  get loops() {\r\n    let this2 = this\r\n\r\n    return (function* () {\r\n      if (!this2.l) {\r\n        return\r\n      }\r\n\r\n      let l = this2.l\r\n      let _i = 0\r\n\r\n      do {\r\n        if (_i++ > 100) {\r\n          console.warn('Infinite loop detected!', this2.eid)\r\n          break\r\n        }\r\n\r\n        yield l\r\n\r\n        l = l.radial_next!\r\n      } while (l !== this2.l)\r\n    })()\r\n  }\r\n\r\n  evaluate(t: number) {\r\n    const p = _evaluate_vs.next()\r\n\r\n    if (this.h1) {\r\n      const {v1, h1, h2, v2} = this\r\n\r\n      for (let i = 0; i < p.length; i++) {\r\n        ;(p as unknown as number[])[i] = cubic(\r\n          v1.co[i as 0 | 1],\r\n          h1!.co[i as 0 | 1],\r\n          h2!.co[i as 0 | 1],\r\n          v2.co[i as 0 | 1],\r\n          t\r\n        )\r\n      }\r\n\r\n      return p\r\n    } else {\r\n      return p.load(this.v1.co).interp(this.v2.co, t)\r\n    }\r\n  }\r\n\r\n  derivative(t: number) {\r\n    const p = _derivative_vs.next()\r\n    if (this.h1) {\r\n      const {v1, h1, h2, v2} = this\r\n\r\n      for (let i = 0; i < p.length; i++) {\r\n        p[i as 0 | 1] = dcubic(v1.co[i as 0 | 1], h1!.co[i as 0 | 1], h2!.co[i as 0 | 1], v2.co[i as 0 | 1], t)\r\n      }\r\n    } else {\r\n      return p.load(this.v2.co).sub(this.v1.co)\r\n    }\r\n\r\n    return p\r\n  }\r\n\r\n  derivative2(t: number) {\r\n    const p = _derivative2_vs.next()\r\n\r\n    if (this.h1) {\r\n      const {v1, h1, h2, v2} = this\r\n\r\n      for (let i = 0; i < p.length; i++) {\r\n        p[i as 0 | 1] = d2cubic(v1.co[i as 0 | 1], h1!.co[i as 0 | 1], h2!.co[i as 0 | 1], v2.co[i as 0 | 1], t)\r\n      }\r\n    } else {\r\n      return p.zero()\r\n    }\r\n\r\n    return p\r\n  }\r\n\r\n  normal(t: number) {\r\n    let p = _normal_vs.next().load(this.derivative(t))\r\n\r\n    p.normalize().swapAxes(0, 1)\r\n    p[1] = -p[1]\r\n\r\n    return p\r\n  }\r\n\r\n  offsetDv(t: number, radius: number) {\r\n    let dv = cubicOffsetDv(this.v1.co, this.h1!.co, this.h2!.co, this.v2.co, t, radius)\r\n    return _offset_dvs.next().zero().loadXY(dv[0], dv[1])\r\n  }\r\n\r\n  curvature(t: number) {\r\n    let dv1 = this.derivative(t)\r\n    let dv2 = this.derivative2(t)\r\n\r\n    let ret = (dv1[0] * dv2[1] - dv1[1] * dv2[0]) / Math.pow(dv1.dot(dv1), 3.0 / 2.0)\r\n\r\n    return ret\r\n  }\r\n\r\n  handle(v: Vertex) {\r\n    return v === this.v1 ? this.h1 : this.h2\r\n  }\r\n\r\n  vertex(h: Handle) {\r\n    return h === this.h1 ? this.v1 : this.v2\r\n  }\r\n\r\n  otherVertex(v: Vertex) {\r\n    if (v === undefined) throw new Error('v cannot be undefined in Edge.prototype.otherVertex()')\r\n\r\n    if (v === this.v1) return this.v2\r\n    if (v === this.v2) return this.v1\r\n\r\n    throw new Error('vertex ' + v.eid + ' not in edge')\r\n  }\r\n}\r\n\r\nEdge.STRUCT =\r\n  nstructjs.inherit(Edge, Element, 'mesh.Edge') +\r\n  `\r\n  v1   : int | this.v1.eid;\r\n  v2   : int | this.v2.eid;\r\n  h1   : int | this.h1 ? this.h1.eid : -1;\r\n  h2   : int | this.h2 ? this.h2.eid : -1;\r\n  l    : int | this.l ? this.l.eid : -1;\r\n}`\r\nnstructjs.register(Edge)\r\n\r\nexport class Loop extends Element {\r\n  f: Face\r\n  radial_next?: Loop\r\n  radial_prev?: Loop\r\n  v: Vertex\r\n  e: Edge\r\n  next: Loop\r\n  prev: Loop\r\n  list: LoopList\r\n\r\n  constructor() {\r\n    super(MeshTypes.LOOP)\r\n\r\n    this.radial_next = undefined\r\n    this.radial_prev = undefined\r\n  }\r\n\r\n  evaluate(t: number) {\r\n    if (this.v === this.e.v2) {\r\n      t = 1.0 - t\r\n    }\r\n\r\n    return this.e.evaluate(t)\r\n  }\r\n\r\n  normal(t: number) {\r\n    let sign = 1\r\n    if (this.v === this.e.v2) {\r\n      t = 1.0 - t\r\n      sign = -1\r\n    }\r\n\r\n    return this.e.normal(t).mulScalar(sign)\r\n  }\r\n\r\n  derivative(t: number) {\r\n    let sign = 1\r\n    if (this.v === this.e.v2) {\r\n      t = 1.0 - t\r\n      sign = -1\r\n    }\r\n\r\n    return this.e.derivative(t).mulScalar(sign)\r\n  }\r\n\r\n  derivative2(t: number) {\r\n    let sign = 1\r\n    if (this.v === this.e.v2) {\r\n      t = 1.0 - t\r\n      sign = -1\r\n    }\r\n\r\n    return this.e.derivative2(t).mulScalar(sign)\r\n  }\r\n\r\n  offsetDv(t: number, radius: number) {\r\n    let sign = 1\r\n    if (this.v === this.e.v2) {\r\n      t = 1.0 - t\r\n      sign = -1\r\n    }\r\n\r\n    return this.e.offsetDv(t, radius).mulScalar(sign)\r\n  }\r\n\r\n  get h1() {\r\n    return this.v === this.e.v1 ? this.e.h1 : this.e.h2\r\n  }\r\n\r\n  get h2() {\r\n    return this.v === this.e.v1 ? this.e.h2 : this.e.h1\r\n  }\r\n}\r\n\r\nLoop.STRUCT =\r\n  nstructjs.inherit(Loop, Element, 'mesh.Loop') +\r\n  `\r\n  v : int | this.v.eid;\r\n  e : int | this.e.eid;\r\n}`\r\nnstructjs.register(Loop)\r\n\r\ntype IterStack<T> = {\r\n  [k: number]: T\r\n  cur: number\r\n  length: number\r\n}\r\nexport class LoopListIter {\r\n  private ret: {done: boolean; value: any}\r\n  stack?: IterStack<this>\r\n  l?: Loop\r\n  list?: LoopList\r\n  done: boolean\r\n  i: number\r\n\r\n  constructor() {\r\n    this.ret = {done: false, value: undefined}\r\n    this.stack = undefined\r\n    this.l = undefined\r\n    this.list = undefined\r\n    this.done = false\r\n    this.i = 0\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this\r\n  }\r\n\r\n  reset(list: LoopList, stack: IterStack<this>) {\r\n    this.stack = stack\r\n    this.list = list\r\n    this.done = false\r\n    this.l = list.l\r\n    this.i = 0\r\n\r\n    return this\r\n  }\r\n\r\n  next() {\r\n    let ret = this.ret\r\n\r\n    let l = this.l\r\n\r\n    if (this.i++ > 100000) {\r\n      console.warn('Infinite loop error!')\r\n      return this.finish()\r\n    }\r\n\r\n    if (!l) {\r\n      return this.finish()\r\n    }\r\n\r\n    this.l = this.l!.next\r\n    if (this.l === this.list!.l) {\r\n      this.l = undefined\r\n    }\r\n\r\n    ret.value = l\r\n    ret.done = false\r\n\r\n    return ret\r\n  }\r\n\r\n  finish() {\r\n    if (!this.done) {\r\n      this.list = undefined\r\n      this.l = undefined\r\n      this.ret.value = undefined\r\n      this.ret.done = true\r\n      this.stack!.cur--\r\n      this.done = true\r\n    }\r\n\r\n    return this.ret\r\n  }\r\n\r\n  return() {\r\n    return this.finish()\r\n  }\r\n}\r\n\r\nlet loopstack = new Array(1024) as unknown as IterStack<LoopListIter>\r\nloopstack.cur = 0\r\nfor (let i = 0; i < loopstack.length; i++) {\r\n  loopstack[i] = new LoopListIter()\r\n}\r\n\r\nexport class LoopList extends Element {\r\n  length: number\r\n  _loops?: number[] //used by serialization\r\n  l: Loop\r\n\r\n  constructor() {\r\n    super(MeshTypes.LOOPLIST)\r\n\r\n    this.length = 0\r\n  }\r\n\r\n  get verts() {\r\n    let this2 = this\r\n    return (function* () {\r\n      for (let l of this2) {\r\n        yield l.v\r\n      }\r\n    })()\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return loopstack[loopstack.cur++].reset(this, loopstack)\r\n  }\r\n\r\n  _save_loops() {\r\n    return Array.from(this).map((l) => l.eid)\r\n  }\r\n}\r\n\r\nLoopList.STRUCT =\r\n  nstructjs.inherit(LoopList, Element, 'mesh.LoopList') +\r\n  `\r\n  _loops : iter(int) | this._save_loops();\r\n}\r\n`\r\nnstructjs.register(LoopList)\r\n\r\nexport class Face extends Element {\r\n  lists: LoopList[]\r\n  blur: number\r\n  center: Vector3\r\n  fillColor: Vector4\r\n\r\n  constructor() {\r\n    super(MeshTypes.FACE)\r\n    this.lists = []\r\n    this.blur = 0.0\r\n    this.center = new Vector3()\r\n    this.fillColor = new Vector4([0.5, 0.5, 0.5, 1])\r\n  }\r\n\r\n  get loops() {\r\n    let this2 = this\r\n    let ret = (function* () {\r\n      for (let list of this2.lists) {\r\n        for (let l of list) {\r\n          yield l\r\n        }\r\n      }\r\n    })()\r\n    Object.defineProperty(ret, 'length', {\r\n      get: function () {\r\n        let count = 0\r\n        for (let list of this2.lists) {\r\n          for (let l of list) {\r\n            count++\r\n          }\r\n        }\r\n\r\n        return count\r\n      },\r\n    })\r\n\r\n    return ret\r\n  }\r\n\r\n  get verts() {\r\n    let this2 = this\r\n    let ret = (function* () {\r\n      for (let list of this2.lists) {\r\n        for (let l of list) {\r\n          yield l.v\r\n        }\r\n      }\r\n    })()\r\n\r\n    Object.defineProperty(ret, 'length', {\r\n      get: function () {\r\n        let count = 0\r\n        for (let list of this2.lists) {\r\n          for (let l of list) {\r\n            count++\r\n          }\r\n        }\r\n\r\n        return count\r\n      },\r\n    })\r\n\r\n    return ret\r\n  }\r\n\r\n  calcCenter() {\r\n    this.center.zero()\r\n    let tot = 0\r\n\r\n    for (let l of this.loops) {\r\n      this.center.add(l.v)\r\n      tot++\r\n    }\r\n\r\n    if (tot) {\r\n      this.center.mulScalar(1.0 / tot)\r\n    }\r\n\r\n    return this.center\r\n  }\r\n}\r\n\r\nFace.STRUCT =\r\n  nstructjs.inherit(Face, Element, 'mesh.Face') +\r\n  `\r\n  lists     : iter(list, int) | list.eid;\r\n  fillColor : vec4;\r\n  blur      : float;\r\n}\r\n`\r\nnstructjs.register(Face)\r\n\r\nexport class ElementSetVisibleIter<E extends Element> {\r\n  iter?: Iterator<E>\r\n  set?: ElementSet<E>\r\n\r\n  constructor(set: ElementSet<E>) {\r\n    this.set = set\r\n    this.iter = set[Symbol.iterator]()\r\n  }\r\n\r\n  copy() {\r\n    return new ElementSetVisibleIter(this.set!)\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.copy()\r\n  }\r\n\r\n  next() {\r\n    let ret = this.iter!.next()\r\n    while (!ret.done && ret.value.flag & MeshFlags.HIDE) {\r\n      ret = this.iter!.next()\r\n    }\r\n\r\n    return ret\r\n  }\r\n}\r\n\r\nexport class ElementSet<E extends Element> extends Set<E> {\r\n  type: MeshTypes\r\n\r\n  constructor(type: MeshTypes) {\r\n    super()\r\n    this.type = type\r\n  }\r\n\r\n  get visible() {\r\n    return new ElementSetVisibleIter(this)\r\n  }\r\n\r\n  get editable() {\r\n    return this.visible\r\n  }\r\n\r\n  get length() {\r\n    return this.size\r\n  }\r\n\r\n  remove(item: E) {\r\n    this.delete(item)\r\n  }\r\n}\r\n\r\nexport class ElementListIter<E extends Element> {\r\n  i = 0\r\n  list: (E | undefined)[] | null = null\r\n  ret = {done: true, value: undefined} as IteratorResult<E>\r\n\r\n  constructor(list: (E | undefined)[]) {\r\n    this.reset(list)\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.copy().reset(this.list!)\r\n  }\r\n\r\n  copy() {\r\n    return new VisibleIter(this.list!)\r\n  }\r\n\r\n  reset(list: (E | undefined)[]) {\r\n    this.list = list\r\n    this.i = 0\r\n\r\n    this.skipInvalid()\r\n\r\n    return this\r\n  }\r\n\r\n  invalidElem(e: E) {\r\n    return false\r\n  }\r\n\r\n  skipInvalid() {\r\n    let list = this.list!\r\n\r\n    while (this.i < list.length) {\r\n      if (list[this.i] !== undefined && !this.invalidElem(list[this.i]!)) {\r\n        break\r\n      }\r\n\r\n      this.i++\r\n    }\r\n  }\r\n\r\n  next() {\r\n    if (this.i >= this.list!.length) {\r\n      this.ret.value = undefined\r\n      this.ret.done = true\r\n\r\n      return this.ret as IteratorResult<E>\r\n    }\r\n\r\n    this.ret.value = this.list![this.i]\r\n    this.ret.done = false\r\n\r\n    this.i++\r\n    this.skipInvalid()\r\n\r\n    return this.ret as IteratorResult<E>\r\n  }\r\n}\r\n\r\nclass VisibleIter<E extends Element> extends ElementListIter<E> {\r\n  invalidElem(e: E) {\r\n    return !!(e.flag & MeshFlags.HIDE)\r\n  }\r\n}\r\n\r\nexport class ElementArray<E extends Element> {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\n  mesh.ElementArray {\r\n    this        : iter(abstract(mesh.Element));\r\n    highlight   : int | this.highlight ? this.highlight.eid : -1;\r\n    active      : int | this.active ? this.active.eid : -1;\r\n    type        : int;\r\n  }\r\n  `\r\n  )\r\n\r\n  list: (E | undefined)[]\r\n  length: number\r\n  type: MeshTypes\r\n  selected: ElementSet<E>\r\n  on_selected?: (...args: any[]) => void\r\n  highlight?: E\r\n  active?: E\r\n  freelist: number[]\r\n\r\n  constructor(type: MeshTypes) {\r\n    this.list = []\r\n    this.length = 0\r\n    this.type = type\r\n    this.selected = new ElementSet(type)\r\n    this.on_selected = undefined\r\n    this.highlight = this.active = undefined\r\n    this.freelist = []\r\n  }\r\n\r\n  get visible() {\r\n    return new VisibleIter(this.list)\r\n  }\r\n\r\n  get editable() {\r\n    return this.visible\r\n  }\r\n\r\n  [Symbol.iterator](): Iterator<E> {\r\n    return new ElementListIter<E>(this.list)\r\n  }\r\n\r\n  concat(b: Iterable<E>) {\r\n    let ret = []\r\n\r\n    for (let item of this) {\r\n      ret.push(item)\r\n    }\r\n\r\n    for (let item of b) {\r\n      ret.push(item)\r\n    }\r\n\r\n    return ret\r\n  }\r\n\r\n  toJSON() {\r\n    let arr = []\r\n\r\n    for (let item of this) {\r\n      arr.push(item)\r\n    }\r\n\r\n    let sel = []\r\n    for (let v of this.selected) {\r\n      sel.push(v.eid)\r\n    }\r\n\r\n    return {\r\n      type     : this.type,\r\n      array    : arr,\r\n      selected : sel,\r\n      active   : this.active !== undefined ? this.active.eid : -1,\r\n      highlight: this.highlight !== undefined ? this.highlight.eid : -1,\r\n    }\r\n  }\r\n\r\n  push(e: E) {\r\n    e._index = this.list.length\r\n    this.list.push(e)\r\n    this.length++\r\n\r\n    if (e.flag & MeshFlags.SELECT) {\r\n      this.selected.add(e)\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  remove(e: E) {\r\n    if (this.selected.has(e)) {\r\n      this.selected.remove(e)\r\n    }\r\n\r\n    if (this.active === e) this.active = undefined\r\n    if (this.highlight === e) this.highlight = undefined\r\n\r\n    if (e._index < 0 || this.list[e._index] !== e) {\r\n      throw new Error('element not in array')\r\n    }\r\n\r\n    this.freelist.push(e._index)\r\n\r\n    this.list[e._index] = undefined\r\n    e._index = -1\r\n    this.length--\r\n\r\n    //super.remove(v);\r\n\r\n    return this\r\n  }\r\n\r\n  selectNone() {\r\n    for (let e of this) {\r\n      this.setSelect(e, false)\r\n    }\r\n  }\r\n\r\n  selectAll() {\r\n    for (let e of this) {\r\n      this.setSelect(e, true)\r\n    }\r\n  }\r\n\r\n  setSelect(e: E, state: boolean) {\r\n    if (state) {\r\n      e.flag |= MeshFlags.SELECT\r\n\r\n      this.selected.add(e)\r\n    } else {\r\n      e.flag &= ~MeshFlags.SELECT\r\n\r\n      this.selected.remove(e)\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n\r\n    for (let elem of this) {\r\n      if (elem.flag & MeshFlags.SELECT) {\r\n        this.selected.add(elem)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport class Mesh {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\n  mesh.Mesh {\r\n    elists : array(mesh.ElementArray) | this.getElists();\r\n    eidgen : IDGen;  \r\n  }\r\n  `\r\n  )\r\n\r\n  eidgen: IDGen\r\n  eidMap: Map<number, Element>\r\n  verts: ElementArray<Vertex>\r\n  handles: ElementArray<Handle>\r\n  edges: ElementArray<Edge>\r\n  loops: ElementArray<Loop>\r\n  lists: ElementArray<LoopList>\r\n  faces: ElementArray<Face>\r\n  elists: {\r\n    [k: number]: ElementArray<Element>\r\n  }\r\n  features: MeshFeatures\r\n\r\n  private structureGen = 0\r\n\r\n  constructor() {\r\n    this.eidgen = new util.IDGen()\r\n    this.eidMap = new Map()\r\n\r\n    this.elists = {}\r\n\r\n    this.makeElists()\r\n\r\n    this.features = 0\r\n\r\n    if (config.MESH_HANDLES) {\r\n      this.features |= MeshFeatures.HANDLES\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.elists = {}\r\n    this.eidMap = new Map()\r\n    this.makeElists()\r\n\r\n    return this\r\n  }\r\n\r\n  get haveHandles() {\r\n    return this.features & MeshFeatures.HANDLES\r\n  }\r\n\r\n  get elements() {\r\n    return this.eidMap.values()\r\n  }\r\n\r\n  get hasHighlight() {\r\n    for (let k in this.elists) {\r\n      if (this.elists[k].highlight) {\r\n        return true\r\n      }\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  getElists() {\r\n    let ret = []\r\n\r\n    for (let k in this.elists) {\r\n      ret.push(this.elists[k])\r\n    }\r\n\r\n    return ret\r\n  }\r\n\r\n  addElistAliases() {\r\n    this.verts = this.elists[MeshTypes.VERTEX] as ElementArray<Vertex>\r\n    this.handles = this.elists[MeshTypes.HANDLE] as ElementArray<Handle>\r\n    this.edges = this.elists[MeshTypes.EDGE] as ElementArray<Edge>\r\n    this.loops = this.elists[MeshTypes.LOOP] as ElementArray<Loop>\r\n    this.lists = this.elists[MeshTypes.LOOPLIST] as ElementArray<LoopList>\r\n    this.faces = this.elists[MeshTypes.FACE] as ElementArray<Face>\r\n  }\r\n\r\n  makeElists() {\r\n    for (let k in MeshTypes) {\r\n      if (typeof k === 'string' && isNaN(parseFloat(k))) {\r\n        let type = parseInt(MeshTypes[k])\r\n        this.elists[type] = new ElementArray(type)\r\n      }\r\n    }\r\n\r\n    this.addElistAliases()\r\n  }\r\n\r\n  _element_init(e: Element) {\r\n    e.eid = this.eidgen.next()\r\n    this.eidMap.set(e.eid, e)\r\n  }\r\n\r\n  setActive(elem: Element | undefined) {\r\n    if (!elem) {\r\n      for (let k in this.elists) {\r\n        this.elists[k].active = undefined\r\n      }\r\n    } else {\r\n      this.elists[elem.type].active = elem\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  setHighlight(elem: Element | undefined) {\r\n    let ret = false\r\n\r\n    if (!elem) {\r\n      for (let k in this.elists) {\r\n        ret = ret || this.elists[k].highlight !== undefined\r\n        this.elists[k].highlight = undefined\r\n      }\r\n    } else {\r\n      ret = this.elists[elem.type].highlight !== elem\r\n      this.elists[elem.type].highlight = elem\r\n    }\r\n\r\n    return ret\r\n  }\r\n\r\n  makeVertex(co: Vector3): Vertex {\r\n    let v = new Vertex(co instanceof Vertex || co instanceof Handle ? co.co : co)\r\n\r\n    this._element_init(v)\r\n    this.verts.push(v)\r\n\r\n    return v\r\n  }\r\n\r\n  makeHandle(co: Vector3): Handle {\r\n    let h = new Handle(co)\r\n    this._element_init(h)\r\n    this.handles.push(h)\r\n    return h\r\n  }\r\n\r\n  getEdge(v1: Vertex, v2: Vertex): Edge | undefined {\r\n    for (let e of v1.edges) {\r\n      if (e.otherVertex(v1) === v2) return e\r\n    }\r\n\r\n    return undefined\r\n  }\r\n\r\n  ensureEdge(v1: Vertex, v2: Vertex) {\r\n    let e = this.getEdge(v1, v2)\r\n\r\n    if (!e) {\r\n      e = this.makeEdge(v1, v2)\r\n    }\r\n\r\n    return e\r\n  }\r\n\r\n  makeEdge(v1: Vertex, v2: Vertex) {\r\n    let e = new Edge()\r\n\r\n    e.v1 = v1\r\n    e.v2 = v2\r\n\r\n    if (this.features & MeshFeatures.HANDLES) {\r\n      e.h1 = this.makeHandle(v1.co)\r\n      e.h1.co.interp(v2.co, 1.0 / 2.0)\r\n      e.h1.owner = e\r\n\r\n      e.h2 = this.makeHandle(v1.co)\r\n      e.h2.co.interp(v2.co, 2.0 / 3.0)\r\n      e.h2.owner = e\r\n    }\r\n\r\n    v1.edges.push(e)\r\n    v2.edges.push(e)\r\n\r\n    this._element_init(e)\r\n    this.edges.push(e)\r\n\r\n    return e\r\n  }\r\n\r\n  killVertex(v: Vertex) {\r\n    if (v.eid === -1) {\r\n      console.trace('Warning: vertex', v.eid, 'already freed', v)\r\n      return\r\n    }\r\n\r\n    let _i = 0\r\n\r\n    while (v.edges.length > 0) {\r\n      this.killEdge(v.edges[0])\r\n\r\n      if (_i++ >= 100) {\r\n        console.warn('mesh integrity warning, infinite loop detected in killVertex')\r\n      }\r\n    }\r\n\r\n    this.eidMap.delete(v.eid)\r\n    this.verts.remove(v)\r\n\r\n    v.eid = -1\r\n  }\r\n\r\n  killEdge(e: Edge) {\r\n    if (e.eid === -1) {\r\n      console.trace('Warning: edge', e.eid, 'already freed', e)\r\n      return\r\n    }\r\n\r\n    let _i = 0\r\n    while (e.l) {\r\n      this.killFace(e.l.f)\r\n\r\n      if (_i++ > 1000) {\r\n        console.log('infinite loop detected')\r\n        break\r\n      }\r\n    }\r\n\r\n    this.edges.remove(e)\r\n    this.eidMap.delete(e.eid)\r\n\r\n    if (this.features & MeshFeatures.HANDLES) {\r\n      this.eidMap.delete(e.h1!.eid)\r\n      this.handles.remove(e.h1!)\r\n\r\n      this.eidMap.delete(e.h2!.eid)\r\n      this.handles.remove(e.h2!)\r\n    }\r\n\r\n    e.eid = -1\r\n\r\n    e.v1.edges.remove(e)\r\n    e.v2.edges.remove(e)\r\n  }\r\n\r\n  radialLoopRemove(e: Edge, l: Loop) {\r\n    if (e.l === l) {\r\n      e.l = e.l.radial_next\r\n    }\r\n\r\n    if (e.l === l) {\r\n      e.l = undefined\r\n      return\r\n    }\r\n\r\n    l.radial_next!.radial_prev = l.radial_prev\r\n    l.radial_prev!.radial_next = l.radial_next\r\n  }\r\n\r\n  radialLoopInsert(e: Edge, l: Loop) {\r\n    if (!e.l) {\r\n      e.l = l\r\n      l.radial_next = l.radial_prev = l\r\n    } else {\r\n      l.radial_prev = e.l\r\n      l.radial_next = e.l.radial_next\r\n\r\n      e.l.radial_next!.radial_prev = l\r\n      e.l.radial_next = l\r\n    }\r\n  }\r\n\r\n  _killList(list: LoopList) {\r\n    this.eidMap.delete(list.eid)\r\n    this.lists.remove(list)\r\n    list.eid = -1\r\n  }\r\n\r\n  killFace(f: Face) {\r\n    for (let list of f.lists) {\r\n      for (let l of list) {\r\n        this.radialLoopRemove(l.e, l)\r\n\r\n        this._killLoop(l)\r\n      }\r\n\r\n      this._killList(list)\r\n    }\r\n\r\n    this.eidMap.delete(f.eid)\r\n    this.faces.remove(f)\r\n    f.eid = -1\r\n  }\r\n\r\n  addLoopList(f: Face, vs: Vertex[]) {\r\n    let list = new LoopList()\r\n    this._element_init(list)\r\n    this.lists.push(list)\r\n\r\n    let lastl, firstl\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i],\r\n        v2 = vs[(i + 1) % vs.length]\r\n\r\n      let e = this.getEdge(v1, v2)\r\n      if (!e) {\r\n        e = this.makeEdge(v1, v2)\r\n      }\r\n\r\n      let l = new Loop()\r\n      this._element_init(l)\r\n      this.loops.push(l)\r\n\r\n      l.v = v1\r\n      l.e = e\r\n      l.f = f\r\n      l.list = list\r\n\r\n      this.radialLoopInsert(e, l)\r\n\r\n      if (!firstl) {\r\n        firstl = l\r\n      } else {\r\n        lastl!.next = l\r\n        l!.prev = lastl!\r\n      }\r\n\r\n      lastl = l\r\n    }\r\n\r\n    firstl!.prev = lastl!\r\n    lastl!.next = firstl!\r\n\r\n    list.l = firstl!\r\n\r\n    f.lists.push(list)\r\n  }\r\n\r\n  makeFace(vs: Vertex[]): Face {\r\n    let f = new Face()\r\n    this._element_init(f)\r\n    this.faces.push(f)\r\n\r\n    let list = new LoopList()\r\n    this._element_init(list)\r\n    this.lists.push(list)\r\n\r\n    let lastl, firstl\r\n\r\n    for (let i = 0; i < vs.length; i++) {\r\n      let v1 = vs[i],\r\n        v2 = vs[(i + 1) % vs.length]\r\n\r\n      let e = this.getEdge(v1, v2)\r\n      if (!e) {\r\n        e = this.makeEdge(v1, v2)\r\n      }\r\n\r\n      let l = new Loop()\r\n      this._element_init(l)\r\n      this.loops.push(l)\r\n\r\n      l.v = v1\r\n      l.e = e\r\n      l.f = f\r\n      l.list = list\r\n\r\n      this.radialLoopInsert(e, l)\r\n\r\n      if (!firstl) {\r\n        firstl = l\r\n      } else {\r\n        lastl!.next = l\r\n        l.prev = lastl!\r\n      }\r\n\r\n      lastl = l\r\n      list.length++\r\n    }\r\n\r\n    firstl!.prev = lastl!\r\n    lastl!.next = firstl!\r\n\r\n    list.l = firstl!\r\n\r\n    f.lists.push(list)\r\n    return f\r\n    /*\r\n      f           : this.f.eid,\r\n      radial_next : this.radial_next.eid,\r\n      radial_prev : this.radial_prev.eid,\r\n      v           : this.v.eid,\r\n      e           : this.e.eid,\r\n      next        : this.next.eid,\r\n      prev        : this.prev.eid,\r\n      list        : this.list.eid\r\n    */\r\n  }\r\n\r\n  selectFlush(selmode: MeshTypes) {\r\n    if (selmode & MeshTypes.VERTEX) {\r\n      this.edges.selectNone()\r\n      this.faces.selectNone()\r\n\r\n      let set_active = this.edges.active === undefined\r\n      set_active =\r\n        set_active || !(this.edges.active && (this.edges.active.v1.flag | this.edges.active.v2.flag) & MeshFlags.SELECT)\r\n\r\n      for (let e of this.edges) {\r\n        if (e.v1.flag & MeshFlags.SELECT && e.v2.flag & MeshFlags.SELECT) {\r\n          this.edges.setSelect(e, true)\r\n\r\n          if (this.features & MeshFeatures.HANDLES) {\r\n            this.handles.setSelect(e.h1!, true)\r\n            this.handles.setSelect(e.h2!, true)\r\n          }\r\n\r\n          if (set_active) {\r\n            this.edges.active = e\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let f of this.faces) {\r\n        let ok = true\r\n\r\n        for (let l of f.loops) {\r\n          if (!(l.e.flag & MeshFlags.SELECT)) {\r\n            ok = false\r\n            break\r\n          }\r\n        }\r\n\r\n        if (ok) {\r\n          this.faces.setSelect(f, true)\r\n        }\r\n      }\r\n    } else if (selmode & MeshTypes.EDGE) {\r\n      this.verts.selectNone()\r\n\r\n      for (let v of this.verts) {\r\n        for (let e of v.edges) {\r\n          if (e.flag & MeshFlags.SELECT) {\r\n            this.verts.setSelect(v, true)\r\n            break\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  reverseEdge(e: Edge) {\r\n    let tmp = e.v1\r\n    e.v1 = e.v2\r\n    e.v2 = tmp\r\n\r\n    if (e.h1) {\r\n      let tmp2 = e.h1\r\n      e.h1 = e.h2\r\n      e.h2 = tmp2\r\n    }\r\n  }\r\n\r\n  splitEdgeMulti(e: Edge, steps: number) {\r\n    let n = steps + 1\r\n\r\n    for (let i = 0; i < steps; i++) {\r\n      let t = 1.0 / n\r\n      n--\r\n\r\n      e = this.splitEdge(e, t)[0]\r\n    }\r\n  }\r\n\r\n  splitEdge(e: Edge, t = 0.5): [Edge, Vertex] {\r\n    let nv = this.makeVertex(e.evaluate(t))\r\n    let ne = this.makeEdge(nv, e.v2)\r\n\r\n    if (this.features & MeshFeatures.HANDLES) {\r\n      let dv1 = e.derivative(0.0).mulScalar(1.0 / 3.0)\r\n      let dv2 = e.derivative(t).mulScalar(1.0 / 3.0)\r\n      let dv3 = e.derivative(1.0).mulScalar(1.0 / 3.0)\r\n\r\n      e.h1!.co.load(dv1).mulScalar(t).add(e.v1.co)\r\n      e.h2!.co.load(dv2).mulScalar(-t).add(nv.co)\r\n      ne.h1!.co.load(dv2)\r\n        .mulScalar(1.0 - t)\r\n        .add(ne.v1.co)\r\n      ne.h2!.co.load(dv3)\r\n        .mulScalar(t - 1.0)\r\n        .add(ne.v2.co)\r\n    }\r\n\r\n    e.v2.edges.remove(e)\r\n    e.v2 = nv\r\n    nv.edges.push(e)\r\n\r\n    if (e.flag & MeshFlags.SELECT) {\r\n      this.edges.setSelect(ne, true)\r\n      this.verts.setSelect(nv, true)\r\n    }\r\n\r\n    if (e.l) {\r\n      let l = e.l\r\n      let ls = []\r\n      let _i = 0\r\n      do {\r\n        if (_i++ > 10) {\r\n          console.warn('infinite loop detected')\r\n          break\r\n        }\r\n\r\n        ls.push(l)\r\n        l = l.radial_next!\r\n      } while (l !== e.l)\r\n\r\n      for (let l of ls) {\r\n        let l2 = new Loop()\r\n        this._element_init(l2)\r\n        this.loops.push(l2)\r\n\r\n        l2.f = l.f\r\n        l2.list = l.list\r\n\r\n        if (l.v === e.v1) {\r\n          l2.v = nv\r\n          l2.e = ne\r\n          l2.prev = l\r\n          l2.next = l.next\r\n          l.next.prev = l2\r\n          l.next = l2\r\n\r\n          this.radialLoopInsert(ne, l2)\r\n        } else {\r\n          this.radialLoopRemove(e, l)\r\n\r\n          l2.v = nv\r\n          l.e = ne\r\n          l2.e = e\r\n\r\n          this.radialLoopInsert(ne, l)\r\n          this.radialLoopInsert(e, l2)\r\n\r\n          l.next.prev = l2\r\n          l2.prev = l\r\n          l2.next = l.next\r\n          l.next = l2\r\n\r\n          /*\r\n         v1 <--l2--<--l--- v2\r\n             --e1--|--ne--\r\n             --l--->--l2-->\r\n\r\n          */\r\n        }\r\n      }\r\n    }\r\n\r\n    return [ne, nv]\r\n  }\r\n\r\n  copyElemData<E extends Element>(dst: E, src: E) {\r\n    this.setSelect(dst, !!(src.flag & MeshFlags.SELECT))\r\n    dst.flag = src.flag\r\n\r\n    if (dst instanceof Vertex || dst instanceof Handle) {\r\n      dst.co.load((src as unknown as Vertex).co)\r\n    }\r\n  }\r\n\r\n  validate() {\r\n    let ls = new Set<Loop>()\r\n\r\n    for (let f of this.faces) {\r\n      for (let l of f.loops) {\r\n        ls.add(l)\r\n      }\r\n    }\r\n\r\n    for (let l of ls) {\r\n      this.radialLoopRemove(l.e, l)\r\n    }\r\n\r\n    for (let l of this.loops) {\r\n      if (!ls.has(l)) {\r\n        console.warn('Orphaned loop')\r\n        this._killLoop(l)\r\n      }\r\n    }\r\n\r\n    for (let l of ls) {\r\n      let e = l.e\r\n      l.e = this.ensureEdge(l.v, l.next.v)\r\n\r\n      if (l.e !== e) {\r\n        console.warn('Loop had wrong edge')\r\n      }\r\n\r\n      this.radialLoopInsert(l.e, l)\r\n    }\r\n\r\n    this.structureGen++\r\n  }\r\n\r\n  reverseWinding(f: Face) {\r\n    for (let list of f.lists) {\r\n      for (let l of list) {\r\n        this.radialLoopRemove(l.e, l)\r\n      }\r\n    }\r\n\r\n    for (let list of f.lists) {\r\n      let es = []\r\n\r\n      let ls = []\r\n      for (let l of new Set(list)) {\r\n        let t = l.next\r\n        l.next = l.prev\r\n        l.prev = t\r\n\r\n        es.push(l.e)\r\n        ls.push(l)\r\n      }\r\n\r\n      let i = 0\r\n      for (let l of ls) {\r\n        l.e = es[(i - 1 + es.length) % es.length]\r\n        i++\r\n      }\r\n    }\r\n\r\n    for (let list of f.lists) {\r\n      for (let l of list) {\r\n        this.radialLoopInsert(l.e, l)\r\n      }\r\n    }\r\n  }\r\n\r\n  clearHighlight() {\r\n    let exist = this.hasHighlight\r\n\r\n    for (let k in this.elists) {\r\n      this.elists[k].highlight = undefined\r\n    }\r\n\r\n    return exist\r\n  }\r\n\r\n  unlinkFace(f: Face) {\r\n    for (let list of f.lists) {\r\n      for (let l of list) {\r\n        this.radialLoopRemove(l.e, l)\r\n      }\r\n    }\r\n  }\r\n\r\n  linkFace(f: Face, forceRelink = true) {\r\n    for (let list of f.lists) {\r\n      for (let l of list) {\r\n        if (forceRelink || !l.e) {\r\n          l.e = this.getEdge(l.v, l.next.v)\r\n\r\n          if (!l.e) {\r\n            l.e = this.makeEdge(l.v, l.next.v)\r\n          }\r\n        }\r\n\r\n        this.radialLoopInsert(l.e, l)\r\n      }\r\n    }\r\n  }\r\n\r\n  _killLoop(l: Loop) {\r\n    this.eidMap.delete(l.eid)\r\n    this.loops.remove(l)\r\n    l.eid = -1\r\n  }\r\n\r\n  dissolveVertex(v: Vertex) {\r\n    if (v.edges.length !== 2) {\r\n      throw new Error(\"can't dissolve vertex with more than two edges\")\r\n    }\r\n\r\n    let loops = new Set<Loop>()\r\n    let faces = new Set<Face>()\r\n\r\n    for (let e of v.edges) {\r\n      for (let l of e.loops) {\r\n        if (l.v !== v) {\r\n          l = l.next\r\n        }\r\n\r\n        loops.add(l)\r\n        faces.add(l.f)\r\n      }\r\n    }\r\n\r\n    for (let f of faces) {\r\n      this.unlinkFace(f)\r\n    }\r\n\r\n    for (let l of loops) {\r\n      if (l.v !== v) {\r\n        l = l.next\r\n      }\r\n\r\n      l.prev.next = l.next\r\n      l.next.prev = l.prev\r\n\r\n      if (l === l.list.l) {\r\n        l.list.l = l.list.l.next\r\n      }\r\n\r\n      if (l === l.list.l) {\r\n        console.warn('Destroying face')\r\n\r\n        l.f.lists.remove(l.list)\r\n        this._killList(l.list)\r\n\r\n        if (l.f.lists.length === 0) {\r\n          faces.delete(l.f)\r\n          this.killFace(l.f)\r\n          continue\r\n        }\r\n      } else {\r\n        l.list.length--\r\n      }\r\n\r\n      this._killLoop(l)\r\n    }\r\n\r\n    let e1 = v.edges[0],\r\n      e2 = v.edges[1]\r\n    let v1 = e1.otherVertex(v),\r\n      v2 = e2.otherVertex(v)\r\n\r\n    let flag = (e1.flag | e2.flag) & ~MeshFlags.HIDE\r\n\r\n    this.killVertex(v)\r\n    if (1) {\r\n      let e3 = this.makeEdge(v1, v2)\r\n\r\n      if (flag & MeshFlags.SELECT) {\r\n        this.edges.setSelect(e3, true)\r\n      }\r\n\r\n      e3.flag |= flag\r\n    }\r\n\r\n    for (let f of faces) {\r\n      this.linkFace(f, true)\r\n    }\r\n  }\r\n\r\n  getList(type: MeshTypes) {\r\n    return this.elists[type]\r\n  }\r\n\r\n  setSelect(e: Element, state: boolean) {\r\n    this.getList(e.type).setSelect(e, state)\r\n  }\r\n\r\n  selectNone() {\r\n    for (let k in this.elists) {\r\n      this.elists[k].selectNone()\r\n    }\r\n  }\r\n\r\n  selectAll() {\r\n    for (let k in this.elists) {\r\n      this.elists[k].selectAll()\r\n    }\r\n  }\r\n\r\n  regen_render() {\r\n    window.redraw_all()\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n\r\n    let elists = this.elists as unknown as ElementArray<Element>[]\r\n    this.elists = {}\r\n\r\n    for (let elist of elists) {\r\n      this.elists[elist.type] = elist\r\n    }\r\n\r\n    this.addElistAliases()\r\n\r\n    let eidMap = (this.eidMap = new Map<number, Element>())\r\n\r\n    for (let list of this.getElists()) {\r\n      for (let elem of list) {\r\n        eidMap.set(elem.eid, elem)\r\n      }\r\n    }\r\n\r\n    for (let v of this.verts) {\r\n      for (let i = 0; i < v.edges.length; i++) {\r\n        v.edges[i] = eidMap.get(v.edges[i] as unknown as number)! as Edge\r\n      }\r\n    }\r\n\r\n    for (let h of this.handles) {\r\n      h.owner = eidMap.get(h.owner as unknown as number) as Edge\r\n    }\r\n\r\n    let eloops = new Map<Edge, Loop>()\r\n\r\n    for (let e of this.edges) {\r\n      e.v1 = eidMap.get(e.v1 as unknown as number) as Vertex\r\n      e.v2 = eidMap.get(e.v2 as unknown as number) as Vertex\r\n      e.h1 = eidMap.get(e.h1 as unknown as number) as Handle\r\n      e.h2 = eidMap.get(e.h2 as unknown as number) as Handle\r\n      eloops.set(e, eidMap.get(e.l as unknown as number) as Loop)\r\n      e.l = undefined\r\n\r\n      if (e.h1) {\r\n        this.features |= MeshFeatures.HANDLES\r\n      }\r\n    }\r\n\r\n    for (let l of this.loops) {\r\n      l.v = eidMap.get(l.v as unknown as number) as Vertex\r\n      l.e = eidMap.get(l.e as unknown as number) as Edge\r\n    }\r\n\r\n    for (let list of this.lists) {\r\n      let loops = list._loops!.map((l) => eidMap.get(l)!) as Loop[]\r\n      list._loops = undefined\r\n\r\n      list.l = loops[0]\r\n\r\n      for (let i = 0; i < loops.length; i++) {\r\n        let l1 = loops[(i - 1 + loops.length) % loops.length]\r\n        let l2 = loops[i]\r\n        let l3 = loops[(i + 1) % loops.length]\r\n\r\n        l1.next = l2\r\n        l2.prev = l1\r\n        l2.next = l3\r\n        l3.prev = l2\r\n      }\r\n    }\r\n\r\n    for (let f of this.faces) {\r\n      for (let i = 0; i < f.lists.length; i++) {\r\n        f.lists[i] = eidMap.get(f.lists[i] as unknown as number) as LoopList\r\n      }\r\n\r\n      for (let list of f.lists) {\r\n        list.length = 0\r\n\r\n        for (let l of list) {\r\n          l.f = f\r\n          l.list = list\r\n          this.radialLoopInsert(l.e, l)\r\n          list.length++\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let [e, l] of eloops) {\r\n      e.l = l\r\n    }\r\n\r\n    for (let elist of this.getElists()) {\r\n      elist.active = eidMap.get(elist.active as unknown as number)\r\n      elist.highlight = eidMap.get(elist.highlight as unknown as number)\r\n    }\r\n  }\r\n}\r\n", "import {\r\n  simple,\r\n  nstructjs,\r\n  util,\r\n  math,\r\n  Vector2,\r\n  UIBase,\r\n  Icons,\r\n  KeyMap,\r\n  haveModal,\r\n  ToolOp,\r\n  ToolClasses,\r\n  HotKey,\r\n  createMenu,\r\n  startMenu,\r\n  saveUIData,\r\n  loadUIData,\r\n  Container,\r\n  Vec2Property,\r\n  DataAPI,\r\n  DataStruct,\r\n} from '../path.ux/pathux.js'\r\nimport config from '../config/config.js'\r\n\r\nimport {PickData, ToolModeBase} from '../toolmode/toolmode_base'\r\nimport {MeshVector, MeshTypes, MeshFlags, ElementArray, Element, Handle, Vertex} from './mesh'\r\nimport {Context} from './context.js'\r\n\r\nlet pick_cachering = util.cachering.fromConstructor(PickData, 32)\r\n\r\nexport class LoadDefaultsOp extends ToolOp<{}, {}, Context> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Load Defaults',\r\n      toolpath: 'app.load_defaults',\r\n      inputs  : {},\r\n      outputs : {},\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    //ctx.state.createNewFile(true);\r\n    ctx.state.loadStartupFile()\r\n    window.redraw_all()\r\n  }\r\n}\r\n\r\nToolOp.register(LoadDefaultsOp)\r\n\r\nexport class Workspace extends simple.Editor<Context> {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nWorkspace {\r\n}\r\n  `\r\n  )\r\n\r\n  toolModePanel: Container<Context>\r\n  oldToolMode: ToolModeBase | undefined\r\n  canvas: HTMLCanvasElement\r\n  g: CanvasRenderingContext2D\r\n  mpos: Vector2\r\n\r\n  constructor() {\r\n    super()\r\n\r\n    this.canvas = document.createElement('canvas')\r\n    this.g = this.canvas.getContext('2d')!\r\n\r\n    this.mpos = new Vector2()\r\n\r\n    this.shadow.appendChild(this.canvas)\r\n\r\n    this.keymap = new KeyMap()\r\n\r\n    this.keymap.add(new HotKey('W', [], 'mesh.vertex_smooth'))\r\n    this.keymap.add(\r\n      new HotKey('Space', [], () => {\r\n        let menu = []\r\n\r\n        for (let cls of ToolClasses) {\r\n          let def = cls.tooldef()\r\n\r\n          menu.push(def.toolpath)\r\n        }\r\n\r\n        menu = createMenu(this.ctx, 'Find Tool', menu)\r\n\r\n        let mpos = this.ctx.screen.mpos\r\n        startMenu(menu, mpos[0], mpos[1], true)\r\n\r\n        console.log(menu)\r\n      })\r\n    )\r\n\r\n    let eventBad = (e: PointerEvent) => {\r\n      if (haveModal(e)) {\r\n        return true\r\n      }\r\n\r\n      let elem = this.ctx.screen.pickElement(e.x, e.y)\r\n      return elem && elem !== this && elem !== this.canvas\r\n    }\r\n\r\n    this.addEventListener('pointerover', (e) => {\r\n      let mpos = this.getLocalMouse(e.x, e.y)\r\n      this.mpos.load(mpos)\r\n    })\r\n\r\n    this.addEventListener('pointerdown', (e) => {\r\n      let mpos = this.getLocalMouse(e.x, e.y)\r\n      this.mpos.load(mpos)\r\n\r\n      if (eventBad(e)) {\r\n        return\r\n      }\r\n\r\n      this.toolmode.on_mousedown(mpos[0], mpos[1], e)\r\n    })\r\n\r\n    this.addEventListener('pointermove', (e) => {\r\n      let mpos = this.getLocalMouse(e.x, e.y)\r\n      this.mpos.load(mpos)\r\n\r\n      if (eventBad(e)) {\r\n        return\r\n      }\r\n\r\n      this.toolmode.on_mousemove(mpos[0], mpos[1], e)\r\n    })\r\n\r\n    this.addEventListener('pointerup', (e) => {\r\n      let mpos = this.getLocalMouse(e.x, e.y)\r\n      this.mpos.load(mpos)\r\n\r\n      if (eventBad(e)) {\r\n        return\r\n      }\r\n\r\n      this.toolmode.on_mouseup(mpos[0], mpos[1], e)\r\n    })\r\n  }\r\n\r\n  get toolmode() {\r\n    return this.ctx!.toolmode\r\n  }\r\n\r\n  static defineAPI(api: DataAPI, st: DataStruct) {\r\n    return st\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname : 'workspace-editor-x',\r\n      areaname: 'workspace-editor-x',\r\n      uiname  : 'Workspace',\r\n    }\r\n  }\r\n\r\n  getGlobalMouse(x: number, y: number): Vector2 {\r\n    let mpos = new Vector2()\r\n    let r = this.canvas.getBoundingClientRect()\r\n\r\n    let dpi = UIBase.getDPI()\r\n\r\n    mpos[0] = x / dpi + r.x\r\n    mpos[1] = y / dpi + r.y\r\n\r\n    return mpos\r\n  }\r\n\r\n  getLocalMouse(x: number, y: number): Vector2 {\r\n    let mpos = new Vector2()\r\n    let r = this.canvas.getBoundingClientRect()\r\n\r\n    let dpi = UIBase.getDPI()\r\n\r\n    mpos[0] = (x - r.x) * dpi\r\n    mpos[1] = (y - r.y) * dpi\r\n\r\n    return mpos\r\n  }\r\n\r\n  getKeyMaps() {\r\n    if (this.toolmode) {\r\n      return [this.keymap!, this.toolmode.keymap]\r\n    } else {\r\n      return [this.keymap!]\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init()\r\n\r\n    let header = this.header\r\n    let row\r\n\r\n    row = header.row()\r\n    row.iconbutton(Icons.UNDO, 'Undo', () => {\r\n      this.ctx.toolstack.undo()\r\n    })\r\n    row.iconbutton(Icons.REDO, 'Redo', () => {\r\n      this.ctx.toolstack.redo()\r\n    })\r\n\r\n    row.button('Save Defaults', () => {\r\n      _appstate.saveStartupFile()\r\n    })\r\n\r\n    row.tool('app.load_defaults()')\r\n\r\n    row.useIcons()\r\n    row.prop('toolmodes.activeIndex')\r\n\r\n    this.rebuildSideBar()\r\n  }\r\n\r\n  rebuildSideBar() {\r\n    console.warn('Rebuilding sidebar')\r\n\r\n    let uidata = this.sidebar ? saveUIData(this.sidebar, 'sidebar') : undefined\r\n\r\n    if (this.sidebar && this.oldToolMode) {\r\n      this.oldToolMode.sideBarUIData = saveUIData(this.toolModePanel, 'toolmodepanel')\r\n    }\r\n\r\n    let sidebar = this.makeSideBar()\r\n\r\n    let tab = sidebar.tab('Options')\r\n\r\n    if (config.DRAW_TEST_IMAGES) {\r\n      this.ctx.state.testImages.makeUI(tab, 'testImages')\r\n    }\r\n\r\n    let props = UIBase.createElement('props-bag-editor-x') as UIBase<Context>\r\n    props.setAttribute('datapath', 'properties')\r\n\r\n    tab.add(props)\r\n\r\n    const toolmode = this.ctx.toolmode\r\n    if (toolmode) {\r\n      let col = (this.toolModePanel = tab.col())\r\n      col.dataPrefix = 'toolmode'\r\n      toolmode.buildSideBar(col)\r\n    }\r\n\r\n    tab = sidebar.tab('Tools')\r\n    tab.toolPanel('mesh.split_edge')\r\n    tab.toolPanel('mesh.vertex_smooth')\r\n    tab.tool('mesh.fix_windings')\r\n    tab.tool('mesh.make_face')\r\n    tab.tool('mesh.reverse_edge')\r\n\r\n    tab = sidebar.tab('Last Command')\r\n    tab.add(UIBase.createElement('last-tool-panel-x'))\r\n\r\n    /* Prevent update loop. */\r\n    this.oldToolMode = toolmode\r\n\r\n    if (this.sidebar && uidata) {\r\n      loadUIData(this.sidebar, uidata)\r\n    }\r\n\r\n    /* Load UI data for toolmode seperately*/\r\n    if (toolmode.sideBarUIData.length > 0) {\r\n      loadUIData(this.toolModePanel, toolmode.sideBarUIData)\r\n    }\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      this.flushUpdate()\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update()\r\n\r\n    if (!this.ctx) {\r\n      return\r\n    }\r\n\r\n    const toolmode = this.ctx.toolmode\r\n    if (toolmode !== this.oldToolMode) {\r\n      this.rebuildSideBar()\r\n    }\r\n  }\r\n\r\n  draw() {\r\n    if (!this.ctx) {\r\n      return\r\n    }\r\n\r\n    let canvas = this.canvas\r\n\r\n    let dpi = UIBase.getDPI()\r\n    let w = ~~(this.size[0] * dpi)\r\n    let h = ~~(this.size[1] * dpi) - 50 * dpi\r\n\r\n    if (w !== canvas.width || h !== canvas.height) {\r\n      canvas.width = w\r\n      canvas.height = h\r\n\r\n      canvas.style['width'] = '' + w / dpi + 'px'\r\n      canvas.style['height'] = '' + h / dpi + 'px'\r\n    }\r\n\r\n    this.g.clearRect(0, 0, canvas.width, canvas.height)\r\n\r\n    if (config.DRAW_TEST_IMAGES) {\r\n      this.ctx.state.testImages.draw(canvas, this.g)\r\n    }\r\n\r\n    if (this.toolmode) {\r\n      this.toolmode.draw(this.ctx, this.canvas, this.g)\r\n    }\r\n  }\r\n\r\n  setCSS() {\r\n    this.canvas.style['position'] = 'absolute'\r\n  }\r\n\r\n  pick(localX: number, localY: number, selmask = config.SELECTMASK, limit?: number) {\r\n    let mesh = this.ctx.mesh\r\n\r\n    if (limit === undefined) {\r\n      limit = selmask & MeshTypes.FACE ? 15 : 25\r\n    }\r\n\r\n    let mpos = new MeshVector()\r\n    mpos[0] = localX\r\n    mpos[1] = localY\r\n    mpos[2] = 0.0\r\n\r\n    let dpi = UIBase.getDPI()\r\n    limit *= dpi\r\n\r\n    let mindis: number | undefined, minret: PickData | undefined\r\n\r\n    let vlist = (list: ElementArray<Vertex | Handle>) => {\r\n      for (let v of list) {\r\n        if (v.flag & MeshFlags.HIDE) {\r\n          continue\r\n        }\r\n\r\n        mpos[2] = v.co.length > 2 ? v.co[2] : 0.0\r\n\r\n        let dis = v.co.vectorDistance(mpos)\r\n        if (dis >= limit) {\r\n          continue\r\n        }\r\n\r\n        if (!minret || dis < mindis!) {\r\n          mindis = dis\r\n          minret = pick_cachering.next().load(v, v.type, dis)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (selmask & MeshTypes.VERTEX) {\r\n      vlist(mesh.verts)\r\n    }\r\n\r\n    if (selmask & MeshTypes.HANDLE) {\r\n      vlist(mesh.handles)\r\n    }\r\n\r\n    const EDGE_WEIGHT = Math.max(limit * 0.9, 2)\r\n\r\n    if (selmask & MeshTypes.EDGE) {\r\n      for (let e of mesh.edges) {\r\n        if (e.flag & MeshFlags.HIDE) {\r\n          continue\r\n        }\r\n\r\n        let steps = 8\r\n        let t = 0,\r\n          dt = 1.0 / (steps - 1)\r\n        let p1\r\n        for (let i = 0; i < steps; i++, t += dt) {\r\n          let p2 = e.evaluate(t)\r\n\r\n          if (p1) {\r\n            let dis = math.dist_to_line_2d(mpos as unknown as Vector2, p1 as unknown as Vector2, p2 as unknown as Vector2)\r\n\r\n            if (dis >= limit) {\r\n              continue\r\n            }\r\n\r\n            if (mindis === undefined || dis + EDGE_WEIGHT < mindis) {\r\n              mindis = dis + EDGE_WEIGHT\r\n              minret = pick_cachering.next().load(e, e.type, dis)\r\n            }\r\n          }\r\n          p1 = p2\r\n        }\r\n      }\r\n    }\r\n\r\n    if (minret) {\r\n      return minret.elem\r\n    }\r\n\r\n    if (selmask & MeshTypes.FACE) {\r\n      let p2 = new MeshVector().addScalar(-10000)\r\n\r\n      let steps = mesh.haveHandles ? 8 : 2\r\n\r\n      for (let f of mesh.faces) {\r\n        let cross = 0\r\n\r\n        for (let list of f.lists) {\r\n          for (let l of list) {\r\n            let t = 0,\r\n              dt = 1.0 / (steps - 1)\r\n\r\n            let b\r\n            for (let i = 0; i < steps; i++, t += dt) {\r\n              let a = l.evaluate(t)\r\n\r\n              if (b && math.line_line_cross(mpos, p2, a, b)) {\r\n                cross++\r\n              }\r\n\r\n              b = a\r\n            }\r\n          }\r\n        }\r\n\r\n        if (cross % 2 === 0) {\r\n          continue\r\n        }\r\n\r\n        //We're guaranted to have a face here\r\n        let ok = !minret\r\n        ok = ok || !!((minret!.elem.flag & MeshFlags.SELECT) && !(f.flag & MeshFlags.SELECT))\r\n\r\n        if (ok) {\r\n          minret = pick_cachering.next().load(f, f.type, 0)\r\n        }\r\n      }\r\n    }\r\n\r\n    return minret ? minret.elem : undefined\r\n  }\r\n}\r\n\r\nsimple.Editor.register(Workspace)\r\n", "import {StructReader} from '../path.ux/scripts/path-controller/types/util/nstructjs.js'\r\nimport {\r\n  NumberConstraints,\r\n  nstructjs,\r\n  PropTypes,\r\n  util,\r\n  simple,\r\n  DataStruct,\r\n  PropSubTypes,\r\n  UIBase,\r\n  Container,\r\n  saveUIData,\r\n  loadUIData,\r\n  Vector2,\r\n  Vector3,\r\n  ToolProperty,\r\n  DataAPI,\r\n  FloatProperty,\r\n  RowFrame,\r\n} from '../path.ux/scripts/pathux.js'\r\nimport {Context} from './context'\r\n\r\n/* maps both name -> proptype and proptype -> name */\r\nexport const PropTypeMap = {\r\n  float : PropTypes.FLOAT,\r\n  int   : PropTypes.INT,\r\n  vec2  : PropTypes.VEC2,\r\n  vec3  : PropTypes.VEC3,\r\n  vec4  : PropTypes.VEC4,\r\n  color3: PropTypes.VEC3,\r\n  color4: PropTypes.VEC4,\r\n  string: PropTypes.STRING,\r\n  enum  : PropTypes.ENUM,\r\n  flags : PropTypes.FLAG,\r\n  bool  : PropTypes.BOOL,\r\n} as any\r\n\r\nfor (let k in PropTypeMap) {\r\n  //colors are a PropSubType .subtype field\r\n  if (k !== 'color3' && k !== 'color4') {\r\n    PropTypeMap[PropTypeMap[k]] = k\r\n  }\r\n}\r\n\r\nlet idgen = 0\r\n\r\ninterface IDefBase<T extends string, V> {\r\n  type: T\r\n  value: V\r\n}\r\n\r\ninterface IBoolean extends IDefBase<'bool', boolean> {}\r\ninterface IString extends IDefBase<'string', string> {}\r\ninterface INumBase<T extends string, V = number> extends IDefBase<T, V> {\r\n  min?: number\r\n  max?: number\r\n  slideSpeed?: number\r\n  expRate?: number\r\n  slider?: boolean\r\n  baseUnit?: string\r\n  displayUnit?: string\r\n  unit?: string\r\n}\r\n\r\ninterface IFloatBase<T extends string, V = number> extends IDefBase<T, V> {\r\n  decimalPlaces?: number\r\n}\r\ninterface IIntBase<T extends string, V = number> extends IDefBase<T, V> {\r\n  radix?: number\r\n}\r\n\r\ninterface IFloat extends IFloatBase<'float'> {}\r\ninterface IInt extends IIntBase<'int'> {}\r\ninterface IVec2 extends IFloatBase<'vec2', Vector2> {}\r\ninterface IVec3 extends IFloatBase<'vec3', Vector3> {}\r\ninterface IVec4 extends IFloatBase<'vec4', Vector3> {}\r\ninterface IColor3 extends IFloatBase<'color3', Vector3> {}\r\ninterface IColor4 extends IFloatBase<'color4', Vector3> {}\r\ninterface IEnumBase<T extends string, K extends string, V> extends IDefBase<T, V> {\r\n  iconMap: {\r\n    [k in K]: number\r\n  }\r\n  descriptions: {\r\n    [k in K]: number\r\n  }\r\n  def: {\r\n    [k in K]: V\r\n  }\r\n}\r\ninterface IEnum<K extends string = string, V = number> extends IEnumBase<'enum', K, V> {}\r\ninterface IFlag<K extends string = string, V = number> extends IEnumBase<'flag', K, V> {}\r\n\r\ntype IProperty = IBoolean | IString | IFloat | IInt | IVec2 | IVec3 | IVec4 | IColor3 | IColor4 | IEnum | IFlag\r\n\r\nexport interface ITemplateDef {\r\n  [k: string]: IProperty\r\n}\r\n\r\ntype ConvertType<T> = {\r\n  [k in keyof T]: T[k] extends IProperty ? T[k]['value'] : never\r\n}\r\n\r\nexport type {ConvertType as PropBagAccessor}\r\n\r\ninterface PropertiesBagConstructor<T extends ITemplateDef = {}> {\r\n  new (template?: T): PropertiesBag<T>\r\n  defineAPI(api: DataAPI, st: DataStruct): void\r\n  templateFromProps<T extends ITemplateDef = {}>(props: ToolProperty<any>[]): T\r\n}\r\nexport class PropertiesBag<T extends ITemplateDef> {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\n    PropertiesBag {\r\n      _props : array(abstract(ToolProperty)) | this._save();\r\n    }\r\n  `\r\n  )\r\n\r\n  static defineAPI(api: DataAPI, st: DataStruct) {\r\n    api.mapStructCustom(this, this.getStruct.bind(this))\r\n  }\r\n\r\n  static getStruct(obj: any) {\r\n    return obj._struct\r\n  }\r\n\r\n  ['constructor']: PropertiesBagConstructor\r\n\r\n  sourceTemplate: T\r\n\r\n  //these two are used by props widget to detect updates\r\n  _updateGen = 0\r\n  _id = idgen++\r\n\r\n  _struct: DataStruct\r\n  _props: ToolProperty<any>[]\r\n\r\n  constructor(template?: T) {\r\n    this._props = []\r\n    this._struct = new DataStruct()\r\n    this.sourceTemplate = {} as unknown as T\r\n\r\n    if (template) {\r\n      this.loadTemplate(template)\r\n    }\r\n  }\r\n\r\n  get asFullyTypedBag() {\r\n    return this as unknown as ConvertType<T>\r\n  }\r\n  _getTemplValue(item: any): any {\r\n    let val = item.value\r\n\r\n    if (val === undefined) {\r\n      if (item.type === 'string') {\r\n        val = ''\r\n      } else if (item.type === 'vec2') {\r\n        val = [0, 0]\r\n      } else if (item.type === 'vec3' || item.type === 'color3') {\r\n        val = [0, 0, 0]\r\n      } else if (item.type === 'vec4' || item.type === 'color4') {\r\n        val = [0, 0, 0, 1]\r\n      } else {\r\n        val = 0\r\n      }\r\n    }\r\n\r\n    return val\r\n  }\r\n\r\n  #getPropDefs(templ: any, flat_templ: any = {}) {\r\n    for (let k in templ) {\r\n      if (typeof k === 'symbol') {\r\n        continue\r\n      }\r\n\r\n      let v = templ[k]\r\n\r\n      if (k === 'type' && (v as any) === 'panel') {\r\n        continue\r\n      }\r\n\r\n      if (typeof v === 'object' && v.type === 'panel') {\r\n        this.#getPropDefs(v, flat_templ)\r\n      } else {\r\n        flat_templ[k] = v\r\n      }\r\n    }\r\n\r\n    return flat_templ\r\n  }\r\n\r\n  patchTemplate(templ: any) {\r\n    this.sourceTemplate = templ\r\n\r\n    this._props.length = 0\r\n    this._updateGen++\r\n\r\n    let flat_templ = this.#getPropDefs(templ)\r\n\r\n    for (let k in flat_templ) {\r\n      let item = flat_templ[k]\r\n\r\n      if (typeof item !== 'object') {\r\n        item = {type: item}\r\n      }\r\n\r\n      const genericThis = this as unknown as any\r\n      if (genericThis[k] === undefined) {\r\n        genericThis[k] = this._getTemplValue(item)\r\n      }\r\n    }\r\n\r\n    let st = this._struct\r\n    st.clear()\r\n\r\n    for (let k in flat_templ) {\r\n      let item = flat_templ[k]\r\n\r\n      if (typeof item !== 'object') {\r\n        item = {type: item}\r\n      }\r\n\r\n      let uiname = item.uiName ?? ToolProperty.makeUIName(k)\r\n      let descr = item.description ?? ''\r\n      let def\r\n\r\n      if (item.type === 'float') {\r\n        def = st.float(k, k, uiname, descr)\r\n      } else if (item.type === 'int') {\r\n        def = st.int(k, k, uiname, descr)\r\n      } else if (item.type === 'vec2') {\r\n        def = st.vec2(k, k, uiname, descr)\r\n      } else if (item.type === 'vec3') {\r\n        def = st.vec3(k, k, uiname, descr)\r\n      } else if (item.type === 'vec4') {\r\n        def = st.vec4(k, k, uiname, descr)\r\n      } else if (item.type === 'color3') {\r\n        def = st.color3(k, k, uiname, descr)\r\n      } else if (item.type === 'color4') {\r\n        def = st.color4(k, k, uiname, descr)\r\n      } else if (item.type === 'string') {\r\n        def = st.string(k, k, uiname, descr)\r\n      } else if (item.type === 'enum') {\r\n        def = st.enum(k, k, item.def, uiname, descr)\r\n      } else if (item.type === 'flags') {\r\n        def = st.flags(k, k, item.def, uiname, descr)\r\n      } else if (item.type === 'bool') {\r\n        def = st.bool(k, k, uiname, descr)\r\n      }\r\n\r\n      if (def === undefined) {\r\n        console.warn('properties template error', k, item)\r\n        continue\r\n      }\r\n\r\n      if (item.type === 'enum' || item.type === 'flags') {\r\n        if ('checkStrip' in item) {\r\n          def.checkStrip(item.checkStrip)\r\n        }\r\n      }\r\n\r\n      if (!def) {\r\n        console.error('Unknown property type ' + item.type, item)\r\n        continue\r\n      }\r\n\r\n      def.on('change', window.redraw_all)\r\n\r\n      if (item.onchange) {\r\n        def.on('change', item.onchange)\r\n      }\r\n\r\n      this._props.push(def.data.copy())\r\n\r\n      let pr = PropTypes\r\n      let numberTypes = pr.FLOAT | pr.INT | pr.VEC2 | pr.VEC3 | pr.VEC4\r\n\r\n      def.data.apiname = k\r\n\r\n      if (def.data.type & numberTypes) {\r\n        const numberCast = def.data as FloatProperty\r\n        numberCast.baseUnit = numberCast.displayUnit = 'none'\r\n\r\n        for (let key of NumberConstraints) {\r\n          if (key in item) {\r\n            ;(numberCast as any)[key] = item[key]\r\n          }\r\n        }\r\n\r\n        if (item.slider) {\r\n          def.simpleSlider()\r\n        }\r\n\r\n        if ('unit' in item) {\r\n          numberCast.baseUnit = numberCast.displayUnit = item.unit\r\n        }\r\n\r\n        if ('min' in item) {\r\n          numberCast.range[0] = item.min\r\n        }\r\n\r\n        if ('max' in item) {\r\n          numberCast.range[1] = item.max\r\n        }\r\n\r\n        if ('uiMin' in item) {\r\n          if (!numberCast.uiRange) {\r\n            numberCast.uiRange = Array.from(numberCast.range) as [number, number]\r\n          }\r\n          numberCast.uiRange[0] = item.uiMin\r\n        }\r\n\r\n        if ('uiMax' in item) {\r\n          if (!numberCast.uiRange) {\r\n            numberCast.uiRange = Array.from(numberCast.range) as [number, number]\r\n          }\r\n          numberCast.uiRange[1] = item.uiMax\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  loadTemplate(templ: any) {\r\n    this.sourceTemplate = templ\r\n\r\n    templ = this.#getPropDefs(templ)\r\n\r\n    for (let k in templ) {\r\n      let item = templ[k]\r\n      if (typeof item !== 'object') {\r\n        item = {type: item}\r\n      }\r\n\r\n      //this[k] = this._getTemplValue(item);\r\n    }\r\n\r\n    this.patchTemplate(templ)\r\n  }\r\n\r\n  static templateFromProps(props: ToolProperty<any>[]) {\r\n    let templ = {} as any\r\n\r\n    for (let prop of props) {\r\n      let item = {} as any\r\n      templ[prop.apiname] = item\r\n\r\n      let type = PropTypeMap[prop.type]\r\n\r\n      if (prop.subtype === PropSubTypes.COLOR) {\r\n        type = prop.type === PropTypes.VEC3 ? 'color3' : 'color4'\r\n      }\r\n\r\n      item.type = type\r\n      item.uiName = prop.uiname\r\n      item.value = prop.getValue()\r\n\r\n      let pr = PropTypes\r\n      let numberTypes = pr.FLOAT | pr.INT | pr.VEC2 | pr.VEC3 | pr.VEC4\r\n\r\n      if (prop.type & numberTypes) {\r\n        const numProp = prop as FloatProperty\r\n        for (let key of NumberConstraints) {\r\n          if ((prop as any)[key] === undefined) {\r\n            continue\r\n          }\r\n\r\n          if (key === 'range') {\r\n            ;[item.min, item.max] = numProp.range\r\n          } else if (key === 'uiRange') {\r\n            ;[item.uiMin, item.uiMax] = numProp.uiRange!\r\n          } else {\r\n            item[key] = (numProp as any)[key]\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return templ\r\n  }\r\n\r\n  _save() {\r\n    window.draw_ignore_push()\r\n\r\n    try {\r\n      for (let prop of this._props) {\r\n        prop.setValue((this as any)[prop.apiname])\r\n      }\r\n    } finally {\r\n      window.draw_ignore_pop()\r\n    }\r\n\r\n    return this._props\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n\r\n    let templ = this.constructor.templateFromProps<T>(this._props)\r\n    this.loadTemplate(templ)\r\n  }\r\n\r\n  testStruct() {\r\n    let json = nstructjs.writeJSON(this)\r\n    console.log(json)\r\n\r\n    let obj = nstructjs.readJSON(json, this.constructor)\r\n    console.log(obj)\r\n\r\n    return obj\r\n  }\r\n}\r\nsimple.DataModel.register(PropertiesBag)\r\n\r\nexport class PropsEditor extends RowFrame<Context> {\r\n  needsRebuild = true\r\n  _last_update_key = ''\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  static define() {\r\n    return {\r\n      tagname: 'props-bag-editor-x',\r\n    }\r\n  }\r\n\r\n  init() {\r\n    super.init()\r\n\r\n    if (this.ctx && this.hasAttribute('datapath')) {\r\n      this.rebuild()\r\n    }\r\n  }\r\n\r\n  get columns() {\r\n    if (this.hasAttribute('columns')) {\r\n      return parseInt(this.getAttribute('columns')!)\r\n    } else {\r\n      return 1\r\n    }\r\n  }\r\n\r\n  set columns(v) {\r\n    this.setAttribute('columns', '' + v)\r\n  }\r\n\r\n  rebuild() {\r\n    let uidata = saveUIData(this, 'props editor')\r\n\r\n    let colsCount = this.columns\r\n    let path = this.getAttribute('datapath')!\r\n    let props = this.ctx.api.getValue(this.ctx, path)\r\n\r\n    if (!props) {\r\n      console.warn('Bad datapath', path)\r\n      return\r\n    }\r\n\r\n    this.needsRebuild = false\r\n    this.dataPrefix = path\r\n\r\n    this.clear()\r\n\r\n    console.log('Columns', colsCount)\r\n    const cols = new Array(colsCount).fill(1).map(() => this.col())\r\n    let i = 0\r\n\r\n    const panels = new Map<string, Container>()\r\n\r\n    let templ = props.sourceTemplate\r\n    for (let k in templ) {\r\n      let v = templ[k]\r\n\r\n      if (typeof v === 'object' && typeof v['panel'] === 'string') {\r\n        let panel = panels.get(v.panel)\r\n        if (panel === undefined) {\r\n          let ci = i++ % colsCount\r\n          panel = cols[ci].panel(ToolProperty.makeUIName(v.panel))\r\n          panels.set(v.panel, panel)\r\n        }\r\n        panel.prop(k)\r\n      } else {\r\n        let ci = i++ % colsCount\r\n        cols[ci].prop(k)\r\n        console.log(ci)\r\n      }\r\n    }\r\n\r\n    /*\r\n    for (let prop of props._props) {\r\n      let col = cols[i%cols.length]\r\n\r\n      col.prop(prop.apiname);\r\n      i++;\r\n    }*/\r\n\r\n    loadUIData(this, uidata)\r\n  }\r\n\r\n  update() {\r\n    super.update()\r\n\r\n    if (!this.ctx) {\r\n      return\r\n    }\r\n\r\n    let path = this.getAttribute('datapath')\r\n\r\n    let props = this.ctx.api.getValue(this.ctx, path!)\r\n    if (!props) {\r\n      console.warn('Bad datapath', path)\r\n      return\r\n    }\r\n\r\n    let key = '' + props._updateGen + ':' + props._id + ':' + props._props.length\r\n\r\n    if (key !== this._last_update_key) {\r\n      this._last_update_key = key\r\n      this.needsRebuild = true\r\n    }\r\n\r\n    if (this.needsRebuild) {\r\n      this.rebuild()\r\n    }\r\n  }\r\n}\r\n\r\nUIBase.register(PropsEditor)\r\n", "/** Library to deal with debug visualization images.\r\n *\r\n * Images are drawn either in tiles or exclusively\r\n * one at a time.\r\n */\r\n\r\nimport {Vector2, nstructjs, util, math, simple, ToolProperty} from '../path.ux/pathux.js';\r\nimport {DataModel} from '../path.ux/scripts/simple/app.js';\r\n\r\nexport class ImageItemIF {\r\n  name = \"name\";\r\n  size = [512, 512];\r\n  description = \"\";\r\n  uiName = undefined;\r\n}\r\n\r\nexport class ImageTile {\r\n  image = null;\r\n  size = new Vector2([512, 512]);\r\n  name = \"name\";\r\n  pos = new Vector2();\r\n  id = 0;\r\n  enumkey = \"\";\r\n  description = \"\";\r\n  enabled = true;\r\n\r\n  constructor(size, name, description = \"\", uiName = undefined) {\r\n    this.size.load(size);\r\n    this.name = name;\r\n    this.description = description;\r\n    this.uiName = uiName;\r\n  }\r\n\r\n  static fromImageItem(item) {\r\n    return new ImageTile(item.size, item.name, item.description, item.uiName);\r\n  }\r\n}\r\n\r\nexport class ImageWrangler extends simple.DataModel {\r\n  _tiles = [];\r\n  images = {};\r\n  columns = 2;\r\n  singletonMode = false; /* Show only one image at a time. */\r\n  apiStructNeedsDefine = true;\r\n  visible = true;\r\n  _enabled_images = undefined;\r\n\r\n  static apiStruct = undefined;\r\n\r\n  static STRUCT = `\r\nImageWrangler {\r\n  visible         : bool;\r\n  _enabled_images : int | this.enabled_images;\r\n}\r\n  `;\r\n\r\n  constructor(template = undefined, singletonMode = false) {\r\n    super();\r\n\r\n    this.singletonMode = singletonMode;\r\n    if (template !== undefined) {\r\n      this.loadFromTemplate(template);\r\n    }\r\n  }\r\n\r\n  loadSTRUCT(reader) {\r\n    reader(this);\r\n  }\r\n\r\n  static defineAPI(api, st) {\r\n    this.apiStruct = st;\r\n\r\n    st.bool(\"visible\", \"visible\", \"Visible\")\r\n      .description(\"Show or hide all images.\")\r\n      .on(\"change\", () => window.redraw_all());\r\n  }\r\n\r\n  checkApiStruct() {\r\n    if (!this.constructor.apiStruct || !this.apiStructNeedsDefine) {\r\n      return;\r\n    }\r\n\r\n    this.apiStructNeedsDefine = false;\r\n\r\n    let st = this.constructor.apiStruct;\r\n    let enumdef = {};\r\n    let flagdef = {};\r\n    let uinames = {};\r\n    let descr = {};\r\n\r\n    for (let tile of this._tiles) {\r\n      enumdef[tile.enumkey] = tile.id;\r\n      flagdef[tile.enumkey] = 1<<tile.id;\r\n      uinames[tile.enumkey] = tile.uiName ? tile.uiName : ToolProperty.makeUIName(tile.name);\r\n      descr[tile.enumkey] = tile.description;\r\n    }\r\n\r\n    console.error(\"UINAMES\", uinames)\r\n\r\n    st.flags(\"enabled_images\", \"enabled_images\", flagdef, \"Enabled Images\")\r\n      .uiNames(uinames)\r\n      .descriptions(descr);\r\n\r\n    st.enum(\"active_image\", \"active_image\", enumdef, \"Active Image\")\r\n      .uiNames(uinames)\r\n      .descriptions(descr)\r\n      .checkStrip();\r\n  }\r\n\r\n  get active_image() {\r\n    for (let tile of this._tiles) {\r\n      if (tile.enabled) {\r\n        return tile.id;\r\n      }\r\n    }\r\n\r\n    return -1;\r\n  }\r\n\r\n  set active_image(v) {\r\n    for (let tile of this._tiles) {\r\n      tile.enabled = v === tile.id;\r\n    }\r\n\r\n    window.redraw_all();\r\n  }\r\n\r\n  get enabled_images() {\r\n    let mask = 0;\r\n    for (let tile of this._tiles) {\r\n      if (tile.enabled) {\r\n        mask |= 1<<tile.id;\r\n      }\r\n    }\r\n\r\n    return mask;\r\n  }\r\n\r\n  set enabled_images(v) {\r\n    for (let tile of this._tiles) {\r\n      tile.enabled = v & (1<<tile.id);\r\n    }\r\n\r\n    window.redraw_all();\r\n  }\r\n\r\n  makeUI(container, datapath) {\r\n    console.log(container)\r\n\r\n    container.label(\"Test Images\");\r\n    container.prop(`${datapath}.visible`);\r\n    if (this.singletonMode) {\r\n      container.prop(`${datapath}.active_image`);\r\n    } else {\r\n      container.prop(`${datapath}.enabled_images`);\r\n    }\r\n  }\r\n\r\n  loadFromTemplate(template, columns = template.imageColumns || this.columns) {\r\n    this.columns = columns;\r\n\r\n    template = Object.assign(template);\r\n\r\n    if (\"singletonMode\" in template) {\r\n      this.singletonMode = template.singletonMode;\r\n      delete template.singletonMode;\r\n    }\r\n\r\n    if (\"imageColumns\" in template) {\r\n      delete template.imageColumns;\r\n    }\r\n\r\n    this._tiles = [];\r\n    this.images = {};\r\n\r\n    let defaultSize;\r\n    for (let k in template) {\r\n      let idef = template[k];\r\n      if (idef.size) {\r\n        defaultSize = new Vector2(idef.size);\r\n      }\r\n    }\r\n\r\n    let i = 0;\r\n    for (let k in template) {\r\n      let idef = Object.assign({}, template[k]);\r\n      if (!idef.name) {\r\n        idef.name = k;\r\n      }\r\n      if (idef.size === undefined && idef.dimen) {\r\n        idef.size = [idef.dimen, idef.dimen];\r\n      }\r\n\r\n      let tile = ImageTile.fromImageItem(idef);\r\n      if (!(\"size\" in idef) && defaultSize) {\r\n        tile.size.load(defaultSize);\r\n      }\r\n\r\n      tile.image = new ImageData(tile.size[0], tile.size[1]);\r\n      let idata = tile.image.data;\r\n\r\n      /* Set alpha to 255.*/\r\n      for (let i = 0; i < idata.length; i += 4) {\r\n        idata[i + 3] = 255;\r\n      }\r\n\r\n      let idname = tile.name.replace(/[ \\t\\-]/g, \"_\");\r\n      tile.id = i++;\r\n      tile.enumkey = idname;\r\n\r\n      this._tiles.push(tile);\r\n      this.images[k] = tile.image;\r\n    }\r\n\r\n    this.layoutTiles();\r\n    this.checkApiStruct();\r\n\r\n    console.log(\"_enabled_images\", this._enabled_images);\r\n\r\n    /* Restore saved image visibiliy state. */\r\n    if (this._enabled_images !== undefined) {\r\n      this.enabled_images = this._enabled_images;\r\n      delete this._enabled_images;\r\n    }\r\n  }\r\n\r\n  layoutTiles() {\r\n    let maxsize = new Vector2();\r\n\r\n    for (let tile of this._tiles) {\r\n      maxsize.max(tile.size);\r\n    }\r\n\r\n    let pad = 5;\r\n    maxsize.addScalar(pad);\r\n\r\n    let x = pad, y = pad;\r\n    let col = 0;\r\n\r\n    for (let tile of this._tiles) {\r\n      tile.pos.loadXY(x, y);\r\n\r\n      if (this.singletonMode) {\r\n        continue;\r\n      }\r\n\r\n      if (col === this.columns - 1) {\r\n        x = pad;\r\n        y += maxsize[1];\r\n      } else {\r\n        x += maxsize[0];\r\n      }\r\n\r\n      col++;\r\n    }\r\n  }\r\n\r\n  draw(canvas, g) {\r\n    this.checkApiStruct();\r\n\r\n    if (!this.visible) {\r\n      return;\r\n    }\r\n\r\n    for (let tile of this._tiles) {\r\n      if (tile.enabled) {\r\n        g.putImageData(tile.image, tile.pos[0], tile.pos[1]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nDataModel.register(ImageWrangler);\r\n\r\n", "import {Edge, Mesh, MeshTypes, MeshVector, Element, Vertex, Face} from './mesh';\r\n\r\nexport function vertexSmooth(mesh: Mesh, verts: Iterable<Vertex> = mesh.verts, fac = 0.5, doHandles = true) {\r\n  let co = new MeshVector();\r\n\r\n  let edges;\r\n  edges = new Set<Edge>();\r\n\r\n  if (mesh.haveHandles && doHandles) {\r\n    for (let v of verts) {\r\n      for (let e of v.edges) {\r\n        edges.add(e);\r\n      }\r\n    }\r\n\r\n    for (let e of edges) {\r\n      e.h1!.co.sub(e.v1.co);\r\n      e.h2!.co.sub(e.v2.co);\r\n    }\r\n  }\r\n\r\n  for (let v of verts) {\r\n    co.zero();\r\n    let tot = 0.0;\r\n\r\n    for (let e of v.edges) {\r\n      let v2 = e.otherVertex(v);\r\n\r\n      co.add(v2.co);\r\n      tot += 1.0;\r\n    }\r\n\r\n    if (tot !== 0.0) {\r\n      co.mulScalar(1.0/tot);\r\n      v.co.interp(co, 0.5);\r\n    }\r\n  }\r\n\r\n  if (mesh.haveHandles && doHandles) {\r\n    for (let e of edges) {\r\n      e.h1!.co.add(e.v1.co);\r\n      e.h2!.co.add(e.v2.co);\r\n    }\r\n  }\r\n}\r\n\r\nexport function duplicate(mesh: Mesh, geom: Iterable<Element>) {\r\n  let verts = new Set<Vertex>()\r\n  let edges = new Set<Edge>()\r\n  let faces = new Set<Face>()\r\n  let map = new Map()\r\n\r\n  for (let elem of geom) {\r\n    switch (elem.type) {\r\n      case MeshTypes.VERTEX:\r\n        verts.add(elem as Vertex);\r\n        break;\r\n      case MeshTypes.EDGE:\r\n        edges.add(elem as Edge);\r\n        break;\r\n      case MeshTypes.FACE:\r\n        faces.add(elem as Face);\r\n        break;\r\n    }\r\n  }\r\n\r\n  for (let f of faces) {\r\n    for (let l of f.loops) {\r\n      edges.add(l.e);\r\n    }\r\n  }\r\n\r\n  for (let e of edges) {\r\n    verts.add(e.v1);\r\n    verts.add(e.v2);\r\n  }\r\n\r\n  for (let v of verts) {\r\n    let v2 = mesh.makeVertex(v.co);\r\n    mesh.copyElemData(v2, v);\r\n    map.set(v, v2)\r\n  }\r\n\r\n  for (let e of edges) {\r\n    let e2 = mesh.makeEdge(map.get(e.v1), map.get(e.v2));\r\n    mesh.copyElemData(e2, e);\r\n    map.set(e, e2)\r\n\r\n    if (e.h1) {\r\n      e2.h1!.co.load(e.h1!.co);\r\n      e2.h2!.co.load(e.h2!.co);\r\n      mesh.copyElemData(e2.h1!, e.h1!);\r\n      mesh.copyElemData(e2.h2!, e.h2!);\r\n    }\r\n  }\r\n\r\n  for (let f of faces) {\r\n    let vs = Array.from(f.lists[0]).map(l => map.get(l.v));\r\n\r\n    let f2 = mesh.makeFace(vs)\r\n    for (let i = 1; i < f.lists.length; i++) {\r\n      let list = f.lists[i];\r\n      let vs2 = Array.from(list).map(l => map.get(l.v));\r\n\r\n      mesh.addLoopList(f2, vs2);\r\n    }\r\n\r\n    mesh.copyElemData(f2, f);\r\n  }\r\n\r\n  return {\r\n    oldNewMap: map,\r\n    geom     : Array.from(map.values())\r\n  }\r\n}", "import config from '../config/config.js';\r\n\r\nimport {\r\n  util, math, Vector2, Vector3, Vector4, Matrix4,\r\n  nstructjs, ToolOp, IntProperty, FloatProperty,\r\n  Vec3Property, Vec4Property, Vec2Property, FlagProperty, keymap\r\n} from '../path.ux/pathux.js';\r\n\r\nimport {Vertex, MeshTypes, MeshFlags, MeshVector} from './mesh.js';\r\n\r\nconst VecProperty = (new Vertex()).co.length === 3 ? Vec3Property : Vec2Property;\r\nconst Vector = MeshVector;\r\nconst VectorSize = (new Vector()).length;\r\n\r\nexport class TransformList extends Array {\r\n  constructor(typeName, selmask) {\r\n    super();\r\n\r\n    this.typeName = typeName;\r\n    this.selMask = selmask;\r\n  }\r\n}\r\n\r\nexport const TransformClasses = [];\r\n\r\nexport class TransformElem {\r\n  constructor() {\r\n\r\n  }\r\n\r\n  static undoPre(mesh, selMask, list) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  static undo(mesh, selMask, data) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  static create(mesh, selMask) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  static transformDefine() {\r\n    return {\r\n      typeName: \"\",\r\n      uiName  : \"\",\r\n      selMask : 0\r\n    }\r\n  }\r\n\r\n  static register(cls) {\r\n    TransformClasses.push(cls);\r\n  }\r\n\r\n  static getClass(typeName) {\r\n    for (let cls of TransformClasses) {\r\n      if (cls.transformDefine().typeName === typeName) {\r\n        return cls;\r\n      }\r\n    }\r\n  }\r\n\r\n  minmax(min, max) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n\r\n  apply(matrix) {\r\n    throw new Error(\"implement me!\");\r\n  }\r\n}\r\n\r\nexport class TransformVert extends TransformElem {\r\n  constructor(v) {\r\n    super();\r\n\r\n    this.v = v;\r\n    this.start = new Vector(v.co);\r\n  }\r\n\r\n  static create(mesh, selMask) {\r\n    let list = new TransformList(this.transformDefine().typeName, selMask);\r\n\r\n    let doList = (elist) => {\r\n      for (let v of elist.selected.editable) {\r\n        list.push(new this(v));\r\n      }\r\n    }\r\n\r\n    if (selMask & MeshTypes.VERTEX) {\r\n      doList(mesh.verts);\r\n    }\r\n\r\n    if (mesh.haveHandles && (selMask & MeshTypes.HANDLE)) {\r\n      doList(mesh.handles);\r\n    }\r\n\r\n    return list;\r\n  }\r\n\r\n  static undoPre(mesh, selMask, list) {\r\n    let ret = [];\r\n\r\n    for (let td of list) {\r\n      ret.push(td.v.eid);\r\n\r\n      for (let i = 0; i < VectorSize; i++) {\r\n        ret.push(td.v.co[i]);\r\n      }\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  static undo(mesh, selMask, data) {\r\n    let vlen = VectorSize + 1;\r\n\r\n    for (let i = 0; i < data.length; i += vlen) {\r\n      let eid = data[i];\r\n\r\n      let elem = mesh.eidMap.get(eid);\r\n      if (!elem) {\r\n        console.error(\"Missing element \" + eid);\r\n        continue;\r\n      }\r\n\r\n      for (let j = 0; j < VectorSize; j++) {\r\n        elem.co[j] = data[i + j + 1];\r\n      }\r\n    }\r\n  }\r\n\r\n  static transformDefine() {\r\n    return {\r\n      typeName: \"verts\",\r\n      uiName  : \"verts\",\r\n      selMask : MeshTypes.VERTEX | MeshTypes.HANDLE\r\n    }\r\n  }\r\n\r\n  minmax(min, max) {\r\n    min.min(this.start);\r\n    max.max(this.start);\r\n  }\r\n\r\n  apply(matrix) {\r\n    this.v.co.load(this.start);\r\n    this.v.co.multVecMatrix(matrix);\r\n  }\r\n}\r\n\r\nTransformElem.register(TransformVert);\r\n\r\nexport class TransformOp extends ToolOp {\r\n  constructor() {\r\n    super();\r\n\r\n    this.transData = undefined;\r\n\r\n    this.deltaMpos = new Vector2();\r\n    this.startMpos = new Vector2();\r\n    this.lastMpos = new Vector2();\r\n    this._lastMpos = new Vector2();\r\n    this.mpos = new Vector2();\r\n\r\n    this.first = true;\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      inputs: {\r\n        selMask: new FlagProperty(config.SELECTMASK, MeshTypes),\r\n        center : new VecProperty()\r\n      }\r\n    }\r\n  }\r\n\r\n  calcTransCenter(tdata) {\r\n    let min = new Vector();\r\n    let max = new Vector();\r\n\r\n    min.addScalar(1e17);\r\n    max.addScalar(-1e17);\r\n    for (let list of tdata) {\r\n      for (let td of list) {\r\n        td.minmax(min, max);\r\n      }\r\n    }\r\n\r\n    this.inputs.center.setValue(min.interp(max, 0.5));\r\n  }\r\n\r\n  getTransData(ctx, doCenter = true) {\r\n    if (this.transData) {\r\n      if (doCenter) {\r\n        this.calcTransCenter(this.transData);\r\n      }\r\n\r\n      return this.transData;\r\n    }\r\n\r\n    let ret = [];\r\n    let mesh = ctx.mesh;\r\n    let selMask = this.inputs.selMask.getValue();\r\n\r\n    for (let list of TransformClasses) {\r\n      ret.push(list.create(mesh, selMask));\r\n    }\r\n\r\n    if (doCenter) {\r\n      this.calcTransCenter(ret);\r\n    }\r\n\r\n    this.transData = ret;\r\n    return ret;\r\n  }\r\n\r\n  execPost(ctx) {\r\n    this.transData = undefined;\r\n    window.redraw_all();\r\n  }\r\n\r\n  execPre(ctx) {\r\n    this.getTransData(ctx);\r\n    window.redraw_all();\r\n  }\r\n\r\n  modalStart(ctx) {\r\n    super.modalStart(ctx);\r\n    this.getTransData(ctx);\r\n  }\r\n\r\n  undoPre(ctx) {\r\n    this._undo = {};\r\n    this._undoSelMask = this.inputs.selMask.getValue();\r\n\r\n    let tdata = this.getTransData(ctx)\r\n\r\n    let selMask = this.inputs.selMask.getValue();\r\n    let mesh = ctx.mesh;\r\n\r\n    for (let list of tdata) {\r\n      let cls = TransformElem.getClass(list.typeName);\r\n      this._undo[list.typeName] = cls.undoPre(ctx.mesh, selMask, list);\r\n    }\r\n\r\n    window.redraw_all();\r\n  }\r\n\r\n  undo(ctx) {\r\n    let mesh = ctx.mesh;\r\n\r\n    for (let k in this._undo) {\r\n      TransformElem.getClass(k).undo(mesh, this._undoSelMask, this._undo[k]);\r\n    }\r\n\r\n    window.redraw_all();\r\n  }\r\n\r\n  on_pointerup(e) {\r\n    this.modalEnd(false);\r\n  }\r\n\r\n  on_pointercancel(e) {\r\n    this.modalEnd(true); //will cancel\r\n  }\r\n\r\n  on_keydown(e) {\r\n    switch (e.keyCode) {\r\n      case keymap[\"Enter\"]:\r\n      case keymap[\"Space\"]:\r\n        this.modalEnd(false);\r\n        break;\r\n      case keymap[\"Escape\"]:\r\n      case keymap[\"Backspace\"]:\r\n      case keymap[\"Delete\"]:\r\n        this.modalEnd(true);\r\n        break;\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let ctx = this.modal_ctx;\r\n\r\n    let workspace = ctx.workspace;\r\n\r\n    let mpos = workspace.getLocalMouse(e.x, e.y);\r\n\r\n    if (this.first) {\r\n      this.startMpos.load(mpos);\r\n      this.lastMpos.load(mpos);\r\n      this.deltaMpos.zero();\r\n      this.mpos.load(mpos);\r\n      this._lastMpos.load(mpos);\r\n\r\n      this.first = false;\r\n      return;\r\n    }\r\n\r\n    this.lastMpos.load(this._lastMpos);\r\n    this.deltaMpos.load(mpos).sub(this.lastMpos);\r\n\r\n    this.mpos.load(mpos);\r\n    this._lastMpos.load(mpos);\r\n  }\r\n}\r\n\r\nexport class TranslateOp extends TransformOp {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Move\",\r\n      toolpath: \"transform.translate\",\r\n      inputs  : ToolOp.inherit({\r\n        offset: new VecProperty()\r\n      }),\r\n      is_modal: true,\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    super.on_pointermove(e);\r\n\r\n    let delta = new Vector2(this.mpos).sub(this.startMpos);\r\n    delta = new Vector().loadXY(delta[0], delta[1]);\r\n\r\n    this.inputs.offset.setValue(delta);\r\n    this.exec(this.modal_ctx);\r\n  }\r\n\r\n  exec(ctx) {\r\n    let delta = this.inputs.offset.getValue();\r\n\r\n    let matrix = new Matrix4();\r\n    matrix.translate(delta[0], delta[1], delta[2] ?? 0.0);\r\n\r\n    let tdata = this.getTransData(ctx);\r\n\r\n    console.log(tdata);\r\n\r\n    for (let tlist of tdata) {\r\n      for (let td of tlist) {\r\n        td.apply(matrix);\r\n      }\r\n    }\r\n\r\n    window.redraw_all();\r\n  }\r\n}\r\n\r\nToolOp.register(TranslateOp);\r\n\r\n\r\nexport class ScaleOp extends TransformOp {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Move\",\r\n      toolpath: \"transform.scale\",\r\n      inputs  : ToolOp.inherit({\r\n        scale: new VecProperty()\r\n      }),\r\n      is_modal: true,\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let ctx = this.modal_ctx;\r\n    let workspace = ctx.workspace;\r\n\r\n    super.on_pointermove(e);\r\n\r\n    this.resetTempGeom();\r\n\r\n    let delta = new Vector2(this.mpos).sub(this.startMpos);\r\n    delta = new Vector().loadXY(delta[0], delta[1]);\r\n\r\n    let center = this.inputs.center.getValue();\r\n\r\n    let l1 = this.startMpos.vectorDistance(center);\r\n    let l2 = this.mpos.vectorDistance(center);\r\n\r\n    if (l1 === 0.0 || l2 === 0.0) {\r\n      return;\r\n    }\r\n\r\n    let scenter = workspace.getGlobalMouse(center[0], center[1]);\r\n\r\n    this.makeTempLine([e.x, e.y], scenter);\r\n    \r\n    let ratio = l2/l1;\r\n    let scale = new Vector().addScalar(1.0);\r\n\r\n    scale.loadXY(ratio, ratio);\r\n\r\n    this.inputs.scale.setValue(scale);\r\n    this.exec(this.modal_ctx);\r\n  }\r\n\r\n  exec(ctx) {\r\n    let scale = this.inputs.scale.getValue();\r\n    let center = this.inputs.center.getValue();\r\n\r\n    let tmat1 = new Matrix4();\r\n    let tmat2 = new Matrix4();\r\n\r\n    tmat1.translate(-center[0], -center[1], -(center[2] ?? 0.0));\r\n    tmat2.translate(center[0], center[1], (center[2] ?? 0.0));\r\n\r\n    let matrix = new Matrix4();\r\n\r\n    matrix.multiply(tmat2);\r\n    matrix.scale(scale[0], scale[1], scale[2] ?? 1.0);\r\n    matrix.multiply(tmat1);\r\n\r\n    let tdata = this.getTransData(ctx);\r\n\r\n    for (let tlist of tdata) {\r\n      for (let td of tlist) {\r\n        td.apply(matrix);\r\n      }\r\n    }\r\n\r\n    window.redraw_all();\r\n  }\r\n}\r\n\r\nToolOp.register(ScaleOp);\r\n\r\n\r\nexport class RotateOp extends TransformOp {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  static tooldef() {\r\n    return {\r\n      uiname  : \"Move\",\r\n      toolpath: \"transform.rotate\",\r\n      inputs  : ToolOp.inherit({\r\n        th: new FloatProperty()\r\n      }),\r\n      is_modal: true,\r\n    }\r\n  }\r\n\r\n  on_pointermove(e) {\r\n    let ctx = this.modal_ctx;\r\n    let workspace = ctx.workspace;\r\n\r\n    super.on_pointermove(e);\r\n\r\n    this.resetTempGeom();\r\n\r\n    let {center, th} = this.getInputs();\r\n\r\n    let scenter = workspace.getGlobalMouse(center[0], center[1]);\r\n    this.makeTempLine([e.x, e.y], scenter);\r\n\r\n    let d1 = new Vector2(this.lastMpos);\r\n    let d2 = new Vector2(this.mpos);\r\n\r\n    d1.sub(center).normalize();\r\n    d2.sub(center).normalize();\r\n\r\n    let dth = Math.asin((d1[0]*d2[1] - d1[1]*d2[0])*0.99999);\r\n\r\n    th += dth;\r\n\r\n    this.inputs.th.setValue(th);\r\n    this.exec(this.modal_ctx);\r\n\r\n    this.lastMpos.load(this.mpos);\r\n  }\r\n\r\n  exec(ctx) {\r\n    let {center, th} = this.getInputs();\r\n\r\n    let tmat1 = new Matrix4();\r\n    let tmat2 = new Matrix4();\r\n\r\n    tmat1.translate(center[0], center[1], (center[2] ?? 0.0));\r\n    tmat2.translate(-center[0], -center[1], -(center[2] ?? 0.0));\r\n\r\n    let matrix = new Matrix4();\r\n    let rotmat = new Matrix4();\r\n    rotmat.euler_rotate(0.0, 0.0, th);\r\n\r\n    matrix.multiply(tmat1);\r\n    matrix.multiply(rotmat);\r\n    matrix.multiply(tmat2);\r\n\r\n    let tdata = this.getTransData(ctx);\r\n\r\n    for (let tlist of tdata) {\r\n      for (let td of tlist) {\r\n        td.apply(matrix);\r\n      }\r\n    }\r\n\r\n    window.redraw_all();\r\n  }\r\n}\r\n\r\nToolOp.register(RotateOp);\r\n", "import config from '../config/config.js'\r\n\r\nimport {\r\n  Vector2,\r\n  Vector3,\r\n  Vector4,\r\n  util,\r\n  math,\r\n  nstructjs,\r\n  Matrix4,\r\n  Quat,\r\n  ToolOp,\r\n  FloatProperty,\r\n  BoolProperty,\r\n  IntProperty,\r\n  EnumProperty,\r\n  FlagProperty,\r\n  Vec3Property,\r\n  ToolMacro,\r\n  PropertySlots,\r\n} from '../path.ux/pathux.js'\r\nimport {Context} from './context.js'\r\nimport {Edge, Mesh, MeshFlags, MeshTypes} from './mesh.js'\r\nimport {duplicate, vertexSmooth} from './mesh_utils.js'\r\nimport {TranslateOp} from './transform_ops.js'\r\n\r\nexport let SelToolModes = {\r\n  ADD : 0,\r\n  SUB : 1,\r\n  AUTO: 2,\r\n}\r\n\r\nfunction saveUndoMesh(mesh: Mesh) {\r\n  let data = [] as number[]\r\n  nstructjs.writeObject(data, mesh)\r\n\r\n  return new DataView(new Uint8Array(data).buffer)\r\n}\r\n\r\nfunction loadUndoMesh(mesh: Mesh, data: DataView) {\r\n  let mesh2 = nstructjs.readObject(data, Mesh)\r\n\r\n  const a = mesh as unknown as any\r\n  const b = mesh2 as unknown as any\r\n  for (let k in mesh2) {\r\n    a[k] = b[k]\r\n  }\r\n\r\n  window.redraw_all()\r\n}\r\n\r\nexport class MeshOp<Inputs extends PropertySlots = {}, Outputs extends PropertySlots = {}> extends ToolOp<\r\n  Inputs,\r\n  Outputs,\r\n  Context\r\n> {\r\n  private _meshUndoBuf: DataView\r\n\r\n  undoPre(ctx: Context) {\r\n    this._meshUndoBuf = saveUndoMesh(ctx.mesh)\r\n  }\r\n\r\n  undo(ctx: Context) {\r\n    loadUndoMesh(ctx.mesh, this._meshUndoBuf)\r\n  }\r\n\r\n  execPost(ctx: Context) {\r\n    window.redraw_all()\r\n  }\r\n}\r\n\r\nexport class SplitEdgeOp extends MeshOp<{steps: IntProperty}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Split Edge',\r\n      toolpath: 'mesh.split_edge',\r\n      inputs: ToolOp.inherit({\r\n        steps: new IntProperty(1).setRange(1, 100).noUnits().saveLastValue(),\r\n      }),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n    const {steps} = this.getInputs()\r\n\r\n    for (let e of new Set(mesh.edges.selected.editable)) {\r\n      mesh.splitEdgeMulti(e, steps)\r\n    }\r\n  }\r\n}\r\nToolOp.register(SplitEdgeOp)\r\n\r\nexport class DissolveVertOp extends MeshOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Dissolve Vertex',\r\n      toolpath: 'mesh.dissolve_vertex',\r\n      inputs  : ToolOp.inherit({}),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n\r\n    for (let v of new Set(mesh.verts.selected.editable)) {\r\n      mesh.dissolveVertex(v)\r\n    }\r\n  }\r\n}\r\nToolOp.register(DissolveVertOp)\r\n\r\nexport class DeleteOp extends MeshOp<{selMask: FlagProperty}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Delete',\r\n      toolpath: 'mesh.delete',\r\n      inputs: ToolOp.inherit({\r\n        selMask: new FlagProperty(config.SELECTMASK, MeshTypes),\r\n      }),\r\n    }\r\n  }\r\n\r\n  static invoke(ctx: Context, args: any) {\r\n    let tool = super.invoke(ctx, args)\r\n\r\n    if (!('selMask' in args)) {\r\n      tool.inputs.selMask.setValue(ctx.selMask)\r\n    }\r\n\r\n    return tool\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n    let {selMask} = this.getInputs()\r\n\r\n    console.log('Delete!', selMask)\r\n\r\n    if (selMask & MeshTypes.FACE) {\r\n      for (let v of new Set(mesh.faces.selected.editable)) {\r\n        mesh.killFace(v)\r\n      }\r\n    }\r\n\r\n    if (selMask & MeshTypes.EDGE) {\r\n      for (let v of new Set(mesh.edges.selected.editable)) {\r\n        mesh.killEdge(v)\r\n      }\r\n    }\r\n\r\n    if (selMask & MeshTypes.VERTEX) {\r\n      for (let v of new Set(mesh.verts.selected.editable)) {\r\n        mesh.killVertex(v)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DeleteOp)\r\n\r\nexport class ExtrudeVertOp extends MeshOp<{co: Vec3Property}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Extrude Vertex',\r\n      toolpath: 'mesh.extrude_vertex',\r\n      inputs: ToolOp.inherit({\r\n        co: new Vec3Property(),\r\n      }),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n\r\n    let {co} = this.getInputs()\r\n    let actv = mesh.verts.active\r\n\r\n    let v = mesh.makeVertex(co)\r\n    let ne\r\n\r\n    if (actv && actv.flag & MeshFlags.SELECT) {\r\n      ne = mesh.makeEdge(v, actv)\r\n    }\r\n\r\n    mesh.selectNone()\r\n\r\n    mesh.verts.setSelect(v, true)\r\n    mesh.verts.active = v\r\n\r\n    if (ne) {\r\n      mesh.edges.setSelect(ne, true)\r\n      mesh.edges.active = ne\r\n    }\r\n\r\n    window.redraw_all()\r\n  }\r\n}\r\n\r\nToolOp.register(ExtrudeVertOp)\r\n\r\nexport class MakeFaceOp extends MeshOp<{co: Vec3Property}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Make Face',\r\n      toolpath: 'mesh.make_face',\r\n      inputs: ToolOp.inherit({\r\n        co: new Vec3Property(),\r\n      }),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n\r\n    let vs1 = Array.from(mesh.verts.selected.editable)\r\n    vs1 = vs1.sort((a, b) => a.edges.length - b.edges.length)\r\n    let vs = new Set(vs1)\r\n\r\n    let segs = []\r\n    let visit = new WeakSet()\r\n\r\n    for (let v of vs) {\r\n      if (visit.has(v)) {\r\n        continue\r\n      }\r\n\r\n      let v2 = v\r\n      let seg = [v]\r\n\r\n      segs.push(seg)\r\n\r\n      let _i = 0\r\n      while (1) {\r\n        let newe\r\n\r\n        for (let e of v2.edges) {\r\n          let v3 = e.otherVertex(v2)\r\n\r\n          if (vs.has(v3) && !visit.has(e)) {\r\n            newe = e\r\n            break\r\n          }\r\n        }\r\n\r\n        if (!newe) {\r\n          break\r\n        }\r\n\r\n        visit.add(newe)\r\n\r\n        v2 = newe.otherVertex(v2)\r\n        visit.add(v2)\r\n        seg.push(v2)\r\n\r\n        if (_i++ > 10000) {\r\n          console.error('Infinite loop error!')\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let seg of segs) {\r\n      let f = mesh.makeFace(seg)\r\n\r\n      let rev = false\r\n\r\n      for (let l of f.loops) {\r\n        if (l.radial_next !== l && l.radial_next.v === l.v) {\r\n          rev = true\r\n          break\r\n        }\r\n      }\r\n\r\n      if (rev) {\r\n        mesh.reverseWinding(f)\r\n      }\r\n\r\n      for (let l of f.loops) {\r\n        if (l.radial_next === l) {\r\n          continue\r\n        }\r\n\r\n        let l2 = l.radial_next\r\n        if (l2.v === l.v) {\r\n          l2 = l2.next\r\n        }\r\n\r\n        mesh.copyElemData(l, l2)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(MakeFaceOp)\r\n\r\nexport class FixWindingsOp extends MeshOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Fix Windings',\r\n      toolpath: 'mesh.fix_windings',\r\n      inputs  : ToolOp.inherit({}),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n\r\n    for (let f of mesh.faces.selected.editable) {\r\n      let l = f.lists[0].l\r\n\r\n      const v1 = new Vector3(l.v.co)\r\n      const v2 = new Vector3(l.next.v.co)\r\n      const v3 = new Vector3(l.next.next.v.co)\r\n\r\n      if (v1.length === 2) {\r\n        v1[2] = v2[2] = v3[2] = 0.0\r\n      }\r\n\r\n      if (math.normal_tri(v1, v2, v3)[2] < 0.0) {\r\n        mesh.reverseWinding(f)\r\n        console.log(f.eid, f)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(FixWindingsOp)\r\n\r\nexport class FixMeshOp extends MeshOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Fix Mesh',\r\n      toolpath: 'mesh.repair',\r\n      inputs  : ToolOp.inherit({}),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n\r\n    mesh.validate()\r\n  }\r\n}\r\n\r\nToolOp.register(FixMeshOp)\r\n\r\nexport class VertexSmoothOp extends MeshOp<{repeat: IntProperty; factor: FloatProperty}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Vertex Smooth',\r\n      toolpath: 'mesh.vertex_smooth',\r\n      inputs: ToolOp.inherit({\r\n        repeat: new IntProperty(1).setRange(1, 100).noUnits().saveLastValue(),\r\n        factor: new FloatProperty(0.5).setRange(0.0, 1.0).noUnits().saveLastValue(),\r\n      }),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n    const {repeat, factor} = this.getInputs()\r\n\r\n    for (let i = 0; i < repeat; i++) {\r\n      vertexSmooth(mesh, mesh.verts.selected.editable, factor)\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(VertexSmoothOp)\r\n\r\nexport class ReverseEdgeOp extends MeshOp {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Reverse Edge Order',\r\n      toolpath: 'mesh.reverse_edge',\r\n      inputs  : ToolOp.inherit({}),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n\r\n    for (let e of mesh.edges.selected.editable) {\r\n      mesh.reverseEdge(e)\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(ReverseEdgeOp)\r\n\r\nexport class DuplicateOp extends MeshOp<{doTransform: BoolProperty}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Duplicate',\r\n      toolpath: 'mesh.duplicate',\r\n      inputs: ToolOp.inherit({\r\n        doTransform: new BoolProperty(true),\r\n      }),\r\n    }\r\n  }\r\n\r\n  static invoke(ctx: Context, args: any) {\r\n    let tool = super.invoke(ctx, args)\r\n\r\n    if (tool.inputs.doTransform.getValue()) {\r\n      let macro = new ToolMacro()\r\n      macro.add(tool)\r\n      macro.add(new TranslateOp())\r\n      return macro\r\n    }\r\n\r\n    return tool\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n\r\n    let geom = new Set(\r\n      [\r\n        Array.from(mesh.verts.selected.editable),\r\n        Array.from(mesh.edges.selected.editable),\r\n        Array.from(mesh.faces.selected.editable),\r\n      ].flat()\r\n    )\r\n\r\n    let {oldNewMap} = duplicate(mesh, geom)\r\n\r\n    for (let elist of mesh.getElists()) {\r\n      if (!elist.active) {\r\n        continue\r\n      }\r\n\r\n      let newact = oldNewMap.get(elist.active)\r\n      if (newact) {\r\n        elist.active = newact\r\n      }\r\n    }\r\n\r\n    for (let elem of geom) {\r\n      if (elem.type === MeshTypes.EDGE && (elem as Edge).h1) {\r\n        const edge = elem as Edge\r\n        mesh.setSelect(edge.h1!, false)\r\n        mesh.setSelect(edge.h2!, false)\r\n      }\r\n      mesh.setSelect(elem, false)\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(DuplicateOp)\r\n", "import config from '../config/config.js'\r\n\r\nimport {\r\n  BoolProperty,\r\n  EnumProperty,\r\n  FlagProperty,\r\n  FloatProperty,\r\n  IntProperty,\r\n  ToolOp,\r\n  PropertySlots,\r\n  ToolDef,\r\n} from '../path.ux/scripts/pathux.js'\r\nimport {Context} from './context.js'\r\nimport {Edge, Face, Handle, Loop, MeshFlags, MeshTypes, Vertex} from './mesh'\r\nimport {SelToolModes} from './mesh_ops'\r\n\r\ninterface ISelecTOpUndo {\r\n  elems: number[]\r\n  type: MeshTypes\r\n  active: number\r\n  highlight: number\r\n}\r\n\r\nexport class SelectOpBase<Inputs extends PropertySlots = {}, Outputs extends PropertySlots = {}> extends ToolOp<\r\n  Inputs & {\r\n    mode: EnumProperty\r\n    selMask: FlagProperty\r\n  },\r\n  Outputs,\r\n  Context\r\n> {\r\n  _selectOpUndo: ISelecTOpUndo[]\r\n\r\n  static tooldef(): ToolDef {\r\n    return {\r\n      toolpath: '<select op base>',\r\n      inputs: {\r\n        mode   : new EnumProperty(SelToolModes.AUTO, SelToolModes),\r\n        selMask: new FlagProperty(1 | 2 | 4 | 8 | 16, MeshTypes),\r\n      },\r\n    }\r\n  }\r\n\r\n  static invoke(ctx: Context, args: any) {\r\n    let tool = super.invoke(ctx, args)\r\n\r\n    if (!('selMask' in args)) {\r\n      tool.inputs.selMask.setValue(ctx.selMask)\r\n    }\r\n\r\n    return tool\r\n  }\r\n\r\n  getSelMask(ctx: Context) {\r\n    let mask = this.inputs.selMask.getValue()\r\n\r\n    if (ctx.mesh.haveHandles) {\r\n      mask |= MeshTypes.HANDLE\r\n    }\r\n\r\n    return mask\r\n  }\r\n\r\n  undoPre(ctx: Context) {\r\n    this._selectOpUndo = []\r\n\r\n    let mesh = ctx.mesh\r\n    let mask = this.getSelMask(ctx)\r\n\r\n    for (let list of mesh.getElists()) {\r\n      let data = {\r\n        elems    : [] as number[],\r\n        type     : list.type,\r\n        active   : list.active ? list.active.eid : -1,\r\n        highlight: list.highlight ? list.highlight.eid : -1,\r\n      }\r\n      this._selectOpUndo.push(data)\r\n      const elems = data.elems\r\n\r\n      if (!(list.type & mask)) {\r\n        continue\r\n      }\r\n\r\n      for (let e of list) {\r\n        elems.push(e.eid)\r\n        elems.push(e.flag)\r\n      }\r\n    }\r\n  }\r\n\r\n  undo(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n    let eidMap = mesh.eidMap\r\n\r\n    for (let list of this._selectOpUndo) {\r\n      let elist = mesh.elists[list.type]\r\n\r\n      elist.active = eidMap.get(list.active)\r\n      elist.highlight = eidMap.get(list.highlight)\r\n\r\n      let data = list.elems\r\n      for (let i = 0; i < data.length; i += 2) {\r\n        let eid = data[i],\r\n          state = data[i + 1]\r\n\r\n        let elem = eidMap.get(eid)\r\n        if (!elem) {\r\n          console.error('Missing mesh element ' + eid + ':' + list.type)\r\n          continue\r\n        }\r\n\r\n        if (state === elem.flag) {\r\n          continue\r\n        }\r\n\r\n        elist.setSelect(elem, !!(state & MeshFlags.SELECT))\r\n      }\r\n    }\r\n\r\n    window.redraw_all()\r\n  }\r\n\r\n  execPost(ctx: Context) {\r\n    window.redraw_all()\r\n  }\r\n}\r\n\r\nexport class SelectOneOp extends SelectOpBase<{\r\n  elemEid: IntProperty\r\n  flush: BoolProperty\r\n  setActive: BoolProperty\r\n  unique: BoolProperty\r\n}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Select One',\r\n      toolpath: 'mesh.select_one',\r\n      inputs: ToolOp.inherit({\r\n        elemEid  : new IntProperty(),\r\n        flush    : new BoolProperty(true),\r\n        setActive: new BoolProperty(true),\r\n        unique   : new BoolProperty(true),\r\n      }),\r\n    }\r\n  }\r\n\r\n  static invoke(ctx: Context, args: any) {\r\n    let tool = super.invoke(ctx, args)\r\n\r\n    if (!('selMask' in args)) {\r\n      tool.inputs.selMask.setValue(ctx.selMask)\r\n    }\r\n\r\n    return tool\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n    let {mode, elemEid, flush, setActive, unique} = this.getInputs()\r\n    let selMask = this.getSelMask(ctx)\r\n\r\n    let elem = mesh.eidMap.get(elemEid)\r\n    const haveHandles = mesh.haveHandles\r\n\r\n    if (elem === undefined) {\r\n      console.error('Unknown element ' + elemEid)\r\n      return\r\n    }\r\n\r\n    if (unique) {\r\n      mesh.selectNone()\r\n    }\r\n\r\n    if (mode === SelToolModes.ADD || mode === SelToolModes.AUTO) {\r\n      const select = mode !== SelToolModes.SUB\r\n\r\n      mesh.setSelect(elem, select)\r\n\r\n      if (select && haveHandles && elem.type === MeshTypes.VERTEX) {\r\n        const vertex = elem as Vertex\r\n        for (let e of vertex.edges) {\r\n          mesh.setSelect(e.handle(vertex)!, true)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (setActive) {\r\n      mesh.setActive(elem)\r\n    }\r\n\r\n    if (flush) {\r\n      mesh.selectFlush(selMask)\r\n    }\r\n  }\r\n}\r\n\r\nToolOp.register(SelectOneOp)\r\n\r\nexport class ToggleSelectOp extends SelectOpBase<{setActive: BoolProperty}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Select All/None',\r\n      toolpath: 'mesh.toggle_select_all',\r\n      inputs: ToolOp.inherit({\r\n        setActive: new BoolProperty(false),\r\n      }),\r\n      outputs : ToolOp.inherit({}),\r\n    }\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let mesh = ctx.mesh\r\n    let {setActive, mode, selMask} = this.getInputs()\r\n\r\n    let hasActive\r\n\r\n    if (mode === SelToolModes.AUTO) {\r\n      mode = SelToolModes.ADD\r\n\r\n      for (let elist of mesh.getElists()) {\r\n        if (!(elist.type & selMask)) {\r\n          continue\r\n        }\r\n\r\n        if (elist.active) {\r\n          hasActive = true\r\n        }\r\n\r\n        if (elist.selected.length > 0) {\r\n          mode = SelToolModes.SUB\r\n        }\r\n      }\r\n    }\r\n\r\n    if (setActive && mode === SelToolModes.SUB) {\r\n      mesh.setActive(undefined)\r\n    } else if (setActive && mode === SelToolModes.ADD) {\r\n      setActive = setActive && !hasActive\r\n    }\r\n\r\n    console.log(setActive, selMask, mode)\r\n\r\n    for (let elist of mesh.getElists()) {\r\n      if (!(elist.type & selMask)) {\r\n        continue\r\n      }\r\n\r\n      let setActive2 = setActive\r\n\r\n      for (let elem of elist.editable) {\r\n        elist.setSelect(elem, mode === SelToolModes.ADD)\r\n\r\n        if (setActive2) {\r\n          mesh.setActive(elem)\r\n          setActive2 = false\r\n        }\r\n      }\r\n    }\r\n\r\n    mesh.selectFlush(selMask)\r\n  }\r\n}\r\n\r\nToolOp.register(ToggleSelectOp)\r\n\r\nexport class SelectLinked extends SelectOpBase<{pick: BoolProperty; elemEid: IntProperty; onlyElem: BoolProperty}> {\r\n  static tooldef() {\r\n    return {\r\n      uiname  : 'Select Linked',\r\n      toolpath: 'mesh.select_linked',\r\n      inputs: ToolOp.inherit({\r\n        pick    : new BoolProperty(false),\r\n        elemEid : new IntProperty(-1),\r\n        onlyElem: new BoolProperty(false),\r\n      }),\r\n      outputs : ToolOp.inherit({}),\r\n    }\r\n  }\r\n\r\n  static invoke(ctx: Context, args: any) {\r\n    let tool = super.invoke(ctx, args)\r\n\r\n    if (tool.inputs.pick.getValue()) {\r\n      let workspace = ctx.workspace!\r\n      let elem = workspace.pick(workspace.mpos[0], workspace.mpos[1], tool.inputs.selMask.getValue())\r\n\r\n      if (elem) {\r\n        switch (elem.type) {\r\n          case MeshTypes.HANDLE:\r\n            elem = (elem as Handle).owner!.v1\r\n            break\r\n          case MeshTypes.EDGE:\r\n            elem = (elem as Edge).v1\r\n            break\r\n          case MeshTypes.FACE:\r\n            elem = (elem as Face).lists[0].l.v\r\n            break\r\n          case MeshTypes.LOOP:\r\n            elem = (elem as Loop).v\r\n            break\r\n        }\r\n\r\n        tool.inputs.elemEid.setValue(elem.eid)\r\n        tool.inputs.onlyElem.setValue(true)\r\n      }\r\n    }\r\n\r\n    return tool\r\n  }\r\n\r\n  exec(ctx: Context) {\r\n    let visit = new WeakSet()\r\n    let stack = [] as Vertex[]\r\n    let mesh = ctx.mesh\r\n    let {selMask, mode, pick, onlyElem, elemEid} = this.getInputs()\r\n\r\n    let vs: Set<Vertex>\r\n\r\n    if (onlyElem && elemEid >= 0) {\r\n      let v = mesh.eidMap.get(elemEid)\r\n\r\n      if (!v || v.type !== MeshTypes.VERTEX) {\r\n        console.warn('Invalid element ' + elemEid + '; got', v)\r\n        return\r\n      } else {\r\n        vs = new Set([v as Vertex])\r\n      }\r\n    } else {\r\n      vs = new Set(mesh.verts.selected.editable)\r\n    }\r\n\r\n    for (let v of vs) {\r\n      if (visit.has(v)) {\r\n        continue\r\n      }\r\n\r\n      stack.length = 0\r\n      stack.push(v)\r\n      visit.add(v)\r\n\r\n      while (stack.length > 0) {\r\n        let v2 = stack.pop()!\r\n\r\n        mesh.setSelect(v2, mode === SelToolModes.ADD)\r\n\r\n        for (let e of v2.edges) {\r\n          let v3 = e.otherVertex(v2)\r\n\r\n          if (!visit.has(v3)) {\r\n            visit.add(v3)\r\n            stack.push(v3)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    mesh.selectFlush(selMask)\r\n  }\r\n}\r\n\r\nToolOp.register(SelectLinked)\r\n", "import {\r\n  nstructjs,\r\n  DataStruct,\r\n  DataAPI,\r\n} from '../path.ux/pathux.js'\r\nimport { StructReader } from '../path.ux/scripts/path-controller/types/util/nstructjs.js'\r\nimport {ToolModeBase} from '../toolmode/toolmode_base.js'\r\n\r\nexport class ToolModeSet extends Array<ToolModeBase> {\r\n  active: ToolModeBase\r\n  activeIndex = 0\r\n\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nToolModeSet {\r\n  this        : array(abstract(ToolModeBase));\r\n  activeIndex : int; \r\n}\r\n  `\r\n  )\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n  }\r\n\r\n  push(...toolmodes: any[]) {\r\n    for (let toolmode of toolmodes) {\r\n      if (this.active === undefined) {\r\n        this.active = toolmode\r\n      }\r\n    }\r\n\r\n    return super.push(...toolmodes)\r\n  }\r\n\r\n  /* Okay now this is the weirdest bug ever, get/setters are broken on Array subclasses?*/\r\n  /*\r\n  get activeIndex() {\r\n    return this.length > 0 ? this.indexOf(this.active) : 0;\r\n  }\r\n\r\n  set activeIndex(i) {\r\n    console.warn(\"setting active\", i, this[i])\r\n    this.active = this[i];\r\n  }\r\n  */\r\n\r\n  static defineAPI(api: DataAPI, st: DataStruct) {\r\n    st.enum('activeIndex', 'activeIndex', ToolModeBase.makeEnumProp()).on('change', () => window.redraw_all())\r\n\r\n    return st\r\n  }\r\n\r\n  constructor() {\r\n    super()\r\n\r\n    /* Okay now this is the weirdest bug ever, class get/setters are broken\r\n     * on Array subclasses?\r\n     **/\r\n    Object.defineProperty(this, 'activeIndex', {\r\n      get() {\r\n        return this.indexOf(this.active)\r\n      },\r\n      set(i) {\r\n        this.active = this[i]\r\n      },\r\n    })\r\n  }\r\n}\r\n", "import config from '../config/config.js'\r\n\r\n/* Set default undo handlers; they just saves and reload the file\r\n *  minus the screen layout.*/\r\n\r\nimport {DataAPI, DataStruct, Screen, simple, ToolOp} from '../path.ux/scripts/pathux.js'\r\nimport {Workspace} from './workspace.js'\r\nimport {ImageWrangler} from './image_wrangler.js'\r\nimport './mesh_ops.js'\r\nimport './mesh_selectops.js'\r\nimport {ToolModeSet} from './toolModeSet.js'\r\nimport type {App} from './app'\r\nimport {ToolModeBase} from '../toolmode/toolmode_base.js'\r\nimport type {Mesh} from './mesh'\r\nimport type {PropBagAccessor, PropertiesBag} from './property_templ'\r\nimport type {Properties} from './properties'\r\nimport type {ToolStack} from '../path.ux/scripts/path-controller/toolsys/toolsys.js'\r\n\r\nToolOp.prototype.undoPre = function (ctx) {\r\n  ;(this as unknown as any)._undo = ctx.state.saveFileSync({\r\n    doScreen: false,\r\n  })\r\n}\r\n\r\nToolOp.prototype.undo = function (ctx) {\r\n  ctx.state.loadFileSync((this as unknown as any)._undo, {\r\n    resetToolStack: false,\r\n    resetContext  : false,\r\n    doScreen      : false,\r\n    resetOnLoad   : false,\r\n  })\r\n}\r\n\r\nexport class Context {\r\n  state: App\r\n\r\n  constructor(state: App) {\r\n    this.state = state\r\n  }\r\n\r\n  get workspace() {\r\n    return simple.Editor.findEditor(Workspace)\r\n  }\r\n\r\n  get selMask(): number {\r\n    return config.SELECTMASK\r\n  }\r\n\r\n  get mesh(): Mesh {\r\n    return this.state.mesh\r\n  }\r\n\r\n  get api(): DataAPI {\r\n    return this.state.api\r\n  }\r\n  get screen(): Screen {\r\n    return this.state.screen\r\n  }\r\n  get properties(): PropBagAccessor<typeof Properties> {\r\n    return this.state.properties.asFullyTypedBag\r\n  }\r\n\r\n  get toolstack() {\r\n    return this.state.toolstack as ToolStack\r\n  }\r\n\r\n  get testImages() {\r\n    return this.state.testImages\r\n  }\r\n\r\n  get toolmode() {\r\n    return this.state.toolmodes.active\r\n  }\r\n\r\n  get toolmodes() {\r\n    return this.state.toolmodes\r\n  }\r\n\r\n  static defineAPI(api: DataAPI, st: DataStruct) {\r\n    ToolModeSet.defineAPI(api, api.mapStruct(ToolModeSet))\r\n\r\n    st.dynamicStruct('toolmode', 'toolmode', 'Tool Mode', api.mapStruct(ToolModeBase))\r\n    st.struct('toolmodes', 'toolmodes', 'Tool Modes', api.mapStruct(ToolModeSet))\r\n\r\n    st.struct('testImages', 'testImages', 'Test Images', api.mapStruct(ImageWrangler))\r\n    st.dynamicStruct('properties', 'properties', 'Properties')\r\n  }\r\n}\r\n", "\"use strict\";\r\n\r\nexport const Icons = {\r\n  FOLDER        : 0, //file folder\r\n  FILE          : 1,\r\n  TINY_X        : 2, //'x' in bottom left corner\r\n  SMALL_PLUS    : 3,\r\n  SMALL_MINUS   : 4,\r\n  UNDO          : 5,\r\n  REDO          : 6,\r\n  HELP          : 7,\r\n  ENUM_UNCHECKED: 8, //overlaid on icon checkboxes when unchecked\r\n  ENUM_CHECKED  : 9, //overlaid on icon checkboxes when checked\r\n  LARGE_CHECK   : 10, //default check mark for non-icon checkboxes\r\n  CURSOR_ARROW  : 11,\r\n  NOTE_EXCL     : 12, //notification exclamation mark\r\n  SCROLL_DOWN   : 13,\r\n  SCROLL_UP     : 14,\r\n  BACKSPACE     : 15,\r\n  LEFT_ARROW    : 16,\r\n  RIGHT_ARROW   : 17,\r\n  UI_EXPAND     : 18, //triangle\r\n  UI_COLLAPSE   : 19, //triangle\r\n  BOLD          : 20,\r\n  ITALIC        : 21,\r\n  UNDERLINE     : 22,\r\n  STRIKETHRU    : 23,\r\n  TREE_EXPAND   : 24,\r\n  TREE_COLLAPSE : 25,\r\n  ZOOM_OUT      : 26,\r\n  ZOOM_IN       : 27,\r\n  LARGE_X       : 28,\r\n  TOOLMODE_MESH : 29,\r\n  BRUSH         : 30,\r\n};\r\n", "export const Properties = {\r\n  drawControls: {type: 'bool' as const, value: true},\r\n  steps       : {type: 'int' as const, value: 1, min: 0, max: 10, slideSpeed: 5},\r\n  boolVal     : {type: 'bool' as const, value: true},\r\n  float       : {panel: 'panel2', type: 'float' as const, value: 0, min: 0, max: 10, step: 0.05, decimalPlaces: 3},\r\n  slider: {\r\n    panel: 'panel2',\r\n    type: 'float' as const,\r\n    slider: true,\r\n    value: 0,\r\n    min: 0,\r\n    max: 10,\r\n    step: 0.05,\r\n    decimalPlaces: 3,\r\n  },\r\n}\r\n", "import config from '../config/config.js'\r\n\r\nimport {\r\n  KeyMap,\r\n  color2css,\r\n  css2color,\r\n  Vector3,\r\n  Matrix4,\r\n  Quat,\r\n  util,\r\n  nstructjs,\r\n  math,\r\n  Vector4,\r\n  UIBase,\r\n  HotKey,\r\n  haveModal,\r\n  Vector2,\r\n} from '../path.ux/scripts/pathux.js'\r\n\r\nimport {getElemColor, MeshTypes, MeshFlags, MeshFeatures, ElementArray, Vertex, Handle} from '../core/mesh.js'\r\nimport '../core/mesh_ops.js'\r\nimport '../core/transform_ops.js'\r\nimport '../core/mesh_selectops.js'\r\n\r\nimport {SelToolModes} from '../core/mesh_ops.js'\r\nimport {ToolModeBase, PickData, IToolModeConstructor, IToolModeDef} from './toolmode_base.js'\r\nimport {Icons} from '../../assets/icon_enum.js'\r\nimport {Context} from '../core/context.js'\r\nimport {StructReader} from '../path.ux/scripts/path-controller/types/util/nstructjs.js'\r\n\r\nlet pick_cachering = util.cachering.fromConstructor(PickData, 32)\r\n\r\ninterface IMeshEditorConstructor extends IToolModeConstructor {\r\n  drawMesh(ctx: Context, canvas: HTMLCanvasElement, g: CanvasRenderingContext2D, drawControls?: boolean): void\r\n}\r\n\r\nexport class MeshEditor extends ToolModeBase {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nMeshToolMode {\r\n}\r\n  `\r\n  )\r\n\r\n  static toolModeDef(): IToolModeDef {\r\n    return {\r\n      typeName   : 'mesh',\r\n      uiName     : 'Mesh',\r\n      icon       : Icons.TOOLMODE_MESH,\r\n      description: 'Mesh tool',\r\n    }\r\n  }\r\n\r\n  static {\r\n    ToolModeBase.register(this)\r\n  }\r\n\r\n  ['constructor']: IMeshEditorConstructor\r\n\r\n  startMpos: Vector2\r\n  mpos: Vector2\r\n  mdown: boolean\r\n\r\n  constructor(ctx: Context) {\r\n    super(ctx)\r\n\r\n    this.startMpos = new Vector2()\r\n    this.mpos = new Vector2()\r\n\r\n    this.keymap = new KeyMap([\r\n      new HotKey('A', ['CTRL'], \"mesh.toggle_select_all(mode='ADD')\"),\r\n      new HotKey('A', [], \"mesh.toggle_select_all(mode='ADD')\"),\r\n      new HotKey('A', ['ALT'], \"mesh.toggle_select_all(mode='SUB')\"),\r\n      new HotKey('A', ['CTRL', 'SHIFT'], \"mesh.toggle_select_all(mode='SUB')\"),\r\n      new HotKey('G', [], 'transform.translate()'),\r\n      new HotKey('S', [], 'transform.scale()'),\r\n      new HotKey('R', [], 'transform.rotate()'),\r\n      new HotKey('E', [], 'mesh.split_edge()'),\r\n      new HotKey('D', [], 'mesh.dissolve_vertex()'),\r\n      new HotKey('D', ['SHIFT'], 'mesh.duplicate(doTransform=true)'),\r\n      new HotKey('X', [], 'mesh.delete()'),\r\n      new HotKey('Delete', [], 'mesh.delete()'),\r\n      new HotKey('L', [], \"mesh.select_linked(pick=true mode='ADD')\"),\r\n      new HotKey('L', ['SHIFT'], \"mesh.select_linked(pick=true mode='SUB')\"),\r\n      new HotKey('F', [], 'mesh.make_face'),\r\n    ])\r\n\r\n    this.mdown = false\r\n  }\r\n\r\n  draw(ctx: Context, canvas: HTMLCanvasElement, g: CanvasRenderingContext2D) {\r\n    this.ctx = ctx\r\n    this.constructor.drawMesh(ctx, canvas, g)\r\n  }\r\n\r\n  static drawMesh(\r\n    ctx: Context,\r\n    canvas: HTMLCanvasElement,\r\n    g: CanvasRenderingContext2D,\r\n    drawControls = ctx.properties.drawControls\r\n  ) {\r\n    let mesh = ctx.mesh\r\n\r\n    let w = 8\r\n    const haveHandles = mesh.haveHandles\r\n\r\n    if (!haveHandles) {\r\n      for (let e of mesh.edges.visible) {\r\n        g.strokeStyle = color2css(getElemColor(mesh.edges, e))\r\n        g.beginPath()\r\n        g.moveTo(e.v1.co[0], e.v1.co[1])\r\n        g.lineTo(e.v2.co[0], e.v2.co[1])\r\n        g.stroke()\r\n      }\r\n    } else {\r\n      for (let e of mesh.edges.visible) {\r\n        g.strokeStyle = color2css(getElemColor(mesh.edges, e))\r\n        g.beginPath()\r\n        g.moveTo(e.v1.co[0], e.v1.co[1])\r\n        g.bezierCurveTo(e.h1!.co[0], e.h1!.co[1], e.h2!.co[0], e.h2!.co[1], e.v2.co[0], e.v2.co[1])\r\n        g.stroke()\r\n      }\r\n    }\r\n\r\n    if (haveHandles && drawControls) {\r\n      for (let h of mesh.handles.visible) {\r\n        g.strokeStyle = color2css(getElemColor(mesh.handles, h))\r\n        let v = h.owner!.vertex(h)\r\n\r\n        g.beginPath()\r\n        g.moveTo(v.co[0], v.co[1])\r\n        g.lineTo(h.co[0], h.co[1])\r\n        g.stroke()\r\n      }\r\n    }\r\n\r\n    if (drawControls) {\r\n      let vlists: ElementArray<Vertex | Handle>[] = [mesh.verts]\r\n      if (haveHandles) {\r\n        vlists.push(mesh.handles)\r\n      }\r\n\r\n      for (let list of vlists) {\r\n        for (let v of list.visible) {\r\n          g.fillStyle = color2css(getElemColor(list, v))\r\n          g.beginPath()\r\n          g.rect(v.co[0] - w * 0.5, v.co[1] - w * 0.5, w, w)\r\n          g.fill()\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let f of mesh.faces.visible) {\r\n      g.beginPath()\r\n      let color = new Vector4(getElemColor(mesh.faces, f))\r\n      color[3] = 0.15\r\n\r\n      g.fillStyle = color2css(color)\r\n      for (let list of f.lists) {\r\n        let l = list.l.prev\r\n        g.moveTo(l.v.co[0], l.v.co[1])\r\n\r\n        for (let l of list) {\r\n          if (haveHandles) {\r\n            let {h1, h2} = l.prev\r\n            g.bezierCurveTo(h1.co[0], h1.co[1], h2.co[0], h2.co[1], l.v.co[0], l.v.co[1])\r\n          } else {\r\n            g.lineTo(l.v.co[0], l.v.co[1])\r\n          }\r\n        }\r\n\r\n        g.closePath()\r\n      }\r\n\r\n      g.fill()\r\n    }\r\n  }\r\n\r\n  on_mousedown(localX: number, localY: number, e: PointerEvent) {\r\n    this.mdown = e.button === 0\r\n    this.startMpos.loadXY(localX, localY)\r\n\r\n    this.updateHighlight(localX, localY)\r\n\r\n    let mesh = this.ctx.mesh\r\n\r\n    if (mesh.hasHighlight) {\r\n      let type, elem\r\n\r\n      for (let k in mesh.elists) {\r\n        let elist = mesh.elists[k]\r\n\r\n        if (elist.highlight) {\r\n          type = elist.type\r\n          elem = elist.highlight\r\n        }\r\n      }\r\n\r\n      if (elem === undefined) {\r\n        return\r\n      }\r\n\r\n      let mode\r\n\r\n      if (e.shiftKey) {\r\n        mode = elem.flag & MeshFlags.SELECT ? SelToolModes.SUB : SelToolModes.ADD\r\n      } else {\r\n        mode = SelToolModes.ADD\r\n      }\r\n\r\n      this.ctx.api.execTool(this.ctx, 'mesh.select_one', {\r\n        mode,\r\n        unique : !e.shiftKey,\r\n        elemEid: elem.eid,\r\n      })\r\n    } else if (e.button === 0 && config.ENABLE_EXTRUDE) {\r\n      let co = new Vector3([localX, localY, 0])\r\n\r\n      this.ctx.api.execTool(this.ctx, 'mesh.extrude_vertex', {\r\n        co,\r\n      })\r\n\r\n      this.updateHighlight(localX, localY)\r\n    }\r\n  }\r\n\r\n  updateHighlight(localX: number, localY: number) {\r\n    if (this.ctx?.workspace === undefined) {\r\n      return\r\n    }\r\n\r\n    let elem = this.ctx.workspace.pick(localX, localY)\r\n    let mesh = this.ctx.mesh\r\n\r\n    let update = false\r\n\r\n    /* Clear all other highlight. */\r\n    mesh.setHighlight(undefined)\r\n    update = mesh.setHighlight(elem)\r\n    //console.log(\"set highlight\", update);\r\n\r\n    if (update) {\r\n      window.redraw_all()\r\n    }\r\n    return update\r\n  }\r\n\r\n  on_mousemove(localX: number, localY: number, e: PointerEvent) {\r\n    this.mpos.loadXY(localX, localY)\r\n\r\n    if (haveModal(e)) {\r\n      this.mdown = false\r\n      return\r\n    }\r\n\r\n    this.updateHighlight(localX, localY)\r\n\r\n    if (this.mdown) {\r\n      let mesh = this.ctx.mesh\r\n\r\n      let act = false\r\n      let selmask = this.ctx.selMask\r\n\r\n      for (let elist of mesh.getElists()) {\r\n        if (!(elist.type & selmask)) {\r\n          continue\r\n        }\r\n\r\n        act = act || elist.selected.length > 0\r\n      }\r\n\r\n      if (act && this.mpos.vectorDistance(this.startMpos) > 10) {\r\n        this.mdown = false\r\n        this.ctx.api.execTool(this.ctx, 'transform.translate()')\r\n      }\r\n    }\r\n  }\r\n\r\n  on_mouseup(localX: number, localY: number, e: PointerEvent) {\r\n    this.mdown = false\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n    super.loadSTRUCT(reader)\r\n  }\r\n}\r\n", "import {util, math, nstructjs, Vector2, Vector4, DataAPI, DataStruct, Container} from '../path.ux/scripts/pathux.js'\r\nimport {IToolModeDef, ToolModeBase} from './toolmode_base.js'\r\nimport {Icons} from '../../assets/icon_enum.js'\r\nimport {MeshEditor} from './toolmode_mesh.js'\r\nimport {Context} from '../core/context.js'\r\nimport {StructReader} from '../path.ux/scripts/path-controller/types/util/nstructjs.js'\r\n\r\nexport class PenToolMode extends ToolModeBase {\r\n  static STRUCT = nstructjs.inlineRegister(\r\n    this,\r\n    `\r\nPenToolMode {\r\n  color    : vec4;\r\n  strength : float;\r\n  radius   : float;\r\n}\r\n  `\r\n  )\r\n\r\n  static toolModeDef(): IToolModeDef {\r\n    return {\r\n      typeName: 'pen',\r\n      uiName  : 'Pen',\r\n      icon    : Icons.BRUSH,\r\n    }\r\n  }\r\n  static {\r\n    ToolModeBase.register(this)\r\n  }\r\n\r\n  strength: number\r\n  radius: number\r\n  color: Vector4\r\n\r\n  constructor(ctx: Context) {\r\n    super(ctx)\r\n\r\n    this.strength = 1.0\r\n    this.radius = 25.0\r\n    this.color = new Vector4([0, 0.5, 1.0, 1.0])\r\n  }\r\n\r\n  static defineAPI(api: DataAPI, st: DataStruct) {\r\n    st.float('strength', 'strength', 'Strength').range(0.0, 1.0).step(0.1).decimalPlaces(2).noUnits()\r\n    st.float('radius', 'radius', 'Radius').range(0.1, 512).step(0.1).expRate(2.0).decimalPlaces(1).unit('pixel')\r\n    return st\r\n  }\r\n\r\n  buildSideBar(container: Container) {\r\n    container.prop('strength')\r\n    container.prop('radius')\r\n  }\r\n\r\n  loadSTRUCT(reader: StructReader<this>) {\r\n    reader(this)\r\n    super.loadSTRUCT(reader)\r\n  }\r\n\r\n  draw(ctx: Context, canvas: HTMLCanvasElement, g: CanvasRenderingContext2D) {\r\n    MeshEditor.drawMesh(ctx, canvas, g, false)\r\n  }\r\n}\r\n", "import {\r\n  simple,\r\n  util,\r\n  Vector3,\r\n  TextBoxBase,\r\n  nstructjs,\r\n} from '../path.ux/pathux.js'\r\n\r\nimport './workspace.js'\r\nimport {Mesh, MeshTypes} from './mesh.js'\r\nimport {Workspace} from './workspace.js'\r\nimport {FileArgs} from '../path.ux/scripts/simple/file.js'\r\nimport {PropertiesBag} from './property_templ.js'\r\nimport {Context} from './context'\r\nimport config from '../config/config.js'\r\nimport {ImageWrangler} from './image_wrangler.js'\r\nimport {Icons} from '../../assets/icon_enum.js'\r\nimport {ToolModeBase, ToolModeClasses} from '../toolmode/toolmode_base.js'\r\nimport {Properties} from './properties'\r\n\r\nimport '../toolmode/all.js'\r\n\r\nnstructjs.setWarningMode(0)\r\n\r\ndeclare global {\r\n  interface Window {\r\n    _appstate: App\r\n  }\r\n  const _appstate: App\r\n}\r\n\r\nexport const STARTUP_FILE_KEY = '_startup_file_1'\r\n\r\nimport {StructReader} from '../path.ux/scripts/path-controller/types/util/nstructjs.js'\r\nimport {FileData, IFileArgs} from '../path.ux/scripts/types/simple/simple.js'\r\n\r\n/* See config.DRAW_TEST_IMAGES */\r\nexport const TestImages = {\r\n  imageColumns : 2,\r\n  singletonMode: false,\r\n  test1: {\r\n    size: [128, 256],\r\n  },\r\n  test2: {\r\n    dimen: 256,\r\n  },\r\n  test3: {\r\n    dimen: 128,\r\n  },\r\n}\r\n\r\nwindow.addEventListener('contextmenu', (e) => {\r\n  console.log(e)\r\n\r\n  if (window._appstate && _appstate.screen) {\r\n    let elem = _appstate.screen.pickElement(e.x, e.y)\r\n\r\n    if (elem !== undefined && (elem instanceof TextBoxBase || elem.tagName === 'INPUT')) {\r\n      return\r\n    }\r\n  }\r\n  e.preventDefault()\r\n})\r\n\r\nimport {ToolModeSet} from './toolModeSet.js'\r\nexport {ToolModeSet}\r\n\r\nexport class App extends simple.AppState<Context> {\r\n  mesh: Mesh\r\n  properties: PropertiesBag<typeof Properties>\r\n  toolmodes = new ToolModeSet()\r\n  testImages = new ImageWrangler(TestImages as unknown as undefined) // XXX\r\n\r\n  constructor() {\r\n    super(Context)\r\n\r\n    this.toolmodes = new ToolModeSet()\r\n\r\n    this.createNewFile(true)\r\n\r\n    this.saveFilesInJSON = true\r\n    let dimen = 128\r\n  }\r\n\r\n  get toolmode() {\r\n    return this.toolmodes.active\r\n  }\r\n\r\n  createNewFile(noReset = false) {\r\n    if (!noReset) {\r\n      this.reset()\r\n      this.makeScreen()\r\n    }\r\n\r\n    this.properties = new PropertiesBag(Properties)\r\n\r\n    this.mesh = new Mesh()\r\n    let s = 50\r\n    let d = 200\r\n    let v1 = this.mesh.makeVertex(new Vector3([s, s, 0]))\r\n    let v2 = this.mesh.makeVertex(new Vector3([s, s + d, 0]))\r\n    let v3 = this.mesh.makeVertex(new Vector3([s + d, s + d, 0]))\r\n    let v4 = this.mesh.makeVertex(new Vector3([s + d, s, 0]))\r\n\r\n    this.mesh.makeFace([v1, v2, v3, v4])\r\n\r\n    this.toolmodes = new ToolModeSet()\r\n    for (let cls of ToolModeClasses) {\r\n      this.toolmodes.push(new cls(this.ctx))\r\n    }\r\n  }\r\n\r\n  saveStartupFile() {\r\n    this.saveFile().then((json) => {\r\n      const buf = JSON.stringify(json)\r\n\r\n      localStorage[STARTUP_FILE_KEY] = buf\r\n      console.log('Saved startup file', (buf.length / 1024.0).toFixed(2) + 'kb')\r\n    })\r\n  }\r\n\r\n  loadStartupFile() {\r\n    if (!(STARTUP_FILE_KEY in localStorage)) {\r\n      return\r\n    }\r\n\r\n    try {\r\n      let json = JSON.parse(localStorage[STARTUP_FILE_KEY])\r\n      this.loadFile(json)\r\n    } catch (error) {\r\n      util.print_stack(error)\r\n      console.warn('Failed to load startup file')\r\n      this.createNewFile()\r\n    }\r\n  }\r\n\r\n  getFileObjects() {\r\n    return [this.mesh, this.properties, this.testImages, this.toolmodes]\r\n  }\r\n\r\n  saveFileSync(objects: any, args: IFileArgs = {}): string | ArrayBuffer {\r\n    if (args.useJSON === undefined) {\r\n      args.useJSON = true\r\n    }\r\n\r\n    return super.saveFileSync(this.getFileObjects(), args)\r\n  }\r\n\r\n  saveFile(args: IFileArgs = {}): Promise<string | ArrayBuffer> {\r\n    return new Promise<string | ArrayBuffer>((accept, reject) => {\r\n      accept(this.saveFileSync(this.getFileObjects(), args))\r\n    })\r\n  }\r\n\r\n  loadFileSync(data: ArrayBuffer | string, args: IFileArgs = {}) {\r\n    if (args.useJSON === undefined) {\r\n      args.useJSON = true\r\n    }\r\n\r\n    let file = super.loadFileSync(data, args)\r\n    console.log(file.objects)\r\n\r\n    this.mesh = file.objects[0]\r\n    this.properties = file.objects[1] ?? this.properties\r\n\r\n    this.properties.patchTemplate(Properties)\r\n\r\n    for (let obj of file.objects) {\r\n      if (obj instanceof ImageWrangler) {\r\n        this.testImages = obj\r\n        this.testImages.loadFromTemplate(TestImages)\r\n      }\r\n    }\r\n\r\n    for (let obj of file.objects) {\r\n      if (obj instanceof ToolModeSet) {\r\n        this.toolmodes = new ToolModeSet()\r\n        this.toolmodes.length = 0\r\n\r\n        /* Reorder toolmodes. */\r\n        for (let toolmode of obj) {\r\n          let i = ToolModeClasses.indexOf(toolmode.constructor)\r\n          if (i < 0) {\r\n            console.warn('Missing tool mode ' + toolmode.constructor.name, obj)\r\n            continue\r\n          }\r\n\r\n          this.toolmodes[i] = toolmode\r\n        }\r\n\r\n        this.toolmodes.active = obj.active\r\n\r\n        /* Add any new modes. */\r\n        for (let i = 0; i < this.toolmodes.length; i++) {\r\n          if (this.toolmodes[i] === undefined) {\r\n            this.toolmodes[i] = new ToolModeClasses[i](this.ctx)\r\n          }\r\n        }\r\n\r\n        break\r\n      }\r\n    }\r\n\r\n    window.redraw_all()\r\n    return file\r\n  }\r\n\r\n  loadFile(data: ArrayBuffer | string, args: IFileArgs = {}) {\r\n    return new Promise<FileData>((accept, reject) => {\r\n      accept(this.loadFileSync(data, args))\r\n    })\r\n  }\r\n\r\n  draw() {\r\n    for (let sarea of this.screen.sareas) {\r\n      if (sarea.area && (sarea.area as any).draw) {\r\n        ;(sarea.area as any).draw() // XXX\r\n      }\r\n    }\r\n  }\r\n\r\n  start() {\r\n    super.start({\r\n      DEBUG: {\r\n        modalEvents: true,\r\n      },\r\n      iconsheet: document.getElementById('iconsheet'),\r\n      icons    : Icons,\r\n    })\r\n\r\n    this.loadStartupFile()\r\n  }\r\n}\r\n\r\nexport function start() {\r\n  console.log('start!')\r\n\r\n  let animreq: number | undefined = undefined\r\n\r\n  function f() {\r\n    animreq = undefined\r\n\r\n    _appstate.draw()\r\n  }\r\n\r\n  let ignore_lvl = 0\r\n  window.draw_ignore_push = function () {\r\n    ignore_lvl++\r\n  }\r\n  window.draw_ignore_pop = function () {\r\n    ignore_lvl = Math.max(ignore_lvl - 1, 0)\r\n  }\r\n\r\n  window.redraw_all = function () {\r\n    if (animreq || ignore_lvl) {\r\n      return\r\n    }\r\n\r\n    animreq = requestAnimationFrame(f)\r\n  }\r\n\r\n  window._appstate = new App()\r\n  _appstate.start()\r\n\r\n  if (config.AUTOSAVE) {\r\n    window.setInterval(() => {\r\n      _appstate.saveStartupFile()\r\n    }, config.AUTOSAVE_INTERVAL_MS)\r\n  }\r\n\r\n  window.redraw_all()\r\n}\r\n", "\r\nexport const a = 1;\r\nexport * from './core/app'\r\n"],
  "mappings": "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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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",
  "names": ["keymap", "EnumProperty", "PropTypes", "UIBase", "PackFlags", "IconSheets", "parsepx", "ignore", "text", "val", "error", "myToFixed", "keymap", "EnumProperty", "PropTypes", "UIBase", "PackFlags", "IconSheets", "parsepx", "id", "e", "high", "error", "text", "PropFlags", "PropSubTypes", "EnumProperty", "Vector2", "UIBase", "PackFlags", "PropTypes", "text", "list", "error", "print_stack", "cls", "hotkey", "id", "name", "con", "ToolProperty", "elem", "UIBase", "css2color", "color2css", "id", "error", "UIBase", "Icons", "text", "sel", "keymap", "UIBase", "ToolProperty", "name", "message", "text", "func", "Vector2", "Vector3", "UndoFlags", "ToolFlags", "elem", "UIBase", "border", "idgen", "sz", "id", "UIBase", "elem", "debug", "UIBase", "Vector2", "id", "name", "error", "print_stack", "zindex", "id", "key", "obj", "path", "validateCSSColor", "css2color", "error", "color2css", "textbox", "path2", "a", "list", "UIBase", "UIBase", "name", "text", "e", "arrowcolor", "css2color", "color2css", "e2", "error", "print_stack", "elem", "elem2", "UIBase", "keys", "id", "func", "list", "error", "id", "UIBase", "_ui", "PropFlags", "PropSubTypes", "EnumProperty", "Vector2", "UIBase", "PackFlags", "PropTypes", "text", "Vector2", "Vector3", "Vector4", "Matrix4", "UIBase", "PackFlags", "IconSheets", "a", "error", "e", "rect", "x", "y", "theme", "cmyk", "color", "redraw", "UIBase", "PackFlags", "IconSheets", "iconmanager", "Vector2", "elem", "e2", "act", "error", "print_stack", "a", "id", "name", "font", "div", "_ui", "PropFlags", "PropSubTypes", "EnumProperty", "Vector2", "UIBase", "PackFlags", "PropTypes", "list", "EnumProperty", "PropTypes", "UIBase", "PackFlags", "IconSheets", "getpx", "name", "id", "UIBase", "name", "ToolProperty", "UIBase", "Vector2", "UIBase", "text", "parsepx", "error", "color2css", "color", "id", "UIBase", "name", "elem", "i", "r", "parsepx", "UIBase", "name", "tab", "UIBase", "error", "print_stack", "sarea", "Area", "list", "registerToolStackGetter", "func", "Vector2", "UIBase", "styleScrollBars", "Screen", "elem", "elem2", "k", "error", "x", "y", "scale", "id", "keymap", "print_stack", "sarea2", "he2", "text", "b", "b2", "borders", "Icons", "parsepx", "name", "UIBase", "Icons", "UIBase", "error", "Icons", "Screen", "UIBase", "error", "sarea", "MeshTypes", "MeshFlags", "MeshFeatures", "name", "ToolProperty", "elem", "a", "a", "list", "Element", "set", "sel", "elem", "l", "l2", "elem", "UIBase", "list", "a", "ToolProperty", "UIBase", "name", "ToolProperty", "i", "elem", "list", "list", "elem", "a", "elem", "list", "elem", "Context", "Icons", "pick_cachering", "Icons", "color2css", "list", "l", "elem", "act", "Icons", "elem", "Context", "buf", "error", "Icons"]
}
